<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>å®šæ—¶æé†’è„šæœ¬</title>
    <link href="/dajiangdahe/2021/12/28/%E5%AE%9A%E6%97%B6%E6%8F%90%E9%86%92%E8%84%9A%E6%9C%AC/"/>
    <url>/dajiangdahe/2021/12/28/%E5%AE%9A%E6%97%B6%E6%8F%90%E9%86%92%E8%84%9A%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<h1>é€šè¿‡serveré…±å®ç°å®šæ—¶æé†’XXXåŠŸèƒ½ï¼Œé…åˆå…¶ä»–çˆ¬è™«ä½¿ç”¨æ›´é¦™ğŸ˜¬</h1><p><code>Apscheduler</code>åŒ…æ˜¯pythonæ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„åŒ…ï¼Œé€šè¿‡å°†æ‰§è¡Œå‡½æ•°æ”¾å…¥<code>scheduler</code>ä¸­å®ç°é˜»å¡é˜Ÿåˆ—ã€‚<code>scheduler.add_job</code>æ–¹æ³•ä¸­å†™å…¥<code>cron</code>ç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„æ—¶é—´å³å¯å®ç°ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import requests<br><span class="hljs-keyword">from</span> urllib.request import urlopen<br><span class="hljs-keyword">from</span> apscheduler.schedulers.blocking import BlockingScheduler<br><span class="hljs-keyword">from</span> datetime import datetime<br><span class="hljs-keyword">from</span> bs4 import BeautifulSoup<br><span class="hljs-comment"># è·å–å¤©æ°”æƒ…å†µ</span><br><br><br><br>def get_weather():<br>    # æµå—ç¼–ç ï¼š101120101<br>    # åŒ—äº¬ç¼–ç ï¼š101010100<br>    # å¸¸å·ç¼–ç ï¼š101191101<br>    # æˆéƒ½ç¼–ç ï¼š101270101<br>    resp = urlopen(<span class="hljs-string">&#x27;http://www.weather.com.cn/weather/101270101.shtml&#x27;</span>)<br>    soup = BeautifulSoup(resp, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>    tagDate = soup.<span class="hljs-builtin-name">find</span>(<span class="hljs-string">&#x27;ul&#x27;</span>, <span class="hljs-attribute">class_</span>=<span class="hljs-string">&quot;t clearfix&quot;</span>)<br>    dates = tagDate.h1.string<br><br>    tagToday = soup.<span class="hljs-builtin-name">find</span>(<span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-attribute">class_</span>=<span class="hljs-string">&quot;tem&quot;</span>)<br>    try:<br>        temperatureHigh = tagToday.span.string<br>    except AttributeError as e:<br>        temperatureHigh = tagToday.find_next(<span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-attribute">class_</span>=<span class="hljs-string">&quot;tem&quot;</span>).span.string<br><br>    temperatureLow = tagToday.i.string<br>    weather = soup.<span class="hljs-builtin-name">find</span>(<span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-attribute">class_</span>=<span class="hljs-string">&quot;wea&quot;</span>).string<br><br>    tagWind = soup.<span class="hljs-builtin-name">find</span>(<span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-attribute">class_</span>=<span class="hljs-string">&quot;win&quot;</span>)<br>    winL = tagWind.i.string<br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;ä»Šå¤©æ˜¯ï¼š&#x27;</span> + dates)<br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;é£çº§ï¼š&#x27;</span> + winL)<br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;æœ€ä½æ¸©åº¦ï¼š&#x27;</span> + temperatureLow)<br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;æœ€é«˜æ¸©åº¦ï¼š&#x27;</span> + temperatureHigh)<br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;å¤©æ°”ï¼š&#x27;</span> + weather)<br>    return <span class="hljs-string">&#x27;- ä»Šå¤©æ˜¯ï¼š&#x27;</span> + dates + <span class="hljs-string">&#x27;\n&#x27;</span> \<br>           + <span class="hljs-string">&#x27;- é£çº§ï¼š&#x27;</span> + winL + <span class="hljs-string">&#x27;\n&#x27;</span> \<br>           + <span class="hljs-string">&#x27;- æœ€ä½æ¸©åº¦ï¼š&#x27;</span> + temperatureLow + <span class="hljs-string">&#x27;\n&#x27;</span> \<br>           + <span class="hljs-string">&#x27;- æœ€é«˜æ¸©åº¦ï¼š&#x27;</span> + temperatureHigh + <span class="hljs-string">&#x27;\n&#x27;</span> \<br>           + <span class="hljs-string">&#x27;- å¤©æ°”ï¼š&#x27;</span> + weather<br><br><br>def server_jiang_push():<br>    # SCT107154Tql4S5x7TkGJR8yyFSKBK2IpN ç²ç²sendKey<br>    # SCT107162To1V84RPruXW4TpOdshLHIxZq å¨‡å¨‡sendKey<br>    # SCT107171T5ezOqVN1e4QVarvp7D1YxbiC æ­»é±¼sendKey<br>    # SCT107509TRGThxFFS38QoqO7CBPZywvey è€å¤§<br>    SCKEY = <span class="hljs-string">&#x27;SCT107509TRGThxFFS38QoqO7CBPZywvey&#x27;</span>  # serveré…±çš„sendKey<br>    title = <span class="hljs-string">&#x27;å‘å‘å¤©æ°”å°åŠ©æ‰‹&#x27;</span><br>    message = get_weather()<br>    requests.post(f<span class="hljs-string">&#x27;https://sc.ftqq.com/&#123;SCKEY&#125;.send?title=&#123;title&#125;&amp;desp=&#123;message&#125;&#x27;</span>)<br><br><span class="hljs-comment"># å®šæ—¶ä»»åŠ¡</span><br>def job():<br>    <span class="hljs-builtin-name">print</span>(datetime.now().strftime(<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>))<br>    # BlockingScheduler<br>   <span class="hljs-built_in"> scheduler </span>= BlockingScheduler(<span class="hljs-attribute">timezone</span>=<span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span>)<br>    scheduler.add_job(server_jiang_push, <span class="hljs-string">&#x27;cron&#x27;</span>, <span class="hljs-attribute">day_of_week</span>=<span class="hljs-string">&#x27;0-6&#x27;</span>, <span class="hljs-attribute">hour</span>=22, <span class="hljs-attribute">minute</span>=21)<br>    scheduler.start()<br><br><span class="hljs-keyword">if</span> <span class="hljs-attribute">__name__</span>==&#x27;__main__&#x27;:<br>    job()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è„šæœ¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®šæ—¶æé†’è„šæœ¬</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>1984ï¼ˆä¹”æ²»å¥¥å¨å°”ï¼‰</title>
    <link href="/dajiangdahe/2021/12/26/%E3%80%90ZZ%E3%80%911984/"/>
    <url>/dajiangdahe/2021/12/26/%E3%80%90ZZ%E3%80%911984/</url>
    
    <content type="html"><![CDATA[<h1>1984(ä¹”æ²»å¥¥å¨å°”)</h1><h1>â—† ç¬¬1ç«  ä»£è¯‘åºï¼ˆ1ï¼‰</h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223552038.png" class="" title="image-20211226223552038"><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223608691.png" class="" title="image-20211226223608691"><h1>â—† ç¬¬2ç«  ä»£è¯‘åºï¼ˆ2)</h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223638567.png" class="" title="image-20211226223638567"><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223649762.png" class="" title="image-20211226223649762"><h1>â—† ç¬¬3ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223701777.png" class="" title="image-20211226223701777"><h1>â—† ç¬¬4ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223713648.png" class="" title="image-20211226223713648"><h1>â—† ç¬¬5ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223727079.png" class="" title="image-20211226223727079"><h1>â—† ç¬¬6ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223745653.png" class="" title="image-20211226223745653"><h1>â—† ç¬¬7ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223801831.png" class="" title="image-20211226223801831"><h1>â—† ç¬¬8ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223813364.png" class="" title="image-20211226223813364"><h1>â—† ç¬¬9ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223824104.png" class="" title="image-20211226223824104"><h1>â—† ç¬¬10ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223834238.png" class="" title="image-20211226223834238"><h1>â—† ç¬¬12ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223844302.png" class="" title="image-20211226223844302"><h1>â—† ç¬¬17ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223855249.png" class="" title="image-20211226223855249"><h1>â—† ç¬¬18ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223906178.png" class="" title="image-20211226223906178"><h1>â—† ç¬¬19ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223917216.png" class="" title="image-20211226223917216"><h1>â—† ç¬¬20ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226223951380.png" class="" title="image-20211226223951380"><h1>â—† ç¬¬24ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224003029.png" class="" title="image-20211226224003029"><h1>â—† ç¬¬25ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224014321.png" class="" title="image-20211226224014321"><h1>â—† ç¬¬26ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224036379.png" class="" title="image-20211226224036379"><h1>â—† ç¬¬27ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224045960.png" class="" title="image-20211226224045960"><h1>â—† ç¬¬30ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224056698.png" class="" title="image-20211226224056698"><h1>â—† ç¬¬31ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224106728.png" class="" title="image-20211226224106728"><h1>â—† ç¬¬33ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224116825.png" class="" title="image-20211226224116825"><h1>â—† ç¬¬34ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224126126.png" class="" title="image-20211226224126126"><h1>â—† ç¬¬35ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224135131.png" class="" title="image-20211226224135131"><h1>â—† ç¬¬37ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224144663.png" class="" title="image-20211226224144663"><h1>â—† ç¬¬38ç« </h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224154107.png" class="" title="image-20211226224154107"><h1>â—† ç¬¬39ç«  é™„å½•ï¼ˆ1ï¼‰</h1><img src="/dajiangdahe.github.io/2021/12/26/%E3%80%90ZZ%E3%80%911984/image-20211226224204139.png" class="" title="image-20211226224204139">]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>zz</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>remote Support for password authentication was removed on August 13, 2021.</title>
    <link href="/dajiangdahe/2021/12/16/remote:%20Support%20for%20password%20authentication%20was%20removed%20on%20August%2013,%202021./"/>
    <url>/dajiangdahe/2021/12/16/remote:%20Support%20for%20password%20authentication%20was%20removed%20on%20August%2013,%202021./</url>
    
    <content type="html"><![CDATA[<h1>remote: Support for password authentication was removed on August 13, 2021.</h1><p><a href="https://blog.csdn.net/weixin_41010198/article/details/119698015">https://blog.csdn.net/weixin_41010198/article/details/119698015</a></p>]]></content>
    
    
    <categories>
      
      <category>github</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gitHub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxå¼€æœºæœåŠ¡è‡ªå¯åŠ¨é—®é¢˜</title>
    <link href="/dajiangdahe/2021/12/10/Linux%E5%BC%80%E6%9C%BA%E6%9C%8D%E5%8A%A1%E8%87%AA%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98/"/>
    <url>/dajiangdahe/2021/12/10/Linux%E5%BC%80%E6%9C%BA%E6%9C%8D%E5%8A%A1%E8%87%AA%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>Linuxç³»ç»Ÿä¸‹æœåŠ¡å¼€æœºè‡ªå¯åŠ¨è„šæœ¬åŸºæœ¬ä¸‰ä¸ªæ­¥éª¤</p><ol><li>åœ¨åˆå§‹åŒ–ç›®å½•ä¸‹åˆ›å»º <code>/etc/init.d/xxx-service</code>æ–‡ä»¶</li><li>åœ¨æ–‡ä»¶ä¸­åŠ å…¥å¯¹åº”çš„ç¯å¢ƒå˜é‡ä»¥åŠcaseå¯¹åº”çš„å¯åŠ¨å‘½ä»¤å†…å®¹</li><li>å¢åŠ æ–‡ä»¶æƒé™ï¼Œå»ºè®®é€‰æ‹©<code>chmod 775 xxx-service</code></li><li>ä½¿ç”¨<code>chkconfig</code>or <code>sysv-rc-conf</code> <code>xxx-service on</code></li><li>ä½¿ç”¨<code>ps -ef | grep -i xxx-service</code>æŸ¥è¯¢å¯¹åº”æœåŠ¡è¿›ç¨‹çŠ¶æ€</li></ol><h1>1.tomcatæœåŠ¡å¼€æœºè‡ªå¯åŠ¨</h1><p>æ²¡æœ‰<code>tomcat</code>ï¼Œ<code>jdk</code>éœ€è¦ä¸‹ä¸€ä¸ª</p><p>é…ç½®<code>/etc/profile</code>æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">unset i<br>unset -f pathmunge<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">JAVA_HOME</span>=/jdkè·¯å¾„/jdk1.8.0_221<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">JRE_HOME</span>=<span class="hljs-variable">$&#123;JAVA_HOME&#125;</span>/jre<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CATALINA_HOME</span>=/tomcatè·¯å¾„/tomcat8<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CLASSPATH</span>=.:$&#123;JAVA_HOME&#125;/lib:<span class="hljs-variable">$&#123;JRE_HOME&#125;</span>/lib:<span class="hljs-variable">$CLASSPATH</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">JAVA_PATH</span>=<span class="hljs-variable">$&#123;JAVA_HOME&#125;</span>/bin:$&#123;JRE_HOME&#125;/bin:<span class="hljs-variable">$&#123;CATALINA_HOME&#125;</span>/bin<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$PATH</span>:$&#123;JAVA_PATH&#125;:<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure><p>ç¼–è¾‘å®Œæˆä¹‹åä½¿ç”¨å‘½ä»¤è¿›è¡Œåˆ·æ–°ç¯å¢ƒå˜é‡</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">source</span> <span class="hljs-regexp">/etc/</span>profile<br></code></pre></td></tr></table></figure><p>åœ¨ tomcat/bin ç›®å½•ä¸‹é¢ï¼Œå¢åŠ  <a href="http://setenv.sh">setenv.sh</a> é…ç½®ï¼ŒæœåŠ¡å¯åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨ï¼ŒåŒæ—¶é…ç½®javaå†…å­˜å‚æ•°ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/tomcat/</span>bin/setenv.sh <span class="hljs-comment"># è‡ªå·±è·¯å¾„</span><br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment">#add tomcat pid  </span><br><span class="hljs-attr">CATALINA_PID</span>=<span class="hljs-string">&quot;$CATALINA_BASE/tomcat.pid&quot;</span>  <br><span class="hljs-comment">#add java opts  </span><br><span class="hljs-attr">JAVA_OPTS</span>=<span class="hljs-string">&quot;-server -XX:PermSize=256M -XX:MaxPermSize=1024m -Xms512M -Xmx1024M -XX:MaxNewSize=256m&quot;</span> <br></code></pre></td></tr></table></figure><p>å¢åŠ tomcat.serviceï¼Œåœ¨/usr/lib/systemd/systemç›®å½•ä¸‹å¢åŠ tomcat.service</p><p>è¾“å…¥å‘½ä»¤ç¼–è¾‘ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vi <span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/systemd/</span>system/tomcat.service<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=Apache Tomcat Web Application Container<br><span class="hljs-attr">After</span>=syslog.target network.target remote-fs.target nss-lookup.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Type</span>=forking<br><span class="hljs-attr">Environment</span>=<span class="hljs-string">&#x27;JAVA_HOME=/usr/local/java/jdk1.8.0_221/&#x27;</span><br><span class="hljs-attr">Environment</span>=<span class="hljs-string">&#x27;CATALINA_PID=/usr/local/tomcat/tomcat.pid&#x27;</span><br><span class="hljs-attr">Environment</span>=<span class="hljs-string">&#x27;CATALINA_HOME=/usr/local/tomcat/&#x27;</span><br><span class="hljs-attr">Environment</span>=<span class="hljs-string">&#x27;CATALINA_BASE=/usr/local/tomcat/&#x27;</span><br><span class="hljs-attr">Environment</span>=<span class="hljs-string">&#x27;CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC&#x27;</span><br><br><span class="hljs-attr">PIDFile</span>=/usr/local/tomcat/tomcat.pid<br><span class="hljs-attr">ExecStart</span>=/usr/local/tomcat/bin/startup.sh<br><span class="hljs-attr">ExecReload</span>=/bin/kill -s HUP <span class="hljs-variable">$MAINPID</span><br><span class="hljs-attr">ExecStop</span>=/bin/kill -s QUIT <span class="hljs-variable">$MAINPID</span><br><span class="hljs-attr">PrivateTmp</span>=<span class="hljs-literal">true</span><br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p>[unit]é…ç½®äº†æœåŠ¡çš„æè¿°ï¼Œè§„å®šäº†åœ¨networkå¯åŠ¨ä¹‹åæ‰§è¡Œã€‚</p><p>[service]é…ç½®äº†ç¯å¢ƒå˜é‡ï¼ŒJAVA_HOMEï¼ŒæœåŠ¡çš„pidï¼ŒæœåŠ¡çš„å¯åŠ¨ï¼Œåœæ­¢ï¼Œé‡å¯ï¼Œå†…å­˜å‚æ•°ã€‚</p><p>[install]é…ç½®äº†ä½¿ç”¨ç”¨æˆ·ã€‚</p><p>å½“éœ€è¦å¯åŠ¨å¤šä¸ªtomcatæ—¶ï¼Œå¤åˆ¶å¤šä¸ªtomcatå®‰è£…æ–‡ä»¶åœ¨/usr/local/ä¸‹ï¼Œå¦‚/usr/local/tomcat2ï¼Œå¹¶é…ç½®å¤šä¸ªtomcat.service å¦‚tomcat2.serviceï¼Œtomcat3.service åœ¨é…ç½®ä¸­ä¿®æ”¹å¯¹åº”çš„è·¯å¾„å³å¯ã€‚</p><p>å› ä¸ºé…ç½®pidï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šåœ¨tomcatæ ¹ç›®å½•ç”Ÿæˆtomcat.pidæ–‡ä»¶ï¼Œåœæ­¢ä¹‹ååˆ é™¤ã€‚</p><p>åŒæ—¶tomcatåœ¨å¯åŠ¨æ—¶å€™ï¼Œæ‰§è¡Œstartä¸ä¼šå¯åŠ¨ä¸¤ä¸ªtomcatï¼Œä¿è¯å§‹ç»ˆåªæœ‰ä¸€ä¸ªtomcatæœåŠ¡åœ¨è¿è¡Œã€‚</p><p>å¤šä¸ªtomcatå¯ä»¥é…ç½®åœ¨å¤šä¸ªç›®å½•ä¸‹ï¼Œä½¿ç”¨ä¸åŒçš„ç«¯å£ï¼Œäº’ä¸å½±å“ã€‚</p><p>ç§»åŠ¨åˆ°<code>tomcat/bin</code>ç›®å½•</p><p>1.ç¼–å†™å¼€æœºè‡ªå¯åŠ¨è„šæœ¬</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo gedit <span class="hljs-regexp">/etc/i</span>nit.d/tomcat<br></code></pre></td></tr></table></figure><p>2.è„šæœ¬å†…å®¹</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#!/bin/sh -e</span><br><span class="hljs-comment">### BEGIN TOMCAT SERVICE</span><br><span class="hljs-comment">### END INIT INFO</span><br> <br>export JAVA_HOME=<span class="hljs-regexp">/jdkè·¯å¾„/</span>jdk1.<span class="hljs-number">8.0</span><br>export JRE_HOME=<span class="hljs-variable">$JAVA_HOME</span>/jre<br>export PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin<br>export CLASSPATH=. <span class="hljs-comment"># ä»/etc/profileé‡Œé¢å¯ä»¥å¤åˆ¶</span><br>export CATALINA_HOME=<span class="hljs-regexp">/tomcatè·¯å¾„/</span>tomcat<br> <br>case <span class="hljs-string">&quot;$1&quot;</span> <span class="hljs-keyword">in</span><br>start)<br>        <span class="hljs-variable">$&#123;CATALINA_HOME&#125;</span><span class="hljs-regexp">/bin/</span>startup.sh<br>        <span class="hljs-keyword">exit</span> <span class="hljs-number">0</span><br>        ;;<br>stop)<br>        <span class="hljs-variable">$&#123;CATALINA_HOME&#125;</span><span class="hljs-regexp">/bin/</span>shutdown.sh<br>        <span class="hljs-keyword">exit</span> <span class="hljs-number">0</span><br>        ;;<br>debug)<br>        <span class="hljs-variable">$&#123;CATALINA_HOME&#125;</span><span class="hljs-regexp">/bin/</span>shutdown.sh<br>        <span class="hljs-variable">$&#123;CATALINA_HOME&#125;</span><span class="hljs-regexp">/bin/</span>catalina.sh run<br>        <span class="hljs-keyword">exit</span> <span class="hljs-number">0</span><br>        ;;<br>force-reload|restart)<br>        <span class="hljs-variable">$&#123;CATALINA_HOME&#125;</span><span class="hljs-regexp">/bin/</span>startup.sh<br>        <span class="hljs-variable">$&#123;CATALINA_HOME&#125;</span><span class="hljs-regexp">/bin/</span>shutdown.sh<br>        <span class="hljs-keyword">exit</span> <span class="hljs-number">0</span><br>        ;;<br> <br>*)<br>        echo <span class="hljs-string">&quot;Usage: /etc/init.d/tomcat &#123;start|stop|restart|force-reload|debug&#125;&quot;</span><br>        <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span><br>        ;;<br>esac<br> <br><span class="hljs-keyword">exit</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå°±å¯ä»¥é€šè¿‡<code>service tomcat start </code>æ¥å¯åŠ¨<code>tomcat</code>äº†ã€‚</p><p>3.è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ï¼ˆåœ¨<code>ubuntu</code>ç³»ç»Ÿä¸­ä½¿ç”¨<code>sysv-rc-conf</code>ä»£æ›¿<code>chkconfig</code>ï¼‰</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">chkconfig</span> tomcat <span class="hljs-literal">on</span><br></code></pre></td></tr></table></figure><p>4.æŸ¥è¯¢<code>tomcat</code>è¿›ç¨‹çŠ¶æ€</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">ps</span> -ef | <span class="hljs-keyword">grep</span> -i tomcat<br></code></pre></td></tr></table></figure><h2 id="JDKå®‰è£…è¿‡ç¨‹">JDKå®‰è£…è¿‡ç¨‹</h2><p>ä¸‹è½½<code>jdk</code>å¯¹åº”å®‰è£…åŒ…</p><p>è§£å‹åˆ°è‡ªé€‰ç›®å½•</p><p>ç¼–è¾‘ç¯å¢ƒå˜é‡</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo gedit <span class="hljs-regexp">/etc/</span>profile<br></code></pre></td></tr></table></figure><p>å¯¼å…¥ä¿¡æ¯</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">JAVA_HOME</span>=/usr/java/jdk1.8.0_131 #è‡ªå·±çš„jdkè·¯å¾„<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">JRE_HOME</span>=<span class="hljs-variable">$&#123;JAVA_HOME&#125;</span>/jre<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CLASSPATH</span>=.:$&#123;JAVA_HOME&#125;/lib:<span class="hljs-variable">$&#123;JRE_HOME&#125;</span>/lib:<span class="hljs-variable">$CLASSPATH</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">JAVA_PATH</span>=<span class="hljs-variable">$&#123;JAVA_HOME&#125;</span>/bin:$&#123;JRE_HOME&#125;/bin<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$PATH</span>:$&#123;JAVA_PATH&#125;<br></code></pre></td></tr></table></figure><p>æ›´æ–°ç¯å¢ƒå˜é‡æ–‡ä»¶</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">source</span> <span class="hljs-regexp">/etc/</span>profile<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹javaç‰ˆæœ¬</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">java <span class="hljs-comment">--version</span><br></code></pre></td></tr></table></figure><h1>2.redisæœåŠ¡å¼€æœºè‡ªå¯åŠ¨</h1><p>1ã€è®¾ç½®<code>redis.conf</code>ä¸­<code>daemonize</code>ä¸º<code>yes</code>,ç¡®ä¿å®ˆæŠ¤è¿›ç¨‹å¼€å¯ã€‚</p><p>2ã€ç¼–å†™å¼€æœºè‡ªå¯åŠ¨è„šæœ¬</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo cp <span class="hljs-regexp">/redisè·¯å¾„/u</span>tils<span class="hljs-regexp">/redis_init_script /</span>etc<span class="hljs-regexp">/init.d/</span>redis<br></code></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># chkconfig: 2345 10 90  </span><br><span class="hljs-comment"># description: Start and Stop redis   </span><br>  <br>PATH=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin:/</span>sbin:<span class="hljs-regexp">/usr/</span>bin:/bin   <br>REDISPORT=<span class="hljs-number">6379</span>  <br>EXEC=<span class="hljs-regexp">/redisè·¯å¾„/</span>redis-server   <br>REDIS_CLI=<span class="hljs-regexp">/redisè·¯å¾„/</span>redis-cli   <br> <br>PIDFILE=<span class="hljs-regexp">/var/</span>run/redis.pid   <br>CONF=<span class="hljs-string">&quot;/redisè·¯å¾„/redis.conf&quot;</span>  <br>AUTH=<span class="hljs-string">&quot;1234&quot;</span>  <br><br>case <span class="hljs-string">&quot;$1&quot;</span> <span class="hljs-keyword">in</span>   <br>        start)   <br>                <span class="hljs-keyword">if</span> [ -f <span class="hljs-variable">$PIDFILE</span> ]   <br>                then   <br>                        echo <span class="hljs-string">&quot;$PIDFILE exists, process is already running or crashed.&quot;</span>  <br>                <span class="hljs-keyword">else</span>  <br>                        echo <span class="hljs-string">&quot;Starting Redis server...&quot;</span>  <br>                        <span class="hljs-variable">$EXEC</span> <span class="hljs-variable">$CONF</span>   <br>                fi   <br>                <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;$?&quot;</span>=<span class="hljs-string">&quot;0&quot;</span> ]   <br>                then   <br>                        echo <span class="hljs-string">&quot;Redis is running...&quot;</span>  <br>                fi   <br>                ;;   <br>        stop)   <br>                <span class="hljs-keyword">if</span> [ ! -f <span class="hljs-variable">$PIDFILE</span> ]   <br>                then   <br>                        echo <span class="hljs-string">&quot;$PIDFILE exists, process is not running.&quot;</span>  <br>                <span class="hljs-keyword">else</span>  <br>                        PID=$(cat <span class="hljs-variable">$PIDFILE</span>)   <br>                        echo <span class="hljs-string">&quot;Stopping...&quot;</span>  <br>                       <span class="hljs-variable">$REDIS_CLI</span> -p <span class="hljs-variable">$REDISPORT</span>  SHUTDOWN    <br>                        sleep <span class="hljs-number">2</span>  <br>                       <span class="hljs-keyword">while</span> [ -x <span class="hljs-variable">$PIDFILE</span> ]   <br>                       <span class="hljs-keyword">do</span>  <br>                                echo <span class="hljs-string">&quot;Waiting for Redis to shutdown...&quot;</span>  <br>                               sleep <span class="hljs-number">1</span>  <br>                        done   <br>                        echo <span class="hljs-string">&quot;Redis stopped&quot;</span>  <br>                fi   <br>                ;;   <br>        restart|force-reload)   <br>                <span class="hljs-variable">$&#123;0&#125;</span> stop   <br>                <span class="hljs-variable">$&#123;0&#125;</span> start   <br>                ;;   <br>        *)   <br>               echo <span class="hljs-string">&quot;Usage: /etc/init.d/redis &#123;start|stop|restart|force-reload&#125;&quot;</span> &gt;&amp;<span class="hljs-number">2</span>  <br>                <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>  <br>esac<br></code></pre></td></tr></table></figure><p>3ã€å†™å®Œåä¿å­˜é€€å‡ºVI</p><p>4ã€è®¾ç½®æƒé™</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">chmod</span> <span class="hljs-number">777</span> redis<br></code></pre></td></tr></table></figure><p>5ã€å¯åŠ¨æµ‹è¯•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/etc/i</span>nit.d/redis start<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æˆåŠŸä¼šæç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-function"><span class="hljs-title">Starting</span></span> Redis server...<br><span class="hljs-function"><span class="hljs-title">Redis</span></span> is running...<br></code></pre></td></tr></table></figure><p>6ã€è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ï¼ˆåœ¨ubuntuç³»ç»Ÿä¸­ä½¿ç”¨sysv-rc-confä»£æ›¿chkconfigï¼‰</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">chkconfig</span> redis <span class="hljs-literal">on</span><br></code></pre></td></tr></table></figure><p>7ã€å…³æœºé‡å¯æµ‹è¯•</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">reboot</span><br></code></pre></td></tr></table></figure><p>8ã€<code>redis-cli</code>æµ‹è¯•å³å¯ã€‚</p><p>9ã€æŸ¥è¯¢<code>redis</code>è¿›ç¨‹çŠ¶æ€</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">ps</span> -ef | <span class="hljs-keyword">grep</span> -i redis<br></code></pre></td></tr></table></figure><h2 id="makeå®‰è£…è¿‡ç¨‹">makeå®‰è£…è¿‡ç¨‹</h2><p>éœ€è¦å…ˆæ‰§è¡Œ</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cd</span> redis-<span class="hljs-number">3</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5</span><br><span class="hljs-attribute">make</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰<code>make</code>åŒ…</p><p>ä¸¤ç§ä¸‹è½½æ–¹å¼ï¼š</p><ol><li><p>æœ‰ç½‘çŠ¶æ€</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum -y <span class="hljs-keyword">install</span> make<br></code></pre></td></tr></table></figure></li><li><p>é™é»˜çŠ¶æ€</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ç‚¹å‡»æ­¤é“¾æ¥ http:<span class="hljs-regexp">//</span>ftp.gnu.org<span class="hljs-regexp">/gnu/m</span>ake/make-<span class="hljs-number">4.2</span>.tar.gzä¸‹è½½makeå®‰è£…åŒ…<br></code></pre></td></tr></table></figure></li></ol><p>å°†<code>make</code>å®‰è£…åŒ…ç§»æ¤åˆ°Linuxç³»ç»Ÿè§£å‹å®‰è£…åŒ…</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">tar -zxvf <span class="hljs-built_in">make</span><span class="hljs-number">-4.2</span>.tar.gz -C /usr/<span class="hljs-keyword">local</span>/<span class="hljs-built_in">make</span><br></code></pre></td></tr></table></figure><p>è¿›å…¥åˆ°è§£å‹åçš„ç›®å½•é‡Œæ‰§è¡Œ<code>./configure</code>å‘½ä»¤</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">./configure</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>/usr/local/make/make-4.2</code>ç›®å½•ä¸‹æ‰§è¡Œmakeå‘½ä»¤</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>/usr/local/make/</code>ç›®å½•ä¸‹æ‰§è¡Œ<code>make install</code>å‘½ä»¤</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">make <span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure><p>è¾“å…¥makeå¯ä»¥è¿›è¡Œæºç åŒ…ç¼–è¯‘</p><h1>3.oracleæœåŠ¡å¼€æœºè‡ªå¯åŠ¨</h1><p>1.ä»¥rootèº«ä»½ç™»å½•åˆ°linuxç³»ç»Ÿ</p><p>ç¼–è¾‘<code>/etc/oratab</code>æ–‡ä»¶ï¼Œæ‰¾åˆ°ï¼ˆRed hadå’ŒCentos 7ç¦æ­¢oracleå¯åŠ¨ï¼‰</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">testsid</span>:/data/oracle/product/<span class="hljs-number">11</span>.<span class="hljs-number">2</span>.<span class="hljs-number">0</span>/db_<span class="hljs-number">1</span>:N<br></code></pre></td></tr></table></figure><p>æ”¹ä¸º</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">testsid</span>:/data/oracle/product/<span class="hljs-number">11</span>.<span class="hljs-number">2</span>.<span class="hljs-number">0</span>/db_<span class="hljs-number">1</span>:Y<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<code>/data/oracle/product/11.2.0/db_1</code>ä¸ºå®‰è£…çš„<code>$ORACLE_HOME</code>ï¼Œæ ¹æ®æƒ…å†µè‡ªè¡Œä¿®æ”¹è·¯å¾„ã€‚</p><p>2.é…ç½®<code>/etc/rc.d/rc.local</code>,å…¶ä¸­è·¯å¾„æ›¿æ¢æˆè‡ªå·±çš„ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>rc.d/rc.local<br><br><span class="hljs-comment"># æ·»åŠ è„šæœ¬å†…å®¹</span><br>su oracle -lc <span class="hljs-string">&quot;/data/oracle/product/11.2.0/db_1/bin/lsnrctl start&quot;</span><br>su oracle -lc <span class="hljs-regexp">/data/</span>oracle<span class="hljs-regexp">/product/</span><span class="hljs-number">11.2</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/db_1/</span>bin/dbstart<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ç¬¬ä¸€è¡Œå› ä¸ºlsnrctlä¹‹åæœ‰ç©ºæ ¼ï¼Œéœ€è¦å¼•å·ï¼Œç¬¬äºŒè¡ŒåŠ ä¸åŠ å¼•å·éƒ½å¯ä»¥ã€‚ä¿®æ”¹å®Œä¿å­˜é€€å‡ºå³å¯ã€‚</p><img src="/dajiangdahe.github.io/2021/12/10/Linux%E5%BC%80%E6%9C%BA%E6%9C%8D%E5%8A%A1%E8%87%AA%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98/image-20211211184913364.png" class="" title="image-20211211184913364"><p>3.åœ¨<code>/etc/init.d/</code>ä¸‹åˆ›å»ºoracleæœåŠ¡å¯åŠ¨è„šæœ¬</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#!/bin/sh</span><br><span class="hljs-comment"># chkconfig: 345 61 61</span><br><span class="hljs-comment"># description: Oracle 11g R2 AutoRun Servimces</span><br><span class="hljs-comment"># /etc/init.d/oracle</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Run-level Startup script for the Oracle Instance, Listener, and</span><br><span class="hljs-comment"># Web Interface</span><br>export ORACLE_BASE=<span class="hljs-regexp">/data/</span>oracle    <span class="hljs-comment">#æ ¹æ®ä¸ªäººæƒ…å†µä¿®æ”¹è·¯å¾„</span><br>export ORACLE_HOME=<span class="hljs-variable">$ORACLE_BASE</span><span class="hljs-regexp">/product/</span><span class="hljs-number">11.2</span>.<span class="hljs-number">0</span>/db_1<br>export ORACLE_SID=testsid          <span class="hljs-comment">#æ”¹æˆè‡ªå·±çš„ORACLE_SID:testsid</span><br>export PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ORACLE_HOME</span>/bin<br>ORA_OWNR=<span class="hljs-string">&quot;oracle&quot;</span><br><span class="hljs-comment"># if the executables do not exist -- display error</span><br><span class="hljs-keyword">if</span> [ ! -f <span class="hljs-variable">$ORACLE_HOME</span><span class="hljs-regexp">/bin/</span>dbstart -o ! -d <span class="hljs-variable">$ORACLE_HOME</span> ]<br>then<br>echo <span class="hljs-string">&quot;Oracle startup: cannot start&quot;</span><br><span class="hljs-keyword">exit</span> <span class="hljs-number">1</span><br>fi<br><span class="hljs-comment"># depending on parameter -- startup, shutdown, restart</span><br><span class="hljs-comment"># of the instance and listener or usage display</span><br>case <span class="hljs-string">&quot;$1&quot;</span> <span class="hljs-keyword">in</span><br>start)<br><span class="hljs-comment"># Oracle listener and instance startup</span><br>su <span class="hljs-variable">$ORA_OWNR</span> -lc <span class="hljs-variable">$ORACLE_HOME</span><span class="hljs-regexp">/bin/</span>dbstart<br>echo <span class="hljs-string">&quot;Oracle Start Succesful!OK.&quot;</span><br>;;<br>stop)<br><span class="hljs-comment"># Oracle listener and instance shutdown</span><br>su <span class="hljs-variable">$ORA_OWNR</span> -lc <span class="hljs-variable">$ORACLE_HOME</span><span class="hljs-regexp">/bin/</span>dbshut<br>echo <span class="hljs-string">&quot;Oracle Stop Succesful!OK.&quot;</span><br>;;<br>reload|restart)<br><span class="hljs-variable">$0</span> stop<br><span class="hljs-variable">$0</span> start<br>;;<br>*)<br>echo $<span class="hljs-string">&quot;Usage: `basename $0` &#123;start|stop|reload|reload&#125;&quot;</span><br><span class="hljs-keyword">exit</span> <span class="hljs-number">1</span><br>esac<br><span class="hljs-keyword">exit</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>4.èµ‹äºˆæƒé™</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">chmod <span class="hljs-number">777</span> <span class="hljs-regexp">/etc/i</span>nit.d/oracle<br></code></pre></td></tr></table></figure><p>5.é…ç½®Oracleç›‘å¬å¼€æœºè‡ªå¯åŠ¨æœåŠ¡</p><p>ä¿®æ”¹dbstartå’Œdbshutå¯åŠ¨å…³é—­è„šæœ¬,ä½¿å…¶å¯åŠ¨æ•°æ®åº“çš„åŒæ—¶ä¹Ÿè‡ªåŠ¨å¯åŠ¨ç›‘å¬å™¨ï¼ˆå³å¯åŠ¨æ•°æ®åº“æ—¶å¯åŠ¨ç›‘å¬å™¨ï¼Œåœæ­¢æ•°æ®åº“æ—¶åœæ­¢ç›‘å¬å™¨ï¼‰ï¼š<br>æ‰§è¡Œè„šæœ¬ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gradle"># vim <span class="hljs-regexp">/data/</span>oracle<span class="hljs-regexp">/product/</span><span class="hljs-number">11.2</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/db_1/</span>bin/dbstart  # è‡ªå·±è·¯å¾„<br>æ‰¾åˆ°ä¸‹é¢çš„ä»£ç :<br>ORACLE_HOME_LISTNER=$<span class="hljs-number">1</span><br>å°†å…¶æ”¹ä¸º<br>ORACLE_HOME_LISTNER=$ORACLE_HOME<br></code></pre></td></tr></table></figure><p>Dbstartä¿®æ”¹ç»“æœï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># Set path if path not set (if called from /etc/rc)</span><br><span class="hljs-attribute">SAVE_PATH</span>=/bin:/usr/bin:/etc:$&#123;PATH&#125; ; <span class="hljs-builtin-name">export</span> PATH<br><span class="hljs-attribute">SAVE_LLP</span>=<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-comment"># First argument is used to bring up Oracle Net Listener</span><br><span class="hljs-comment">#ORACLE_HOME_LISTNER=$1</span><br><span class="hljs-attribute">ORACLE_HOME_LISTNER</span>=<span class="hljs-variable">$ORACLE_HOME</span><br><span class="hljs-keyword">if</span> [ ! <span class="hljs-variable">$ORACLE_HOME_LISTNER</span> ] ; then<br>  echo <span class="hljs-string">&quot;ORACLE_HOME_LISTNER is not SET, unable to auto-start Oracle Net Listener&quot;</span><br>  echo <span class="hljs-string">&quot;Usage: <span class="hljs-variable">$0</span> ORACLE_HOME&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-attribute">LOG</span>=<span class="hljs-variable">$ORACLE_HOME_LISTNER</span>/listener.log<br></code></pre></td></tr></table></figure><p>åŒæ ·ä¹Ÿä¿®æ”¹dbshutè„šæœ¬ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gradle"># vim <span class="hljs-regexp">/data/</span>oracle<span class="hljs-regexp">/product/</span><span class="hljs-number">11.2</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/db_1/</span>bin/dbshut # è‡ªå·±è·¯å¾„<br>æ‰¾åˆ°ä¸‹é¢çš„ä»£ç :<br>ORACLE_HOME_LISTNER=$<span class="hljs-number">1</span><br>å°†å…¶æ”¹ä¸º<br>ORACLE_HOME_LISTNER=$ORACLE_HOME<br></code></pre></td></tr></table></figure><p>Dbshutä¿®æ­£ç»“æœï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># Set path if path not set (if called from /etc/rc)</span><br><span class="hljs-attribute">SAVE_PATH</span>=/bin:/usr/bin:/etc:$&#123;PATH&#125; ; <span class="hljs-builtin-name">export</span> PATH<br><span class="hljs-attribute">SAVE_LLP</span>=<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><br><span class="hljs-comment"># The  this to bring down Oracle Net Listener</span><br><span class="hljs-comment">#ORACLE_HOME_LISTNER=$1</span><br><span class="hljs-attribute">ORACLE_HOME_LISTNER</span>=<span class="hljs-variable">$ORACLE_HOME</span><br><span class="hljs-keyword">if</span> [ ! <span class="hljs-variable">$ORACLE_HOME_LISTNER</span> ] ; then<br>  echo <span class="hljs-string">&quot;ORACLE_HOME_LISTNER is not SET, unable to auto-stop Oracle Net Listener&quot;</span><br>  echo <span class="hljs-string">&quot;Usage: <span class="hljs-variable">$0</span> ORACLE_HOME&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-attribute">LOG</span>=<span class="hljs-variable">$ORACLE_HOME_LISTNER</span>/listener.log<br></code></pre></td></tr></table></figure><p>6.å†åº¦æ‰§è¡ŒOracleæœåŠ¡è„šæœ¬</p><p>æ‰§è¡Œè„šæœ¬ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">cd</span> <span class="hljs-string">/etc/rc.d/init.d</span><br><span class="hljs-string">./oracle</span> start<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@zm-centos7 <span class="hljs-regexp">/]# cd /</span>etc<span class="hljs-regexp">/rc.d/i</span>nit.d<br>[root@zm-centos7 init.d]<span class="hljs-comment"># ./oracle start</span><br>Processing Database instance <span class="hljs-string">&quot;testsid&quot;</span>: log file <span class="hljs-regexp">/data/</span>oracle<span class="hljs-regexp">/product/</span><span class="hljs-number">11.2</span>.<span class="hljs-number">0</span><span class="hljs-regexp">/db_1/</span>startup.log<br>Oracle Start Succesful!OK.<br></code></pre></td></tr></table></figure><ol start="7"><li>åŠ å…¥è‡ªåŠ¨å¯åŠ¨è¡Œåˆ—</li></ol><p>æ‰§è¡Œè„šæœ¬ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">ln â€“s <span class="hljs-regexp">/etc/</span>rc.d<span class="hljs-regexp">/init.d/</span>oracle <span class="hljs-regexp">/etc/</span>rc0.d/K61oracle<br>ln â€“s <span class="hljs-regexp">/etc/</span>rc.d<span class="hljs-regexp">/init.d/</span>oracle <span class="hljs-regexp">/etc/</span>rc2.d/S61oracle<br>ln â€“s <span class="hljs-regexp">/etc/</span>rc.d<span class="hljs-regexp">/init.d/</span>oracle <span class="hljs-regexp">/etc/</span>rc3.d/S61oracle<br>ln â€“s <span class="hljs-regexp">/etc/</span>rc.d<span class="hljs-regexp">/init.d/</span>oracle <span class="hljs-regexp">/etc/</span>rc4.d/S61oracle<br>ln â€“s <span class="hljs-regexp">/etc/</span>rc.d<span class="hljs-regexp">/init.d/</span>oracle <span class="hljs-regexp">/etc/</span>rc6.d/K61oracle<br></code></pre></td></tr></table></figure><p>8.å°†æœåŠ¡åŠ å…¥åˆ°ç³»ç»ŸæœåŠ¡</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada">chkconfig <span class="hljs-comment">--level 234 oracle on</span><br>chkconfig <span class="hljs-comment">--add oracle</span><br></code></pre></td></tr></table></figure><p>æ£€æŸ¥ oracleæœåŠ¡æ˜¯å¦å·²ç»ç”Ÿæ•ˆ</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">chkconfig <span class="hljs-comment">--list  oracle</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æœºå¯åŠ¨æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLæ˜¯æ€æ ·è¿è¡Œçš„--å°å­©å­</title>
    <link href="/dajiangdahe/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/"/>
    <url>/dajiangdahe/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/</url>
    
    <content type="html"><![CDATA[<h1>MySQLæ˜¯æ€æ ·è¿è¡Œçš„â€“å°å­©å­</h1><p>åŸä¹¦åœ°å€ï¼š<a href="https://juejin.cn/book/6844733769996304392">https://juejin.cn/book/6844733769996304392</a></p><h1><strong>1.é‡æ–°è®¤è¯†MySQL</strong></h1><h2 id="MySQLçš„å®¢æˆ·ç«¯ï¼æœåŠ¡å™¨æ¶æ„">MySQLçš„å®¢æˆ·ç«¯ï¼æœåŠ¡å™¨æ¶æ„</h2><p>ä»¥æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„å¾®ä¿¡ä¸ºä¾‹ï¼Œå®ƒå…¶å®æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼Œä¸€éƒ¨åˆ†æ˜¯å®¢æˆ·ç«¯ç¨‹åºï¼Œä¸€éƒ¨åˆ†æ˜¯æœåŠ¡å™¨ç¨‹åºã€‚å®¢æˆ·ç«¯å¯èƒ½æœ‰å¾ˆå¤šç§å½¢å¼ï¼Œæ¯”å¦‚æ‰‹æœºAPPï¼Œç”µè„‘è½¯ä»¶æˆ–è€…æ˜¯ç½‘é¡µç‰ˆå¾®ä¿¡ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ·åï¼Œå°±æ˜¯ä½ çš„å¾®ä¿¡å·ï¼Œå¦ä¸€æ–¹é¢ï¼Œè…¾è®¯å…¬å¸åœ¨ä»–ä»¬çš„æœºæˆ¿é‡Œè¿è¡Œç€ä¸€ä¸ªæœåŠ¡å™¨è½¯ä»¶ï¼Œæˆ‘ä»¬å¹³æ—¶æ“ä½œå¾®ä¿¡å…¶å®éƒ½æ˜¯ç”¨å®¢æˆ·ç«¯æ¥å’Œè¿™ä¸ªæœåŠ¡å™¨æ¥æ‰“äº¤é“ã€‚æ¯”å¦‚ç‹—å“¥ç”¨å¾®ä¿¡ç»™çŒ«çˆ·å‘äº†ä¸€æ¡æ¶ˆæ¯çš„è¿‡ç¨‹å…¶å®æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>æ¶ˆæ¯è¢«å®¢æˆ·ç«¯åŒ…è£…äº†ä¸€ä¸‹ï¼Œæ·»åŠ äº†å‘é€è€…å’Œæ¥æ”¶è€…ä¿¡æ¯ï¼Œç„¶åä»ç‹—å“¥çš„å¾®ä¿¡å®¢æˆ·ç«¯ä¼ é€ç»™å¾®ä¿¡æœåŠ¡å™¨ï¼›</li><li>å¾®ä¿¡æœåŠ¡å™¨ä»æ¶ˆæ¯é‡Œè·å–åˆ°å®ƒçš„å‘é€è€…å’Œæ¥æ”¶è€…ï¼Œæ ¹æ®æ¶ˆæ¯çš„æ¥æ”¶è€…ä¿¡æ¯æŠŠè¿™æ¡æ¶ˆæ¯é€è¾¾åˆ°çŒ«çˆ·çš„å¾®ä¿¡å®¢æˆ·ç«¯ï¼ŒçŒ«çˆ·çš„å¾®ä¿¡å®¢æˆ·ç«¯é‡Œå°±æ˜¾ç¤ºå‡ºç‹—å“¥ç»™ä»–å‘äº†ä¸€æ¡æ¶ˆæ¯ã€‚</li></ol><p><code>MySQL</code>çš„ä½¿ç”¨è¿‡ç¨‹è·Ÿè¿™ä¸ªæ˜¯ä¸€æ ·çš„ï¼Œå®ƒçš„æœåŠ¡å™¨ç¨‹åºç›´æ¥å’Œæˆ‘ä»¬å­˜å‚¨çš„æ•°æ®æ‰“äº¤é“ï¼Œç„¶åå¯ä»¥æœ‰å¥½å¤šå®¢æˆ·ç«¯ç¨‹åºè¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨ç¨‹åºï¼Œå‘é€å¢åˆ æ”¹æŸ¥çš„è¯·æ±‚ï¼Œç„¶åæœåŠ¡å™¨å°±å“åº”è¿™äº›è¯·æ±‚ï¼Œä»è€Œæ“ä½œå®ƒç»´æŠ¤çš„æ•°æ®ã€‚å’Œå¾®ä¿¡ä¸€æ ·ï¼Œ<code>MySQL</code>çš„æ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦æä¾›ç”¨æˆ·åå¯†ç æ‰èƒ½ç™»å½•ï¼Œç™»å½•ä¹‹åæ‰èƒ½ç»™æœåŠ¡å™¨å‘è¯·æ±‚æ¥æ“ä½œæŸäº›æ•°æ®ã€‚æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨<code>MySQL</code>çš„æƒ…æ™¯ä¸€èˆ¬æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>å¯åŠ¨<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºã€‚</li><li>å¯åŠ¨<code>MySQL</code>å®¢æˆ·ç«¯ç¨‹åºå¹¶è¿æ¥åˆ°æœåŠ¡å™¨ç¨‹åºã€‚</li><li>åœ¨å®¢æˆ·ç«¯ç¨‹åºä¸­è¾“å…¥ä¸€äº›å‘½ä»¤è¯­å¥ä½œä¸ºè¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ç¨‹åºï¼ŒæœåŠ¡å™¨ç¨‹åºæ”¶åˆ°è¿™äº›è¯·æ±‚åï¼Œä¼šæ ¹æ®è¯·æ±‚çš„å†…å®¹æ¥æ“ä½œå…·ä½“çš„æ•°æ®å¹¶å‘å®¢æˆ·ç«¯è¿”å›æ“ä½œç»“æœã€‚</li></ol><p>æˆ‘ä»¬çŸ¥é“è®¡ç®—æœºå¾ˆç‰›é€¼ï¼Œåœ¨ä¸€å°è®¡ç®—æœºä¸Šå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºï¼Œæ¯”å¦‚å¾®ä¿¡ã€QQã€éŸ³ä¹æ’­æ”¾å™¨ã€æ–‡æœ¬ç¼–è¾‘å™¨å•¥çš„ï¼Œæ¯ä¸€ä¸ªè¿è¡Œç€çš„ç¨‹åºä¹Ÿè¢«ç§°ä¸ºä¸€ä¸ª<code>è¿›ç¨‹</code>ã€‚æˆ‘ä»¬çš„<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºå’Œå®¢æˆ·ç«¯ç¨‹åºæœ¬è´¨ä¸Šéƒ½ç®—æ˜¯è®¡ç®—æœºä¸Šçš„ä¸€ä¸ª<code>è¿›ç¨‹</code>ï¼Œè¿™ä¸ªä»£è¡¨ç€<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºçš„è¿›ç¨‹ä¹Ÿè¢«ç§°ä¸º<code>MySQLæ•°æ®åº“å®ä¾‹</code>ï¼Œç®€ç§°<code>æ•°æ®åº“å®ä¾‹</code>ã€‚</p><p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ï¼Œç§°ä¸º<code>è¿›ç¨‹ID</code>ï¼Œè‹±æ–‡åå«<code>PID</code>ï¼Œè¿™ä¸ªç¼–å·æ˜¯åœ¨æˆ‘ä»¬å¯åŠ¨ç¨‹åºçš„æ—¶å€™ç”±æ“ä½œç³»ç»Ÿéšæœºåˆ†é…çš„ï¼Œæ“ä½œç³»ç»Ÿä¼šä¿è¯åœ¨æŸä¸€æ—¶åˆ»åŒä¸€å°æœºå™¨ä¸Šçš„è¿›ç¨‹å·ä¸é‡å¤ã€‚æ¯”å¦‚ä½ æ‰“å¼€äº†è®¡ç®—æœºä¸­çš„QQç¨‹åºï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿä¼šä¸ºå®ƒåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¿›ç¨‹å·ï¼Œå¦‚æœä½ æŠŠè¿™ä¸ªç¨‹åºå…³æ‰äº†ï¼Œé‚£æ“ä½œç³»ç»Ÿå°±ä¼šæŠŠè¿™ä¸ªè¿›ç¨‹å·å›æ”¶ï¼Œä¹‹åå¯èƒ½ä¼šé‡æ–°åˆ†é…ç»™åˆ«çš„è¿›ç¨‹ã€‚å½“æˆ‘ä»¬ä¸‹ä¸€æ¬¡å†å¯åŠ¨ QQç¨‹åºçš„æ—¶å€™åˆ†é…çš„å°±å¯èƒ½æ˜¯å¦ä¸€ä¸ªç¼–å·ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªåç§°ï¼Œè¿™ä¸ªåç§°æ˜¯ç¼–å†™ç¨‹åºçš„äººè‡ªå·±å®šä¹‰çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯åŠ¨çš„<code>MySQL</code>æœåŠ¡å™¨è¿›ç¨‹çš„é»˜è®¤åç§°ä¸º<code>mysqld</code>ï¼Œ è€Œæˆ‘ä»¬å¸¸ç”¨çš„<code>MySQL</code>å®¢æˆ·ç«¯è¿›ç¨‹çš„é»˜è®¤åç§°ä¸º<code>mysql</code>ã€‚</p><h2 id="MySQLçš„å®‰è£…">MySQLçš„å®‰è£…</h2><p>ä¸è®ºæˆ‘ä»¬é€šè¿‡ä¸‹è½½æºä»£ç è‡ªè¡Œç¼–è¯‘å®‰è£…çš„æ–¹å¼è¿˜æ˜¯ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„å®‰è£…åŒ…è¿›è¡Œå®‰è£…ä¹‹åï¼Œ<code>MySQL</code>çš„æœåŠ¡å™¨ç¨‹åºå’Œå®¢æˆ·ç«¯ç¨‹åºéƒ½ä¼šè¢«å®‰è£…åˆ°æˆ‘ä»¬çš„æœºå™¨ä¸Šã€‚ä¸è®ºä½¿ç”¨ä¸Šè¿°ä¸¤è€…çš„å“ªç§å®‰è£…æ–¹å¼ï¼Œä¸€å®šä¸€å®šä¸€å®šï¼ˆé‡è¦çš„è¯è¯´ä¸‰éï¼‰è¦è®°ä½ä½ æŠŠ<code>MySQL</code>å®‰è£…åˆ°å“ªäº†ï¼Œæ¢å¥è¯è¯´ï¼Œä¸€å®šè¦è®°ä½<code>MySQL</code>çš„å®‰è£…ç›®å½•ã€‚</p><blockquote><p>å°è´´å£«ï¼š <code>MySQL</code>çš„å¤§éƒ¨åˆ†å®‰è£…åŒ…éƒ½åŒ…å«äº†æœåŠ¡å™¨ç¨‹åºå’Œå®¢æˆ·ç«¯ç¨‹åºï¼Œä¸è¿‡åœ¨Linuxä¸‹ä½¿ç”¨RPMåŒ…æ—¶ä¼šæœ‰å•ç‹¬çš„æœåŠ¡å™¨RPMåŒ…å’Œå®¢æˆ·ç«¯RPMåŒ…ï¼Œéœ€è¦åˆ†åˆ«å®‰è£…ã€‚</p></blockquote><p>å¦å¤–ï¼Œ<code>MySQL</code>å¯ä»¥è¿è¡Œåœ¨å„ç§å„æ ·çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œæˆ‘ä»¬åè¾¹ä¼šè®¨è®ºåœ¨ç±»<code>UNIX</code>æ“ä½œç³»ç»Ÿå’Œ<code>Windows</code>æ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨çš„ä¸€äº›å·®åˆ«ã€‚ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œæˆ‘åœ¨<code>macOS</code> æ“ä½œç³»ç»Ÿï¼ˆè‹¹æœç”µè„‘ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼‰å’Œ<code>Windows</code>æ“ä½œç³»ç»Ÿä¸Šéƒ½å®‰è£…äº†<code>MySQL</code>ï¼Œå®ƒä»¬çš„å®‰è£…ç›®å½•åˆ†åˆ«æ˜¯ï¼š</p><ul><li><code>macOS</code>æ“ä½œç³»ç»Ÿä¸Šçš„å®‰è£…ç›®å½•ï¼š</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/</span><br></code></pre></td></tr></table></figure><ul><li><code>Windows</code>æ“ä½œç³»ç»Ÿä¸Šçš„å®‰è£…ç›®å½•ï¼š</li></ul><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">C:<span class="hljs-symbol">\P</span>rogram Files<span class="hljs-symbol">\M</span>ySQL<span class="hljs-symbol">\M</span>ySQL Server 5.7<br></code></pre></td></tr></table></figure><p>ä¸‹è¾¹æˆ‘ä¼šä»¥è¿™ä¸¤ä¸ªå®‰è£…ç›®å½•ä¸ºä¾‹æ¥è¿›ä¸€æ­¥æ‰¯å‡ºæ›´å¤šçš„æ¦‚å¿µï¼Œä¸è¿‡ä¸€å®šè¦æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªå®‰è£…ç›®å½•æ˜¯æˆ‘çš„è¿è¡Œä¸åŒæ“ä½œç³»ç»Ÿçš„æœºå™¨ä¸Šçš„å®‰è£…ç›®å½•ï¼Œä¸€å®šè¦è®°ç€æŠŠä¸‹è¾¹ç¤ºä¾‹ä¸­ç”¨åˆ°å®‰è£…ç›®å½•çš„åœ°æ–¹æ›¿æ¢ä¸ºä½ è‡ªå·±æœºå™¨ä¸Šçš„å®‰è£…ç›®å½•ã€‚</p><blockquote><p>å°è´´å£«ï¼š ç±»UNIXæ“ä½œç³»ç»Ÿéå¸¸å¤šï¼Œæ¯”å¦‚FreeBSDã€Linuxã€macOSã€Solarisç­‰éƒ½å±äºUNIXæ“ä½œç³»ç»Ÿçš„èŒƒç•´ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨macOSæ“ä½œç³»ç»Ÿä»£è¡¨ç±»UNIXæ“ä½œç³»ç»Ÿæ¥è¿è¡ŒMySQLã€‚</p></blockquote><h3 id="binç›®å½•ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶">binç›®å½•ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶</h3><p>åœ¨<code>MySQL</code>çš„å®‰è£…ç›®å½•ä¸‹æœ‰ä¸€ä¸ªç‰¹åˆ«ç‰¹åˆ«é‡è¦çš„<code>bin</code>ç›®å½•ï¼Œè¿™ä¸ªç›®å½•ä¸‹å­˜æ”¾ç€è®¸å¤šå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»¥<code>macOS</code>ç³»ç»Ÿä¸ºä¾‹ï¼Œè¿™ä¸ª<code>bin</code>ç›®å½•çš„ç»å¯¹è·¯å¾„å°±æ˜¯ï¼ˆåœ¨æˆ‘çš„æœºå™¨ä¸Šï¼‰ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/</span>bin<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ—å‡ºä¸€äº›åœ¨<code>macOS</code>ä¸­è¿™ä¸ª<code>bin</code>ç›®å½•ä¸‹çš„ä¸€éƒ¨åˆ†å¯æ‰§è¡Œæ–‡ä»¶æ¥çœ‹ä¸€ä¸‹ï¼ˆæ–‡ä»¶å¤ªå¤šï¼Œå…¨åˆ—å‡ºæ¥ä¼šåˆ·å±çš„ï¼‰ï¼š</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs elm">.<br>â”œâ”€â”€ mysql<br>â”œâ”€â”€ mysql.server -&gt; ../sup<span class="hljs-keyword">port</span>-files/mysql.server<br>â”œâ”€â”€ mysqladmin<br>â”œâ”€â”€ mysqlbinlog<br>â”œâ”€â”€ mysqlcheck<br>â”œâ”€â”€ mysqld<br>â”œâ”€â”€ mysqld_multi<br>â”œâ”€â”€ mysqld_safe<br>â”œâ”€â”€ mysqldump<br>â”œâ”€â”€ mysql<span class="hljs-keyword">import</span><br>â”œâ”€â”€ mysqlpump<br>... (çœç•¥å…¶ä»–æ–‡ä»¶)<br><span class="hljs-number">0</span> directories, <span class="hljs-number">40</span> files<br></code></pre></td></tr></table></figure><p><code>Windows</code>ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸<code>macOS</code>ä¸­çš„ç±»ä¼¼ï¼Œä¸è¿‡éƒ½æ˜¯ä»¥<code>.exe</code>ä¸ºæ‰©å±•åçš„ã€‚è¿™äº›å¯æ‰§è¡Œæ–‡ä»¶éƒ½æ˜¯ä¸æœåŠ¡å™¨ç¨‹åºå’Œå®¢æˆ·ç«¯ç¨‹åºç›¸å…³çš„ï¼Œåè¾¹æˆ‘ä»¬ä¼šè¯¦ç»†å” å¨ä¸€äº›æ¯”è¾ƒé‡è¦çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç°åœ¨å…ˆçœ‹çœ‹æ‰§è¡Œè¿™äº›æ–‡ä»¶çš„æ–¹å¼ã€‚</p><p>å¯¹äºæœ‰å¯è§†åŒ–ç•Œé¢çš„æ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œæˆ‘ä»¬æ‹¿ç€é¼ æ ‡ç‚¹ç‚¹ç‚¹å°±å¯ä»¥æ‰§è¡ŒæŸä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸è¿‡ç°åœ¨æˆ‘ä»¬æ›´å…³æ³¨åœ¨å‘½ä»¤è¡Œç¯å¢ƒä¸‹å¦‚ä½•æ‰§è¡Œè¿™äº›å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå‘½ä»¤è¡Œé€šä¿—çš„è¯´å°±æ˜¯é‚£äº›é»‘æ¡†æ¡†ï¼Œè¿™é‡Œçš„æŒ‡çš„æ˜¯ç±»<code>UNIX</code>ç³»ç»Ÿä¸­çš„<code>Shell</code>æˆ–è€…<code>Windows</code>ç³»ç»Ÿä¸­çš„<code>cmd.exe</code>ï¼Œå¦‚æœä½ ç°åœ¨è¿˜ä¸çŸ¥é“æ€ä¹ˆå¯åŠ¨è¿™äº›å‘½ä»¤è¡Œå·¥å…·ï¼Œç½‘ä¸Šæœæœå§ï½ ä¸‹è¾¹æˆ‘ä»¬ä»¥<code>macOS</code>ç³»ç»Ÿä¸ºä¾‹æ¥çœ‹çœ‹å¦‚ä½•å¯åŠ¨è¿™äº›å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆ<code>Windows</code>ä¸­çš„æ“ä½œæ˜¯ç±»ä¼¼çš„ï¼Œä¾è‘«èŠ¦ç”»ç“¢å°±å¥½äº†ï¼‰</p><ul><li><p>ä½¿ç”¨å¯æ‰§è¡Œæ–‡ä»¶çš„ç›¸å¯¹ï¼ç»å¯¹è·¯å¾„</p><p>å‡è®¾æˆ‘ä»¬ç°åœ¨æ‰€å¤„çš„å·¥ä½œç›®å½•æ˜¯<code>MySQL</code>çš„å®‰è£…ç›®å½•ï¼Œä¹Ÿå°±æ˜¯<code>/usr/local/mysql</code>ï¼Œæˆ‘ä»¬æƒ³å¯åŠ¨<code>bin</code>ç›®å½•ä¸‹çš„<code>mysqld</code>è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ¥å¯åŠ¨ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/bin/my</span>sqld<br></code></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥è¾“å…¥<code>mysqld</code>çš„ç»å¯¹è·¯å¾„ä¹Ÿå¯ä»¥ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/</span>bin/mysqld<br></code></pre></td></tr></table></figure></li><li><p>å°†è¯¥<code>bin</code>ç›®å½•çš„è·¯å¾„åŠ å…¥åˆ°ç¯å¢ƒå˜é‡<code>PATH</code>ä¸­</p><p>å¦‚æœæˆ‘ä»¬è§‰å¾—æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶éƒ½è¦è¾“å…¥ä¸€ä¸²é•¿é•¿çš„è·¯å¾„åè´¼éº»çƒ¦çš„è¯ï¼Œå¯ä»¥æŠŠè¯¥<code>bin</code>ç›®å½•æ‰€åœ¨çš„è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡<code>PATH</code>ä¸­ã€‚ç¯å¢ƒå˜é‡<code>PATH</code>æ˜¯ä¸€ç³»åˆ—è·¯å¾„çš„é›†åˆï¼Œå„ä¸ªè·¯å¾„ä¹‹é—´ä½¿ç”¨å†’å·<code>:</code>éš”ç¦»å¼€ï¼Œæ¯”æ–¹è¯´æˆ‘çš„æœºå™¨ä¸Šçš„ç¯å¢ƒå˜é‡<code>PATH</code>çš„å€¼å°±æ˜¯ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin:/u</span>sr<span class="hljs-regexp">/bin:/</span>bin:<span class="hljs-regexp">/usr/</span>sbin:/sbin<br></code></pre></td></tr></table></figure><p>æˆ‘çš„ç³»ç»Ÿä¸­è¿™ä¸ªç¯å¢ƒå˜é‡<code>PATH</code>çš„å€¼è¡¨æ˜ï¼šå½“æˆ‘åœ¨è¾“å…¥ä¸€ä¸ªå‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¾¿ä¼šåœ¨<code>/usr/local/bin</code>ã€<code>/usr/bin:</code>ã€<code>/bin:</code>ã€<code>/usr/sbin</code>ã€<code>/sbin</code>è¿™äº›ç›®å½•ä¸‹ä¾æ¬¡å¯»æ‰¾æ˜¯å¦å­˜åœ¨æˆ‘ä»¬è¾“å…¥çš„é‚£ä¸ªå‘½ä»¤ï¼Œå¦‚æœå¯»æ‰¾æˆåŠŸï¼Œåˆ™æ‰§è¡Œè¯¥ç›®å½•ä¸‹å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨å¯ä»¥ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªç¯å¢ƒå˜é‡<code>PATH</code>ï¼ŒæŠŠ<code>MySQL</code>å®‰è£…ç›®å½•ä¸‹çš„<code>bin</code>ç›®å½•çš„è·¯å¾„ä¹ŸåŠ å…¥åˆ°<code>PATH</code>ä¸­ï¼Œåœ¨æˆ‘çš„æœºå™¨ä¸Šä¿®æ”¹åçš„ç¯å¢ƒå˜é‡<code>PATH</code>çš„å€¼ä¸ºï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin:/u</span>sr<span class="hljs-regexp">/bin:/</span>bin:<span class="hljs-regexp">/usr/</span>sbin:<span class="hljs-regexp">/sbin:/u</span>sr<span class="hljs-regexp">/local/my</span>sql/bin<br></code></pre></td></tr></table></figure><p>è¿™æ ·ç°åœ¨ä¸è®ºæˆ‘ä»¬æ‰€å¤„çš„å·¥ä½œç›®å½•æ˜¯å•¥ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç›´æ¥è¾“å…¥å¯æ‰§è¡Œæ–‡ä»¶çš„åå­—å°±å¯ä»¥å¯åŠ¨å®ƒï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">mysqld</span><br></code></pre></td></tr></table></figure><p>æ–¹ä¾¿å¤šäº†å“ˆï½</p><blockquote><p>å°è´´å£«ï¼š å…³äºå•¥æ˜¯ç¯å¢ƒå˜é‡ä»¥åŠå¦‚ä½•åœ¨å½“å‰ç³»ç»Ÿä¸­æ·»åŠ æˆ–ä¿®æ”¹ç³»ç»Ÿå˜é‡ä¸æ˜¯æˆ‘ä»¬å” å¨çš„èŒƒå›´ï¼Œå¤§å®¶æ‰¾æœ¬ç›¸å…³çš„ä¹¦æˆ–è€…ä¸Šç½‘æŸ¥ä¸€æŸ¥å“ˆï½</p></blockquote></li></ul><h2 id="å¯åŠ¨MySQLæœåŠ¡å™¨ç¨‹åº">å¯åŠ¨MySQLæœåŠ¡å™¨ç¨‹åº</h2><h3 id="UNIXé‡Œå¯åŠ¨æœåŠ¡å™¨ç¨‹åº">UNIXé‡Œå¯åŠ¨æœåŠ¡å™¨ç¨‹åº</h3><p>åœ¨ç±»<code>UNIX</code>ç³»ç»Ÿä¸­ç”¨æ¥å¯åŠ¨<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶æœ‰å¾ˆå¤šï¼Œå¤§å¤šåœ¨<code>MySQL</code>å®‰è£…ç›®å½•çš„<code>bin</code>ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥ç…ç…ã€‚</p><h4 id="mysqld">mysqld</h4><p><code>mysqld</code>è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å°±ä»£è¡¨ç€<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºï¼Œè¿è¡Œè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å°±å¯ä»¥ç›´æ¥å¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨è¿›ç¨‹ã€‚ä½†è¿™ä¸ªå‘½ä»¤ä¸å¸¸ç”¨ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹æ›´ç‰›é€¼çš„å¯åŠ¨å‘½ä»¤ã€‚</p><h4 id="mysqld-safe">mysqld_safe</h4><p><code>mysqld_safe</code>æ˜¯ä¸€ä¸ªå¯åŠ¨è„šæœ¬ï¼Œå®ƒä¼šé—´æ¥çš„è°ƒç”¨<code>mysqld</code>ï¼Œè€Œä¸”è¿˜é¡ºä¾¿å¯åŠ¨äº†å¦å¤–ä¸€ä¸ªç›‘æ§è¿›ç¨‹ï¼Œè¿™ä¸ªç›‘æ§è¿›ç¨‹åœ¨æœåŠ¡å™¨è¿›ç¨‹æŒ‚äº†çš„æ—¶å€™ï¼Œå¯ä»¥å¸®åŠ©é‡å¯å®ƒã€‚å¦å¤–ï¼Œä½¿ç”¨<code>mysqld_safe</code>å¯åŠ¨æœåŠ¡å™¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šå°†æœåŠ¡å™¨ç¨‹åºçš„å‡ºé”™ä¿¡æ¯å’Œå…¶ä»–è¯Šæ–­ä¿¡æ¯é‡å®šå‘åˆ°æŸä¸ªæ–‡ä»¶ä¸­ï¼Œäº§ç”Ÿå‡ºé”™æ—¥å¿—ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬æ‰¾å‡ºå‘ç”Ÿé”™è¯¯çš„åŸå› ã€‚</p><h4 id="mysql-server">mysql.server</h4><p><code>mysql.server</code>ä¹Ÿæ˜¯ä¸€ä¸ªå¯åŠ¨è„šæœ¬ï¼Œå®ƒä¼šé—´æ¥çš„è°ƒç”¨<code>mysqld_safe</code>ï¼Œåœ¨è°ƒç”¨<code>mysql.server</code>æ—¶åœ¨åè¾¹æŒ‡å®š<code>start</code>å‚æ•°å°±å¯ä»¥å¯åŠ¨æœåŠ¡å™¨ç¨‹åºäº†ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql.<span class="hljs-keyword">server</span> <span class="hljs-keyword">start</span><br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ª <em><strong>mysql.server</strong></em> æ–‡ä»¶å…¶å®æ˜¯ä¸€ä¸ªé“¾æ¥æ–‡ä»¶ï¼Œå®ƒçš„å®é™…æ–‡ä»¶æ˜¯ <em><strong>â€¦/support-files/mysql.server</strong></em>ã€‚æˆ‘ä½¿ç”¨çš„<code>macOS</code>æ“ä½œç³»ç»Ÿä¼šå¸®æˆ‘ä»¬åœ¨<code>bin</code>ç›®å½•ä¸‹è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæŒ‡å‘å®é™…æ–‡ä»¶çš„é“¾æ¥æ–‡ä»¶ï¼Œå¦‚æœä½ çš„æ“ä½œç³»ç»Ÿæ²¡æœ‰å¸®ä½ è‡ªåŠ¨åˆ›å»ºè¿™ä¸ªé“¾æ¥æ–‡ä»¶ï¼Œé‚£å°±è‡ªå·±åˆ›å»ºä¸€ä¸ªå‘—ï½ åˆ«å‘Šè¯‰æˆ‘ä½ ä¸ä¼šåˆ›å»ºé“¾æ¥æ–‡ä»¶ï¼Œä¸Šç½‘æœæœå‘—ï½</p><p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>mysql.server</code>å‘½ä»¤æ¥å…³é—­æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨ç¨‹åºï¼Œåªè¦æŠŠ<code>start</code>å‚æ•°æ¢æˆ<code>stop</code>å°±å¥½äº†ï¼š</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbscript">mysql.<span class="hljs-built_in">server</span> <span class="hljs-keyword">stop</span><br></code></pre></td></tr></table></figure><h4 id="mysqld-multi">mysqld_multi</h4><p>å…¶å®æˆ‘ä»¬ä¸€å°è®¡ç®—æœºä¸Šä¹Ÿå¯ä»¥è¿è¡Œå¤šä¸ªæœåŠ¡å™¨å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œå¤šä¸ª<code>MySQL</code>æœåŠ¡å™¨è¿›ç¨‹ã€‚<code>mysql_multi</code>å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥å¯¹æ¯ä¸€ä¸ªæœåŠ¡å™¨è¿›ç¨‹çš„å¯åŠ¨æˆ–åœæ­¢è¿›è¡Œç›‘æ§ã€‚è¿™ä¸ªå‘½ä»¤çš„ä½¿ç”¨æ¯”è¾ƒå¤æ‚ï¼Œæœ¬ä¹¦ä¸»è¦æ˜¯ä¸ºäº†è®²æ¸…æ¥š<code>MySQL</code>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¿è¡Œçš„è¿‡ç¨‹ï¼Œä¸ä¼šå¯¹å¯åŠ¨å¤šä¸ªæœåŠ¡å™¨ç¨‹åºè¿›è¡Œè¿‡å¤šå” å¨ã€‚</p><h3 id="Windowsé‡Œå¯åŠ¨æœåŠ¡å™¨ç¨‹åº">Windowsé‡Œå¯åŠ¨æœåŠ¡å™¨ç¨‹åº</h3><p><code>Windows</code>é‡Œæ²¡æœ‰åƒç±»<code>UNIX</code>ç³»ç»Ÿä¸­é‚£ä¹ˆå¤šçš„å¯åŠ¨è„šæœ¬ï¼Œä½†æ˜¯ä¹Ÿæä¾›äº†æ‰‹åŠ¨å¯åŠ¨å’Œä»¥æœåŠ¡çš„å½¢å¼å¯åŠ¨è¿™ä¸¤ç§æ–¹å¼ï¼Œä¸‹è¾¹æˆ‘ä»¬è¯¦ç»†çœ‹ã€‚</p><h4 id="mysqld-2">mysqld</h4><p>åŒæ ·çš„ï¼Œåœ¨<code>MySQL</code>å®‰è£…ç›®å½•ä¸‹çš„<code>bin</code>ç›®å½•ä¸‹æœ‰ä¸€ä¸ª<code>mysqld</code>å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨å‘½ä»¤è¡Œé‡Œè¾“å…¥<code>mysqld</code>ï¼Œæˆ–è€…ç›´æ¥åŒå‡»è¿è¡Œå®ƒå°±ç®—å¯åŠ¨äº†<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºäº†ã€‚</p><h4 id="ä»¥æœåŠ¡çš„æ–¹å¼è¿è¡ŒæœåŠ¡å™¨ç¨‹åº">ä»¥æœåŠ¡çš„æ–¹å¼è¿è¡ŒæœåŠ¡å™¨ç¨‹åº</h4><p>é¦–å…ˆçœ‹çœ‹å•¥æ˜¯ä¸ª<code>Windows</code> æœåŠ¡ï¼Ÿå¦‚æœæ— è®ºæ˜¯è°æ­£åœ¨ä½¿ç”¨è¿™å°è®¡ç®—æœºï¼Œæˆ‘ä»¬éƒ½éœ€è¦é•¿æ—¶é—´çš„è¿è¡ŒæŸä¸ªç¨‹åºï¼Œè€Œä¸”éœ€è¦åœ¨è®¡ç®—æœºå¯åŠ¨çš„æ—¶å€™ä¾¿å¯åŠ¨å®ƒï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šæŠŠå®ƒæ³¨å†Œä¸ºä¸€ä¸ª<code>Windows æœåŠ¡</code>ï¼Œæ“ä½œç³»ç»Ÿä¼šå¸®æˆ‘ä»¬ç®¡ç†å®ƒã€‚æŠŠæŸä¸ªç¨‹åºæ³¨å†Œä¸º<code>Windows</code>æœåŠ¡çš„æ–¹å¼æŒºç®€å•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-string">&quot;å®Œæ•´çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„&quot;</span> --install [-manual] [æœåŠ¡å]<br></code></pre></td></tr></table></figure><p>å…¶ä¸­çš„<code>-manual</code>å¯ä»¥çœç•¥ï¼ŒåŠ ä¸Šå®ƒçš„è¯è¡¨ç¤ºåœ¨<code>Windows</code>ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ä¸è‡ªåŠ¨å¯åŠ¨è¯¥æœåŠ¡ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨å¯åŠ¨ã€‚<code>æœåŠ¡å</code>ä¹Ÿå¯ä»¥çœç•¥ï¼Œé»˜è®¤çš„æœåŠ¡åå°±æ˜¯<code>MySQL</code>ã€‚æ¯”å¦‚æˆ‘çš„<code>Windows</code>è®¡ç®—æœºä¸Š<code>mysqld</code>çš„å®Œæ•´è·¯å¾„æ˜¯ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">C:<span class="hljs-symbol">\P</span>rogram Files<span class="hljs-symbol">\M</span>ySQL<span class="hljs-symbol">\M</span>ySQL Server 5.7<span class="hljs-symbol">\b</span>in<span class="hljs-symbol">\m</span>ysqld<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æŠŠå®ƒæ³¨å†Œä¸ºæœåŠ¡çš„è¯å¯ä»¥åœ¨å‘½ä»¤è¡Œé‡Œè¿™ä¹ˆå†™ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">&quot;C:<span class="hljs-symbol">\P</span>rogram Files<span class="hljs-symbol">\M</span>ySQL<span class="hljs-symbol">\M</span>ySQL Server 5.7<span class="hljs-symbol">\b</span>in<span class="hljs-symbol">\m</span>ysqld&quot; --install<br></code></pre></td></tr></table></figure><p>åœ¨æŠŠ<code>mysqld</code>æ³¨å†Œä¸º<code>Windows</code>æœåŠ¡ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸‹è¾¹è¿™ä¸ªå‘½ä»¤æ¥å¯åŠ¨<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºäº†ï¼š</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">net</span> <span class="hljs-built_in">start</span> MySQL<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå¦‚æœä½ å–œæ¬¢å›¾å½¢ç•Œé¢çš„è¯ï¼Œä½ å¯ä»¥é€šè¿‡<code>Windows</code>çš„æœåŠ¡ç®¡ç†å™¨é€šè¿‡ç”¨é¼ æ ‡ç‚¹ç‚¹ç‚¹çš„æ–¹å¼æ¥å¯åŠ¨å’Œåœæ­¢æœåŠ¡ï¼ˆä½œä¸ºä¸€ä¸ªç¨‹åºçŒ¿ï¼Œè¿˜æ˜¯ç”¨é»‘æ¡†æ¡†å§ï½ï¼‰ã€‚</p><p>å…³é—­è¿™ä¸ªæœåŠ¡ä¹Ÿéå¸¸ç®€å•ï¼Œåªè¦æŠŠä¸Šè¾¹çš„<code>start</code>æ¢æˆ<code>stop</code>å°±è¡Œäº†ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">net stop MySQL<br></code></pre></td></tr></table></figure><h2 id="å¯åŠ¨MySQLå®¢æˆ·ç«¯ç¨‹åº">å¯åŠ¨MySQLå®¢æˆ·ç«¯ç¨‹åº</h2><p>åœ¨æˆ‘ä»¬æˆåŠŸå¯åŠ¨<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºåï¼Œå°±å¯ä»¥æ¥ç€å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºæ¥è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨å–½ï¼Œ<code>bin</code>ç›®å½•ä¸‹æœ‰è®¸å¤šå®¢æˆ·ç«¯ç¨‹åºï¼Œæ¯”æ–¹è¯´<code>mysqladmin</code>ã€<code>mysqldump</code>ã€<code>mysqlcheck</code>ç­‰ç­‰ç­‰ç­‰ï¼ˆå¥½å¤šå‘¢ï¼Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼‰ã€‚è¿™é‡Œæˆ‘ä»¬é‡ç‚¹è¦å…³æ³¨çš„æ˜¯å¯æ‰§è¡Œæ–‡ä»¶<code>mysql</code>ï¼Œé€šè¿‡è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥è®©æˆ‘ä»¬å’ŒæœåŠ¡å™¨ç¨‹åºè¿›ç¨‹äº¤äº’ï¼Œä¹Ÿå°±æ˜¯å‘é€è¯·æ±‚ï¼Œæ¥æ”¶æœåŠ¡å™¨çš„å¤„ç†ç»“æœã€‚å¯åŠ¨è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ—¶ä¸€èˆ¬éœ€è¦ä¸€äº›å‚æ•°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">mysql -hä¸»æœºå  -uç”¨æˆ·å -<span class="hljs-selector-tag">p</span>å¯†ç <br></code></pre></td></tr></table></figure><p>å„ä¸ªå‚æ•°çš„æ„ä¹‰å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left">å‚æ•°å</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:left"><code>-h</code></td><td>è¡¨ç¤ºæœåŠ¡å™¨è¿›ç¨‹æ‰€åœ¨è®¡ç®—æœºçš„åŸŸåæˆ–è€…IPåœ°å€ï¼Œå¦‚æœæœåŠ¡å™¨è¿›ç¨‹å°±è¿è¡Œåœ¨æœ¬æœºçš„è¯ï¼Œå¯ä»¥çœç•¥è¿™ä¸ªå‚æ•°ï¼Œæˆ–è€…å¡«<code>localhost</code>æˆ–è€…<code>127.0.0.1</code>ã€‚ä¹Ÿå¯ä»¥å†™ä½œ <code>--host=ä¸»æœºå</code>çš„å½¢å¼ã€‚</td></tr><tr><td style="text-align:left"><code>-u</code></td><td>è¡¨ç¤ºç”¨æˆ·åã€‚ä¹Ÿå¯ä»¥å†™ä½œ <code>--user=ç”¨æˆ·å</code>çš„å½¢å¼ã€‚</td></tr><tr><td style="text-align:left"><code>-p</code></td><td>è¡¨ç¤ºå¯†ç ã€‚ä¹Ÿå¯ä»¥å†™ä½œ <code>--password=å¯†ç </code>çš„å½¢å¼ã€‚</td></tr></tbody></table><blockquote><p>å°è´´å£«ï¼š **åƒ hã€uã€p è¿™æ ·åç§°åªæœ‰ä¸€ä¸ªè‹±æ–‡å­—æ¯çš„å‚æ•°ç§°ä¸ºçŸ­å½¢å¼çš„å‚æ•°ï¼Œä½¿ç”¨æ—¶å‰è¾¹éœ€è¦åŠ å•çŸ­åˆ’çº¿ï¼Œåƒ hostã€userã€password è¿™æ ·å¤§äºä¸€ä¸ªè‹±æ–‡å­—æ¯çš„å‚æ•°ç§°ä¸ºé•¿å½¢å¼çš„å‚æ•°ï¼Œä½¿ç”¨æ—¶å‰è¾¹éœ€è¦åŠ åŒçŸ­åˆ’çº¿ã€‚**åè¾¹ä¼šè¯¦ç»†è®¨è®ºè¿™äº›å‚æ•°çš„ä½¿ç”¨æ–¹å¼çš„ï¼Œç¨å®‰å‹¿èºï½</p></blockquote><p>æ¯”å¦‚æˆ‘è¿™æ ·æ‰§è¡Œä¸‹è¾¹è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶(ç”¨æˆ·åå¯†ç æŒ‰ä½ çš„å®é™…æƒ…å†µå¡«å†™)ï¼Œå°±å¯ä»¥å¯åŠ¨<code>MySQL</code>å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”è¿æ¥åˆ°æœåŠ¡å™¨äº†ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span> -hlocalhost -uroot -p<span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿æ¥æˆåŠŸåçš„ç•Œé¢ï¼š</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs smali">Welcome to the MySQ<span class="hljs-class">L monitor.  Commands end with ;</span><span class="hljs-built_in"> or </span>\g.<br>Your MySQL connection id is 2<br>Server version: 5.7.21 Homebrew<br><br>Copyright (c) 2000, 2018, Oracle<span class="hljs-built_in"> and/or </span>its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation<span class="hljs-built_in"> and/or </span>its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br>Type &#x27;help;&#x27;<span class="hljs-built_in"> or </span>&#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.<br><br>mysql&gt; <br></code></pre></td></tr></table></figure><p>æœ€åä¸€è¡Œçš„<code>mysql&gt;</code>æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„æç¤ºç¬¦ï¼Œä¹‹åå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„å‘½ä»¤éƒ½éœ€è¦å†™åœ¨è¿™ä¸ªæç¤ºç¬¦åè¾¹ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³æ–­å¼€å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è¿æ¥å¹¶ä¸”å…³é—­å®¢æˆ·ç«¯çš„è¯ï¼Œå¯ä»¥åœ¨<code>mysql&gt;</code>æç¤ºç¬¦åè¾“å…¥ä¸‹è¾¹ä»»æ„ä¸€ä¸ªå‘½ä»¤ï¼š</p><ol><li><code>quit</code></li><li><code>exit</code></li><li><code>\q</code></li></ol><p>æ¯”å¦‚æˆ‘ä»¬è¾“å…¥<code>quit</code>è¯•è¯•ï¼š</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cos">mysql&gt; <span class="hljs-keyword">quit</span><br>Bye<br></code></pre></td></tr></table></figure><p>è¾“å‡ºäº†<code>Bye</code>è¯´æ˜å®¢æˆ·ç«¯ç¨‹åºå·²ç»å…³æ‰äº†ã€‚æ³¨æ„æ³¨æ„æ³¨æ„ï¼Œè¿™æ˜¯å…³é—­å®¢æˆ·ç«¯ç¨‹åºçš„æ–¹å¼ï¼Œä¸æ˜¯å…³é—­æœåŠ¡å™¨ç¨‹åºçš„æ–¹å¼ï¼Œæ€ä¹ˆå…³é—­æœåŠ¡å™¨ç¨‹åºä¸Šä¸€èŠ‚é‡Œå” å¨è¿‡äº†ã€‚</p><p>å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥å¤šæ‰“å¼€å‡ ä¸ªé»‘æ¡†æ¡†ï¼Œæ¯ä¸ªé»‘æ¡†æ¡†éƒ½ä½¿ç”¨<code>mysql -hlocalhost -uroot -p123456</code>æ¥è¿è¡Œå¤šä¸ªå®¢æˆ·ç«¯ç¨‹åºï¼Œæ¯ä¸ªå®¢æˆ·ç«¯ç¨‹åºéƒ½æ˜¯äº’ä¸å½±å“çš„ã€‚å¦‚æœä½ æœ‰å¤šä¸ªç”µè„‘ï¼Œä¹Ÿå¯ä»¥è¯•è¯•æŠŠå®ƒä»¬ç”¨å±€åŸŸç½‘è¿èµ·æ¥ï¼Œåœ¨ä¸€ä¸ªç”µè„‘ä¸Šå¯åŠ¨<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºï¼Œåœ¨å¦ä¸€ä¸ªç”µè„‘ä¸Šæ‰§è¡Œ<code>mysql</code>å‘½ä»¤æ—¶ä½¿ç”¨<code>IP</code>åœ°å€ä½œä¸ºä¸»æœºåæ¥è¿æ¥åˆ°æœåŠ¡å™¨ã€‚</p><table><thead><tr><th>å®¢æˆ·ç«¯ç¨‹åº</th><th>æœåŠ¡å™¨ç¨‹åº</th></tr></thead><tbody><tr><td>å¯åŠ¨ï¼šmysql -h -u -p</td><td>å¯åŠ¨ï¼šmysqldã€mysql_safeã€mysql.serverã€mysqld_multi</td></tr><tr><td>å…³é—­ï¼šquitã€exitã€\q</td><td>å…³é—­ï¼šxxx stop æˆ–è€… net  stop xxx</td></tr></tbody></table><blockquote><p>xxxä»£è¡¨å¯åŠ¨æ–¹å¼ï¼Œç±»unixç³»ç»Ÿä¸ºå‰è€…ï¼Œwindowsç³»ç»Ÿä¸ºåè€…ã€‚</p></blockquote><h3 id="è¿æ¥æ³¨æ„äº‹é¡¹">è¿æ¥æ³¨æ„äº‹é¡¹</h3><ul><li><p>æœ€å¥½ä¸è¦åœ¨ä¸€è¡Œå‘½ä»¤ä¸­è¾“å…¥å¯†ç ã€‚</p><p>æˆ‘ä»¬ç›´æ¥åœ¨é»‘æ¡†æ¡†é‡Œè¾“å…¥å¯†ç å¾ˆå¯èƒ½è¢«åˆ«äººçœ‹åˆ°ï¼Œè¿™å’Œä½ å½“ç€åˆ«äººçš„é¢è¾“å…¥é“¶è¡Œå¡å¯†ç æ²¡å•¥åŒºåˆ«ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ‰§è¡Œ<code>mysql</code>è¿æ¥æœåŠ¡å™¨çš„æ—¶å€™å¯ä»¥ä¸æ˜¾å¼çš„å†™å‡ºå¯†ç ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">mysql -hlocalhost -uroot -<span class="hljs-selector-tag">p</span><br></code></pre></td></tr></table></figure><p>ç‚¹å‡»å›è½¦ä¹‹åæ‰ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-built_in">Enter</span> <span class="hljs-variable">password</span><span class="hljs-operator">:</span><br></code></pre></td></tr></table></figure><p>ä¸è¿‡è¿™å›ä½ è¾“å…¥çš„å¯†ç ä¸ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ï¼Œå¿ƒæ€€ä¸è½¨çš„äººä¹Ÿå°±çœ‹ä¸åˆ°äº†ï¼Œè¾“å…¥å®Œæˆç‚¹å‡»å›è½¦å°±æˆåŠŸè¿æ¥åˆ°äº†æœåŠ¡å™¨ã€‚</p></li><li><p>å¦‚æœä½ éè¦åœ¨ä¸€è¡Œå‘½ä»¤ä¸­æ˜¾å¼çš„æŠŠå¯†ç è¾“å‡ºæ¥ï¼Œé‚£<code>-p</code>å’Œå¯†ç å€¼ä¹‹é—´ä¸èƒ½æœ‰ç©ºç™½å­—ç¬¦ï¼ˆå…¶ä»–å‚æ•°åä¹‹é—´å¯ä»¥æœ‰ç©ºç™½å­—ç¬¦ï¼‰ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span> -h localhost -u root -p<span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure><p>å¦‚æœåŠ ä¸Šäº†ç©ºç™½å­—ç¬¦å°±æ˜¯é”™è¯¯çš„ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span> -h localhost -u root -p <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure></li><li><p><code>mysql</code>çš„å„ä¸ªå‚æ•°çš„æ‘†æ”¾é¡ºåºæ²¡æœ‰ç¡¬æ€§è§„å®šï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">mysql -<span class="hljs-selector-tag">p</span>  -u root -h localhost<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœä½ çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å®‰è£…åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œ<code>-h</code>å‚æ•°å¯ä»¥çœç•¥ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">mysql -u root -<span class="hljs-selector-tag">p</span>  <br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ç±»<code>UNIX</code>ç³»ç»Ÿï¼Œå¹¶ä¸”çœç•¥<code>-u</code>å‚æ•°åï¼Œä¼šæŠŠä½ ç™»é™†æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·åå½“ä½œ<code>MySQL</code>çš„ç”¨æˆ·åå»å¤„ç†ã€‚</p><p>æ¯”æ–¹è¯´æˆ‘ç”¨ç™»å½•æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·åæ˜¯<code>xiaohaizi</code>ï¼Œé‚£ä¹ˆåœ¨æˆ‘çš„æœºå™¨ä¸Šä¸‹è¾¹è¿™ä¸¤æ¡å‘½ä»¤æ˜¯ç­‰ä»·çš„ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">mysql -u xiaohaizi -<span class="hljs-selector-tag">p</span><br>mysql -<span class="hljs-selector-tag">p</span><br></code></pre></td></tr></table></figure><p>å¯¹äº<code>Windows</code>ç³»ç»Ÿæ¥è¯´ï¼Œé»˜è®¤çš„ç”¨æˆ·åæ˜¯<code>ODBC</code>ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡<code>USER</code>æ¥æ·»åŠ ä¸€ä¸ªé»˜è®¤ç”¨æˆ·åã€‚</p></li></ul><h2 id="å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿æ¥çš„è¿‡ç¨‹">å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿æ¥çš„è¿‡ç¨‹</h2><p>æˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“å¦‚ä½•å¯åŠ¨<code>MySQL</code>çš„æœåŠ¡å™¨ç¨‹åºï¼Œä»¥åŠå¦‚ä½•å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºæ¥è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨ç¨‹åºã€‚è¿è¡Œç€çš„æœåŠ¡å™¨ç¨‹åºå’Œå®¢æˆ·ç«¯ç¨‹åºæœ¬è´¨ä¸Šéƒ½æ˜¯è®¡ç®—æœºä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯è¿›ç¨‹å‘æœåŠ¡å™¨è¿›ç¨‹å‘é€è¯·æ±‚å¹¶å¾—åˆ°å›å¤çš„è¿‡ç¨‹æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿›ç¨‹é—´é€šä¿¡çš„è¿‡ç¨‹ï¼<code>MySQL</code>æ”¯æŒä¸‹è¾¹ä¸‰ç§å®¢æˆ·ç«¯è¿›ç¨‹å’ŒæœåŠ¡å™¨è¿›ç¨‹çš„é€šä¿¡æ–¹å¼ã€‚</p><h3 id="TCP-IP">TCP/IP</h3><p>çœŸå®ç¯å¢ƒä¸­ï¼Œ<strong>æ•°æ®åº“æœåŠ¡å™¨è¿›ç¨‹å’Œå®¢æˆ·ç«¯è¿›ç¨‹å¯èƒ½è¿è¡Œåœ¨ä¸åŒçš„ä¸»æœºä¸­ï¼Œå®ƒä»¬ä¹‹é—´å¿…é¡»é€šè¿‡ç½‘ç»œæ¥è¿›è¡Œé€šè®¯</strong>ã€‚<code>MySQL</code>é‡‡ç”¨<code>TCP</code>ä½œä¸ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„ç½‘ç»œé€šä¿¡åè®®ã€‚åœ¨ç½‘ç»œç¯å¢ƒä¸‹ï¼Œæ¯å°è®¡ç®—æœºéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„<code>IPåœ°å€</code>ï¼Œå¦‚æœæŸä¸ªè¿›ç¨‹æœ‰éœ€è¦é‡‡ç”¨<code>TCP</code>åè®®è¿›è¡Œç½‘ç»œé€šä¿¡æ–¹é¢çš„éœ€æ±‚ï¼Œå¯ä»¥å‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€ä¸ª<code>ç«¯å£å·</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•´æ•°å€¼ï¼Œå®ƒçš„å–å€¼èŒƒå›´æ˜¯<code>0~65535</code>ã€‚è¿™æ ·åœ¨ç½‘ç»œä¸­çš„å…¶ä»–è¿›ç¨‹å°±å¯ä»¥é€šè¿‡<code>IPåœ°å€ + ç«¯å£å·</code>çš„æ–¹å¼æ¥ä¸è¿™ä¸ªè¿›ç¨‹è¿æ¥ï¼Œè¿™æ ·è¿›ç¨‹ä¹‹é—´å°±å¯ä»¥é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡äº†ã€‚</p><p><code>MySQL</code>æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ä¼šé»˜è®¤ç”³è¯·<code>3306</code>ç«¯å£å·ï¼Œä¹‹åå°±åœ¨è¿™ä¸ªç«¯å£å·ä¸Šç­‰å¾…å®¢æˆ·ç«¯è¿›ç¨‹è¿›è¡Œè¿æ¥ï¼Œç”¨ä¹¦é¢ä¸€ç‚¹çš„è¯æ¥è¯´ï¼Œ<code>MySQL</code>æœåŠ¡å™¨ä¼šé»˜è®¤ç›‘å¬<code>3306</code>ç«¯å£ã€‚</p><blockquote><p>å°è´´å£«ï¼š <code>TCP/IP</code>ç½‘ç»œä½“ç³»ç»“æ„æ˜¯ç°åœ¨é€šç”¨çš„ä¸€ç§ç½‘ç»œä½“ç³»ç»“æ„ï¼Œå…¶ä¸­çš„<code>TCP</code>å’Œ<code>IP</code>æ˜¯ä½“ç³»ç»“æ„ä¸­ä¸¤ä¸ªéå¸¸é‡è¦çš„ç½‘ç»œåè®®ï¼Œå¦‚æœä½ å¹¶ä¸çŸ¥é“åè®®æ˜¯ä»€ä¹ˆï¼Œæˆ–è€…å¹¶ä¸çŸ¥é“ç½‘ç»œæ˜¯ä»€ä¹ˆï¼Œé‚£ææ€•å…„å¼Ÿä½ æ¥é”™åœ°æ–¹äº†ï¼Œæ‰¾æœ¬è®¡ç®—æœºç½‘ç»œçš„ä¹¦å»ç…ç…å§ï¼ ä»€ä¹ˆï¼Ÿè®¡ç®—æœºç½‘ç»œçš„ä¹¦å†™çš„éƒ½è´¼æ™¦æ¶©ï¼Œçœ‹ä¸æ‡‚ï¼Ÿæ²¡å…³ç³»ï¼Œç­‰æˆ‘ï½</p></blockquote><p>å¦‚æœ<code>3306</code>ç«¯å£å·å·²ç»è¢«åˆ«çš„è¿›ç¨‹å ç”¨äº†æˆ–è€…æˆ‘ä»¬å•çº¯çš„æƒ³è‡ªå®šä¹‰è¯¥æ•°æ®åº“å®ä¾‹ç›‘å¬çš„ç«¯å£å·ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºçš„å‘½ä»¤è¡Œé‡Œæ·»åŠ <code>-P</code>å‚æ•°æ¥æ˜ç¡®æŒ‡å®šä¸€ä¸‹ç«¯å£å·ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysqld</span> -P<span class="hljs-number">3307</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·<code>MySQL</code>æœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶å°±ä¼šå»ç›‘å¬æˆ‘ä»¬æŒ‡å®šçš„ç«¯å£å·<code>3307</code>ã€‚</p><p>å¦‚æœå®¢æˆ·ç«¯è¿›ç¨‹æƒ³è¦ä½¿ç”¨<code>TCP/IP</code>ç½‘ç»œæ¥è¿æ¥åˆ°æœåŠ¡å™¨è¿›ç¨‹ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ä½¿ç”¨<code>mysql</code>æ¥å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºæ—¶ï¼Œåœ¨<code>-h</code>å‚æ•°åå¿…é¡»è·Ÿéš<code>IPåœ°å€</code>æ¥ä½œä¸ºéœ€è¦è¿æ¥çš„æœåŠ¡å™¨è¿›ç¨‹æ‰€åœ¨ä¸»æœºçš„ä¸»æœºåï¼Œå¦‚æœå®¢æˆ·ç«¯è¿›ç¨‹å’ŒæœåŠ¡å™¨è¿›ç¨‹åœ¨ä¸€å°è®¡ç®—æœºä¸­çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>127.0.0.1</code>æ¥ä»£è¡¨æœ¬æœºçš„<code>IPåœ°å€</code>ã€‚å¦å¤–ï¼Œå¦‚æœæœåŠ¡å™¨è¿›ç¨‹ç›‘å¬çš„ç«¯å£å·ä¸æ˜¯é»˜è®¤çš„<code>3306</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨<code>mysql</code>å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºæ—¶ä½¿ç”¨<code>-P</code>å‚æ•°ï¼ˆå¤§å†™çš„<code>P</code>ï¼Œå°å†™çš„<code>p</code>æ˜¯ç”¨æ¥æŒ‡å®šå¯†ç çš„ï¼‰æ¥æŒ‡å®šéœ€è¦è¿æ¥åˆ°çš„ç«¯å£å·ã€‚æ¯”å¦‚æˆ‘ä»¬ç°åœ¨å·²ç»åœ¨æœ¬æœºå¯åŠ¨äº†æœåŠ¡å™¨è¿›ç¨‹ï¼Œç›‘å¬çš„ç«¯å£å·ä¸º<code>3307</code>ï¼Œé‚£æˆ‘ä»¬å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºæ—¶å¯ä»¥è¿™æ ·å†™ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span> -h<span class="hljs-number">127.0.0.1</span> -uroot -P<span class="hljs-number">3307</span> -p<br></code></pre></td></tr></table></figure><p>ä¸çŸ¥å¤§å®¶å‘ç°äº†æ²¡æœ‰ï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºçš„å‘½ä»¤<code>mysqld</code>å’Œå¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºçš„å‘½ä»¤<code>mysql</code>åè¾¹éƒ½å¯ä»¥ä½¿ç”¨<code>-P</code>å‚æ•°ï¼Œå…³äºå¦‚ä½•åœ¨å‘½ä»¤åè¾¹æŒ‡å®šå‚æ•°ï¼ŒæŒ‡å®šå“ªäº›å‚æ•°æˆ‘ä»¬ç¨åä¼šè¯¦ç»†å” å¨çš„ï¼Œç¨å¾®ç­‰ç­‰å“ˆï½</p><h3 id="å‘½åç®¡é“å’Œå…±äº«å†…å­˜">å‘½åç®¡é“å’Œå…±äº«å†…å­˜</h3><p>å¦‚æœä½ æ˜¯ä¸€ä¸ª<code>Windows</code>ç”¨æˆ·ï¼Œé‚£ä¹ˆ<strong>å®¢æˆ·ç«¯è¿›ç¨‹å’ŒæœåŠ¡å™¨è¿›ç¨‹ä¹‹é—´å¯ä»¥è€ƒè™‘ä½¿ç”¨<code>å‘½åç®¡é“</code>æˆ–<code>å…±äº«å†…å­˜</code>è¿›è¡Œé€šä¿¡</strong>ã€‚ä¸è¿‡å¯ç”¨è¿™äº›é€šä¿¡æ–¹å¼çš„æ—¶å€™éœ€è¦åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºå’Œå®¢æˆ·ç«¯ç¨‹åºæ—¶æ·»åŠ ä¸€äº›å‚æ•°ï¼š</p><ul><li><p>ä½¿ç”¨<code>å‘½åç®¡é“</code>æ¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡</p><p>éœ€è¦åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºçš„å‘½ä»¤ä¸­åŠ ä¸Š<code>--enable-named-pipe</code>å‚æ•°ï¼Œç„¶ååœ¨å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºçš„å‘½ä»¤ä¸­åŠ å…¥<code>--pipe</code>æˆ–è€…<code>--protocol=pipe</code>å‚æ•°ã€‚</p></li><li><p>ä½¿ç”¨<code>å…±äº«å†…å­˜</code>æ¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡</p><p>éœ€è¦åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºçš„å‘½ä»¤ä¸­åŠ ä¸Š<code>--shared-memory</code>å‚æ•°ï¼Œåœ¨æˆåŠŸå¯åŠ¨æœåŠ¡å™¨åï¼Œ<code>å…±äº«å†…å­˜</code>ä¾¿æˆä¸ºæœ¬åœ°å®¢æˆ·ç«¯ç¨‹åºçš„é»˜è®¤è¿æ¥æ–¹å¼ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºçš„å‘½ä»¤ä¸­åŠ å…¥<code>--protocol=memory</code>å‚æ•°æ¥æ˜¾å¼çš„æŒ‡å®šä½¿ç”¨å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡ã€‚</p><p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨<code>å…±äº«å†…å­˜</code>çš„æ–¹å¼è¿›è¡Œé€šä¿¡çš„æœåŠ¡å™¨è¿›ç¨‹å’Œå®¢æˆ·ç«¯è¿›ç¨‹å¿…é¡»åœ¨åŒä¸€å°<code>Windows</code>ä¸»æœºä¸­ã€‚</p></li></ul><blockquote><p>å°è´´å£«ï¼š å‘½åç®¡é“å’Œå…±äº«å†…å­˜æ˜¯Windowsæ“ä½œç³»ç»Ÿä¸­çš„ä¸¤ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Œå¦‚æœä½ æ²¡å¬è¿‡çš„è¯ä¹Ÿä¸ç”¨çº ç»“ï¼Œå¹¶ä¸å¦¨ç¢æˆ‘ä»¬ä»‹ç»MySQLçš„çŸ¥è¯†ï½</p></blockquote><h3 id="UnixåŸŸå¥—æ¥å­—æ–‡ä»¶">UnixåŸŸå¥—æ¥å­—æ–‡ä»¶</h3><p>å¦‚æœæˆ‘ä»¬çš„<strong>æœåŠ¡å™¨è¿›ç¨‹å’Œå®¢æˆ·ç«¯è¿›ç¨‹éƒ½è¿è¡Œåœ¨åŒä¸€å°æ“ä½œç³»ç»Ÿä¸ºç±»<code>Unix</code>çš„æœºå™¨ä¸Šçš„è¯</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>UnixåŸŸå¥—æ¥å­—æ–‡ä»¶</code>æ¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚å¦‚æœæˆ‘ä»¬åœ¨å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºçš„æ—¶å€™æŒ‡å®šçš„ä¸»æœºåä¸º<code>localhost</code>ï¼Œæˆ–è€…æŒ‡å®šäº†<code>--protocol=socket</code>çš„å¯åŠ¨å‚æ•°ï¼Œé‚£æœåŠ¡å™¨ç¨‹åºå’Œå®¢æˆ·ç«¯ç¨‹åºä¹‹é—´å°±å¯ä»¥é€šè¿‡<code>Unix</code>åŸŸå¥—æ¥å­—æ–‡ä»¶æ¥è¿›è¡Œé€šä¿¡äº†ã€‚<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºé»˜è®¤ç›‘å¬çš„<code>Unix</code>åŸŸå¥—æ¥å­—æ–‡ä»¶è·¯å¾„ä¸º<code>/tmp/mysql.sock</code>ï¼Œå®¢æˆ·ç«¯ç¨‹åºä¹Ÿé»˜è®¤è¿æ¥åˆ°è¿™ä¸ª<code>Unix</code>åŸŸå¥—æ¥å­—æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ”¹å˜è¿™ä¸ªé»˜è®¤è·¯å¾„ï¼Œå¯ä»¥åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºæ—¶æŒ‡å®š<code>socket</code>å‚æ•°ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">mysqld <span class="hljs-comment">--socket=/tmp/a.txt</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·æœåŠ¡å™¨å¯åŠ¨åä¾¿ä¼šç›‘å¬<code>/tmp/a.txt</code>ã€‚åœ¨æœåŠ¡å™¨æ”¹å˜äº†é»˜è®¤çš„<code>UNIX</code>åŸŸå¥—æ¥å­—æ–‡ä»¶åï¼Œå¦‚æœå®¢æˆ·ç«¯ç¨‹åºæƒ³é€šè¿‡<code>UNIX</code>åŸŸå¥—æ¥å­—æ–‡ä»¶è¿›è¡Œé€šä¿¡çš„è¯ï¼Œä¹Ÿéœ€è¦æ˜¾å¼çš„æŒ‡å®šè¿æ¥åˆ°çš„<code>UNIX</code>åŸŸå¥—æ¥å­—æ–‡ä»¶è·¯å¾„ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">mysql -hlocalhost -uroot <span class="hljs-comment">--socket=/tmp/a.txt -p</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·è¯¥å®¢æˆ·ç«¯è¿›ç¨‹å’ŒæœåŠ¡å™¨è¿›ç¨‹å°±å¯ä»¥é€šè¿‡è·¯å¾„ä¸º<code>/tmp/a.txt</code>çš„<code>Unix</code>åŸŸå¥—æ¥å­—æ–‡ä»¶è¿›è¡Œé€šä¿¡äº†ã€‚</p><h2 id="æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚">æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚</h2><p>å…¶å®ä¸è®ºå®¢æˆ·ç«¯è¿›ç¨‹å’ŒæœåŠ¡å™¨è¿›ç¨‹æ˜¯é‡‡ç”¨å“ªç§æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œæœ€åå®ç°çš„æ•ˆæœéƒ½æ˜¯ï¼šå®¢æˆ·ç«¯è¿›ç¨‹å‘æœåŠ¡å™¨è¿›ç¨‹å‘é€ä¸€æ®µæ–‡æœ¬ï¼ˆMySQLè¯­å¥ï¼‰ï¼ŒæœåŠ¡å™¨è¿›ç¨‹å¤„ç†åå†å‘å®¢æˆ·ç«¯è¿›ç¨‹å‘é€ä¸€æ®µæ–‡æœ¬ï¼ˆå¤„ç†ç»“æœï¼‰ã€‚é‚£æœåŠ¡å™¨è¿›ç¨‹å¯¹å®¢æˆ·ç«¯è¿›ç¨‹å‘é€çš„è¯·æ±‚åšäº†ä»€ä¹ˆå¤„ç†ï¼Œæ‰èƒ½äº§ç”Ÿæœ€åçš„å¤„ç†ç»“æœå‘¢ï¼Ÿå®¢æˆ·ç«¯å¯ä»¥å‘æœåŠ¡å™¨å‘é€å¢åˆ æ”¹æŸ¥å„ç±»è¯·æ±‚ï¼Œæˆ‘ä»¬è¿™é‡Œä»¥æ¯”è¾ƒå¤æ‚çš„æŸ¥è¯¢è¯·æ±‚ä¸ºä¾‹æ¥ç”»ä¸ªå›¾å±•ç¤ºä¸€ä¸‹å¤§è‡´çš„è¿‡ç¨‹ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/167f4c7b99f87e1c~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c8d26fmg1af0ms81cpc7gm8lv39.png-97.9kB"><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡å™¨ç¨‹åºå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„æŸ¥è¯¢è¯·æ±‚å¤§è‡´éœ€è¦ç»è¿‡ä¸‰ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯<code>è¿æ¥ç®¡ç†</code>ã€<code>è§£æä¸ä¼˜åŒ–</code>ã€<code>å­˜å‚¨å¼•æ“</code>ã€‚ä¸‹è¾¹æˆ‘ä»¬æ¥è¯¦ç»†çœ‹ä¸€ä¸‹è¿™ä¸‰ä¸ªéƒ¨åˆ†éƒ½å¹²äº†ä»€ä¹ˆã€‚</p><h3 id="è¿æ¥ç®¡ç†">è¿æ¥ç®¡ç†</h3><p>å®¢æˆ·ç«¯è¿›ç¨‹å¯ä»¥é‡‡ç”¨æˆ‘ä»¬ä¸Šè¾¹ä»‹ç»çš„<code>TCP/IP</code>ã€<code>å‘½åç®¡é“æˆ–å…±äº«å†…å­˜</code>ã€<code>UnixåŸŸå¥—æ¥å­—</code>è¿™å‡ ç§æ–¹å¼ä¹‹ä¸€æ¥ä¸æœåŠ¡å™¨è¿›ç¨‹å»ºç«‹è¿æ¥ï¼Œ**æ¯å½“æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è¿›ç¨‹è¿æ¥åˆ°æœåŠ¡å™¨è¿›ç¨‹æ—¶ï¼ŒæœåŠ¡å™¨è¿›ç¨‹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥ä¸“é—¨å¤„ç†ä¸è¿™ä¸ªå®¢æˆ·ç«¯çš„äº¤äº’ï¼Œå½“è¯¥å®¢æˆ·ç«¯é€€å‡ºæ—¶ä¼šä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥ï¼ŒæœåŠ¡å™¨å¹¶ä¸ä¼šç«‹å³æŠŠä¸è¯¥å®¢æˆ·ç«¯äº¤äº’çš„çº¿ç¨‹é”€æ¯æ‰ï¼Œè€Œæ˜¯æŠŠå®ƒç¼“å­˜èµ·æ¥ï¼Œåœ¨å¦ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯å†è¿›è¡Œè¿æ¥æ—¶ï¼ŒæŠŠè¿™ä¸ªç¼“å­˜çš„çº¿ç¨‹åˆ†é…ç»™è¯¥æ–°å®¢æˆ·ç«¯ã€‚è¿™æ ·å°±èµ·åˆ°äº†ä¸é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ•ˆæœï¼Œä»è€ŒèŠ‚çœå¼€é”€ã€‚**ä»è¿™ä¸€ç‚¹å¤§å®¶ä¹Ÿèƒ½çœ‹å‡ºï¼Œ<code>MySQL</code>æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸€ä¸ªè¿æ¥è¿›æ¥çš„å®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯çº¿ç¨‹åˆ†é…çš„å¤ªå¤šäº†ä¼šä¸¥é‡å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦é™åˆ¶ä¸€ä¸‹å¯ä»¥åŒæ—¶è¿æ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯æ•°é‡ï¼Œè‡³äºæ€ä¹ˆé™åˆ¶æˆ‘ä»¬åè¾¹å†è¯´å“ˆï½</p><p><strong>åœ¨å®¢æˆ·ç«¯ç¨‹åºå‘èµ·è¿æ¥çš„æ—¶å€™ï¼Œéœ€è¦æºå¸¦ä¸»æœºä¿¡æ¯ã€ç”¨æˆ·åã€å¯†ç </strong>ï¼ŒæœåŠ¡å™¨ç¨‹åºä¼šå¯¹å®¢æˆ·ç«¯ç¨‹åºæä¾›çš„è¿™äº›ä¿¡æ¯è¿›è¡Œè®¤è¯ï¼Œå¦‚æœè®¤è¯å¤±è´¥ï¼ŒæœåŠ¡å™¨ç¨‹åºä¼šæ‹’ç»è¿æ¥ã€‚å¦å¤–ï¼Œå¦‚æœå®¢æˆ·ç«¯ç¨‹åºå’ŒæœåŠ¡å™¨ç¨‹åºä¸è¿è¡Œåœ¨ä¸€å°è®¡ç®—æœºä¸Šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é‡‡ç”¨ä½¿ç”¨äº†<code>SSL</code>ï¼ˆå®‰å…¨å¥—æ¥å­—ï¼‰çš„ç½‘ç»œè¿æ¥è¿›è¡Œé€šä¿¡ï¼Œæ¥ä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</p><p>å½“è¿æ¥å»ºç«‹åï¼Œä¸è¯¥å®¢æˆ·ç«¯å…³è”çš„æœåŠ¡å™¨çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œ<code>MySQL</code>æœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚åªæ˜¯ä¸€ä¸ªæ–‡æœ¬æ¶ˆæ¯ï¼Œè¯¥æ–‡æœ¬æ¶ˆæ¯è¿˜è¦ç»è¿‡å„ç§å¤„ç†ï¼Œé¢„çŸ¥åäº‹å¦‚ä½•ï¼Œç»§ç»­å¾€ä¸‹çœ‹å“ˆï½</p><h3 id="è§£æä¸ä¼˜åŒ–">è§£æä¸ä¼˜åŒ–</h3><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œ<code>MySQL</code>æœåŠ¡å™¨å·²ç»è·å¾—äº†æ–‡æœ¬å½¢å¼çš„è¯·æ±‚ï¼Œæ¥ç€ è¿˜è¦ç»è¿‡ä¹ä¹å…«åä¸€éš¾çš„å¤„ç†ï¼Œå…¶ä¸­çš„å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†åˆ†åˆ«æ˜¯<code>æŸ¥è¯¢ç¼“å­˜</code>ã€<code>è¯­æ³•è§£æ</code>å’Œ<code>æŸ¥è¯¢ä¼˜åŒ–</code>ï¼Œä¸‹è¾¹æˆ‘ä»¬è¯¦ç»†æ¥çœ‹ã€‚</p><h4 id="æŸ¥è¯¢ç¼“å­˜">æŸ¥è¯¢ç¼“å­˜</h4><p>å¦‚æœæˆ‘é—®ä½ <code>9+8Ã—16-3Ã—2Ã—17</code>çš„å€¼æ˜¯å¤šå°‘ï¼Œä½ å¯èƒ½ä¼šç”¨è®¡ç®—å™¨å»ç®—ä¸€ä¸‹ï¼Œæˆ–è€…ç‰›é€¼ä¸€ç‚¹ç”¨å¿ƒç®—ï¼Œæœ€ç»ˆå¾—åˆ°äº†ç»“æœ<code>35</code>ï¼Œå¦‚æœæˆ‘å†é—®ä½ ä¸€é<code>9+8Ã—16-3Ã—2Ã—17</code>çš„å€¼æ˜¯å¤šå°‘ï¼Œä½ è¿˜ç”¨å†å‚»å‘µå‘µçš„ç®—ä¸€éä¹ˆï¼Ÿæˆ‘ä»¬åˆšåˆšå·²ç»ç®—è¿‡äº†ï¼Œç›´æ¥è¯´ç­”æ¡ˆå°±å¥½äº†ã€‚<strong><code>MySQL</code>æœåŠ¡å™¨ç¨‹åºå¤„ç†æŸ¥è¯¢è¯·æ±‚çš„è¿‡ç¨‹ä¹Ÿæ˜¯è¿™æ ·ï¼Œä¼šæŠŠåˆšåˆšå¤„ç†è¿‡çš„æŸ¥è¯¢è¯·æ±‚å’Œç»“æœ<code>ç¼“å­˜</code>èµ·æ¥</strong>ï¼Œå¦‚æœä¸‹ä¸€æ¬¡æœ‰ä¸€æ¨¡ä¸€æ ·çš„è¯·æ±‚è¿‡æ¥ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­æŸ¥æ‰¾ç»“æœå°±å¥½äº†ï¼Œå°±ä¸ç”¨å†å‚»å‘µå‘µçš„å»åº•å±‚çš„è¡¨ä¸­æŸ¥æ‰¾äº†ã€‚è¿™ä¸ªæŸ¥è¯¢ç¼“å­˜å¯ä»¥åœ¨ä¸åŒå®¢æˆ·ç«¯ä¹‹é—´å…±äº«ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå®¢æˆ·ç«¯AåˆšåˆšæŸ¥è¯¢äº†ä¸€ä¸ªè¯­å¥ï¼Œè€Œå®¢æˆ·ç«¯Bä¹‹åå‘é€äº†åŒæ ·çš„æŸ¥è¯¢è¯·æ±‚ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯Bçš„è¿™æ¬¡æŸ¥è¯¢å°±å¯ä»¥ç›´æ¥ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ä¸­çš„æ•°æ®ã€‚</p><p>å½“ç„¶ï¼Œ<code>MySQL</code>æœåŠ¡å™¨å¹¶æ²¡æœ‰äººèªæ˜ï¼Œå¦‚æœä¸¤ä¸ªæŸ¥è¯¢è¯·æ±‚åœ¨ä»»ä½•å­—ç¬¦ä¸Šçš„ä¸åŒï¼ˆä¾‹å¦‚ï¼šç©ºæ ¼ã€æ³¨é‡Šã€å¤§å°å†™ï¼‰ï¼Œéƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸ä¼šå‘½ä¸­ã€‚å¦å¤–ï¼Œå¦‚æœæŸ¥è¯¢è¯·æ±‚ä¸­åŒ…å«æŸäº›ç³»ç»Ÿå‡½æ•°ã€ç”¨æˆ·è‡ªå®šä¹‰å˜é‡å’Œå‡½æ•°ã€ä¸€äº›ç³»ç»Ÿè¡¨ï¼Œå¦‚ mysql ã€information_schemaã€ performance_schema æ•°æ®åº“ä¸­çš„è¡¨ï¼Œé‚£è¿™ä¸ªè¯·æ±‚å°±ä¸ä¼šè¢«ç¼“å­˜ã€‚ä»¥æŸäº›ç³»ç»Ÿå‡½æ•°ä¸¾ä¾‹ï¼Œå¯èƒ½åŒæ ·çš„å‡½æ•°çš„ä¸¤æ¬¡è°ƒç”¨ä¼šäº§ç”Ÿä¸ä¸€æ ·çš„ç»“æœï¼Œæ¯”å¦‚å‡½æ•°<code>NOW</code>ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šäº§ç”Ÿæœ€æ–°çš„å½“å‰æ—¶é—´ï¼Œå¦‚æœåœ¨ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ä¸­è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£å³ä½¿æŸ¥è¯¢è¯·æ±‚çš„æ–‡æœ¬ä¿¡æ¯éƒ½ä¸€æ ·ï¼Œé‚£ä¸åŒæ—¶é—´çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹Ÿåº”è¯¥å¾—åˆ°ä¸åŒçš„ç»“æœï¼Œå¦‚æœåœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶å°±ç¼“å­˜äº†ï¼Œé‚£ç¬¬äºŒæ¬¡æŸ¥è¯¢çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœå°±æ˜¯é”™è¯¯çš„ï¼</p><p><code>MySQL</code>ç¼“å­˜å¤±æ•ˆåŸå› ï¼š</p><ul><li>æŸ¥è¯¢è¯·æ±‚ä¸ä¸€è‡´</li><li>åŒ…å«æŸäº›ç³»ç»Ÿå‡½æ•°æˆ–è€…è‡ªå®šä¹‰å˜é‡ã€å‡½æ•°ä¹‹ç±»çš„ä¿¡æ¯ã€‚å¦‚<code>Now</code>å‡½æ•°ç­‰ã€‚</li></ul><p>ä¸è¿‡æ—¢ç„¶æ˜¯ç¼“å­˜ï¼Œé‚£å°±æœ‰å®ƒç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ã€‚MySQLçš„ç¼“å­˜ç³»ç»Ÿä¼šç›‘æµ‹æ¶‰åŠåˆ°çš„æ¯å¼ è¡¨ï¼Œåªè¦è¯¥è¡¨çš„ç»“æ„æˆ–è€…æ•°æ®è¢«ä¿®æ”¹ï¼Œå¦‚å¯¹è¯¥è¡¨ä½¿ç”¨äº†<code>INSERT</code>ã€ <code>UPDATE</code>ã€<code>DELETE</code>ã€<code>TRUNCATE TABLE</code>ã€<code>ALTER TABLE</code>ã€<code>DROP TABLE</code>æˆ– <code>DROP DATABASE</code>è¯­å¥ï¼Œé‚£ä½¿ç”¨è¯¥è¡¨çš„æ‰€æœ‰é«˜é€Ÿç¼“å­˜æŸ¥è¯¢éƒ½å°†å˜ä¸ºæ— æ•ˆå¹¶ä»é«˜é€Ÿç¼“å­˜ä¸­åˆ é™¤ï¼</p><blockquote><p>å°è´´å£«ï¼š è™½ç„¶æŸ¥è¯¢ç¼“å­˜æœ‰æ—¶å¯ä»¥æå‡ç³»ç»Ÿæ€§èƒ½ï¼Œä½†ä¹Ÿä¸å¾—ä¸å› ç»´æŠ¤è¿™å—ç¼“å­˜è€Œé€ æˆä¸€äº›å¼€é”€ï¼Œæ¯”å¦‚æ¯æ¬¡éƒ½è¦å»æŸ¥è¯¢ç¼“å­˜ä¸­æ£€ç´¢ï¼ŒæŸ¥è¯¢è¯·æ±‚å¤„ç†å®Œéœ€è¦æ›´æ–°æŸ¥è¯¢ç¼“å­˜ï¼Œç»´æŠ¤è¯¥æŸ¥è¯¢ç¼“å­˜å¯¹åº”çš„å†…å­˜åŒºåŸŸã€‚ä»MySQL 5.7.20å¼€å§‹ï¼Œä¸æ¨èä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶åœ¨MySQL 8.0ä¸­åˆ é™¤ã€‚</p></blockquote><h4 id="è¯­æ³•è§£æ">è¯­æ³•è§£æ</h4><p>å¦‚æœæŸ¥è¯¢ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦è¿›å…¥æ­£å¼çš„æŸ¥è¯¢é˜¶æ®µäº†ã€‚å› ä¸ºå®¢æˆ·ç«¯ç¨‹åºå‘é€è¿‡æ¥çš„è¯·æ±‚åªæ˜¯ä¸€æ®µæ–‡æœ¬è€Œå·²ï¼Œæ‰€ä»¥<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºé¦–å…ˆè¦å¯¹è¿™æ®µæ–‡æœ¬åšåˆ†æï¼Œåˆ¤æ–­è¯·æ±‚çš„è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œç„¶åä»æ–‡æœ¬ä¸­å°†è¦æŸ¥è¯¢çš„è¡¨ã€å„ç§æŸ¥è¯¢æ¡ä»¶éƒ½æå–å‡ºæ¥æ”¾åˆ°<code>MySQL</code>æœåŠ¡å™¨å†…éƒ¨ä½¿ç”¨çš„ä¸€äº›æ•°æ®ç»“æ„ä¸Šæ¥ã€‚</p><blockquote><p>å°è´´å£«ï¼š è¿™ä¸ªä»æŒ‡å®šçš„æ–‡æœ¬ä¸­æå–å‡ºæˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯æœ¬è´¨ä¸Šç®—æ˜¯ä¸€ä¸ªç¼–è¯‘è¿‡ç¨‹ï¼Œæ¶‰åŠè¯æ³•è§£æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æç­‰é˜¶æ®µï¼Œè¿™äº›é—®é¢˜ä¸å±äºæˆ‘ä»¬è®¨è®ºçš„èŒƒç•´ï¼Œå¤§å®¶åªè¦äº†è§£åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­éœ€è¦è¿™ä¸ªæ­¥éª¤å°±å¥½äº†ã€‚</p></blockquote><h4 id="æŸ¥è¯¢ä¼˜åŒ–">æŸ¥è¯¢ä¼˜åŒ–</h4><p>è¯­æ³•è§£æä¹‹åï¼ŒæœåŠ¡å™¨ç¨‹åºè·å¾—åˆ°äº†éœ€è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¦æŸ¥è¯¢çš„åˆ—æ˜¯å“ªäº›ï¼Œè¡¨æ˜¯å“ªä¸ªï¼Œæœç´¢æ¡ä»¶æ˜¯ä»€ä¹ˆç­‰ç­‰ï¼Œä½†å…‰æœ‰è¿™äº›æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºæˆ‘ä»¬å†™çš„<code>MySQL</code>è¯­å¥æ‰§è¡Œèµ·æ¥æ•ˆç‡å¯èƒ½å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œ<code>MySQL</code>çš„ä¼˜åŒ–ç¨‹åºä¼šå¯¹æˆ‘ä»¬çš„è¯­å¥åšä¸€äº›ä¼˜åŒ–ï¼Œå¦‚å¤–è¿æ¥è½¬æ¢ä¸ºå†…è¿æ¥ã€è¡¨è¾¾å¼ç®€åŒ–ã€å­æŸ¥è¯¢è½¬ä¸ºè¿æ¥å§å•¦å§å•¦çš„ä¸€å †ä¸œè¥¿ã€‚ä¼˜åŒ–çš„ç»“æœå°±æ˜¯ç”Ÿæˆä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ï¼Œè¿™ä¸ªæ‰§è¡Œè®¡åˆ’è¡¨æ˜äº†åº”è¯¥ä½¿ç”¨å“ªäº›ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œè¡¨ä¹‹é—´çš„è¿æ¥é¡ºåºæ˜¯å•¥æ ·çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>EXPLAIN</code>è¯­å¥æ¥æŸ¥çœ‹æŸä¸ªè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œå…³äºæŸ¥è¯¢ä¼˜åŒ–è¿™éƒ¨åˆ†çš„è¯¦ç»†å†…å®¹æˆ‘ä»¬åè¾¹ä¼šä»”ç»†å” å¨ï¼Œç°åœ¨ä½ åªéœ€è¦çŸ¥é“åœ¨<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªæ­¥éª¤å°±å¥½äº†ã€‚</p><h3 id="å­˜å‚¨å¼•æ“">å­˜å‚¨å¼•æ“</h3><p>æˆªæ­¢åˆ°æœåŠ¡å™¨ç¨‹åºå®Œæˆäº†æŸ¥è¯¢ä¼˜åŒ–ä¸ºæ­¢ï¼Œè¿˜æ²¡æœ‰çœŸæ­£çš„å»è®¿é—®çœŸå®çš„æ•°æ®è¡¨ï¼Œ<code>MySQL</code>æœåŠ¡å™¨æŠŠæ•°æ®çš„å­˜å‚¨å’Œæå–æ“ä½œéƒ½å°è£…åˆ°äº†ä¸€ä¸ªå«<code>å­˜å‚¨å¼•æ“</code>çš„æ¨¡å—é‡Œã€‚æˆ‘ä»¬çŸ¥é“<code>è¡¨</code>æ˜¯ç”±ä¸€è¡Œä¸€è¡Œçš„è®°å½•ç»„æˆçš„ï¼Œä½†è¿™åªæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç‰©ç†ä¸Šå¦‚ä½•è¡¨ç¤ºè®°å½•ï¼Œæ€ä¹ˆä»è¡¨ä¸­è¯»å–æ•°æ®ï¼Œæ€ä¹ˆæŠŠæ•°æ®å†™å…¥å…·ä½“çš„ç‰©ç†å­˜å‚¨å™¨ä¸Šï¼Œè¿™éƒ½æ˜¯<code>å­˜å‚¨å¼•æ“</code>è´Ÿè´£çš„äº‹æƒ…ã€‚ä¸ºäº†å®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œ<code>MySQL</code>æä¾›äº†å„å¼å„æ ·çš„<code>å­˜å‚¨å¼•æ“</code>ï¼Œä¸åŒ<code>å­˜å‚¨å¼•æ“</code>ç®¡ç†çš„è¡¨å…·ä½“çš„å­˜å‚¨ç»“æ„å¯èƒ½ä¸åŒï¼Œé‡‡ç”¨çš„å­˜å–ç®—æ³•ä¹Ÿå¯èƒ½ä¸åŒã€‚</p><blockquote><p>å°è´´å£«ï¼š ä¸ºä»€ä¹ˆå«<code>å¼•æ“</code>å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªåå­—æ›´æ‹‰é£ï½ å…¶å®è¿™ä¸ªå­˜å‚¨å¼•æ“ä»¥å‰å«åš<code>è¡¨å¤„ç†å™¨</code>ï¼Œåæ¥å¯èƒ½äººä»¬è§‰å¾—å¤ªåœŸï¼Œå°±æ”¹æˆäº†<code>å­˜å‚¨å¼•æ“</code>çš„å«æ³•ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯æ¥æ”¶ä¸Šå±‚ä¼ ä¸‹æ¥çš„æŒ‡ä»¤ï¼Œç„¶åå¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæå–æˆ–å†™å…¥æ“ä½œã€‚</p></blockquote><p>ä¸ºäº†ç®¡ç†æ–¹ä¾¿ï¼Œäººä»¬æŠŠ<code>è¿æ¥ç®¡ç†</code>ã€<code>æŸ¥è¯¢ç¼“å­˜</code>ã€<code>è¯­æ³•è§£æ</code>ã€<code>æŸ¥è¯¢ä¼˜åŒ–</code>è¿™äº›å¹¶ä¸æ¶‰åŠçœŸå®æ•°æ®å­˜å‚¨çš„åŠŸèƒ½åˆ’åˆ†ä¸º<code>MySQL server</code>çš„åŠŸèƒ½ï¼ŒæŠŠçœŸå®å­˜å–æ•°æ®çš„åŠŸèƒ½åˆ’åˆ†ä¸º<code>å­˜å‚¨å¼•æ“</code>çš„åŠŸèƒ½ã€‚å„ç§ä¸åŒçš„å­˜å‚¨å¼•æ“å‘ä¸Šè¾¹çš„<code>MySQL server</code>å±‚æä¾›ç»Ÿä¸€çš„è°ƒç”¨æ¥å£ï¼ˆä¹Ÿå°±æ˜¯å­˜å‚¨å¼•æ“APIï¼‰ï¼ŒåŒ…å«äº†å‡ åä¸ªåº•å±‚å‡½æ•°ï¼Œåƒ&quot;è¯»å–ç´¢å¼•ç¬¬ä¸€æ¡å†…å®¹&quot;ã€â€œè¯»å–ç´¢å¼•ä¸‹ä¸€æ¡å†…å®¹â€ã€&quot;æ’å…¥è®°å½•&quot;ç­‰ç­‰ã€‚</p><blockquote><p><code>Mysql</code>åˆ†ä¸ºå¼•æ“å±‚å’Œserverå±‚ã€‚</p></blockquote><p>æ‰€ä»¥åœ¨<code>MySQL server</code>å®Œæˆäº†æŸ¥è¯¢ä¼˜åŒ–åï¼Œåªéœ€æŒ‰ç…§ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’è°ƒç”¨åº•å±‚å­˜å‚¨å¼•æ“æä¾›çš„APIï¼Œè·å–åˆ°æ•°æ®åè¿”å›ç»™å®¢æˆ·ç«¯å°±å¥½äº†ã€‚</p><h2 id="å¸¸ç”¨å­˜å‚¨å¼•æ“">å¸¸ç”¨å­˜å‚¨å¼•æ“</h2><p><code>MySQL</code>æ”¯æŒéå¸¸å¤šç§å­˜å‚¨å¼•æ“ï¼Œæˆ‘è¿™å…ˆåˆ—ä¸¾ä¸€äº›ï¼š</p><table><thead><tr><th>å­˜å‚¨å¼•æ“</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ARCHIVE</code></td><td>ç”¨äºæ•°æ®å­˜æ¡£ï¼ˆè¡Œè¢«æ’å…¥åä¸èƒ½å†ä¿®æ”¹ï¼‰</td></tr><tr><td><code>BLACKHOLE</code></td><td>ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹</td></tr><tr><td><code>CSV</code></td><td>åœ¨å­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹</td></tr><tr><td><code>FEDERATED</code></td><td>ç”¨æ¥è®¿é—®è¿œç¨‹è¡¨</td></tr><tr><td><code>InnoDB</code></td><td>å…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å­˜å‚¨å¼•æ“</td></tr><tr><td><code>MEMORY</code></td><td>ç½®äºå†…å­˜çš„è¡¨</td></tr><tr><td><code>MERGE</code></td><td>ç”¨æ¥ç®¡ç†å¤šä¸ªMyISAMè¡¨æ„æˆçš„è¡¨é›†åˆ</td></tr><tr><td><code>MyISAM</code></td><td>ä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“</td></tr><tr><td><code>NDB</code></td><td>MySQLé›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“</td></tr></tbody></table><p>è¿™ä¹ˆå¤šæˆ‘ä»¬æ€ä¹ˆæŒ‘å•Šï¼Œå“ˆå“ˆï¼Œä½ å¤šè™‘äº†ï¼Œå…¶å®æˆ‘ä»¬æœ€å¸¸ç”¨çš„å°±æ˜¯<code>InnoDB</code>å’Œ<code>MyISAM</code>ï¼Œæœ‰æ—¶ä¼šæä¸€ä¸‹<code>Memory</code>ã€‚å…¶ä¸­<code>InnoDB</code>æ˜¯<code>MySQL</code>é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼Œæˆ‘ä»¬ä¹‹åä¼šè¯¦ç»†å” å¨è¿™ä¸ªå­˜å‚¨å¼•æ“çš„å„ç§åŠŸèƒ½ï¼Œç°åœ¨å…ˆçœ‹ä¸€ä¸‹ä¸€äº›å­˜å‚¨å¼•æ“å¯¹äºæŸäº›åŠŸèƒ½çš„æ”¯æŒæƒ…å†µï¼š</p><table><thead><tr><th>Feature</th><th>MyISAM</th><th>Memory</th><th>InnoDB</th><th>Archive</th><th>NDB</th></tr></thead><tbody><tr><td>B-tree indexes</td><td>yes</td><td>yes</td><td>yes</td><td>no</td><td>no</td></tr><tr><td>Backup/point-in-time recovery</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td></tr><tr><td>Cluster database support</td><td>no</td><td>no</td><td>no</td><td>no</td><td>yes</td></tr><tr><td>Clustered indexes</td><td>no</td><td>no</td><td>yes</td><td>no</td><td>no</td></tr><tr><td>Compressed data</td><td>yes</td><td>no</td><td>yes</td><td>yes</td><td>no</td></tr><tr><td>Data caches</td><td>no</td><td>N/A</td><td>yes</td><td>no</td><td>yes</td></tr><tr><td>Encrypted data</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td></tr><tr><td>Foreign key support</td><td>no</td><td>no</td><td>yes</td><td>no</td><td>yes</td></tr><tr><td>Full-text search indexes</td><td>yes</td><td>no</td><td>yes</td><td>no</td><td>no</td></tr><tr><td>Geospatial data type support</td><td>yes</td><td>no</td><td>yes</td><td>yes</td><td>yes</td></tr><tr><td>Geospatial indexing support</td><td>yes</td><td>no</td><td>yes</td><td>no</td><td>no</td></tr><tr><td>Hash indexes</td><td>no</td><td>yes</td><td>no</td><td>no</td><td>yes</td></tr><tr><td>Index caches</td><td>yes</td><td>N/A</td><td>yes</td><td>no</td><td>yes</td></tr><tr><td>Locking granularity</td><td>Table</td><td>Table</td><td>Row</td><td>Row</td><td>Row</td></tr><tr><td>MVCC</td><td>no</td><td>no</td><td>yes</td><td>no</td><td>no</td></tr><tr><td>Query cache support</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td></tr><tr><td>Replication support</td><td>yes</td><td>Limited</td><td>yes</td><td>yes</td><td>yes</td></tr><tr><td>Storage limits</td><td>256TB</td><td>RAM</td><td>64TB</td><td>None</td><td>384EB</td></tr><tr><td>T-tree indexes</td><td>no</td><td>no</td><td>no</td><td>no</td><td>yes</td></tr><tr><td>Transactions</td><td>no</td><td>no</td><td>yes</td><td>no</td><td>yes</td></tr><tr><td>Update statistics for data dictionary</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td></tr></tbody></table><p>å¯†å¯†éº»éº»åˆ—äº†è¿™ä¹ˆå¤šï¼Œçœ‹çš„å¤´çš®éƒ½å‘éº»äº†ï¼Œè¾¾åˆ°çš„æ•ˆæœå°±æ˜¯å‘Šè¯‰ä½ ï¼šè¿™ç©æ„å„¿å¾ˆå¤æ‚ã€‚å…¶å®è¿™äº›ä¸œè¥¿å¤§å®¶æ²¡å¿…è¦ç«‹å³å°±ç»™è®°ä½ï¼Œæˆ‘åˆ—å‡ºæ¥çš„ç›®çš„å°±æ˜¯æƒ³è®©å¤§å®¶æ˜ç™½ä¸åŒçš„å­˜å‚¨å¼•æ“æ”¯æŒä¸åŒçš„åŠŸèƒ½ï¼Œæœ‰äº›é‡è¦çš„åŠŸèƒ½æˆ‘ä»¬ä¼šåœ¨åè¾¹çš„å” å¨ä¸­æ…¢æ…¢è®©å¤§å®¶ç†è§£çš„ï½</p><h2 id="å…³äºå­˜å‚¨å¼•æ“çš„ä¸€äº›æ“ä½œ">å…³äºå­˜å‚¨å¼•æ“çš„ä¸€äº›æ“ä½œ</h2><h3 id="æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ç¨‹åºæ”¯æŒçš„å­˜å‚¨å¼•æ“">æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ç¨‹åºæ”¯æŒçš„å­˜å‚¨å¼•æ“</h3><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹è¾¹è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ç¨‹åºæ”¯æŒçš„å­˜å‚¨å¼•æ“ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">SHOW ENGINES<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>æ¥çœ‹ä¸€ä¸‹è°ƒç”¨æ•ˆæœï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; SHOW ENGINES;<br>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+<br>|<span class="hljs-string"> Engine             </span>|<span class="hljs-string"> Support </span>|<span class="hljs-string"> Comment                                                        </span>|<span class="hljs-string"> Transactions </span>|<span class="hljs-string"> XA   </span>|<span class="hljs-string"> Savepoints </span>|<br>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+<br>|<span class="hljs-string"> InnoDB             </span>|<span class="hljs-string"> DEFAULT </span>|<span class="hljs-string"> Supports transactions, row-level locking, and foreign keys     </span>|<span class="hljs-string"> YES          </span>|<span class="hljs-string"> YES  </span>|<span class="hljs-string"> YES        </span>|<br>|<span class="hljs-string"> MRG_MYISAM         </span>|<span class="hljs-string"> YES     </span>|<span class="hljs-string"> Collection of identical MyISAM tables                          </span>|<span class="hljs-string"> NO           </span>|<span class="hljs-string"> NO   </span>|<span class="hljs-string"> NO         </span>|<br>|<span class="hljs-string"> MEMORY             </span>|<span class="hljs-string"> YES     </span>|<span class="hljs-string"> Hash based, stored in memory, useful for temporary tables      </span>|<span class="hljs-string"> NO           </span>|<span class="hljs-string"> NO   </span>|<span class="hljs-string"> NO         </span>|<br>|<span class="hljs-string"> BLACKHOLE          </span>|<span class="hljs-string"> YES     </span>|<span class="hljs-string"> /dev/null storage engine (anything you write to it disappears) </span>|<span class="hljs-string"> NO           </span>|<span class="hljs-string"> NO   </span>|<span class="hljs-string"> NO         </span>|<br>|<span class="hljs-string"> MyISAM             </span>|<span class="hljs-string"> YES     </span>|<span class="hljs-string"> MyISAM storage engine                                          </span>|<span class="hljs-string"> NO           </span>|<span class="hljs-string"> NO   </span>|<span class="hljs-string"> NO         </span>|<br>|<span class="hljs-string"> CSV                </span>|<span class="hljs-string"> YES     </span>|<span class="hljs-string"> CSV storage engine                                             </span>|<span class="hljs-string"> NO           </span>|<span class="hljs-string"> NO   </span>|<span class="hljs-string"> NO         </span>|<br>|<span class="hljs-string"> ARCHIVE            </span>|<span class="hljs-string"> YES     </span>|<span class="hljs-string"> Archive storage engine                                         </span>|<span class="hljs-string"> NO           </span>|<span class="hljs-string"> NO   </span>|<span class="hljs-string"> NO         </span>|<br>|<span class="hljs-string"> PERFORMANCE_SCHEMA </span>|<span class="hljs-string"> YES     </span>|<span class="hljs-string"> Performance Schema                                             </span>|<span class="hljs-string"> NO           </span>|<span class="hljs-string"> NO   </span>|<span class="hljs-string"> NO         </span>|<br>|<span class="hljs-string"> FEDERATED          </span>|<span class="hljs-string"> NO      </span>|<span class="hljs-string"> Federated MySQL storage engine                                 </span>|<span class="hljs-string"> NULL         </span>|<span class="hljs-string"> NULL </span>|<span class="hljs-string"> NULL       </span>|<br>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+<br>9 rows in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­çš„<code>Support</code>åˆ—è¡¨ç¤ºè¯¥å­˜å‚¨å¼•æ“æ˜¯å¦å¯ç”¨ï¼Œ<code>DEFAULT</code>å€¼ä»£è¡¨æ˜¯å½“å‰æœåŠ¡å™¨ç¨‹åºçš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚<code>Comment</code>åˆ—æ˜¯å¯¹å­˜å‚¨å¼•æ“çš„ä¸€ä¸ªæè¿°ï¼Œè‹±æ–‡çš„ï¼Œå°†å°±ç€çœ‹å§ã€‚<code>Transactions</code>åˆ—ä»£è¡¨è¯¥å­˜å‚¨å¼•æ“æ˜¯å¦æ”¯æŒäº‹åŠ¡å¤„ç†ã€‚<code>XA</code>åˆ—ä»£è¡¨ç€è¯¥å­˜å‚¨å¼•æ“æ˜¯å¦æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ã€‚<code>Savepoints</code>ä»£è¡¨ç€è¯¥å­˜å‚¨å¼•æ“æ˜¯å¦æ”¯æŒéƒ¨åˆ†äº‹åŠ¡å›æ»šã€‚</p><blockquote><p>å°è´´å£«ï¼š å¥½å§ï¼Œä¹Ÿè®¸ä½ å¹¶ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ä¸ªäº‹åŠ¡ã€æ›´åˆ«æåˆ†å¸ƒå¼äº‹åŠ¡äº†ï¼Œè¿™äº›å†…å®¹æˆ‘ä»¬åœ¨åè¾¹çš„ç« èŠ‚ä¼šè¯¦ç»†å” å¨ï¼Œç°åœ¨ç…ä¸€çœ¼çœ‹ä¸ªæ–°é²œå°±å¾—äº†ã€‚</p></blockquote><h3 id="è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“">è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“</h3><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œå­˜å‚¨å¼•æ“æ˜¯è´Ÿè´£å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæå–å’Œå†™å…¥å·¥ä½œçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒçš„è¡¨è®¾ç½®ä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒçš„è¡¨å¯ä»¥æœ‰ä¸åŒçš„ç‰©ç†å­˜å‚¨ç»“æ„ï¼Œä¸åŒçš„æå–å’Œå†™å…¥æ–¹å¼ã€‚</p><h4 id="åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“">åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“</h4><p>æˆ‘ä»¬ä¹‹å‰åˆ›å»ºè¡¨çš„è¯­å¥éƒ½æ²¡æœ‰æŒ‡å®šè¡¨çš„å­˜å‚¨å¼•æ“ï¼Œé‚£å°±ä¼šä½¿ç”¨é»˜è®¤çš„å­˜å‚¨å¼•æ“<code>InnoDB</code>ï¼ˆå½“ç„¶è¿™ä¸ªé»˜è®¤çš„å­˜å‚¨å¼•æ“ä¹Ÿæ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œæˆ‘ä»¬åœ¨åè¾¹çš„ç« èŠ‚ä¸­å†è¯´æ€ä¹ˆæ”¹ï¼‰ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ˜¾å¼çš„æŒ‡å®šä¸€ä¸‹è¡¨çš„å­˜å‚¨å¼•æ“ï¼Œé‚£å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å(<br>    å»ºè¡¨è¯­å¥;<br>) ENGINE <span class="hljs-operator">=</span> å­˜å‚¨å¼•æ“åç§°;<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªå­˜å‚¨å¼•æ“ä¸º<code>MyISAM</code>çš„è¡¨å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> engine_demo_table(<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     i <span class="hljs-type">int</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> ) ENGINE <span class="hljs-operator">=</span> MyISAM;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><h4 id="ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“">ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“</h4><p>å¦‚æœè¡¨å·²ç»å»ºå¥½äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹è¾¹è¿™ä¸ªè¯­å¥æ¥ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å ENGINE <span class="hljs-operator">=</span> å­˜å‚¨å¼•æ“åç§°;<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹<code>engine_demo_table</code>è¡¨çš„å­˜å‚¨å¼•æ“ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; ALTER TABLE engine_demo_table ENGINE = InnoDB;<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">05</span> sec)<br><span class="hljs-attribute">Records</span>: <span class="hljs-number">0</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br><span class="hljs-attribute">mysql</span>&gt;<br></code></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹<code>engine_demo_table</code>çš„è¡¨ç»“æ„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> engine_demo_table\G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>       <span class="hljs-keyword">Table</span>: engine_demo_table<br><span class="hljs-keyword">Create</span> <span class="hljs-keyword">Table</span>: <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `engine_demo_table` (<br>  `i` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span><br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8<br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¯¥è¡¨çš„å­˜å‚¨å¼•æ“å·²ç»æ”¹ä¸º<code>InnoDB</code>äº†ã€‚</p><h1>2.å¯åŠ¨é€‰é¡¹å’Œç³»ç»Ÿå˜é‡</h1><p><code>MySQL</code>å’Œæ‰€æœ‰çš„è½¯ä»¶ä¸€æ ·ï¼Œå…·æœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œè¯¸å¦‚æ˜¯å¦ä½¿ç”¨<code>TCP/IP</code>ã€<code>å¥—æ¥å­—</code>è¿›è¡Œé€šä¿¡ï¼ŒæŸ¥è¯¢ç¼“å­˜ï¼Œæœ€å¤§è¿æ¥æ•°ï¼ŒæŒ‡å®šç«¯å£å·ï¼Œä¸»æœºåœ°å€ç­‰åŠŸèƒ½ã€‚</p><p>æ¥ä¸‹æ¥ç”¨<code>Mac</code>ä¸‹çš„<code>mysqld</code>æ–¹å¼æ¥è¿›è¡Œæ¼”ç¤ºã€‚</p><h2 id="åœ¨å‘½ä»¤è¡Œä¸Šä½¿ç”¨é€‰é¡¹">åœ¨å‘½ä»¤è¡Œä¸Šä½¿ç”¨é€‰é¡¹</h2><p>å¦‚æœæˆ‘ä»¬åœ¨å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºæ—¶åœ¨<code>-h</code>å‚æ•°åè¾¹ç´§è·ŸæœåŠ¡å™¨çš„IPåœ°å€ï¼Œè¿™å°±æ„å‘³ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´éœ€è¦é€šè¿‡<code>TCP/IP</code>ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚å› ä¸ºæˆ‘çš„å®¢æˆ·ç«¯ç¨‹åºå’ŒæœåŠ¡å™¨ç¨‹åºéƒ½è£…åœ¨ä¸€å°è®¡ç®—æœºä¸Šï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å®¢æˆ·ç«¯ç¨‹åºè¿æ¥æœåŠ¡å™¨ç¨‹åºæ—¶æŒ‡å®šçš„ä¸»æœºåæ˜¯<code>127.0.0.1</code>çš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯è¿›ç¨‹å’ŒæœåŠ¡å™¨è¿›ç¨‹ä¹‹é—´ä¼šä½¿ç”¨<code>TCP/IP</code>ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚å¦‚æœæˆ‘ä»¬åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºçš„æ—¶å€™å°±ç¦æ­¢å„å®¢æˆ·ç«¯ä½¿ç”¨<code>TCP/IP</code>ç½‘ç»œè¿›è¡Œé€šä¿¡ï¼Œå¯ä»¥åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºçš„å‘½ä»¤è¡Œé‡Œæ·»åŠ <code>skip-networking</code>å¯åŠ¨é€‰é¡¹ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mysqld --skip-networking <span class="hljs-regexp">//</span>ç¦ç”¨å®¢æˆ·ç«¯ä½¿ç”¨TCP/IPç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šå¯åŠ¨é€‰é¡¹æ—¶éœ€è¦åœ¨é€‰é¡¹åå‰åŠ ä¸Š<code>--</code>å‰ç¼€ã€‚å¦å¤–ï¼Œå¦‚æœé€‰é¡¹åæ˜¯ç”±å¤šä¸ªå•è¯æ„æˆçš„ï¼Œå®ƒä»¬ä¹‹é—´å¯ä»¥ç”±çŸ­åˆ’çº¿<code>-</code>è¿æ¥èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿<code>_</code>è¿æ¥èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´<code>skip-networking</code>å’Œ<code>skip_networking</code>è¡¨ç¤ºçš„å«ä¹‰æ˜¯ç›¸åŒçš„ã€‚æ‰€ä»¥ä¸Šè¾¹çš„å†™æ³•ä¸ä¸‹è¾¹çš„å†™æ³•æ˜¯ç­‰ä»·çš„ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">mysqld <span class="hljs-comment">--skip_networking</span><br></code></pre></td></tr></table></figure><p>åœ¨æŒ‰ç…§ä¸Šè¿°å‘½ä»¤å¯åŠ¨æœåŠ¡å™¨ç¨‹åºåï¼Œå¦‚æœæˆ‘ä»¬å†ä½¿ç”¨<code>mysql</code>æ¥å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºæ—¶ï¼Œå†æŠŠæœåŠ¡å™¨ä¸»æœºåæŒ‡å®šä¸º<code>127.0.0.1</code>ï¼ˆIPåœ°å€çš„å½¢å¼ï¼‰çš„è¯ä¼šæ˜¾ç¤ºè¿æ¥å¤±è´¥ï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs subunit"> mysql -h127.0.0.1 -uroot -p<br>Enter password:<br><br><span class="hljs-keyword">ERROR </span>2003 (HY000): Can&#x27;t connect to MySQL server on &#x27;127.0.0.1&#x27; (61)<br></code></pre></td></tr></table></figure><p>è¿™å°±æ„å‘³ç€æˆ‘ä»¬æŒ‡å®šçš„å¯åŠ¨é€‰é¡¹<code>skip-networking</code>ç”Ÿæ•ˆäº†ï¼</p><p>å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å‰è¾¹è¯´è¿‡å¦‚æœåœ¨åˆ›å»ºè¡¨çš„è¯­å¥ä¸­æ²¡æœ‰æ˜¾å¼æŒ‡å®šè¡¨çš„å­˜å‚¨å¼•æ“çš„è¯ï¼Œé‚£å°±ä¼šé»˜è®¤ä½¿ç”¨<code>InnoDB</code>ä½œä¸ºè¡¨çš„å­˜å‚¨å¼•æ“ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ”¹å˜è¡¨çš„é»˜è®¤å­˜å‚¨å¼•æ“çš„è¯ï¼Œå¯ä»¥è¿™æ ·å†™å¯åŠ¨æœåŠ¡å™¨çš„å‘½ä»¤è¡Œï¼š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">mysqld --<span class="hljs-keyword">default</span>-storage-engine=MyISAM <span class="hljs-comment">//æŒ‡å®šé»˜è®¤å¼•æ“ã€‚</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç°åœ¨å°±å·²ç»æŠŠè¡¨çš„é»˜è®¤å­˜å‚¨å¼•æ“æ”¹ä¸º<code>MyISAM</code>äº†ï¼Œåœ¨å®¢æˆ·ç«¯ç¨‹åºè¿æ¥åˆ°æœåŠ¡å™¨ç¨‹åºåè¯•ç€åˆ›å»ºä¸€ä¸ªè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sys_var_demo(<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     i <span class="hljs-type">INT</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> );<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå®šä¹‰è¯­å¥ä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šè¡¨çš„å­˜å‚¨å¼•æ“ï¼Œåˆ›å»ºæˆåŠŸåå†çœ‹ä¸€ä¸‹è¿™ä¸ªè¡¨çš„ç»“æ„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sys_var_demo\G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>       <span class="hljs-keyword">Table</span>: sys_var_demo<br><span class="hljs-keyword">Create</span> <span class="hljs-keyword">Table</span>: <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `sys_var_demo` (<br>  `i` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span><br>) ENGINE<span class="hljs-operator">=</span>MyISAM <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8<br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¯¥è¡¨çš„å­˜å‚¨å¼•æ“å·²ç»æ˜¯<code>MyISAM</code>äº†ï¼Œè¯´æ˜å¯åŠ¨é€‰é¡¹<code>default-storage-engine</code>ç”Ÿæ•ˆäº†ã€‚</p><p>æ‰€ä»¥åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºçš„å‘½ä»¤è¡Œåè¾¹æŒ‡å®šå¯åŠ¨é€‰é¡¹çš„é€šç”¨æ ¼å¼å°±æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck">--<span class="hljs-comment">å¯åŠ¨é€‰é¡¹1</span><span class="hljs-title">[</span><span class="hljs-comment">=å€¼1</span><span class="hljs-title">]</span> --<span class="hljs-comment">å¯åŠ¨é€‰é¡¹2</span><span class="hljs-title">[</span><span class="hljs-comment">=å€¼2</span><span class="hljs-title">]</span> <span class="hljs-string">.</span><span class="hljs-string">.</span><span class="hljs-string">.</span> --<span class="hljs-comment">å¯åŠ¨é€‰é¡¹n</span><span class="hljs-title">[</span><span class="hljs-comment">=å€¼n</span><span class="hljs-title">]</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å°†å„ä¸ªå¯åŠ¨é€‰é¡¹å†™åˆ°ä¸€è¡Œä¸­ï¼Œå„ä¸ªå¯åŠ¨é€‰é¡¹ä¹‹é—´ä½¿ç”¨ç©ºç™½å­—ç¬¦éš”å¼€ï¼Œåœ¨æ¯ä¸€ä¸ªå¯åŠ¨é€‰é¡¹åç§°å‰è¾¹æ·»åŠ <code>--</code>ã€‚å¯¹äºä¸éœ€è¦å€¼çš„å¯åŠ¨é€‰é¡¹ï¼Œæ¯”æ–¹è¯´<code>skip-networking</code>ï¼Œå®ƒä»¬å°±ä¸éœ€è¦æŒ‡å®šå¯¹åº”çš„å€¼ã€‚å¯¹äºéœ€è¦æŒ‡å®šå€¼çš„å¯åŠ¨é€‰é¡¹ï¼Œæ¯”å¦‚<code>default-storage-engine</code>æˆ‘ä»¬åœ¨æŒ‡å®šè¿™ä¸ªè®¾ç½®é¡¹çš„æ—¶å€™éœ€è¦æ˜¾å¼çš„æŒ‡å®šå®ƒçš„å€¼ï¼Œæ¯”æ–¹è¯´<code>InnoDB</code>ã€<code>MyISAM</code>å•¦ä»€ä¹ˆçš„ï½ åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šæœ‰å€¼çš„å¯åŠ¨é€‰é¡¹æ—¶éœ€è¦æ³¨æ„ï¼Œé€‰é¡¹åã€=ã€é€‰é¡¹å€¼ä¹‹é—´ä¸å¯ä»¥æœ‰ç©ºç™½å­—ç¬¦ï¼Œæ¯”å¦‚å†™æˆä¸‹è¾¹è¿™æ ·å°±æ˜¯ä¸æ­£ç¡®çš„ï¼š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">mysqld --<span class="hljs-keyword">default</span>-storage-engine = MyISAM<br></code></pre></td></tr></table></figure><p>æ¯ä¸ªMySQLç¨‹åºéƒ½æœ‰è®¸å¤šä¸åŒçš„é€‰é¡¹ã€‚å¤§å¤šæ•°ç¨‹åºæä¾›äº†ä¸€ä¸ªâ€“helpé€‰é¡¹ï¼Œä½ å¯ä»¥æŸ¥çœ‹è¯¥ç¨‹åºæ”¯æŒçš„å…¨éƒ¨å¯åŠ¨é€‰é¡¹ä»¥åŠå®ƒä»¬çš„é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>mysql --help</code>å¯ä»¥çœ‹åˆ°<code>mysql</code>ç¨‹åºæ”¯æŒçš„å¯åŠ¨é€‰é¡¹ï¼Œ<code>mysqld_safe --help</code>å¯ä»¥çœ‹åˆ°<code>mysqld_safe</code>ç¨‹åºæ”¯æŒçš„å¯åŠ¨é€‰é¡¹ã€‚æŸ¥çœ‹<code>mysqld</code>æ”¯æŒçš„å¯åŠ¨é€‰é¡¹æœ‰äº›ç‰¹åˆ«ï¼Œéœ€è¦ä½¿ç”¨<code>mysqld --verbose --help</code>ã€‚</p><h3 id="é€‰é¡¹çš„é•¿å½¢å¼å’ŒçŸ­å½¢å¼">é€‰é¡¹çš„é•¿å½¢å¼å’ŒçŸ­å½¢å¼</h3><p>æˆ‘ä»¬å‰è¾¹æåˆ°çš„<code>skip-networking</code>ã€<code>default-storage-engine</code>ç§°ä¹‹ä¸ºé•¿å½¢å¼çš„é€‰é¡¹ï¼ˆå› ä¸ºå®ƒä»¬å¾ˆé•¿ï¼‰ï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”ä¸ºäº†æˆ‘ä»¬ä½¿ç”¨çš„æ–¹ä¾¿ï¼Œå¯¹äºä¸€äº›å¸¸ç”¨çš„é€‰é¡¹æä¾›äº†çŸ­å½¢å¼ï¼Œæˆ‘ä»¬åˆ—ä¸¾ä¸€äº›å…·æœ‰çŸ­å½¢å¼çš„å¯åŠ¨é€‰é¡¹æ¥ç…ç…ï¼ˆ<code>MySQL</code>æ”¯æŒçš„çŸ­å½¢å¼é€‰é¡¹å¤ªå¤šäº†ï¼Œå…¨åˆ—å‡ºæ¥ä¼šåˆ·å±çš„ï¼‰ï¼š</p><table><thead><tr><th>é•¿å½¢å¼</th><th>çŸ­å½¢å¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>--host</code></td><td><code>-h</code></td><td>ä¸»æœºå</td></tr><tr><td><code>--user</code></td><td><code>-u</code></td><td>ç”¨æˆ·å</td></tr><tr><td><code>--password</code></td><td><code>-p</code></td><td>å¯†ç </td></tr><tr><td><code>--port</code></td><td><code>-P</code></td><td>ç«¯å£</td></tr><tr><td><code>--version</code></td><td><code>-V</code></td><td>ç‰ˆæœ¬ä¿¡æ¯</td></tr></tbody></table><p>çŸ­å½¢å¼çš„é€‰é¡¹ååªæœ‰ä¸€ä¸ªå­—æ¯ï¼Œä¸ä½¿ç”¨é•¿å½¢å¼é€‰é¡¹æ—¶éœ€è¦åœ¨é€‰é¡¹åå‰åŠ ä¸¤ä¸ªçŸ­åˆ’çº¿<code>--</code>ä¸åŒçš„æ˜¯ï¼Œä½¿ç”¨çŸ­å½¢å¼é€‰é¡¹æ—¶åœ¨é€‰é¡¹åå‰åªåŠ ä¸€ä¸ªçŸ­åˆ’çº¿<code>-</code>å‰ç¼€ã€‚æœ‰ä¸€äº›çŸ­å½¢å¼çš„é€‰é¡¹æˆ‘ä»¬ä¹‹å‰å·²ç»æ¥è§¦è¿‡äº†ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºæ—¶æŒ‡å®šç›‘å¬çš„ç«¯å£å·ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysqld</span> -P<span class="hljs-number">3307</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨çŸ­å½¢å¼æŒ‡å®šå¯åŠ¨é€‰é¡¹æ—¶ï¼Œé€‰é¡¹åå’Œé€‰é¡¹å€¼ä¹‹é—´å¯ä»¥æ²¡æœ‰é—´éš™ï¼Œæˆ–è€…ç”¨ç©ºç™½å­—ç¬¦éš”å¼€ï¼ˆ<code>-p</code>é€‰é¡¹æœ‰äº›ç‰¹æ®Šï¼Œ<code>-p</code>å’Œå¯†ç å€¼ä¹‹é—´ä¸èƒ½æœ‰ç©ºç™½å­—ç¬¦ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸Šè¾¹çš„å‘½ä»¤å½¢å¼å’Œä¸‹è¾¹çš„æ˜¯ç­‰ä»·çš„ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysqld</span> -P <span class="hljs-number">3307</span><br></code></pre></td></tr></table></figure><p>å¦å¤–ï¼Œé€‰é¡¹åæ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œæ¯”å¦‚<code>-p</code>å’Œ<code>-P</code>é€‰é¡¹æ‹¥æœ‰å®Œå…¨ä¸åŒçš„å«ä¹‰ï¼Œå¤§å®¶éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚</p><h2 id="é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨é€‰é¡¹">é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨é€‰é¡¹</h2><p>åœ¨å‘½ä»¤è¡Œä¸­è®¾ç½®å¯åŠ¨é€‰é¡¹åªå¯¹å½“æ¬¡å¯åŠ¨ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸‹ä¸€æ¬¡é‡å¯ç¨‹åºçš„æ—¶å€™æˆ‘ä»¬è¿˜æƒ³ä¿ç•™è¿™äº›å¯åŠ¨é€‰é¡¹çš„è¯ï¼Œè¿˜å¾—é‡å¤æŠŠè¿™äº›é€‰é¡¹å†™åˆ°å¯åŠ¨å‘½ä»¤è¡Œä¸­ï¼Œè¿™æ ·çœŸçš„ç¥çƒ¦å”‰ï¼äºæ˜¯è®¾è®¡<code>MySQL</code>çš„å¤§å”ä»¬æå‡ºä¸€ç§<code>é…ç½®æ–‡ä»¶</code>ï¼ˆä¹Ÿç§°ä¸º<code>é€‰é¡¹æ–‡ä»¶</code>ï¼‰çš„æ¦‚å¿µï¼Œæˆ‘ä»¬æŠŠéœ€è¦è®¾ç½®çš„å¯åŠ¨é€‰é¡¹éƒ½å†™åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œæ¯æ¬¡å¯åŠ¨æœåŠ¡å™¨çš„æ—¶å€™éƒ½ä»è¿™ä¸ªæ–‡ä»¶é‡ŒåŠ è½½ç›¸åº”çš„å¯åŠ¨é€‰é¡¹ã€‚ç”±äºè¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥é•¿ä¹…çš„ä¿å­˜åœ¨è®¡ç®—æœºçš„ç¡¬ç›˜é‡Œï¼Œæ‰€ä»¥åªéœ€æˆ‘ä»¬é…ç½®ä¸€æ¬¡ï¼Œä»¥åå°±éƒ½ä¸ç”¨æ˜¾å¼çš„æŠŠå¯åŠ¨é€‰é¡¹éƒ½å†™åœ¨å¯åŠ¨å‘½ä»¤è¡Œä¸­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨èä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼æ¥è®¾ç½®å¯åŠ¨é€‰é¡¹ã€‚</p><h3 id="é…ç½®æ–‡ä»¶çš„è·¯å¾„">é…ç½®æ–‡ä»¶çš„è·¯å¾„</h3><p><code>MySQL</code>ç¨‹åºåœ¨å¯åŠ¨æ—¶ä¼šå¯»æ‰¾å¤šä¸ªè·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œè¿™äº›è·¯å¾„æœ‰çš„æ˜¯å›ºå®šçš„ï¼Œæœ‰çš„æ˜¯å¯ä»¥åœ¨å‘½ä»¤è¡ŒæŒ‡å®šçš„ã€‚æ ¹æ®æ“ä½œç³»ç»Ÿçš„ä¸åŒï¼Œé…ç½®æ–‡ä»¶çš„è·¯å¾„ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œæˆ‘ä»¬åˆ†å¼€çœ‹ä¸€ä¸‹ã€‚</p><h4 id="Windowsæ“ä½œç³»ç»Ÿçš„é…ç½®æ–‡ä»¶">Windowsæ“ä½œç³»ç»Ÿçš„é…ç½®æ–‡ä»¶</h4><p>åœ¨<code>Windows</code>æ“ä½œç³»ç»Ÿä¸­ï¼Œ<code>MySQL</code>ä¼šæŒ‰ç…§ä¸‹åˆ—è·¯å¾„æ¥å¯»æ‰¾é…ç½®æ–‡ä»¶ï¼š</p><table><thead><tr><th>è·¯å¾„å</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>%WINDIR%\my.ini</code>ï¼Œ <code>%WINDIR%\my.cnf</code></td><td></td></tr><tr><td><code>C:\my.ini</code>ï¼Œ <code>C:\my.cnf</code></td><td></td></tr><tr><td><code>BASEDIR\my.ini</code>ï¼Œ <code>BASEDIR\my.cnf</code></td><td></td></tr><tr><td><code>defaults-extra-file</code></td><td>å‘½ä»¤è¡ŒæŒ‡å®šçš„é¢å¤–é…ç½®æ–‡ä»¶è·¯å¾„</td></tr><tr><td><code>%APPDATA%\MySQL\.mylogin.cnf</code></td><td>ç™»å½•è·¯å¾„é€‰é¡¹ï¼ˆä»…é™å®¢æˆ·ç«¯ï¼‰</td></tr></tbody></table><p>åœ¨é˜…è¯»è¿™äº›<code>Windows</code>æ“ä½œç³»ç»Ÿä¸‹é…ç½®æ–‡ä»¶è·¯å¾„çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸€äº›äº‹æƒ…ï¼š</p><ul><li><p>åœ¨ç»™å®šçš„å‰ä¸‰ä¸ªè·¯å¾„ä¸­ï¼Œé…ç½®æ–‡ä»¶å¯ä»¥ä½¿ç”¨<code>.ini</code>çš„æ‰©å±•åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>.cnf</code>çš„æ‰©å±•åã€‚</p></li><li><p><code>%WINDIR%</code>æŒ‡çš„æ˜¯ä½ æœºå™¨ä¸Š<code>Windows</code>ç›®å½•çš„ä½ç½®ï¼Œé€šå¸¸æ˜¯<code>C:\WINDOWS</code>ï¼Œå¦‚æœä½ ä¸ç¡®å®šï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹ï¼š</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">echo</span> <span class="hljs-variable">%WINDIR%</span><br></code></pre></td></tr></table></figure></li><li><p><code>BASEDIR</code>æŒ‡çš„æ˜¯<code>MySQL</code>å®‰è£…ç›®å½•çš„è·¯å¾„ï¼Œåœ¨æˆ‘çš„<code>Windows</code>æœºå™¨ä¸Šçš„<code>BASEDIR</code>çš„å€¼æ˜¯ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">C:<span class="hljs-symbol">\P</span>rogram Files<span class="hljs-symbol">\M</span>ySQL<span class="hljs-symbol">\M</span>ySQL Server 5.7<br></code></pre></td></tr></table></figure></li><li><p>ç¬¬å››ä¸ªè·¯å¾„æŒ‡çš„æ˜¯æˆ‘ä»¬åœ¨å¯åŠ¨ç¨‹åºæ—¶å¯ä»¥é€šè¿‡æŒ‡å®š<code>defaults-extra-file</code>å‚æ•°çš„å€¼æ¥æ·»åŠ é¢å¤–çš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸Šå¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">mysqld --defaults-extra-file=C:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\x</span>iaohaizi<span class="hljs-symbol">\m</span>y_extra_file.txt<br></code></pre></td></tr></table></figure><p>è¿™æ ·<code>MySQL</code>æœåŠ¡å™¨å¯åŠ¨æ—¶å°±å¯ä»¥é¢å¤–åœ¨<code>C:\Users\xiaohaizi\my_extra_file.txt</code>è¿™ä¸ªè·¯å¾„ä¸‹æŸ¥æ‰¾é…ç½®æ–‡ä»¶ã€‚</p></li><li><p><code>%APPDATA%</code>è¡¨ç¤º<code>Windows</code>åº”ç”¨ç¨‹åºæ•°æ®ç›®å½•çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æŸ¥çœ‹ï¼š</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">echo</span> <span class="hljs-variable">%APPDATA%</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªåä¸º<code>.mylogin.cnf</code>é…ç½®æ–‡ä»¶æœ‰ç‚¹å„¿ç‰¹æ®Šï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼ˆå…¶ä»–çš„é…ç½®æ–‡ä»¶éƒ½æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼‰ï¼Œè€Œæ˜¯ä½¿ç”¨<code>mysql_config_editor</code>å®ç”¨ç¨‹åºåˆ›å»ºçš„åŠ å¯†æ–‡ä»¶ã€‚æ–‡ä»¶ä¸­åªèƒ½åŒ…å«ä¸€äº›ç”¨äºå¯åŠ¨å®¢æˆ·ç«¯è½¯ä»¶æ—¶è¿æ¥æœåŠ¡å™¨çš„ä¸€äº›é€‰é¡¹ï¼ŒåŒ…æ‹¬ <code>host</code>ã€<code>user</code>ã€<code>password</code>ã€<code>port</code>å’Œ <code>socket</code>ã€‚è€Œä¸”å®ƒåªèƒ½è¢«å®¢æˆ·ç«¯ç¨‹åºæ‰€ä½¿ç”¨ã€‚</p></li></ul><blockquote><p>å°è´´å£«ï¼š mysql_config_editorå®ç”¨ç¨‹åºå…¶å®æ˜¯MySQLå®‰è£…ç›®å½•ä¸‹çš„binç›®å½•ä¸‹çš„ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸ªå®ç”¨ç¨‹åºæœ‰ä¸“ç”¨çš„è¯­æ³•æ¥ç”Ÿæˆæˆ–ä¿®æ”¹ .mylogin.cnf æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå¦‚ä½•ä½¿ç”¨è¿™ä¸ªç¨‹åºä¸æ˜¯æˆ‘ä»¬è®¨è®ºçš„ä¸»é¢˜ï¼Œå¯ä»¥åˆ°MySQLçš„å®˜æ–¹æ–‡æ¡£ä¸­æŸ¥çœ‹ã€‚</p></blockquote><h4 id="ç±»Unixæ“ä½œç³»ç»Ÿä¸­çš„é…ç½®æ–‡ä»¶">ç±»Unixæ“ä½œç³»ç»Ÿä¸­çš„é…ç½®æ–‡ä»¶</h4><p>åœ¨ç±»<code>UNIX</code>æ“ä½œç³»ç»Ÿä¸­ï¼Œ<code>MySQL</code>ä¼šæŒ‰ç…§ä¸‹åˆ—è·¯å¾„æ¥å¯»æ‰¾é…ç½®æ–‡ä»¶ï¼š</p><table><thead><tr><th>è·¯å¾„å</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>/etc/my.cnf</code></td><td></td></tr><tr><td><code>/etc/mysql/my.cnf</code></td><td></td></tr><tr><td><code>SYSCONFDIR/my.cnf</code></td><td></td></tr><tr><td><code>$MYSQL_HOME/my.cnf</code></td><td>ç‰¹å®šäºæœåŠ¡å™¨çš„é€‰é¡¹ï¼ˆä»…é™æœåŠ¡å™¨ï¼‰</td></tr><tr><td><code>defaults-extra-file</code></td><td>å‘½ä»¤è¡ŒæŒ‡å®šçš„é¢å¤–é…ç½®æ–‡ä»¶è·¯å¾„</td></tr><tr><td><code>~/.my.cnf</code></td><td>ç”¨æˆ·ç‰¹å®šé€‰é¡¹</td></tr><tr><td><code>~/.mylogin.cnf</code></td><td>ç”¨æˆ·ç‰¹å®šçš„ç™»å½•è·¯å¾„é€‰é¡¹ï¼ˆä»…é™å®¢æˆ·ç«¯ï¼‰</td></tr></tbody></table><p>åœ¨é˜…è¯»è¿™äº›<code>UNIX</code>æ“ä½œç³»ç»Ÿä¸‹é…ç½®æ–‡ä»¶è·¯å¾„çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸€äº›äº‹æƒ…ï¼š</p><ul><li><p><code>SYSCONFDIR</code>è¡¨ç¤ºåœ¨ä½¿ç”¨<code>CMake</code>æ„å»º<code>MySQL</code>æ—¶ä½¿ç”¨<code>SYSCONFDIR</code>é€‰é¡¹æŒ‡å®šçš„ç›®å½•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä½äºç¼–è¯‘å®‰è£…ç›®å½•ä¸‹çš„<code>etc</code>ç›®å½•ã€‚</p><blockquote><p>å°è´´å£«ï¼š å¦‚æœä½ ä¸æ‡‚å•¥æ˜¯ä¸ªCMAKEï¼Œå•¥æ˜¯ä¸ªç¼–è¯‘ï¼Œé‚£å°±è·³è¿‡å§ï¼Œå¯¹æˆ‘ä»¬åç»­çš„æ–‡ç« æ²¡å•¥å½±å“ã€‚</p></blockquote></li><li><p><code>MYSQL_HOME</code>æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œè¯¥å˜é‡çš„å€¼æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„ï¼Œæˆ‘ä»¬æƒ³è®¾ç½®å°±è®¾ç½®ï¼Œä¸æƒ³è®¾ç½®å°±ä¸è®¾ç½®ã€‚è¯¥å˜é‡çš„å€¼ä»£è¡¨ä¸€ä¸ªè·¯å¾„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯¥è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ª<code>my.cnf</code>é…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­åªèƒ½æ”¾ç½®å…³äºå¯åŠ¨æœåŠ¡å™¨ç¨‹åºç›¸å…³çš„é€‰é¡¹ï¼ˆè¨€å¤–ä¹‹æ„å°±æ˜¯å…¶ä»–çš„é…ç½®æ–‡ä»¶æ—¢èƒ½å­˜æ”¾æœåŠ¡å™¨ç›¸å…³çš„é€‰é¡¹ä¹Ÿèƒ½å­˜æ”¾å®¢æˆ·ç«¯ç›¸å…³çš„é€‰é¡¹ï¼Œ<code>.mylogin.cnf</code>é™¤å¤–ï¼Œå®ƒåªèƒ½å­˜æ”¾å®¢æˆ·ç«¯ç›¸å…³çš„ä¸€äº›é€‰é¡¹ï¼‰ã€‚</p><blockquote><p>å°è´´å£«ï¼š å¦‚æœå¤§å®¶ä½¿ç”¨mysqld_safeå¯åŠ¨æœåŠ¡å™¨ç¨‹åºï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿæ²¡æœ‰ä¸»åŠ¨è®¾ç½®è¿™ä¸ªMySQL_HOMEç¯å¢ƒå˜é‡çš„å€¼ï¼Œé‚£è¿™ä¸ªç¯å¢ƒå˜é‡çš„å€¼å°†è‡ªåŠ¨è¢«è®¾ç½®ä¸ºMySQLçš„å®‰è£…ç›®å½•ï¼Œä¹Ÿå°±æ˜¯MySQLæœåŠ¡å™¨å°†ä¼šåœ¨å®‰è£…ç›®å½•ä¸‹æŸ¥æ‰¾åä¸ºmy.cnfé…ç½®æ–‡ä»¶ï¼ˆåˆ«å¿˜äº†mysql.serverä¼šè°ƒç”¨mysqld_safeï¼Œæ‰€ä»¥ä½¿ç”¨mysql.serverå¯åŠ¨æœåŠ¡å™¨æ—¶ä¹Ÿä¼šåœ¨å®‰è£…ç›®å½•ä¸‹æŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼‰ã€‚</p></blockquote></li><li><p>åˆ—è¡¨ä¸­çš„æœ€åä¸¤ä¸ªä»¥<code>~</code>å¼€å¤´çš„è·¯å¾„æ˜¯ç”¨æˆ·ç›¸å…³çš„ï¼Œç±»<code>UNIX</code> ç³»ç»Ÿä¸­éƒ½æœ‰ä¸€ä¸ªå½“å‰ç™»é™†ç”¨æˆ·çš„æ¦‚å¿µï¼Œæ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥æœ‰ä¸€ä¸ªç”¨æˆ·ç›®å½•ï¼Œ<code>~</code>å°±ä»£è¡¨è¿™ä¸ªç”¨æˆ·ç›®å½•ï¼Œå¤§å®¶å¯ä»¥æŸ¥çœ‹<code>HOME</code>ç¯å¢ƒå˜é‡çš„å€¼æ¥ç¡®å®šä¸€ä¸‹å½“å‰ç”¨æˆ·çš„ç”¨æˆ·ç›®å½•ï¼Œæ¯”æ–¹è¯´æˆ‘çš„<code>macOS</code>æœºå™¨ä¸Šçš„ç”¨æˆ·ç›®å½•å°±æ˜¯<code>/Users/xiaohaizi</code>ã€‚ä¹‹æ‰€ä»¥è¯´åˆ—è¡¨ä¸­æœ€åä¸¤ä¸ªé…ç½®æ–‡ä»¶æ˜¯ç”¨æˆ·ç›¸å…³çš„ï¼Œæ˜¯å› ä¸ºä¸åŒçš„ç±»<code>UNIX</code>ç³»ç»Ÿçš„ç”¨æˆ·éƒ½å¯ä»¥åœ¨è‡ªå·±çš„ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»º<code>.my.cnf</code>æˆ–è€…<code>.mylogin.cnf</code>ï¼Œæ¢å¥è¯è¯´ï¼Œä¸åŒç™»å½•ç”¨æˆ·ä½¿ç”¨çš„<code>.my.cnf</code>æˆ–è€…<code>.mylogin.cnf</code>é…ç½®æ–‡ä»¶æ˜¯ä¸åŒçš„ã€‚</p></li><li><p><code>defaults-extra-file</code>çš„å«ä¹‰ä¸Windowsä¸­çš„ä¸€æ ·ã€‚</p></li><li><p><code>.mylogin.cnf</code>çš„å«ä¹‰ä¹ŸåŒ<code>Windows</code>ä¸­çš„ä¸€æ ·ï¼Œå†æ¬¡å¼ºè°ƒä¸€éï¼Œå®ƒä¸æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œåªèƒ½ä½¿ç”¨<code>mysql_config_editor</code>å®ç”¨ç¨‹åºå»åˆ›å»ºæˆ–ä¿®æ”¹ï¼Œç”¨äºå­˜æ”¾å®¢æˆ·ç«¯ç™»é™†æœåŠ¡å™¨æ—¶çš„ç›¸å…³é€‰é¡¹ã€‚</p></li></ul><p>è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æˆ‘çš„è®¡ç®—æœºä¸­è¿™å‡ ä¸ªè·¯å¾„ä¸­çš„ä»»æ„ä¸€ä¸ªéƒ½å¯ä»¥å½“ä½œé…ç½®æ–‡ä»¶æ¥ä½¿ç”¨ï¼Œå¦‚æœå®ƒä»¬ä¸å­˜åœ¨ï¼Œä½ å¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªï¼Œæ¯”æ–¹è¯´æˆ‘æ‰‹åŠ¨åœ¨<code>~/.my.cnf</code>è¿™ä¸ªè·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬åœ¨å” å¨å¦‚ä½•å¯åŠ¨<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºçš„æ—¶å€™è¯´è¿‡ï¼Œä½¿ç”¨<code>mysqld_safe</code>ç¨‹åºå¯åŠ¨æœåŠ¡å™¨æ—¶ï¼Œä¼šé—´æ¥è°ƒç”¨<code>mysqld</code>ï¼Œæ‰€ä»¥å¯¹äºä¼ é€’ç»™<code>mysqld_safe</code>çš„å¯åŠ¨é€‰é¡¹æ¥è¯´ï¼Œå¦‚æœ<code>mysqld_safe</code>ç¨‹åºä¸å¤„ç†ï¼Œä¼šæ¥ç€ä¼ é€’ç»™<code>mysqld</code>ç¨‹åºå¤„ç†ã€‚æ¯”æ–¹è¯´<code>skip-networking</code>é€‰é¡¹æ˜¯ç”±<code>mysqld</code>å¤„ç†çš„ï¼Œ<code>mysqld_safe</code>å¹¶ä¸å¤„ç†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸Šè¿™æ ·æ‰§è¡Œï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">mysqld_safe <span class="hljs-comment">--skip-networking</span><br></code></pre></td></tr></table></figure><p>åˆ™åœ¨<code>mysqld_safe</code>è°ƒç”¨<code>mysqld</code>æ—¶ï¼Œä¼šæŠŠå®ƒå¤„ç†ä¸äº†çš„è¿™ä¸ª<code>skip-networking</code>é€‰é¡¹äº¤ç»™<code>mysqld</code>å¤„ç†ã€‚</p><h4 id="é…ç½®æ–‡ä»¶çš„å†…å®¹">é…ç½®æ–‡ä»¶çš„å†…å®¹</h4><p>ä¸åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šå¯åŠ¨é€‰é¡¹ä¸åŒçš„æ˜¯ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„å¯åŠ¨é€‰é¡¹è¢«åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªç»„ï¼Œæ¯ä¸ªç»„æœ‰ä¸€ä¸ªç»„åï¼Œç”¨ä¸­æ‹¬å·<code>[]</code>æ‰©èµ·æ¥ï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs clojure">[server]<br>(å…·ä½“çš„å¯åŠ¨é€‰é¡¹...)<br><br>[mysqld]<br>(å…·ä½“çš„å¯åŠ¨é€‰é¡¹...)<br><br>[mysqld_safe]<br>(å…·ä½“çš„å¯åŠ¨é€‰é¡¹...)<br><br>[client]<br>(å…·ä½“çš„å¯åŠ¨é€‰é¡¹...)<br><br>[mysql]<br>(å…·ä½“çš„å¯åŠ¨é€‰é¡¹...)<br><br>[mysqladmin]<br>(å…·ä½“çš„å¯åŠ¨é€‰é¡¹...)<br></code></pre></td></tr></table></figure><p>åƒè¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œå°±å®šä¹‰äº†è®¸å¤šä¸ªç»„ï¼Œç»„ååˆ†åˆ«æ˜¯<code>server</code>ã€<code>mysqld</code>ã€<code>mysqld_safe</code>ã€<code>client</code>ã€<code>mysql</code>ã€<code>mysqladmin</code>ã€‚æ¯ä¸ªç»„ä¸‹è¾¹å¯ä»¥å®šä¹‰è‹¥å¹²ä¸ªå¯åŠ¨é€‰é¡¹ï¼Œæˆ‘ä»¬ä»¥<code>[server]</code>ç»„ä¸ºä¾‹æ¥çœ‹ä¸€ä¸‹å¡«å†™å¯åŠ¨é€‰é¡¹çš„å½¢å¼ï¼ˆå…¶ä»–ç»„ä¸­å¯åŠ¨é€‰é¡¹çš„å½¢å¼æ˜¯ä¸€æ ·çš„ï¼‰ï¼š</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gcode">[server]<br>optio<span class="hljs-symbol">n1</span>     <span class="hljs-attr">#è¿™æ˜¯option1</span>ï¼Œè¯¥é€‰é¡¹ä¸éœ€è¦é€‰é¡¹å€¼<br>optio<span class="hljs-symbol">n2</span> = value<span class="hljs-number">2</span>      <span class="hljs-attr">#è¿™æ˜¯option2</span>ï¼Œè¯¥é€‰é¡¹éœ€è¦é€‰é¡¹å€¼<br>...<br></code></pre></td></tr></table></figure><p>åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå¯åŠ¨é€‰é¡¹çš„è¯­æ³•ç±»ä¼¼äºå‘½ä»¤è¡Œè¯­æ³•ï¼Œä½†æ˜¯<strong>é…ç½®æ–‡ä»¶ä¸­åªèƒ½ä½¿ç”¨é•¿å½¢å¼çš„é€‰é¡¹ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„å¯åŠ¨é€‰é¡¹ä¸å…è®¸åŠ <code>--</code>å‰ç¼€ï¼Œå¹¶ä¸”æ¯è¡ŒåªæŒ‡å®šä¸€ä¸ªé€‰é¡¹ï¼Œè€Œä¸”<code>=</code>å‘¨å›´å¯ä»¥æœ‰ç©ºç™½å­—ç¬¦</strong>ï¼ˆå‘½ä»¤è¡Œä¸­é€‰é¡¹åã€<code>=</code>ã€é€‰é¡¹å€¼ä¹‹é—´ä¸å…è®¸æœ‰ç©ºç™½å­—ç¬¦ï¼‰ã€‚å¦å¤–ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>#</code>æ¥æ·»åŠ æ³¨é‡Šï¼Œä»<code>#</code>å‡ºç°ç›´åˆ°è¡Œå°¾çš„å†…å®¹éƒ½å±äºæ³¨é‡Šå†…å®¹ï¼Œè¯»å–é…ç½®æ–‡ä»¶æ—¶ä¼šå¿½ç•¥è¿™äº›æ³¨é‡Šå†…å®¹ã€‚ä¸ºäº†å¤§å®¶æ›´å®¹æ˜“å¯¹æ¯”å¯åŠ¨é€‰é¡¹åœ¨å‘½ä»¤è¡Œå’Œé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„åŒºåˆ«ï¼Œæˆ‘ä»¬å†æŠŠå‘½ä»¤è¡Œä¸­æŒ‡å®š<code>option1</code>å’Œ<code>option2</code>ä¸¤ä¸ªé€‰é¡¹çš„æ ¼å¼å†™ä¸€éçœ‹çœ‹ï¼š</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck">--<span class="hljs-comment">option1</span> --<span class="hljs-comment">option2=value2</span><br></code></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ä¸­ä¸åŒçš„é€‰é¡¹ç»„æ˜¯ç»™ä¸åŒçš„å¯åŠ¨å‘½ä»¤ä½¿ç”¨çš„ï¼Œå¦‚æœé€‰é¡¹ç»„åç§°ä¸ç¨‹åºåç§°ç›¸åŒï¼Œåˆ™ç»„ä¸­çš„é€‰é¡¹å°†ä¸“é—¨åº”ç”¨äºè¯¥ç¨‹åºã€‚ä¾‹å¦‚ï¼Œ <code>[mysqld]</code>å’Œ<code>[mysql]</code>ç»„åˆ†åˆ«åº”ç”¨äº<code>mysqld</code>æœåŠ¡å™¨ç¨‹åºå’Œ<code>mysql</code>å®¢æˆ·ç«¯ç¨‹åºã€‚ä¸è¿‡æœ‰ä¸¤ä¸ªé€‰é¡¹ç»„æ¯”è¾ƒç‰¹åˆ«ï¼š</p><ul><li><code>[server]</code>ç»„ä¸‹è¾¹çš„å¯åŠ¨é€‰é¡¹å°†ä½œç”¨äºæ‰€æœ‰çš„æœåŠ¡å™¨ç¨‹åºã€‚</li><li><code>[client]</code>ç»„ä¸‹è¾¹çš„å¯åŠ¨é€‰é¡¹å°†ä½œç”¨äºæ‰€æœ‰çš„å®¢æˆ·ç«¯ç¨‹åºã€‚</li></ul><p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œ<code>mysqld_safe</code>å’Œ<code>mysql.server</code>è¿™ä¸¤ä¸ªç¨‹åºåœ¨å¯åŠ¨æ—¶éƒ½ä¼šè¯»å–<code>[mysqld]</code>é€‰é¡¹ç»„ä¸­çš„å†…å®¹ã€‚ä¸ºäº†ç›´è§‚æ„Ÿå—ä¸€ä¸‹ï¼Œæˆ‘ä»¬æŒ‘ä¸€äº›å¯åŠ¨å‘½ä»¤æ¥çœ‹ä¸€ä¸‹å®ƒä»¬èƒ½è¯»å–çš„é€‰é¡¹ç»„éƒ½æœ‰å“ªäº›ï¼š</p><table><thead><tr><th>å¯åŠ¨å‘½ä»¤</th><th>ç±»åˆ«</th><th>èƒ½è¯»å–çš„ç»„</th></tr></thead><tbody><tr><td><code>mysqld</code></td><td>å¯åŠ¨æœåŠ¡å™¨</td><td><code>[mysqld]</code>ã€<code>[server]</code></td></tr><tr><td><code>mysqld_safe</code></td><td>å¯åŠ¨æœåŠ¡å™¨</td><td><code>[mysqld]</code>ã€<code>[server]</code>ã€<code>[mysqld_safe]</code></td></tr><tr><td><code>mysql.server</code></td><td>å¯åŠ¨æœåŠ¡å™¨</td><td><code>[mysqld]</code>ã€<code>[server]</code>ã€<code>[mysql.server]</code></td></tr><tr><td><code>mysql</code></td><td>å¯åŠ¨å®¢æˆ·ç«¯</td><td><code>[mysql]</code>ã€<code>[client]</code></td></tr><tr><td><code>mysqladmin</code></td><td>å¯åŠ¨å®¢æˆ·ç«¯</td><td><code>[mysqladmin]</code>ã€<code>[client]</code></td></tr><tr><td><code>mysqldump</code></td><td>å¯åŠ¨å®¢æˆ·ç«¯</td><td><code>[mysqldump]</code>ã€<code>[client]</code></td></tr></tbody></table><p>ç°åœ¨æˆ‘ä»¬ä»¥<code>macOS</code>æ“ä½œç³»ç»Ÿä¸ºä¾‹ï¼Œåœ¨<code>/etc/mysql/my.cnf</code>è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€äº›å†…å®¹ï¼ˆ<code>Windows</code>ç³»ç»Ÿå‚è€ƒä¸Šè¾¹æåˆ°çš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼‰ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[<span class="hljs-keyword">server</span>]<br>skip-networking<br><span class="hljs-keyword">default</span>-<span class="hljs-keyword">storage</span>-engine=MyISAM<br></code></pre></td></tr></table></figure><p>ç„¶åç›´æ¥ç”¨<code>mysqld</code>å¯åŠ¨æœåŠ¡å™¨ç¨‹åºï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">mysqld</span><br></code></pre></td></tr></table></figure><p>è™½ç„¶åœ¨å‘½ä»¤è¡Œæ²¡æœ‰æ·»åŠ å¯åŠ¨é€‰é¡¹ï¼Œä½†æ˜¯åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šé»˜è®¤çš„åˆ°æˆ‘ä»¬ä¸Šè¾¹æåˆ°çš„é…ç½®æ–‡ä»¶è·¯å¾„ä¸‹æŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­å°±åŒ…æ‹¬<code>/etc/mysql/my.cnf</code>ã€‚åˆç”±äº<code>mysqld</code>å‘½ä»¤å¯ä»¥è¯»å–<code>[server]</code>é€‰é¡¹ç»„çš„å†…å®¹ï¼Œæ‰€ä»¥<code>skip-networking</code>å’Œ<code>default-storage-engine=MyISAM</code>è¿™ä¸¤ä¸ªé€‰é¡¹æ˜¯ç”Ÿæ•ˆçš„ã€‚ä½ å¯ä»¥æŠŠè¿™äº›å¯åŠ¨é€‰é¡¹æ”¾åœ¨<code>[client]</code>ç»„é‡Œå†è¯•è¯•ç”¨<code>mysqld</code>å¯åŠ¨æœåŠ¡å™¨ç¨‹åºï¼Œçœ‹ä¸€ä¸‹é‡Œè¾¹çš„å¯åŠ¨é€‰é¡¹ç”Ÿæ•ˆä¸ï¼ˆå‰§é€ä¸€ä¸‹ï¼Œä¸ç”Ÿæ•ˆï¼‰ã€‚</p><blockquote><p>å°è´´å£«ï¼š å¦‚æœæˆ‘ä»¬æƒ³æŒ‡å®šmysql.serverç¨‹åºçš„å¯åŠ¨å‚æ•°ï¼Œåˆ™å¿…é¡»å°†å®ƒä»¬æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯æ”¾åœ¨å‘½ä»¤è¡Œä¸­ã€‚mysql.serverä»…æ”¯æŒstartå’Œstopä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ã€‚</p></blockquote><h4 id="ç‰¹å®šMySQLç‰ˆæœ¬çš„ä¸“ç”¨é€‰é¡¹ç»„">ç‰¹å®šMySQLç‰ˆæœ¬çš„ä¸“ç”¨é€‰é¡¹ç»„</h4><p>æˆ‘ä»¬å¯ä»¥åœ¨é€‰é¡¹ç»„çš„åç§°ååŠ ä¸Šç‰¹å®šçš„<code>MySQL</code>ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚å¯¹äº<code>[mysqld]</code>é€‰é¡¹ç»„æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª<code>[mysqld-5.7]</code>çš„é€‰é¡¹ç»„ï¼Œå®ƒçš„å«ä¹‰å’Œ<code>[mysqld]</code>ä¸€æ ·ï¼Œåªä¸è¿‡åªæœ‰ç‰ˆæœ¬å·ä¸º<code>5.7</code>çš„<code>mysqld</code>ç¨‹åºæ‰èƒ½ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ç»„ä¸­çš„é€‰é¡¹ã€‚</p><h4 id="é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§">é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§</h4><p>æˆ‘ä»¬å‰è¾¹å” å¨è¿‡<code>MySQL</code>å°†åœ¨æŸäº›å›ºå®šçš„è·¯å¾„ä¸‹æœç´¢é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®š<code>defaults-extra-file</code>å¯åŠ¨é€‰é¡¹æ¥æŒ‡å®šé¢å¤–çš„é…ç½®æ–‡ä»¶è·¯å¾„ã€‚<code>MySQL</code>å°†æŒ‰ç…§æˆ‘ä»¬åœ¨ä¸Šè¡¨ä¸­ç»™å®šçš„é¡ºåºä¾æ¬¡è¯»å–å„ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™å¿½ç•¥ã€‚**å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¤šä¸ªé…ç½®æ–‡ä»¶ä¸­è®¾ç½®äº†ç›¸åŒçš„å¯åŠ¨é€‰é¡¹ï¼Œé‚£ä»¥æœ€åä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„ä¸ºå‡†ã€‚**æ¯”æ–¹è¯´<code>/etc/my.cnf</code>æ–‡ä»¶çš„å†…å®¹æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[server]</span><br><span class="hljs-attr">default-storage-engine</span>=InnoDB<br></code></pre></td></tr></table></figure><p>è€Œ<code>~/.my.cnf</code>æ–‡ä»¶ä¸­çš„å†…å®¹æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[server]</span><br><span class="hljs-attr">default-storage-engine</span>=MyISAM<br></code></pre></td></tr></table></figure><p>åˆå› ä¸º<code>~/.my.cnf</code>æ¯”<code>/etc/my.cnf</code>é¡ºåºé åï¼Œæ‰€ä»¥å¦‚æœä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¸­å‡ºç°ç›¸åŒçš„å¯åŠ¨é€‰é¡¹ï¼Œä»¥<code>~/.my.cnf</code>ä¸­çš„ä¸ºå‡†ï¼Œæ‰€ä»¥<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºå¯åŠ¨ä¹‹åï¼Œ<code>default-storage-engine</code>çš„å€¼å°±æ˜¯<code>MyISAM</code>ã€‚</p><h4 id="åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­å¤šä¸ªç»„çš„ä¼˜å…ˆçº§">åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­å¤šä¸ªç»„çš„ä¼˜å…ˆçº§</h4><p>æˆ‘ä»¬è¯´åŒä¸€ä¸ªå‘½ä»¤å¯ä»¥è®¿é—®é…ç½®æ–‡ä»¶ä¸­çš„å¤šä¸ªç»„ï¼Œæ¯”å¦‚<code>mysqld</code>å¯ä»¥è®¿é—®<code>[mysqld]</code>ã€<code>[server]</code>ç»„ï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚<code>~/.my.cnf</code>ï¼Œåœ¨è¿™äº›ç»„é‡Œå‡ºç°äº†åŒæ ·çš„é…ç½®é¡¹ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[server]</span><br><span class="hljs-attr">default-storage-engine</span>=InnoDB<br><br><span class="hljs-section">[mysqld]</span><br><span class="hljs-attr">default-storage-engine</span>=MyISAM<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œå°†ä»¥æœ€åä¸€ä¸ªå‡ºç°çš„ç»„ä¸­çš„å¯åŠ¨é€‰é¡¹ä¸ºå‡†ï¼Œæ¯”æ–¹è¯´ä¾‹å­ä¸­<code>default-storage-engine</code>æ—¢å‡ºç°åœ¨<code>[mysqld]</code>ç»„ä¹Ÿå‡ºç°åœ¨<code>[server]</code>ç»„ï¼Œå› ä¸º<code>[mysqld]</code>ç»„åœ¨<code>[server]</code>ç»„åè¾¹ï¼Œå°±ä»¥<code>[mysqld]</code>ç»„ä¸­çš„é…ç½®é¡¹ä¸ºå‡†ã€‚</p><h4 id="defaults-fileçš„ä½¿ç”¨">defaults-fileçš„ä½¿ç”¨</h4><p>å¦‚æœæˆ‘ä»¬ä¸æƒ³è®©<code>MySQL</code>åˆ°é»˜è®¤çš„è·¯å¾„ä¸‹æœç´¢é…ç½®æ–‡ä»¶ï¼ˆå°±æ˜¯ä¸Šè¡¨ä¸­åˆ—å‡ºçš„é‚£äº›ï¼‰ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡ŒæŒ‡å®š<code>defaults-file</code>é€‰é¡¹ï¼Œæ¯”å¦‚è¿™æ ·ï¼ˆä»¥<code>UNIX</code>ç³»ç»Ÿä¸ºä¾‹ï¼‰ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">mysqld --defaults-<span class="hljs-keyword">file</span>=<span class="hljs-regexp">/tmp/my</span>config.txt<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™å°†åªåœ¨<code>/tmp/myconfig.txt</code>è·¯å¾„ä¸‹æœç´¢é…ç½®æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®ï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯ã€‚</p><blockquote><p>å°è´´å£«ï¼š æ³¨æ„<code>defaults-extra-file</code>å’Œ<code>defaults-file</code>çš„åŒºåˆ«ï¼Œä½¿ç”¨<code>defaults-extra-file</code>å¯ä»¥æŒ‡å®šé¢å¤–çš„é…ç½®æ–‡ä»¶æœç´¢è·¯å¾„ï¼ˆä¹Ÿå°±æ˜¯è¯´é‚£äº›å›ºå®šçš„é…ç½®æ–‡ä»¶è·¯å¾„ä¹Ÿä¼šè¢«æœç´¢ï¼‰ã€‚</p></blockquote><h4 id="å‘½ä»¤è¡Œå’Œé…ç½®æ–‡ä»¶ä¸­å¯åŠ¨é€‰é¡¹çš„åŒºåˆ«">å‘½ä»¤è¡Œå’Œé…ç½®æ–‡ä»¶ä¸­å¯åŠ¨é€‰é¡¹çš„åŒºåˆ«</h4><p>åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šçš„ç»å¤§éƒ¨åˆ†å¯åŠ¨é€‰é¡¹éƒ½å¯ä»¥æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯æœ‰ä¸€äº›é€‰é¡¹æ˜¯ä¸“é—¨ä¸ºå‘½ä»¤è¡Œè®¾è®¡çš„ï¼Œæ¯”æ–¹è¯´<code>defaults-extra-file</code>ã€<code>defaults-file</code>è¿™æ ·çš„é€‰é¡¹æœ¬èº«å°±æ˜¯ä¸ºäº†æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„çš„ï¼Œå†æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨å°±æ²¡å•¥æ„ä¹‰äº†ã€‚å‰©ä¸‹çš„ä¸€äº›åªèƒ½ç”¨åœ¨å‘½ä»¤è¡Œä¸Šè€Œä¸èƒ½ç”¨åˆ°é…ç½®æ–‡ä»¶ä¸­çš„å¯åŠ¨é€‰é¡¹å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œç”¨åˆ°çš„æ—¶å€™å†æå“ˆï¼ˆæœ¬ä¹¦ä¸­åŸºæœ¬ç”¨ä¸åˆ°ï¼Œæœ‰å…´è¶£çš„åˆ°å®˜æ–¹æ–‡æ¡£çœ‹å“ˆï¼‰ã€‚</p><p>å¦å¤–æœ‰ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœåŒä¸€ä¸ªå¯åŠ¨é€‰é¡¹æ—¢å‡ºç°åœ¨å‘½ä»¤è¡Œä¸­ï¼Œåˆå‡ºç°åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆä»¥å‘½ä»¤è¡Œä¸­çš„å¯åŠ¨é€‰é¡¹ä¸ºå‡†ï¼æ¯”å¦‚æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å†™äº†ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[server]</span><br><span class="hljs-attr">default-storage-engine</span>=InnoDB<br></code></pre></td></tr></table></figure><p>è€Œæˆ‘ä»¬çš„å¯åŠ¨å‘½ä»¤æ˜¯ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql.<span class="hljs-keyword">server</span> <span class="hljs-keyword">start</span> <span class="hljs-comment">--default-storage-engine=MyISAM</span><br></code></pre></td></tr></table></figure><p>é‚£æœ€å<code>default-storage-engine</code>çš„å€¼å°±æ˜¯<code>MyISAM</code>ï¼</p><h2 id="ç³»ç»Ÿå˜é‡">ç³»ç»Ÿå˜é‡</h2><h3 id="ç³»ç»Ÿå˜é‡ç®€ä»‹">ç³»ç»Ÿå˜é‡ç®€ä»‹</h3><p><code>MySQL</code>æœåŠ¡å™¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¼šç”¨åˆ°è®¸å¤šå½±å“ç¨‹åºè¡Œä¸ºçš„å˜é‡ï¼Œå®ƒä»¬è¢«ç§°ä¸º<code>MySQL</code>ç³»ç»Ÿå˜é‡ï¼Œæ¯”å¦‚å…è®¸åŒæ—¶è¿å…¥çš„å®¢æˆ·ç«¯æ•°é‡ç”¨ç³»ç»Ÿå˜é‡<code>max_connections</code>è¡¨ç¤ºï¼Œè¡¨çš„é»˜è®¤å­˜å‚¨å¼•æ“ç”¨ç³»ç»Ÿå˜é‡<code>default_storage_engine</code>è¡¨ç¤ºï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å¤§å°ç”¨ç³»ç»Ÿå˜é‡<code>query_cache_size</code>è¡¨ç¤ºï¼Œ<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºçš„ç³»ç»Ÿå˜é‡æœ‰å¥½å‡ ç™¾æ¡ï¼Œæˆ‘ä»¬å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚æ¯ä¸ªç³»ç»Ÿå˜é‡éƒ½æœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæˆ–è€…é…ç½®æ–‡ä»¶ä¸­çš„é€‰é¡¹åœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶æ”¹å˜ä¸€äº›ç³»ç»Ÿå˜é‡çš„å€¼ã€‚å¤§å¤šæ•°çš„ç³»ç»Ÿå˜é‡çš„å€¼ä¹Ÿå¯ä»¥åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¿®æ”¹ï¼Œè€Œæ— éœ€åœæ­¢å¹¶é‡æ–°å¯åŠ¨å®ƒã€‚</p><h3 id="æŸ¥çœ‹ç³»ç»Ÿå˜é‡">æŸ¥çœ‹ç³»ç»Ÿå˜é‡</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æŸ¥çœ‹<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºæ”¯æŒçš„ç³»ç»Ÿå˜é‡ä»¥åŠå®ƒä»¬çš„å½“å‰å€¼ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">SHOW <span class="hljs-keyword">VARIABLES</span> [LIKE åŒ¹é…çš„æ¨¡å¼<span class="hljs-comment">]</span>;<br></code></pre></td></tr></table></figure><p>ç”±äº<code>ç³»ç»Ÿå˜é‡</code>å®åœ¨å¤ªå¤šäº†ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>SHOW VARIABLES</code>æŸ¥çœ‹çš„è¯å°±ç›´æ¥åˆ·å±äº†ï¼Œæ‰€ä»¥é€šå¸¸éƒ½ä¼šå¸¦ä¸€ä¸ª<code>LIKE</code>è¿‡æ»¤æ¡ä»¶æ¥æŸ¥çœ‹æˆ‘ä»¬éœ€è¦çš„ç³»ç»Ÿå˜é‡çš„å€¼ï¼Œæ¯”æ–¹è¯´è¿™ä¹ˆå†™ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;default_storage_engine&#x27;;</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| Variable_name          | Value  |</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| default_storage_engine | InnoDB |</span><br><span class="hljs-section">+------------------------+--------+</span><br>1 row in set (0.01 sec)<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES like &#x27;max_connections&#x27;;</span><br><span class="hljs-section">+-----------------+-------+</span><br><span class="hljs-section">| Variable_name   | Value |</span><br><span class="hljs-section">+-----------------+-------+</span><br><span class="hljs-section">| max_connections | 151   |</span><br><span class="hljs-section">+-----------------+-------+</span><br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨æœåŠ¡å™¨ç¨‹åºä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“å°±æ˜¯<code>InnoDB</code>ï¼Œå…è®¸åŒæ—¶è¿æ¥çš„å®¢æˆ·ç«¯æ•°é‡æœ€å¤šä¸º<code>151</code>ã€‚åˆ«å¿˜äº†<code>LIKE</code>è¡¨è¾¾å¼åè¾¹å¯ä»¥è·Ÿé€šé…ç¬¦æ¥è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;default%&#x27;;</span><br><span class="hljs-section">+-------------------------------+-----------------------+</span><br><span class="hljs-section">| Variable_name                 | Value                 |</span><br><span class="hljs-section">+-------------------------------+-----------------------+</span><br>| default<span class="hljs-emphasis">_authentication_plugin | mysql_native_password |</span><br><span class="hljs-emphasis">| default_password_lifetime     | 0                     |</span><br><span class="hljs-emphasis">| default_storage_engine        | InnoDB                |</span><br><span class="hljs-emphasis">| default_tmp_storage_engine    | InnoDB                |</span><br><span class="hljs-emphasis">| default_week_</span>format           | 0                     |<br><span class="hljs-code">+-------------------------------+</span>-----------------------+<br>5 rows in set (0.01 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±æŸ¥å‡ºäº†æ‰€æœ‰ä»¥<code>default</code>å¼€å¤´çš„ç³»ç»Ÿå˜é‡çš„å€¼ã€‚</p><h3 id="è®¾ç½®ç³»ç»Ÿå˜é‡">è®¾ç½®ç³»ç»Ÿå˜é‡</h3><h4 id="é€šè¿‡å¯åŠ¨é€‰é¡¹è®¾ç½®">é€šè¿‡å¯åŠ¨é€‰é¡¹è®¾ç½®</h4><p>å¤§éƒ¨åˆ†çš„<code>ç³»ç»Ÿå˜é‡</code>éƒ½å¯ä»¥é€šè¿‡å¯åŠ¨æœåŠ¡å™¨æ—¶ä¼ é€å¯åŠ¨é€‰é¡¹çš„æ–¹å¼æ¥è¿›è¡Œè®¾ç½®ã€‚å¦‚ä½•å¡«å†™å¯åŠ¨é€‰é¡¹æˆ‘ä»¬ä¸Šè¾¹å·²ç»èŠ±äº†å¤§ç¯‡å¹…æ¥å” å¨äº†ï¼Œå°±æ˜¯ä¸‹è¾¹ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><p>é€šè¿‡å‘½ä»¤è¡Œæ·»åŠ å¯åŠ¨é€‰é¡¹ã€‚</p><p>æ¯”æ–¹è¯´æˆ‘ä»¬åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºæ—¶ç”¨è¿™ä¸ªå‘½ä»¤ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">mysqld <span class="hljs-attribute">--default-storage-engine</span>=MyISAM <span class="hljs-attribute">--max-connections</span>=10<br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡é…ç½®æ–‡ä»¶æ·»åŠ å¯åŠ¨é€‰é¡¹ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·å¡«å†™é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[server]</span><br><span class="hljs-attr">default-storage-engine</span>=MyISAM<br><span class="hljs-attr">max-connections</span>=<span class="hljs-number">10</span><br></code></pre></td></tr></table></figure></li></ul><p>å½“ä½¿ç”¨ä¸Šè¾¹ä¸¤ç§æ–¹å¼ä¸­çš„ä»»æ„ä¸€ç§å¯åŠ¨æœåŠ¡å™¨ç¨‹åºåï¼Œæˆ‘ä»¬å†æ¥æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿå˜é‡çš„å€¼ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;default_storage_engine&#x27;;</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| Variable_name          | Value  |</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| default_storage_engine | MyISAM |</span><br><span class="hljs-section">+------------------------+--------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;max_connections&#x27;;</span><br><span class="hljs-section">+-----------------+-------+</span><br><span class="hljs-section">| Variable_name   | Value |</span><br><span class="hljs-section">+-----------------+-------+</span><br><span class="hljs-section">| max_connections | 10    |</span><br><span class="hljs-section">+-----------------+-------+</span><br>1 row in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>default_storage_engine</code>å’Œ<code>max_connections</code>è¿™ä¸¤ä¸ªç³»ç»Ÿå˜é‡çš„å€¼å·²ç»è¢«ä¿®æ”¹äº†ã€‚æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>å¯¹äºå¯åŠ¨é€‰é¡¹æ¥è¯´ï¼Œå¦‚æœå¯åŠ¨é€‰é¡¹åç”±å¤šä¸ªå•è¯ç»„æˆï¼Œå„ä¸ªå•è¯ä¹‹é—´ç”¨çŸ­åˆ’çº¿<code>-</code>æˆ–è€…ä¸‹åˆ’çº¿<code>_</code>è¿æ¥èµ·æ¥éƒ½å¯ä»¥ï¼Œä½†æ˜¯å®ƒå¯¹åº”çš„ç³»ç»Ÿå˜é‡çš„å•è¯ä¹‹é—´å¿…é¡»ä½¿ç”¨ä¸‹åˆ’çº¿<code>_</code>è¿æ¥èµ·æ¥ã€‚</strong></p><h4 id="æœåŠ¡å™¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è®¾ç½®">æœåŠ¡å™¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è®¾ç½®</h4><p><code>ç³»ç»Ÿå˜é‡</code>æ¯”è¾ƒç‰›é€¼çš„ä¸€ç‚¹å°±æ˜¯ï¼Œå¯¹äºå¤§éƒ¨åˆ†ç³»ç»Ÿå˜é‡æ¥è¯´ï¼Œå®ƒä»¬çš„å€¼å¯ä»¥åœ¨æœåŠ¡å™¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è¿›è¡ŒåŠ¨æ€ä¿®æ”¹è€Œæ— éœ€åœæ­¢å¹¶é‡å¯æœåŠ¡å™¨ã€‚ä¸è¿‡ç³»ç»Ÿå˜é‡æœ‰ä½œç”¨èŒƒå›´ä¹‹åˆ†ï¼Œä¸‹è¾¹è¯¦ç»†å” å¨ä¸‹ã€‚</p><h5 id="è®¾ç½®ä¸åŒä½œç”¨èŒƒå›´çš„ç³»ç»Ÿå˜é‡">è®¾ç½®ä¸åŒä½œç”¨èŒƒå›´çš„ç³»ç»Ÿå˜é‡</h5><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œå¤šä¸ªå®¢æˆ·ç«¯ç¨‹åºå¯ä»¥åŒæ—¶è¿æ¥åˆ°ä¸€ä¸ªæœåŠ¡å™¨ç¨‹åºã€‚å¯¹äºåŒä¸€ä¸ªç³»ç»Ÿå˜é‡ï¼Œæˆ‘ä»¬æœ‰æ—¶æƒ³è®©ä¸åŒçš„å®¢æˆ·ç«¯æœ‰ä¸åŒçš„å€¼ã€‚æ¯”æ–¹è¯´ç‹—å“¥ä½¿ç”¨å®¢æˆ·ç«¯Aï¼Œä»–æƒ³è®©å½“å‰å®¢æˆ·ç«¯å¯¹åº”çš„é»˜è®¤å­˜å‚¨å¼•æ“ä¸º<code>InnoDB</code>ï¼Œæ‰€ä»¥ä»–å¯ä»¥æŠŠç³»ç»Ÿå˜é‡<code>default_storage_engine</code>çš„å€¼è®¾ç½®ä¸º<code>InnoDB</code>ï¼›çŒ«çˆ·ä½¿ç”¨å®¢æˆ·ç«¯Bï¼Œä»–æƒ³è®©å½“å‰å®¢æˆ·ç«¯å¯¹åº”çš„é»˜è®¤å­˜å‚¨å¼•æ“ä¸º<code>MyISAM</code>ï¼Œæ‰€ä»¥ä»–å¯ä»¥æŠŠç³»ç»Ÿå˜é‡<code>default_storage_engine</code>çš„å€¼è®¾ç½®ä¸º<code>MyISAM</code>ã€‚è¿™æ ·å¯ä»¥ä½¿ç‹—å“¥å’ŒçŒ«çˆ·çš„çš„å®¢æˆ·ç«¯æ‹¥æœ‰ä¸åŒçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œä½¿ç”¨æ—¶äº’ä¸å½±å“ï¼Œååˆ†æ–¹ä¾¿ã€‚ä½†æ˜¯è¿™æ ·å„ä¸ªå®¢æˆ·ç«¯éƒ½ç§æœ‰ä¸€ä»½ç³»ç»Ÿå˜é‡ä¼šäº§ç”Ÿè¿™ä¹ˆä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>æœ‰ä¸€äº›ç³»ç»Ÿå˜é‡å¹¶ä¸æ˜¯é’ˆå¯¹å•ä¸ªå®¢æˆ·ç«¯çš„ï¼Œæ¯”å¦‚å…è®¸åŒæ—¶è¿æ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯æ•°é‡<code>max_connections</code>ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å¤§å°<code>query_cache_size</code>ï¼Œè¿™äº›å…¬æœ‰çš„ç³»ç»Ÿå˜é‡è®©æŸä¸ªå®¢æˆ·ç«¯ç§æœ‰æ˜¾ç„¶ä¸åˆé€‚ã€‚</li><li>ä¸€ä¸ªæ–°è¿æ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯å¯¹åº”çš„ç³»ç»Ÿå˜é‡çš„å€¼è¯¥æ€ä¹ˆè®¾ç½®ï¼Ÿ</li></ul><p>ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”æå‡ºäº†ç³»ç»Ÿå˜é‡çš„<code>ä½œç”¨èŒƒå›´</code>çš„æ¦‚å¿µï¼Œå…·ä½“æ¥è¯´<code>ä½œç”¨èŒƒå›´</code>åˆ†ä¸ºè¿™ä¸¤ç§ï¼š</p><ul><li><code>GLOBAL</code>ï¼šå…¨å±€å˜é‡ï¼Œå½±å“æœåŠ¡å™¨çš„æ•´ä½“æ“ä½œã€‚</li><li><code>SESSION</code>ï¼šä¼šè¯å˜é‡ï¼Œå½±å“æŸä¸ªå®¢æˆ·ç«¯è¿æ¥çš„æ“ä½œã€‚ï¼ˆæ³¨ï¼š<code>SESSION</code>æœ‰ä¸ªåˆ«åå«<code>LOCAL</code>ï¼‰</li></ul><p>åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œä¼šå°†æ¯ä¸ªå…¨å±€å˜é‡åˆå§‹åŒ–ä¸ºå…¶é»˜è®¤å€¼ï¼ˆå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæˆ–é€‰é¡¹æ–‡ä»¶ä¸­æŒ‡å®šçš„é€‰é¡¹æ›´æ”¹è¿™äº›é»˜è®¤å€¼ï¼‰ã€‚ç„¶åæœåŠ¡å™¨è¿˜ä¸ºæ¯ä¸ªè¿æ¥çš„å®¢æˆ·ç«¯ç»´æŠ¤ä¸€ç»„ä¼šè¯å˜é‡ï¼Œå®¢æˆ·ç«¯çš„ä¼šè¯å˜é‡åœ¨è¿æ¥æ—¶ä½¿ç”¨ç›¸åº”å…¨å±€å˜é‡çš„å½“å‰å€¼åˆå§‹åŒ–ã€‚</p><p>è¿™è¯æœ‰ç‚¹å„¿ç»•ï¼Œè¿˜æ˜¯ä»¥<code>default_storage_engine</code>ä¸¾ä¾‹ï¼Œåœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–ä¸€ä¸ªåä¸º<code>default_storage_engine</code>ï¼Œä½œç”¨èŒƒå›´ä¸º<code>GLOBAL</code>çš„ç³»ç»Ÿå˜é‡ã€‚ä¹‹åæ¯å½“æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°è¯¥æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨éƒ½ä¼šå•ç‹¬ä¸ºè¯¥å®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªåä¸º<code>default_storage_engine</code>ï¼Œä½œç”¨èŒƒå›´ä¸º<code>SESSION</code>çš„ç³»ç»Ÿå˜é‡ï¼Œè¯¥ä½œç”¨èŒƒå›´ä¸º<code>SESSION</code>çš„ç³»ç»Ÿå˜é‡å€¼æŒ‰ç…§å½“å‰ä½œç”¨èŒƒå›´ä¸º<code>GLOBAL</code>çš„åŒåç³»ç»Ÿå˜é‡å€¼è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>å¾ˆæ˜¾ç„¶ï¼Œé€šè¿‡å¯åŠ¨é€‰é¡¹è®¾ç½®çš„ç³»ç»Ÿå˜é‡çš„ä½œç”¨èŒƒå›´éƒ½æ˜¯<code>GLOBAL</code>çš„ï¼Œä¹Ÿå°±æ˜¯å¯¹æ‰€æœ‰å®¢æˆ·ç«¯éƒ½æœ‰æ•ˆçš„ï¼Œå› ä¸ºåœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™è¿˜æ²¡æœ‰å®¢æˆ·ç«¯ç¨‹åºè¿æ¥è¿›æ¥å‘¢ã€‚äº†è§£äº†ç³»ç»Ÿå˜é‡çš„<code>GLOBAL</code>å’Œ<code>SESSION</code>ä½œç”¨èŒƒå›´ä¹‹åï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹åœ¨æœåŠ¡å™¨ç¨‹åºè¿è¡ŒæœŸé—´é€šè¿‡å®¢æˆ·ç«¯ç¨‹åºè®¾ç½®ç³»ç»Ÿå˜é‡çš„è¯­æ³•ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SET</span> [<span class="hljs-keyword">GLOBAL</span>|<span class="hljs-keyword">SESSION</span>] ç³»ç»Ÿå˜é‡å = å€¼;<br></code></pre></td></tr></table></figure><p>æˆ–è€…å†™æˆè¿™æ ·ä¹Ÿè¡Œï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SET</span> [@@(<span class="hljs-keyword">GLOBAL</span>|<span class="hljs-keyword">SESSION</span>).]var_name = XXX;<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬æƒ³åœ¨æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­æŠŠä½œç”¨èŒƒå›´ä¸º<code>GLOBAL</code>çš„ç³»ç»Ÿå˜é‡<code>default_storage_engine</code>çš„å€¼ä¿®æ”¹ä¸º<code>MyISAM</code>ï¼Œä¹Ÿå°±æ˜¯æƒ³è®©ä¹‹åæ–°è¿æ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯éƒ½ç”¨<code>MyISAM</code>ä½œä¸ºé»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸‹è¾¹ä¸¤æ¡è¯­å¥ä¸­çš„ä»»æ„ä¸€æ¡æ¥è¿›è¡Œè®¾ç½®ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams">è¯­å¥ä¸€ï¼š<span class="hljs-keyword">SET</span> GLOBAL <span class="hljs-comment">default_storage_engine = MyISAM</span>;<br>è¯­å¥äºŒï¼š<span class="hljs-keyword">SET</span> @@GLOBAL.default_storage_engine <span class="hljs-comment">= MyISAM</span>;<br></code></pre></td></tr></table></figure><p>å¦‚æœåªæƒ³å¯¹æœ¬å®¢æˆ·ç«¯ç”Ÿæ•ˆï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸‹è¾¹ä¸‰æ¡è¯­å¥ä¸­çš„ä»»æ„ä¸€æ¡æ¥è¿›è¡Œè®¾ç½®ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gams">è¯­å¥ä¸€ï¼š<span class="hljs-keyword">SET</span> SESSION <span class="hljs-comment">default_storage_engine = MyISAM</span>;<br>è¯­å¥äºŒï¼š<span class="hljs-keyword">SET</span> @@SESSION.default_storage_engine <span class="hljs-comment">= MyISAM</span>;<br>è¯­å¥ä¸‰ï¼š<span class="hljs-keyword">SET</span> default_storage_engine <span class="hljs-comment">= MyISAM</span>;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¾¹çš„<code>è¯­å¥ä¸‰</code>ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœåœ¨è®¾ç½®ç³»ç»Ÿå˜é‡çš„è¯­å¥ä¸­çœç•¥äº†ä½œç”¨èŒƒå›´ï¼Œé»˜è®¤çš„ä½œç”¨èŒƒå›´å°±æ˜¯<code>SESSION</code>ã€‚ä¹Ÿå°±æ˜¯è¯´<code>SET ç³»ç»Ÿå˜é‡å = å€¼</code>å’Œ<code>SET SESSION ç³»ç»Ÿå˜é‡å = å€¼</code>æ˜¯ç­‰ä»·çš„ã€‚</p><h5 id="æŸ¥çœ‹ä¸åŒä½œç”¨èŒƒå›´çš„ç³»ç»Ÿå˜é‡">æŸ¥çœ‹ä¸åŒä½œç”¨èŒƒå›´çš„ç³»ç»Ÿå˜é‡</h5><p><code>ç³»ç»Ÿå˜é‡</code>æœ‰<code>ä½œç”¨èŒƒå›´</code>ä¹‹åˆ†ï¼Œ<code>SHOW VARIABLES</code>é»˜è®¤æŸ¥çœ‹çš„æ˜¯<code>SESSION</code>ä½œç”¨èŒƒå›´çš„ç³»ç»Ÿå˜é‡ã€‚</p><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æŸ¥çœ‹ç³»ç»Ÿå˜é‡çš„è¯­å¥ä¸ŠåŠ ä¸Šè¦æŸ¥çœ‹å“ªä¸ª<code>ä½œç”¨èŒƒå›´</code>çš„ç³»ç»Ÿå˜é‡ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SHOW</span> [<span class="hljs-keyword">GLOBAL</span>|<span class="hljs-keyword">SESSION</span>] VARIABLES [<span class="hljs-keyword">LIKE</span> åŒ¹é…çš„æ¨¡å¼];<br></code></pre></td></tr></table></figure><p>ä¸‹è¾¹æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹å®Œæ•´çš„è®¾ç½®å¹¶æŸ¥çœ‹ç³»ç»Ÿå˜é‡çš„è¿‡ç¨‹ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW SESSION VARIABLES LIKE &#x27;default_storage_engine&#x27;;</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| Variable_name          | Value  |</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| default_storage_engine | InnoDB |</span><br><span class="hljs-section">+------------------------+--------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW GLOBAL VARIABLES LIKE &#x27;default_storage_engine&#x27;;</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| Variable_name          | Value  |</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| default_storage_engine | InnoDB |</span><br><span class="hljs-section">+------------------------+--------+</span><br>1 row in set (0.00 sec)<br><br>mysql&gt; SET SESSION default_storage_engine = MyISAM;<br>Query OK, 0 rows affected (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW SESSION VARIABLES LIKE &#x27;default_storage_engine&#x27;;</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| Variable_name          | Value  |</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| default_storage_engine | MyISAM |</span><br><span class="hljs-section">+------------------------+--------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW GLOBAL VARIABLES LIKE &#x27;default_storage_engine&#x27;;</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| Variable_name          | Value  |</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| default_storage_engine | InnoDB |</span><br><span class="hljs-section">+------------------------+--------+</span><br>1 row in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€åˆ<code>default_storage_engine</code>çš„ç³»ç»Ÿå˜é‡æ— è®ºæ˜¯åœ¨<code>GLOBAL</code>ä½œç”¨èŒƒå›´ä¸Šè¿˜æ˜¯åœ¨<code>SESSION</code>ä½œç”¨èŒƒå›´ä¸Šçš„å€¼éƒ½æ˜¯<code>InnoDB</code>ï¼Œæˆ‘ä»¬åœ¨<code>SESSION</code>ä½œç”¨èŒƒå›´æŠŠå®ƒçš„å€¼è®¾ç½®ä¸º<code>MyISAM</code>ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°<code>GLOBAL</code>ä½œç”¨èŒƒå›´çš„å€¼å¹¶æ²¡æœ‰æ”¹å˜ã€‚</p><blockquote><p>å°è´´å£«ï¼š å¦‚æœæŸä¸ªå®¢æˆ·ç«¯æ”¹å˜äº†æŸä¸ªç³»ç»Ÿå˜é‡åœ¨<code>GLOBAL</code>ä½œç”¨èŒƒå›´çš„å€¼ï¼Œå¹¶ä¸ä¼šå½±å“è¯¥ç³»ç»Ÿå˜é‡åœ¨å½“å‰å·²ç»è¿æ¥çš„å®¢æˆ·ç«¯ä½œç”¨èŒƒå›´ä¸º<code>SESSION</code>çš„å€¼ï¼Œåªä¼šå½±å“åç»­è¿å…¥çš„å®¢æˆ·ç«¯åœ¨ä½œç”¨èŒƒå›´ä¸º<code>SESSION</code>çš„å€¼ã€‚</p></blockquote><h5 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h5><ul><li>å¹¶ä¸æ˜¯æ‰€æœ‰ç³»ç»Ÿå˜é‡éƒ½å…·æœ‰<code>GLOBAL</code>å’Œ<code>SESSION</code>çš„ä½œç”¨èŒƒå›´ã€‚<ul><li>æœ‰ä¸€äº›ç³»ç»Ÿå˜é‡åªå…·æœ‰<code>GLOBAL</code>ä½œç”¨èŒƒå›´ï¼Œæ¯”æ–¹è¯´<code>max_connections</code>ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç¨‹åºæ”¯æŒåŒæ—¶æœ€å¤šæœ‰å¤šå°‘ä¸ªå®¢æˆ·ç«¯ç¨‹åºè¿›è¡Œè¿æ¥ã€‚</li><li>æœ‰ä¸€äº›ç³»ç»Ÿå˜é‡åªå…·æœ‰<code>SESSION</code>ä½œç”¨èŒƒå›´ï¼Œæ¯”å¦‚<code>insert_id</code>ï¼Œè¡¨ç¤ºåœ¨å¯¹æŸä¸ªåŒ…å«<code>AUTO_INCREMENT</code>åˆ—çš„è¡¨è¿›è¡Œæ’å…¥æ—¶ï¼Œè¯¥åˆ—åˆå§‹çš„å€¼ã€‚</li><li>æœ‰ä¸€äº›ç³»ç»Ÿå˜é‡çš„å€¼æ—¢å…·æœ‰<code>GLOBAL</code>ä½œç”¨èŒƒå›´ï¼Œä¹Ÿå…·æœ‰<code>SESSION</code>ä½œç”¨èŒƒå›´ï¼Œæ¯”å¦‚æˆ‘ä»¬å‰è¾¹ç”¨åˆ°çš„<code>default_storage_engine</code>ï¼Œè€Œä¸”å…¶å®å¤§éƒ¨åˆ†çš„ç³»ç»Ÿå˜é‡éƒ½æ˜¯è¿™æ ·çš„ï¼Œ</li></ul></li><li>æœ‰äº›ç³»ç»Ÿå˜é‡æ˜¯åªè¯»çš„ï¼Œå¹¶ä¸èƒ½è®¾ç½®å€¼ã€‚</li></ul><h4 id="å¯åŠ¨é€‰é¡¹å’Œç³»ç»Ÿå˜é‡çš„åŒºåˆ«">å¯åŠ¨é€‰é¡¹å’Œç³»ç»Ÿå˜é‡çš„åŒºåˆ«</h4><p><code>å¯åŠ¨é€‰é¡¹</code>æ˜¯åœ¨ç¨‹åºå¯åŠ¨æ—¶æˆ‘ä»¬ç¨‹åºå‘˜ä¼ é€’çš„ä¸€äº›å‚æ•°ï¼Œè€Œ<code>ç³»ç»Ÿå˜é‡</code>æ˜¯å½±å“æœåŠ¡å™¨ç¨‹åºè¿è¡Œè¡Œä¸ºçš„å˜é‡ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š</p><ul><li>å¤§éƒ¨åˆ†çš„ç³»ç»Ÿå˜é‡éƒ½å¯ä»¥è¢«å½“ä½œå¯åŠ¨é€‰é¡¹ä¼ å…¥ã€‚</li><li>æœ‰äº›ç³»ç»Ÿå˜é‡æ˜¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ˜¯ä¸å¯ä»¥å½“ä½œå¯åŠ¨é€‰é¡¹æ¥è®¾ç½®ï¼Œæ¯”å¦‚<code>auto_increment_offset</code>ã€<code>character_set_client</code>å•¥çš„ã€‚</li><li>æœ‰äº›å¯åŠ¨é€‰é¡¹ä¹Ÿä¸æ˜¯ç³»ç»Ÿå˜é‡ï¼Œæ¯”å¦‚<code>defaults-file</code>ã€‚</li></ul><h3 id="çŠ¶æ€å˜é‡">çŠ¶æ€å˜é‡</h3><p>ä¸ºäº†è®©æˆ‘ä»¬æ›´å¥½çš„äº†è§£æœåŠ¡å™¨ç¨‹åºçš„è¿è¡Œæƒ…å†µï¼Œ<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºä¸­ç»´æŠ¤äº†å¥½å¤šå…³äºç¨‹åºè¿è¡ŒçŠ¶æ€çš„å˜é‡ï¼Œå®ƒä»¬è¢«ç§°ä¸º<code>çŠ¶æ€å˜é‡</code>ã€‚æ¯”æ–¹è¯´<code>Threads_connected</code>è¡¨ç¤ºå½“å‰æœ‰å¤šå°‘å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹äº†è¿æ¥ï¼Œ<code>Handler_update</code>è¡¨ç¤ºå·²ç»æ›´æ–°äº†å¤šå°‘è¡Œè®°å½•å§å•¦å§å•¦ï¼Œåƒè¿™æ ·æ˜¾ç¤ºæœåŠ¡å™¨ç¨‹åºçŠ¶æ€ä¿¡æ¯çš„<code>çŠ¶æ€å˜é‡</code>è¿˜æœ‰å¥½å‡ ç™¾ä¸ªï¼Œæˆ‘ä»¬å°±ä¸ä¸€ä¸€å” å¨äº†ï¼Œç­‰é‡åˆ°äº†ä¼šè¯¦ç»†è¯´å®ƒä»¬çš„ä½œç”¨çš„ã€‚</p><p>ç”±äº<code>çŠ¶æ€å˜é‡</code>æ˜¯ç”¨æ¥æ˜¾ç¤ºæœåŠ¡å™¨ç¨‹åºè¿è¡ŒçŠ¶å†µçš„ï¼Œæ‰€ä»¥å®ƒä»¬çš„å€¼åªèƒ½ç”±æœåŠ¡å™¨ç¨‹åºè‡ªå·±æ¥è®¾ç½®ï¼Œæˆ‘ä»¬ç¨‹åºå‘˜æ˜¯ä¸èƒ½è®¾ç½®çš„ã€‚ä¸<code>ç³»ç»Ÿå˜é‡</code>ç±»ä¼¼ï¼Œ<code>çŠ¶æ€å˜é‡</code>ä¹Ÿæœ‰<code>GLOBAL</code>å’Œ<code>SESSION</code>ä¸¤ä¸ªä½œç”¨èŒƒå›´çš„ï¼Œæ‰€ä»¥æŸ¥çœ‹<code>çŠ¶æ€å˜é‡</code>çš„è¯­å¥å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SHOW</span> [<span class="hljs-keyword">GLOBAL</span>|<span class="hljs-keyword">SESSION</span>] STATUS [<span class="hljs-keyword">LIKE</span> åŒ¹é…çš„æ¨¡å¼];<br></code></pre></td></tr></table></figure><p>ç±»ä¼¼çš„ï¼Œå¦‚æœæˆ‘ä»¬ä¸å†™æ˜ä½œç”¨èŒƒå›´ï¼Œé»˜è®¤çš„ä½œç”¨èŒƒå›´æ˜¯<code>SESSION</code>ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW STATUS LIKE &#x27;thread%&#x27;;</span><br><span class="hljs-section">+-------------------+-------+</span><br><span class="hljs-section">| Variable_name     | Value |</span><br><span class="hljs-section">+-------------------+-------+</span><br>| Threads<span class="hljs-emphasis">_cached    | 0     |</span><br><span class="hljs-emphasis">| Threads_connected | 1     |</span><br><span class="hljs-emphasis">| Threads_created   | 1     |</span><br><span class="hljs-emphasis">| Threads_</span>running   | 1     |<br><span class="hljs-code">+-------------------+</span>-------+<br>4 rows in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure><p>æ‰€æœ‰ä»¥<code>Thread</code>å¼€å¤´çš„<code>SESSION</code>ä½œç”¨èŒƒå›´çš„çŠ¶æ€å˜é‡å°±éƒ½è¢«å±•ç¤ºå‡ºæ¥äº†ã€‚</p><p>æ¯”æ–¹è¯´<code>version</code>ï¼Œè¡¨ç¤ºå½“å‰<code>MySQL</code>çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å®¢æˆ·ç«¯æ˜¯ä¸èƒ½è®¾ç½®å®ƒçš„å€¼çš„ï¼Œåªèƒ½åœ¨<code>SHOW VARIABLES</code>è¯­å¥é‡ŒæŸ¥çœ‹ã€‚</p><h1>3.å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</h1><h2 id="å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ç®€ä»‹">å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ç®€ä»‹</h2><h3 id="å­—ç¬¦é›†ç®€ä»‹">å­—ç¬¦é›†ç®€ä»‹</h3><p>æˆ‘ä»¬çŸ¥é“åœ¨è®¡ç®—æœºä¸­åªèƒ½å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œé‚£è¯¥æ€ä¹ˆå­˜å‚¨å­—ç¬¦ä¸²å‘¢ï¼Ÿå½“ç„¶æ˜¯å»ºç«‹å­—ç¬¦ä¸äºŒè¿›åˆ¶æ•°æ®çš„æ˜ å°„å…³ç³»äº†ï¼Œå»ºç«‹è¿™ä¸ªå…³ç³»æœ€èµ·ç è¦ææ¸…æ¥šä¸¤ä»¶äº‹å„¿ï¼š</p><ol><li><p>ä½ è¦æŠŠå“ªäº›å­—ç¬¦æ˜ å°„æˆäºŒè¿›åˆ¶æ•°æ®ï¼Ÿ</p><p>ä¹Ÿå°±æ˜¯ç•Œå®šæ¸…æ¥šå­—ç¬¦èŒƒå›´ã€‚</p></li><li><p>æ€ä¹ˆæ˜ å°„ï¼Ÿ</p><p>å°†ä¸€ä¸ªå­—ç¬¦æ˜ å°„æˆä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®çš„è¿‡ç¨‹ä¹Ÿå«åš<code>ç¼–ç </code>ï¼Œå°†ä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªå­—ç¬¦çš„è¿‡ç¨‹å«åš<code>è§£ç </code>ã€‚</p></li></ol><p>äººä»¬æŠ½è±¡å‡ºä¸€ä¸ª<code>å­—ç¬¦é›†</code>çš„æ¦‚å¿µæ¥æè¿°æŸä¸ªå­—ç¬¦èŒƒå›´çš„ç¼–ç è§„åˆ™ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æ¥è‡ªå®šä¹‰ä¸€ä¸ªåç§°ä¸º<code>xiaohaizi</code>çš„å­—ç¬¦é›†ï¼Œå®ƒåŒ…å«çš„å­—ç¬¦èŒƒå›´å’Œç¼–ç è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li><p>åŒ…å«å­—ç¬¦<code>'a'</code>ã€<code>'b'</code>ã€<code>'A'</code>ã€<code>'B'</code>ã€‚</p></li><li><p>ç¼–ç è§„åˆ™å¦‚ä¸‹ï¼š</p><p>é‡‡ç”¨1ä¸ªå­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦çš„å½¢å¼ï¼Œå­—ç¬¦å’Œå­—èŠ‚çš„æ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-string">&#x27;a&#x27;</span> -&gt; <span class="hljs-number">00000001</span> (åå…­è¿›åˆ¶ï¼š<span class="hljs-number">0x01</span>)<br><span class="hljs-string">&#x27;b&#x27;</span> -&gt; <span class="hljs-number">00000010</span> (åå…­è¿›åˆ¶ï¼š<span class="hljs-number">0x02</span>)<br><span class="hljs-string">&#x27;A&#x27;</span> -&gt; <span class="hljs-number">00000011</span> (åå…­è¿›åˆ¶ï¼š<span class="hljs-number">0x03</span>)<br><span class="hljs-string">&#x27;B&#x27;</span> -&gt; <span class="hljs-number">00000100</span> (åå…­è¿›åˆ¶ï¼š<span class="hljs-number">0x04</span>)<br></code></pre></td></tr></table></figure></li></ul><p>æœ‰äº†<code>xiaohaizi</code>å­—ç¬¦é›†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨äºŒè¿›åˆ¶å½¢å¼è¡¨ç¤ºä¸€äº›å­—ç¬¦ä¸²äº†ï¼Œä¸‹è¾¹æ˜¯ä¸€äº›å­—ç¬¦ä¸²ç”¨<code>xiaohaizi</code>å­—ç¬¦é›†ç¼–ç åçš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-string">&#x27;bA&#x27;</span> -&gt; <span class="hljs-number">0000001000000011</span>  (åå…­è¿›åˆ¶ï¼š<span class="hljs-number">0x0203</span>)<br><span class="hljs-string">&#x27;baB&#x27;</span> -&gt; <span class="hljs-number">000000100000000100000100</span>  (åå…­è¿›åˆ¶ï¼š<span class="hljs-number">0x020104</span>)<br><span class="hljs-string">&#x27;cd&#x27;</span> -&gt; æ— æ³•è¡¨ç¤ºï¼Œå­—ç¬¦é›†xiaohaiziä¸åŒ…å«å­—ç¬¦<span class="hljs-string">&#x27;c&#x27;</span>å’Œ<span class="hljs-string">&#x27;d&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="æ¯”è¾ƒè§„åˆ™ç®€ä»‹">æ¯”è¾ƒè§„åˆ™ç®€ä»‹</h3><p>åœ¨æˆ‘ä»¬ç¡®å®šäº†<code>xiaohaizi</code>å­—ç¬¦é›†è¡¨ç¤ºå­—ç¬¦çš„èŒƒå›´ä»¥åŠç¼–ç è§„åˆ™åï¼Œæ€ä¹ˆæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦çš„å¤§å°å‘¢ï¼Ÿæœ€å®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯ç›´æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªå­—ç¬¦å¯¹åº”çš„äºŒè¿›åˆ¶ç¼–ç çš„å¤§å°ï¼Œæ¯”æ–¹è¯´å­—ç¬¦<code>'a'</code>çš„ç¼–ç ä¸º<code>0x01</code>ï¼Œå­—ç¬¦<code>'b'</code>çš„ç¼–ç ä¸º<code>0x02</code>ï¼Œæ‰€ä»¥<code>'a'</code>å°äº<code>'b'</code>ï¼Œè¿™ç§ç®€å•çš„æ¯”è¾ƒè§„åˆ™ä¹Ÿå¯ä»¥è¢«ç§°ä¸ºäºŒè¿›åˆ¶æ¯”è¾ƒè§„åˆ™ï¼Œè‹±æ–‡åä¸º<code>binary collation</code>ã€‚</p><p>äºŒè¿›åˆ¶æ¯”è¾ƒè§„åˆ™æ˜¯ç®€å•ï¼Œä½†æœ‰æ—¶å€™å¹¶ä¸ç¬¦åˆç°å®éœ€æ±‚ï¼Œæ¯”å¦‚åœ¨å¾ˆå¤šåœºåˆå¯¹äºè‹±æ–‡å­—ç¬¦æˆ‘ä»¬éƒ½æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´<code>'a'</code>å’Œ<code>'A'</code>æ˜¯ç›¸ç­‰çš„ï¼Œåœ¨è¿™ç§åœºåˆä¸‹å°±ä¸èƒ½ç®€å•ç²—æš´çš„ä½¿ç”¨äºŒè¿›åˆ¶æ¯”è¾ƒè§„åˆ™äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥è¿™æ ·æŒ‡å®šæ¯”è¾ƒè§„åˆ™ï¼š</p><ol><li>å°†ä¸¤ä¸ªå¤§å°å†™ä¸åŒçš„å­—ç¬¦å…¨éƒ½è½¬ä¸ºå¤§å†™æˆ–è€…å°å†™ã€‚</li><li>å†æ¯”è¾ƒè¿™ä¸¤ä¸ªå­—ç¬¦å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</li></ol><p>è¿™æ˜¯ä¸€ç§ç¨å¾®å¤æ‚ä¸€ç‚¹ç‚¹çš„æ¯”è¾ƒè§„åˆ™ï¼Œä½†æ˜¯å®é™…ç”Ÿæ´»ä¸­çš„å­—ç¬¦ä¸æ­¢è‹±æ–‡å­—ç¬¦ä¸€ç§ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æ±‰å­—æœ‰å‡ ä¸‡ä¹‹å¤šï¼Œå¯¹äºæŸä¸€ç§å­—ç¬¦é›†æ¥è¯´ï¼Œæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦å¤§å°çš„è§„åˆ™å¯ä»¥åˆ¶å®šå‡ºå¾ˆå¤šç§ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€ç§å­—ç¬¦é›†å¯ä»¥æœ‰å¤šç§æ¯”è¾ƒè§„åˆ™ï¼Œæˆ‘ä»¬ç¨åå°±è¦ä»‹ç»å„ç§ç°å®ç”Ÿæ´»ä¸­ç”¨çš„å­—ç¬¦é›†ä»¥åŠå®ƒä»¬çš„ä¸€äº›æ¯”è¾ƒè§„åˆ™ã€‚</p><h3 id="ä¸€äº›é‡è¦çš„å­—ç¬¦é›†">ä¸€äº›é‡è¦çš„å­—ç¬¦é›†</h3><p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªä¸–ç•Œå¤ªå¤§äº†ï¼Œä¸åŒçš„äººåˆ¶å®šå‡ºäº†å¥½å¤šç§<code>å­—ç¬¦é›†</code>ï¼Œå®ƒä»¬è¡¨ç¤ºçš„å­—ç¬¦èŒƒå›´å’Œç”¨åˆ°çš„ç¼–ç è§„åˆ™å¯èƒ½éƒ½ä¸ä¸€æ ·ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€äº›å¸¸ç”¨å­—ç¬¦é›†çš„æƒ…å†µï¼š</p><ul><li><p><code>ASCII</code>å­—ç¬¦é›†â€“<strong>1ä¸ªå­—èŠ‚</strong></p><p>å…±æ”¶å½•128ä¸ªå­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€æ ‡ç‚¹ç¬¦å·ã€æ•°å­—ã€å¤§å°å†™å­—æ¯å’Œä¸€äº›ä¸å¯è§å­—ç¬¦ã€‚ç”±äºæ€»å…±æ‰128ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨1ä¸ªå­—èŠ‚æ¥è¿›è¡Œç¼–ç ï¼Œæˆ‘ä»¬çœ‹ä¸€äº›å­—ç¬¦çš„ç¼–ç æ–¹å¼ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-string">&#x27;L&#x27;</span> -&gt;  <span class="hljs-number">01001100</span>ï¼ˆåå…­è¿›åˆ¶ï¼š<span class="hljs-number">0x4C</span>ï¼Œåè¿›åˆ¶ï¼š<span class="hljs-number">76</span>ï¼‰<br><span class="hljs-string">&#x27;M&#x27;</span> -&gt;  <span class="hljs-number">01001101</span>ï¼ˆåå…­è¿›åˆ¶ï¼š<span class="hljs-number">0x4D</span>ï¼Œåè¿›åˆ¶ï¼š<span class="hljs-number">77</span>ï¼‰<br></code></pre></td></tr></table></figure></li><li><p><code>ISO 8859-1</code>å­—ç¬¦é›†â€“<strong>1ä¸ªå­—èŠ‚</strong></p><p>å…±æ”¶å½•256ä¸ªå­—ç¬¦ï¼Œæ˜¯åœ¨<code>ASCII</code>å­—ç¬¦é›†çš„åŸºç¡€ä¸Šåˆæ‰©å……äº†128ä¸ªè¥¿æ¬§å¸¸ç”¨å­—ç¬¦(åŒ…æ‹¬å¾·æ³•ä¸¤å›½çš„å­—æ¯)ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨1ä¸ªå­—èŠ‚æ¥è¿›è¡Œç¼–ç ã€‚è¿™ä¸ªå­—ç¬¦é›†ä¹Ÿæœ‰ä¸€ä¸ªåˆ«å<code>latin1</code>ã€‚</p></li><li><p><code>GB2312</code>å­—ç¬¦é›†â€“<strong>1ä¸ªå­—èŠ‚or2ä¸ªå­—èŠ‚</strong></p><p>æ”¶å½•äº†æ±‰å­—ä»¥åŠæ‹‰ä¸å­—æ¯ã€å¸Œè…Šå­—æ¯ã€æ—¥æ–‡å¹³å‡ååŠç‰‡å‡åå­—æ¯ã€ä¿„è¯­è¥¿é‡Œå°”å­—æ¯ã€‚å…¶ä¸­æ”¶å½•æ±‰å­—6763ä¸ªï¼Œå…¶ä»–æ–‡å­—ç¬¦å·682ä¸ªã€‚åŒæ—¶è¿™ç§å­—ç¬¦é›†åˆå…¼å®¹<code>ASCII</code>å­—ç¬¦é›†ï¼Œæ‰€ä»¥åœ¨ç¼–ç æ–¹å¼ä¸Šæ˜¾å¾—æœ‰äº›å¥‡æ€ªï¼š</p><ul><li>å¦‚æœè¯¥å­—ç¬¦åœ¨<code>ASCII</code>å­—ç¬¦é›†ä¸­ï¼Œåˆ™é‡‡ç”¨1å­—èŠ‚ç¼–ç ã€‚</li><li>å¦åˆ™é‡‡ç”¨2å­—èŠ‚ç¼–ç ã€‚</li></ul><p>è¿™ç§è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦éœ€è¦çš„å­—èŠ‚æ•°å¯èƒ½ä¸åŒçš„ç¼–ç æ–¹å¼ç§°ä¸º<code>å˜é•¿ç¼–ç æ–¹å¼</code>ã€‚æ¯”æ–¹è¯´å­—ç¬¦ä¸²<code>'çˆ±u'</code>ï¼Œå…¶ä¸­<code>'çˆ±'</code>éœ€è¦ç”¨2ä¸ªå­—èŠ‚è¿›è¡Œç¼–ç ï¼Œç¼–ç åçš„åå…­è¿›åˆ¶è¡¨ç¤ºä¸º<code>0xB0AE</code>ï¼Œ<code>'u'</code>éœ€è¦ç”¨1ä¸ªå­—èŠ‚è¿›è¡Œç¼–ç ï¼Œç¼–ç åçš„åå…­è¿›åˆ¶è¡¨ç¤ºä¸º<code>0x75</code>ï¼Œæ‰€ä»¥æ‹¼åˆèµ·æ¥å°±æ˜¯<code>0xB0AE75</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>æˆ‘ä»¬æ€ä¹ˆåŒºåˆ†æŸä¸ªå­—èŠ‚ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦è¿˜æ˜¯ä»£è¡¨æŸä¸ªå­—ç¬¦çš„ä¸€éƒ¨åˆ†å‘¢ï¼Ÿåˆ«å¿˜äº†`ASCII`å­—ç¬¦é›†åªæ”¶å½•128ä¸ªå­—ç¬¦ï¼Œä½¿ç”¨0ï½127å°±å¯ä»¥è¡¨ç¤ºå…¨éƒ¨å­—ç¬¦ï¼Œæ‰€ä»¥å¦‚æœæŸä¸ªå­—èŠ‚æ˜¯åœ¨0ï½127ä¹‹å†…çš„ï¼Œå°±æ„å‘³ç€ä¸€ä¸ªå­—èŠ‚ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ï¼Œå¦åˆ™å°±æ˜¯ä¸¤ä¸ªå­—èŠ‚ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ã€‚<br></code></pre></td></tr></table></figure></li><li><p><code>GBK</code>å­—ç¬¦é›†â€“<strong>ä¸­æ–‡2ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡1ä¸ªå­—èŠ‚</strong></p><p><code>GBK</code>å­—ç¬¦é›†åªæ˜¯åœ¨æ”¶å½•å­—ç¬¦èŒƒå›´ä¸Šå¯¹<code>GB2312</code>å­—ç¬¦é›†ä½œäº†æ‰©å……ï¼Œç¼–ç æ–¹å¼ä¸Šå…¼å®¹<code>GB2312</code>ã€‚</p></li><li><p><code>utf8</code>å­—ç¬¦é›†â€“<strong>1ï½4ä¸ªå­—èŠ‚</strong></p><p>æ”¶å½•åœ°çƒä¸Šèƒ½æƒ³åˆ°çš„æ‰€æœ‰å­—ç¬¦ï¼Œè€Œä¸”è¿˜åœ¨ä¸æ–­æ‰©å……ã€‚è¿™ç§å­—ç¬¦é›†å…¼å®¹<code>ASCII</code>å­—ç¬¦é›†ï¼Œé‡‡ç”¨å˜é•¿ç¼–ç æ–¹å¼ï¼Œç¼–ç ä¸€ä¸ªå­—ç¬¦éœ€è¦ä½¿ç”¨1ï½4ä¸ªå­—èŠ‚ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-string">&#x27;L&#x27;</span> -&gt;  <span class="hljs-number">01001100</span>ï¼ˆåå…­è¿›åˆ¶ï¼š<span class="hljs-number">0x4C</span>ï¼‰<br><span class="hljs-string">&#x27;å•Š&#x27;</span> -&gt;  <span class="hljs-number">111001011001010110001010</span>ï¼ˆåå…­è¿›åˆ¶ï¼š<span class="hljs-number">0xE5958A</span>ï¼‰<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>å…¶å®å‡†ç¡®çš„è¯´ï¼Œutf8åªæ˜¯Unicodeå­—ç¬¦é›†çš„ä¸€ç§ç¼–ç æ–¹æ¡ˆï¼ŒUnicodeå­—ç¬¦é›†å¯ä»¥é‡‡ç”¨utf8ã€utf16ã€utf32è¿™å‡ ç§ç¼–ç æ–¹æ¡ˆï¼Œutf8ä½¿ç”¨1ï½4ä¸ªå­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦ï¼Œutf16ä½¿ç”¨2ä¸ªæˆ–4ä¸ªå­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦ï¼Œutf32ä½¿ç”¨4ä¸ªå­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦ã€‚æ›´è¯¦ç»†çš„Unicodeå’Œå…¶ç¼–ç æ–¹æ¡ˆçš„çŸ¥è¯†ä¸æ˜¯æœ¬ä¹¦çš„é‡ç‚¹ï¼Œå¤§å®¶ä¸Šç½‘æŸ¥æŸ¥å“ˆï½<br><br>MySQLä¸­å¹¶ä¸åŒºåˆ†å­—ç¬¦é›†å’Œç¼–ç æ–¹æ¡ˆçš„æ¦‚å¿µï¼Œæ‰€ä»¥åè¾¹å” å¨çš„æ—¶å€™æŠŠutf8ã€utf16ã€utf32éƒ½å½“ä½œä¸€ç§å­—ç¬¦é›†å¯¹å¾…ã€‚<br></code></pre></td></tr></table></figure></li></ul><p>å¯¹äºåŒä¸€ä¸ªå­—ç¬¦ï¼Œä¸åŒå­—ç¬¦é›†ä¹Ÿå¯èƒ½æœ‰ä¸åŒçš„ç¼–ç æ–¹å¼ã€‚æ¯”å¦‚å¯¹äºæ±‰å­—<code>'æˆ‘'</code>æ¥è¯´ï¼Œ<code>ASCII</code>å­—ç¬¦é›†ä¸­æ ¹æœ¬æ²¡æœ‰æ”¶å½•è¿™ä¸ªå­—ç¬¦ï¼Œ<code>utf8</code>å’Œ<code>gb2312</code>å­—ç¬¦é›†å¯¹æ±‰å­—<code>æˆ‘</code>çš„ç¼–ç æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">utf8</span>ç¼–ç ï¼š<span class="hljs-number">111001101000100010010001</span> (<span class="hljs-number">3</span>ä¸ªå­—èŠ‚ï¼Œåå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ï¼š<span class="hljs-number">0</span>xE<span class="hljs-number">68891</span>)<br><span class="hljs-attribute">gb2312</span>ç¼–ç ï¼š<span class="hljs-number">1011000010101110</span> (<span class="hljs-number">2</span>ä¸ªå­—èŠ‚ï¼Œåå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ï¼š<span class="hljs-number">0</span>xB<span class="hljs-number">0</span>AE)<br></code></pre></td></tr></table></figure><h2 id="MySQLä¸­æ”¯æŒçš„å­—ç¬¦é›†å’Œæ’åºè§„åˆ™">MySQLä¸­æ”¯æŒçš„å­—ç¬¦é›†å’Œæ’åºè§„åˆ™</h2><h3 id="MySQLä¸­çš„utf8å’Œutf8mb4">MySQLä¸­çš„utf8å’Œutf8mb4</h3><p>æˆ‘ä»¬ä¸Šè¾¹è¯´<code>utf8</code>å­—ç¬¦é›†è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦éœ€è¦ä½¿ç”¨1ï½4ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›å­—ç¬¦ä½¿ç”¨1ï½3ä¸ªå­—èŠ‚å°±å¯ä»¥è¡¨ç¤ºäº†ã€‚è€Œåœ¨<code>MySQL</code>ä¸­å­—ç¬¦é›†è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æ‰€ç”¨æœ€å¤§å­—èŠ‚é•¿åº¦åœ¨æŸäº›æ–¹é¢ä¼šå½±å“ç³»ç»Ÿçš„å­˜å‚¨å’Œæ€§èƒ½ï¼Œæ‰€ä»¥è®¾è®¡<code>MySQL</code>çš„å¤§å”å·å·çš„å®šä¹‰äº†ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ul><li><code>utf8mb3</code>ï¼šé˜‰å‰²è¿‡çš„<code>utf8</code>å­—ç¬¦é›†ï¼Œåªä½¿ç”¨1ï½3ä¸ªå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ã€‚</li><li><code>utf8mb4</code>ï¼šæ­£å®—çš„<code>utf8</code>å­—ç¬¦é›†ï¼Œä½¿ç”¨1ï½4ä¸ªå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ã€‚</li></ul><p>æœ‰ä¸€ç‚¹éœ€è¦å¤§å®¶ååˆ†çš„æ³¨æ„ï¼Œåœ¨<code>MySQL</code>ä¸­<code>utf8</code>æ˜¯<code>utf8mb3</code>çš„åˆ«åï¼Œæ‰€ä»¥ä¹‹ååœ¨<code>MySQL</code>ä¸­æåˆ°<code>utf8</code>å°±æ„å‘³ç€ä½¿ç”¨1~3ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœå¤§å®¶æœ‰ä½¿ç”¨4å­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦çš„æƒ…å†µï¼Œæ¯”å¦‚<strong>å­˜å‚¨ä¸€äº›emojiè¡¨æƒ…å•¥çš„ï¼Œé‚£è¯·ä½¿ç”¨<code>utf8mb4</code></strong>ã€‚</p><h3 id="å­—ç¬¦é›†çš„æŸ¥çœ‹">å­—ç¬¦é›†çš„æŸ¥çœ‹</h3><p><code>MySQL</code>æ”¯æŒå¥½å¤šå¥½å¤šç§å­—ç¬¦é›†ï¼ŒæŸ¥çœ‹å½“å‰<code>MySQL</code>ä¸­æ”¯æŒçš„å­—ç¬¦é›†å¯ä»¥ç”¨ä¸‹è¾¹è¿™ä¸ªè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> (<span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span><span class="hljs-operator">|</span>CHARSET) [<span class="hljs-keyword">LIKE</span> åŒ¹é…çš„æ¨¡å¼];<br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>CHARACTER SET</code>å’Œ<code>CHARSET</code>æ˜¯åŒä¹‰è¯ï¼Œç”¨ä»»æ„ä¸€ä¸ªéƒ½å¯ä»¥ã€‚æˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸‹ï¼ˆæ”¯æŒçš„å­—ç¬¦é›†å¤ªå¤šäº†ï¼Œæˆ‘ä»¬çœç•¥äº†ä¸€äº›ï¼‰ï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; SHOW CHARSET;<br>+----------+---------------------------------+---------------------+--------+<br>|<span class="hljs-string"> Charset  </span>|<span class="hljs-string"> Description                     </span>|<span class="hljs-string"> Default collation   </span>|<span class="hljs-string"> Maxlen </span>|<br>+----------+---------------------------------+---------------------+--------+<br>|<span class="hljs-string"> big5     </span>|<span class="hljs-string"> Big5 Traditional Chinese        </span>|<span class="hljs-string"> big5_chinese_ci     </span>|<span class="hljs-string">      2 </span>|<br>...<br>|<span class="hljs-string"> latin1   </span>|<span class="hljs-string"> cp1252 West European            </span>|<span class="hljs-string"> latin1_swedish_ci   </span>|<span class="hljs-string">      1 </span>|<br>|<span class="hljs-string"> latin2   </span>|<span class="hljs-string"> ISO 8859-2 Central European     </span>|<span class="hljs-string"> latin2_general_ci   </span>|<span class="hljs-string">      1 </span>|<br>...<br>|<span class="hljs-string"> ascii    </span>|<span class="hljs-string"> US ASCII                        </span>|<span class="hljs-string"> ascii_general_ci    </span>|<span class="hljs-string">      1 </span>|<br>...<br>|<span class="hljs-string"> gb2312   </span>|<span class="hljs-string"> GB2312 Simplified Chinese       </span>|<span class="hljs-string"> gb2312_chinese_ci   </span>|<span class="hljs-string">      2 </span>|<br>...<br>|<span class="hljs-string"> gbk      </span>|<span class="hljs-string"> GBK Simplified Chinese          </span>|<span class="hljs-string"> gbk_chinese_ci      </span>|<span class="hljs-string">      2 </span>|<br>|<span class="hljs-string"> latin5   </span>|<span class="hljs-string"> ISO 8859-9 Turkish              </span>|<span class="hljs-string"> latin5_turkish_ci   </span>|<span class="hljs-string">      1 </span>|<br>...<br>|<span class="hljs-string"> utf8     </span>|<span class="hljs-string"> UTF-8 Unicode                   </span>|<span class="hljs-string"> utf8_general_ci     </span>|<span class="hljs-string">      3 </span>|<br>|<span class="hljs-string"> ucs2     </span>|<span class="hljs-string"> UCS-2 Unicode                   </span>|<span class="hljs-string"> ucs2_general_ci     </span>|<span class="hljs-string">      2 </span>|<br>...<br>|<span class="hljs-string"> latin7   </span>|<span class="hljs-string"> ISO 8859-13 Baltic              </span>|<span class="hljs-string"> latin7_general_ci   </span>|<span class="hljs-string">      1 </span>|<br>|<span class="hljs-string"> utf8mb4  </span>|<span class="hljs-string"> UTF-8 Unicode                   </span>|<span class="hljs-string"> utf8mb4_general_ci  </span>|<span class="hljs-string">      4 </span>|<br>|<span class="hljs-string"> utf16    </span>|<span class="hljs-string"> UTF-16 Unicode                  </span>|<span class="hljs-string"> utf16_general_ci    </span>|<span class="hljs-string">      4 </span>|<br>|<span class="hljs-string"> utf16le  </span>|<span class="hljs-string"> UTF-16LE Unicode                </span>|<span class="hljs-string"> utf16le_general_ci  </span>|<span class="hljs-string">      4 </span>|<br>...<br>|<span class="hljs-string"> utf32    </span>|<span class="hljs-string"> UTF-32 Unicode                  </span>|<span class="hljs-string"> utf32_general_ci    </span>|<span class="hljs-string">      4 </span>|<br>|<span class="hljs-string"> binary   </span>|<span class="hljs-string"> Binary pseudo charset           </span>|<span class="hljs-string"> binary              </span>|<span class="hljs-string">      1 </span>|<br>...<br>|<span class="hljs-string"> gb18030  </span>|<span class="hljs-string"> China National Standard GB18030 </span>|<span class="hljs-string"> gb18030_chinese_ci  </span>|<span class="hljs-string">      4 </span>|<br>+----------+---------------------------------+---------------------+--------+<br>41 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä½¿ç”¨çš„è¿™ä¸ª<code>MySQL</code>ç‰ˆæœ¬ä¸€å…±æ”¯æŒ<code>41</code>ç§å­—ç¬¦é›†ï¼Œå…¶ä¸­çš„<code>Default collation</code>åˆ—è¡¨ç¤ºè¿™ç§å­—ç¬¦é›†ä¸­ä¸€ç§é»˜è®¤çš„<code>æ¯”è¾ƒè§„åˆ™</code>ã€‚å¤§å®¶æ³¨æ„è¿”å›ç»“æœä¸­çš„æœ€åä¸€åˆ—<code>Maxlen</code>ï¼Œå®ƒä»£è¡¨è¯¥ç§å­—ç¬¦é›†è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æœ€å¤šéœ€è¦å‡ ä¸ªå­—èŠ‚ã€‚ä¸ºäº†è®©å¤§å®¶çš„å°è±¡æ›´æ·±åˆ»ï¼Œæˆ‘æŠŠå‡ ä¸ªå¸¸ç”¨åˆ°çš„å­—ç¬¦é›†çš„<code>Maxlen</code>åˆ—æ‘˜æŠ„ä¸‹æ¥ï¼Œå¤§å®¶åŠ¡å¿…è®°ä½ï¼š</p><table><thead><tr><th>å­—ç¬¦é›†åç§°</th><th>Maxlen</th></tr></thead><tbody><tr><td><code>ascii</code></td><td><code>1</code></td></tr><tr><td><code>latin1</code></td><td><code>1</code></td></tr><tr><td><code>gb2312</code></td><td><code>2</code></td></tr><tr><td><code>gbk</code></td><td><code>2</code></td></tr><tr><td><code>utf8</code></td><td><code>3</code></td></tr><tr><td><code>utf8mb4</code></td><td><code>4</code></td></tr></tbody></table><h3 id="æ¯”è¾ƒè§„åˆ™çš„æŸ¥çœ‹">æ¯”è¾ƒè§„åˆ™çš„æŸ¥çœ‹</h3><p>æŸ¥çœ‹<code>MySQL</code>ä¸­æ”¯æŒçš„æ¯”è¾ƒè§„åˆ™çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">COLLATION</span> [<span class="hljs-keyword">LIKE</span> åŒ¹é…çš„æ¨¡å¼];<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ä¸€ç§å­—ç¬¦é›†å¯èƒ½å¯¹åº”ç€è‹¥å¹²ç§æ¯”è¾ƒè§„åˆ™ï¼Œ<code>MySQL</code>æ”¯æŒçš„å­—ç¬¦é›†å°±å·²ç»éå¸¸å¤šäº†ï¼Œæ‰€ä»¥æ”¯æŒçš„æ¯”è¾ƒè§„åˆ™æ›´å¤šï¼Œæˆ‘ä»¬å…ˆåªæŸ¥çœ‹ä¸€ä¸‹<code>utf8</code>å­—ç¬¦é›†ä¸‹çš„æ¯”è¾ƒè§„åˆ™ï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; SHOW COLLATION LIKE &#x27;utf8\_%&#x27;;<br>+--------------------------+---------+-----+---------+----------+---------+<br>|<span class="hljs-string"> Collation                </span>|<span class="hljs-string"> Charset </span>|<span class="hljs-string"> Id  </span>|<span class="hljs-string"> Default </span>|<span class="hljs-string"> Compiled </span>|<span class="hljs-string"> Sortlen </span>|<br>+--------------------------+---------+-----+---------+----------+---------+<br>|<span class="hljs-string"> utf8_general_ci          </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string">  33 </span>|<span class="hljs-string"> Yes     </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       1 </span>|<br>|<span class="hljs-string"> utf8_bin                 </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string">  83 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       1 </span>|<br>|<span class="hljs-string"> utf8_unicode_ci          </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 192 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_icelandic_ci        </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 193 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_latvian_ci          </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 194 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_romanian_ci         </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 195 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_slovenian_ci        </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 196 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_polish_ci           </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 197 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_estonian_ci         </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 198 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_spanish_ci          </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 199 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_swedish_ci          </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 200 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_turkish_ci          </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 201 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_czech_ci            </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 202 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_danish_ci           </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 203 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_lithuanian_ci       </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 204 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_slovak_ci           </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 205 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_spanish2_ci         </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 206 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_roman_ci            </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 207 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_persian_ci          </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 208 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_esperanto_ci        </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 209 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_hungarian_ci        </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 210 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_sinhala_ci          </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 211 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_german2_ci          </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 212 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_croatian_ci         </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 213 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_unicode_520_ci      </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 214 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_vietnamese_ci       </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 215 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       8 </span>|<br>|<span class="hljs-string"> utf8_general_mysql500_ci </span>|<span class="hljs-string"> utf8    </span>|<span class="hljs-string"> 223 </span>|<span class="hljs-string">         </span>|<span class="hljs-string"> Yes      </span>|<span class="hljs-string">       1 </span>|<br>+--------------------------+---------+-----+---------+----------+---------+<br>27 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>è¿™äº›æ¯”è¾ƒè§„åˆ™çš„å‘½åè¿˜æŒºæœ‰è§„å¾‹çš„ï¼Œå…·ä½“è§„å¾‹å¦‚ä¸‹ï¼š</p><ul><li><p>æ¯”è¾ƒè§„åˆ™åç§°ä»¥ä¸å…¶å…³è”çš„å­—ç¬¦é›†çš„åç§°å¼€å¤´ã€‚å¦‚ä¸Šå›¾çš„æŸ¥è¯¢ç»“æœçš„æ¯”è¾ƒè§„åˆ™åç§°éƒ½æ˜¯ä»¥<code>utf8</code>å¼€å¤´çš„ã€‚</p></li><li><p>åè¾¹ç´§è·Ÿç€è¯¥æ¯”è¾ƒè§„åˆ™ä¸»è¦ä½œç”¨äºå“ªç§è¯­è¨€ï¼Œæ¯”å¦‚<code>utf8_polish_ci</code>è¡¨ç¤ºä»¥æ³¢å…°è¯­çš„è§„åˆ™æ¯”è¾ƒï¼Œ<code>utf8_spanish_ci</code>æ˜¯ä»¥è¥¿ç­ç‰™è¯­çš„è§„åˆ™æ¯”è¾ƒï¼Œ<code>utf8_general_ci</code>æ˜¯ä¸€ç§é€šç”¨çš„æ¯”è¾ƒè§„åˆ™ã€‚</p></li><li><p>åç§°åç¼€æ„å‘³ç€è¯¥æ¯”è¾ƒè§„åˆ™æ˜¯å¦åŒºåˆ†è¯­è¨€ä¸­çš„é‡éŸ³ã€å¤§å°å†™å•¥çš„ï¼Œå…·ä½“å¯ä»¥ç”¨çš„å€¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åç¼€</th><th>è‹±æ–‡é‡Šä¹‰</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>_ai</code></td><td><code>accent insensitive</code></td><td>ä¸åŒºåˆ†é‡éŸ³</td></tr><tr><td><code>_as</code></td><td><code>accent sensitive</code></td><td>åŒºåˆ†é‡éŸ³</td></tr><tr><td><code>_ci</code></td><td><code>case insensitive</code></td><td>ä¸åŒºåˆ†å¤§å°å†™</td></tr><tr><td><code>_cs</code></td><td><code>case sensitive</code></td><td>åŒºåˆ†å¤§å°å†™</td></tr><tr><td><code>_bin</code></td><td><code>binary</code></td><td>ä»¥äºŒè¿›åˆ¶æ–¹å¼æ¯”è¾ƒ</td></tr></tbody></table><p>æ¯”å¦‚<code>utf8_general_ci</code>è¿™ä¸ªæ¯”è¾ƒè§„åˆ™æ˜¯ä»¥<code>ci</code>ç»“å°¾çš„ï¼Œè¯´æ˜ä¸åŒºåˆ†å¤§å°å†™ã€‚</p></li></ul><p>æ¯ç§å­—ç¬¦é›†å¯¹åº”è‹¥å¹²ç§æ¯”è¾ƒè§„åˆ™ï¼Œæ¯ç§å­—ç¬¦é›†éƒ½æœ‰ä¸€ç§é»˜è®¤çš„æ¯”è¾ƒè§„åˆ™ï¼Œ<code>SHOW COLLATION</code>çš„è¿”å›ç»“æœä¸­çš„<code>Default</code>åˆ—çš„å€¼ä¸º<code>YES</code>çš„å°±æ˜¯è¯¥å­—ç¬¦é›†çš„é»˜è®¤æ¯”è¾ƒè§„åˆ™ï¼Œæ¯”æ–¹è¯´<code>utf8</code>å­—ç¬¦é›†é»˜è®¤çš„æ¯”è¾ƒè§„åˆ™å°±æ˜¯<code>utf8_general_ci</code>ã€‚</p><h2 id="å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™çš„åº”ç”¨">å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™çš„åº”ç”¨</h2><h3 id="å„çº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™">å„çº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</h3><p><code>MySQL</code>æœ‰4ä¸ªçº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>æœåŠ¡å™¨çº§åˆ«</li><li>æ•°æ®åº“çº§åˆ«</li><li>è¡¨çº§åˆ«</li><li>åˆ—çº§åˆ«</li></ul><p>æˆ‘ä»¬æ¥ä¸‹æ¥ä»”ç»†çœ‹ä¸€ä¸‹æ€ä¹ˆè®¾ç½®å’ŒæŸ¥çœ‹è¿™å‡ ä¸ªçº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚</p><h4 id="æœåŠ¡å™¨çº§åˆ«">æœåŠ¡å™¨çº§åˆ«</h4><p><code>MySQL</code>æä¾›äº†ä¸¤ä¸ªç³»ç»Ÿå˜é‡æ¥è¡¨ç¤ºæœåŠ¡å™¨çº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼š</p><table><thead><tr><th>ç³»ç»Ÿå˜é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>character_set_server</code></td><td>æœåŠ¡å™¨çº§åˆ«çš„å­—ç¬¦é›†</td></tr><tr><td><code>collation_server</code></td><td>æœåŠ¡å™¨çº§åˆ«çš„æ¯”è¾ƒè§„åˆ™</td></tr></tbody></table><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªç³»ç»Ÿå˜é‡çš„å€¼ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;character_set_server&#x27;;</span><br><span class="hljs-section">+----------------------+-------+</span><br><span class="hljs-section">| Variable_name        | Value |</span><br><span class="hljs-section">+----------------------+-------+</span><br><span class="hljs-section">| character_set_server | utf8  |</span><br><span class="hljs-section">+----------------------+-------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;collation_server&#x27;;</span><br><span class="hljs-section">+------------------+-----------------+</span><br><span class="hljs-section">| Variable_name    | Value           |</span><br><span class="hljs-section">+------------------+-----------------+</span><br><span class="hljs-section">| collation_server | utf8_general_ci |</span><br><span class="hljs-section">+------------------+-----------------+</span><br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨æˆ‘çš„è®¡ç®—æœºä¸­æœåŠ¡å™¨çº§åˆ«é»˜è®¤çš„å­—ç¬¦é›†æ˜¯<code>utf8</code>ï¼Œé»˜è®¤çš„æ¯”è¾ƒè§„åˆ™æ˜¯<code>utf8_general_ci</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨æœåŠ¡å™¨ç¨‹åºæ—¶é€šè¿‡å¯åŠ¨é€‰é¡¹æˆ–è€…åœ¨æœåŠ¡å™¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨<code>SET</code>è¯­å¥ä¿®æ”¹è¿™ä¸¤ä¸ªå˜é‡çš„å€¼ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿™æ ·å†™ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[server]</span><br><span class="hljs-attr">character_set_server</span>=gbk<br><span class="hljs-attr">collation_server</span>=gbk_chinese_ci<br></code></pre></td></tr></table></figure><p>å½“æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶åè¿™ä¸¤ä¸ªç³»ç»Ÿå˜é‡çš„å€¼ä¾¿ä¿®æ”¹äº†ã€‚</p><h4 id="æ•°æ®åº“çº§åˆ«">æ•°æ®åº“çº§åˆ«</h4><p>æˆ‘ä»¬åœ¨åˆ›å»ºå’Œä¿®æ”¹æ•°æ®åº“çš„æ—¶å€™å¯ä»¥æŒ‡å®šè¯¥æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œå…·ä½“è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> æ•°æ®åº“å<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°]<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°];<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">DATABASE</span> æ•°æ®åº“å<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°]<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°];<br></code></pre></td></tr></table></figure><p>å…¶ä¸­çš„<code>DEFAULT</code>å¯ä»¥çœç•¥ï¼Œå¹¶ä¸å½±å“è¯­å¥çš„è¯­ä¹‰ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æ–°åˆ›å»ºä¸€ä¸ªåå«<code>charset_demo_db</code>çš„æ•°æ®åº“ï¼Œåœ¨åˆ›å»ºçš„æ—¶å€™æŒ‡å®šå®ƒä½¿ç”¨çš„å­—ç¬¦é›†ä¸º<code>gb2312</code>ï¼Œæ¯”è¾ƒè§„åˆ™ä¸º<code>gb2312_chinese_ci</code>ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql&gt; <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> charset_demo_db<br>    -&gt; <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> gb2312<br>    -&gt; <span class="hljs-keyword">COLLATE</span> gb2312_chinese_ci;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-keyword">row</span> affected (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³æŸ¥çœ‹å½“å‰æ•°æ®åº“ä½¿ç”¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹é¢ä¸¤ä¸ªç³»ç»Ÿå˜é‡çš„å€¼ï¼ˆå‰ææ˜¯ä½¿ç”¨<code>USE</code>è¯­å¥é€‰æ‹©å½“å‰é»˜è®¤æ•°æ®åº“ï¼Œå¦‚æœæ²¡æœ‰é»˜è®¤æ•°æ®åº“ï¼Œåˆ™å˜é‡ä¸ç›¸åº”çš„æœåŠ¡å™¨çº§ç³»ç»Ÿå˜é‡å…·æœ‰ç›¸åŒçš„å€¼ï¼‰ï¼š</p><table><thead><tr><th>ç³»ç»Ÿå˜é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>character_set_database</code></td><td>å½“å‰æ•°æ®åº“çš„å­—ç¬¦é›†</td></tr><tr><td><code>collation_database</code></td><td>å½“å‰æ•°æ®åº“çš„æ¯”è¾ƒè§„åˆ™</td></tr></tbody></table><p>æˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹åˆšåˆšåˆ›å»ºçš„<code>charset_demo_db</code>æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">mysql&gt; USE charset_demo_db;<br>Database changed<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;character_set_database&#x27;;</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| Variable_name          | Value  |</span><br><span class="hljs-section">+------------------------+--------+</span><br><span class="hljs-section">| character_set_database | gb2312 |</span><br><span class="hljs-section">+------------------------+--------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;collation_database&#x27;;</span><br><span class="hljs-section">+--------------------+-------------------+</span><br><span class="hljs-section">| Variable_name      | Value             |</span><br><span class="hljs-section">+--------------------+-------------------+</span><br><span class="hljs-section">| collation_database | gb2312_chinese_ci |</span><br><span class="hljs-section">+--------------------+-------------------+</span><br>1 row in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ª<code>charset_demo_db</code>æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™å°±æ˜¯æˆ‘ä»¬åœ¨åˆ›å»ºè¯­å¥ä¸­æŒ‡å®šçš„ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼š <em><strong>character_set_database</strong></em> å’Œ <em><strong>collation_database</strong></em> è¿™ä¸¤ä¸ªç³»ç»Ÿå˜é‡æ˜¯åªè¯»çš„ï¼Œæˆ‘ä»¬ä¸èƒ½é€šè¿‡ä¿®æ”¹è¿™ä¸¤ä¸ªå˜é‡çš„å€¼è€Œæ”¹å˜å½“å‰æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚</p><p>æ•°æ®åº“çš„åˆ›å»ºè¯­å¥ä¸­ä¹Ÿå¯ä»¥ä¸æŒ‡å®šå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> æ•°æ®åº“å;<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯å°†ä½¿ç”¨æœåŠ¡å™¨çº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ä½œä¸ºæ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚</p><h4 id="è¡¨çº§åˆ«">è¡¨çº§åˆ«</h4><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºå’Œä¿®æ”¹è¡¨çš„æ—¶å€™æŒ‡å®šè¡¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å (åˆ—çš„ä¿¡æ¯)<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°]<br>    [<span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°]]<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°]<br>    [<span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°]<br></code></pre></td></tr></table></figure><p>æ¯”æ–¹è¯´æˆ‘ä»¬åœ¨åˆšåˆšåˆ›å»ºçš„<code>charset_demo_db</code>æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code>t</code>çš„è¡¨ï¼Œå¹¶æŒ‡å®šè¿™ä¸ªè¡¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t(<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     col <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>)<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> ) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br></code></pre></td></tr></table></figure><p>å¦‚æœåˆ›å»ºå’Œä¿®æ”¹è¡¨çš„è¯­å¥ä¸­æ²¡æœ‰æŒ‡æ˜å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œå°†ä½¿ç”¨è¯¥è¡¨æ‰€åœ¨æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ä½œä¸ºè¯¥è¡¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚å‡è®¾æˆ‘ä»¬çš„åˆ›å»ºè¡¨<code>t</code>çš„è¯­å¥æ˜¯è¿™ä¹ˆå†™çš„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t(<br>    col <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>)<br>);<br></code></pre></td></tr></table></figure><p>å› ä¸ºè¡¨<code>t</code>çš„å»ºè¡¨è¯­å¥ä¸­å¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œåˆ™è¡¨<code>t</code>çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™å°†ç»§æ‰¿æ‰€åœ¨æ•°æ®åº“<code>charset_demo_db</code>çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œä¹Ÿå°±æ˜¯<code>gb2312</code>å’Œ<code>gb2312_chinese_ci</code>ã€‚</p><h4 id="åˆ—çº§åˆ«">åˆ—çº§åˆ«</h4><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå­˜å‚¨å­—ç¬¦ä¸²çš„åˆ—ï¼ŒåŒä¸€ä¸ªè¡¨ä¸­çš„ä¸åŒçš„åˆ—ä¹Ÿå¯ä»¥æœ‰ä¸åŒçš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚æˆ‘ä»¬åœ¨åˆ›å»ºå’Œä¿®æ”¹åˆ—å®šä¹‰çš„æ—¶å€™å¯ä»¥æŒ‡å®šè¯¥åˆ—çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å(<br>    åˆ—å å­—ç¬¦ä¸²ç±»å‹ [<span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°] [<span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°],<br>    å…¶ä»–åˆ—...<br>);<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å MODIFY åˆ—å å­—ç¬¦ä¸²ç±»å‹ [<span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°] [<span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°];<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è¡¨<code>t</code>ä¸­åˆ—<code>col</code>çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> t MODIFY col <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> gbk <span class="hljs-keyword">COLLATE</span> gbk_chinese_ci;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br>Records: <span class="hljs-number">0</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>å¯¹äºæŸä¸ªåˆ—æ¥è¯´ï¼Œå¦‚æœåœ¨åˆ›å»ºå’Œä¿®æ”¹çš„è¯­å¥ä¸­æ²¡æœ‰æŒ‡æ˜å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œå°†ä½¿ç”¨è¯¥åˆ—æ‰€åœ¨è¡¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ä½œä¸ºè¯¥åˆ—çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚æ¯”æ–¹è¯´è¡¨<code>t</code>çš„å­—ç¬¦é›†æ˜¯<code>utf8</code>ï¼Œæ¯”è¾ƒè§„åˆ™æ˜¯<code>utf8_general_ci</code>ï¼Œä¿®æ”¹åˆ—<code>col</code>çš„è¯­å¥æ˜¯è¿™ä¹ˆå†™çš„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> t MODIFY col <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><p>é‚£åˆ—<code>col</code>çš„å­—ç¬¦é›†å’Œç¼–ç å°†ä½¿ç”¨è¡¨<code>t</code>çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œä¹Ÿå°±æ˜¯<code>utf8</code>å’Œ<code>utf8_general_ci</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>åœ¨è½¬æ¢åˆ—çš„å­—ç¬¦é›†æ—¶éœ€è¦æ³¨æ„ï¼Œå¦‚æœè½¬æ¢å‰åˆ—ä¸­å­˜å‚¨çš„æ•°æ®ä¸èƒ½ç”¨è½¬æ¢åçš„å­—ç¬¦é›†è¿›è¡Œè¡¨ç¤ºä¼šå‘ç”Ÿé”™è¯¯ã€‚æ¯”æ–¹è¯´åŸå…ˆåˆ—ä½¿ç”¨çš„å­—ç¬¦é›†æ˜¯utf8ï¼Œåˆ—ä¸­å­˜å‚¨äº†ä¸€äº›æ±‰å­—ï¼Œç°åœ¨æŠŠåˆ—çš„å­—ç¬¦é›†è½¬æ¢ä¸ºasciiçš„è¯å°±ä¼šå‡ºé”™ï¼Œå› ä¸ºasciiå­—ç¬¦é›†å¹¶ä¸èƒ½è¡¨ç¤ºæ±‰å­—å­—ç¬¦ã€‚<br></code></pre></td></tr></table></figure><h4 id="ä»…ä¿®æ”¹å­—ç¬¦é›†æˆ–ä»…ä¿®æ”¹æ¯”è¾ƒè§„åˆ™">ä»…ä¿®æ”¹å­—ç¬¦é›†æˆ–ä»…ä¿®æ”¹æ¯”è¾ƒè§„åˆ™</h4><p>ç”±äºå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™æ˜¯äº’ç›¸æœ‰è”ç³»çš„ï¼Œå¦‚æœæˆ‘ä»¬åªä¿®æ”¹äº†å­—ç¬¦é›†ï¼Œæ¯”è¾ƒè§„åˆ™ä¹Ÿä¼šè·Ÿç€å˜åŒ–ï¼Œå¦‚æœåªä¿®æ”¹äº†æ¯”è¾ƒè§„åˆ™ï¼Œå­—ç¬¦é›†ä¹Ÿä¼šè·Ÿç€å˜åŒ–ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>åªä¿®æ”¹å­—ç¬¦é›†ï¼Œåˆ™æ¯”è¾ƒè§„åˆ™å°†å˜ä¸ºä¿®æ”¹åçš„å­—ç¬¦é›†é»˜è®¤çš„æ¯”è¾ƒè§„åˆ™ã€‚</li><li>åªä¿®æ”¹æ¯”è¾ƒè§„åˆ™ï¼Œåˆ™å­—ç¬¦é›†å°†å˜ä¸ºä¿®æ”¹åçš„æ¯”è¾ƒè§„åˆ™å¯¹åº”çš„å­—ç¬¦é›†ã€‚</li></ul><p>ä¸è®ºå“ªä¸ªçº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œè¿™ä¸¤æ¡è§„åˆ™éƒ½é€‚ç”¨ï¼Œæˆ‘ä»¬ä»¥æœåŠ¡å™¨çº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ä¸ºä¾‹æ¥çœ‹ä¸€ä¸‹è¯¦ç»†è¿‡ç¨‹ï¼š</p><ul><li><p>åªä¿®æ”¹å­—ç¬¦é›†ï¼Œåˆ™æ¯”è¾ƒè§„åˆ™å°†å˜ä¸ºä¿®æ”¹åçš„å­—ç¬¦é›†é»˜è®¤çš„æ¯”è¾ƒè§„åˆ™ã€‚</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">mysql&gt; SET character_set_server = gb2312;<br>Query OK, 0 rows affected (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;character_set_server&#x27;;</span><br><span class="hljs-section">+----------------------+--------+</span><br><span class="hljs-section">| Variable_name        | Value  |</span><br><span class="hljs-section">+----------------------+--------+</span><br><span class="hljs-section">| character_set_server | gb2312 |</span><br><span class="hljs-section">+----------------------+--------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt;  SHOW VARIABLES LIKE &#x27;collation_server&#x27;;</span><br><span class="hljs-section">+------------------+-------------------+</span><br><span class="hljs-section">| Variable_name    | Value             |</span><br><span class="hljs-section">+------------------+-------------------+</span><br><span class="hljs-section">| collation_server | gb2312_chinese_ci |</span><br><span class="hljs-section">+------------------+-------------------+</span><br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åªä¿®æ”¹äº†<code>character_set_server</code>çš„å€¼ä¸º<code>gb2312</code>ï¼Œ<code>collation_server</code>çš„å€¼è‡ªåŠ¨å˜ä¸ºäº†<code>gb2312_chinese_ci</code>ã€‚</p></li><li><p>åªä¿®æ”¹æ¯”è¾ƒè§„åˆ™ï¼Œåˆ™å­—ç¬¦é›†å°†å˜ä¸ºä¿®æ”¹åçš„æ¯”è¾ƒè§„åˆ™å¯¹åº”çš„å­—ç¬¦é›†ã€‚</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">mysql&gt; SET collation_server = utf8_general_ci;<br>Query OK, 0 rows affected (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;character_set_server&#x27;;</span><br><span class="hljs-section">+----------------------+-------+</span><br><span class="hljs-section">| Variable_name        | Value |</span><br><span class="hljs-section">+----------------------+-------+</span><br><span class="hljs-section">| character_set_server | utf8  |</span><br><span class="hljs-section">+----------------------+-------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;collation_server&#x27;;</span><br><span class="hljs-section">+------------------+-----------------+</span><br><span class="hljs-section">| Variable_name    | Value           |</span><br><span class="hljs-section">+------------------+-----------------+</span><br><span class="hljs-section">| collation_server | utf8_general_ci |</span><br><span class="hljs-section">+------------------+-----------------+</span><br>1 row in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åªä¿®æ”¹äº†<code>collation_server</code>çš„å€¼ä¸º<code>utf8_general_ci</code>ï¼Œ<code>character_set_server</code>çš„å€¼è‡ªåŠ¨å˜ä¸ºäº†<code>utf8</code>ã€‚</p></li></ul><h4 id="å„çº§åˆ«å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™å°ç»“">å„çº§åˆ«å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™å°ç»“</h4><p>æˆ‘ä»¬ä»‹ç»çš„è¿™4ä¸ªçº§åˆ«å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™çš„è”ç³»å¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœ<strong>åˆ›å»ºæˆ–ä¿®æ”¹åˆ—</strong>æ—¶æ²¡æœ‰æ˜¾å¼çš„æŒ‡å®šå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œ<strong>åˆ™è¯¥åˆ—é»˜è®¤ç”¨è¡¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</strong></li><li>å¦‚æœ<strong>åˆ›å»ºè¡¨</strong>æ—¶æ²¡æœ‰æ˜¾å¼çš„æŒ‡å®šå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œ<strong>åˆ™è¯¥è¡¨é»˜è®¤ç”¨æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</strong></li><li>å¦‚æœ<strong>åˆ›å»ºæ•°æ®åº“</strong>æ—¶æ²¡æœ‰æ˜¾å¼çš„æŒ‡å®šå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œ<strong>åˆ™è¯¥æ•°æ®åº“é»˜è®¤ç”¨æœåŠ¡å™¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</strong></li></ul><p>çŸ¥é“äº†è¿™äº›è§„åˆ™ä¹‹åï¼Œå¯¹äºç»™å®šçš„è¡¨ï¼Œæˆ‘ä»¬åº”è¯¥çŸ¥é“å®ƒçš„å„ä¸ªåˆ—çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™æ˜¯ä»€ä¹ˆï¼Œä»è€Œæ ¹æ®è¿™ä¸ªåˆ—çš„ç±»å‹æ¥ç¡®å®šå­˜å‚¨æ•°æ®æ—¶æ¯ä¸ªåˆ—çš„å®é™…æ•°æ®å ç”¨çš„å­˜å‚¨ç©ºé—´å¤§å°äº†ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬å‘è¡¨<code>t</code>ä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">mysql&gt; INSERT INTO t(col) VALUES(<span class="hljs-emphasis">&#x27;æˆ‘æˆ‘&#x27;</span>);<br>Query OK, 1 row affected (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SELECT * FROM t;</span><br><span class="hljs-section">+--------+</span><br><span class="hljs-section">| s      |</span><br><span class="hljs-section">+--------+</span><br><span class="hljs-section">| æˆ‘æˆ‘   |</span><br><span class="hljs-section">+--------+</span><br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>é¦–å…ˆåˆ—<code>col</code>ä½¿ç”¨çš„å­—ç¬¦é›†æ˜¯<code>gbk</code>ï¼Œä¸€ä¸ªå­—ç¬¦<code>'æˆ‘'</code>åœ¨<code>gbk</code>ä¸­çš„ç¼–ç ä¸º<code>0xCED2</code>ï¼Œå ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸¤ä¸ªå­—ç¬¦çš„å®é™…æ•°æ®å°±å ç”¨4ä¸ªå­—èŠ‚ã€‚å¦‚æœæŠŠè¯¥åˆ—çš„å­—ç¬¦é›†ä¿®æ”¹ä¸º<code>utf8</code>çš„è¯ï¼Œè¿™ä¸¤ä¸ªå­—ç¬¦å°±å®é™…å ç”¨6ä¸ªå­—èŠ‚å•¦ï½</p><h3 id="å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šä¿¡ä¸­çš„å­—ç¬¦é›†">å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šä¿¡ä¸­çš„å­—ç¬¦é›†</h3><h4 id="ç¼–ç å’Œè§£ç ä½¿ç”¨çš„å­—ç¬¦é›†ä¸ä¸€è‡´çš„åæœ">ç¼–ç å’Œè§£ç ä½¿ç”¨çš„å­—ç¬¦é›†ä¸ä¸€è‡´çš„åæœ</h4><p>è¯´åˆ°åº•ï¼Œå­—ç¬¦ä¸²åœ¨è®¡ç®—æœºä¸Šçš„ä½“ç°å°±æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸²ï¼Œå¦‚æœä½ ä½¿ç”¨ä¸åŒå­—ç¬¦é›†å»è§£ç è¿™ä¸ªå­—èŠ‚ä¸²ï¼Œæœ€åå¾—åˆ°çš„ç»“æœå¯èƒ½è®©ä½ æŒ å¤´ã€‚</p><p>æˆ‘ä»¬çŸ¥é“å­—ç¬¦<code>'æˆ‘'</code>åœ¨<code>utf8</code>å­—ç¬¦é›†ç¼–ç ä¸‹çš„å­—èŠ‚ä¸²é•¿è¿™æ ·ï¼š<code>0xE68891</code>ï¼Œå¦‚æœä¸€ä¸ªç¨‹åºæŠŠè¿™ä¸ªå­—èŠ‚ä¸²å‘é€åˆ°å¦ä¸€ä¸ªç¨‹åºé‡Œï¼Œå¦ä¸€ä¸ªç¨‹åºç”¨ä¸åŒçš„å­—ç¬¦é›†å»è§£ç è¿™ä¸ªå­—èŠ‚ä¸²ï¼Œå‡è®¾ä½¿ç”¨çš„æ˜¯<code>gbk</code>å­—ç¬¦é›†æ¥è§£é‡Šè¿™ä¸²å­—èŠ‚ï¼Œè§£ç è¿‡ç¨‹å°±æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>é¦–å…ˆçœ‹ç¬¬ä¸€ä¸ªå­—èŠ‚<code>0xE6</code>ï¼Œå®ƒçš„å€¼å¤§äº<code>0x7F</code>ï¼ˆåè¿›åˆ¶ï¼š127ï¼‰ï¼Œè¯´æ˜æ˜¯ä¸¤å­—èŠ‚ç¼–ç ï¼Œç»§ç»­è¯»ä¸€å­—èŠ‚åæ˜¯<code>0xE688</code>ï¼Œç„¶åä»<code>gbk</code>ç¼–ç è¡¨ä¸­æŸ¥æ‰¾å­—èŠ‚ä¸º<code>0xE688</code>å¯¹åº”çš„å­—ç¬¦ï¼Œå‘ç°æ˜¯å­—ç¬¦<code>'é´'</code></li><li>ç»§ç»­è¯»ä¸€ä¸ªå­—èŠ‚<code>0x91</code>ï¼Œå®ƒçš„å€¼ä¹Ÿå¤§äº<code>0x7F</code>ï¼Œå†å¾€åè¯»ä¸€ä¸ªå­—èŠ‚å‘ç°æœ¨æœ‰äº†ï¼Œæ‰€ä»¥è¿™æ˜¯åŠä¸ªå­—ç¬¦ã€‚</li><li>æ‰€ä»¥<code>0xE68891</code>è¢«<code>gbk</code>å­—ç¬¦é›†è§£é‡Šæˆä¸€ä¸ªå­—ç¬¦<code>'é´'</code>å’ŒåŠä¸ªå­—ç¬¦ã€‚</li></ol><p>å‡è®¾ç”¨<code>iso-8859-1</code>ï¼Œä¹Ÿå°±æ˜¯<code>latin1</code>å­—ç¬¦é›†å»è§£é‡Šè¿™ä¸²å­—èŠ‚ï¼Œè§£ç è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å…ˆè¯»ç¬¬ä¸€ä¸ªå­—èŠ‚<code>0xE6</code>ï¼Œå®ƒå¯¹åº”çš„<code>latin1</code>å­—ç¬¦ä¸º<code>Ã¦</code>ã€‚</li><li>å†è¯»ç¬¬äºŒä¸ªå­—èŠ‚<code>0x88</code>ï¼Œå®ƒå¯¹åº”çš„<code>latin1</code>å­—ç¬¦ä¸º<code>Ë†</code>ã€‚</li><li>å†è¯»ç¬¬ä¸‰ä¸ªå­—èŠ‚<code>0x91</code>ï¼Œå®ƒå¯¹åº”çš„<code>latin1</code>å­—ç¬¦ä¸º<code>â€˜</code>ã€‚</li><li>æ‰€ä»¥æ•´ä¸²å­—èŠ‚<code>0xE68891</code>è¢«<code>latin1</code>å­—ç¬¦é›†è§£é‡Šåçš„å­—ç¬¦ä¸²å°±æ˜¯<code>'Ã¦Ë†â€˜'</code></li></ol><p>å¯è§ï¼Œå¦‚æœå¯¹äºåŒä¸€ä¸ªå­—ç¬¦ä¸²ç¼–ç å’Œè§£ç ä½¿ç”¨çš„å­—ç¬¦é›†ä¸ä¸€æ ·ï¼Œä¼šäº§ç”Ÿæ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œä½œä¸ºäººç±»çš„æˆ‘ä»¬çœ‹ä¸Šå»å°±åƒæ˜¯äº§ç”Ÿäº†ä¹±ç ä¸€æ ·ã€‚</p><h4 id="å­—ç¬¦é›†è½¬æ¢çš„æ¦‚å¿µ">å­—ç¬¦é›†è½¬æ¢çš„æ¦‚å¿µ</h4><p>å¦‚æœæ¥æ”¶<code>0xE68891</code>è¿™ä¸ªå­—èŠ‚ä¸²çš„ç¨‹åºæŒ‰ç…§<code>utf8</code>å­—ç¬¦é›†è¿›è¡Œè§£ç ï¼Œç„¶ååˆæŠŠå®ƒæŒ‰ç…§<code>gbk</code>å­—ç¬¦é›†è¿›è¡Œç¼–ç ï¼Œæœ€åç¼–ç åçš„å­—èŠ‚ä¸²å°±æ˜¯<code>0xCED2</code>ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<code>å­—ç¬¦é›†çš„è½¬æ¢</code>ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²<code>'æˆ‘'</code>ä»<code>utf8</code>å­—ç¬¦é›†è½¬æ¢ä¸º<code>gbk</code>å­—ç¬¦é›†ã€‚</p><h4 id="MySQLä¸­å­—ç¬¦é›†çš„è½¬æ¢">MySQLä¸­å­—ç¬¦é›†çš„è½¬æ¢</h4><p>æˆ‘ä»¬çŸ¥é“ä»å®¢æˆ·ç«¯å‘å¾€æœåŠ¡å™¨çš„è¯·æ±‚æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å›çš„ç»“æœæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œå­—ç¬¦ä¸²å…¶å®æ˜¯ä½¿ç”¨æŸç§å­—ç¬¦é›†ç¼–ç çš„äºŒè¿›åˆ¶æ•°æ®ã€‚è¿™ä¸ªå­—ç¬¦ä¸²å¯ä¸æ˜¯ä½¿ç”¨ä¸€ç§å­—ç¬¦é›†çš„ç¼–ç æ–¹å¼ä¸€æ¡é“èµ°åˆ°é»‘çš„ï¼Œä»å‘é€è¯·æ±‚åˆ°è¿”å›ç»“æœè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼´éšç€å¤šæ¬¡å­—ç¬¦é›†çš„è½¬æ¢ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šç”¨åˆ°3ä¸ªç³»ç»Ÿå˜é‡ï¼Œæˆ‘ä»¬å…ˆæŠŠå®ƒä»¬å†™å‡ºæ¥çœ‹ä¸€ä¸‹ï¼š</p><table><thead><tr><th>ç³»ç»Ÿå˜é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>character_set_client</code></td><td>æœåŠ¡å™¨è§£ç è¯·æ±‚æ—¶ä½¿ç”¨çš„å­—ç¬¦é›†</td></tr><tr><td><code>character_set_connection</code></td><td>æœåŠ¡å™¨å¤„ç†è¯·æ±‚æ—¶ä¼šæŠŠè¯·æ±‚å­—ç¬¦ä¸²ä»<code>character_set_client</code>è½¬ä¸º<code>character_set_connection</code></td></tr><tr><td><code>character_set_results</code></td><td>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ—¶ä½¿ç”¨çš„å­—ç¬¦é›†</td></tr></tbody></table><p>è¿™å‡ ä¸ªç³»ç»Ÿå˜é‡åœ¨æˆ‘çš„è®¡ç®—æœºä¸Šçš„é»˜è®¤å€¼å¦‚ä¸‹ï¼ˆä¸åŒæ“ä½œç³»ç»Ÿçš„é»˜è®¤å€¼å¯èƒ½ä¸åŒï¼‰ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;character_set_client&#x27;;</span><br><span class="hljs-section">+----------------------+-------+</span><br><span class="hljs-section">| Variable_name        | Value |</span><br><span class="hljs-section">+----------------------+-------+</span><br><span class="hljs-section">| character_set_client | utf8  |</span><br><span class="hljs-section">+----------------------+-------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;character_set_connection&#x27;;</span><br><span class="hljs-section">+--------------------------+-------+</span><br><span class="hljs-section">| Variable_name            | Value |</span><br><span class="hljs-section">+--------------------------+-------+</span><br><span class="hljs-section">| character_set_connection | utf8  |</span><br><span class="hljs-section">+--------------------------+-------+</span><br>1 row in set (0.01 sec)<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;character_set_results&#x27;;</span><br><span class="hljs-section">+-----------------------+-------+</span><br><span class="hljs-section">| Variable_name         | Value |</span><br><span class="hljs-section">+-----------------------+-------+</span><br><span class="hljs-section">| character_set_results | utf8  |</span><br><span class="hljs-section">+-----------------------+-------+</span><br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å¤§å®¶å¯ä»¥çœ‹åˆ°è¿™å‡ ä¸ªç³»ç»Ÿå˜é‡çš„å€¼éƒ½æ˜¯<code>utf8</code>ï¼Œä¸ºäº†ä½“ç°å‡ºå­—ç¬¦é›†åœ¨è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­çš„å˜åŒ–ï¼Œæˆ‘ä»¬è¿™é‡Œç‰¹æ„ä¿®æ”¹ä¸€ä¸ªç³»ç»Ÿå˜é‡çš„å€¼ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; set character_set_connection = gbk;<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ç°åœ¨ç³»ç»Ÿå˜é‡<code>character_set_client</code>å’Œ<code>character_set_results</code>çš„å€¼è¿˜æ˜¯<code>utf8</code>ï¼Œè€Œ<code>character_set_connection</code>çš„å€¼ä¸º<code>gbk</code>ã€‚ç°åœ¨å‡è®¾æˆ‘ä»¬å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ˜¯ä¸‹è¾¹è¿™ä¸ªå­—ç¬¦ä¸²ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> t <span class="hljs-keyword">WHERE</span> s = <span class="hljs-string">&#x27;æˆ‘&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬åªåˆ†æå­—ç¬¦<code>'æˆ‘'</code>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å­—ç¬¦é›†çš„è½¬æ¢ã€‚</p><p>ç°åœ¨çœ‹ä¸€ä¸‹åœ¨è¯·æ±‚ä»å‘é€åˆ°ç»“æœè¿”å›è¿‡ç¨‹ä¸­å­—ç¬¦é›†çš„å˜åŒ–ï¼š</p><ol><li><p>å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ‰€ä½¿ç”¨çš„å­—ç¬¦é›†</p><p>ä¸€èˆ¬æƒ…å†µä¸‹å®¢æˆ·ç«¯æ‰€ä½¿ç”¨çš„å­—ç¬¦é›†å’Œå½“å‰æ“ä½œç³»ç»Ÿä¸€è‡´ï¼Œä¸åŒæ“ä½œç³»ç»Ÿä½¿ç”¨çš„å­—ç¬¦é›†å¯èƒ½ä¸ä¸€æ ·ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>ç±»<code>Unix</code>ç³»ç»Ÿä½¿ç”¨çš„æ˜¯<code>utf8</code></li><li><code>Windows</code>ä½¿ç”¨çš„æ˜¯<code>gbk</code></li></ul><p>ä¾‹å¦‚æˆ‘åœ¨ä½¿ç”¨çš„<code>macOS</code>æ“ä½œç³»ç»Ÿæ—¶ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨çš„å°±æ˜¯<code>utf8</code>å­—ç¬¦é›†ã€‚æ‰€ä»¥å­—ç¬¦<code>'æˆ‘'</code>åœ¨å‘é€ç»™æœåŠ¡å™¨çš„è¯·æ±‚ä¸­çš„å­—èŠ‚å½¢å¼å°±æ˜¯ï¼š<code>0xE68891</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å¯è§†åŒ–å·¥å…·ï¼Œæ¯”å¦‚navicatä¹‹ç±»çš„ï¼Œè¿™äº›å·¥å…·å¯èƒ½ä¼šä½¿ç”¨è‡ªå®šä¹‰çš„å­—ç¬¦é›†æ¥ç¼–ç å‘é€åˆ°æœåŠ¡å™¨çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸é‡‡ç”¨æ“ä½œç³»ç»Ÿé»˜è®¤çš„å­—ç¬¦é›†ï¼ˆæ‰€ä»¥åœ¨å­¦ä¹ çš„æ—¶å€™è¿˜æ˜¯å°½é‡ç”¨é»‘æ¡†æ¡†å“ˆï¼‰ã€‚<br></code></pre></td></tr></table></figure></li><li><p>æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€æ¥çš„è¯·æ±‚å…¶å®æ˜¯ä¸€ä¸²äºŒè¿›åˆ¶çš„å­—èŠ‚ï¼Œå®ƒä¼šè®¤ä¸ºè¿™ä¸²å­—èŠ‚é‡‡ç”¨çš„å­—ç¬¦é›†æ˜¯<code>character_set_client</code>ï¼Œç„¶åæŠŠè¿™ä¸²å­—èŠ‚è½¬æ¢ä¸º<code>character_set_connection</code>å­—ç¬¦é›†ç¼–ç çš„å­—ç¬¦ã€‚</p><p>ç”±äºæˆ‘çš„è®¡ç®—æœºä¸Š<code>character_set_client</code>çš„å€¼æ˜¯<code>utf8</code>ï¼Œé¦–å…ˆä¼šæŒ‰ç…§<code>utf8</code>å­—ç¬¦é›†å¯¹å­—èŠ‚ä¸²<code>0xE68891</code>è¿›è¡Œè§£ç ï¼Œå¾—åˆ°çš„å­—ç¬¦ä¸²å°±æ˜¯<code>'æˆ‘'</code>ï¼Œç„¶åæŒ‰ç…§<code>character_set_connection</code>ä»£è¡¨çš„å­—ç¬¦é›†ï¼Œä¹Ÿå°±æ˜¯<code>gbk</code>è¿›è¡Œç¼–ç ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯å­—èŠ‚ä¸²<code>0xCED2</code>ã€‚</p></li><li><p>å› ä¸ºè¡¨<code>t</code>çš„åˆ—<code>col</code>é‡‡ç”¨çš„æ˜¯<code>gbk</code>å­—ç¬¦é›†ï¼Œä¸<code>character_set_connection</code>ä¸€è‡´ï¼Œæ‰€ä»¥ç›´æ¥åˆ°åˆ—ä¸­æ‰¾å­—èŠ‚å€¼ä¸º<code>0xCED2</code>çš„è®°å½•ï¼Œæœ€åæ‰¾åˆ°äº†ä¸€æ¡è®°å½•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>å¦‚æœæŸä¸ªåˆ—ä½¿ç”¨çš„å­—ç¬¦é›†å’Œcharacter_set_connectionä»£è¡¨çš„å­—ç¬¦é›†ä¸ä¸€è‡´çš„è¯ï¼Œè¿˜éœ€è¦è¿›è¡Œä¸€æ¬¡å­—ç¬¦é›†è½¬æ¢ã€‚<br></code></pre></td></tr></table></figure></li><li><p>ä¸Šä¸€æ­¥éª¤æ‰¾åˆ°çš„è®°å½•ä¸­çš„<code>col</code>åˆ—å…¶å®æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸²<code>0xCED2</code>ï¼Œ<code>col</code>åˆ—æ˜¯é‡‡ç”¨<code>gbk</code>è¿›è¡Œç¼–ç çš„ï¼Œæ‰€ä»¥é¦–å…ˆä¼šå°†è¿™ä¸ªå­—èŠ‚ä¸²ä½¿ç”¨<code>gbk</code>è¿›è¡Œè§£ç ï¼Œå¾—åˆ°å­—ç¬¦ä¸²<code>'æˆ‘'</code>ï¼Œç„¶åå†æŠŠè¿™ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨<code>character_set_results</code>ä»£è¡¨çš„å­—ç¬¦é›†ï¼Œä¹Ÿå°±æ˜¯<code>utf8</code>è¿›è¡Œç¼–ç ï¼Œå¾—åˆ°äº†æ–°çš„å­—èŠ‚ä¸²ï¼š<code>0xE68891</code>ï¼Œç„¶åå‘é€ç»™å®¢æˆ·ç«¯ã€‚</p></li><li><p>ç”±äºå®¢æˆ·ç«¯æ˜¯ç”¨çš„å­—ç¬¦é›†æ˜¯<code>utf8</code>ï¼Œæ‰€ä»¥å¯ä»¥é¡ºåˆ©çš„å°†<code>0xE68891</code>è§£é‡Šæˆå­—ç¬¦<code>æˆ‘</code>ï¼Œä»è€Œæ˜¾ç¤ºåˆ°æˆ‘ä»¬çš„æ˜¾ç¤ºå™¨ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬äººç±»ä¹Ÿè¯»æ‡‚äº†è¿”å›çš„ç»“æœã€‚</p></li></ol><p>å¦‚æœä½ è¯»ä¸Šè¾¹çš„æ–‡å­—æœ‰ç‚¹æ™•ï¼Œå¯ä»¥å‚ç…§è¿™ä¸ªå›¾æ¥ä»”ç»†åˆ†æä¸€ä¸‹è¿™å‡ ä¸ªæ­¥éª¤ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a2f479833d3340~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1d6dfk4orjaj1ra8536aijb99.png-112.4kB"><p>ä»è¿™ä¸ªåˆ†æä¸­æˆ‘ä»¬å¯ä»¥å¾—å‡ºè¿™ä¹ˆå‡ ç‚¹éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p><ul><li><p>æœåŠ¡å™¨è®¤ä¸ºå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚æ˜¯ç”¨<code>character_set_client</code>ç¼–ç çš„ã€‚</p><p>å‡è®¾ä½ çš„å®¢æˆ·ç«¯é‡‡ç”¨çš„å­—ç¬¦é›†å’Œ <em><strong>character_set_client</strong></em> ä¸ä¸€æ ·çš„è¯ï¼Œè¿™å°±ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„æƒ…å†µã€‚æ¯”å¦‚æˆ‘çš„å®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯<code>utf8</code>å­—ç¬¦é›†ï¼Œå¦‚æœæŠŠç³»ç»Ÿå˜é‡<code>character_set_client</code>çš„å€¼è®¾ç½®ä¸º<code>ascii</code>çš„è¯ï¼ŒæœåŠ¡å™¨å¯èƒ½æ— æ³•ç†è§£æˆ‘ä»¬å‘é€çš„è¯·æ±‚ï¼Œæ›´åˆ«è°ˆå¤„ç†è¿™ä¸ªè¯·æ±‚äº†ã€‚</p></li><li><p>æœåŠ¡å™¨å°†æŠŠå¾—åˆ°çš„ç»“æœé›†ä½¿ç”¨<code>character_set_results</code>ç¼–ç åå‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><p>å‡è®¾ä½ çš„å®¢æˆ·ç«¯é‡‡ç”¨çš„å­—ç¬¦é›†å’Œ <em><strong>character_set_results</strong></em> ä¸ä¸€æ ·çš„è¯ï¼Œè¿™å°±å¯èƒ½ä¼šå‡ºç°å®¢æˆ·ç«¯æ— æ³•è§£ç ç»“æœé›†çš„æƒ…å†µï¼Œç»“æœå°±æ˜¯åœ¨ä½ çš„å±å¹•ä¸Šå‡ºç°ä¹±ç ã€‚æ¯”å¦‚æˆ‘çš„å®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯<code>utf8</code>å­—ç¬¦é›†ï¼Œå¦‚æœæŠŠç³»ç»Ÿå˜é‡<code>character_set_results</code>çš„å€¼è®¾ç½®ä¸º<code>ascii</code>çš„è¯ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¹±ç ã€‚</p></li><li><p><code>character_set_connection</code>åªæ˜¯æœåŠ¡å™¨åœ¨å°†è¯·æ±‚çš„å­—èŠ‚ä¸²ä»<code>character_set_client</code>è½¬æ¢ä¸º<code>character_set_connection</code>æ—¶ä½¿ç”¨ï¼Œå®ƒæ˜¯ä»€ä¹ˆå…¶å®æ²¡å¤šé‡è¦ï¼Œä½†æ˜¯ä¸€å®šè¦æ³¨æ„ï¼Œè¯¥å­—ç¬¦é›†åŒ…å«çš„å­—ç¬¦èŒƒå›´ä¸€å®šæ¶µç›–è¯·æ±‚ä¸­çš„å­—ç¬¦ï¼Œè¦ä¸ç„¶ä¼šå¯¼è‡´æœ‰çš„å­—ç¬¦æ— æ³•ä½¿ç”¨<code>character_set_connection</code>ä»£è¡¨çš„å­—ç¬¦é›†è¿›è¡Œç¼–ç ã€‚æ¯”å¦‚ä½ æŠŠ<code>character_set_client</code>è®¾ç½®ä¸º<code>utf8</code>ï¼ŒæŠŠ<code>character_set_connection</code>è®¾ç½®æˆ<code>ascii</code>ï¼Œé‚£ä¹ˆæ­¤æ—¶ä½ å¦‚æœä»å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªæ±‰å­—åˆ°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæœåŠ¡å™¨æ— æ³•ä½¿ç”¨<code>ascii</code>å­—ç¬¦é›†æ¥ç¼–ç è¿™ä¸ªæ±‰å­—ï¼Œå°±ä¼šå‘ç”¨æˆ·å‘å‡ºä¸€ä¸ªè­¦å‘Šã€‚</p></li></ul><p>çŸ¥é“äº†åœ¨<code>MySQL</code>ä¸­ä»å‘é€è¯·æ±‚åˆ°è¿”å›ç»“æœè¿‡ç¨‹é‡Œå‘ç”Ÿçš„å„ç§å­—ç¬¦é›†è½¬æ¢ï¼Œä½†æ˜¯ä¸ºå•¥è¦è½¬æ¥è½¬å»çš„å‘¢ï¼Ÿä¸æ™•ä¹ˆï¼Ÿ</p><p>ç­”ï¼šæ˜¯çš„ï¼Œå¾ˆå¤´æ™•ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸éƒ½æŠŠ <em><strong>character_set_client</strong></em> ã€<em><strong>character_set_connection</strong></em>ã€<em><strong>character_set_results</strong></em> è¿™ä¸‰ä¸ªç³»ç»Ÿå˜é‡è®¾ç½®æˆå’Œå®¢æˆ·ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†ä¸€è‡´çš„æƒ…å†µï¼Œè¿™æ ·å‡å°‘äº†å¾ˆå¤šæ— è°“çš„å­—ç¬¦é›†è½¬æ¢ã€‚ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬è®¾ç½®ï¼Œ<code>MySQL</code>æä¾›äº†ä¸€æ¡éå¸¸ç®€ä¾¿çš„è¯­å¥ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-keyword">SET</span> NAMES å­—ç¬¦é›†å;<br></code></pre></td></tr></table></figure><p>è¿™ä¸€æ¡è¯­å¥äº§ç”Ÿçš„æ•ˆæœå’Œæˆ‘ä»¬æ‰§è¡Œè¿™3æ¡çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">SET character_set_client</span> = å­—ç¬¦é›†å;<br><span class="hljs-attribute">SET character_set_connection</span> = å­—ç¬¦é›†å;<br><span class="hljs-attribute">SET character_set_results</span> = å­—ç¬¦é›†å;<br></code></pre></td></tr></table></figure><p>æ¯”æ–¹è¯´æˆ‘çš„å®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯<code>utf8</code>å­—ç¬¦é›†ï¼Œæ‰€ä»¥éœ€è¦æŠŠè¿™å‡ ä¸ªç³»ç»Ÿå˜é‡çš„å€¼éƒ½è®¾ç½®ä¸º<code>utf8</code>ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">mysql&gt; SET NAMES utf8;<br>Query OK, 0 rows affected (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;character_set_client&#x27;;</span><br><span class="hljs-section">+----------------------+-------+</span><br><span class="hljs-section">| Variable_name        | Value |</span><br><span class="hljs-section">+----------------------+-------+</span><br><span class="hljs-section">| character_set_client | utf8  |</span><br><span class="hljs-section">+----------------------+-------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt;  SHOW VARIABLES LIKE &#x27;character_set_connection&#x27;;</span><br><span class="hljs-section">+--------------------------+-------+</span><br><span class="hljs-section">| Variable_name            | Value |</span><br><span class="hljs-section">+--------------------------+-------+</span><br><span class="hljs-section">| character_set_connection | utf8  |</span><br><span class="hljs-section">+--------------------------+-------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;character_set_results&#x27;;</span><br><span class="hljs-section">+-----------------------+-------+</span><br><span class="hljs-section">| Variable_name         | Value |</span><br><span class="hljs-section">+-----------------------+-------+</span><br><span class="hljs-section">| character_set_results | utf8  |</span><br><span class="hljs-section">+-----------------------+-------+</span><br>1 row in set (0.00 sec)<br><br>mysql&gt;<br>å°è´´å£«ï¼š<br><br>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Windowsç³»ç»Ÿï¼Œé‚£åº”è¯¥è®¾ç½®æˆgbkã€‚<br></code></pre></td></tr></table></figure><p>å¦å¤–ï¼Œå¦‚æœä½ æƒ³åœ¨å¯åŠ¨å®¢æˆ·ç«¯çš„æ—¶å€™å°±æŠŠ<code>character_set_client</code>ã€<code>character_set_connection</code>ã€<code>character_set_results</code>è¿™ä¸‰ä¸ªç³»ç»Ÿå˜é‡çš„å€¼è®¾ç½®æˆä¸€æ ·çš„ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨å®¢æˆ·ç«¯çš„æ—¶å€™æŒ‡å®šä¸€ä¸ªå«<code>default-character-set</code>çš„å¯åŠ¨é€‰é¡¹ï¼Œæ¯”å¦‚åœ¨é…ç½®æ–‡ä»¶é‡Œå¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">client</span>]<br><span class="hljs-literal">default</span>-character-<span class="hljs-keyword">set</span>=utf8<br></code></pre></td></tr></table></figure><p>å®ƒèµ·åˆ°çš„æ•ˆæœå’Œæ‰§è¡Œä¸€é<code>SET NAMES utf8</code>æ˜¯ä¸€æ ·ä¸€æ ·çš„ï¼Œéƒ½ä¼šå°†é‚£ä¸‰ä¸ªç³»ç»Ÿå˜é‡çš„å€¼è®¾ç½®æˆ<code>utf8</code>ã€‚</p><h3 id="æ¯”è¾ƒè§„åˆ™çš„åº”ç”¨">æ¯”è¾ƒè§„åˆ™çš„åº”ç”¨</h3><p>ç»“æŸäº†å­—ç¬¦é›†çš„æ¼«æ¸¸ï¼Œæˆ‘ä»¬æŠŠè§†è§’å†æ¬¡èšç„¦åˆ°<code>æ¯”è¾ƒè§„åˆ™</code>ï¼Œ<code>æ¯”è¾ƒè§„åˆ™</code>çš„ä½œç”¨é€šå¸¸ä½“ç°æ¯”è¾ƒå­—ç¬¦ä¸²å¤§å°çš„è¡¨è¾¾å¼ä»¥åŠå¯¹æŸä¸ªå­—ç¬¦ä¸²åˆ—è¿›è¡Œæ’åºä¸­ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ä¹Ÿç§°ä¸º<code>æ’åºè§„åˆ™</code>ã€‚æ¯”æ–¹è¯´è¡¨<code>t</code>çš„åˆ—<code>col</code>ä½¿ç”¨çš„å­—ç¬¦é›†æ˜¯<code>gbk</code>ï¼Œä½¿ç”¨çš„æ¯”è¾ƒè§„åˆ™æ˜¯<code>gbk_chinese_ci</code>ï¼Œæˆ‘ä»¬å‘é‡Œè¾¹æ’å…¥å‡ æ¡è®°å½•ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">mysql</span>&gt; <span class="hljs-selector-tag">INSERT</span> <span class="hljs-selector-tag">INTO</span> <span class="hljs-selector-tag">t</span>(col) <span class="hljs-selector-tag">VALUES</span>(<span class="hljs-string">&#x27;a&#x27;</span>), (<span class="hljs-string">&#x27;b&#x27;</span>), (<span class="hljs-string">&#x27;A&#x27;</span>), (<span class="hljs-string">&#x27;B&#x27;</span>);<br><span class="hljs-selector-tag">Query</span> <span class="hljs-selector-tag">OK</span>, <span class="hljs-selector-tag">4</span> <span class="hljs-selector-tag">rows</span> <span class="hljs-selector-tag">affected</span> (<span class="hljs-number">0.00</span> sec)<br><span class="hljs-selector-tag">Records</span>: <span class="hljs-selector-tag">4</span>  <span class="hljs-selector-tag">Duplicates</span>: <span class="hljs-selector-tag">0</span>  <span class="hljs-selector-tag">Warnings</span>: <span class="hljs-selector-tag">0</span><br><br><span class="hljs-selector-tag">mysql</span>&gt;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŸ¥è¯¢çš„æ—¶å€™æŒ‰ç…§<code>t</code>åˆ—æ’åºä¸€ä¸‹ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SELECT * FROM t ORDER BY col;</span><br><span class="hljs-section">+------+</span><br><span class="hljs-section">| col  |</span><br><span class="hljs-section">+------+</span><br>| a    |<br>| A    |<br>| b    |<br>| B    |<br><span class="hljs-section">| æˆ‘   |</span><br><span class="hljs-section">+------+</span><br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨é»˜è®¤çš„æ¯”è¾ƒè§„åˆ™<code>gbk_chinese_ci</code>ä¸­æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œæˆ‘ä»¬ç°åœ¨æŠŠåˆ—<code>col</code>çš„æ¯”è¾ƒè§„åˆ™ä¿®æ”¹ä¸º<code>gbk_bin</code>ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; ALTER TABLE t MODIFY col VARCHAR(<span class="hljs-number">10</span>) COLLATE gbk_bin;<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">5</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">02</span> sec)<br><span class="hljs-attribute">Records</span>: <span class="hljs-number">5</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>ç”±äº<code>gbk_bin</code>æ˜¯ç›´æ¥æ¯”è¾ƒå­—ç¬¦çš„ç¼–ç ï¼Œæ‰€ä»¥æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ’åºåçš„æŸ¥è¯¢ç»“æœï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SELECT * FROM t ORDER BY s;</span><br><span class="hljs-section">+------+</span><br><span class="hljs-section">| s    |</span><br><span class="hljs-section">+------+</span><br>| A    |<br>| B    |<br>| a    |<br>| b    |<br><span class="hljs-section">| æˆ‘   |</span><br><span class="hljs-section">+------+</span><br>5 rows in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å¦‚æœä»¥åå¤§å®¶åœ¨å¯¹å­—ç¬¦ä¸²åšæ¯”è¾ƒæˆ–è€…å¯¹æŸä¸ªå­—ç¬¦ä¸²åˆ—åšæ’åºæ“ä½œæ—¶æ²¡æœ‰å¾—åˆ°æƒ³è±¡ä¸­çš„ç»“æœï¼Œéœ€è¦æ€è€ƒä¸€ä¸‹æ˜¯ä¸æ˜¯<code>æ¯”è¾ƒè§„åˆ™</code>çš„é—®é¢˜ï½</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs clean">å°è´´å£«ï¼š<br><br>åˆ—`col`ä¸­å„ä¸ªå­—ç¬¦åœ¨ä½¿ç”¨gbkå­—ç¬¦é›†ç¼–ç åå¯¹åº”çš„æ•°å­—å¦‚ä¸‹ï¼š<br><span class="hljs-string">&#x27;A&#x27;</span> -&gt; <span class="hljs-number">65</span> ï¼ˆåè¿›åˆ¶ï¼‰<br><span class="hljs-string">&#x27;B&#x27;</span> -&gt; <span class="hljs-number">66</span> ï¼ˆåè¿›åˆ¶ï¼‰<br><span class="hljs-string">&#x27;a&#x27;</span> -&gt; <span class="hljs-number">97</span> ï¼ˆåè¿›åˆ¶ï¼‰<br><span class="hljs-string">&#x27;b&#x27;</span> -&gt; <span class="hljs-number">98</span> ï¼ˆåè¿›åˆ¶ï¼‰<br><span class="hljs-string">&#x27;æˆ‘&#x27;</span> -&gt; <span class="hljs-number">25105</span> ï¼ˆåè¿›åˆ¶ï¼‰<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><ol><li><p><code>å­—ç¬¦é›†</code>æŒ‡çš„æ˜¯æŸä¸ªå­—ç¬¦èŒƒå›´çš„ç¼–ç è§„åˆ™ã€‚</p></li><li><p><code>æ¯”è¾ƒè§„åˆ™</code>æ˜¯é’ˆå¯¹æŸä¸ªå­—ç¬¦é›†ä¸­çš„å­—ç¬¦æ¯”è¾ƒå¤§å°çš„ä¸€ç§è§„åˆ™ã€‚</p></li><li><p>åœ¨<code>MySQL</code>ä¸­ï¼Œä¸€ä¸ªå­—ç¬¦é›†å¯ä»¥æœ‰è‹¥å¹²ç§æ¯”è¾ƒè§„åˆ™ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªé»˜è®¤çš„æ¯”è¾ƒè§„åˆ™ï¼Œä¸€ä¸ªæ¯”è¾ƒè§„åˆ™å¿…é¡»å¯¹åº”ä¸€ä¸ªå­—ç¬¦é›†ã€‚</p></li><li><p>æŸ¥çœ‹<code>MySQL</code>ä¸­æŸ¥çœ‹æ”¯æŒçš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™çš„è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> (<span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span><span class="hljs-operator">|</span>CHARSET) [<span class="hljs-keyword">LIKE</span> åŒ¹é…çš„æ¨¡å¼];<br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">COLLATION</span> [<span class="hljs-keyword">LIKE</span> åŒ¹é…çš„æ¨¡å¼];<br></code></pre></td></tr></table></figure></li><li><p>MySQLæœ‰å››ä¸ªçº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</p></li></ol><ul><li><p>æœåŠ¡å™¨çº§åˆ«</p><p><code>character_set_server</code>è¡¨ç¤ºæœåŠ¡å™¨çº§åˆ«çš„å­—ç¬¦é›†ï¼Œ<code>collation_server</code>è¡¨ç¤ºæœåŠ¡å™¨çº§åˆ«çš„æ¯”è¾ƒè§„åˆ™ã€‚</p></li><li><p>æ•°æ®åº“çº§åˆ«</p><p>åˆ›å»ºå’Œä¿®æ”¹æ•°æ®åº“æ—¶å¯ä»¥æŒ‡å®šå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> æ•°æ®åº“å<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°]<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°];<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">DATABASE</span> æ•°æ®åº“å<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°]<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°];<br></code></pre></td></tr></table></figure><p><code>character_set_database</code>è¡¨ç¤ºå½“å‰æ•°æ®åº“çš„å­—ç¬¦é›†ï¼Œ<code>collation_database</code>è¡¨ç¤ºå½“å‰é»˜è®¤æ•°æ®åº“çš„æ¯”è¾ƒè§„åˆ™ï¼Œè¿™ä¸¤ä¸ªç³»ç»Ÿå˜é‡æ˜¯åªè¯»çš„ï¼Œä¸èƒ½ä¿®æ”¹ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå½“å‰é»˜è®¤æ•°æ®åº“ï¼Œåˆ™å˜é‡ä¸ç›¸åº”çš„æœåŠ¡å™¨çº§ç³»ç»Ÿå˜é‡å…·æœ‰ç›¸åŒçš„å€¼ã€‚</p></li><li><p>è¡¨çº§åˆ«</p><p>åˆ›å»ºå’Œä¿®æ”¹è¡¨çš„æ—¶å€™æŒ‡å®šè¡¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å (åˆ—çš„ä¿¡æ¯)<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°]<br>    [<span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°]];<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å<br>    [[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°]<br>    [<span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°];<br></code></pre></td></tr></table></figure></li><li><p>åˆ—çº§åˆ«</p><p>åˆ›å»ºå’Œä¿®æ”¹åˆ—å®šä¹‰çš„æ—¶å€™å¯ä»¥æŒ‡å®šè¯¥åˆ—çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å(<br>    åˆ—å å­—ç¬¦ä¸²ç±»å‹ [<span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°] [<span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°],<br>    å…¶ä»–åˆ—...<br>);<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å MODIFY åˆ—å å­—ç¬¦ä¸²ç±»å‹ [<span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> å­—ç¬¦é›†åç§°] [<span class="hljs-keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°];<br></code></pre></td></tr></table></figure></li></ul><ol><li><p>ä»å‘é€è¯·æ±‚åˆ°æ¥æ”¶ç»“æœè¿‡ç¨‹ä¸­å‘ç”Ÿçš„å­—ç¬¦é›†è½¬æ¢ï¼š</p><ul><li>å®¢æˆ·ç«¯ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„å­—ç¬¦é›†ç¼–ç è¯·æ±‚å­—ç¬¦ä¸²ï¼Œå‘æœåŠ¡å™¨å‘é€çš„æ˜¯ç»è¿‡ç¼–ç çš„ä¸€ä¸ªå­—èŠ‚ä¸²ã€‚</li><li>æœåŠ¡å™¨å°†å®¢æˆ·ç«¯å‘é€æ¥çš„å­—èŠ‚ä¸²é‡‡ç”¨<code>character_set_client</code>ä»£è¡¨çš„å­—ç¬¦é›†è¿›è¡Œè§£ç ï¼Œå°†è§£ç åçš„å­—ç¬¦ä¸²å†æŒ‰ç…§<code>character_set_connection</code>ä»£è¡¨çš„å­—ç¬¦é›†è¿›è¡Œç¼–ç ã€‚</li><li>å¦‚æœ<code>character_set_connection</code>ä»£è¡¨çš„å­—ç¬¦é›†å’Œå…·ä½“æ“ä½œçš„åˆ—ä½¿ç”¨çš„å­—ç¬¦é›†ä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿›è¡Œç›¸åº”æ“ä½œï¼Œå¦åˆ™çš„è¯éœ€è¦å°†è¯·æ±‚ä¸­çš„å­—ç¬¦ä¸²ä»<code>character_set_connection</code>ä»£è¡¨çš„å­—ç¬¦é›†è½¬æ¢ä¸ºå…·ä½“æ“ä½œçš„åˆ—ä½¿ç”¨çš„å­—ç¬¦é›†ä¹‹åå†è¿›è¡Œæ“ä½œã€‚</li><li>å°†ä»æŸä¸ªåˆ—è·å–åˆ°çš„å­—èŠ‚ä¸²ä»è¯¥åˆ—ä½¿ç”¨çš„å­—ç¬¦é›†è½¬æ¢ä¸º<code>character_set_results</code>ä»£è¡¨çš„å­—ç¬¦é›†åå‘é€åˆ°å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„å­—ç¬¦é›†è§£ææ”¶åˆ°çš„ç»“æœé›†å­—èŠ‚ä¸²ã€‚</li></ul><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å„ä¸ªç³»ç»Ÿå˜é‡çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç³»ç»Ÿå˜é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>character_set_client</code></td><td>æœåŠ¡å™¨è§£ç è¯·æ±‚æ—¶ä½¿ç”¨çš„å­—ç¬¦é›†</td></tr><tr><td><code>character_set_connection</code></td><td>æœåŠ¡å™¨å¤„ç†è¯·æ±‚æ—¶ä¼šæŠŠè¯·æ±‚å­—ç¬¦ä¸²ä»<code>character_set_client</code>è½¬ä¸º<code>character_set_connection</code></td></tr><tr><td><code>character_set_results</code></td><td>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ—¶ä½¿ç”¨çš„å­—ç¬¦é›†</td></tr></tbody></table><p>ä¸€èˆ¬æƒ…å†µä¸‹è¦ä½¿ç”¨ä¿æŒè¿™ä¸‰ä¸ªå˜é‡çš„å€¼å’Œå®¢æˆ·ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†ç›¸åŒã€‚</p></li><li><p>æ¯”è¾ƒè§„åˆ™çš„ä½œç”¨é€šå¸¸ä½“ç°æ¯”è¾ƒå­—ç¬¦ä¸²å¤§å°çš„è¡¨è¾¾å¼ä»¥åŠå¯¹æŸä¸ªå­—ç¬¦ä¸²åˆ—è¿›è¡Œæ’åºä¸­ã€‚</p></li></ol><h1>4.InnoDBè®°å½•å­˜å‚¨ç»“æ„</h1><h2 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h2><p><code>MySQL</code>æœåŠ¡å™¨ä¸Šè´Ÿè´£å¯¹è¡¨ä¸­æ•°æ®çš„è¯»å–å’Œå†™å…¥å·¥ä½œçš„éƒ¨åˆ†æ˜¯<code>å­˜å‚¨å¼•æ“</code>ï¼Œè€ŒæœåŠ¡å™¨åˆæ”¯æŒä¸åŒç±»å‹çš„å­˜å‚¨å¼•æ“ï¼Œæ¯”å¦‚<code>InnoDB</code>ã€<code>MyISAM</code>ã€<code>Memory</code>å•¥çš„ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“ä¸€èˆ¬æ˜¯ç”±ä¸åŒçš„äººä¸ºå®ç°ä¸åŒçš„ç‰¹æ€§è€Œå¼€å‘çš„ï¼ŒçœŸå®æ•°æ®åœ¨ä¸åŒå­˜å‚¨å¼•æ“ä¸­å­˜æ”¾çš„æ ¼å¼ä¸€èˆ¬æ˜¯ä¸åŒçš„ï¼Œç”šè‡³æœ‰çš„å­˜å‚¨å¼•æ“æ¯”å¦‚<code>Memory</code>éƒ½ä¸ç”¨ç£ç›˜æ¥å­˜å‚¨æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å…³é—­æœåŠ¡å™¨åè¡¨ä¸­çš„æ•°æ®å°±æ¶ˆå¤±äº†ã€‚</p><h2 id="InnoDBé¡µç®€ä»‹">InnoDBé¡µç®€ä»‹</h2><p><code>InnoDB</code>æ˜¯ä¸€ä¸ª<strong>å°†è¡¨ä¸­çš„æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸Šçš„å­˜å‚¨å¼•æ“</strong>ï¼Œæ‰€ä»¥å³ä½¿å…³æœºåé‡å¯æˆ‘ä»¬çš„æ•°æ®è¿˜æ˜¯å­˜åœ¨çš„ã€‚**çœŸæ­£å¤„ç†æ•°æ®çš„è¿‡ç¨‹æ˜¯å‘ç”Ÿåœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥éœ€è¦æŠŠç£ç›˜ä¸­çš„æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœæ˜¯å¤„ç†å†™å…¥æˆ–ä¿®æ”¹è¯·æ±‚çš„è¯ï¼Œè¿˜éœ€è¦æŠŠå†…å­˜ä¸­çš„å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸Šã€‚**è€Œæˆ‘ä»¬çŸ¥é“è¯»å†™ç£ç›˜çš„é€Ÿåº¦éå¸¸æ…¢ï¼Œå’Œå†…å­˜è¯»å†™å·®äº†å‡ ä¸ªæ•°é‡çº§ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æƒ³ä»è¡¨ä¸­è·å–æŸäº›è®°å½•æ—¶ï¼Œ<code>InnoDB</code>å­˜å‚¨å¼•æ“éœ€è¦ä¸€æ¡ä¸€æ¡çš„æŠŠè®°å½•ä»ç£ç›˜ä¸Šè¯»å‡ºæ¥ä¹ˆï¼Ÿä¸ï¼Œé‚£æ ·ä¼šæ…¢æ­»ï¼Œ<code>InnoDB</code>é‡‡å–çš„æ–¹å¼æ˜¯ï¼šå°†æ•°æ®åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªé¡µï¼Œä»¥é¡µä½œä¸ºç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤äº’çš„åŸºæœ¬å•ä½ï¼ŒInnoDBä¸­é¡µçš„å¤§å°ä¸€èˆ¬ä¸º <em><strong>16</strong></em> KBã€‚ä¹Ÿå°±æ˜¯åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€æ¬¡æœ€å°‘ä»ç£ç›˜ä¸­è¯»å–16KBçš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œä¸€æ¬¡æœ€å°‘æŠŠå†…å­˜ä¸­çš„16KBå†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚</p><h2 id="InnoDBè¡Œæ ¼å¼">InnoDBè¡Œæ ¼å¼</h2><p>æˆ‘ä»¬å¹³æ—¶æ˜¯ä»¥<strong>è®°å½•ä¸ºå•ä½</strong>æ¥å‘è¡¨ä¸­æ’å…¥æ•°æ®çš„ï¼Œè¿™äº›è®°å½•åœ¨ç£ç›˜ä¸Šçš„å­˜æ”¾æ–¹å¼ä¹Ÿè¢«ç§°ä¸º<code>è¡Œæ ¼å¼</code>æˆ–è€…<code>è®°å½•æ ¼å¼</code>ã€‚è®¾è®¡<code>InnoDB</code>å­˜å‚¨å¼•æ“çš„å¤§å”ä»¬åˆ°ç°åœ¨ä¸ºæ­¢è®¾è®¡äº†4ç§ä¸åŒç±»å‹çš„<code>è¡Œæ ¼å¼</code>ï¼Œåˆ†åˆ«æ˜¯<code>Compact</code>ã€<code>Redundant</code>ã€<code>Dynamic</code>å’Œ<code>Compressed</code>è¡Œæ ¼å¼ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œä»–ä»¬å¯èƒ½ä¼šè®¾è®¡å‡ºæ›´å¤šçš„è¡Œæ ¼å¼ï¼Œä½†æ˜¯ä¸ç®¡æ€ä¹ˆå˜ï¼Œåœ¨åŸç†ä¸Šå¤§ä½“éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><h3 id="æŒ‡å®šè¡Œæ ¼å¼çš„è¯­æ³•">æŒ‡å®šè¡Œæ ¼å¼çš„è¯­æ³•</h3><p>æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºæˆ–ä¿®æ”¹è¡¨çš„è¯­å¥ä¸­æŒ‡å®š<code>è¡Œæ ¼å¼</code>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å (åˆ—çš„ä¿¡æ¯) ROW_FORMAT<span class="hljs-operator">=</span>è¡Œæ ¼å¼åç§°<br>    <br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å ROW_FORMAT<span class="hljs-operator">=</span>è¡Œæ ¼å¼åç§°<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬åœ¨<code>xiaohaizi</code>æ•°æ®åº“é‡Œåˆ›å»ºä¸€ä¸ªæ¼”ç¤ºç”¨çš„è¡¨<code>record_format_demo</code>ï¼Œå¯ä»¥è¿™æ ·æŒ‡å®šå®ƒçš„<code>è¡Œæ ¼å¼</code>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> USE xiaohaizi;<br>Database changed<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> record_format_demo (<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     c1 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     c2 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     c3 <span class="hljs-type">CHAR</span>(<span class="hljs-number">10</span>),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     c4 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>)<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> ) CHARSET<span class="hljs-operator">=</span>ascii ROW_FORMAT<span class="hljs-operator">=</span>COMPACT;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„è¿™ä¸ªè¡¨çš„<code>è¡Œæ ¼å¼</code>å°±æ˜¯<code>Compact</code>ï¼Œå¦å¤–ï¼Œæˆ‘ä»¬è¿˜æ˜¾å¼æŒ‡å®šäº†è¿™ä¸ªè¡¨çš„å­—ç¬¦é›†ä¸º<code>ascii</code>ï¼Œå› ä¸º<code>ascii</code>å­—ç¬¦é›†åªåŒ…æ‹¬ç©ºæ ¼ã€æ ‡ç‚¹ç¬¦å·ã€æ•°å­—ã€å¤§å°å†™å­—æ¯å’Œä¸€äº›ä¸å¯è§å­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ±‰å­—æ˜¯ä¸èƒ½å­˜åˆ°è¿™ä¸ªè¡¨é‡Œçš„ã€‚æˆ‘ä»¬ç°åœ¨å‘è¿™ä¸ªè¡¨ä¸­æ’å…¥ä¸¤æ¡è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> record_format_demo(c1, c2, c3, c4) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;aaaa&#x27;</span>, <span class="hljs-string">&#x27;bbb&#x27;</span>, <span class="hljs-string">&#x27;cc&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>), (<span class="hljs-string">&#x27;eeee&#x27;</span>, <span class="hljs-string">&#x27;fff&#x27;</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>);<br>Query OK, <span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br>Records: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨è¡¨ä¸­çš„è®°å½•å°±æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SELECT * FROM record_format_demo;</span><br><span class="hljs-section">+------+-----+------+------+</span><br><span class="hljs-section">| c1   | c2  | c3   | c4   |</span><br><span class="hljs-section">+------+-----+------+------+</span><br>| aaaa | bbb | cc   | d    |<br><span class="hljs-section">| eeee | fff | NULL | NULL |</span><br><span class="hljs-section">+------+-----+------+------+</span><br>2 rows in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure><p>æ¼”ç¤ºè¡¨çš„å†…å®¹ä¹Ÿå¡«å……å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥çœ‹çœ‹å„ä¸ªè¡Œæ ¼å¼ä¸‹çš„å­˜å‚¨æ–¹å¼åˆ°åº•æœ‰å•¥ä¸åŒå§ï½</p><h3 id="COMPACTè¡Œæ ¼å¼">COMPACTè¡Œæ ¼å¼</h3><p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥çœ‹å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e8fafc21aa~tplv-t2oaga2asx-watermark-20211201102238092.awebp" class="" title="image_1c9g4t114n0j1gkro2r1h8h1d1t16.png-42.4kB"><p>å¤§å®¶ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸€æ¡å®Œæ•´çš„è®°å½•å…¶å®å¯ä»¥è¢«åˆ†ä¸º<code>è®°å½•çš„é¢å¤–ä¿¡æ¯</code>å’Œ<code>è®°å½•çš„çœŸå®æ•°æ®</code>ä¸¤å¤§éƒ¨åˆ†ï¼Œä¸‹è¾¹æˆ‘ä»¬è¯¦ç»†çœ‹ä¸€ä¸‹è¿™ä¸¤éƒ¨åˆ†çš„ç»„æˆã€‚</p><h4 id="è®°å½•çš„é¢å¤–ä¿¡æ¯">è®°å½•çš„é¢å¤–ä¿¡æ¯</h4><p>è¿™éƒ¨åˆ†ä¿¡æ¯æ˜¯æœåŠ¡å™¨ä¸ºäº†æè¿°è¿™æ¡è®°å½•è€Œä¸å¾—ä¸é¢å¤–æ·»åŠ çš„ä¸€äº›ä¿¡æ¯ï¼Œè¿™äº›é¢å¤–ä¿¡æ¯åˆ†ä¸º3ç±»ï¼Œåˆ†åˆ«æ˜¯<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>ã€<code>NULLå€¼åˆ—è¡¨</code>å’Œ<code>è®°å½•å¤´ä¿¡æ¯</code>ï¼Œæˆ‘ä»¬åˆ†åˆ«çœ‹ä¸€ä¸‹ã€‚</p><h5 id="å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨">å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</h5><p>æˆ‘ä»¬çŸ¥é“<code>MySQL</code>æ”¯æŒä¸€äº›å˜é•¿çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚<code>VARCHAR(M)</code>ã€<code>VARBINARY(M)</code>ã€å„ç§<code>TEXT</code>ç±»å‹ï¼Œå„ç§<code>BLOB</code>ç±»å‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠæ‹¥æœ‰è¿™äº›æ•°æ®ç±»å‹çš„åˆ—ç§°ä¸º<code>å˜é•¿å­—æ®µ</code>ï¼Œå˜é•¿å­—æ®µä¸­å­˜å‚¨å¤šå°‘å­—èŠ‚çš„æ•°æ®æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å­˜å‚¨çœŸå®æ•°æ®çš„æ—¶å€™éœ€è¦é¡ºä¾¿æŠŠè¿™äº›æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ä¹Ÿå­˜èµ·æ¥ï¼Œè¿™æ ·æ‰ä¸è‡³äºæŠŠ<code>MySQL</code>æœåŠ¡å™¨ææ‡µï¼Œæ‰€ä»¥è¿™äº›å˜é•¿å­—æ®µå ç”¨çš„å­˜å‚¨ç©ºé—´åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ol><li>çœŸæ­£çš„æ•°æ®å†…å®¹</li><li>å ç”¨çš„å­—èŠ‚æ•°</li></ol><p>åœ¨<code>Compact</code>è¡Œæ ¼å¼ä¸­ï¼ŒæŠŠæ‰€æœ‰å˜é•¿å­—æ®µçš„çœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚é•¿åº¦éƒ½å­˜æ”¾åœ¨è®°å½•çš„å¼€å¤´éƒ¨ä½ï¼Œä»è€Œå½¢æˆä¸€ä¸ªå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼Œ<strong>å„å˜é•¿å­—æ®µæ•°æ®å ç”¨çš„å­—èŠ‚æ•°æŒ‰ç…§åˆ—çš„é¡ºåºé€†åºå­˜æ”¾ï¼Œæˆ‘ä»¬å†æ¬¡å¼ºè°ƒä¸€éï¼Œæ˜¯é€†åºå­˜æ”¾ï¼</strong></p><p>æˆ‘ä»¬æ‹¿<code>record_format_demo</code>è¡¨ä¸­çš„ç¬¬ä¸€æ¡è®°å½•æ¥ä¸¾ä¸ªä¾‹å­ã€‚å› ä¸º<code>record_format_demo</code>è¡¨çš„<code>c1</code>ã€<code>c2</code>ã€<code>c4</code>åˆ—éƒ½æ˜¯<code>VARCHAR(10)</code>ç±»å‹çš„ï¼Œä¹Ÿå°±æ˜¯å˜é•¿çš„æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥è¿™ä¸‰ä¸ªåˆ—çš„å€¼çš„é•¿åº¦éƒ½éœ€è¦ä¿å­˜åœ¨è®°å½•å¼€å¤´å¤„ï¼Œå› ä¸º<code>record_format_demo</code>è¡¨ä¸­çš„å„ä¸ªåˆ—éƒ½ä½¿ç”¨çš„æ˜¯<code>ascii</code>å­—ç¬¦é›†ï¼Œæ‰€ä»¥æ¯ä¸ªå­—ç¬¦åªéœ€è¦1ä¸ªå­—èŠ‚æ¥è¿›è¡Œç¼–ç ï¼Œæ¥çœ‹ä¸€ä¸‹ç¬¬ä¸€æ¡è®°å½•å„å˜é•¿å­—æ®µå†…å®¹çš„é•¿åº¦ï¼š</p><table><thead><tr><th>åˆ—å</th><th>å­˜å‚¨å†…å®¹</th><th>å†…å®¹é•¿åº¦ï¼ˆåè¿›åˆ¶è¡¨ç¤ºï¼‰</th><th>å†…å®¹é•¿åº¦ï¼ˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼‰</th></tr></thead><tbody><tr><td><code>c1</code></td><td><code>'aaaa'</code></td><td><code>4</code></td><td><code>0x04</code></td></tr><tr><td><code>c2</code></td><td><code>'bbb'</code></td><td><code>3</code></td><td><code>0x03</code></td></tr><tr><td><code>c4</code></td><td><code>'d'</code></td><td><code>1</code></td><td><code>0x01</code></td></tr></tbody></table><p>åˆå› ä¸ºè¿™äº›é•¿åº¦å€¼éœ€è¦æŒ‰ç…§åˆ—çš„é€†åºå­˜æ”¾ï¼Œæ‰€ä»¥æœ€å<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>çš„å­—èŠ‚ä¸²ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºçš„æ•ˆæœå°±æ˜¯ï¼ˆå„ä¸ªå­—èŠ‚ä¹‹é—´å®é™…ä¸Šæ²¡æœ‰ç©ºæ ¼ï¼Œç”¨ç©ºæ ¼éš”å¼€åªæ˜¯æ–¹ä¾¿ç†è§£ï¼‰ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">01 </span><span class="hljs-number">03</span> <span class="hljs-number">04</span> <br></code></pre></td></tr></table></figure><p>æŠŠè¿™ä¸ªå­—èŠ‚ä¸²ç»„æˆçš„<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>å¡«å…¥ä¸Šè¾¹çš„ç¤ºæ„å›¾ä¸­çš„æ•ˆæœå°±æ˜¯ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e8fb363bb4~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9gbruvo504dlg1qsf19nbeu878.png-37kB"><p>ç”±äºç¬¬ä¸€è¡Œè®°å½•ä¸­<code>c1</code>ã€<code>c2</code>ã€<code>c4</code>åˆ—ä¸­çš„å­—ç¬¦ä¸²éƒ½æ¯”è¾ƒçŸ­ï¼Œä¹Ÿå°±æ˜¯è¯´å†…å®¹å ç”¨çš„å­—èŠ‚æ•°æ¯”è¾ƒå°ï¼Œç”¨1ä¸ªå­—èŠ‚å°±å¯ä»¥è¡¨ç¤ºï¼Œä½†æ˜¯å¦‚æœå˜é•¿åˆ—çš„å†…å®¹å ç”¨çš„å­—èŠ‚æ•°æ¯”è¾ƒå¤šï¼Œå¯èƒ½å°±éœ€è¦ç”¨2ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚å…·ä½“ç”¨1ä¸ªè¿˜æ˜¯2ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºçœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ï¼Œ<code>InnoDB</code>æœ‰å®ƒçš„ä¸€å¥—è§„åˆ™ï¼Œæˆ‘ä»¬é¦–å…ˆå£°æ˜ä¸€ä¸‹<code>W</code>ã€<code>M</code>å’Œ<code>L</code>çš„æ„æ€ï¼š</p><ol><li>å‡è®¾æŸä¸ªå­—ç¬¦é›†ä¸­è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æœ€å¤šéœ€è¦ä½¿ç”¨çš„å­—èŠ‚æ•°ä¸º<code>W</code>ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨<code>SHOW CHARSET</code>è¯­å¥çš„ç»“æœä¸­çš„<code>Maxlen</code>åˆ—ï¼Œæ¯”æ–¹è¯´<code>utf8</code>å­—ç¬¦é›†ä¸­çš„<code>W</code>å°±æ˜¯<code>3</code>ï¼Œ<code>gbk</code>å­—ç¬¦é›†ä¸­çš„<code>W</code>å°±æ˜¯<code>2</code>ï¼Œ<code>ascii</code>å­—ç¬¦é›†ä¸­çš„<code>W</code>å°±æ˜¯<code>1</code>ã€‚</li><li>å¯¹äºå˜é•¿ç±»å‹<code>VARCHAR(M)</code>æ¥è¯´ï¼Œè¿™ç§ç±»å‹è¡¨ç¤ºèƒ½å­˜å‚¨æœ€å¤š<code>M</code>ä¸ªå­—ç¬¦ï¼ˆæ³¨æ„æ˜¯å­—ç¬¦ä¸æ˜¯å­—èŠ‚ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªç±»å‹èƒ½è¡¨ç¤ºçš„å­—ç¬¦ä¸²æœ€å¤šå ç”¨çš„å­—èŠ‚æ•°å°±æ˜¯<code>MÃ—W</code>ã€‚</li><li>å‡è®¾å®ƒå®é™…å­˜å‚¨çš„å­—ç¬¦ä¸²å ç”¨çš„å­—èŠ‚æ•°æ˜¯<code>L</code>ã€‚</li></ol><p>æ‰€ä»¥ç¡®å®šä½¿ç”¨1ä¸ªå­—èŠ‚è¿˜æ˜¯2ä¸ªå­—èŠ‚è¡¨ç¤ºçœŸæ­£å­—ç¬¦ä¸²å ç”¨çš„å­—èŠ‚æ•°çš„è§„åˆ™å°±æ˜¯è¿™æ ·ï¼š</p><ul><li><p>å¦‚æœ<code>MÃ—W &lt;= 255</code>ï¼Œé‚£ä¹ˆä½¿ç”¨1ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºçœŸæ­£å­—ç¬¦ä¸²å ç”¨çš„å­—èŠ‚æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs !">ä¹Ÿå°±æ˜¯è¯´InnoDBåœ¨è¯»è®°å½•çš„å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨æ—¶å…ˆæŸ¥çœ‹è¡¨ç»“æ„ï¼Œå¦‚æœæŸä¸ªå˜é•¿å­—æ®µå…è®¸å­˜å‚¨çš„æœ€å¤§å­—èŠ‚æ•°ä¸å¤§äº255æ—¶ï¼Œå¯ä»¥è®¤ä¸ºåªä½¿ç”¨1ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºçœŸæ­£å­—ç¬¦ä¸²å ç”¨çš„å­—èŠ‚æ•°ã€‚<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœ<code>MÃ—W &gt; 255</code>ï¼Œåˆ™åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœ<code>L &lt;= 127</code>ï¼Œåˆ™ç”¨1ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºçœŸæ­£å­—ç¬¦ä¸²å ç”¨çš„å­—èŠ‚æ•°ã€‚</li><li>å¦‚æœ<code>L &gt; 127</code>ï¼Œåˆ™ç”¨2ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºçœŸæ­£å­—ç¬¦ä¸²å ç”¨çš„å­—èŠ‚æ•°ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">InnoDBåœ¨è¯»è®°å½•çš„å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨æ—¶å…ˆæŸ¥çœ‹è¡¨ç»“æ„ï¼Œå¦‚æœæŸä¸ªå˜é•¿å­—æ®µå…è®¸å­˜å‚¨çš„æœ€å¤§å­—èŠ‚æ•°å¤§äº255æ—¶ï¼Œè¯¥æ€ä¹ˆåŒºåˆ†å®ƒæ­£åœ¨è¯»çš„æŸä¸ªå­—èŠ‚æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­—æ®µé•¿åº¦è¿˜æ˜¯åŠä¸ªå­—æ®µé•¿åº¦å‘¢ï¼Ÿè®¾è®¡InnoDBçš„å¤§å”ä½¿ç”¨è¯¥å­—èŠ‚çš„ç¬¬ä¸€ä¸ªäºŒè¿›åˆ¶ä½ä½œä¸ºæ ‡å¿—ä½ï¼šå¦‚æœè¯¥å­—èŠ‚çš„ç¬¬ä¸€ä¸ªä½ä¸º0ï¼Œé‚£è¯¥å­—èŠ‚å°±æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­—æ®µé•¿åº¦ï¼ˆä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºä¸å¤§äº127çš„äºŒè¿›åˆ¶çš„ç¬¬ä¸€ä¸ªä½éƒ½ä¸º0ï¼‰ï¼Œå¦‚æœè¯¥å­—èŠ‚çš„ç¬¬ä¸€ä¸ªä½ä¸º1ï¼Œé‚£è¯¥å­—èŠ‚å°±æ˜¯åŠä¸ªå­—æ®µé•¿åº¦ã€‚<br><br>å¯¹äºä¸€äº›å ç”¨å­—èŠ‚æ•°éå¸¸å¤šçš„å­—æ®µï¼Œæ¯”æ–¹è¯´æŸä¸ªå­—æ®µé•¿åº¦å¤§äºäº†16KBï¼Œé‚£ä¹ˆå¦‚æœè¯¥è®°å½•åœ¨å•ä¸ªé¡µé¢ä¸­æ— æ³•å­˜å‚¨æ—¶ï¼ŒInnoDBä¼šæŠŠä¸€éƒ¨åˆ†æ•°æ®å­˜æ”¾åˆ°æ‰€è°“çš„æº¢å‡ºé¡µä¸­ï¼ˆæˆ‘ä»¬åè¾¹ä¼šå” å¨ï¼‰ï¼Œåœ¨å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨å¤„åªå­˜å‚¨ç•™åœ¨æœ¬é¡µé¢ä¸­çš„é•¿åº¦ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚ä¹Ÿå¯ä»¥å­˜æ”¾ä¸‹æ¥ã€‚<br></code></pre></td></tr></table></figure></li></ul><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯è¯´ï¼š<strong>å¦‚æœè¯¥å¯å˜å­—æ®µå…è®¸å­˜å‚¨çš„æœ€å¤§å­—èŠ‚æ•°ï¼ˆ<code>MÃ—W</code>ï¼‰è¶…è¿‡255å­—èŠ‚å¹¶ä¸”çœŸå®å­˜å‚¨çš„å­—èŠ‚æ•°ï¼ˆ<code>L</code>ï¼‰è¶…è¿‡127å­—èŠ‚ï¼Œåˆ™ä½¿ç”¨2ä¸ªå­—èŠ‚ï¼Œå¦åˆ™ä½¿ç”¨1ä¸ªå­—èŠ‚ã€‚</strong></p><p>å¦å¤–éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ä¸­åªå­˜å‚¨å€¼ä¸º <em><strong>éNULL</strong></em> çš„åˆ—å†…å®¹å ç”¨çš„é•¿åº¦ï¼Œå€¼ä¸º <em><strong>NULL</strong></em> çš„åˆ—çš„é•¿åº¦æ˜¯ä¸å‚¨å­˜çš„ ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºç¬¬äºŒæ¡è®°å½•æ¥è¯´ï¼Œå› ä¸º<code>c4</code>åˆ—çš„å€¼ä¸º<code>NULL</code>ï¼Œæ‰€ä»¥ç¬¬äºŒæ¡è®°å½•çš„<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>åªéœ€è¦å­˜å‚¨<code>c1</code>å’Œ<code>c2</code>åˆ—çš„é•¿åº¦å³å¯ã€‚å…¶ä¸­<code>c1</code>åˆ—å­˜å‚¨çš„å€¼ä¸º<code>'eeee'</code>ï¼Œå ç”¨çš„å­—èŠ‚æ•°ä¸º<code>4</code>ï¼Œ<code>c2</code>åˆ—å­˜å‚¨çš„å€¼ä¸º<code>'fff'</code>ï¼Œå ç”¨çš„å­—èŠ‚æ•°ä¸º<code>3</code>ã€‚æ•°å­—<code>4</code>å¯ä»¥ç”¨1ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œ<code>3</code>ä¹Ÿå¯ä»¥ç”¨1ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œæ‰€ä»¥æ•´ä¸ª<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>å…±éœ€2ä¸ªå­—èŠ‚ã€‚å¡«å……å®Œ<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>çš„ä¸¤æ¡è®°å½•çš„å¯¹æ¯”å›¾å¦‚ä¸‹ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e8fe4ee6b0~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9grq2b2jok1062t8tov21lqjbj.png-42.6kB"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>å¹¶ä¸æ˜¯æ‰€æœ‰è®°å½•éƒ½æœ‰è¿™ä¸ª å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éƒ¨åˆ†ï¼Œæ¯”æ–¹è¯´è¡¨ä¸­æ‰€æœ‰çš„åˆ—éƒ½ä¸æ˜¯å˜é•¿çš„æ•°æ®ç±»å‹çš„è¯ï¼Œè¿™ä¸€éƒ¨åˆ†å°±ä¸éœ€è¦æœ‰ã€‚<br></code></pre></td></tr></table></figure><h5 id="NULLå€¼åˆ—è¡¨">NULLå€¼åˆ—è¡¨</h5><p>æˆ‘ä»¬çŸ¥é“è¡¨ä¸­çš„æŸäº›åˆ—å¯èƒ½å­˜å‚¨<code>NULL</code>å€¼ï¼Œå¦‚æœæŠŠè¿™äº›<code>NULL</code>å€¼éƒ½æ”¾åˆ°<code>è®°å½•çš„çœŸå®æ•°æ®</code>ä¸­å­˜å‚¨ä¼šå¾ˆå åœ°æ–¹ï¼Œæ‰€ä»¥<code>Compact</code>è¡Œæ ¼å¼æŠŠè¿™äº›å€¼ä¸º<code>NULL</code>çš„åˆ—ç»Ÿä¸€ç®¡ç†èµ·æ¥ï¼Œå­˜å‚¨åˆ°<code>NULL</code>å€¼åˆ—è¡¨ä¸­ï¼Œå®ƒçš„å¤„ç†è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li><p>é¦–å…ˆç»Ÿè®¡è¡¨ä¸­å…è®¸å­˜å‚¨<code>NULL</code>çš„åˆ—æœ‰å“ªäº›ã€‚</p><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œä¸»é”®åˆ—ã€è¢«<code>NOT NULL</code>ä¿®é¥°çš„åˆ—éƒ½æ˜¯ä¸å¯ä»¥å­˜å‚¨<code>NULL</code>å€¼çš„ï¼Œæ‰€ä»¥åœ¨ç»Ÿè®¡çš„æ—¶å€™ä¸ä¼šæŠŠè¿™äº›åˆ—ç®—è¿›å»ã€‚æ¯”æ–¹è¯´è¡¨<code>record_format_demo</code>çš„3ä¸ªåˆ—<code>c1</code>ã€<code>c3</code>ã€<code>c4</code>éƒ½æ˜¯å…è®¸å­˜å‚¨<code>NULL</code>å€¼çš„ï¼Œè€Œ<code>c2</code>åˆ—æ˜¯è¢«<code>NOT NULL</code>ä¿®é¥°ï¼Œä¸å…è®¸å­˜å‚¨<code>NULL</code>å€¼ã€‚</p></li><li><p>å¦‚æœè¡¨ä¸­æ²¡æœ‰å…è®¸å­˜å‚¨ <em><strong>NULL</strong></em> çš„åˆ—ï¼Œåˆ™ <em>NULLå€¼åˆ—è¡¨</em> ä¹Ÿä¸å­˜åœ¨äº†ï¼Œå¦åˆ™å°†æ¯ä¸ªå…è®¸å­˜å‚¨<code>NULL</code>çš„åˆ—å¯¹åº”ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼ŒäºŒè¿›åˆ¶ä½æŒ‰ç…§åˆ—çš„é¡ºåºé€†åºæ’åˆ—ï¼ŒäºŒè¿›åˆ¶ä½è¡¨ç¤ºçš„æ„ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>äºŒè¿›åˆ¶ä½çš„å€¼ä¸º<code>1</code>æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸º<code>NULL</code>ã€‚</li><li>äºŒè¿›åˆ¶ä½çš„å€¼ä¸º<code>0</code>æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ä¸º<code>NULL</code>ã€‚</li></ul><p>å› ä¸ºè¡¨<code>record_format_demo</code>æœ‰3ä¸ªå€¼å…è®¸ä¸º<code>NULL</code>çš„åˆ—ï¼Œæ‰€ä»¥è¿™3ä¸ªåˆ—å’ŒäºŒè¿›åˆ¶ä½çš„å¯¹åº”å…³ç³»å°±æ˜¯è¿™æ ·ï¼š</p></li></ol><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e9018133f7~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9g88mtt1tj51ua1qh51vjo12pg5k.png-10.4kB"><ol><li><p>å†ä¸€æ¬¡å¼ºè°ƒï¼ŒäºŒè¿›åˆ¶ä½æŒ‰ç…§åˆ—çš„é¡ºåºé€†åºæ’åˆ—ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªåˆ—<code>c1</code>å’Œæœ€åä¸€ä¸ªäºŒè¿›åˆ¶ä½å¯¹åº”ã€‚</p></li><li><p><code>MySQL</code>è§„å®š<code>NULLå€¼åˆ—è¡¨</code>å¿…é¡»ç”¨æ•´æ•°ä¸ªå­—èŠ‚çš„ä½è¡¨ç¤ºï¼Œå¦‚æœä½¿ç”¨çš„äºŒè¿›åˆ¶ä½ä¸ªæ•°ä¸æ˜¯æ•´æ•°ä¸ªå­—èŠ‚ï¼Œåˆ™åœ¨å­—èŠ‚çš„é«˜ä½è¡¥<code>0</code>ã€‚</p><p>è¡¨<code>record_format_demo</code>åªæœ‰3ä¸ªå€¼å…è®¸ä¸º<code>NULL</code>çš„åˆ—ï¼Œå¯¹åº”3ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä¸è¶³ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥åœ¨å­—èŠ‚çš„é«˜ä½è¡¥<code>0</code>ï¼Œæ•ˆæœå°±æ˜¯è¿™æ ·ï¼š</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/12/169710e901669f45~tplv-t2oaga2asx-watermark.awebp" alt="image_1c9g8g27b1bdlu7t187emsc46s61.png-19.4kB"></p><p>ä»¥æ­¤ç±»æ¨ï¼Œå¦‚æœä¸€ä¸ªè¡¨ä¸­æœ‰9ä¸ªå…è®¸ä¸º<code>NULL</code>ï¼Œé‚£è¿™ä¸ªè®°å½•çš„<code>NULL</code>å€¼åˆ—è¡¨éƒ¨åˆ†å°±éœ€è¦2ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºäº†ã€‚</p></li></ol><p>çŸ¥é“äº†è§„åˆ™ä¹‹åï¼Œæˆ‘ä»¬å†è¿”å›å¤´çœ‹è¡¨<code>record_format_demo</code>ä¸­çš„ä¸¤æ¡è®°å½•ä¸­çš„<code>NULLå€¼åˆ—è¡¨</code>åº”è¯¥æ€ä¹ˆå‚¨å­˜ã€‚å› ä¸ºåªæœ‰<code>c1</code>ã€<code>c3</code>ã€<code>c4</code>è¿™3ä¸ªåˆ—å…è®¸å­˜å‚¨<code>NULL</code>å€¼ï¼Œæ‰€ä»¥æ‰€æœ‰è®°å½•çš„<code>NULLå€¼åˆ—è¡¨</code>åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ã€‚</p><ul><li><p>å¯¹äºç¬¬ä¸€æ¡è®°å½•æ¥è¯´ï¼Œ<code>c1</code>ã€<code>c3</code>ã€<code>c4</code>è¿™3ä¸ªåˆ—çš„å€¼éƒ½ä¸ä¸º<code>NULL</code>ï¼Œæ‰€ä»¥å®ƒä»¬å¯¹åº”çš„äºŒè¿›åˆ¶ä½éƒ½æ˜¯<code>0</code>ï¼Œç”»ä¸ªå›¾å°±æ˜¯è¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e901befeac~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9g8m05b19ge1c8v2bf163djre6e.png-21.5kB"> æ‰€ä»¥ç¬¬ä¸€æ¡è®°å½•çš„`NULLå€¼åˆ—è¡¨`ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ï¼š`0x00`ã€‚</li><li><p>å¯¹äºç¬¬äºŒæ¡è®°å½•æ¥è¯´ï¼Œ<code>c1</code>ã€<code>c3</code>ã€<code>c4</code>è¿™3ä¸ªåˆ—ä¸­<code>c3</code>å’Œ<code>c4</code>çš„å€¼éƒ½ä¸º<code>NULL</code>ï¼Œæ‰€ä»¥è¿™3ä¸ªåˆ—å¯¹åº”çš„äºŒè¿›åˆ¶ä½çš„æƒ…å†µå°±æ˜¯ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e944a8af0c~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9g8ps5c1snv1bhj3m48151sfl6r.png-20.6kB"><p>æ‰€ä»¥ç¬¬äºŒæ¡è®°å½•çš„<code>NULLå€¼åˆ—è¡¨</code>ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ï¼š<code>0x06</code>ã€‚</p></li></ul><p>æ‰€ä»¥è¿™ä¸¤æ¡è®°å½•åœ¨å¡«å……äº†<code>NULLå€¼åˆ—è¡¨</code>åçš„ç¤ºæ„å›¾å°±æ˜¯è¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e95903144f~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9grs9m4co8134u1t2rjhm1q6rc0.png-39kB"><h5 id="è®°å½•å¤´ä¿¡æ¯">è®°å½•å¤´ä¿¡æ¯</h5><p>é™¤äº†<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>ã€<code>NULLå€¼åˆ—è¡¨</code>ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç”¨äºæè¿°è®°å½•çš„<code>è®°å½•å¤´ä¿¡æ¯</code>ï¼Œå®ƒæ˜¯ç”±å›ºå®šçš„<code>5</code>ä¸ªå­—èŠ‚ç»„æˆã€‚<code>5</code>ä¸ªå­—èŠ‚ä¹Ÿå°±æ˜¯<code>40</code>ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä¸åŒçš„ä½ä»£è¡¨ä¸åŒçš„æ„æ€ï¼Œå¦‚å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e97718ef01~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9geiglj1ah31meo80ci8n1eli8f.png-29.5kB"><p>è¿™äº›äºŒè¿›åˆ¶ä½ä»£è¡¨çš„è¯¦ç»†ä¿¡æ¯å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>åç§°</th><th>å¤§å°ï¼ˆå•ä½ï¼šbitï¼‰</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>é¢„ç•™ä½1</code></td><td><code>1</code></td><td>æ²¡æœ‰ä½¿ç”¨</td></tr><tr><td><code>é¢„ç•™ä½2</code></td><td><code>1</code></td><td>æ²¡æœ‰ä½¿ç”¨</td></tr><tr><td><code>delete_mask</code></td><td><code>1</code></td><td>æ ‡è®°è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤</td></tr><tr><td><code>min_rec_mask</code></td><td><code>1</code></td><td>B+æ ‘çš„æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°</td></tr><tr><td><code>n_owned</code></td><td><code>4</code></td><td>è¡¨ç¤ºå½“å‰è®°å½•æ‹¥æœ‰çš„è®°å½•æ•°</td></tr><tr><td><code>heap_no</code></td><td><code>13</code></td><td>è¡¨ç¤ºå½“å‰è®°å½•åœ¨è®°å½•å †çš„ä½ç½®ä¿¡æ¯</td></tr><tr><td><code>record_type</code></td><td><code>3</code></td><td>è¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œ<code>0</code>è¡¨ç¤ºæ™®é€šè®°å½•ï¼Œ<code>1</code>è¡¨ç¤ºB+æ ‘éå¶å­èŠ‚ç‚¹è®°å½•ï¼Œ<code>2</code>è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ<code>3</code>è¡¨ç¤ºæœ€å¤§è®°å½•</td></tr><tr><td><code>next_record</code></td><td><code>16</code></td><td>è¡¨ç¤ºä¸‹ä¸€æ¡è®°å½•çš„ç›¸å¯¹ä½ç½®</td></tr></tbody></table><p>å¤§å®¶ä¸è¦è¢«è¿™ä¹ˆå¤šçš„å±æ€§å’Œé™Œç”Ÿçš„æ¦‚å¿µç»™å“ç€ï¼Œæˆ‘è¿™é‡Œåªæ˜¯ä¸ºäº†å†…å®¹çš„å®Œæ•´æ€§æŠŠè¿™äº›ä½ä»£è¡¨çš„æ„æ€éƒ½å†™äº†å‡ºæ¥ï¼Œç°åœ¨æ²¡å¿…è¦æŠŠå®ƒä»¬çš„æ„æ€éƒ½è®°ä½ï¼Œè®°ä½ä¹Ÿæ²¡å•¥ç”¨ï¼Œç°åœ¨åªéœ€è¦çœ‹ä¸€éæ··ä¸ªè„¸ç†Ÿï¼Œç­‰ä¹‹åç”¨åˆ°è¿™äº›å±æ€§çš„æ—¶å€™æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹ã€‚</p><p>å› ä¸ºæˆ‘ä»¬å¹¶ä¸æ¸…æ¥šè¿™äº›å±æ€§è¯¦ç»†çš„ç”¨æ³•ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸åˆ†æå„ä¸ªå±æ€§å€¼æ˜¯æ€ä¹ˆäº§ç”Ÿçš„äº†ï¼Œä¹‹åæˆ‘ä»¬é‡åˆ°ä¼šè¯¦ç»†çœ‹çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨ç›´æ¥çœ‹ä¸€ä¸‹<code>record_format_demo</code>ä¸­çš„ä¸¤æ¡è®°å½•çš„<code>å¤´ä¿¡æ¯</code>åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/17075b82cb070959~tplv-t2oaga2asx-watermark.awebp" class="" title="img"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>å†ä¸€æ¬¡å¼ºè°ƒï¼Œå¤§å®¶å¦‚æœçœ‹ä¸æ‡‚è®°å½•å¤´ä¿¡æ¯é‡Œå„ä¸ªä½ä»£è¡¨çš„æ¦‚å¿µåƒä¸‡åˆ«çº ç»“ï¼Œæˆ‘ä»¬åè¾¹ä¼šè¯´çš„ï½<br></code></pre></td></tr></table></figure><h4 id="è®°å½•çš„çœŸå®æ•°æ®">è®°å½•çš„çœŸå®æ•°æ®</h4><p>å¯¹äº<code>record_format_demo</code>è¡¨æ¥è¯´ï¼Œ<code>è®°å½•çš„çœŸå®æ•°æ®</code>é™¤äº†<code>c1</code>ã€<code>c2</code>ã€<code>c3</code>ã€<code>c4</code>è¿™å‡ ä¸ªæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„åˆ—çš„æ•°æ®ä»¥å¤–ï¼Œ<code>MySQL</code>ä¼šä¸ºæ¯ä¸ªè®°å½•é»˜è®¤çš„æ·»åŠ ä¸€äº›åˆ—ï¼ˆä¹Ÿç§°ä¸º<code>éšè—åˆ—</code>ï¼‰ï¼Œå…·ä½“çš„åˆ—å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åˆ—å</th><th>æ˜¯å¦å¿…é¡»</th><th>å ç”¨ç©ºé—´</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>row_id</code></td><td>å¦</td><td><code>6</code>å­—èŠ‚</td><td>è¡ŒIDï¼Œå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•</td></tr><tr><td><code>transaction_id</code></td><td>æ˜¯</td><td><code>6</code>å­—èŠ‚</td><td>äº‹åŠ¡ID</td></tr><tr><td><code>roll_pointer</code></td><td>æ˜¯</td><td><code>7</code>å­—èŠ‚</td><td>å›æ»šæŒ‡é’ˆ</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>å®é™…ä¸Šè¿™å‡ ä¸ªåˆ—çš„çœŸæ­£åç§°å…¶å®æ˜¯ï¼šDB_ROW_IDã€DB_TRX_IDã€DB_ROLL_PTRï¼Œæˆ‘ä»¬ä¸ºäº†ç¾è§‚æ‰å†™æˆäº†row_idã€transaction_idå’Œroll_pointerã€‚<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æä¸€ä¸‹<code>InnoDB</code>è¡¨å¯¹ä¸»é”®çš„ç”Ÿæˆç­–ç•¥ï¼šä¼˜**å…ˆä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰ä¸»é”®ä½œä¸ºä¸»é”®ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œåˆ™é€‰å–ä¸€ä¸ª<code>Unique</code>é”®ä½œä¸ºä¸»é”®ï¼Œå¦‚æœè¡¨ä¸­è¿<code>Unique</code>é”®éƒ½æ²¡æœ‰å®šä¹‰çš„è¯ï¼Œåˆ™<code>InnoDB</code>ä¼šä¸ºè¡¨é»˜è®¤æ·»åŠ ä¸€ä¸ªåä¸º<code>row_id</code>çš„éšè—åˆ—ä½œä¸ºä¸»é”®ã€‚**æ‰€ä»¥æˆ‘ä»¬ä»ä¸Šè¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šä¸ºæ¯æ¡è®°å½•éƒ½æ·»åŠ  <em><strong>transaction_id</strong></em> å’Œ <em><strong>roll_pointer</strong></em> è¿™ä¸¤ä¸ªåˆ—ï¼Œä½†æ˜¯ <em><strong>row_id</strong></em> æ˜¯å¯é€‰çš„ï¼ˆåœ¨æ²¡æœ‰è‡ªå®šä¹‰ä¸»é”®ä»¥åŠUniqueé”®çš„æƒ…å†µä¸‹æ‰ä¼šæ·»åŠ è¯¥åˆ—ï¼‰ã€‚è¿™äº›éšè—åˆ—çš„å€¼ä¸ç”¨æˆ‘ä»¬æ“å¿ƒï¼Œ<code>InnoDB</code>å­˜å‚¨å¼•æ“ä¼šè‡ªå·±å¸®æˆ‘ä»¬ç”Ÿæˆçš„ã€‚</p><p>å› ä¸ºè¡¨<code>record_format_demo</code>å¹¶æ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œæ‰€ä»¥<code>MySQL</code>æœåŠ¡å™¨ä¼šä¸ºæ¯æ¡è®°å½•å¢åŠ ä¸Šè¿°çš„3ä¸ªåˆ—ã€‚ç°åœ¨çœ‹ä¸€ä¸‹åŠ ä¸Š<code>è®°å½•çš„çœŸå®æ•°æ®</code>çš„ä¸¤ä¸ªè®°å½•é•¿ä»€ä¹ˆæ ·å§ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e973b70372~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9h256f9nke14311adhtu61ie2dn.png-92kB"><p>çœ‹è¿™ä¸ªå›¾çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æ³¨æ„å‡ ç‚¹ï¼š</p><ol><li>è¡¨<code>record_format_demo</code>ä½¿ç”¨çš„æ˜¯<code>ascii</code>å­—ç¬¦é›†ï¼Œæ‰€ä»¥<code>0x61616161</code>å°±è¡¨ç¤ºå­—ç¬¦ä¸²<code>'aaaa'</code>ï¼Œ<code>0x626262</code>å°±è¡¨ç¤ºå­—ç¬¦ä¸²<code>'bbb'</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li><li>æ³¨æ„ç¬¬1æ¡è®°å½•ä¸­<code>c3</code>åˆ—çš„å€¼ï¼Œå®ƒæ˜¯<code>CHAR(10)</code>ç±»å‹çš„ï¼Œå®ƒå®é™…å­˜å‚¨çš„å­—ç¬¦ä¸²æ˜¯ï¼š<code>'cc'</code>ï¼Œè€Œ<code>ascii</code>å­—ç¬¦é›†ä¸­çš„å­—èŠ‚è¡¨ç¤ºæ˜¯<code>'0x6363'</code>ï¼Œè™½ç„¶è¡¨ç¤ºè¿™ä¸ªå­—ç¬¦ä¸²åªå ç”¨äº†2ä¸ªå­—èŠ‚ï¼Œä½†æ•´ä¸ª<code>c3</code>åˆ—ä»ç„¶å ç”¨äº†10ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œé™¤çœŸå®æ•°æ®ä»¥å¤–çš„8ä¸ªå­—èŠ‚çš„ç»Ÿç»Ÿéƒ½ç”¨ç©ºæ ¼å­—ç¬¦å¡«å……ï¼Œç©ºæ ¼å­—ç¬¦åœ¨<code>ascii</code>å­—ç¬¦é›†çš„è¡¨ç¤ºå°±æ˜¯<code>0x20</code>ã€‚</li><li>æ³¨æ„ç¬¬2æ¡è®°å½•ä¸­<code>c3</code>å’Œ<code>c4</code>åˆ—çš„å€¼éƒ½ä¸º<code>NULL</code>ï¼Œå®ƒä»¬è¢«å­˜å‚¨åœ¨äº†å‰è¾¹çš„<code>NULLå€¼åˆ—è¡¨</code>å¤„ï¼Œåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å°±ä¸å†å†—ä½™å­˜å‚¨ï¼Œä»è€ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</li></ol><h4 id="CHAR-M-åˆ—çš„å­˜å‚¨æ ¼å¼">CHAR(M)åˆ—çš„å­˜å‚¨æ ¼å¼</h4><p><code>record_format_demo</code>è¡¨çš„<code>c1</code>ã€<code>c2</code>ã€<code>c4</code>åˆ—çš„ç±»å‹æ˜¯<code>VARCHAR(10)</code>ï¼Œè€Œ<code>c3</code>åˆ—çš„ç±»å‹æ˜¯<code>CHAR(10)</code>ï¼Œæˆ‘ä»¬è¯´åœ¨<code>Compact</code>è¡Œæ ¼å¼ä¸‹åªä¼šæŠŠå˜é•¿ç±»å‹çš„åˆ—çš„é•¿åº¦é€†åºå­˜åˆ°<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>ä¸­ï¼Œå°±åƒè¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e985c8d9a7~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9jdkga71kegkjs14o111ov1ce3kn.png-12.5kB"><p>ä½†æ˜¯è¿™åªæ˜¯å› ä¸ºæˆ‘ä»¬çš„<code>record_format_demo</code>è¡¨é‡‡ç”¨çš„æ˜¯<code>ascii</code>å­—ç¬¦é›†ï¼Œè¿™ä¸ªå­—ç¬¦é›†æ˜¯ä¸€ä¸ªå®šé•¿å­—ç¬¦é›†ï¼Œä¹Ÿå°±æ˜¯è¯´è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦é‡‡ç”¨å›ºå®šçš„ä¸€ä¸ªå­—èŠ‚ï¼Œå¦‚æœé‡‡ç”¨å˜é•¿çš„å­—ç¬¦é›†ï¼ˆä¹Ÿå°±æ˜¯è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦éœ€è¦çš„å­—èŠ‚æ•°ä¸ç¡®å®šï¼Œæ¯”å¦‚<code>gbk</code>è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦è¦1ï½2ä¸ªå­—èŠ‚ã€<code>utf8</code>è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦è¦1~3ä¸ªå­—èŠ‚ç­‰ï¼‰çš„è¯ï¼Œ<code>c3</code>åˆ—çš„é•¿åº¦ä¹Ÿä¼šè¢«å­˜å‚¨åˆ°<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹<code>record_format_demo</code>è¡¨çš„å­—ç¬¦é›†ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; ALTER TABLE record_format_demo MODIFY COLUMN c<span class="hljs-number">3</span> CHAR(<span class="hljs-number">10</span>) CHARACTER SET utf<span class="hljs-number">8</span>;<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">2</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">02</span> sec)<br><span class="hljs-attribute">Records</span>: <span class="hljs-number">2</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹è¯¥åˆ—å­—ç¬¦é›†åè®°å½•çš„<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e973ff4fde~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9jeb6defgf1o981lgfciokjl4.png-43.1kB"><p>è¿™å°±æ„å‘³ç€ï¼š<strong>å¯¹äº <em>CHAR(M)</em> ç±»å‹çš„åˆ—æ¥è¯´ï¼Œå½“åˆ—é‡‡ç”¨çš„æ˜¯å®šé•¿å­—ç¬¦é›†æ—¶ï¼Œè¯¥åˆ—å ç”¨çš„å­—èŠ‚æ•°ä¸ä¼šè¢«åŠ åˆ°å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼Œè€Œå¦‚æœé‡‡ç”¨å˜é•¿å­—ç¬¦é›†æ—¶ï¼Œè¯¥åˆ—å ç”¨çš„å­—èŠ‚æ•°ä¹Ÿä¼šè¢«åŠ åˆ°å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€‚</strong></p><p>å¦å¤–æœ‰ä¸€ç‚¹è¿˜éœ€è¦æ³¨æ„ï¼Œå˜é•¿å­—ç¬¦é›†çš„<code>CHAR(M)</code>ç±»å‹çš„åˆ—è¦æ±‚è‡³å°‘å ç”¨<code>M</code>ä¸ªå­—èŠ‚ï¼Œè€Œ<code>VARCHAR(M)</code>å´æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚æ¯”æ–¹è¯´å¯¹äºä½¿ç”¨<code>utf8</code>å­—ç¬¦é›†çš„<code>CHAR(10)</code>çš„åˆ—æ¥è¯´ï¼Œè¯¥åˆ—å­˜å‚¨çš„æ•°æ®å­—èŠ‚é•¿åº¦çš„èŒƒå›´æ˜¯10ï½30ä¸ªå­—èŠ‚ã€‚å³ä½¿æˆ‘ä»¬å‘è¯¥åˆ—ä¸­å­˜å‚¨ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ä¹Ÿä¼šå ç”¨<code>10</code>ä¸ªå­—èŠ‚ï¼Œè¿™æ˜¯æ€•å°†æ¥æ›´æ–°è¯¥åˆ—çš„å€¼çš„å­—èŠ‚é•¿åº¦å¤§äºåŸæœ‰å€¼çš„å­—èŠ‚é•¿åº¦è€Œå°äº10ä¸ªå­—èŠ‚æ—¶ï¼Œå¯ä»¥åœ¨è¯¥è®°å½•å¤„ç›´æ¥æ›´æ–°ï¼Œè€Œä¸æ˜¯åœ¨å­˜å‚¨ç©ºé—´ä¸­é‡æ–°åˆ†é…ä¸€ä¸ªæ–°çš„è®°å½•ç©ºé—´ï¼Œå¯¼è‡´åŸæœ‰çš„è®°å½•ç©ºé—´æˆä¸ºæ‰€è°“çš„ç¢ç‰‡ã€‚ï¼ˆè¿™é‡Œä½ æ„Ÿå—åˆ°è®¾è®¡<code>Compact</code>è¡Œæ ¼å¼çš„å¤§å”æ—¢æƒ³èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œåˆä¸æƒ³æ›´æ–°<code>CHAR(M)</code>ç±»å‹çš„åˆ—äº§ç”Ÿç¢ç‰‡æ—¶çš„çº ç»“å¿ƒæƒ…äº†å§ã€‚ï¼‰</p><h3 id="Redundantè¡Œæ ¼å¼">Redundantè¡Œæ ¼å¼</h3><p>å…¶å®çŸ¥é“äº†<code>Compact</code>è¡Œæ ¼å¼ä¹‹åï¼Œå…¶ä»–çš„è¡Œæ ¼å¼å°±æ˜¯ä¾è‘«èŠ¦ç”»ç“¢äº†ã€‚æˆ‘ä»¬ç°åœ¨è¦ä»‹ç»çš„<code>Redundant</code>è¡Œæ ¼å¼æ˜¯<code>MySQL5.0</code>ä¹‹å‰ç”¨çš„ä¸€ç§è¡Œæ ¼å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå·²ç»éå¸¸è€äº†ï¼Œä½†æ˜¯æœ¬ç€çŸ¥è¯†å®Œæ•´æ€§çš„è§’åº¦è¿˜æ˜¯è¦æä¸€ä¸‹ï¼Œå¤§å®¶ä¹å‘µä¹å‘µçš„çœ‹å°±å¥½ã€‚</p><p>ç”»ä¸ªå›¾å±•ç¤ºä¸€ä¸‹<code>Redundant</code>è¡Œæ ¼å¼çš„å…¨è²Œï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e99a69ba3d~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9h896lcuqi16081qub1v8c12jkft.png-36.2kB"><p>ç°åœ¨æˆ‘ä»¬æŠŠè¡¨<code>record_format_demo</code>çš„è¡Œæ ¼å¼ä¿®æ”¹ä¸º<code>Redundant</code>ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; ALTER TABLE record_format_demo ROW_FORMAT=Redundant;<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">05</span> sec)<br><span class="hljs-attribute">Records</span>: <span class="hljs-number">0</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£å’ŒèŠ‚çœç¯‡å¹…ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠè¡¨<code>record_format_demo</code>åœ¨<code>Redundant</code>è¡Œæ ¼å¼ä¸‹çš„ä¸¤æ¡è®°å½•çš„çœŸå®å­˜å‚¨æ•°æ®æä¾›å‡ºæ¥ï¼Œä¹‹åæˆ‘ä»¬ç€é‡åˆ†æä¸¤ç§è¡Œæ ¼å¼çš„ä¸åŒå³å¯ã€‚</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e9a5b7c847~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9h8tnav166c187m1nhap61153qgn.png-91.6kB"><p>ä¸‹è¾¹æˆ‘ä»¬ä»å„ä¸ªæ–¹é¢çœ‹ä¸€ä¸‹<code>Redundant</code>è¡Œæ ¼å¼æœ‰ä»€ä¹ˆä¸åŒçš„åœ°æ–¹ï¼š</p><ul><li><p>å­—æ®µé•¿åº¦åç§»åˆ—è¡¨</p><p>æ³¨æ„<code>Compact</code>è¡Œæ ¼å¼çš„å¼€å¤´æ˜¯<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>ï¼Œè€Œ<code>Redundant</code>è¡Œæ ¼å¼çš„å¼€å¤´æ˜¯<code>å­—æ®µé•¿åº¦åç§»åˆ—è¡¨</code>ï¼Œä¸<code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>æœ‰ä¸¤å¤„ä¸åŒï¼š</p><ul><li><p>æ²¡æœ‰äº†å˜é•¿ä¸¤ä¸ªå­—ï¼Œæ„å‘³ç€<code>Redundant</code>è¡Œæ ¼å¼ä¼šæŠŠè¯¥æ¡è®°å½•ä¸­æ‰€æœ‰åˆ—ï¼ˆåŒ…æ‹¬<code>éšè—åˆ—</code>ï¼‰çš„é•¿åº¦ä¿¡æ¯éƒ½æŒ‰ç…§é€†åºå­˜å‚¨åˆ°<code>å­—æ®µé•¿åº¦åç§»åˆ—è¡¨</code>ã€‚</p></li><li><p>å¤šäº†ä¸ªåç§»ä¸¤ä¸ªå­—ï¼Œè¿™æ„å‘³ç€è®¡ç®—åˆ—å€¼é•¿åº¦çš„æ–¹å¼ä¸åƒ<code>Compact</code>è¡Œæ ¼å¼é‚£ä¹ˆç›´è§‚ï¼Œå®ƒæ˜¯é‡‡ç”¨ä¸¤ä¸ªç›¸é‚»æ•°å€¼çš„å·®å€¼æ¥è®¡ç®—å„ä¸ªåˆ—å€¼çš„é•¿åº¦ã€‚</p><p>æ¯”å¦‚ç¬¬ä¸€æ¡è®°å½•çš„<code>å­—æ®µé•¿åº¦åç§»åˆ—è¡¨</code>å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">25 </span><span class="hljs-number">24</span> <span class="hljs-number">1</span>A <span class="hljs-number">17</span> <span class="hljs-number">13</span> <span class="hljs-number">0</span>C <span class="hljs-number">06</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºå®ƒæ˜¯é€†åºæ’æ”¾çš„ï¼Œæ‰€ä»¥æŒ‰ç…§åˆ—çš„é¡ºåºæ’åˆ—å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">06 </span><span class="hljs-number">0</span>C <span class="hljs-number">13</span> <span class="hljs-number">17</span> <span class="hljs-number">1</span>A <span class="hljs-number">24</span> <span class="hljs-number">25</span><br></code></pre></td></tr></table></figure><p>æŒ‰ç…§ä¸¤ä¸ªç›¸é‚»æ•°å€¼çš„å·®å€¼æ¥è®¡ç®—å„ä¸ªåˆ—å€¼çš„é•¿åº¦çš„æ„æ€å°±æ˜¯ï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">ç¬¬ä¸€åˆ—(`row_id`)çš„é•¿åº¦å°±æ˜¯ <span class="hljs-number">0</span>x06ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯<span class="hljs-number">6</span>ä¸ªå­—èŠ‚ã€‚<br><br>ç¬¬äºŒåˆ—(`transaction_id`)çš„é•¿åº¦å°±æ˜¯ (<span class="hljs-number">0</span>x0C - <span class="hljs-number">0</span>x06)ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯<span class="hljs-number">6</span>ä¸ªå­—èŠ‚ã€‚<br><br>ç¬¬ä¸‰åˆ—(`roll_pointer`)çš„é•¿åº¦å°±æ˜¯ (<span class="hljs-number">0</span>x13 - <span class="hljs-number">0</span>x0C)ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯<span class="hljs-number">7</span>ä¸ªå­—èŠ‚ã€‚<br><br>ç¬¬å››åˆ—(`c1`)çš„é•¿åº¦å°±æ˜¯ (<span class="hljs-number">0</span>x17 - <span class="hljs-number">0</span>x13)ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯<span class="hljs-number">4</span>ä¸ªå­—èŠ‚ã€‚<br><br>ç¬¬äº”åˆ—(`c2`)çš„é•¿åº¦å°±æ˜¯ (<span class="hljs-number">0</span>x1A - <span class="hljs-number">0</span>x17)ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯<span class="hljs-number">3</span>ä¸ªå­—èŠ‚ã€‚<br><br>ç¬¬å…­åˆ—(`c3`)çš„é•¿åº¦å°±æ˜¯ (<span class="hljs-number">0</span>x24 - <span class="hljs-number">0</span>x1A)ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯<span class="hljs-number">10</span>ä¸ªå­—èŠ‚ã€‚<br><br>ç¬¬ä¸ƒåˆ—(`c4`)çš„é•¿åº¦å°±æ˜¯ (<span class="hljs-number">0</span>x25 - <span class="hljs-number">0</span>x24)ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯<span class="hljs-number">1</span>ä¸ªå­—èŠ‚ã€‚<br></code></pre></td></tr></table></figure></li></ul></li><li><p>è®°å½•å¤´ä¿¡æ¯</p><p><code>Redundant</code>è¡Œæ ¼å¼çš„è®°å½•å¤´ä¿¡æ¯å ç”¨<code>6</code>å­—èŠ‚ï¼Œ<code>48</code>ä¸ªäºŒè¿›åˆ¶ä½ï¼Œè¿™äº›äºŒè¿›åˆ¶ä½ä»£è¡¨çš„æ„æ€å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åç§°</th><th>å¤§å°ï¼ˆå•ä½ï¼šbitï¼‰</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>é¢„ç•™ä½1</code></td><td><code>1</code></td><td>æ²¡æœ‰ä½¿ç”¨</td></tr><tr><td><code>é¢„ç•™ä½2</code></td><td><code>1</code></td><td>æ²¡æœ‰ä½¿ç”¨</td></tr><tr><td><code>delete_mask</code></td><td><code>1</code></td><td>æ ‡è®°è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤</td></tr><tr><td><code>min_rec_mask</code></td><td><code>1</code></td><td>B+æ ‘çš„æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°</td></tr><tr><td><code>n_owned</code></td><td><code>4</code></td><td>è¡¨ç¤ºå½“å‰è®°å½•æ‹¥æœ‰çš„è®°å½•æ•°</td></tr><tr><td><code>heap_no</code></td><td><code>13</code></td><td>è¡¨ç¤ºå½“å‰è®°å½•åœ¨é¡µé¢å †çš„ä½ç½®ä¿¡æ¯</td></tr><tr><td><code>n_field</code></td><td><code>10</code></td><td>è¡¨ç¤ºè®°å½•ä¸­åˆ—çš„æ•°é‡</td></tr><tr><td><code>1byte_offs_flag</code></td><td><code>1</code></td><td>æ ‡è®°å­—æ®µé•¿åº¦åç§»åˆ—è¡¨ä¸­æ¯ä¸ªåˆ—å¯¹åº”çš„åç§»é‡æ˜¯ä½¿ç”¨1å­—èŠ‚è¿˜æ˜¯2å­—èŠ‚è¡¨ç¤ºçš„</td></tr><tr><td><code>next_record</code></td><td><code>16</code></td><td>è¡¨ç¤ºä¸‹ä¸€æ¡è®°å½•çš„ç»å¯¹ä½ç½®</td></tr></tbody></table><p>ç¬¬ä¸€æ¡è®°å½•ä¸­çš„å¤´ä¿¡æ¯æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">0</span>F <span class="hljs-number">00</span> BC<br></code></pre></td></tr></table></figure><p>æ ¹æ®è¿™å…­ä¸ªå­—èŠ‚å¯ä»¥è®¡ç®—å‡ºå„ä¸ªå±æ€§çš„å€¼ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs makefile">é¢„ç•™ä½1ï¼š0x00<br>é¢„ç•™ä½2ï¼š0x00<br><span class="hljs-section">delete_mask: 0x00</span><br><span class="hljs-section">min_rec_mask: 0x00</span><br><span class="hljs-section">n_owned: 0x00</span><br><span class="hljs-section">heap_no: 0x02</span><br><span class="hljs-section">n_field: 0x07</span><br><span class="hljs-section">1byte_offs_flag: 0x01</span><br><span class="hljs-section">next_record:0xBC</span><br></code></pre></td></tr></table></figure><p>ä¸<code>Compact</code>è¡Œæ ¼å¼çš„è®°å½•å¤´ä¿¡æ¯å¯¹æ¯”æ¥çœ‹ï¼Œæœ‰ä¸¤å¤„ä¸åŒï¼š</p><ul><li><code>Redundant</code>è¡Œæ ¼å¼å¤šäº†<code>n_field</code>å’Œ<code>1byte_offs_flag</code>è¿™ä¸¤ä¸ªå±æ€§ã€‚</li><li><code>Redundant</code>è¡Œæ ¼å¼æ²¡æœ‰<code>record_type</code>è¿™ä¸ªå±æ€§ã€‚</li></ul></li><li><p><code>1byte_offs_flag</code>çš„å€¼æ˜¯æ€ä¹ˆé€‰æ‹©çš„</p><p><code>å­—æ®µé•¿åº¦åç§»åˆ—è¡¨</code>å®è´¨ä¸Šæ˜¯å­˜å‚¨æ¯ä¸ªåˆ—ä¸­çš„å€¼å ç”¨çš„ç©ºé—´åœ¨<code>è®°å½•çš„çœŸå®æ•°æ®</code>å¤„ç»“æŸçš„ä½ç½®ï¼Œè¿˜æ˜¯æ‹¿<code>record_format_demo</code>ç¬¬ä¸€æ¡è®°å½•ä¸ºä¾‹ï¼Œ<code>0x06</code>ä»£è¡¨ç¬¬ä¸€ä¸ªåˆ—åœ¨<code>è®°å½•çš„çœŸå®æ•°æ®</code>ç¬¬6ä¸ªå­—èŠ‚å¤„ç»“æŸï¼Œ<code>0x0C</code>ä»£è¡¨ç¬¬äºŒä¸ªåˆ—åœ¨<code>è®°å½•çš„çœŸå®æ•°æ®</code>ç¬¬12ä¸ªå­—èŠ‚å¤„ç»“æŸï¼Œ<code>0x13</code>ä»£è¡¨ç¬¬ä¸‰ä¸ªåˆ—åœ¨<code>è®°å½•çš„çœŸå®æ•°æ®</code>ç¬¬19ä¸ªå­—èŠ‚å¤„ç»“æŸï¼Œç­‰ç­‰ç­‰ç­‰ï¼Œæœ€åä¸€ä¸ªåˆ—å¯¹åº”çš„åç§»é‡å€¼ä¸º<code>0x25</code>ï¼Œä¹Ÿå°±æ„å‘³ç€æœ€åä¸€ä¸ªåˆ—åœ¨<code>è®°å½•çš„çœŸå®æ•°æ®</code>ç¬¬37ä¸ªå­—èŠ‚å¤„ç»“æŸï¼Œä¹Ÿå°±æ„å‘³ç€æ•´æ¡è®°å½•çš„<code>çœŸå®æ•°æ®</code>å®é™…ä¸Šå ç”¨<code>37</code>ä¸ªå­—èŠ‚ã€‚</p><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡æ¯ä¸ªåˆ—å¯¹åº”çš„åç§»é‡å¯ä»¥å ç”¨1ä¸ªå­—èŠ‚æˆ–è€…2ä¸ªå­—èŠ‚æ¥å­˜å‚¨ï¼Œé‚£åˆ°åº•ä»€ä¹ˆæ—¶å€™ç”¨1ä¸ªå­—èŠ‚ï¼Œä»€ä¹ˆæ—¶å€™ç”¨2ä¸ªå­—èŠ‚å‘¢ï¼Ÿå…¶å®æ˜¯æ ¹æ®è¯¥æ¡<code>Redundant</code>è¡Œæ ¼å¼<code>è®°å½•çš„çœŸå®æ•°æ®</code>å ç”¨çš„æ€»å¤§å°æ¥åˆ¤æ–­çš„ï¼š</p><ul><li>å½“è®°å½•çš„çœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ä¸å¤§äº127ï¼ˆåå…­è¿›åˆ¶<code>0x7F</code>ï¼ŒäºŒè¿›åˆ¶<code>01111111</code>ï¼‰æ—¶ï¼Œæ¯ä¸ªåˆ—å¯¹åº”çš„åç§»é‡å ç”¨1ä¸ªå­—èŠ‚ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>å¦‚æœæ•´ä¸ªè®°å½•çš„çœŸå®æ•°æ®å ç”¨çš„å­˜å‚¨ç©ºé—´éƒ½ä¸å¤§äº127ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæ¯ä¸ªåˆ—å¯¹åº”çš„åç§»é‡å€¼è‚¯å®šä¹Ÿå°±ä¸å¤§äº127ï¼Œä¹Ÿå°±å¯ä»¥ä½¿ç”¨1ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå–½ã€‚<br></code></pre></td></tr></table></figure><ul><li>å½“è®°å½•çš„çœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚æ•°å¤§äº127ï¼Œä½†ä¸å¤§äº32767ï¼ˆåå…­è¿›åˆ¶<code>0x7FFF</code>ï¼ŒäºŒè¿›åˆ¶<code>0111111111111111</code>ï¼‰æ—¶ï¼Œæ¯ä¸ªåˆ—å¯¹åº”çš„åç§»é‡å ç”¨2ä¸ªå­—èŠ‚ã€‚</li><li>æœ‰æ²¡æœ‰è®°å½•çš„çœŸå®æ•°æ®å¤§äº32767çš„æƒ…å†µå‘¢ï¼Ÿæœ‰ï¼Œä¸è¿‡æ­¤æ—¶çš„è®°å½•å·²ç»å­˜æ”¾åˆ°äº†æº¢å‡ºé¡µä¸­ï¼Œåœ¨æœ¬é¡µä¸­åªä¿ç•™å‰<code>768</code>ä¸ªå­—èŠ‚å’Œ20ä¸ªå­—èŠ‚çš„æº¢å‡ºé¡µé¢åœ°å€ï¼ˆå½“ç„¶è¿™20ä¸ªå­—èŠ‚ä¸­è¿˜è®°å½•äº†ä¸€äº›åˆ«çš„ä¿¡æ¯ï¼‰ã€‚å› ä¸º<code>å­—æ®µé•¿åº¦åç§»åˆ—è¡¨</code>å¤„åªéœ€è¦è®°å½•æ¯ä¸ªåˆ—åœ¨æœ¬é¡µé¢ä¸­çš„åç§»å°±å¥½äº†ï¼Œæ‰€ä»¥æ¯ä¸ªåˆ—ä½¿ç”¨2ä¸ªå­—èŠ‚æ¥å­˜å‚¨åç§»é‡å°±å¤Ÿäº†ã€‚</li></ul><p>å¤§å®¶å¯ä»¥çœ‹å‡ºæ¥ï¼Œè®¾è®¡<code>Redundant</code>è¡Œæ ¼å¼çš„å¤§å”è¿˜æ˜¯æ¯”è¾ƒç®€å•ç²—æš´çš„ï¼Œç›´æ¥ä½¿ç”¨æ•´ä¸ª<code>è®°å½•çš„çœŸå®æ•°æ®</code>é•¿åº¦æ¥å†³å®šä½¿ç”¨1ä¸ªå­—èŠ‚è¿˜æ˜¯2ä¸ªå­—èŠ‚å­˜å‚¨åˆ—å¯¹åº”çš„åç§»é‡ã€‚åªè¦æ•´æ¡è®°å½•çš„çœŸå®æ•°æ®å ç”¨çš„å­˜å‚¨ç©ºé—´å¤§å°å¤§äº127ï¼Œå³ä½¿ç¬¬ä¸€ä¸ªåˆ—çš„å€¼å ç”¨å­˜å‚¨ç©ºé—´å°äº127ï¼Œé‚£å¯¹ä¸èµ·ï¼Œä¹Ÿéœ€è¦ä½¿ç”¨2ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºè¯¥åˆ—å¯¹åº”çš„åç§»é‡ã€‚ç®€å•ç²—æš´ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ç²—æš´ï¼ˆæ‰€ä»¥è¿™ç§è¡Œæ ¼å¼æœ‰äº›è¿‡æ—¶äº†ï½ï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>å¤§å®¶æœ‰æ²¡æœ‰ç–‘æƒ‘ï¼Œä¸€ä¸ªå­—èŠ‚èƒ½è¡¨ç¤ºçš„èŒƒå›´æ˜¯0ï½255ï¼Œä¸ºå•¥åœ¨è®°å½•çš„çœŸå®æ•°æ®å ç”¨çš„å­˜å‚¨ç©ºé—´å¤§äº127æ—¶å°±é‡‡ç”¨2ä¸ªå­—èŠ‚è¡¨ç¤ºå„ä¸ªåˆ—çš„åç§»é‡å‘¢ï¼Ÿç¨å®‰å‹¿èºï¼Œåè¾¹é©¬ä¸Šæ­æ™“ã€‚<br></code></pre></td></tr></table></figure><p>ä¸ºäº†åœ¨è§£æè®°å½•æ—¶çŸ¥é“æ¯ä¸ªåˆ—çš„åç§»é‡æ˜¯ä½¿ç”¨1ä¸ªå­—èŠ‚è¿˜æ˜¯2ä¸ªå­—èŠ‚è¡¨ç¤ºçš„ï¼Œè®¾è®¡<code>Redundant</code>è¡Œæ ¼å¼çš„å¤§å”ç‰¹æ„åœ¨<code>è®°å½•å¤´ä¿¡æ¯</code>é‡Œæ”¾ç½®äº†ä¸€ä¸ªç§°ä¹‹ä¸º<code>1byte_offs_flag</code>çš„å±æ€§ï¼š</p><ul><li>å½“å®ƒçš„å€¼ä¸º1æ—¶ï¼Œè¡¨æ˜ä½¿ç”¨1ä¸ªå­—èŠ‚å­˜å‚¨ã€‚</li><li>å½“å®ƒçš„å€¼ä¸º0æ—¶ï¼Œè¡¨æ˜ä½¿ç”¨2ä¸ªå­—èŠ‚å­˜å‚¨ã€‚</li></ul></li><li><p><code>Redundant</code>è¡Œæ ¼å¼ä¸­<code>NULL</code>å€¼çš„å¤„ç†</p><p>å› ä¸º<code>Redundant</code>è¡Œæ ¼å¼å¹¶æ²¡æœ‰<code>NULLå€¼åˆ—è¡¨</code>ï¼Œæ‰€ä»¥è®¾è®¡<code>Redundant</code>è¡Œæ ¼å¼çš„å¤§å”åœ¨<code>å­—æ®µé•¿åº¦åç§»åˆ—è¡¨</code>ä¸­çš„å„ä¸ªåˆ—å¯¹åº”çš„åç§»é‡å¤„åšäº†ä¸€äº›ç‰¹æ®Šå¤„ç† â€”â€” å°†åˆ—å¯¹åº”çš„åç§»é‡å€¼çš„ç¬¬ä¸€ä¸ªæ¯”ç‰¹ä½ä½œä¸ºæ˜¯å¦ä¸º<code>NULL</code>çš„ä¾æ®ï¼Œè¯¥æ¯”ç‰¹ä½ä¹Ÿå¯ä»¥è¢«ç§°ä¹‹ä¸º<code>NULLæ¯”ç‰¹ä½</code>ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨è§£æä¸€æ¡è®°å½•çš„æŸä¸ªåˆ—æ—¶ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹è¯¥åˆ—å¯¹åº”çš„åç§»é‡çš„<code>NULLæ¯”ç‰¹ä½</code>æ˜¯ä¸æ˜¯ä¸º<code>1</code>ï¼Œå¦‚æœä¸º<code>1</code>ï¼Œé‚£ä¹ˆè¯¥åˆ—çš„å€¼å°±æ˜¯<code>NULL</code>ï¼Œå¦åˆ™ä¸æ˜¯<code>NULL</code>ã€‚</p><p>è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸Šè¾¹ä»‹ç»ä¸ºä»€ä¹ˆåªè¦è®°å½•çš„çœŸå®æ•°æ®å¤§äº127ï¼ˆåå…­è¿›åˆ¶<code>0x7F</code>ï¼ŒäºŒè¿›åˆ¶<code>01111111</code>ï¼‰æ—¶ï¼Œå°±é‡‡ç”¨2ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä¸€ä¸ªåˆ—å¯¹åº”çš„åç§»é‡ï¼Œä¸»è¦æ˜¯ç¬¬ä¸€ä¸ªæ¯”ç‰¹ä½æ˜¯æ‰€è°“çš„<code>NULLæ¯”ç‰¹ä½</code>ï¼Œç”¨æ¥æ ‡è®°è¯¥åˆ—çš„å€¼æ˜¯å¦ä¸º<code>NULL</code>ã€‚</p><p>ä½†æ˜¯è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œå¯¹äºå€¼ä¸º<code>NULL</code>çš„åˆ—æ¥è¯´ï¼Œè¯¥åˆ—çš„ç±»å‹æ˜¯å¦ä¸ºå®šé•¿ç±»å‹å†³å®šäº†<code>NULL</code>å€¼çš„å®é™…å­˜å‚¨æ–¹å¼ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥åˆ†æä¸€ä¸‹<code>record_format_demo</code>è¡¨çš„ç¬¬äºŒæ¡è®°å½•ï¼Œå®ƒå¯¹åº”çš„<code>å­—æ®µé•¿åº¦åç§»åˆ—è¡¨</code>å¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">A4</span> A<span class="hljs-number">4</span> <span class="hljs-number">1</span>A <span class="hljs-number">17</span> <span class="hljs-number">13</span> <span class="hljs-number">0</span>C <span class="hljs-number">06</span><br></code></pre></td></tr></table></figure><p>æŒ‰ç…§åˆ—çš„é¡ºåºæ’æ”¾å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">06 </span><span class="hljs-number">0</span>C <span class="hljs-number">13</span> <span class="hljs-number">17</span> <span class="hljs-number">1</span>A A4 A4<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ†æƒ…å†µçœ‹ä¸€ä¸‹ï¼š</p><ul><li><p>å¦‚æœå­˜å‚¨<code>NULL</code>å€¼çš„å­—æ®µæ˜¯å®šé•¿ç±»å‹çš„ï¼Œæ¯”æ–¹è¯´<code>CHAR(M)</code>æ•°æ®ç±»å‹çš„ï¼Œåˆ™<code>NULL</code>å€¼ä¹Ÿå°†å ç”¨è®°å½•çš„çœŸå®æ•°æ®éƒ¨åˆ†ï¼Œå¹¶æŠŠè¯¥å­—æ®µå¯¹åº”çš„æ•°æ®ä½¿ç”¨<code>0x00</code>å­—èŠ‚å¡«å……ã€‚</p><p>å¦‚å›¾ç¬¬äºŒæ¡è®°å½•çš„<code>c3</code>åˆ—çš„å€¼æ˜¯<code>NULL</code>ï¼Œè€Œ<code>c3</code>åˆ—çš„ç±»å‹æ˜¯<code>CHAR(10)</code>ï¼Œå ç”¨è®°å½•çš„çœŸå®æ•°æ®éƒ¨åˆ†10å­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°åœ¨<code>Redundant</code>è¡Œæ ¼å¼ä¸­ä½¿ç”¨<code>0x00000000000000000000</code>æ¥è¡¨ç¤º<code>NULL</code>å€¼ã€‚</p><p>å¦å¤–ï¼Œ<code>c3</code>åˆ—å¯¹åº”çš„åç§»é‡ä¸º<code>0xA4</code>ï¼Œå®ƒå¯¹åº”çš„äºŒè¿›åˆ¶å®é™…æ˜¯ï¼š<code>10100100</code>ï¼Œå¯ä»¥çœ‹åˆ°æœ€é«˜ä½ä¸º<code>1</code>ï¼Œæ„å‘³ç€è¯¥åˆ—çš„å€¼æ˜¯<code>NULL</code>ã€‚å°†æœ€é«˜ä½å»æ‰åçš„å€¼å˜æˆäº†<code>0100100</code>ï¼Œå¯¹åº”çš„åè¿›åˆ¶å€¼ä¸º<code>36</code>ï¼Œè€Œ<code>c2</code>åˆ—å¯¹åº”çš„åç§»é‡ä¸º<code>0x1A</code>ï¼Œä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„<code>26</code>ã€‚<code>36 - 26 = 10</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€ç»ˆ<code>c3</code>åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´ä¸º10ä¸ªå­—èŠ‚ã€‚</p></li><li><p>å¦‚æœè¯¥å­˜å‚¨<code>NULL</code>å€¼çš„å­—æ®µæ˜¯å˜é•¿æ•°æ®ç±»å‹çš„ï¼Œåˆ™ä¸åœ¨<code>è®°å½•çš„çœŸå®æ•°æ®</code>å¤„å ç”¨ä»»ä½•å­˜å‚¨ç©ºé—´ã€‚</p><p>æ¯”å¦‚<code>record_format_demo</code>è¡¨çš„<code>c4</code>åˆ—æ˜¯<code>VARCHAR(10)</code>ç±»å‹çš„ï¼Œ<code>VARCHAR(10)</code>æ˜¯ä¸€ä¸ªå˜é•¿æ•°æ®ç±»å‹ï¼Œ<code>c4</code>åˆ—å¯¹åº”çš„åç§»é‡ä¸º<code>0xA4</code>ï¼Œä¸<code>c3</code>åˆ—å¯¹åº”çš„åç§»é‡ç›¸åŒï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€å®ƒçš„å€¼ä¹Ÿä¸º<code>NULL</code>ï¼Œå°†<code>0xA4</code>çš„æœ€é«˜ä½å»æ‰åå¯¹åº”çš„åè¿›åˆ¶å€¼ä¹Ÿæ˜¯<code>36</code>ï¼Œ<code>36 - 36 = 0</code>ï¼Œä¹Ÿå°±æ„å‘³ç€<code>c4</code>åˆ—æœ¬èº«ä¸å ç”¨ä»»ä½•<code>è®°å½•çš„å®é™…æ•°æ®</code>å¤„çš„ç©ºé—´ã€‚</p></li></ul></li></ul><p>é™¤äº†ä»¥ä¸Šçš„å‡ ç‚¹ä¹‹å¤–ï¼Œ<code>Redundant</code>è¡Œæ ¼å¼å’Œ<code>Compact</code>è¡Œæ ¼å¼è¿˜æ˜¯å¤§è‡´ç›¸åŒçš„ã€‚</p><h4 id="CHAR-M-åˆ—çš„å­˜å‚¨æ ¼å¼-2">CHAR(M)åˆ—çš„å­˜å‚¨æ ¼å¼</h4><p>æˆ‘ä»¬çŸ¥é“<code>Compact</code>è¡Œæ ¼å¼åœ¨<code>CHAR(M)</code>ç±»å‹çš„åˆ—ä¸­å­˜å‚¨æ•°æ®çš„æ—¶å€™è¿˜æŒºéº»çƒ¦ï¼Œåˆ†å˜é•¿å­—ç¬¦é›†å’Œå®šé•¿å­—ç¬¦é›†çš„æƒ…å†µï¼Œè€Œåœ¨<code>Redundant</code>è¡Œæ ¼å¼ä¸­ååˆ†å¹²è„†ï¼Œä¸ç®¡è¯¥åˆ—ä½¿ç”¨çš„å­—ç¬¦é›†æ˜¯å•¥ï¼Œåªè¦æ˜¯ä½¿ç”¨<code>CHAR(M)</code>ç±»å‹ï¼Œå ç”¨çš„çœŸå®æ•°æ®ç©ºé—´å°±æ˜¯è¯¥å­—ç¬¦é›†è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æœ€å¤šéœ€è¦çš„å­—èŠ‚æ•°å’Œ<code>M</code>çš„ä¹˜ç§¯ã€‚æ¯”æ–¹è¯´ä½¿ç”¨<code>utf8</code>å­—ç¬¦é›†çš„<code>CHAR(10)</code>ç±»å‹çš„åˆ—å ç”¨çš„çœŸå®æ•°æ®ç©ºé—´å§‹ç»ˆä¸º<code>30</code>ä¸ªå­—èŠ‚ï¼Œä½¿ç”¨<code>gbk</code>å­—ç¬¦é›†çš„<code>CHAR(10)</code>ç±»å‹çš„åˆ—å ç”¨çš„çœŸå®æ•°æ®ç©ºé—´å§‹ç»ˆä¸º<code>20</code>ä¸ªå­—èŠ‚ã€‚<strong>ç”±æ­¤å¯ä»¥çœ‹å‡ºæ¥ï¼Œä½¿ç”¨<code>Redundant</code>è¡Œæ ¼å¼çš„<code>CHAR(M)</code>ç±»å‹çš„åˆ—æ˜¯ä¸ä¼šäº§ç”Ÿç¢ç‰‡çš„ã€‚</strong></p><h3 id="è¡Œæº¢å‡ºæ•°æ®">è¡Œæº¢å‡ºæ•°æ®</h3><h4 id="VARCHAR-M-æœ€å¤šèƒ½å­˜å‚¨çš„æ•°æ®">VARCHAR(M)æœ€å¤šèƒ½å­˜å‚¨çš„æ•°æ®</h4><p>æˆ‘ä»¬çŸ¥é“å¯¹äº<code>VARCHAR(M)</code>ç±»å‹çš„åˆ—æœ€å¤šå¯ä»¥å ç”¨<code>65535</code>ä¸ªå­—èŠ‚ã€‚å…¶ä¸­çš„<code>M</code>ä»£è¡¨è¯¥ç±»å‹æœ€å¤šå­˜å‚¨çš„å­—ç¬¦æ•°é‡ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨<code>ascii</code>å­—ç¬¦é›†çš„è¯ï¼Œä¸€ä¸ªå­—ç¬¦å°±ä»£è¡¨ä¸€ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬çœ‹çœ‹<code>VARCHAR(65535)</code>æ˜¯å¦å¯ç”¨ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql&gt; <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> varchar_size_demo(<br>    -&gt;     c <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">65535</span>)<br>    -&gt; ) CHARSET=ascii ROW_FORMAT=Compact;<br>ERROR <span class="hljs-number">1118</span> (<span class="hljs-number">42000</span>): <span class="hljs-keyword">Row</span> size too <span class="hljs-keyword">large</span>. The maximum <span class="hljs-keyword">row</span> size <span class="hljs-keyword">for</span> the used <span class="hljs-keyword">table</span> <span class="hljs-keyword">type</span>, <span class="hljs-keyword">not</span> counting BLOBs, <span class="hljs-keyword">is</span> <span class="hljs-number">65535.</span> This includes <span class="hljs-keyword">storage</span> overhead, <span class="hljs-keyword">check</span> the manual. You have <span class="hljs-keyword">to</span> change <span class="hljs-keyword">some</span> <span class="hljs-keyword">columns</span> <span class="hljs-keyword">to</span> <span class="hljs-type">TEXT</span> <span class="hljs-keyword">or</span> BLOBs<br>mysql&gt;<br></code></pre></td></tr></table></figure><p>ä»æŠ¥é”™ä¿¡æ¯é‡Œå¯ä»¥çœ‹å‡ºï¼Œ<code>MySQL</code>å¯¹ä¸€æ¡è®°å½•å ç”¨çš„æœ€å¤§å­˜å‚¨ç©ºé—´æ˜¯æœ‰é™åˆ¶çš„ï¼Œé™¤äº†<code>BLOB</code>æˆ–è€…<code>TEXT</code>ç±»å‹çš„åˆ—ä¹‹å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„åˆ—ï¼ˆä¸åŒ…æ‹¬éšè—åˆ—å’Œè®°å½•å¤´ä¿¡æ¯ï¼‰å ç”¨çš„å­—èŠ‚é•¿åº¦åŠ èµ·æ¥ä¸èƒ½è¶…è¿‡<code>65535</code>ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥<code>MySQL</code>æœåŠ¡å™¨å»ºè®®æˆ‘ä»¬æŠŠå­˜å‚¨ç±»å‹æ”¹ä¸º<code>TEXT</code>æˆ–è€…<code>BLOB</code>çš„ç±»å‹ã€‚è¿™ä¸ª<code>65535</code>ä¸ªå­—èŠ‚é™¤äº†åˆ—æœ¬èº«çš„æ•°æ®ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›å…¶ä»–çš„æ•°æ®ï¼ˆ<code>storage overhead</code>ï¼‰ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ä¸ºäº†å­˜å‚¨ä¸€ä¸ª<code>VARCHAR(M)</code>ç±»å‹çš„åˆ—ï¼Œå…¶å®éœ€è¦å ç”¨3éƒ¨åˆ†å­˜å‚¨ç©ºé—´ï¼š</p><ul><li>çœŸå®æ•°æ®</li><li>çœŸå®æ•°æ®å ç”¨å­—èŠ‚çš„é•¿åº¦</li><li><code>NULL</code>å€¼æ ‡è¯†ï¼Œå¦‚æœè¯¥åˆ—æœ‰<code>NOT NULL</code>å±æ€§åˆ™å¯ä»¥æ²¡æœ‰è¿™éƒ¨åˆ†å­˜å‚¨ç©ºé—´</li></ul><p>å¦‚æœè¯¥<code>VARCHAR</code>ç±»å‹çš„åˆ—æ²¡æœ‰<code>NOT NULL</code>å±æ€§ï¼Œé‚£æœ€å¤šåªèƒ½å­˜å‚¨<code>65532</code>ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå› ä¸ºçœŸå®æ•°æ®çš„é•¿åº¦å¯èƒ½å ç”¨2ä¸ªå­—èŠ‚ï¼Œ<code>NULL</code>å€¼æ ‡è¯†éœ€è¦å ç”¨1ä¸ªå­—èŠ‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> varchar_size_demo(<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>      c <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">65532</span>)<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> ) CHARSET<span class="hljs-operator">=</span>ascii ROW_FORMAT<span class="hljs-operator">=</span>Compact;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br></code></pre></td></tr></table></figure><p>å¦‚æœ<code>VARCHAR</code>ç±»å‹çš„åˆ—æœ‰<code>NOT NULL</code>å±æ€§ï¼Œé‚£æœ€å¤šåªèƒ½å­˜å‚¨<code>65533</code>ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå› ä¸ºçœŸå®æ•°æ®çš„é•¿åº¦å¯èƒ½å ç”¨2ä¸ªå­—èŠ‚ï¼Œä¸éœ€è¦<code>NULL</code>å€¼æ ‡è¯†ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> varchar_size_demo;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> varchar_size_demo(<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>      c <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">65533</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> ) CHARSET<span class="hljs-operator">=</span>ascii ROW_FORMAT<span class="hljs-operator">=</span>Compact;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br></code></pre></td></tr></table></figure><p>å¦‚æœ<code>VARCHAR(M)</code>ç±»å‹çš„åˆ—ä½¿ç”¨çš„ä¸æ˜¯<code>ascii</code>å­—ç¬¦é›†ï¼Œé‚£ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿæ¥çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs subunit">mysql&gt; DROP TABLE varchar_size_demo;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; CREATE TABLE varchar_size_demo(<br>    -&gt;       c VARCHAR(65532)<br>    -&gt; ) CHARSET=gbk ROW_FORMAT=Compact;<br><span class="hljs-keyword">ERROR </span>1074 (42000): Column length too big for column &#x27;c&#x27; (max = 32767); use BLOB or TEXT instead<br><br>mysql&gt; CREATE TABLE varchar_size_demo(<br>    -&gt;       c VARCHAR(65532)<br>    -&gt; ) CHARSET=utf8 ROW_FORMAT=Compact;<br><span class="hljs-keyword">ERROR </span>1074 (42000): Column length too big for column &#x27;c&#x27; (max = 21845); use BLOB or TEXT instead<br></code></pre></td></tr></table></figure><p>ä»æ‰§è¡Œç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœ<code>VARCHAR(M)</code>ç±»å‹çš„åˆ—ä½¿ç”¨çš„ä¸æ˜¯<code>ascii</code>å­—ç¬¦é›†ï¼Œé‚£<code>M</code>çš„æœ€å¤§å–å€¼å–å†³äºè¯¥å­—ç¬¦é›†è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æœ€å¤šéœ€è¦çš„å­—èŠ‚æ•°ã€‚åœ¨åˆ—çš„å€¼å…è®¸ä¸º<code>NULL</code>çš„æƒ…å†µä¸‹ï¼Œ<code>gbk</code>å­—ç¬¦é›†è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æœ€å¤šéœ€è¦<code>2</code>ä¸ªå­—èŠ‚ï¼Œé‚£åœ¨è¯¥å­—ç¬¦é›†ä¸‹ï¼Œ<code>M</code>çš„æœ€å¤§å–å€¼å°±æ˜¯<code>32766</code>ï¼ˆä¹Ÿå°±æ˜¯ï¼š65532/2ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤šèƒ½å­˜å‚¨<code>32766</code>ä¸ªå­—ç¬¦ï¼›<code>utf8</code>å­—ç¬¦é›†è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æœ€å¤šéœ€è¦<code>3</code>ä¸ªå­—èŠ‚ï¼Œé‚£åœ¨è¯¥å­—ç¬¦é›†ä¸‹ï¼Œ<code>M</code>çš„æœ€å¤§å–å€¼å°±æ˜¯<code>21844</code>ï¼Œå°±æ˜¯è¯´æœ€å¤šèƒ½å­˜å‚¨<code>21844</code>ï¼ˆä¹Ÿå°±æ˜¯ï¼š65532/3ï¼‰ä¸ªå­—ç¬¦ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>ä¸Šè¿°æ‰€è¨€åœ¨åˆ—çš„å€¼å…è®¸ä¸ºNULLçš„æƒ…å†µä¸‹ï¼Œgbkå­—ç¬¦é›†ä¸‹Mçš„æœ€å¤§å–å€¼å°±æ˜¯32766ï¼Œutf8å­—ç¬¦é›†ä¸‹Mçš„æœ€å¤§å–å€¼å°±æ˜¯21844ï¼Œè¿™éƒ½æ˜¯åœ¨è¡¨ä¸­åªæœ‰ä¸€ä¸ªå­—æ®µçš„æƒ…å†µä¸‹è¯´çš„ï¼Œä¸€å®šè¦è®°ä½ä¸€ä¸ªè¡Œä¸­çš„æ‰€æœ‰åˆ—ï¼ˆä¸åŒ…æ‹¬éšè—åˆ—å’Œè®°å½•å¤´ä¿¡æ¯ï¼‰å ç”¨çš„å­—èŠ‚é•¿åº¦åŠ èµ·æ¥ä¸èƒ½è¶…è¿‡65535ä¸ªå­—èŠ‚ï¼<br></code></pre></td></tr></table></figure><h4 id="è®°å½•ä¸­çš„æ•°æ®å¤ªå¤šäº§ç”Ÿçš„æº¢å‡º">è®°å½•ä¸­çš„æ•°æ®å¤ªå¤šäº§ç”Ÿçš„æº¢å‡º</h4><p>æˆ‘ä»¬ä»¥<code>ascii</code>å­—ç¬¦é›†ä¸‹çš„<code>varchar_size_demo</code>è¡¨ä¸ºä¾‹ï¼Œæ’å…¥ä¸€æ¡è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> varchar_size_demo(<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>       c <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">65532</span>)<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> ) CHARSET<span class="hljs-operator">=</span>ascii ROW_FORMAT<span class="hljs-operator">=</span>Compact;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> varchar_size_demo(c) <span class="hljs-keyword">VALUES</span>(REPEAT(<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-number">65532</span>));<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­çš„<code>REPEAT('a', 65532)</code>æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå®ƒè¡¨ç¤ºç”Ÿæˆä¸€ä¸ªæŠŠå­—ç¬¦<code>'a'</code>é‡å¤<code>65532</code>æ¬¡çš„å­—ç¬¦ä¸²ã€‚å‰è¾¹è¯´è¿‡ï¼Œ<code>MySQL</code>ä¸­ç£ç›˜å’Œå†…å­˜äº¤äº’çš„åŸºæœ¬å•ä½æ˜¯<code>é¡µ</code>ï¼Œä¹Ÿå°±æ˜¯è¯´<code>MySQL</code>æ˜¯ä»¥<code>é¡µ</code>ä¸ºåŸºæœ¬å•ä½æ¥ç®¡ç†å­˜å‚¨ç©ºé—´çš„ï¼Œæˆ‘ä»¬çš„è®°å½•éƒ½ä¼šè¢«åˆ†é…åˆ°æŸä¸ª<code>é¡µ</code>ä¸­å­˜å‚¨ã€‚è€Œä¸€ä¸ªé¡µçš„å¤§å°ä¸€èˆ¬æ˜¯<code>16KB</code>ï¼Œä¹Ÿå°±æ˜¯<code>16384</code>å­—èŠ‚ï¼Œè€Œä¸€ä¸ª<code>VARCHAR(M)</code>ç±»å‹çš„åˆ—å°±æœ€å¤šå¯ä»¥å­˜å‚¨<code>65532</code>ä¸ªå­—èŠ‚ï¼Œè¿™æ ·å°±å¯èƒ½é€ æˆä¸€ä¸ªé¡µå­˜æ”¾ä¸äº†ä¸€æ¡è®°å½•çš„å°´å°¬æƒ…å†µã€‚</p><p>åœ¨<code>Compact</code>å’Œ<code>Redundant</code>è¡Œæ ¼å¼ä¸­ï¼Œå¯¹äºå ç”¨å­˜å‚¨ç©ºé—´éå¸¸å¤§çš„åˆ—ï¼Œåœ¨<code>è®°å½•çš„çœŸå®æ•°æ®</code>å¤„åªä¼šå­˜å‚¨è¯¥åˆ—çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼ŒæŠŠå‰©ä½™çš„æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å‡ ä¸ªå…¶ä»–çš„é¡µä¸­ï¼Œç„¶å<code>è®°å½•çš„çœŸå®æ•°æ®</code>å¤„ç”¨20ä¸ªå­—èŠ‚å­˜å‚¨æŒ‡å‘è¿™äº›é¡µçš„åœ°å€ï¼ˆå½“ç„¶è¿™20ä¸ªå­—èŠ‚ä¸­è¿˜åŒ…æ‹¬è¿™äº›åˆ†æ•£åœ¨å…¶ä»–é¡µé¢ä¸­çš„æ•°æ®çš„å ç”¨çš„å­—èŠ‚æ•°ï¼‰ï¼Œä»è€Œå¯ä»¥æ‰¾åˆ°å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e9aab47ea5~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1d48e3imu1vcp5rsh8cg0b1o169.png-149kB"><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œ**å¯¹äº<code>Compact</code>å’Œ<code>Redundant</code>è¡Œæ ¼å¼æ¥è¯´ï¼Œå¦‚æœæŸä¸€åˆ—ä¸­çš„æ•°æ®éå¸¸å¤šçš„è¯ï¼Œåœ¨æœ¬è®°å½•çš„çœŸå®æ•°æ®å¤„åªä¼šå­˜å‚¨è¯¥åˆ—çš„å‰<code>768</code>ä¸ªå­—èŠ‚çš„æ•°æ®å’Œä¸€ä¸ªæŒ‡å‘å…¶ä»–é¡µçš„åœ°å€ï¼Œç„¶åæŠŠå‰©ä¸‹çš„æ•°æ®å­˜æ”¾åˆ°å…¶ä»–é¡µä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿå«åš<code>è¡Œæº¢å‡º</code>ï¼Œ**å­˜å‚¨è¶…å‡º<code>768</code>å­—èŠ‚çš„é‚£äº›é¡µé¢ä¹Ÿè¢«ç§°ä¸º<code>æº¢å‡ºé¡µ</code>ã€‚ç”»ä¸€ä¸ªç®€å›¾å°±æ˜¯è¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e9a5d5637a~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1conbskr7apj19ns1d194vs1buo1t.png-35.8kB"><p>æœ€åéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åªæ˜¯ <em><strong>VARCHAR(M)</strong></em> ç±»å‹çš„åˆ—ï¼Œå…¶ä»–çš„ <em><strong>TEXT</strong></em>ã€<em><strong>BLOB</strong></em> ç±»å‹çš„åˆ—åœ¨å­˜å‚¨æ•°æ®éå¸¸å¤šçš„æ—¶å€™ä¹Ÿä¼šå‘ç”Ÿ<code>è¡Œæº¢å‡º</code>ã€‚</p><h4 id="è¡Œæº¢å‡ºçš„ä¸´ç•Œç‚¹">è¡Œæº¢å‡ºçš„ä¸´ç•Œç‚¹</h4><p>é‚£å‘ç”Ÿ<code>è¡Œæº¢å‡º</code>çš„ä¸´ç•Œç‚¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´åœ¨åˆ—å­˜å‚¨å¤šå°‘å­—èŠ‚çš„æ•°æ®æ—¶å°±ä¼šå‘ç”Ÿ<code>è¡Œæº¢å‡º</code>ï¼Ÿ</p><p><strong><code>MySQL</code>ä¸­è§„å®šä¸€ä¸ªé¡µä¸­è‡³å°‘å­˜æ”¾ä¸¤è¡Œè®°å½•</strong>ï¼Œè‡³äºä¸ºä»€ä¹ˆè¿™ä¹ˆè§„å®šæˆ‘ä»¬ä¹‹åå†è¯´ï¼Œç°åœ¨çœ‹ä¸€ä¸‹è¿™ä¸ªè§„å®šé€ æˆçš„å½±å“ã€‚ä»¥ä¸Šè¾¹çš„<code>varchar_size_demo</code>è¡¨ä¸ºä¾‹ï¼Œå®ƒåªæœ‰ä¸€ä¸ªåˆ—<code>c</code>ï¼Œæˆ‘ä»¬å¾€è¿™ä¸ªè¡¨ä¸­æ’å…¥ä¸¤æ¡è®°å½•ï¼Œæ¯æ¡è®°å½•æœ€å°‘æ’å…¥å¤šå°‘å­—èŠ‚çš„æ•°æ®æ‰ä¼š<code>è¡Œæº¢å‡º</code>çš„ç°è±¡å‘¢ï¼Ÿè¿™å¾—åˆ†æä¸€ä¸‹é¡µä¸­çš„ç©ºé—´éƒ½æ˜¯å¦‚ä½•åˆ©ç”¨çš„ã€‚</p><ul><li><p>æ¯ä¸ªé¡µé™¤äº†å­˜æ”¾æˆ‘ä»¬çš„è®°å½•ä»¥å¤–ï¼Œä¹Ÿéœ€è¦å­˜å‚¨ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œä¹±ä¸ƒå…«ç³Ÿçš„é¢å¤–ä¿¡æ¯åŠ èµ·æ¥éœ€è¦<code>132</code>ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼ˆç°åœ¨åªè¦çŸ¥é“è¿™ä¸ªæ•°å­—å°±å¥½äº†ï¼‰ï¼Œå…¶ä»–çš„ç©ºé—´éƒ½å¯ä»¥è¢«ç”¨æ¥å­˜å‚¨è®°å½•ã€‚</p></li><li><p>æ¯ä¸ªè®°å½•éœ€è¦çš„é¢å¤–ä¿¡æ¯æ˜¯<code>27</code>å­—èŠ‚ã€‚</p><p>è¿™27ä¸ªå­—èŠ‚åŒ…æ‹¬ä¸‹è¾¹è¿™äº›éƒ¨åˆ†ï¼š</p><ul><li>2ä¸ªå­—èŠ‚ç”¨äºå­˜å‚¨çœŸå®æ•°æ®çš„é•¿åº¦</li><li>1ä¸ªå­—èŠ‚ç”¨äºå­˜å‚¨åˆ—æ˜¯å¦æ˜¯NULLå€¼</li><li>5ä¸ªå­—èŠ‚å¤§å°çš„å¤´ä¿¡æ¯</li><li>6ä¸ªå­—èŠ‚çš„<code>row_id</code>åˆ—</li><li>6ä¸ªå­—èŠ‚çš„<code>transaction_id</code>åˆ—</li><li>7ä¸ªå­—èŠ‚çš„<code>roll_pointer</code>åˆ—</li></ul></li></ul><p>å‡è®¾ä¸€ä¸ªåˆ—ä¸­å­˜å‚¨çš„æ•°æ®å­—èŠ‚æ•°ä¸ºnï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”è§„å®šå¦‚æœè¯¥åˆ—ä¸å‘ç”Ÿæº¢å‡ºçš„ç°è±¡ï¼Œå°±éœ€è¦æ»¡è¶³ä¸‹è¾¹è¿™ä¸ªå¼å­ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">132 </span>+ <span class="hljs-number">2</span>Ã—(<span class="hljs-number">27</span> + n) &lt; <span class="hljs-number">16384</span><br></code></pre></td></tr></table></figure><p>æ±‚è§£è¿™ä¸ªå¼å­å¾—å‡ºçš„è§£æ˜¯ï¼š<code>n &lt; 8099</code>ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸€ä¸ªåˆ—ä¸­å­˜å‚¨çš„æ•°æ®å°äº<code>8099</code>ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆè¯¥åˆ—å°±ä¸ä¼šæˆä¸º<code>æº¢å‡ºåˆ—</code>ï¼Œå¦åˆ™è¯¥åˆ—å°±éœ€è¦æˆä¸º<code>æº¢å‡ºåˆ—</code>ã€‚ä¸è¿‡è¿™ä¸ª<code>8099</code>ä¸ªå­—èŠ‚çš„ç»“è®ºåªæ˜¯é’ˆå¯¹åªæœ‰ä¸€ä¸ªåˆ—çš„<code>varchar_size_demo</code>è¡¨æ¥è¯´çš„ï¼Œå¦‚æœè¡¨ä¸­æœ‰å¤šä¸ªåˆ—ï¼Œé‚£ä¸Šè¾¹çš„å¼å­å’Œç»“è®ºéƒ½éœ€è¦æ”¹ä¸€æ”¹äº†ï¼Œæ‰€ä»¥é‡ç‚¹å°±æ˜¯ï¼š<strong>ä½ ä¸ç”¨å…³æ³¨è¿™ä¸ªä¸´ç•Œç‚¹æ˜¯ä»€ä¹ˆï¼Œåªè¦çŸ¥é“å¦‚æœæˆ‘ä»¬ä¸€æ¡è®°å½•çš„æŸä¸ªåˆ—ä¸­å­˜å‚¨çš„æ•°æ®å ç”¨çš„å­—èŠ‚æ•°éå¸¸å¤šæ—¶ï¼Œè¯¥åˆ—å°±å¯èƒ½æˆä¸º<code>æº¢å‡ºåˆ—</code>ã€‚</strong></p><h3 id="Dynamicå’ŒCompressedè¡Œæ ¼å¼">Dynamicå’ŒCompressedè¡Œæ ¼å¼</h3><p>ä¸‹è¾¹è¦ä»‹ç»å¦å¤–ä¸¤ä¸ªè¡Œæ ¼å¼ï¼Œ<code>Dynamic</code>å’Œ<code>Compressed</code>è¡Œæ ¼å¼ï¼Œæˆ‘ç°åœ¨ä½¿ç”¨çš„<code>MySQL</code>ç‰ˆæœ¬æ˜¯<code>5.7</code>ï¼Œå®ƒçš„é»˜è®¤è¡Œæ ¼å¼å°±æ˜¯<code>Dynamic</code>ï¼Œè¿™ä¿©è¡Œæ ¼å¼å’Œ<code>Compact</code>è¡Œæ ¼å¼æŒºåƒï¼Œåªä¸è¿‡åœ¨å¤„ç†<code>è¡Œæº¢å‡º</code>æ•°æ®æ—¶æœ‰ç‚¹å„¿åˆ†æ­§ï¼Œå®ƒä»¬ä¸ä¼šåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å­˜å‚¨å­—æ®µçœŸå®æ•°æ®çš„å‰<code>768</code>ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰çš„å­—èŠ‚éƒ½å­˜å‚¨åˆ°å…¶ä»–é¡µé¢ä¸­ï¼Œåªåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å­˜å‚¨å…¶ä»–é¡µé¢çš„åœ°å€ï¼Œå°±åƒè¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e9b2c2b71e~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1conbtnmr1sg1hao1nf41pi1eb72a.png-29.9kB"><p><code>Compressed</code>è¡Œæ ¼å¼å’Œ<code>Dynamic</code>ä¸åŒçš„ä¸€ç‚¹æ˜¯ï¼Œ<code>Compressed</code>è¡Œæ ¼å¼ä¼šé‡‡ç”¨å‹ç¼©ç®—æ³•å¯¹é¡µé¢è¿›è¡Œå‹ç¼©ï¼Œä»¥èŠ‚çœç©ºé—´ã€‚</p><h2 id="æ€»ç»“-2">æ€»ç»“</h2><ol><li><p>é¡µæ˜¯<code>MySQL</code>ä¸­ç£ç›˜å’Œå†…å­˜äº¤äº’çš„åŸºæœ¬å•ä½ï¼Œä¹Ÿæ˜¯<code>MySQL</code>æ˜¯ç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ã€‚</p></li><li><p>æŒ‡å®šå’Œä¿®æ”¹è¡Œæ ¼å¼çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å (åˆ—çš„ä¿¡æ¯) ROW_FORMAT<span class="hljs-operator">=</span>è¡Œæ ¼å¼åç§°<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å ROW_FORMAT<span class="hljs-operator">=</span>è¡Œæ ¼å¼åç§°<br></code></pre></td></tr></table></figure></li><li><p><code>InnoDB</code>ç›®å‰å®šä¹‰äº†4ç§è¡Œæ ¼å¼</p><ul><li><p>COMPACTè¡Œæ ¼å¼</p><p>å…·ä½“ç»„æˆå¦‚å›¾ï¼š <img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e8fafc21aa~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9g4t114n0j1gkro2r1h8h1d1t16.png-42.4kB"></p></li><li><p>Redundantè¡Œæ ¼å¼</p><p>å…·ä½“ç»„æˆå¦‚å›¾ï¼š <img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/169710e9ca9cbeb5~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ctfppb4c1cng1m8718l91760jde9.png-36.2kB"></p></li><li><p>Dynamicå’ŒCompressedè¡Œæ ¼å¼</p><p>è¿™ä¸¤ç§è¡Œæ ¼å¼ç±»ä¼¼äº<code>COMPACTè¡Œæ ¼å¼</code>ï¼Œåªä¸è¿‡åœ¨å¤„ç†è¡Œæº¢å‡ºæ•°æ®æ—¶æœ‰ç‚¹å„¿åˆ†æ­§ï¼Œå®ƒä»¬ä¸ä¼šåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å­˜å‚¨å­—ç¬¦ä¸²çš„å‰768ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰çš„å­—èŠ‚éƒ½å­˜å‚¨åˆ°å…¶ä»–é¡µé¢ä¸­ï¼Œåªåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å­˜å‚¨å…¶ä»–é¡µé¢çš„åœ°å€ã€‚</p><p>å¦å¤–ï¼Œ<code>Compressed</code>è¡Œæ ¼å¼ä¼šé‡‡ç”¨å‹ç¼©ç®—æ³•å¯¹é¡µé¢è¿›è¡Œå‹ç¼©ã€‚</p></li></ul></li></ol><ul><li>ä¸€ä¸ªé¡µä¸€èˆ¬æ˜¯<code>16KB</code>ï¼Œå½“è®°å½•ä¸­çš„æ•°æ®å¤ªå¤šï¼Œå½“å‰é¡µæ”¾ä¸ä¸‹çš„æ—¶å€™ï¼Œä¼šæŠŠå¤šä½™çš„æ•°æ®å­˜å‚¨åˆ°å…¶ä»–é¡µä¸­ï¼Œè¿™ç§ç°è±¡ç§°ä¸º<code>è¡Œæº¢å‡º</code>ã€‚</li></ul><h1>5.InnoDBæ•°æ®é¡µç»“æ„</h1><h2 id="ä¸åŒç±»å‹çš„é¡µç®€ä»‹">ä¸åŒç±»å‹çš„é¡µç®€ä»‹</h2><p><strong>å‰è¾¹æˆ‘ä»¬ç®€å•æäº†ä¸€ä¸‹<code>é¡µ</code>çš„æ¦‚å¿µï¼Œå®ƒæ˜¯<code>InnoDB</code>ç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªé¡µçš„å¤§å°ä¸€èˆ¬æ˜¯<code>16KB</code>ã€‚</strong><code>InnoDB</code>ä¸ºäº†ä¸åŒçš„ç›®çš„è€Œè®¾è®¡äº†è®¸å¤šç§ä¸åŒç±»å‹çš„<code>é¡µ</code>ï¼Œæ¯”å¦‚å­˜æ”¾è¡¨ç©ºé—´å¤´éƒ¨ä¿¡æ¯çš„é¡µï¼Œå­˜æ”¾<code>Insert Buffer</code>ä¿¡æ¯çš„é¡µï¼Œå­˜æ”¾<code>INODE</code>ä¿¡æ¯çš„é¡µï¼Œå­˜æ”¾<code>undo</code>æ—¥å¿—ä¿¡æ¯çš„é¡µç­‰ç­‰ç­‰ç­‰ã€‚å½“ç„¶äº†ï¼Œå¦‚æœæˆ‘è¯´çš„è¿™äº›åè¯ä½ ä¸€ä¸ªéƒ½æ²¡æœ‰å¬è¿‡ï¼Œå°±å½“æˆ‘æ”¾äº†ä¸ªå±å§ï½ ä¸è¿‡è¿™æ²¡æœ‰ä¸€æ¯›é’±å…³ç³»ï¼Œæˆ‘ä»¬ä»Šå„¿ä¸ªä¹Ÿä¸å‡†å¤‡è¯´è¿™äº›ç±»å‹çš„é¡µï¼Œæˆ‘ä»¬èšç„¦çš„æ˜¯é‚£äº›å­˜æ”¾æˆ‘ä»¬è¡¨ä¸­è®°å½•çš„é‚£ç§ç±»å‹çš„é¡µï¼Œå®˜æ–¹ç§°è¿™ç§å­˜æ”¾è®°å½•çš„é¡µä¸ºç´¢å¼•ï¼ˆ<code>INDEX</code>ï¼‰é¡µï¼Œé‰´äºæˆ‘ä»¬è¿˜æ²¡æœ‰äº†è§£è¿‡ç´¢å¼•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œè€Œè¿™äº›è¡¨ä¸­çš„è®°å½•å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸å£ä¸­æ‰€ç§°çš„<code>æ•°æ®</code>ï¼Œæ‰€ä»¥ç›®å‰è¿˜æ˜¯å«è¿™ç§å­˜æ”¾è®°å½•çš„é¡µä¸º<code>æ•°æ®é¡µ</code>å§ã€‚</p><h2 id="æ•°æ®é¡µç»“æ„çš„å¿«é€Ÿæµè§ˆ">æ•°æ®é¡µç»“æ„çš„å¿«é€Ÿæµè§ˆ</h2><p>æ•°æ®é¡µä»£è¡¨çš„è¿™å—<code>16KB</code>å¤§å°çš„å­˜å‚¨ç©ºé—´å¯ä»¥è¢«åˆ’åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œä¸åŒéƒ¨åˆ†æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œå„ä¸ªéƒ¨åˆ†å¦‚å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16f13ee1e2dfac7c~tplv-t2oaga2asx-watermark.awebp" class="" title="img"><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ª<code>InnoDB</code>æ•°æ®é¡µçš„å­˜å‚¨ç©ºé—´å¤§è‡´è¢«åˆ’åˆ†æˆäº†<code>7</code>ä¸ªéƒ¨åˆ†ï¼Œæœ‰çš„éƒ¨åˆ†å ç”¨çš„å­—èŠ‚æ•°æ˜¯ç¡®å®šçš„ï¼Œæœ‰çš„éƒ¨åˆ†å ç”¨çš„å­—èŠ‚æ•°æ˜¯ä¸ç¡®å®šçš„ã€‚ä¸‹è¾¹æˆ‘ä»¬ç”¨è¡¨æ ¼çš„æ–¹å¼æ¥å¤§è‡´æè¿°ä¸€ä¸‹è¿™7ä¸ªéƒ¨åˆ†éƒ½å­˜å‚¨ä¸€äº›å•¥å†…å®¹ï¼ˆå¿«é€Ÿçš„ç…ä¸€çœ¼å°±è¡Œäº†ï¼Œåè¾¹ä¼šè¯¦ç»†å” å¨çš„ï¼‰ï¼š</p><table><thead><tr><th>åç§°</th><th>ä¸­æ–‡å</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>ç®€å•æè¿°</th></tr></thead><tbody><tr><td><code>File Header</code></td><td>æ–‡ä»¶å¤´éƒ¨</td><td><code>38</code>å­—èŠ‚</td><td>é¡µçš„ä¸€äº›é€šç”¨ä¿¡æ¯</td></tr><tr><td><code>Page Header</code></td><td>é¡µé¢å¤´éƒ¨</td><td><code>56</code>å­—èŠ‚</td><td>æ•°æ®é¡µä¸“æœ‰çš„ä¸€äº›ä¿¡æ¯</td></tr><tr><td><code>Infimum + Supremum</code></td><td>æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•</td><td><code>26</code>å­—èŠ‚</td><td>ä¸¤ä¸ªè™šæ‹Ÿçš„è¡Œè®°å½•</td></tr><tr><td><code>User Records</code></td><td>ç”¨æˆ·è®°å½•</td><td>ä¸ç¡®å®š</td><td>å®é™…å­˜å‚¨çš„è¡Œè®°å½•å†…å®¹</td></tr><tr><td><code>Free Space</code></td><td>ç©ºé—²ç©ºé—´</td><td>ä¸ç¡®å®š</td><td>é¡µä¸­å°šæœªä½¿ç”¨çš„ç©ºé—´</td></tr><tr><td><code>Page Directory</code></td><td>é¡µé¢ç›®å½•</td><td>ä¸ç¡®å®š</td><td>é¡µä¸­çš„æŸäº›è®°å½•çš„ç›¸å¯¹ä½ç½®</td></tr><tr><td><code>File Trailer</code></td><td>æ–‡ä»¶å°¾éƒ¨</td><td><code>8</code>å­—èŠ‚</td><td>æ ¡éªŒé¡µæ˜¯å¦å®Œæ•´</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>æˆ‘ä»¬æ¥ä¸‹æ¥å¹¶ä¸æ‰“ç®—æŒ‰ç…§é¡µä¸­å„ä¸ªéƒ¨åˆ†çš„å‡ºç°é¡ºåºæ¥ä¾æ¬¡ä»‹ç»å®ƒä»¬ï¼Œå› ä¸ºå„ä¸ªéƒ¨åˆ†ä¸­ä¼šå‡ºç°å¾ˆå¤šå¤§å®¶ç›®å‰ä¸ç†è§£çš„æ¦‚å¿µï¼Œè¿™ä¼šæ‰“å‡»å„ä½è¯»æ–‡ç« çš„ä¿¡å¿ƒä¸å…´è¶£ï¼Œå¸Œæœ›å„ä½èƒ½æ¥å—è¿™ç§æ‹æ‘„æ‰‹æ³•ï½<br></code></pre></td></tr></table></figure><h2 id="è®°å½•åœ¨é¡µä¸­çš„å­˜å‚¨">è®°å½•åœ¨é¡µä¸­çš„å­˜å‚¨</h2><p>åœ¨é¡µçš„7ä¸ªç»„æˆéƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è‡ªå·±å­˜å‚¨çš„è®°å½•ä¼šæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„<code>è¡Œæ ¼å¼</code>å­˜å‚¨åˆ°<code>User Records</code>éƒ¨åˆ†ã€‚ä½†æ˜¯åœ¨ä¸€å¼€å§‹ç”Ÿæˆé¡µçš„æ—¶å€™ï¼Œå…¶å®å¹¶æ²¡æœ‰<code>User Records</code>è¿™ä¸ªéƒ¨åˆ†ï¼Œæ¯å½“æˆ‘ä»¬æ’å…¥ä¸€æ¡è®°å½•ï¼Œéƒ½ä¼šä»<code>Free Space</code>éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å°šæœªä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ä¸­ç”³è¯·ä¸€ä¸ªè®°å½•å¤§å°çš„ç©ºé—´åˆ’åˆ†åˆ°<code>User Records</code>éƒ¨åˆ†ï¼Œå½“<code>Free Space</code>éƒ¨åˆ†çš„ç©ºé—´å…¨éƒ¨è¢«<code>User Records</code>éƒ¨åˆ†æ›¿ä»£æ‰ä¹‹åï¼Œä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªé¡µä½¿ç”¨å®Œäº†ï¼Œå¦‚æœè¿˜æœ‰æ–°çš„è®°å½•æ’å…¥çš„è¯ï¼Œå°±éœ€è¦å»ç”³è¯·æ–°çš„é¡µäº†ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„å›¾ç¤ºå¦‚ä¸‹ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c0fe86555ed~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cosvi1in9st476cdqfki1n39m.png-133.8kB"><p>ä¸ºäº†æ›´å¥½çš„ç®¡ç†åœ¨<code>User Records</code>ä¸­çš„è¿™äº›è®°å½•ï¼Œ<code>InnoDB</code>å¯è´¹äº†ä¸€ç•ªåŠ›æ°”å‘¢ï¼Œåœ¨å“ªè´¹åŠ›æ°”äº†å‘¢ï¼Ÿä¸å°±æ˜¯æŠŠè®°å½•æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡æ‘†åœ¨<code>User Records</code>éƒ¨åˆ†ä¹ˆï¼Ÿå…¶å®è¿™è¯è¿˜å¾—ä»è®°å½•è¡Œæ ¼å¼çš„<code>è®°å½•å¤´ä¿¡æ¯</code>ä¸­è¯´èµ·ã€‚</p><h3 id="è®°å½•å¤´ä¿¡æ¯çš„ç§˜å¯†">è®°å½•å¤´ä¿¡æ¯çš„ç§˜å¯†</h3><p>ä¸ºäº†æ•…äº‹çš„é¡ºåˆ©å‘å±•ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> page_demo(<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     c1 <span class="hljs-type">INT</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     c2 <span class="hljs-type">INT</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     c3 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10000</span>),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     <span class="hljs-keyword">PRIMARY</span> KEY (c1)<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> ) CHARSET<span class="hljs-operator">=</span>ascii ROW_FORMAT<span class="hljs-operator">=</span>Compact;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–°åˆ›å»ºçš„<code>page_demo</code>è¡¨æœ‰3ä¸ªåˆ—ï¼Œå…¶ä¸­<code>c1</code>å’Œ<code>c2</code>åˆ—æ˜¯ç”¨æ¥å­˜å‚¨æ•´æ•°çš„ï¼Œ<code>c3</code>åˆ—æ˜¯ç”¨æ¥å­˜å‚¨å­—ç¬¦ä¸²çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬æŠŠ <em><strong>c1</strong></em> åˆ—æŒ‡å®šä¸ºä¸»é”®ï¼Œæ‰€ä»¥åœ¨å…·ä½“çš„è¡Œæ ¼å¼ä¸­InnoDBå°±æ²¡å¿…è¦ä¸ºæˆ‘ä»¬å»åˆ›å»ºé‚£ä¸ªæ‰€è°“çš„ <em><strong>row_id</strong></em> éšè—åˆ—äº†ã€‚è€Œä¸”æˆ‘ä»¬ä¸ºè¿™ä¸ªè¡¨æŒ‡å®šäº†<code>ascii</code>å­—ç¬¦é›†ä»¥åŠ<code>Compact</code>çš„è¡Œæ ¼å¼ã€‚æ‰€ä»¥è¿™ä¸ªè¡¨ä¸­è®°å½•çš„è¡Œæ ¼å¼ç¤ºæ„å›¾å°±æ˜¯è¿™æ ·çš„ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c0feca77be3~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9o2eib2vl11qnf1dfl1d2lco313.png-76.4kB"><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç‰¹æ„æŠŠ<code>è®°å½•å¤´ä¿¡æ¯</code>çš„5ä¸ªå­—èŠ‚çš„æ•°æ®ç»™æ ‡å‡ºæ¥äº†ï¼Œè¯´æ˜å®ƒå¾ˆé‡è¦ï¼Œæˆ‘ä»¬å†æ¬¡å…ˆæŠŠè¿™äº›<code>è®°å½•å¤´ä¿¡æ¯</code>ä¸­å„ä¸ªå±æ€§çš„å¤§ä½“æ„æ€æµè§ˆä¸€ä¸‹ï¼ˆæˆ‘ä»¬ç›®å‰ä½¿ç”¨<code>Compact</code>è¡Œæ ¼å¼è¿›è¡Œæ¼”ç¤ºï¼‰ï¼š</p><table><thead><tr><th>åç§°</th><th>å¤§å°ï¼ˆå•ä½ï¼šbitï¼‰</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>é¢„ç•™ä½1</code></td><td><code>1</code></td><td>æ²¡æœ‰ä½¿ç”¨</td></tr><tr><td><code>é¢„ç•™ä½2</code></td><td><code>1</code></td><td>æ²¡æœ‰ä½¿ç”¨</td></tr><tr><td><code>delete_mask</code></td><td><code>1</code></td><td>æ ‡è®°è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤</td></tr><tr><td><code>min_rec_mask</code></td><td><code>1</code></td><td>B+æ ‘çš„æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°</td></tr><tr><td><code>n_owned</code></td><td><code>4</code></td><td>è¡¨ç¤ºå½“å‰è®°å½•æ‹¥æœ‰çš„è®°å½•æ•°</td></tr><tr><td><code>heap_no</code></td><td><code>13</code></td><td>è¡¨ç¤ºå½“å‰è®°å½•åœ¨è®°å½•å †çš„ä½ç½®ä¿¡æ¯</td></tr><tr><td><code>record_type</code></td><td><code>3</code></td><td>è¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œ<code>0</code>è¡¨ç¤ºæ™®é€šè®°å½•ï¼Œ<code>1</code>è¡¨ç¤ºB+æ ‘éå¶èŠ‚ç‚¹è®°å½•ï¼Œ<code>2</code>è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ<code>3</code>è¡¨ç¤ºæœ€å¤§è®°å½•</td></tr><tr><td><code>next_record</code></td><td><code>16</code></td><td>è¡¨ç¤ºä¸‹ä¸€æ¡è®°å½•çš„ç›¸å¯¹ä½ç½®</td></tr></tbody></table><p>ç”±äºæˆ‘ä»¬ç°åœ¨ä¸»è¦åœ¨å” å¨<code>è®°å½•å¤´ä¿¡æ¯</code>çš„ä½œç”¨ï¼Œæ‰€ä»¥ä¸ºäº†å¤§å®¶ç†è§£ä¸Šçš„æ–¹ä¾¿ï¼Œæˆ‘ä»¬åªåœ¨<code>page_demo</code>è¡¨çš„è¡Œæ ¼å¼æ¼”ç¤ºå›¾ä¸­ç”»å‡ºæœ‰å…³çš„å¤´ä¿¡æ¯å±æ€§ä»¥åŠ<code>c1</code>ã€<code>c2</code>ã€<code>c3</code>åˆ—çš„ä¿¡æ¯ï¼ˆå…¶ä»–ä¿¡æ¯æ²¡ç”»ä¸ä»£è¡¨å®ƒä»¬ä¸å­˜åœ¨å•Šï¼Œåªæ˜¯ä¸ºäº†ç†è§£ä¸Šçš„æ–¹ä¾¿åœ¨å›¾ä¸­çœç•¥äº†ï½ï¼‰ï¼Œç®€åŒ–åçš„è¡Œæ ¼å¼ç¤ºæ„å›¾å°±æ˜¯è¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c0ff1ae5364~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9o52lt41v5c7vk1vm91fsm174b2d.png-49.5kB"><p>ä¸‹è¾¹æˆ‘ä»¬è¯•ç€å‘<code>page_demo</code>è¡¨ä¸­æ’å…¥å‡ æ¡è®°å½•ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; INSERT INTO page_demo VALUES(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>, &#x27;aaaa&#x27;), (<span class="hljs-number">2</span>, <span class="hljs-number">200</span>, &#x27;bbbb&#x27;), (<span class="hljs-number">3</span>, <span class="hljs-number">300</span>, &#x27;cccc&#x27;), (<span class="hljs-number">4</span>, <span class="hljs-number">400</span>, &#x27;dddd&#x27;);<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">4</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)<br><span class="hljs-attribute">Records</span>: <span class="hljs-number">4</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿å¤§å®¶åˆ†æè¿™äº›è®°å½•åœ¨<code>é¡µ</code>çš„<code>User Records</code>éƒ¨åˆ†ä¸­æ˜¯æ€ä¹ˆè¡¨ç¤ºçš„ï¼Œæˆ‘æŠŠè®°å½•ä¸­å¤´ä¿¡æ¯å’Œå®é™…çš„åˆ—æ•°æ®éƒ½ç”¨åè¿›åˆ¶è¡¨ç¤ºå‡ºæ¥äº†ï¼ˆå…¶å®æ˜¯ä¸€å †äºŒè¿›åˆ¶ä½ï¼‰ï¼Œæ‰€ä»¥è¿™äº›è®°å½•çš„ç¤ºæ„å›¾å°±æ˜¯ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c0ff83f9870~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9qs0j281knc16hc1hqsgj01v0o2c.png-82.8kB"><p>çœ‹è¿™ä¸ªå›¾çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå„æ¡è®°å½•åœ¨<code>User Records</code>ä¸­å­˜å‚¨çš„æ—¶å€™å¹¶æ²¡æœ‰ç©ºéš™ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†å¤§å®¶è§‚çœ‹æ–¹ä¾¿æ‰æŠŠæ¯æ¡è®°å½•å•ç‹¬ç”»åœ¨ä¸€è¡Œä¸­ã€‚æˆ‘ä»¬å¯¹ç…§ç€è¿™ä¸ªå›¾æ¥çœ‹çœ‹è®°å½•å¤´ä¿¡æ¯ä¸­çš„å„ä¸ªå±æ€§æ˜¯å•¥æ„æ€ï¼š</p><ul><li><p><code>delete_mask</code></p><p>è¿™ä¸ªå±æ€§æ ‡è®°ç€å½“å‰è®°å½•æ˜¯å¦è¢«åˆ é™¤ï¼Œå ç”¨1ä¸ªäºŒè¿›åˆ¶ä½ï¼Œå€¼ä¸º<code>0</code>çš„æ—¶å€™ä»£è¡¨è®°å½•å¹¶æ²¡æœ‰è¢«åˆ é™¤ï¼Œä¸º<code>1</code>çš„æ—¶å€™ä»£è¡¨è®°å½•è¢«åˆ é™¤æ‰äº†ã€‚</p><p>å•¥ï¼Ÿè¢«åˆ é™¤çš„è®°å½•è¿˜åœ¨<code>é¡µ</code>ä¸­ä¹ˆï¼Ÿæ˜¯çš„ï¼Œæ‘†åœ¨å°é¢ä¸Šçš„å’ŒèƒŒåœ°é‡Œåšçš„å¯èƒ½å¤§ç›¸å¾„åº­ï¼Œä½ ä»¥ä¸ºå®ƒåˆ é™¤äº†ï¼Œå¯å®ƒè¿˜åœ¨çœŸå®çš„ç£ç›˜ä¸Š[æ‘Šæ‰‹]ï¼ˆå¿½ç„¶æƒ³èµ·å† å¸Œï½ï¼‰ã€‚è¿™äº›è¢«åˆ é™¤çš„è®°å½•ä¹‹æ‰€ä»¥ä¸ç«‹å³ä»ç£ç›˜ä¸Šç§»é™¤ï¼Œæ˜¯å› ä¸ºç§»é™¤å®ƒä»¬ä¹‹åæŠŠå…¶ä»–çš„è®°å½•åœ¨ç£ç›˜ä¸Šé‡æ–°æ’åˆ—éœ€è¦æ€§èƒ½æ¶ˆè€—ï¼Œæ‰€ä»¥åªæ˜¯æ‰“ä¸€ä¸ªåˆ é™¤æ ‡è®°è€Œå·²ï¼Œæ‰€æœ‰è¢«åˆ é™¤æ‰çš„è®°å½•éƒ½ä¼šç»„æˆä¸€ä¸ªæ‰€è°“çš„<code>åƒåœ¾é“¾è¡¨</code>ï¼Œåœ¨è¿™ä¸ªé“¾è¡¨ä¸­çš„è®°å½•å ç”¨çš„ç©ºé—´ç§°ä¹‹ä¸ºæ‰€è°“çš„<code>å¯é‡ç”¨ç©ºé—´</code>ï¼Œä¹‹åå¦‚æœæœ‰æ–°è®°å½•æ’å…¥åˆ°è¡¨ä¸­çš„è¯ï¼Œå¯èƒ½æŠŠè¿™äº›è¢«åˆ é™¤çš„è®°å½•å ç”¨çš„å­˜å‚¨ç©ºé—´è¦†ç›–æ‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>å°†è¿™ä¸ªdelete_maskä½è®¾ç½®ä¸º1å’Œå°†è¢«åˆ é™¤çš„è®°å½•åŠ å…¥åˆ°åƒåœ¾é“¾è¡¨ä¸­å…¶å®æ˜¯ä¸¤ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬åè¾¹åœ¨ä»‹ç»äº‹åŠ¡çš„æ—¶å€™ä¼šè¯¦ç»†å” å¨åˆ é™¤æ“ä½œçš„è¯¦ç»†è¿‡ç¨‹ï¼Œç¨å®‰å‹¿èºã€‚<br></code></pre></td></tr></table></figure></li><li><p><code>min_rec_mask</code></p><p>B+æ ‘çš„æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°ï¼Œä»€ä¹ˆæ˜¯ä¸ª<code>B+</code>æ ‘ï¼Ÿä»€ä¹ˆæ˜¯ä¸ªéå¶å­èŠ‚ç‚¹ï¼Ÿå¥½å§ï¼Œç­‰ä¼šå†èŠè¿™ä¸ªé—®é¢˜ã€‚åæ­£æˆ‘ä»¬è‡ªå·±æ’å…¥çš„å››æ¡è®°å½•çš„<code>min_rec_mask</code>å€¼éƒ½æ˜¯<code>0</code>ï¼Œæ„å‘³ç€å®ƒä»¬éƒ½ä¸æ˜¯<code>B+</code>æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•ã€‚</p></li><li><p><code>n_owned</code></p><p>è¿™ä¸ªæš‚æ—¶ä¿å¯†ï¼Œç¨åå®ƒæ˜¯ä¸»è§’ï½</p></li><li><p><code>heap_no</code></p><p>è¿™ä¸ªå±æ€§è¡¨ç¤ºå½“å‰è®°å½•åœ¨æœ¬<code>é¡µ</code>ä¸­çš„ä½ç½®ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬æ’å…¥çš„4æ¡è®°å½•åœ¨æœ¬<code>é¡µ</code>ä¸­çš„ä½ç½®åˆ†åˆ«æ˜¯ï¼š<code>2</code>ã€<code>3</code>ã€<code>4</code>ã€<code>5</code>ã€‚æ˜¯ä¸æ˜¯å°‘äº†ç‚¹å•¥ï¼Ÿæ˜¯çš„ï¼Œæ€ä¹ˆä¸è§<code>heap_no</code>å€¼ä¸º<code>0</code>å’Œ<code>1</code>çš„è®°å½•å‘¢ï¼Ÿ</p><p>è¿™å…¶å®æ˜¯è®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬ç©çš„ä¸€ä¸ªå°æŠŠæˆï¼Œä»–ä»¬è‡ªåŠ¨ç»™æ¯ä¸ªé¡µé‡Œè¾¹å„¿åŠ äº†ä¸¤ä¸ªè®°å½•ï¼Œç”±äºè¿™ä¸¤ä¸ªè®°å½•å¹¶ä¸æ˜¯æˆ‘ä»¬è‡ªå·±æ’å…¥çš„ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ä¹Ÿç§°ä¸º<code>ä¼ªè®°å½•</code>æˆ–è€…<code>è™šæ‹Ÿè®°å½•</code>ã€‚è¿™ä¸¤ä¸ªä¼ªè®°å½•ä¸€ä¸ªä»£è¡¨<code>æœ€å°è®°å½•</code>ï¼Œä¸€ä¸ªä»£è¡¨<code>æœ€å¤§è®°å½•</code>ï¼Œç­‰ä¸€ä¸‹å“ˆ~ï¼Œè®°å½•å¯ä»¥æ¯”å¤§å°ä¹ˆï¼Ÿ</p><p>æ˜¯çš„ï¼Œè®°å½•ä¹Ÿå¯ä»¥æ¯”å¤§å°ï¼Œå¯¹äºä¸€æ¡å®Œæ•´çš„è®°å½•æ¥è¯´ï¼Œæ¯”è¾ƒè®°å½•çš„å¤§å°å°±æ˜¯æ¯”è¾ƒ<code>ä¸»é”®</code>çš„å¤§å°ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æ’å…¥çš„4è¡Œè®°å½•çš„ä¸»é”®å€¼åˆ†åˆ«æ˜¯ï¼š<code>1</code>ã€<code>2</code>ã€<code>3</code>ã€<code>4</code>ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€è¿™4æ¡è®°å½•çš„å¤§å°ä»å°åˆ°å¤§ä¾æ¬¡é€’å¢ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>è¯·æ³¨æ„æˆ‘å¼ºè°ƒäº†å¯¹äº`ä¸€æ¡å®Œæ•´çš„è®°å½•`æ¥è¯´ï¼Œæ¯”è¾ƒè®°å½•çš„å¤§å°å°±ç›¸å½“äºæ¯”çš„æ˜¯ä¸»é”®çš„å¤§å°ã€‚åè¾¹æˆ‘ä»¬è¿˜ä¼šä»‹ç»åªå­˜å‚¨ä¸€æ¡è®°å½•çš„éƒ¨åˆ†åˆ—çš„æƒ…å†µï¼Œæ•¬è¯·æœŸå¾…ï½<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸ç®¡æˆ‘ä»¬å‘<code>é¡µ</code>ä¸­æ’å…¥äº†å¤šå°‘è‡ªå·±çš„è®°å½•ï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬éƒ½è§„å®šä»–ä»¬å®šä¹‰çš„ä¸¤æ¡ä¼ªè®°å½•åˆ†åˆ«ä¸ºæœ€å°è®°å½•ä¸æœ€å¤§è®°å½•ã€‚è¿™ä¸¤æ¡è®°å½•çš„æ„é€ ååˆ†ç®€å•ï¼Œéƒ½æ˜¯ç”±5å­—èŠ‚å¤§å°çš„<code>è®°å½•å¤´ä¿¡æ¯</code>å’Œ8å­—èŠ‚å¤§å°çš„ä¸€ä¸ªå›ºå®šçš„éƒ¨åˆ†ç»„æˆçš„ï¼Œå¦‚å›¾æ‰€ç¤º</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c100ff0ccc2~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9ra45eam7t1mil9o1h3ucqdhv.png-50.4kB"><p>ç”±äºè¿™ä¸¤æ¡è®°å½•ä¸æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„è®°å½•ï¼Œæ‰€ä»¥å®ƒä»¬å¹¶ä¸å­˜æ”¾åœ¨<code>é¡µ</code>çš„<code>User Records</code>éƒ¨åˆ†ï¼Œä»–ä»¬è¢«å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç§°ä¸º<code>Infimum + Supremum</code>çš„éƒ¨åˆ†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c10773d8cee~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1c9qs1mn2t3j1nt344116nk15uf2p.png-119.7kB"><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œæœ€å°è®°å½•å’Œæœ€å¤§è®°å½•çš„<code>heap_no</code>å€¼åˆ†åˆ«æ˜¯<code>0</code>å’Œ<code>1</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬çš„ä½ç½®æœ€é å‰ã€‚</p></li><li><p><code>record_type</code></p><p>è¿™ä¸ªå±æ€§è¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œä¸€å…±æœ‰4ç§ç±»å‹çš„è®°å½•ï¼Œ<code>0</code>è¡¨ç¤ºæ™®é€šè®°å½•ï¼Œ<code>1</code>è¡¨ç¤ºB+æ ‘éå¶èŠ‚ç‚¹è®°å½•ï¼Œ<code>2</code>è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ<code>3</code>è¡¨ç¤ºæœ€å¤§è®°å½•ã€‚ä»å›¾ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬è‡ªå·±æ’å…¥çš„è®°å½•å°±æ˜¯æ™®é€šè®°å½•ï¼Œå®ƒä»¬çš„<code>record_type</code>å€¼éƒ½æ˜¯<code>0</code>ï¼Œè€Œæœ€å°è®°å½•å’Œæœ€å¤§è®°å½•çš„<code>record_type</code>å€¼åˆ†åˆ«ä¸º<code>2</code>å’Œ<code>3</code>ã€‚</p><p>è‡³äº<code>record_type</code>ä¸º<code>1</code>çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¹‹ååœ¨è¯´ç´¢å¼•çš„æ—¶å€™ä¼šé‡ç‚¹å¼ºè°ƒçš„ã€‚</p></li><li><p><code>next_record</code></p><p>è¿™ç©æ„å„¿éå¸¸é‡è¦ï¼Œå®ƒ**è¡¨ç¤ºä»å½“å‰è®°å½•çš„çœŸå®æ•°æ®åˆ°ä¸‹ä¸€æ¡è®°å½•çš„çœŸå®æ•°æ®çš„åœ°å€åç§»é‡ã€‚**æ¯”æ–¹è¯´ç¬¬ä¸€æ¡è®°å½•çš„<code>next_record</code>å€¼ä¸º<code>32</code>ï¼Œæ„å‘³ç€ä»ç¬¬ä¸€æ¡è®°å½•çš„çœŸå®æ•°æ®çš„åœ°å€å¤„å‘åæ‰¾<code>32</code>ä¸ªå­—èŠ‚ä¾¿æ˜¯ä¸‹ä¸€æ¡è®°å½•çš„çœŸå®æ•°æ®ã€‚å¦‚æœä½ ç†Ÿæ‚‰æ•°æ®ç»“æ„çš„è¯ï¼Œå°±ç«‹å³æ˜ç™½äº†ï¼Œè¿™å…¶å®æ˜¯ä¸ª<code>é“¾è¡¨</code>ï¼Œå¯ä»¥é€šè¿‡ä¸€æ¡è®°å½•æ‰¾åˆ°å®ƒçš„ä¸‹ä¸€æ¡è®°å½•ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„æ³¨æ„å†æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œ<code>ä¸‹ä¸€æ¡è®°å½•</code>æŒ‡å¾—å¹¶ä¸æ˜¯æŒ‰ç…§æˆ‘ä»¬æ’å…¥é¡ºåºçš„ä¸‹ä¸€æ¡è®°å½•ï¼Œè€Œæ˜¯æŒ‰ç…§ä¸»é”®å€¼ç”±å°åˆ°å¤§çš„é¡ºåºçš„ä¸‹ä¸€æ¡è®°å½•ã€‚è€Œä¸”è§„å®š <em><strong>Infimumè®°å½•ï¼ˆä¹Ÿå°±æ˜¯æœ€å°è®°å½•ï¼‰</strong></em> çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯æœ¬é¡µä¸­ä¸»é”®å€¼æœ€å°çš„ç”¨æˆ·è®°å½•ï¼Œè€Œæœ¬é¡µä¸­ä¸»é”®å€¼æœ€å¤§çš„ç”¨æˆ·è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯ <em><strong>Supremumè®°å½•ï¼ˆä¹Ÿå°±æ˜¯æœ€å¤§è®°å½•ï¼‰</strong></em> ï¼Œä¸ºäº†æ›´å½¢è±¡çš„è¡¨ç¤ºä¸€ä¸‹è¿™ä¸ª<code>next_record</code>èµ·åˆ°çš„ä½œç”¨ï¼Œæˆ‘ä»¬ç”¨ç®­å¤´æ¥æ›¿ä»£ä¸€ä¸‹<code>next_record</code>ä¸­çš„åœ°å€åç§»é‡ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c1084c440b4~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cot1r96210ph1jng1td41ouj85c13.png-120.5kB"><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬çš„è®°å½•æŒ‰ç…§ä¸»é”®ä»å°åˆ°å¤§çš„é¡ºåºå½¢æˆäº†ä¸€ä¸ªå•é“¾è¡¨ã€‚<code>æœ€å¤§è®°å½•</code>çš„<code>next_record</code>çš„å€¼ä¸º<code>0</code>ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´æœ€å¤§è®°å½•æ˜¯æ²¡æœ‰<code>ä¸‹ä¸€æ¡è®°å½•</code>äº†ï¼Œå®ƒæ˜¯è¿™ä¸ªå•é“¾è¡¨ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœä»ä¸­åˆ é™¤æ‰ä¸€æ¡è®°å½•ï¼Œè¿™ä¸ªé“¾è¡¨ä¹Ÿæ˜¯ä¼šè·Ÿç€å˜åŒ–çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠç¬¬2æ¡è®°å½•åˆ æ‰ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; DELETE FROM page_demo WHERE c<span class="hljs-number">1</span> = <span class="hljs-number">2</span>;<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">1</span> row affected (<span class="hljs-number">0</span>.<span class="hljs-number">02</span> sec)<br></code></pre></td></tr></table></figure><p>åˆ æ‰ç¬¬2æ¡è®°å½•åçš„ç¤ºæ„å›¾å°±æ˜¯ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c108ee1da43~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cul8slbp1om0p31b3u1be11gco9.png-119.6kB"><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œåˆ é™¤ç¬¬2æ¡è®°å½•å‰åä¸»è¦å‘ç”Ÿäº†è¿™äº›å˜åŒ–ï¼š</p><ul><li>ç¬¬2æ¡è®°å½•å¹¶æ²¡æœ‰ä»å­˜å‚¨ç©ºé—´ä¸­ç§»é™¤ï¼Œè€Œæ˜¯æŠŠè¯¥æ¡è®°å½•çš„<code>delete_mask</code>å€¼è®¾ç½®ä¸º<code>1</code>ã€‚</li><li>ç¬¬2æ¡è®°å½•çš„<code>next_record</code>å€¼å˜ä¸ºäº†0ï¼Œæ„å‘³ç€è¯¥è®°å½•æ²¡æœ‰ä¸‹ä¸€æ¡è®°å½•äº†ã€‚</li><li>ç¬¬1æ¡è®°å½•çš„<code>next_record</code>æŒ‡å‘äº†ç¬¬3æ¡è®°å½•ã€‚</li><li>è¿˜æœ‰ä¸€ç‚¹ä½ å¯èƒ½å¿½ç•¥äº†ï¼Œå°±æ˜¯<code>æœ€å¤§è®°å½•</code>çš„<code>n_owned</code>å€¼ä»<code>5</code>å˜æˆäº†<code>4</code>ï¼Œå…³äºè¿™ä¸€ç‚¹çš„å˜åŒ–æˆ‘ä»¬ç¨åä¼šè¯¦ç»†è¯´æ˜çš„ã€‚</li></ul><p>æ‰€ä»¥ï¼Œä¸è®ºæˆ‘ä»¬æ€ä¹ˆå¯¹é¡µä¸­çš„è®°å½•åšå¢åˆ æ”¹æ“ä½œï¼ŒInnoDBå§‹ç»ˆä¼šç»´æŠ¤ä¸€æ¡è®°å½•çš„å•é“¾è¡¨ï¼Œé“¾è¡¨ä¸­çš„å„ä¸ªèŠ‚ç‚¹æ˜¯æŒ‰ç…§ä¸»é”®å€¼ç”±å°åˆ°å¤§çš„é¡ºåºè¿æ¥èµ·æ¥çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>ä½ ä¼šä¸ä¼šè§‰å¾—next_recordè¿™ä¸ªæŒ‡é’ˆæœ‰ç‚¹å„¿æ€ªï¼Œä¸ºå•¥è¦æŒ‡å‘è®°å½•å¤´ä¿¡æ¯å’ŒçœŸå®æ•°æ®ä¹‹é—´çš„ä½ç½®å‘¢ï¼Ÿä¸ºå•¥ä¸å¹²è„†æŒ‡å‘æ•´æ¡è®°å½•çš„å¼€å¤´ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è®°å½•çš„é¢å¤–ä¿¡æ¯å¼€å¤´çš„ä½ç½®å‘¢ï¼Ÿ<br><br>å› ä¸ºè¿™ä¸ªä½ç½®åˆšåˆšå¥½ï¼Œå‘å·¦è¯»å–å°±æ˜¯è®°å½•å¤´ä¿¡æ¯ï¼Œå‘å³è¯»å–å°±æ˜¯çœŸå®æ•°æ®ã€‚æˆ‘ä»¬å‰è¾¹è¿˜è¯´è¿‡å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€NULLå€¼åˆ—è¡¨ä¸­çš„ä¿¡æ¯éƒ½æ˜¯é€†åºå­˜æ”¾ï¼Œè¿™æ ·å¯ä»¥ä½¿è®°å½•ä¸­ä½ç½®é å‰çš„å­—æ®µå’Œå®ƒä»¬å¯¹åº”çš„å­—æ®µé•¿åº¦ä¿¡æ¯åœ¨å†…å­˜ä¸­çš„è·ç¦»æ›´è¿‘ï¼Œå¯èƒ½ä¼šæé«˜é«˜é€Ÿç¼“å­˜çš„å‘½ä¸­ç‡ã€‚å½“ç„¶å¦‚æœä½ çœ‹ä¸æ‡‚è¿™å¥è¯çš„è¯å°±ä¸è¦å‹‰å¼ºäº†ï¼Œæœæ–­è·³è¿‡ï½<br></code></pre></td></tr></table></figure></li></ul><p>å†æ¥çœ‹ä¸€ä¸ªæœ‰æ„æ€çš„äº‹æƒ…ï¼Œå› ä¸ºä¸»é”®å€¼ä¸º<code>2</code>çš„è®°å½•è¢«æˆ‘ä»¬åˆ æ‰äº†ï¼Œä½†æ˜¯å­˜å‚¨ç©ºé—´å´æ²¡æœ‰å›æ”¶ï¼Œå¦‚æœæˆ‘ä»¬å†æ¬¡æŠŠè¿™æ¡è®°å½•æ’å…¥åˆ°è¡¨ä¸­ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆäº‹å‘¢ï¼Ÿ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> page_demo <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">2</span>, <span class="hljs-number">200</span>, <span class="hljs-string">&#x27;bbbb&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è®°å½•çš„å­˜å‚¨æƒ…å†µï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c109f25d55d~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cot2j9n94a511jd15clrrfp6p1t.png-137.8kB"><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<code>InnoDB</code>å¹¶æ²¡æœ‰å› ä¸ºæ–°è®°å½•çš„æ’å…¥è€Œä¸ºå®ƒç”³è¯·æ–°çš„å­˜å‚¨ç©ºé—´ï¼Œè€Œæ˜¯ç›´æ¥å¤ç”¨äº†åŸæ¥è¢«åˆ é™¤è®°å½•çš„å­˜å‚¨ç©ºé—´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>å½“æ•°æ®é¡µä¸­å­˜åœ¨å¤šæ¡è¢«åˆ é™¤æ‰çš„è®°å½•æ—¶ï¼Œè¿™äº›è®°å½•çš„next_recordå±æ€§å°†ä¼šæŠŠè¿™äº›è¢«åˆ é™¤æ‰çš„è®°å½•ç»„æˆä¸€ä¸ªåƒåœ¾é“¾è¡¨ï¼Œä»¥å¤‡ä¹‹åé‡ç”¨è¿™éƒ¨åˆ†å­˜å‚¨ç©ºé—´ã€‚<br></code></pre></td></tr></table></figure><h2 id="Page-Directoryï¼ˆé¡µç›®å½•ï¼‰">Page Directoryï¼ˆé¡µç›®å½•ï¼‰</h2><p>ç°åœ¨æˆ‘ä»¬äº†è§£äº†è®°å½•åœ¨é¡µä¸­æŒ‰ç…§ä¸»é”®å€¼ç”±å°åˆ°å¤§é¡ºåºä¸²è”æˆä¸€ä¸ªå•é“¾è¡¨ï¼Œé‚£å¦‚æœæˆ‘ä»¬æƒ³æ ¹æ®ä¸»é”®å€¼æŸ¥æ‰¾é¡µä¸­çš„æŸæ¡è®°å½•è¯¥å’‹åŠå‘¢ï¼Ÿæ¯”å¦‚è¯´è¿™æ ·çš„æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> page_demo <span class="hljs-keyword">WHERE</span> c1 = <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure><p>æœ€ç¬¨çš„åŠæ³•ï¼šä»<code>Infimum</code>è®°å½•ï¼ˆæœ€å°è®°å½•ï¼‰å¼€å§‹ï¼Œæ²¿ç€é“¾è¡¨ä¸€ç›´å¾€åæ‰¾ï¼Œæ€»æœ‰ä¸€å¤©ä¼šæ‰¾åˆ°ï¼ˆæˆ–è€…æ‰¾ä¸åˆ°[æ‘Šæ‰‹]ï¼‰ï¼Œåœ¨æ‰¾çš„æ—¶å€™è¿˜èƒ½æŠ•æœºå–å·§ï¼Œå› ä¸ºé“¾è¡¨ä¸­å„ä¸ªè®°å½•çš„å€¼æ˜¯æŒ‰ç…§ä»å°åˆ°å¤§é¡ºåºæ’åˆ—çš„ï¼Œæ‰€ä»¥å½“é“¾è¡¨çš„æŸä¸ªèŠ‚ç‚¹ä»£è¡¨çš„è®°å½•çš„ä¸»é”®å€¼å¤§äºä½ æƒ³è¦æŸ¥æ‰¾çš„ä¸»é”®å€¼æ—¶ï¼Œä½ å°±å¯ä»¥åœæ­¢æŸ¥æ‰¾äº†ï¼Œå› ä¸ºè¯¥èŠ‚ç‚¹åè¾¹çš„èŠ‚ç‚¹çš„ä¸»é”®å€¼ä¾æ¬¡é€’å¢ã€‚</p><p>è¿™ä¸ªæ–¹æ³•åœ¨é¡µä¸­å­˜å‚¨çš„è®°å½•æ•°é‡æ¯”è¾ƒå°‘çš„æƒ…å†µç”¨èµ·æ¥ä¹Ÿæ²¡å•¥é—®é¢˜ï¼Œæ¯”æ–¹è¯´ç°åœ¨æˆ‘ä»¬çš„è¡¨é‡Œåªæœ‰<code>4</code>æ¡è‡ªå·±æ’å…¥çš„è®°å½•ï¼Œæ‰€ä»¥æœ€å¤šæ‰¾<code>4</code>æ¬¡å°±å¯ä»¥æŠŠæ‰€æœ‰è®°å½•éƒ½éå†ä¸€éï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªé¡µä¸­å­˜å‚¨äº†éå¸¸å¤šçš„è®°å½•ï¼Œè¿™ä¹ˆæŸ¥æ‰¾å¯¹æ€§èƒ½æ¥è¯´è¿˜æ˜¯æœ‰æŸè€—çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯´è¿™ç§éå†æŸ¥æ‰¾è¿™æ˜¯ä¸€ä¸ª<code>ç¬¨</code>åŠæ³•ã€‚ä½†æ˜¯è®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬æ˜¯ä»€ä¹ˆäººï¼Œä»–ä»¬èƒ½ç”¨è¿™ä¹ˆç¬¨çš„åŠæ³•ä¹ˆï¼Œå½“ç„¶æ˜¯è¦è®¾è®¡ä¸€ç§æ›´6çš„æŸ¥æ‰¾æ–¹å¼å–½ï¼Œä»–ä»¬ä»ä¹¦çš„ç›®å½•ä¸­æ‰¾åˆ°äº†çµæ„Ÿã€‚</p><p>æˆ‘ä»¬å¹³å¸¸æƒ³ä»ä¸€æœ¬ä¹¦ä¸­æŸ¥æ‰¾æŸä¸ªå†…å®¹çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå…ˆçœ‹ç›®å½•ï¼Œæ‰¾åˆ°éœ€è¦æŸ¥æ‰¾çš„å†…å®¹å¯¹åº”çš„ä¹¦çš„é¡µç ï¼Œç„¶ååˆ°å¯¹åº”çš„é¡µç æŸ¥çœ‹å†…å®¹ã€‚è®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬ä¸ºæˆ‘ä»¬çš„è®°å½•ä¹Ÿåˆ¶ä½œäº†ä¸€ä¸ªç±»ä¼¼çš„ç›®å½•ï¼Œä»–ä»¬çš„åˆ¶ä½œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>å°†æ‰€æœ‰æ­£å¸¸çš„è®°å½•ï¼ˆåŒ…æ‹¬æœ€å¤§å’Œæœ€å°è®°å½•ï¼Œä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½•ï¼‰åˆ’åˆ†ä¸ºå‡ ä¸ªç»„ã€‚</li><li>æ¯ä¸ªç»„çš„æœ€åä¸€æ¡è®°å½•ï¼ˆä¹Ÿå°±æ˜¯ç»„å†…æœ€å¤§çš„é‚£æ¡è®°å½•ï¼‰çš„å¤´ä¿¡æ¯ä¸­çš„<code>n_owned</code>å±æ€§è¡¨ç¤ºè¯¥è®°å½•æ‹¥æœ‰å¤šå°‘æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯¥ç»„å†…å…±æœ‰å‡ æ¡è®°å½•ã€‚</li><li>å°†æ¯ä¸ªç»„çš„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡å•ç‹¬æå–å‡ºæ¥æŒ‰é¡ºåºå­˜å‚¨åˆ°é è¿‘<code>é¡µ</code>çš„å°¾éƒ¨çš„åœ°æ–¹ï¼Œè¿™ä¸ªåœ°æ–¹å°±æ˜¯æ‰€è°“çš„<code>Page Directory</code>ï¼Œä¹Ÿå°±æ˜¯<code>é¡µç›®å½•</code>ï¼ˆæ­¤æ—¶åº”è¯¥è¿”å›å¤´çœ‹çœ‹é¡µé¢å„ä¸ªéƒ¨åˆ†çš„å›¾ï¼‰ã€‚é¡µé¢ç›®å½•ä¸­çš„è¿™äº›åœ°å€åç§»é‡è¢«ç§°ä¸º<code>æ§½</code>ï¼ˆè‹±æ–‡åï¼š<code>Slot</code>ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªé¡µé¢ç›®å½•å°±æ˜¯ç”±<code>æ§½</code>ç»„æˆçš„ã€‚</li></ol><p>æ¯”æ–¹è¯´ç°åœ¨çš„<code>page_demo</code>è¡¨ä¸­æ­£å¸¸çš„è®°å½•å…±æœ‰6æ¡ï¼Œ<code>InnoDB</code>ä¼šæŠŠå®ƒä»¬åˆ†æˆä¸¤ç»„ï¼Œç¬¬ä¸€ç»„ä¸­åªæœ‰ä¸€ä¸ªæœ€å°è®°å½•ï¼Œç¬¬äºŒç»„ä¸­æ˜¯å‰©ä½™çš„5æ¡è®°å½•ï¼Œçœ‹ä¸‹è¾¹çš„ç¤ºæ„å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c10c57164a6~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1couapvdmb5mvm1i0l5m0vcb2a.png-128.2kB"><p>ä»è¿™ä¸ªå›¾ä¸­æˆ‘ä»¬éœ€è¦æ³¨æ„è¿™ä¹ˆå‡ ç‚¹ï¼š</p><ul><li>ç°åœ¨<code>é¡µç›®å½•</code>éƒ¨åˆ†ä¸­æœ‰ä¸¤ä¸ªæ§½ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬çš„è®°å½•è¢«åˆ†æˆäº†ä¸¤ä¸ªç»„ï¼Œ<code>æ§½1</code>ä¸­çš„å€¼æ˜¯<code>112</code>ï¼Œä»£è¡¨æœ€å¤§è®°å½•çš„åœ°å€åç§»é‡ï¼ˆå°±æ˜¯ä»é¡µé¢çš„0å­—èŠ‚å¼€å§‹æ•°ï¼Œæ•°112ä¸ªå­—èŠ‚ï¼‰ï¼›<code>æ§½0</code>ä¸­çš„å€¼æ˜¯<code>99</code>ï¼Œä»£è¡¨æœ€å°è®°å½•çš„åœ°å€åç§»é‡ã€‚</li><li>æ³¨æ„æœ€å°å’Œæœ€å¤§è®°å½•çš„å¤´ä¿¡æ¯ä¸­çš„<code>n_owned</code>å±æ€§<ul><li>æœ€å°è®°å½•çš„<code>n_owned</code>å€¼ä¸º<code>1</code>ï¼Œè¿™å°±ä»£è¡¨ç€ä»¥æœ€å°è®°å½•ç»“å°¾çš„è¿™ä¸ªåˆ†ç»„ä¸­åªæœ‰<code>1</code>æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯æœ€å°è®°å½•æœ¬èº«ã€‚</li><li>æœ€å¤§è®°å½•çš„<code>n_owned</code>å€¼ä¸º<code>5</code>ï¼Œè¿™å°±ä»£è¡¨ç€ä»¥æœ€å¤§è®°å½•ç»“å°¾çš„è¿™ä¸ªåˆ†ç»„ä¸­åªæœ‰<code>5</code>æ¡è®°å½•ï¼ŒåŒ…æ‹¬æœ€å¤§è®°å½•æœ¬èº«è¿˜æœ‰æˆ‘ä»¬è‡ªå·±æ’å…¥çš„<code>4</code>æ¡è®°å½•ã€‚</li></ul></li></ul><p><code>99</code>å’Œ<code>112</code>è¿™æ ·çš„åœ°å€åç§»é‡å¾ˆä¸ç›´è§‚ï¼Œæˆ‘ä»¬ç”¨ç®­å¤´æŒ‡å‘çš„æ–¹å¼æ›¿ä»£æ•°å­—</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c10f2e61ad5~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1couate3jr19gc18gl1cva1fcg34.png-100.8kB"><p>è¿™æ ·çœ‹å°±é¡ºçœ¼å¤šäº†å˜›ï¼ä¸ºä»€ä¹ˆæœ€å°è®°å½•çš„<code>n_owned</code>å€¼ä¸º1ï¼Œè€Œæœ€å¤§è®°å½•çš„<code>n_owned</code>å€¼ä¸º<code>5</code>å‘¢ï¼Œè¿™é‡Œå¤´æœ‰ä»€ä¹ˆçŒ«è…»ä¹ˆï¼Ÿ</p><p>æ˜¯çš„ï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬å¯¹æ¯ä¸ªåˆ†ç»„ä¸­çš„è®°å½•æ¡æ•°æ˜¯æœ‰è§„å®šçš„ï¼š<strong>å¯¹äºæœ€å°è®°å½•æ‰€åœ¨çš„åˆ†ç»„åªèƒ½æœ‰ <em>1</em> æ¡è®°å½•ï¼Œæœ€å¤§è®°å½•æ‰€åœ¨çš„åˆ†ç»„æ‹¥æœ‰çš„è®°å½•æ¡æ•°åªèƒ½åœ¨ <em>1~8</em> æ¡ä¹‹é—´ï¼Œå‰©ä¸‹çš„åˆ†ç»„ä¸­è®°å½•çš„æ¡æ•°èŒƒå›´åªèƒ½åœ¨æ˜¯ <em>4~8</em> æ¡ä¹‹é—´</strong>ã€‚æ‰€ä»¥åˆ†ç»„æ˜¯æŒ‰ç…§ä¸‹è¾¹çš„æ­¥éª¤è¿›è¡Œçš„ï¼š</p><ul><li>åˆå§‹æƒ…å†µä¸‹ä¸€ä¸ªæ•°æ®é¡µé‡Œåªæœ‰æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•ä¸¤æ¡è®°å½•ï¼Œå®ƒä»¬åˆ†å±äºä¸¤ä¸ªåˆ†ç»„ã€‚</li><li>ä¹‹åæ¯æ’å…¥ä¸€æ¡è®°å½•ï¼Œéƒ½ä¼šä»<code>é¡µç›®å½•</code>ä¸­æ‰¾åˆ°ä¸»é”®å€¼æ¯”æœ¬è®°å½•çš„ä¸»é”®å€¼å¤§å¹¶ä¸”å·®å€¼æœ€å°çš„æ§½ï¼Œç„¶åæŠŠè¯¥æ§½å¯¹åº”çš„è®°å½•çš„<code>n_owned</code>å€¼åŠ 1ï¼Œè¡¨ç¤ºæœ¬ç»„å†…åˆæ·»åŠ äº†ä¸€æ¡è®°å½•ï¼Œç›´åˆ°è¯¥ç»„ä¸­çš„è®°å½•æ•°ç­‰äº8ä¸ªã€‚</li><li>åœ¨ä¸€ä¸ªç»„ä¸­çš„è®°å½•æ•°ç­‰äº8ä¸ªåå†æ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼Œä¼šå°†ç»„ä¸­çš„è®°å½•æ‹†åˆ†æˆä¸¤ä¸ªç»„ï¼Œä¸€ä¸ªç»„ä¸­4æ¡è®°å½•ï¼Œå¦ä¸€ä¸ª5æ¡è®°å½•ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šåœ¨<code>é¡µç›®å½•</code>ä¸­æ–°å¢ä¸€ä¸ª<code>æ§½</code>æ¥è®°å½•è¿™ä¸ªæ–°å¢åˆ†ç»„ä¸­æœ€å¤§çš„é‚£æ¡è®°å½•çš„åç§»é‡ã€‚</li></ul><p>ç”±äºç°åœ¨<code>page_demo</code>è¡¨ä¸­çš„è®°å½•å¤ªå°‘ï¼Œæ— æ³•æ¼”ç¤ºæ·»åŠ äº†<code>é¡µç›®å½•</code>ä¹‹ååŠ å¿«æŸ¥æ‰¾é€Ÿåº¦çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å†å¾€<code>page_demo</code>è¡¨ä¸­æ·»åŠ ä¸€äº›è®°å½•ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; INSERT INTO page_demo VALUES(<span class="hljs-number">5</span>, <span class="hljs-number">500</span>, &#x27;eeee&#x27;), (<span class="hljs-number">6</span>, <span class="hljs-number">600</span>, &#x27;ffff&#x27;), (<span class="hljs-number">7</span>, <span class="hljs-number">700</span>, &#x27;gggg&#x27;), (<span class="hljs-number">8</span>, <span class="hljs-number">800</span>, &#x27;hhhh&#x27;), (<span class="hljs-number">9</span>, <span class="hljs-number">900</span>, &#x27;iiii&#x27;), (<span class="hljs-number">10</span>, <span class="hljs-number">1000</span>, &#x27;jjjj&#x27;), (<span class="hljs-number">11</span>, <span class="hljs-number">1100</span>, &#x27;kkkk&#x27;), (<span class="hljs-number">12</span>, <span class="hljs-number">1200</span>, &#x27;llll&#x27;), (<span class="hljs-number">13</span>, <span class="hljs-number">1300</span>, &#x27;mmmm&#x27;), (<span class="hljs-number">14</span>, <span class="hljs-number">1400</span>, &#x27;nnnn&#x27;), (<span class="hljs-number">15</span>, <span class="hljs-number">1500</span>, &#x27;oooo&#x27;), (<span class="hljs-number">16</span>, <span class="hljs-number">1600</span>, &#x27;pppp&#x27;);<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">12</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)<br><span class="hljs-attribute">Records</span>: <span class="hljs-number">12</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>å“ˆï¼Œæˆ‘ä»¬ä¸€å£æ°”åˆå¾€è¡¨ä¸­æ·»åŠ äº†12æ¡è®°å½•ï¼Œç°åœ¨é¡µé‡Œè¾¹å°±ä¸€å…±æœ‰18æ¡è®°å½•äº†ï¼ˆåŒ…æ‹¬æœ€å°å’Œæœ€å¤§è®°å½•ï¼‰ï¼Œè¿™äº›è®°å½•è¢«åˆ†æˆäº†5ä¸ªç»„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c10e3449897~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1d6g64af2sgj1816ktl1q22dehp.png-189.1kB"><p>å› ä¸ºæŠŠ16æ¡è®°å½•çš„å…¨éƒ¨ä¿¡æ¯éƒ½ç”»åœ¨ä¸€å¼ å›¾é‡Œå¤ªå åœ°æ–¹ï¼Œè®©äººçœ¼èŠ±ç¼­ä¹±çš„ï¼Œæ‰€ä»¥åªä¿ç•™äº†ç”¨æˆ·è®°å½•å¤´ä¿¡æ¯ä¸­çš„<code>n_owned</code>å’Œ<code>next_record</code>å±æ€§ï¼Œä¹Ÿçœç•¥äº†å„ä¸ªè®°å½•ä¹‹é—´çš„ç®­å¤´ï¼Œæˆ‘æ²¡ç”»ä¸ç­‰äºæ²¡æœ‰å•Šï¼ç°åœ¨çœ‹æ€ä¹ˆä»è¿™ä¸ª<code>é¡µç›®å½•</code>ä¸­æŸ¥æ‰¾è®°å½•ã€‚å› ä¸ºå„ä¸ªæ§½ä»£è¡¨çš„è®°å½•çš„ä¸»é”®å€¼éƒ½æ˜¯ä»å°åˆ°å¤§æ’åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ‰€è°“çš„<code>äºŒåˆ†æ³•</code>æ¥è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾ã€‚5ä¸ªæ§½çš„ç¼–å·åˆ†åˆ«æ˜¯ï¼š<code>0</code>ã€<code>1</code>ã€<code>2</code>ã€<code>3</code>ã€<code>4</code>ï¼Œæ‰€ä»¥åˆå§‹æƒ…å†µä¸‹æœ€ä½çš„æ§½å°±æ˜¯<code>low=0</code>ï¼Œæœ€é«˜çš„æ§½å°±æ˜¯<code>high=4</code>ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³æ‰¾ä¸»é”®å€¼ä¸º<code>6</code>çš„è®°å½•ï¼Œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>è®¡ç®—ä¸­é—´æ§½çš„ä½ç½®ï¼š<code>(0+4)/2=2</code>ï¼Œæ‰€ä»¥æŸ¥çœ‹<code>æ§½2</code>å¯¹åº”è®°å½•çš„ä¸»é”®å€¼ä¸º<code>8</code>ï¼Œåˆå› ä¸º<code>8 &gt; 6</code>ï¼Œæ‰€ä»¥è®¾ç½®<code>high=2</code>ï¼Œ<code>low</code>ä¿æŒä¸å˜ã€‚</li><li>é‡æ–°è®¡ç®—ä¸­é—´æ§½çš„ä½ç½®ï¼š<code>(0+2)/2=1</code>ï¼Œæ‰€ä»¥æŸ¥çœ‹<code>æ§½1</code>å¯¹åº”çš„ä¸»é”®å€¼ä¸º<code>4</code>ï¼Œåˆå› ä¸º<code>4 &lt; 6</code>ï¼Œæ‰€ä»¥è®¾ç½®<code>low=1</code>ï¼Œ<code>high</code>ä¿æŒä¸å˜ã€‚</li><li>å› ä¸º<code>high - low</code>çš„å€¼ä¸º1ï¼Œæ‰€ä»¥ç¡®å®šä¸»é”®å€¼ä¸º<code>6</code>çš„è®°å½•åœ¨<code>æ§½2</code>å¯¹åº”çš„ç»„ä¸­ã€‚æ­¤åˆ»æˆ‘ä»¬éœ€è¦æ‰¾åˆ°<code>æ§½2</code>ä¸­ä¸»é”®å€¼æœ€å°çš„é‚£æ¡è®°å½•ï¼Œç„¶åæ²¿ç€å•å‘é“¾è¡¨éå†<code>æ§½2</code>ä¸­çš„è®°å½•ã€‚ä½†æ˜¯æˆ‘ä»¬å‰è¾¹åˆè¯´è¿‡ï¼Œæ¯ä¸ªæ§½å¯¹åº”çš„è®°å½•éƒ½æ˜¯è¯¥ç»„ä¸­ä¸»é”®å€¼æœ€å¤§çš„è®°å½•ï¼Œè¿™é‡Œ<code>æ§½2</code>å¯¹åº”çš„è®°å½•æ˜¯ä¸»é”®å€¼ä¸º<code>8</code>çš„è®°å½•ï¼Œæ€ä¹ˆå®šä½ä¸€ä¸ªç»„ä¸­æœ€å°çš„è®°å½•å‘¢ï¼Ÿåˆ«å¿˜äº†å„ä¸ªæ§½éƒ½æ˜¯æŒ¨ç€çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“çš„æ‹¿åˆ°<code>æ§½1</code>å¯¹åº”çš„è®°å½•ï¼ˆä¸»é”®å€¼ä¸º<code>4</code>ï¼‰ï¼Œè¯¥æ¡è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯<code>æ§½2</code>ä¸­ä¸»é”®å€¼æœ€å°çš„è®°å½•ï¼Œè¯¥è®°å½•çš„ä¸»é”®å€¼ä¸º<code>5</code>ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»è¿™æ¡ä¸»é”®å€¼ä¸º<code>5</code>çš„è®°å½•å‡ºå‘ï¼Œéå†<code>æ§½2</code>ä¸­çš„å„æ¡è®°å½•ï¼Œç›´åˆ°æ‰¾åˆ°ä¸»é”®å€¼ä¸º<code>6</code>çš„é‚£æ¡è®°å½•å³å¯ã€‚ç”±äºä¸€ä¸ªç»„ä¸­åŒ…å«çš„è®°å½•æ¡æ•°åªèƒ½æ˜¯1~8æ¡ï¼Œæ‰€ä»¥éå†ä¸€ä¸ªç»„ä¸­çš„è®°å½•çš„ä»£ä»·æ˜¯å¾ˆå°çš„ã€‚</li></ol><p>æ‰€ä»¥åœ¨ä¸€ä¸ªæ•°æ®é¡µä¸­æŸ¥æ‰¾æŒ‡å®šä¸»é”®å€¼çš„è®°å½•çš„è¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ol><li>é€šè¿‡äºŒåˆ†æ³•ç¡®å®šè¯¥è®°å½•æ‰€åœ¨çš„æ§½ï¼Œå¹¶æ‰¾åˆ°è¯¥æ§½æ‰€åœ¨åˆ†ç»„ä¸­ä¸»é”®å€¼æœ€å°çš„é‚£æ¡è®°å½•ã€‚</li><li>é€šè¿‡è®°å½•çš„<code>next_record</code>å±æ€§éå†è¯¥æ§½æ‰€åœ¨çš„ç»„ä¸­çš„å„ä¸ªè®°å½•ã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>å¦‚æœä½ ä¸çŸ¥é“äºŒåˆ†æ³•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œæ‰¾ä¸ªåŸºç¡€ç®—æ³•ä¹¦çœ‹çœ‹å§ã€‚ä»€ä¹ˆï¼Ÿç®—æ³•ä¹¦å†™çš„çœ‹ä¸æ‡‚ï¼Ÿç­‰æˆ‘ï½<br></code></pre></td></tr></table></figure><h2 id="Page-Headerï¼ˆé¡µé¢å¤´éƒ¨ï¼‰">Page Headerï¼ˆé¡µé¢å¤´éƒ¨ï¼‰</h2><p>è®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬ä¸ºäº†èƒ½å¾—åˆ°ä¸€ä¸ªæ•°æ®é¡µä¸­å­˜å‚¨çš„è®°å½•çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚æœ¬é¡µä¸­å·²ç»å­˜å‚¨äº†å¤šå°‘æ¡è®°å½•ï¼Œç¬¬ä¸€æ¡è®°å½•çš„åœ°å€æ˜¯ä»€ä¹ˆï¼Œé¡µç›®å½•ä¸­å­˜å‚¨äº†å¤šå°‘ä¸ªæ§½ç­‰ç­‰ï¼Œç‰¹æ„åœ¨é¡µä¸­å®šä¹‰äº†ä¸€ä¸ªå«<code>Page Header</code>çš„éƒ¨åˆ†ï¼Œå®ƒæ˜¯<code>é¡µ</code>ç»“æ„çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†å ç”¨å›ºå®šçš„<code>56</code>ä¸ªå­—èŠ‚ï¼Œä¸“é—¨å­˜å‚¨å„ç§çŠ¶æ€ä¿¡æ¯ï¼Œå…·ä½“å„ä¸ªå­—èŠ‚éƒ½æ˜¯å¹²å˜›çš„çœ‹ä¸‹è¡¨ï¼š</p><table><thead><tr><th>åç§°</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>PAGE_N_DIR_SLOTS</code></td><td><code>2</code>å­—èŠ‚</td><td>åœ¨é¡µç›®å½•ä¸­çš„æ§½æ•°é‡</td></tr><tr><td><code>PAGE_HEAP_TOP</code></td><td><code>2</code>å­—èŠ‚</td><td>è¿˜æœªä½¿ç”¨çš„ç©ºé—´æœ€å°åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ä»è¯¥åœ°å€ä¹‹åå°±æ˜¯<code>Free Space</code></td></tr><tr><td><code>PAGE_N_HEAP</code></td><td><code>2</code>å­—èŠ‚</td><td>æœ¬é¡µä¸­çš„è®°å½•çš„æ•°é‡ï¼ˆåŒ…æ‹¬æœ€å°å’Œæœ€å¤§è®°å½•ä»¥åŠæ ‡è®°ä¸ºåˆ é™¤çš„è®°å½•ï¼‰</td></tr><tr><td><code>PAGE_FREE</code></td><td><code>2</code>å­—èŠ‚</td><td>ç¬¬ä¸€ä¸ªå·²ç»æ ‡è®°ä¸ºåˆ é™¤çš„è®°å½•åœ°å€ï¼ˆå„ä¸ªå·²åˆ é™¤çš„è®°å½•é€šè¿‡<code>next_record</code>ä¹Ÿä¼šç»„æˆä¸€ä¸ªå•é“¾è¡¨ï¼Œè¿™ä¸ªå•é“¾è¡¨ä¸­çš„è®°å½•å¯ä»¥è¢«é‡æ–°åˆ©ç”¨ï¼‰</td></tr><tr><td><code>PAGE_GARBAGE</code></td><td><code>2</code>å­—èŠ‚</td><td>å·²åˆ é™¤è®°å½•å ç”¨çš„å­—èŠ‚æ•°</td></tr><tr><td><code>PAGE_LAST_INSERT</code></td><td><code>2</code>å­—èŠ‚</td><td>æœ€åæ’å…¥è®°å½•çš„ä½ç½®</td></tr><tr><td><code>PAGE_DIRECTION</code></td><td><code>2</code>å­—èŠ‚</td><td>è®°å½•æ’å…¥çš„æ–¹å‘</td></tr><tr><td><code>PAGE_N_DIRECTION</code></td><td><code>2</code>å­—èŠ‚</td><td>ä¸€ä¸ªæ–¹å‘è¿ç»­æ’å…¥çš„è®°å½•æ•°é‡</td></tr><tr><td><code>PAGE_N_RECS</code></td><td><code>2</code>å­—èŠ‚</td><td>è¯¥é¡µä¸­è®°å½•çš„æ•°é‡ï¼ˆä¸åŒ…æ‹¬æœ€å°å’Œæœ€å¤§è®°å½•ä»¥åŠè¢«æ ‡è®°ä¸ºåˆ é™¤çš„è®°å½•ï¼‰</td></tr><tr><td><code>PAGE_MAX_TRX_ID</code></td><td><code>8</code>å­—èŠ‚</td><td>ä¿®æ”¹å½“å‰é¡µçš„æœ€å¤§äº‹åŠ¡IDï¼Œè¯¥å€¼ä»…åœ¨äºŒçº§ç´¢å¼•ä¸­å®šä¹‰</td></tr><tr><td><code>PAGE_LEVEL</code></td><td><code>2</code>å­—èŠ‚</td><td>å½“å‰é¡µåœ¨B+æ ‘ä¸­æ‰€å¤„çš„å±‚çº§</td></tr><tr><td><code>PAGE_INDEX_ID</code></td><td><code>8</code>å­—èŠ‚</td><td>ç´¢å¼•IDï¼Œè¡¨ç¤ºå½“å‰é¡µå±äºå“ªä¸ªç´¢å¼•</td></tr><tr><td><code>PAGE_BTR_SEG_LEAF</code></td><td><code>10</code>å­—èŠ‚</td><td>B+æ ‘å¶å­æ®µçš„å¤´éƒ¨ä¿¡æ¯ï¼Œä»…åœ¨B+æ ‘çš„Rooté¡µå®šä¹‰</td></tr><tr><td><code>PAGE_BTR_SEG_TOP</code></td><td><code>10</code>å­—èŠ‚</td><td>B+æ ‘éå¶å­æ®µçš„å¤´éƒ¨ä¿¡æ¯ï¼Œä»…åœ¨B+æ ‘çš„Rooté¡µå®šä¹‰</td></tr></tbody></table><p>å¦‚æœå¤§å®¶è®¤çœŸçœ‹è¿‡å‰è¾¹çš„æ–‡ç« ï¼Œä»<code>PAGE_N_DIR_SLOTS</code>åˆ°<code>PAGE_LAST_INSERT</code>ä»¥åŠ<code>PAGE_N_RECS</code>çš„æ„æ€å¤§å®¶ä¸€å®šæ˜¯æ¸…æ¥šçš„ï¼Œå¦‚æœä¸æ¸…æ¥šï¼Œå¯¹ä¸èµ·ï¼Œä½ åº”è¯¥å›å¤´å†çœ‹ä¸€éå‰è¾¹çš„æ–‡ç« ã€‚å‰©ä¸‹çš„çŠ¶æ€ä¿¡æ¯çœ‹ä¸æ˜ç™½ä¸è¦ç€æ€¥ï¼Œé¥­è¦ä¸€å£ä¸€å£åƒï¼Œä¸œè¥¿è¦ä¸€ç‚¹ä¸€ç‚¹å­¦ï¼ˆä¸€å®šè¦ç¨å®‰å‹¿èºå“¦ï¼Œä¸è¦è¢«è¿™äº›åè¯å“åˆ°ï¼‰ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å…ˆå” å¨ä¸€ä¸‹<code>PAGE_DIRECTION</code>å’Œ<code>PAGE_N_DIRECTION</code>çš„æ„æ€ï¼š</p><ul><li><p><code>PAGE_DIRECTION</code></p><p>å‡å¦‚æ–°æ’å…¥çš„ä¸€æ¡è®°å½•çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œæˆ‘ä»¬è¯´è¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å³è¾¹ï¼Œåä¹‹åˆ™æ˜¯å·¦è¾¹ã€‚ç”¨æ¥è¡¨ç¤ºæœ€åä¸€æ¡è®°å½•æ’å…¥æ–¹å‘çš„çŠ¶æ€å°±æ˜¯<code>PAGE_DIRECTION</code>ã€‚</p></li><li><p><code>PAGE_N_DIRECTION</code></p><p>å‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥æ–°è®°å½•çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼Œ<code>InnoDB</code>ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°è®°ä¸‹æ¥ï¼Œè¿™ä¸ªæ¡æ•°å°±ç”¨<code>PAGE_N_DIRECTION</code>è¿™ä¸ªçŠ¶æ€è¡¨ç¤ºã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚</p></li></ul><p>è‡³äºæˆ‘ä»¬æ²¡æåˆ°çš„é‚£äº›å±æ€§ï¼Œæˆ‘æ²¡è¯´æ˜¯å› ä¸ºç°åœ¨ä¸éœ€è¦å¤§å®¶çŸ¥é“ã€‚ä¸è¦ç€æ€¥ï¼Œå½“æˆ‘ä»¬å­¦å®Œäº†åè¾¹çš„å†…å®¹ï¼Œä½ å†å›å¤´çœ‹ï¼Œä¸€åˆ‡éƒ½æ˜¯é‚£ä¹ˆæ¸…æ™°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>è¯´åˆ°è¿™ä¸ªæœ‰äº›ä¸œè¥¿åè¾¹æˆ‘ä»¬å­¦è¿‡åå›å¤´çœ‹å°±å¾ˆæ¸…æ™°çš„äº‹å„¿ä¸ç¦è®©æˆ‘æƒ³åˆ°äº†ä¹”å¸ƒæ–¯åœ¨æ–¯å¦ç¦å¤§å­¦çš„æ¼”è®²ï¼Œæ‘†ä¸€ä¸‹åŸæ–‡ï¼š<br><br>â€œYou can&#x27;t connect the dots looking forward; you can only connect them looking backwards. So you have to trust that the dots will somehow connect in your future.You have to trust in something - your gut, destiny, life, karma, whatever. This approach has never let me down, and it has made all the difference in my life.â€<br><br>ä¸Šè¾¹è¿™æ®µè¯çº¯å±å¿ƒè¡€æ¥æ½®å†™çš„ï¼Œå¤§æ„æ˜¯åšæŒåšè‡ªå·±å–œæ¬¢çš„äº‹å„¿ï¼Œä½ åœ¨åšçš„æ—¶å€™å¯èƒ½å¹¶ä¸èƒ½ææ¸…æ¥šè¿™äº›äº‹å„¿å¯¹è‡ªå·±ä¹‹åçš„äººç”Ÿæœ‰å•¥å½±å“ï¼Œä½†å½“ä½ ä¸€è·¯èµ°æ¥å›å¤´çœ‹æ—¶ï¼Œä¸€åˆ‡éƒ½æ˜¯é‚£ä¹ˆæ¸…æ™°ï¼Œå°±åƒæ˜¯å‘½ä¸­æ³¨å®šçš„ä¸€æ ·ã€‚ä¸Šè¿°å†…å®¹è·ŸMySQLæ¯«æ— å¹²ç³»ï¼Œè¯·å¿½ç•¥ï½<br></code></pre></td></tr></table></figure><h2 id="File-Headerï¼ˆæ–‡ä»¶å¤´éƒ¨ï¼‰">File Headerï¼ˆæ–‡ä»¶å¤´éƒ¨ï¼‰</h2><p>ä¸Šè¾¹å” å¨çš„<code>Page Header</code>æ˜¯ä¸“é—¨é’ˆå¯¹<code>æ•°æ®é¡µ</code>è®°å½•çš„å„ç§çŠ¶æ€ä¿¡æ¯ï¼Œæ¯”æ–¹è¯´é¡µé‡Œå¤´æœ‰å¤šå°‘ä¸ªè®°å½•äº†å‘€ï¼Œæœ‰å¤šå°‘ä¸ªæ§½äº†å‘€ã€‚æˆ‘ä»¬ç°åœ¨æè¿°çš„<code>File Header</code>é’ˆå¯¹å„ç§ç±»å‹çš„é¡µéƒ½é€šç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒç±»å‹çš„é¡µéƒ½ä¼šä»¥<code>File Header</code>ä½œä¸ºç¬¬ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå®ƒæè¿°äº†ä¸€äº›é’ˆå¯¹å„ç§é¡µéƒ½é€šç”¨çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”æ–¹è¯´è¿™ä¸ªé¡µçš„ç¼–å·æ˜¯å¤šå°‘ï¼Œå®ƒçš„ä¸Šä¸€ä¸ªé¡µã€ä¸‹ä¸€ä¸ªé¡µæ˜¯è°å•¦å§å•¦å§å•¦ï½ è¿™ä¸ªéƒ¨åˆ†å ç”¨å›ºå®šçš„<code>38</code>ä¸ªå­—èŠ‚ï¼Œæ˜¯ç”±ä¸‹è¾¹è¿™äº›å†…å®¹ç»„æˆçš„ï¼š</p><table><thead><tr><th>åç§°</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>FIL_PAGE_SPACE_OR_CHKSUM</code></td><td><code>4</code>å­—èŠ‚</td><td>é¡µçš„æ ¡éªŒå’Œï¼ˆchecksumå€¼ï¼‰</td></tr><tr><td><code>FIL_PAGE_OFFSET</code></td><td><code>4</code>å­—èŠ‚</td><td>é¡µå·</td></tr><tr><td><code>FIL_PAGE_PREV</code></td><td><code>4</code>å­—èŠ‚</td><td>ä¸Šä¸€ä¸ªé¡µçš„é¡µå·</td></tr><tr><td><code>FIL_PAGE_NEXT</code></td><td><code>4</code>å­—èŠ‚</td><td>ä¸‹ä¸€ä¸ªé¡µçš„é¡µå·</td></tr><tr><td><code>FIL_PAGE_LSN</code></td><td><code>8</code>å­—èŠ‚</td><td>é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®ï¼ˆè‹±æ–‡åæ˜¯ï¼šLog Sequence Numberï¼‰</td></tr><tr><td><code>FIL_PAGE_TYPE</code></td><td><code>2</code>å­—èŠ‚</td><td>è¯¥é¡µçš„ç±»å‹</td></tr><tr><td><code>FIL_PAGE_FILE_FLUSH_LSN</code></td><td><code>8</code>å­—èŠ‚</td><td>ä»…åœ¨ç³»ç»Ÿè¡¨ç©ºé—´çš„ä¸€ä¸ªé¡µä¸­å®šä¹‰ï¼Œä»£è¡¨æ–‡ä»¶è‡³å°‘è¢«åˆ·æ–°åˆ°äº†å¯¹åº”çš„LSNå€¼</td></tr><tr><td><code>FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID</code></td><td><code>4</code>å­—èŠ‚</td><td>é¡µå±äºå“ªä¸ªè¡¨ç©ºé—´</td></tr></tbody></table><p>å¯¹ç…§ç€è¿™ä¸ªè¡¨æ ¼ï¼Œæˆ‘ä»¬çœ‹å‡ ä¸ªç›®å‰æ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†ï¼š</p><ul><li><p><code>FIL_PAGE_SPACE_OR_CHKSUM</code></p><p>è¿™ä¸ªä»£è¡¨å½“å‰é¡µé¢çš„æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚å•¥æ˜¯ä¸ªæ ¡éªŒå’Œï¼Ÿå°±æ˜¯å¯¹äºä¸€ä¸ªå¾ˆé•¿å¾ˆé•¿çš„å­—èŠ‚ä¸²æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æŸç§ç®—æ³•æ¥è®¡ç®—ä¸€ä¸ªæ¯”è¾ƒçŸ­çš„å€¼æ¥ä»£è¡¨è¿™ä¸ªå¾ˆé•¿çš„å­—èŠ‚ä¸²ï¼Œè¿™ä¸ªæ¯”è¾ƒçŸ­çš„å€¼å°±ç§°ä¸º<code>æ ¡éªŒå’Œ</code>ã€‚è¿™æ ·åœ¨æ¯”è¾ƒä¸¤ä¸ªå¾ˆé•¿çš„å­—èŠ‚ä¸²ä¹‹å‰å…ˆæ¯”è¾ƒè¿™ä¸¤ä¸ªé•¿å­—èŠ‚ä¸²çš„æ ¡éªŒå’Œï¼Œå¦‚æœæ ¡éªŒå’Œéƒ½ä¸ä¸€æ ·ä¸¤ä¸ªé•¿å­—èŠ‚ä¸²è‚¯å®šæ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥çœå»äº†ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªæ¯”è¾ƒé•¿çš„å­—èŠ‚ä¸²çš„æ—¶é—´æŸè€—ã€‚</p></li><li><p><code>FIL_PAGE_OFFSET</code></p><p>æ¯ä¸€ä¸ª<code>é¡µ</code>éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„é¡µå·ï¼Œå°±è·Ÿä½ çš„èº«ä»½è¯å·ç ä¸€æ ·ï¼Œ<code>InnoDB</code>é€šè¿‡é¡µå·æ¥å¯ä»¥å”¯ä¸€å®šä½ä¸€ä¸ª<code>é¡µ</code>ã€‚</p></li><li><p><code>FIL_PAGE_TYPE</code></p><p>è¿™ä¸ªä»£è¡¨å½“å‰<code>é¡µ</code>çš„ç±»å‹ï¼Œæˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œ<code>InnoDB</code>ä¸ºäº†ä¸åŒçš„ç›®çš„è€ŒæŠŠé¡µåˆ†ä¸ºä¸åŒçš„ç±»å‹ï¼Œæˆ‘ä»¬ä¸Šè¾¹ä»‹ç»çš„å…¶å®éƒ½æ˜¯å­˜å‚¨è®°å½•çš„<code>æ•°æ®é¡µ</code>ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šåˆ«çš„ç±»å‹çš„é¡µï¼Œå…·ä½“å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>ç±»å‹åç§°</th><th>åå…­è¿›åˆ¶</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>FIL_PAGE_TYPE_ALLOCATED</code></td><td>0x0000</td><td>æœ€æ–°åˆ†é…ï¼Œè¿˜æ²¡ä½¿ç”¨</td></tr><tr><td><code>FIL_PAGE_UNDO_LOG</code></td><td>0x0002</td><td>Undoæ—¥å¿—é¡µ</td></tr><tr><td><code>FIL_PAGE_INODE</code></td><td>0x0003</td><td>æ®µä¿¡æ¯èŠ‚ç‚¹</td></tr><tr><td><code>FIL_PAGE_IBUF_FREE_LIST</code></td><td>0x0004</td><td>Insert Bufferç©ºé—²åˆ—è¡¨</td></tr><tr><td><code>FIL_PAGE_IBUF_BITMAP</code></td><td>0x0005</td><td>Insert Bufferä½å›¾</td></tr><tr><td><code>FIL_PAGE_TYPE_SYS</code></td><td>0x0006</td><td>ç³»ç»Ÿé¡µ</td></tr><tr><td><code>FIL_PAGE_TYPE_TRX_SYS</code></td><td>0x0007</td><td>äº‹åŠ¡ç³»ç»Ÿæ•°æ®</td></tr><tr><td><code>FIL_PAGE_TYPE_FSP_HDR</code></td><td>0x0008</td><td>è¡¨ç©ºé—´å¤´éƒ¨ä¿¡æ¯</td></tr><tr><td><code>FIL_PAGE_TYPE_XDES</code></td><td>0x0009</td><td>æ‰©å±•æè¿°é¡µ</td></tr><tr><td><code>FIL_PAGE_TYPE_BLOB</code></td><td>0x000A</td><td>æº¢å‡ºé¡µ</td></tr><tr><td><code>FIL_PAGE_INDEX</code></td><td>0x45BF</td><td>ç´¢å¼•é¡µï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„<code>æ•°æ®é¡µ</code></td></tr></tbody></table><p>æˆ‘ä»¬å­˜æ”¾è®°å½•çš„æ•°æ®é¡µçš„ç±»å‹å…¶å®æ˜¯<code>FIL_PAGE_INDEX</code>ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„<code>ç´¢å¼•é¡µ</code>ã€‚è‡³äºå•¥æ˜¯ä¸ªç´¢å¼•ï¼Œä¸”å¬ä¸‹å›åˆ†è§£ï½</p></li><li><p><code>FIL_PAGE_PREV</code>å’Œ<code>FIL_PAGE_NEXT</code></p><p>æˆ‘ä»¬å‰è¾¹å¼ºè°ƒè¿‡ï¼Œ<code>InnoDB</code>éƒ½æ˜¯ä»¥é¡µä¸ºå•ä½å­˜æ”¾æ•°æ®çš„ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å­˜æ”¾æŸç§ç±»å‹çš„æ•°æ®å ç”¨çš„ç©ºé—´éå¸¸å¤§ï¼ˆæ¯”æ–¹è¯´ä¸€å¼ è¡¨ä¸­å¯ä»¥æœ‰æˆåƒä¸Šä¸‡æ¡è®°å½•ï¼‰ï¼Œ<code>InnoDB</code>å¯èƒ½ä¸å¯ä»¥ä¸€æ¬¡æ€§ä¸ºè¿™ä¹ˆå¤šæ•°æ®åˆ†é…ä¸€ä¸ªéå¸¸å¤§çš„å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœåˆ†æ•£åˆ°å¤šä¸ªä¸è¿ç»­çš„é¡µä¸­å­˜å‚¨çš„è¯éœ€è¦æŠŠè¿™äº›é¡µå…³è”èµ·æ¥ï¼Œ<code>FIL_PAGE_PREV</code>å’Œ<code>FIL_PAGE_NEXT</code>å°±åˆ†åˆ«ä»£è¡¨æœ¬é¡µçš„ä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªé¡µçš„é¡µå·ã€‚è¿™æ ·é€šè¿‡å»ºç«‹ä¸€ä¸ªåŒå‘é“¾è¡¨æŠŠè®¸è®¸å¤šå¤šçš„é¡µå°±éƒ½ä¸²è”èµ·æ¥äº†ï¼Œè€Œæ— éœ€è¿™äº›é¡µåœ¨ç‰©ç†ä¸ŠçœŸæ­£è¿ç€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰ç±»å‹çš„é¡µéƒ½æœ‰ä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªé¡µçš„å±æ€§ï¼Œä¸è¿‡æˆ‘ä»¬æœ¬é›†ä¸­å” å¨çš„<code>æ•°æ®é¡µ</code>ï¼ˆä¹Ÿå°±æ˜¯ç±»å‹ä¸º<code>FIL_PAGE_INDEX</code>çš„é¡µï¼‰æ˜¯æœ‰è¿™ä¸¤ä¸ªå±æ€§çš„ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°æ®é¡µå…¶å®æ˜¯ä¸€ä¸ªåŒé“¾è¡¨ï¼Œå°±åƒè¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a95c10eb9d61ce~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ca00fhg418pl1f1a1iav1uo3aou9.png-90.9kB"></li></ul><p>å…³äº<code>File Header</code>çš„å…¶ä»–å±æ€§æˆ‘ä»¬æš‚æ—¶ç”¨ä¸åˆ°ï¼Œç­‰ç”¨åˆ°çš„æ—¶å€™å†æå“ˆï½</p><h2 id="File-Trailer">File Trailer</h2><p>æˆ‘ä»¬çŸ¥é“<code>InnoDB</code>å­˜å‚¨å¼•æ“ä¼šæŠŠæ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼Œä½†æ˜¯ç£ç›˜é€Ÿåº¦å¤ªæ…¢ï¼Œéœ€è¦ä»¥<code>é¡µ</code>ä¸ºå•ä½æŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­å¤„ç†ï¼Œå¦‚æœè¯¥é¡µä¸­çš„æ•°æ®åœ¨å†…å­˜ä¸­è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹åçš„æŸä¸ªæ—¶é—´éœ€è¦æŠŠæ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸­ã€‚ä½†æ˜¯åœ¨åŒæ­¥äº†ä¸€åŠçš„æ—¶å€™ä¸­æ–­ç”µäº†å’‹åŠï¼Œè¿™ä¸æ˜¯è«åå°´å°¬ä¹ˆï¼Ÿä¸ºäº†æ£€æµ‹ä¸€ä¸ªé¡µæ˜¯å¦å®Œæ•´ï¼ˆä¹Ÿå°±æ˜¯åœ¨åŒæ­¥çš„æ—¶å€™æœ‰æ²¡æœ‰å‘ç”ŸåªåŒæ­¥ä¸€åŠçš„å°´å°¬æƒ…å†µï¼‰ï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬åœ¨æ¯ä¸ªé¡µçš„å°¾éƒ¨éƒ½åŠ äº†ä¸€ä¸ª<code>File Trailer</code>éƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†ç”±<code>8</code>ä¸ªå­—èŠ‚ç»„æˆï¼Œå¯ä»¥åˆ†æˆ2ä¸ªå°éƒ¨åˆ†ï¼š</p><ul><li><p>å‰4ä¸ªå­—èŠ‚ä»£è¡¨é¡µçš„æ ¡éªŒå’Œ</p><p>è¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ<code>File Header</code>ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚æ¯å½“ä¸€ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­ä¿®æ”¹äº†ï¼Œåœ¨åŒæ­¥ä¹‹å‰å°±è¦æŠŠå®ƒçš„æ ¡éªŒå’Œç®—å‡ºæ¥ï¼Œå› ä¸º<code>File Header</code>åœ¨é¡µé¢çš„å‰è¾¹ï¼Œæ‰€ä»¥æ ¡éªŒå’Œä¼šè¢«é¦–å…ˆåŒæ­¥åˆ°ç£ç›˜ï¼Œå½“å®Œå…¨å†™å®Œæ—¶ï¼Œæ ¡éªŒå’Œä¹Ÿä¼šè¢«å†™åˆ°é¡µçš„å°¾éƒ¨ï¼Œå¦‚æœå®Œå…¨åŒæ­¥æˆåŠŸï¼Œåˆ™é¡µçš„é¦–éƒ¨å’Œå°¾éƒ¨çš„æ ¡éªŒå’Œåº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚å¦‚æœå†™äº†ä¸€åŠå„¿æ–­ç”µäº†ï¼Œé‚£ä¹ˆåœ¨<code>File Header</code>ä¸­çš„æ ¡éªŒå’Œå°±ä»£è¡¨ç€å·²ç»ä¿®æ”¹è¿‡çš„é¡µï¼Œè€Œåœ¨<code>File Trailer</code>ä¸­çš„æ ¡éªŒå’Œä»£è¡¨ç€åŸå…ˆçš„é¡µï¼ŒäºŒè€…ä¸åŒåˆ™æ„å‘³ç€åŒæ­¥ä¸­é—´å‡ºäº†é”™ã€‚</p></li><li><p>å4ä¸ªå­—èŠ‚ä»£è¡¨é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®ï¼ˆLSNï¼‰</p><p>è¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼Œåªä¸è¿‡æˆ‘ä»¬ç›®å‰è¿˜æ²¡è¯´<code>LSN</code>æ˜¯ä¸ªä»€ä¹ˆæ„æ€ï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥å…ˆä¸ç”¨ç®¡è¿™ä¸ªå±æ€§ã€‚</p></li></ul><p>è¿™ä¸ª<code>File Trailer</code>ä¸<code>File Header</code>ç±»ä¼¼ï¼Œéƒ½æ˜¯æ‰€æœ‰ç±»å‹çš„é¡µé€šç”¨çš„ã€‚</p><h2 id="æ€»ç»“-3">æ€»ç»“</h2><ol><li>InnoDBä¸ºäº†ä¸åŒçš„ç›®çš„è€Œè®¾è®¡äº†ä¸åŒç±»å‹çš„é¡µï¼Œæˆ‘ä»¬æŠŠç”¨äºå­˜æ”¾è®°å½•çš„é¡µå«åš<code>æ•°æ®é¡µ</code>ã€‚</li><li>ä¸€ä¸ªæ•°æ®é¡µå¯ä»¥è¢«å¤§è‡´åˆ’åˆ†ä¸º7ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯<ul><li><code>File Header</code>ï¼Œè¡¨ç¤ºé¡µçš„ä¸€äº›é€šç”¨ä¿¡æ¯ï¼Œå å›ºå®šçš„38å­—èŠ‚ã€‚</li><li><code>Page Header</code>ï¼Œè¡¨ç¤ºæ•°æ®é¡µä¸“æœ‰çš„ä¸€äº›ä¿¡æ¯ï¼Œå å›ºå®šçš„56ä¸ªå­—èŠ‚ã€‚</li><li><code>Infimum + Supremum</code>ï¼Œä¸¤ä¸ªè™šæ‹Ÿçš„ä¼ªè®°å½•ï¼Œåˆ†åˆ«è¡¨ç¤ºé¡µä¸­çš„æœ€å°å’Œæœ€å¤§è®°å½•ï¼Œå å›ºå®šçš„<code>26</code>ä¸ªå­—èŠ‚ã€‚</li><li><code>User Records</code>ï¼šçœŸå®å­˜å‚¨æˆ‘ä»¬æ’å…¥çš„è®°å½•çš„éƒ¨åˆ†ï¼Œå¤§å°ä¸å›ºå®šã€‚</li><li><code>Free Space</code>ï¼šé¡µä¸­å°šæœªä½¿ç”¨çš„éƒ¨åˆ†ï¼Œå¤§å°ä¸ç¡®å®šã€‚</li><li><code>Page Directory</code>ï¼šé¡µä¸­çš„æŸäº›è®°å½•ç›¸å¯¹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯å„ä¸ªæ§½åœ¨é¡µé¢ä¸­çš„åœ°å€åç§»é‡ï¼Œå¤§å°ä¸å›ºå®šï¼Œæ’å…¥çš„è®°å½•è¶Šå¤šï¼Œè¿™ä¸ªéƒ¨åˆ†å ç”¨çš„ç©ºé—´è¶Šå¤šã€‚</li><li><code>File Trailer</code>ï¼šç”¨äºæ£€éªŒé¡µæ˜¯å¦å®Œæ•´çš„éƒ¨åˆ†ï¼Œå ç”¨å›ºå®šçš„8ä¸ªå­—èŠ‚ã€‚</li></ul></li><li>æ¯ä¸ªè®°å½•çš„å¤´ä¿¡æ¯ä¸­éƒ½æœ‰ä¸€ä¸ª<code>next_record</code>å±æ€§ï¼Œä»è€Œä½¿é¡µä¸­çš„æ‰€æœ‰è®°å½•ä¸²è”æˆä¸€ä¸ª<code>å•é“¾è¡¨</code>ã€‚</li><li><code>InnoDB</code>ä¼šæŠŠé¡µä¸­çš„è®°å½•åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªç»„ï¼Œæ¯ä¸ªç»„çš„æœ€åä¸€ä¸ªè®°å½•çš„åœ°å€åç§»é‡ä½œä¸ºä¸€ä¸ª<code>æ§½</code>ï¼Œå­˜æ”¾åœ¨<code>Page Directory</code>ä¸­ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªé¡µä¸­æ ¹æ®ä¸»é”®æŸ¥æ‰¾è®°å½•æ˜¯éå¸¸å¿«çš„ï¼Œåˆ†ä¸ºä¸¤æ­¥ï¼š<ul><li>é€šè¿‡äºŒåˆ†æ³•ç¡®å®šè¯¥è®°å½•æ‰€åœ¨çš„æ§½ã€‚</li><li>é€šè¿‡è®°å½•çš„next_recordå±æ€§éå†è¯¥æ§½æ‰€åœ¨çš„ç»„ä¸­çš„å„ä¸ªè®°å½•ã€‚</li></ul></li><li>æ¯ä¸ªæ•°æ®é¡µçš„<code>File Header</code>éƒ¨åˆ†éƒ½æœ‰ä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªé¡µçš„ç¼–å·ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°æ®é¡µä¼šç»„æˆä¸€ä¸ª<code>åŒé“¾è¡¨</code>ã€‚</li><li>ä¸ºä¿è¯ä»å†…å­˜ä¸­åŒæ­¥åˆ°ç£ç›˜çš„é¡µçš„å®Œæ•´æ€§ï¼Œåœ¨é¡µçš„é¦–éƒ¨å’Œå°¾éƒ¨éƒ½ä¼šå­˜å‚¨é¡µä¸­æ•°æ®çš„æ ¡éªŒå’Œå’Œé¡µé¢æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„<code>LSN</code>å€¼ï¼Œå¦‚æœé¦–éƒ¨å’Œå°¾éƒ¨çš„æ ¡éªŒå’Œå’Œ<code>LSN</code>å€¼æ ¡éªŒä¸æˆåŠŸçš„è¯ï¼Œå°±è¯´æ˜åŒæ­¥è¿‡ç¨‹å‡ºç°äº†é—®é¢˜ã€‚</li></ol><h1>6.B+æ ‘ç´¢å¼•</h1><p>å‰è¾¹æˆ‘ä»¬è¯¦ç»†å” å¨äº†<code>InnoDB</code>æ•°æ®é¡µçš„7ä¸ªç»„æˆéƒ¨åˆ†ï¼ŒçŸ¥é“äº†å„ä¸ªæ•°æ®é¡µå¯ä»¥ç»„æˆä¸€ä¸ª<code>åŒå‘é“¾è¡¨</code>ï¼Œè€Œæ¯ä¸ªæ•°æ®é¡µä¸­çš„è®°å½•ä¼šæŒ‰ç…§ä¸»é”®å€¼ä»å°åˆ°å¤§çš„é¡ºåºç»„æˆä¸€ä¸ª<code>å•å‘é“¾è¡¨</code>ï¼Œæ¯ä¸ªæ•°æ®é¡µéƒ½ä¼šä¸ºå­˜å‚¨åœ¨å®ƒé‡Œè¾¹å„¿çš„è®°å½•ç”Ÿæˆä¸€ä¸ª<code>é¡µç›®å½•</code>ï¼Œåœ¨é€šè¿‡ä¸»é”®æŸ¥æ‰¾æŸæ¡è®°å½•çš„æ—¶å€™å¯ä»¥åœ¨<code>é¡µç›®å½•</code>ä¸­ä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ§½ï¼Œç„¶åå†éå†è¯¥æ§½å¯¹åº”åˆ†ç»„ä¸­çš„è®°å½•å³å¯å¿«é€Ÿæ‰¾åˆ°æŒ‡å®šçš„è®°å½•ï¼ˆå¦‚æœä½ å¯¹è¿™æ®µè¯æœ‰ä¸€ä¸ç‚¹å„¿ç–‘æƒ‘ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸é€‚åˆä½ ï¼Œè¿”å›å»çœ‹ä¸€ä¸‹æ•°æ®é¡µç»“æ„å§ï¼‰ã€‚é¡µå’Œè®°å½•çš„å…³ç³»ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd1b8eafbb4~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cov976plf2u1j3g1jp8serjc616.png-87.7kB"><p>å…¶ä¸­é¡µaã€é¡µbã€é¡µc â€¦ é¡µn è¿™äº›é¡µå¯ä»¥ä¸åœ¨ç‰©ç†ç»“æ„ä¸Šç›¸è¿ï¼Œåªè¦é€šè¿‡åŒå‘é“¾è¡¨ç›¸å…³è”å³å¯ã€‚</p><h2 id="æ²¡æœ‰ç´¢å¼•çš„æŸ¥æ‰¾">æ²¡æœ‰ç´¢å¼•çš„æŸ¥æ‰¾</h2><p>æœ¬é›†çš„ä¸»é¢˜æ˜¯<code>ç´¢å¼•</code>ï¼Œåœ¨æ­£å¼ä»‹ç»<code>ç´¢å¼•</code>ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹æ²¡æœ‰ç´¢å¼•çš„æ—¶å€™æ˜¯æ€ä¹ˆæŸ¥æ‰¾è®°å½•çš„ã€‚ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œæˆ‘ä»¬ä¸‹è¾¹å…ˆåªå” å¨æœç´¢æ¡ä»¶ä¸ºå¯¹æŸä¸ªåˆ—ç²¾ç¡®åŒ¹é…çš„æƒ…å†µï¼Œæ‰€è°“ç²¾ç¡®åŒ¹é…ï¼Œå°±æ˜¯æœç´¢æ¡ä»¶ä¸­ç”¨ç­‰äº<code>=</code>è¿æ¥èµ·çš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> [åˆ—ååˆ—è¡¨] <span class="hljs-keyword">FROM</span> è¡¨å <span class="hljs-keyword">WHERE</span> åˆ—å = xxx;<br></code></pre></td></tr></table></figure><h3 id="åœ¨ä¸€ä¸ªé¡µä¸­çš„æŸ¥æ‰¾">åœ¨ä¸€ä¸ªé¡µä¸­çš„æŸ¥æ‰¾</h3><p>å‡è®¾ç›®å‰è¡¨ä¸­çš„è®°å½•æ¯”è¾ƒå°‘ï¼Œæ‰€æœ‰çš„è®°å½•éƒ½å¯ä»¥è¢«å­˜æ”¾åˆ°ä¸€ä¸ªé¡µä¸­ï¼Œåœ¨æŸ¥æ‰¾è®°å½•çš„æ—¶å€™å¯ä»¥æ ¹æ®æœç´¢æ¡ä»¶çš„ä¸åŒåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li><p>ä»¥ä¸»é”®ä¸ºæœç´¢æ¡ä»¶</p><p>è¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹æˆ‘ä»¬å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œå¯ä»¥åœ¨<code>é¡µç›®å½•</code>ä¸­ä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ§½ï¼Œç„¶åå†éå†è¯¥æ§½å¯¹åº”åˆ†ç»„ä¸­çš„è®°å½•å³å¯å¿«é€Ÿæ‰¾åˆ°æŒ‡å®šçš„è®°å½•ã€‚</p></li><li><p>ä»¥å…¶ä»–åˆ—ä½œä¸ºæœç´¢æ¡ä»¶</p><p>å¯¹éä¸»é”®åˆ—çš„æŸ¥æ‰¾çš„è¿‡ç¨‹å¯å°±ä¸è¿™ä¹ˆå¹¸è¿äº†ï¼Œå› ä¸ºåœ¨æ•°æ®é¡µä¸­å¹¶æ²¡æœ‰å¯¹éä¸»é”®åˆ—å»ºç«‹æ‰€è°“çš„<code>é¡µç›®å½•</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½ç›¸åº”çš„<code>æ§½</code>ã€‚è¿™ç§æƒ…å†µä¸‹åªèƒ½ä»<code>æœ€å°è®°å½•</code>å¼€å§‹ä¾æ¬¡éå†å•é“¾è¡¨ä¸­çš„æ¯æ¡è®°å½•ï¼Œç„¶åå¯¹æ¯”æ¯æ¡è®°å½•æ˜¯ä¸æ˜¯ç¬¦åˆæœç´¢æ¡ä»¶ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§æŸ¥æ‰¾çš„æ•ˆç‡æ˜¯éå¸¸ä½çš„ã€‚</p></li></ul><h3 id="åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾">åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾</h3><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬è¡¨ä¸­å­˜æ”¾çš„è®°å½•éƒ½æ˜¯éå¸¸å¤šçš„ï¼Œéœ€è¦å¥½å¤šçš„æ•°æ®é¡µæ¥å­˜å‚¨è¿™äº›è®°å½•ã€‚åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾è®°å½•çš„è¯å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li>å®šä½åˆ°è®°å½•æ‰€åœ¨çš„é¡µã€‚</li><li>ä»æ‰€åœ¨çš„é¡µå†…ä¸­æŸ¥æ‰¾ç›¸åº”çš„è®°å½•ã€‚</li></ol><p>åœ¨æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œä¸è®ºæ˜¯æ ¹æ®ä¸»é”®åˆ—æˆ–è€…å…¶ä»–åˆ—çš„å€¼è¿›è¡ŒæŸ¥æ‰¾ï¼Œç”±äºæˆ‘ä»¬å¹¶ä¸èƒ½å¿«é€Ÿçš„å®šä½åˆ°è®°å½•æ‰€åœ¨çš„é¡µï¼Œæ‰€ä»¥åªèƒ½ä»ç¬¬ä¸€ä¸ªé¡µæ²¿ç€åŒå‘é“¾è¡¨ä¸€ç›´å¾€ä¸‹æ‰¾ï¼Œåœ¨æ¯ä¸€ä¸ªé¡µä¸­æ ¹æ®æˆ‘ä»¬åˆšåˆšå” å¨è¿‡çš„æŸ¥æ‰¾æ–¹å¼å»æŸ¥æ‰¾æŒ‡å®šçš„è®°å½•ã€‚å› ä¸ºè¦éå†æ‰€æœ‰çš„æ•°æ®é¡µï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼æ˜¾ç„¶æ˜¯è¶…çº§è€—æ—¶çš„ï¼Œå¦‚æœä¸€ä¸ªè¡¨æœ‰ä¸€äº¿æ¡è®°å½•ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼å»æŸ¥æ‰¾è®°å½•é‚£è¦ç­‰åˆ°çŒ´å¹´é©¬æœˆæ‰èƒ½ç­‰åˆ°æŸ¥æ‰¾ç»“æœã€‚æ‰€ä»¥ç¥–å›½å’Œäººæ°‘éƒ½åœ¨æœŸç›¼ä¸€ç§èƒ½é«˜æ•ˆå®Œæˆæœç´¢çš„æ–¹æ³•ï¼Œ<code>ç´¢å¼•</code>åŒå¿—å°±è¦äº®ç›¸ç™»å°äº†ã€‚</p><h2 id="ç´¢å¼•">ç´¢å¼•</h2><p>ä¸ºäº†æ•…äº‹çš„é¡ºåˆ©å‘å±•ï¼Œæˆ‘ä»¬å…ˆå»ºä¸€ä¸ªè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> index_demo(<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     c1 <span class="hljs-type">INT</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     c2 <span class="hljs-type">INT</span>,<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     c3 <span class="hljs-type">CHAR</span>(<span class="hljs-number">1</span>),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>     <span class="hljs-keyword">PRIMARY</span> KEY(c1)<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> ) ROW_FORMAT <span class="hljs-operator">=</span> Compact;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–°å»ºçš„<code>index_demo</code>è¡¨ä¸­æœ‰2ä¸ª<code>INT</code>ç±»å‹çš„åˆ—ï¼Œ1ä¸ª<code>CHAR(1)</code>ç±»å‹çš„åˆ—ï¼Œè€Œä¸”æˆ‘ä»¬è§„å®šäº†<code>c1</code>åˆ—ä¸ºä¸»é”®ï¼Œè¿™ä¸ªè¡¨ä½¿ç”¨<code>Compact</code>è¡Œæ ¼å¼æ¥å®é™…å­˜å‚¨è®°å½•çš„ã€‚ä¸ºäº†æˆ‘ä»¬ç†è§£ä¸Šçš„æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç®€åŒ–äº†ä¸€ä¸‹<code>index_demo</code>è¡¨çš„è¡Œæ ¼å¼ç¤ºæ„å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd1ba8d05b2~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1caac8jr7hhcld017gd1lch1n1m33.png-97.1kB"><p>æˆ‘ä»¬åªåœ¨ç¤ºæ„å›¾é‡Œå±•ç¤ºè®°å½•çš„è¿™å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><code>record_type</code>ï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºè®°å½•çš„ç±»å‹ï¼Œ<code>0</code>è¡¨ç¤ºæ™®é€šè®°å½•ã€<code>2</code>è¡¨ç¤ºæœ€å°è®°å½•ã€<code>3</code>è¡¨ç¤ºæœ€å¤§è®°å½•ã€<code>1</code>æˆ‘ä»¬è¿˜æ²¡ç”¨è¿‡ï¼Œç­‰ä¼šå†è¯´ï½</li><li><code>next_record</code>ï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºä¸‹ä¸€æ¡åœ°å€ç›¸å¯¹äºæœ¬æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼Œä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œæˆ‘ä»¬éƒ½ä¼šç”¨ç®­å¤´æ¥è¡¨æ˜ä¸‹ä¸€æ¡è®°å½•æ˜¯è°ã€‚</li><li><code>å„ä¸ªåˆ—çš„å€¼</code>ï¼šè¿™é‡Œåªè®°å½•åœ¨<code>index_demo</code>è¡¨ä¸­çš„ä¸‰ä¸ªåˆ—ï¼Œåˆ†åˆ«æ˜¯<code>c1</code>ã€<code>c2</code>å’Œ<code>c3</code>ã€‚</li><li><code>å…¶ä»–ä¿¡æ¯</code>ï¼šé™¤äº†ä¸Šè¿°3ç§ä¿¡æ¯ä»¥å¤–çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶ä»–éšè—åˆ—çš„å€¼ä»¥åŠè®°å½•çš„é¢å¤–ä¿¡æ¯ã€‚</li></ul><p>ä¸ºäº†èŠ‚çœç¯‡å¹…ï¼Œæˆ‘ä»¬ä¹‹åçš„ç¤ºæ„å›¾ä¸­ä¼šæŠŠè®°å½•çš„<code>å…¶ä»–ä¿¡æ¯</code>è¿™ä¸ªéƒ¨åˆ†çœç•¥æ‰ï¼Œå› ä¸ºå®ƒå åœ°æ–¹å¹¶ä¸”ä¸ä¼šæœ‰ä»€ä¹ˆè§‚èµæ•ˆæœã€‚å¦å¤–ï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬è§‰å¾—æŠŠè®°å½•ç«–ç€æ”¾çœ‹èµ·æ¥æ„Ÿè§‰æ›´å¥½ï¼Œæ‰€ä»¥å°†è®°å½•æ ¼å¼ç¤ºæ„å›¾çš„<code>å…¶ä»–ä¿¡æ¯</code>å»æ‰å¹¶æŠŠå®ƒç«–èµ·æ¥çš„æ•ˆæœå°±æ˜¯è¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd1b0cad198~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1caacokob6ne1nv41meda0s7vk3g.png-68.1kB"><p>æŠŠä¸€äº›è®°å½•æ”¾åˆ°é¡µé‡Œè¾¹çš„ç¤ºæ„å›¾å°±æ˜¯ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd1be0d43ce~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1caadhc4g1pb7hk81fcd4vt1u6r3t.png-79.8kB"><h3 id="ä¸€ä¸ªç®€å•çš„ç´¢å¼•æ–¹æ¡ˆ">ä¸€ä¸ªç®€å•çš„ç´¢å¼•æ–¹æ¡ˆ</h3><p>å›åˆ°æ­£é¢˜ï¼Œæˆ‘ä»¬åœ¨æ ¹æ®æŸä¸ªæœç´¢æ¡ä»¶æŸ¥æ‰¾ä¸€äº›è®°å½•æ—¶ä¸ºä»€ä¹ˆè¦éå†æ‰€æœ‰çš„æ•°æ®é¡µå‘¢ï¼Ÿå› ä¸ºå„ä¸ªé¡µä¸­çš„è®°å½•å¹¶æ²¡æœ‰è§„å¾‹ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æˆ‘ä»¬çš„æœç´¢æ¡ä»¶åŒ¹é…å“ªäº›é¡µä¸­çš„è®°å½•ï¼Œæ‰€ä»¥ <em><strong>ä¸å¾—ä¸</strong></em> ä¾æ¬¡éå†æ‰€æœ‰çš„æ•°æ®é¡µã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³å¿«é€Ÿçš„å®šä½åˆ°éœ€è¦æŸ¥æ‰¾çš„è®°å½•åœ¨å“ªäº›æ•°æ®é¡µä¸­è¯¥å’‹åŠï¼Ÿè¿˜è®°å¾—æˆ‘ä»¬ä¸ºæ ¹æ®ä¸»é”®å€¼å¿«é€Ÿå®šä½ä¸€æ¡è®°å½•åœ¨é¡µä¸­çš„ä½ç½®è€Œè®¾ç«‹çš„é¡µç›®å½•ä¹ˆï¼Ÿæˆ‘ä»¬ä¹Ÿå¯ä»¥æƒ³åŠæ³•ä¸ºå¿«é€Ÿå®šä½è®°å½•æ‰€åœ¨çš„æ•°æ®é¡µè€Œå»ºç«‹ä¸€ä¸ªåˆ«çš„ç›®å½•ï¼Œå»ºè¿™ä¸ªç›®å½•å¿…é¡»å®Œæˆä¸‹è¾¹è¿™äº›äº‹å„¿ï¼š</p><ul><li><p>ä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼ã€‚</p><p>ä¸ºäº†æ•…äº‹çš„é¡ºåˆ©å‘å±•ï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦åšä¸€ä¸ªå‡è®¾ï¼šå‡è®¾æˆ‘ä»¬çš„æ¯ä¸ªæ•°æ®é¡µæœ€å¤šèƒ½å­˜æ”¾3æ¡è®°å½•ï¼ˆå®é™…ä¸Šä¸€ä¸ªæ•°æ®é¡µéå¸¸å¤§ï¼Œå¯ä»¥å­˜æ”¾ä¸‹å¥½å¤šè®°å½•ï¼‰ã€‚æœ‰äº†è¿™ä¸ªå‡è®¾ä¹‹åæˆ‘ä»¬å‘<code>index_demo</code>è¡¨æ’å…¥3æ¡è®°å½•ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; INSERT INTO index_demo VALUES(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, &#x27;u&#x27;), (<span class="hljs-number">3</span>, <span class="hljs-number">9</span>, &#x27;d&#x27;), (<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, &#x27;y&#x27;);<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">3</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">01</span> sec)<br><span class="hljs-attribute">Records</span>: <span class="hljs-number">3</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™äº›è®°å½•å·²ç»æŒ‰ç…§ä¸»é”®å€¼çš„å¤§å°ä¸²è”æˆä¸€ä¸ªå•å‘é“¾è¡¨äº†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd1b5a6e2af~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1caaf26411d51bq7jtrvesr04a.png-29.5kB"><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>index_demo</code>è¡¨ä¸­çš„3æ¡è®°å½•éƒ½è¢«æ’å…¥åˆ°äº†ç¼–å·ä¸º<code>10</code>çš„æ•°æ®é¡µä¸­äº†ã€‚æ­¤æ—¶æˆ‘ä»¬å†æ¥æ’å…¥ä¸€æ¡è®°å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> index_demo <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-string">&#x27;a&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>å› ä¸º<code>é¡µ10</code>æœ€å¤šåªèƒ½æ”¾3æ¡è®°å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¾—ä¸å†åˆ†é…ä¸€ä¸ªæ–°é¡µï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd1b581b013~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1caafbcj1qpo1ad2j8q1ci4136s4n.png-44.5kB"><p>å’¦ï¼Ÿæ€ä¹ˆåˆ†é…çš„é¡µå·æ˜¯<code>28</code>å‘€ï¼Œä¸åº”è¯¥æ˜¯<code>11</code>ä¹ˆï¼Ÿå†æ¬¡å¼ºè°ƒä¸€éï¼Œæ–°åˆ†é…çš„æ•°æ®é¡µç¼–å·å¯èƒ½å¹¶ä¸æ˜¯è¿ç»­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä½¿ç”¨çš„è¿™äº›é¡µåœ¨å­˜å‚¨ç©ºé—´é‡Œå¯èƒ½å¹¶ä¸æŒ¨ç€ã€‚å®ƒä»¬åªæ˜¯é€šè¿‡ç»´æŠ¤ç€ä¸Šä¸€ä¸ªé¡µå’Œä¸‹ä¸€ä¸ªé¡µçš„ç¼–å·è€Œå»ºç«‹äº†é“¾è¡¨å…³ç³»ã€‚å¦å¤–ï¼Œ<code>é¡µ10</code>ä¸­ç”¨æˆ·è®°å½•æœ€å¤§çš„ä¸»é”®å€¼æ˜¯<code>5</code>ï¼Œè€Œ<code>é¡µ28</code>ä¸­æœ‰ä¸€æ¡è®°å½•çš„ä¸»é”®å€¼æ˜¯<code>4</code>ï¼Œå› ä¸º<code>5 &gt; 4</code>ï¼Œæ‰€ä»¥è¿™å°±ä¸ç¬¦åˆä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼çš„è¦æ±‚ï¼Œæ‰€ä»¥åœ¨æ’å…¥ä¸»é”®å€¼ä¸º<code>4</code>çš„è®°å½•çš„æ—¶å€™éœ€è¦ä¼´éšç€ä¸€æ¬¡è®°å½•ç§»åŠ¨ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸»é”®å€¼ä¸º<code>5</code>çš„è®°å½•ç§»åŠ¨åˆ°<code>é¡µ28</code>ä¸­ï¼Œç„¶åå†æŠŠä¸»é”®å€¼ä¸º<code>4</code>çš„è®°å½•æ’å…¥åˆ°<code>é¡µ10</code>ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd2641f1c47~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1caafkq3h1akv1mde14h2kjul6554.png-96.9kB"><p>è¿™ä¸ªè¿‡ç¨‹è¡¨æ˜äº†åœ¨å¯¹é¡µä¸­çš„è®°å½•è¿›è¡Œå¢åˆ æ”¹æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ä¸€äº›è¯¸å¦‚è®°å½•ç§»åŠ¨çš„æ“ä½œæ¥å§‹ç»ˆä¿è¯è¿™ä¸ªçŠ¶æ€ä¸€ç›´æˆç«‹ï¼šä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼ã€‚è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ä¹Ÿå¯ä»¥ç§°ä¸º<code>é¡µåˆ†è£‚</code>ã€‚</p></li><li><p>ç»™æ‰€æœ‰çš„é¡µå»ºç«‹ä¸€ä¸ªç›®å½•é¡¹ã€‚</p><p>ç”±äºæ•°æ®é¡µçš„ç¼–å·å¯èƒ½å¹¶ä¸æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥åœ¨å‘<code>index_demo</code>è¡¨ä¸­æ’å…¥è®¸å¤šæ¡è®°å½•åï¼Œå¯èƒ½æ˜¯è¿™æ ·çš„æ•ˆæœï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd27e1f3cf3~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cab9u9midn61fgq1mi58j0gadm.png-65.7kB"><p>å› ä¸ºè¿™äº›<code>16KB</code>çš„é¡µåœ¨ç‰©ç†å­˜å‚¨ä¸Šå¯èƒ½å¹¶ä¸æŒ¨ç€ï¼Œæ‰€ä»¥å¦‚æœæƒ³ä»è¿™ä¹ˆå¤šé¡µä¸­æ ¹æ®ä¸»é”®å€¼å¿«é€Ÿå®šä½æŸäº›è®°å½•æ‰€åœ¨çš„é¡µï¼Œæˆ‘ä»¬éœ€è¦ç»™å®ƒä»¬åšä¸ªç›®å½•ï¼Œæ¯ä¸ªé¡µå¯¹åº”ä¸€ä¸ªç›®å½•é¡¹ï¼Œæ¯ä¸ªç›®å½•é¡¹åŒ…æ‹¬ä¸‹è¾¹ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>é¡µçš„ç”¨æˆ·è®°å½•ä¸­æœ€å°çš„ä¸»é”®å€¼ï¼Œæˆ‘ä»¬ç”¨<code>key</code>æ¥è¡¨ç¤ºã€‚</li><li>é¡µå·ï¼Œæˆ‘ä»¬ç”¨<code>page_no</code>è¡¨ç¤ºã€‚</li></ul><p>æ‰€ä»¥æˆ‘ä»¬ä¸ºä¸Šè¾¹å‡ ä¸ªé¡µåšå¥½çš„ç›®å½•å°±åƒè¿™æ ·å­ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd282d6b9b9~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1caba0afo11fa1cli1nu070m16bg1j.png-119.1kB"><p>ä»¥<code>é¡µ28</code>ä¸ºä¾‹ï¼Œå®ƒå¯¹åº”<code>ç›®å½•é¡¹2</code>ï¼Œè¿™ä¸ªç›®å½•é¡¹ä¸­åŒ…å«ç€è¯¥é¡µçš„é¡µå·<code>28</code>ä»¥åŠè¯¥é¡µä¸­ç”¨æˆ·è®°å½•çš„æœ€å°ä¸»é”®å€¼<code>5</code>ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠå‡ ä¸ªç›®å½•é¡¹åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸Šè¿ç»­å­˜å‚¨ï¼Œæ¯”å¦‚æŠŠä»–ä»¬æ”¾åˆ°ä¸€ä¸ªæ•°ç»„é‡Œï¼Œå°±å¯ä»¥å®ç°æ ¹æ®ä¸»é”®å€¼å¿«é€ŸæŸ¥æ‰¾æŸæ¡è®°å½•çš„åŠŸèƒ½äº†ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³æ‰¾ä¸»é”®å€¼ä¸º<code>20</code>çš„è®°å½•ï¼Œå…·ä½“æŸ¥æ‰¾è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼š</p><ol><li>å…ˆä»ç›®å½•é¡¹ä¸­æ ¹æ®äºŒåˆ†æ³•å¿«é€Ÿç¡®å®šå‡ºä¸»é”®å€¼ä¸º<code>20</code>çš„è®°å½•åœ¨<code>ç›®å½•é¡¹3</code>ä¸­ï¼ˆå› ä¸º <code>12 &lt; 20 &lt; 209</code>ï¼‰ï¼Œå®ƒå¯¹åº”çš„é¡µæ˜¯<code>é¡µ9</code>ã€‚</li><li>å†æ ¹æ®å‰è¾¹è¯´çš„åœ¨é¡µä¸­æŸ¥æ‰¾è®°å½•çš„æ–¹å¼å»<code>é¡µ9</code>ä¸­å®šä½å…·ä½“çš„è®°å½•ã€‚</li></ol></li></ul><p>è‡³æ­¤ï¼Œé’ˆå¯¹æ•°æ®é¡µåšçš„ç®€æ˜“ç›®å½•å°±æå®šäº†ã€‚ä¸è¿‡å¿˜äº†è¯´äº†ï¼Œè¿™ä¸ª<code>ç›®å½•</code>æœ‰ä¸€ä¸ªåˆ«åï¼Œç§°ä¸º<code>ç´¢å¼•</code>ã€‚</p><h3 id="InnoDBä¸­çš„ç´¢å¼•æ–¹æ¡ˆ">InnoDBä¸­çš„ç´¢å¼•æ–¹æ¡ˆ</h3><p>ä¸Šè¾¹ä¹‹æ‰€ä»¥ç§°ä¸ºä¸€ä¸ªç®€æ˜“çš„ç´¢å¼•æ–¹æ¡ˆï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸ºäº†åœ¨æ ¹æ®ä¸»é”®å€¼è¿›è¡ŒæŸ¥æ‰¾æ—¶ä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½å…·ä½“çš„ç›®å½•é¡¹è€Œå‡è®¾æ‰€æœ‰ç›®å½•é¡¹éƒ½å¯ä»¥åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸Šè¿ç»­å­˜å‚¨ï¼Œä½†æ˜¯è¿™æ ·åšæœ‰å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li><code>InnoDB</code>æ˜¯ä½¿ç”¨é¡µæ¥ä½œä¸ºç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šèƒ½ä¿è¯<code>16KB</code>çš„è¿ç»­å­˜å‚¨ç©ºé—´ï¼Œè€Œéšç€è¡¨ä¸­è®°å½•æ•°é‡çš„å¢å¤šï¼Œéœ€è¦éå¸¸å¤§çš„è¿ç»­çš„å­˜å‚¨ç©ºé—´æ‰èƒ½æŠŠæ‰€æœ‰çš„ç›®å½•é¡¹éƒ½æ”¾ä¸‹ï¼Œè¿™å¯¹è®°å½•æ•°é‡éå¸¸å¤šçš„è¡¨æ˜¯ä¸ç°å®çš„ã€‚</li><li>æˆ‘ä»¬æ—¶å¸¸ä¼šå¯¹è®°å½•è¿›è¡Œå¢åˆ ï¼Œå‡è®¾æˆ‘ä»¬æŠŠ<code>é¡µ28</code>ä¸­çš„è®°å½•éƒ½åˆ é™¤äº†ï¼Œ<code>é¡µ28</code>ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ï¼Œé‚£æ„å‘³ç€<code>ç›®å½•é¡¹2</code>ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ï¼Œè¿™å°±éœ€è¦æŠŠ<code>ç›®å½•é¡¹2</code>åçš„ç›®å½•é¡¹éƒ½å‘å‰ç§»åŠ¨ä¸€ä¸‹ï¼Œè¿™ç§ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«çš„è®¾è®¡ä¸æ˜¯ä»€ä¹ˆå¥½ä¸»æ„ï½</li></ul><p>æ‰€ä»¥ï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬éœ€è¦ä¸€ç§å¯ä»¥çµæ´»ç®¡ç†æ‰€æœ‰<code>ç›®å½•é¡¹</code>çš„æ–¹å¼ã€‚ä»–ä»¬çµå…‰ä¹ç°ï¼Œå¿½ç„¶å‘ç°è¿™äº›<code>ç›®å½•é¡¹</code>å…¶å®é•¿å¾—è·Ÿæˆ‘ä»¬çš„ç”¨æˆ·è®°å½•å·®ä¸å¤šï¼Œåªä¸è¿‡<code>ç›®å½•é¡¹</code>ä¸­çš„ä¸¤ä¸ªåˆ—æ˜¯<code>ä¸»é”®</code>å’Œ<code>é¡µå·</code>è€Œå·²ï¼Œæ‰€ä»¥ä»–ä»¬å¤ç”¨äº†ä¹‹å‰å­˜å‚¨ç”¨æˆ·è®°å½•çš„æ•°æ®é¡µæ¥å­˜å‚¨ç›®å½•é¡¹ï¼Œä¸ºäº†å’Œç”¨æˆ·è®°å½•åšä¸€ä¸‹åŒºåˆ†ï¼Œæˆ‘ä»¬æŠŠè¿™äº›ç”¨æ¥è¡¨ç¤ºç›®å½•é¡¹çš„è®°å½•ç§°ä¸º<code>ç›®å½•é¡¹è®°å½•</code>ã€‚é‚£<code>InnoDB</code>æ€ä¹ˆåŒºåˆ†ä¸€æ¡è®°å½•æ˜¯æ™®é€šçš„<code>ç”¨æˆ·è®°å½•</code>è¿˜æ˜¯<code>ç›®å½•é¡¹è®°å½•</code>å‘¢ï¼Ÿåˆ«å¿˜äº†è®°å½•å¤´ä¿¡æ¯é‡Œçš„<code>record_type</code>å±æ€§ï¼Œå®ƒçš„å„ä¸ªå–å€¼ä»£è¡¨çš„æ„æ€å¦‚ä¸‹ï¼š</p><ul><li><code>0</code>ï¼šæ™®é€šçš„ç”¨æˆ·è®°å½•</li><li><code>1</code>ï¼šç›®å½•é¡¹è®°å½•</li><li><code>2</code>ï¼šæœ€å°è®°å½•</li><li><code>3</code>ï¼šæœ€å¤§è®°å½•</li></ul><p>å“ˆå“ˆï¼ŒåŸæ¥è¿™ä¸ªå€¼ä¸º<code>1</code>çš„<code>record_type</code>æ˜¯è¿™ä¸ªæ„æ€å‘€ï¼Œæˆ‘ä»¬æŠŠå‰è¾¹ä½¿ç”¨åˆ°çš„ç›®å½•é¡¹æ”¾åˆ°æ•°æ®é¡µä¸­çš„æ ·å­å°±æ˜¯è¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd295fd42b5~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1caahuomf15m11e5k19v1bf21inq9.png-145.9kB"><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬æ–°åˆ†é…äº†ä¸€ä¸ªç¼–å·ä¸º<code>30</code>çš„é¡µæ¥ä¸“é—¨å­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>ã€‚è¿™é‡Œå†æ¬¡å¼ºè°ƒä¸€é<code>ç›®å½•é¡¹è®°å½•</code>å’Œæ™®é€šçš„<code>ç”¨æˆ·è®°å½•</code>çš„ä¸åŒç‚¹ï¼š</p><ul><li><code>ç›®å½•é¡¹è®°å½•</code>çš„<code>record_type</code>å€¼æ˜¯1ï¼Œè€Œæ™®é€šç”¨æˆ·è®°å½•çš„<code>record_type</code>å€¼æ˜¯0ã€‚</li><li><code>ç›®å½•é¡¹è®°å½•</code>åªæœ‰ä¸»é”®å€¼å’Œé¡µçš„ç¼–å·ä¸¤ä¸ªåˆ—ï¼Œè€Œæ™®é€šçš„ç”¨æˆ·è®°å½•çš„åˆ—æ˜¯ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ï¼Œå¯èƒ½åŒ…å«å¾ˆå¤šåˆ—ï¼Œå¦å¤–è¿˜æœ‰<code>InnoDB</code>è‡ªå·±æ·»åŠ çš„éšè—åˆ—ã€‚</li><li>è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰åœ¨å” å¨è®°å½•å¤´ä¿¡æ¯çš„æ—¶å€™è¯´è¿‡ä¸€ä¸ªå«<code>min_rec_mask</code>çš„å±æ€§ä¹ˆï¼Œåªæœ‰åœ¨å­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µä¸­çš„ä¸»é”®å€¼æœ€å°çš„<code>ç›®å½•é¡¹è®°å½•</code>çš„<code>min_rec_mask</code>å€¼ä¸º<code>1</code>ï¼Œå…¶ä»–åˆ«çš„è®°å½•çš„<code>min_rec_mask</code>å€¼éƒ½æ˜¯<code>0</code>ã€‚</li></ul><p>é™¤äº†ä¸Šè¿°å‡ ç‚¹å¤–ï¼Œè¿™ä¸¤è€…å°±æ²¡å•¥å·®åˆ«äº†ï¼Œå®ƒä»¬ç”¨çš„æ˜¯ä¸€æ ·çš„æ•°æ®é¡µï¼ˆé¡µé¢ç±»å‹éƒ½æ˜¯<code>0x45BF</code>ï¼Œè¿™ä¸ªå±æ€§åœ¨<code>File Header</code>ä¸­ï¼Œå¿˜äº†çš„è¯å¯ä»¥ç¿»åˆ°å‰è¾¹çš„æ–‡ç« çœ‹ï¼‰ï¼Œé¡µçš„ç»„æˆç»“æ„ä¹Ÿæ˜¯ä¸€æ ·ä¸€æ ·çš„ï¼ˆå°±æ˜¯æˆ‘ä»¬å‰è¾¹ä»‹ç»è¿‡çš„7ä¸ªéƒ¨åˆ†ï¼‰ï¼Œéƒ½ä¼šä¸ºä¸»é”®å€¼ç”Ÿæˆ<code>Page Directory</code>ï¼ˆé¡µç›®å½•ï¼‰ï¼Œä»è€Œåœ¨æŒ‰ç…§ä¸»é”®å€¼è¿›è¡ŒæŸ¥æ‰¾æ—¶å¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚ç°åœ¨ä»¥æŸ¥æ‰¾ä¸»é”®ä¸º<code>20</code>çš„è®°å½•ä¸ºä¾‹ï¼Œæ ¹æ®æŸä¸ªä¸»é”®å€¼å»æŸ¥æ‰¾è®°å½•çš„æ­¥éª¤å°±å¯ä»¥å¤§è‡´æ‹†åˆ†æˆä¸‹è¾¹ä¸¤æ­¥ï¼š</p><ol><li>å…ˆåˆ°å­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µï¼Œä¹Ÿå°±æ˜¯é¡µ<code>30</code>ä¸­é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°å¯¹åº”ç›®å½•é¡¹ï¼Œå› ä¸º<code>12 &lt; 20 &lt; 209</code>ï¼Œæ‰€ä»¥å®šä½åˆ°å¯¹åº”çš„è®°å½•æ‰€åœ¨çš„é¡µå°±æ˜¯<code>é¡µ9</code>ã€‚</li><li>å†åˆ°å­˜å‚¨ç”¨æˆ·è®°å½•çš„<code>é¡µ9</code>ä¸­æ ¹æ®äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°ä¸»é”®å€¼ä¸º<code>20</code>çš„ç”¨æˆ·è®°å½•ã€‚</li></ol><p>è™½ç„¶è¯´<code>ç›®å½•é¡¹è®°å½•</code>ä¸­åªå­˜å‚¨ä¸»é”®å€¼å’Œå¯¹åº”çš„é¡µå·ï¼Œæ¯”ç”¨æˆ·è®°å½•éœ€è¦çš„å­˜å‚¨ç©ºé—´å°å¤šäº†ï¼Œä½†æ˜¯ä¸è®ºæ€ä¹ˆè¯´ä¸€ä¸ªé¡µåªæœ‰<code>16KB</code>å¤§å°ï¼Œèƒ½å­˜æ”¾çš„<code>ç›®å½•é¡¹è®°å½•</code>ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œé‚£å¦‚æœè¡¨ä¸­çš„æ•°æ®å¤ªå¤šï¼Œä»¥è‡³äºä¸€ä¸ªæ•°æ®é¡µä¸è¶³ä»¥å­˜æ”¾æ‰€æœ‰çš„<code>ç›®å½•é¡¹è®°å½•</code>ï¼Œè¯¥å’‹åŠå‘¢ï¼Ÿ</p><p>å½“ç„¶æ˜¯å†å¤šæ•´ä¸€ä¸ªå­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µå–½ï½ ä¸ºäº†å¤§å®¶æ›´å¥½çš„ç†è§£æ–°åˆ†é…ä¸€ä¸ª<code>ç›®å½•é¡¹è®°å½•</code>é¡µçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªå­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µæœ€å¤šåªèƒ½å­˜æ”¾4æ¡<code>ç›®å½•é¡¹è®°å½•</code>ï¼ˆè¯·æ³¨æ„æ˜¯å‡è®¾å“¦ï¼ŒçœŸå®æƒ…å†µä¸‹å¯ä»¥å­˜æ”¾å¥½å¤šæ¡çš„ï¼‰ï¼Œæ‰€ä»¥å¦‚æœæ­¤æ—¶æˆ‘ä»¬å†å‘ä¸Šå›¾ä¸­æ’å…¥ä¸€æ¡ä¸»é”®å€¼ä¸º<code>320</code>çš„ç”¨æˆ·è®°å½•çš„è¯ï¼Œé‚£å°±éœ€è¦åˆ†é…ä¸€ä¸ªæ–°çš„å­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µå–½ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd29ebc7a4c~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cacabsrh17a5133q1otf725gi92q.png-135.7kB"><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬æ’å…¥äº†ä¸€æ¡ä¸»é”®å€¼ä¸º<code>320</code>çš„ç”¨æˆ·è®°å½•ä¹‹åéœ€è¦ä¸¤ä¸ªæ–°çš„æ•°æ®é¡µï¼š</p><ul><li>ä¸ºå­˜å‚¨è¯¥ç”¨æˆ·è®°å½•è€Œæ–°ç”Ÿæˆäº†<code>é¡µ31</code>ã€‚</li><li>å› ä¸ºåŸå…ˆå­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„<code>é¡µ30</code>çš„å®¹é‡å·²æ»¡ï¼ˆæˆ‘ä»¬å‰è¾¹å‡è®¾åªèƒ½å­˜å‚¨4æ¡<code>ç›®å½•é¡¹è®°å½•</code>ï¼‰ï¼Œæ‰€ä»¥ä¸å¾—ä¸éœ€è¦ä¸€ä¸ªæ–°çš„<code>é¡µ32</code>æ¥å­˜æ”¾<code>é¡µ31</code>å¯¹åº”çš„ç›®å½•é¡¹ã€‚</li></ul><p>ç°åœ¨å› ä¸ºå­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µä¸æ­¢ä¸€ä¸ªï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æ ¹æ®ä¸»é”®å€¼æŸ¥æ‰¾ä¸€æ¡ç”¨æˆ·è®°å½•å¤§è‡´éœ€è¦3ä¸ªæ­¥éª¤ï¼Œä»¥æŸ¥æ‰¾ä¸»é”®å€¼ä¸º<code>20</code>çš„è®°å½•ä¸ºä¾‹ï¼š</p><ol><li><p>ç¡®å®š<code>ç›®å½•é¡¹è®°å½•</code>é¡µ</p><p>æˆ‘ä»¬ç°åœ¨çš„å­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µæœ‰ä¸¤ä¸ªï¼Œå³<code>é¡µ30</code>å’Œ<code>é¡µ32</code>ï¼Œåˆå› ä¸º<code>é¡µ30</code>è¡¨ç¤ºçš„ç›®å½•é¡¹çš„ä¸»é”®å€¼çš„èŒƒå›´æ˜¯<code>[1, 320)</code>ï¼Œ<code>é¡µ32</code>è¡¨ç¤ºçš„ç›®å½•é¡¹çš„ä¸»é”®å€¼ä¸å°äº<code>320</code>ï¼Œæ‰€ä»¥ä¸»é”®å€¼ä¸º<code>20</code>çš„è®°å½•å¯¹åº”çš„ç›®å½•é¡¹è®°å½•åœ¨<code>é¡µ30</code>ä¸­ã€‚</p></li><li><p>é€šè¿‡<code>ç›®å½•é¡¹è®°å½•</code>é¡µç¡®å®šç”¨æˆ·è®°å½•çœŸå®æ‰€åœ¨çš„é¡µã€‚</p><p>åœ¨ä¸€ä¸ªå­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µä¸­é€šè¿‡ä¸»é”®å€¼å®šä½ä¸€æ¡ç›®å½•é¡¹è®°å½•çš„æ–¹å¼è¯´è¿‡äº†ï¼Œä¸èµ˜è¿°äº†ï½</p></li><li><p>åœ¨çœŸå®å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µä¸­å®šä½åˆ°å…·ä½“çš„è®°å½•ã€‚</p><p>åœ¨ä¸€ä¸ªå­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µä¸­é€šè¿‡ä¸»é”®å€¼å®šä½ä¸€æ¡ç”¨æˆ·è®°å½•çš„æ–¹å¼å·²ç»è¯´è¿‡200éäº†ï¼Œä½ å†ä¸ä¼šæˆ‘å°±ï¼Œæˆ‘å°±ï¼Œæˆ‘å°±æ±‚ä½ åˆ°ä¸Šä¸€ç¯‡å” å¨æ•°æ®é¡µç»“æ„çš„æ–‡ç« ä¸­å¤šçœ‹å‡ éï¼Œæ±‚ä½ äº†ï½</p></li></ol><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåœ¨è¿™ä¸ªæŸ¥è¯¢æ­¥éª¤çš„ç¬¬1æ­¥ä¸­æˆ‘ä»¬éœ€è¦å®šä½å­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µï¼Œä½†æ˜¯è¿™äº›é¡µåœ¨å­˜å‚¨ç©ºé—´ä¸­ä¹Ÿå¯èƒ½ä¸æŒ¨ç€ï¼Œå¦‚æœæˆ‘ä»¬è¡¨ä¸­çš„æ•°æ®éå¸¸å¤šåˆ™ä¼šäº§ç”Ÿå¾ˆå¤šå­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆæ ¹æ®ä¸»é”®å€¼å¿«é€Ÿå®šä½ä¸€ä¸ªå­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µå‘¢ï¼Ÿå…¶å®ä¹Ÿç®€å•ï¼Œä¸ºè¿™äº›å­˜å‚¨<code>ç›®å½•é¡¹è®°å½•</code>çš„é¡µå†ç”Ÿæˆä¸€ä¸ªæ›´é«˜çº§çš„ç›®å½•ï¼Œå°±åƒæ˜¯ä¸€ä¸ªå¤šçº§ç›®å½•ä¸€æ ·ï¼Œå¤§ç›®å½•é‡ŒåµŒå¥—å°ç›®å½•ï¼Œå°ç›®å½•é‡Œæ‰æ˜¯å®é™…çš„æ•°æ®ï¼Œæ‰€ä»¥ç°åœ¨å„ä¸ªé¡µçš„ç¤ºæ„å›¾å°±æ˜¯è¿™æ ·å­ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd2a6c7a65f~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cacafpso19vpkik1j5rtrd17cm3a.png-158.1kB"><p>å¦‚å›¾ï¼Œæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªå­˜å‚¨æ›´é«˜çº§ç›®å½•é¡¹çš„<code>é¡µ33</code>ï¼Œè¿™ä¸ªé¡µä¸­çš„ä¸¤æ¡è®°å½•åˆ†åˆ«ä»£è¡¨<code>é¡µ30</code>å’Œ<code>é¡µ32</code>ï¼Œå¦‚æœç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼åœ¨<code>[1, 320)</code>ä¹‹é—´ï¼Œåˆ™åˆ°<code>é¡µ30</code>ä¸­æŸ¥æ‰¾æ›´è¯¦ç»†çš„<code>ç›®å½•é¡¹è®°å½•</code>ï¼Œå¦‚æœä¸»é”®å€¼ä¸å°äº<code>320</code>çš„è¯ï¼Œå°±åˆ°<code>é¡µ32</code>ä¸­æŸ¥æ‰¾æ›´è¯¦ç»†çš„<code>ç›®å½•é¡¹è®°å½•</code>ã€‚ä¸è¿‡è¿™å¼ å›¾å¥½æ¼‚äº®å–”ï¼Œéšç€è¡¨ä¸­è®°å½•çš„å¢åŠ ï¼Œè¿™ä¸ªç›®å½•çš„å±‚çº§ä¼šç»§ç»­å¢åŠ ï¼Œå¦‚æœç®€åŒ–ä¸€ä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹è¾¹è¿™ä¸ªå›¾æ¥æè¿°å®ƒï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd2a6fb9126~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ca80gps314u9121u1rdp9r7md8cm.png-55.6kB"><p>è¿™ç©æ„å„¿åƒä¸åƒä¸€ä¸ªå€’è¿‡æ¥çš„<code>æ ‘</code>å‘€ï¼Œä¸Šå¤´æ˜¯æ ‘æ ¹ï¼Œä¸‹å¤´æ˜¯æ ‘å¶ï¼å…¶å®è¿™æ˜¯ä¸€ç§ç»„ç»‡æ•°æ®çš„å½¢å¼ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒçš„åç§°æ˜¯<code>B+</code>æ ‘ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>ä¸ºå•¥å«`B+`å‘¢ï¼Œ`B`æ ‘æ˜¯ä¸ªå•¥ï¼Ÿå–”å¯¹ä¸èµ·ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬è®¨è®ºçš„èŒƒå›´ï¼Œä½ å¯ä»¥å»æ‰¾ä¸€æœ¬æ•°æ®ç»“æ„æˆ–ç®—æ³•çš„ä¹¦æ¥çœ‹ã€‚ä»€ä¹ˆï¼Ÿæ•°æ®ç»“æ„çš„ä¹¦çœ‹ä¸æ‡‚ï¼Ÿç­‰æˆ‘ï½<br></code></pre></td></tr></table></figure><p>ä¸è®ºæ˜¯å­˜æ”¾ç”¨æˆ·è®°å½•çš„æ•°æ®é¡µï¼Œè¿˜æ˜¯å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„æ•°æ®é¡µï¼Œæˆ‘ä»¬éƒ½æŠŠå®ƒä»¬å­˜æ”¾åˆ°<code>B+</code>æ ‘è¿™ä¸ªæ•°æ®ç»“æ„ä¸­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿç§°è¿™äº›æ•°æ®é¡µä¸º<code>èŠ‚ç‚¹</code>ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬çš„å®é™…ç”¨æˆ·è®°å½•å…¶å®éƒ½å­˜æ”¾åœ¨B+æ ‘çš„æœ€åº•å±‚çš„èŠ‚ç‚¹ä¸Šï¼Œè¿™äº›èŠ‚ç‚¹ä¹Ÿè¢«ç§°ä¸º<code>å¶å­èŠ‚ç‚¹</code>æˆ–<code>å¶èŠ‚ç‚¹</code>ï¼Œå…¶ä½™ç”¨æ¥å­˜æ”¾<code>ç›®å½•é¡¹</code>çš„èŠ‚ç‚¹ç§°ä¸º<code>éå¶å­èŠ‚ç‚¹</code>æˆ–è€…<code>å†…èŠ‚ç‚¹</code>ï¼Œå…¶ä¸­<code>B+</code>æ ‘æœ€ä¸Šè¾¹çš„é‚£ä¸ªèŠ‚ç‚¹ä¹Ÿç§°ä¸º<code>æ ¹èŠ‚ç‚¹</code>ã€‚</p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸€ä¸ª<code>B+</code>æ ‘çš„èŠ‚ç‚¹å…¶å®å¯ä»¥åˆ†æˆå¥½å¤šå±‚ï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬ä¸ºäº†è®¨è®ºæ–¹ä¾¿ï¼Œè§„å®šæœ€ä¸‹è¾¹çš„é‚£å±‚ï¼Œä¹Ÿå°±æ˜¯å­˜æ”¾æˆ‘ä»¬ç”¨æˆ·è®°å½•çš„é‚£å±‚ä¸ºç¬¬<code>0</code>å±‚ï¼Œä¹‹åä¾æ¬¡å¾€ä¸ŠåŠ ã€‚ä¹‹å‰çš„è®¨è®ºæˆ‘ä»¬åšäº†ä¸€ä¸ªéå¸¸æç«¯çš„å‡è®¾ï¼šå­˜æ”¾ç”¨æˆ·è®°å½•çš„é¡µæœ€å¤šå­˜æ”¾3æ¡è®°å½•ï¼Œå­˜æ”¾ç›®å½•é¡¹è®°å½•çš„é¡µæœ€å¤šå­˜æ”¾4æ¡è®°å½•ã€‚å…¶å®çœŸå®ç¯å¢ƒä¸­ä¸€ä¸ªé¡µå­˜æ”¾çš„è®°å½•æ•°é‡æ˜¯éå¸¸å¤§çš„ï¼Œå‡è®¾ï¼Œå‡è®¾ï¼Œå‡è®¾æ‰€æœ‰å­˜æ”¾ç”¨æˆ·è®°å½•çš„å¶å­èŠ‚ç‚¹ä»£è¡¨çš„æ•°æ®é¡µå¯ä»¥å­˜æ”¾100æ¡ç”¨æˆ·è®°å½•ï¼Œæ‰€æœ‰å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„å†…èŠ‚ç‚¹ä»£è¡¨çš„æ•°æ®é¡µå¯ä»¥å­˜æ”¾1000æ¡ç›®å½•é¡¹è®°å½•ï¼Œé‚£ä¹ˆï¼š</p><ul><li>å¦‚æœ<code>B+</code>æ ‘åªæœ‰1å±‚ï¼Œä¹Ÿå°±æ˜¯åªæœ‰1ä¸ªç”¨äºå­˜æ”¾ç”¨æˆ·è®°å½•çš„èŠ‚ç‚¹ï¼Œæœ€å¤šèƒ½å­˜æ”¾<code>100</code>æ¡è®°å½•ã€‚</li><li>å¦‚æœ<code>B+</code>æ ‘æœ‰2å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾<code>1000Ã—100=100000</code>æ¡è®°å½•ã€‚</li><li>å¦‚æœ<code>B+</code>æ ‘æœ‰3å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾<code>1000Ã—1000Ã—100=100000000</code>æ¡è®°å½•ã€‚</li><li>å¦‚æœ<code>B+</code>æ ‘æœ‰4å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾<code>1000Ã—1000Ã—1000Ã—100=100000000000</code>æ¡è®°å½•ã€‚å“‡å’”å’”ï½è¿™ä¹ˆå¤šçš„è®°å½•ï¼ï¼ï¼</li></ul><p>ä½ çš„è¡¨é‡Œèƒ½å­˜æ”¾<code>100000000000</code>æ¡è®°å½•ä¹ˆï¼Ÿæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨åˆ°çš„<code>B+</code>æ ‘éƒ½ä¸ä¼šè¶…è¿‡4å±‚ï¼Œé‚£æˆ‘ä»¬é€šè¿‡ä¸»é”®å€¼å»æŸ¥æ‰¾æŸæ¡è®°å½•æœ€å¤šåªéœ€è¦åš4ä¸ªé¡µé¢å†…çš„æŸ¥æ‰¾ï¼ˆæŸ¥æ‰¾3ä¸ªç›®å½•é¡¹é¡µå’Œä¸€ä¸ªç”¨æˆ·è®°å½•é¡µï¼‰ï¼Œåˆå› ä¸ºåœ¨æ¯ä¸ªé¡µé¢å†…æœ‰æ‰€è°“çš„<code>Page Directory</code>ï¼ˆé¡µç›®å½•ï¼‰ï¼Œæ‰€ä»¥åœ¨é¡µé¢å†…ä¹Ÿå¯ä»¥é€šè¿‡äºŒåˆ†æ³•å®ç°å¿«é€Ÿå®šä½è®°å½•ï¼Œè¿™ä¸æ˜¯å¾ˆç‰›ä¹ˆï¼Œå“ˆå“ˆï¼</p><h4 id="èšç°‡ç´¢å¼•">èšç°‡ç´¢å¼•</h4><p>æˆ‘ä»¬ä¸Šè¾¹ä»‹ç»çš„<code>B+</code>æ ‘æœ¬èº«å°±æ˜¯ä¸€ä¸ªç›®å½•ï¼Œæˆ–è€…è¯´æœ¬èº«å°±æ˜¯ä¸€ä¸ªç´¢å¼•ã€‚å®ƒæœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p><ol><li><p>ä½¿ç”¨è®°å½•ä¸»é”®å€¼çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åºï¼Œè¿™åŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢çš„å«ä¹‰ï¼š</p><ul><li>é¡µå†…çš„è®°å½•æ˜¯æŒ‰ç…§ä¸»é”®çš„å¤§å°é¡ºåºæ’æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚</li><li>å„ä¸ªå­˜æ”¾ç”¨æˆ·è®°å½•çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚</li><li>å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„é¡µåˆ†ä¸ºä¸åŒçš„å±‚æ¬¡ï¼Œåœ¨åŒä¸€å±‚æ¬¡ä¸­çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç›®å½•é¡¹è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚</li></ul></li><li><p><code>B+</code>æ ‘çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</p><p>æ‰€è°“å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œå°±æ˜¯æŒ‡è¿™ä¸ªè®°å½•ä¸­å­˜å‚¨äº†æ‰€æœ‰åˆ—çš„å€¼ï¼ˆåŒ…æ‹¬éšè—åˆ—ï¼‰ã€‚</p></li></ol><p>æˆ‘ä»¬æŠŠå…·æœ‰è¿™ä¸¤ç§ç‰¹æ€§çš„<code>B+</code>æ ‘ç§°ä¸º<code>èšç°‡ç´¢å¼•</code>ï¼Œæ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜æ”¾åœ¨è¿™ä¸ª<code>èšç°‡ç´¢å¼•</code>çš„å¶å­èŠ‚ç‚¹å¤„ã€‚è¿™ç§<code>èšç°‡ç´¢å¼•</code>å¹¶ä¸éœ€è¦æˆ‘ä»¬åœ¨<code>MySQL</code>è¯­å¥ä¸­æ˜¾å¼çš„ä½¿ç”¨<code>INDEX</code>è¯­å¥å»åˆ›å»ºï¼ˆåè¾¹ä¼šä»‹ç»ç´¢å¼•ç›¸å…³çš„è¯­å¥ï¼‰ï¼Œ<code>InnoDB</code>å­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨çš„ä¸ºæˆ‘ä»¬åˆ›å»ºèšç°‡ç´¢å¼•ã€‚å¦å¤–æœ‰è¶£çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨<code>InnoDB</code>å­˜å‚¨å¼•æ“ä¸­ï¼Œ<code>èšç°‡ç´¢å¼•</code>å°±æ˜¯æ•°æ®çš„å­˜å‚¨æ–¹å¼ï¼ˆæ‰€æœ‰çš„ç”¨æˆ·è®°å½•éƒ½å­˜å‚¨åœ¨äº†<code>å¶å­èŠ‚ç‚¹</code>ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ç´¢å¼•å³æ•°æ®ï¼Œæ•°æ®å³ç´¢å¼•ã€‚</p><h4 id="äºŒçº§ç´¢å¼•">äºŒçº§ç´¢å¼•</h4><p>å¤§å®¶æœ‰æœ¨æœ‰å‘ç°ï¼Œä¸Šè¾¹ä»‹ç»çš„<code>èšç°‡ç´¢å¼•</code>åªèƒ½åœ¨æœç´¢æ¡ä»¶æ˜¯ä¸»é”®å€¼æ—¶æ‰èƒ½å‘æŒ¥ä½œç”¨ï¼Œå› ä¸º<code>B+</code>æ ‘ä¸­çš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§ä¸»é”®è¿›è¡Œæ’åºçš„ã€‚é‚£å¦‚æœæˆ‘ä»¬æƒ³ä»¥åˆ«çš„åˆ—ä½œä¸ºæœç´¢æ¡ä»¶è¯¥å’‹åŠå‘¢ï¼Ÿéš¾é“åªèƒ½ä»å¤´åˆ°å°¾æ²¿ç€é“¾è¡¨ä¾æ¬¡éå†è®°å½•ä¹ˆï¼Ÿ</p><p>ä¸ï¼Œæˆ‘ä»¬å¯ä»¥å¤šå»ºå‡ æ£µ<code>B+</code>æ ‘ï¼Œä¸åŒçš„<code>B+</code>æ ‘ä¸­çš„æ•°æ®é‡‡ç”¨ä¸åŒçš„æ’åºè§„åˆ™ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬ç”¨<code>c2</code>åˆ—çš„å¤§å°ä½œä¸ºæ•°æ®é¡µã€é¡µä¸­è®°å½•çš„æ’åºè§„åˆ™ï¼Œå†å»ºä¸€æ£µ<code>B+</code>æ ‘ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd2a89adfa5~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cactc8jg14j91likvmd1h8cn3o4h.png-161.6kB"><p>è¿™ä¸ª<code>B+</code>æ ‘ä¸ä¸Šè¾¹ä»‹ç»çš„èšç°‡ç´¢å¼•æœ‰å‡ å¤„ä¸åŒï¼š</p><ul><li>ä½¿ç”¨è®°å½•<code>c2</code>åˆ—çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åºï¼Œè¿™åŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢çš„å«ä¹‰ï¼š<ul><li>é¡µå†…çš„è®°å½•æ˜¯æŒ‰ç…§<code>c2</code>åˆ—çš„å¤§å°é¡ºåºæ’æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚</li><li>å„ä¸ªå­˜æ”¾ç”¨æˆ·è®°å½•çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­è®°å½•çš„<code>c2</code>åˆ—å¤§å°é¡ºåºæ’æˆä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚</li><li>å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„é¡µåˆ†ä¸ºä¸åŒçš„å±‚æ¬¡ï¼Œåœ¨åŒä¸€å±‚æ¬¡ä¸­çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç›®å½•é¡¹è®°å½•çš„<code>c2</code>åˆ—å¤§å°é¡ºåºæ’æˆä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚</li></ul></li><li><code>B+</code>æ ‘çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„å¹¶ä¸æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œè€Œåªæ˜¯<code>c2åˆ—+ä¸»é”®</code>è¿™ä¸¤ä¸ªåˆ—çš„å€¼ã€‚</li><li>ç›®å½•é¡¹è®°å½•ä¸­ä¸å†æ˜¯<code>ä¸»é”®+é¡µå·</code>çš„æ­é…ï¼Œè€Œå˜æˆäº†<code>c2åˆ—+é¡µå·</code>çš„æ­é…ã€‚</li></ul><p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬ç°åœ¨æƒ³é€šè¿‡<code>c2</code>åˆ—çš„å€¼æŸ¥æ‰¾æŸäº›è®°å½•çš„è¯å°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬åˆšåˆšå»ºå¥½çš„è¿™ä¸ª<code>B+</code>æ ‘äº†ã€‚ä»¥æŸ¥æ‰¾<code>c2</code>åˆ—çš„å€¼ä¸º<code>4</code>çš„è®°å½•ä¸ºä¾‹ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>ç¡®å®š<code>ç›®å½•é¡¹è®°å½•</code>é¡µ</p><p>æ ¹æ®<code>æ ¹é¡µé¢</code>ï¼Œä¹Ÿå°±æ˜¯<code>é¡µ44</code>ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ°<code>ç›®å½•é¡¹è®°å½•</code>æ‰€åœ¨çš„é¡µä¸º<code>é¡µ42</code>ï¼ˆå› ä¸º<code>2 &lt; 4 &lt; 9</code>ï¼‰ã€‚</p></li><li><p>é€šè¿‡<code>ç›®å½•é¡¹è®°å½•</code>é¡µç¡®å®šç”¨æˆ·è®°å½•çœŸå®æ‰€åœ¨çš„é¡µã€‚</p><p>åœ¨<code>é¡µ42</code>ä¸­å¯ä»¥å¿«é€Ÿå®šä½åˆ°å®é™…å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µï¼Œä½†æ˜¯ç”±äº<code>c2</code>åˆ—å¹¶æ²¡æœ‰å”¯ä¸€æ€§çº¦æŸï¼Œæ‰€ä»¥<code>c2</code>åˆ—å€¼ä¸º<code>4</code>çš„è®°å½•å¯èƒ½åˆ†å¸ƒåœ¨å¤šä¸ªæ•°æ®é¡µä¸­ï¼Œåˆå› ä¸º<code>2 &lt; 4 â‰¤ 4</code>ï¼Œæ‰€ä»¥ç¡®å®šå®é™…å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µåœ¨<code>é¡µ34</code>å’Œ<code>é¡µ35</code>ä¸­ã€‚</p></li><li><p>åœ¨çœŸå®å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µä¸­å®šä½åˆ°å…·ä½“çš„è®°å½•ã€‚</p><p>åˆ°<code>é¡µ34</code>å’Œ<code>é¡µ35</code>ä¸­å®šä½åˆ°å…·ä½“çš„è®°å½•ã€‚</p></li><li><p>ä½†æ˜¯è¿™ä¸ª<code>B+</code>æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•åªå­˜å‚¨äº†<code>c2</code>å’Œ<code>c1</code>ï¼ˆä¹Ÿå°±æ˜¯<code>ä¸»é”®</code>ï¼‰ä¸¤ä¸ªåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å†æ ¹æ®ä¸»é”®å€¼å»èšç°‡ç´¢å¼•ä¸­å†æŸ¥æ‰¾ä¸€éå®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</p></li></ol><p>å„ä½å„ä½ï¼Œçœ‹åˆ°æ­¥éª¤4çš„æ“ä½œäº†ä¹ˆï¼Ÿæˆ‘ä»¬æ ¹æ®è¿™ä¸ªä»¥<code>c2</code>åˆ—å¤§å°æ’åºçš„<code>B+</code>æ ‘åªèƒ½ç¡®å®šæˆ‘ä»¬è¦æŸ¥æ‰¾è®°å½•çš„ä¸»é”®å€¼ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æ ¹æ®<code>c2</code>åˆ—çš„å€¼æŸ¥æ‰¾åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•çš„è¯ï¼Œä»ç„¶éœ€è¦åˆ°<code>èšç°‡ç´¢å¼•</code>ä¸­å†æŸ¥ä¸€éï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸º<code>å›è¡¨</code>ã€‚ä¹Ÿå°±æ˜¯æ ¹æ®<code>c2</code>åˆ—çš„å€¼æŸ¥è¯¢ä¸€æ¡å®Œæ•´çš„ç”¨æˆ·è®°å½•éœ€è¦ä½¿ç”¨åˆ°<code>2</code>æ£µ<code>B+</code>æ ‘ï¼ï¼ï¼</p><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦ä¸€æ¬¡<code>å›è¡¨</code>æ“ä½œå‘¢ï¼Ÿç›´æ¥æŠŠå®Œæ•´çš„ç”¨æˆ·è®°å½•æ”¾åˆ°<code>å¶å­èŠ‚ç‚¹</code>ä¸å°±å¥½äº†ä¹ˆï¼Ÿä½ è¯´çš„å¯¹ï¼Œå¦‚æœæŠŠå®Œæ•´çš„ç”¨æˆ·è®°å½•æ”¾åˆ°<code>å¶å­èŠ‚ç‚¹</code>æ˜¯å¯ä»¥ä¸ç”¨<code>å›è¡¨</code>ï¼Œä½†æ˜¯å¤ªå åœ°æ–¹äº†å‘€ï½ç›¸å½“äºæ¯å»ºç«‹ä¸€æ£µ<code>B+</code>æ ‘éƒ½éœ€è¦æŠŠæ‰€æœ‰çš„ç”¨æˆ·è®°å½•å†éƒ½æ‹·è´ä¸€éï¼Œè¿™å°±æœ‰ç‚¹å¤ªæµªè´¹å­˜å‚¨ç©ºé—´äº†ã€‚å› ä¸ºè¿™ç§æŒ‰ç…§<code>éä¸»é”®åˆ—</code>å»ºç«‹çš„<code>B+</code>æ ‘éœ€è¦ä¸€æ¬¡<code>å›è¡¨</code>æ“ä½œæ‰å¯ä»¥å®šä½åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œæ‰€ä»¥è¿™ç§<code>B+</code>æ ‘ä¹Ÿè¢«ç§°ä¸º<code>äºŒçº§ç´¢å¼•</code>ï¼ˆè‹±æ–‡å<code>secondary index</code>ï¼‰ï¼Œæˆ–è€…<code>è¾…åŠ©ç´¢å¼•</code>ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯<code>c2</code>åˆ—çš„å¤§å°ä½œä¸º<code>B+</code>æ ‘çš„æ’åºè§„åˆ™ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿç§°è¿™ä¸ª<code>B+</code>æ ‘ä¸ºä¸ºc2åˆ—å»ºç«‹çš„ç´¢å¼•ã€‚</p><h5 id="è”åˆç´¢å¼•">è”åˆç´¢å¼•</h5><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶ä»¥å¤šä¸ªåˆ—çš„å¤§å°ä½œä¸ºæ’åºè§„åˆ™ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶ä¸ºå¤šä¸ªåˆ—å»ºç«‹ç´¢å¼•ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬æƒ³è®©<code>B+</code>æ ‘æŒ‰ç…§<code>c2</code>å’Œ<code>c3</code>åˆ—çš„å¤§å°è¿›è¡Œæ’åºï¼Œè¿™ä¸ªåŒ…å«ä¸¤å±‚å«ä¹‰ï¼š</p><ul><li>å…ˆæŠŠå„ä¸ªè®°å½•å’Œé¡µæŒ‰ç…§<code>c2</code>åˆ—è¿›è¡Œæ’åºã€‚</li><li>åœ¨è®°å½•çš„<code>c2</code>åˆ—ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨<code>c3</code>åˆ—è¿›è¡Œæ’åº</li></ul><p>ä¸º<code>c2</code>å’Œ<code>c3</code>åˆ—å»ºç«‹çš„ç´¢å¼•çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd2b0b70d72~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1d80rmun21al711ok1tvo1i161rnpp.png-172.2kB"><p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ç‚¹ï¼š</p><ul><li>æ¯æ¡<code>ç›®å½•é¡¹è®°å½•</code>éƒ½ç”±<code>c2</code>ã€<code>c3</code>ã€<code>é¡µå·</code>è¿™ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå„æ¡è®°å½•å…ˆæŒ‰ç…§<code>c2</code>åˆ—çš„å€¼è¿›è¡Œæ’åºï¼Œå¦‚æœè®°å½•çš„<code>c2</code>åˆ—ç›¸åŒï¼Œåˆ™æŒ‰ç…§<code>c3</code>åˆ—çš„å€¼è¿›è¡Œæ’åºã€‚</li><li><code>B+</code>æ ‘å¶å­èŠ‚ç‚¹å¤„çš„ç”¨æˆ·è®°å½•ç”±<code>c2</code>ã€<code>c3</code>å’Œä¸»é”®<code>c1</code>åˆ—ç»„æˆã€‚</li></ul><p>åƒä¸‡è¦æ³¨æ„ä¸€ç‚¹ï¼Œä»¥c2å’Œc3åˆ—çš„å¤§å°ä¸ºæ’åºè§„åˆ™å»ºç«‹çš„B+æ ‘ç§°ä¸ºè”åˆç´¢å¼•ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªäºŒçº§ç´¢å¼•ã€‚å®ƒçš„æ„æ€ä¸åˆ†åˆ«ä¸ºc2å’Œc3åˆ—åˆ†åˆ«å»ºç«‹ç´¢å¼•çš„è¡¨è¿°æ˜¯ä¸åŒçš„ï¼Œä¸åŒç‚¹å¦‚ä¸‹ï¼š</p><ul><li>å»ºç«‹<code>è”åˆç´¢å¼•</code>åªä¼šå»ºç«‹å¦‚ä¸Šå›¾ä¸€æ ·çš„1æ£µ<code>B+</code>æ ‘ã€‚</li><li>ä¸ºc2å’Œc3åˆ—åˆ†åˆ«å»ºç«‹ç´¢å¼•ä¼šåˆ†åˆ«ä»¥<code>c2</code>å’Œ<code>c3</code>åˆ—çš„å¤§å°ä¸ºæ’åºè§„åˆ™å»ºç«‹2æ£µ<code>B+</code>æ ‘ã€‚</li></ul><h3 id="InnoDBçš„B-æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹">InnoDBçš„B+æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹</h3><h4 id="æ ¹é¡µé¢ä¸‡å¹´ä¸åŠ¨çª">æ ¹é¡µé¢ä¸‡å¹´ä¸åŠ¨çª</h4><p>æˆ‘ä»¬å‰è¾¹ä»‹ç»<code>B+</code>æ ‘ç´¢å¼•çš„æ—¶å€™ï¼Œä¸ºäº†å¤§å®¶ç†è§£ä¸Šçš„æ–¹ä¾¿ï¼Œå…ˆæŠŠå­˜å‚¨ç”¨æˆ·è®°å½•çš„å¶å­èŠ‚ç‚¹éƒ½ç”»å‡ºæ¥ï¼Œç„¶åæ¥ç€ç”»å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„å†…èŠ‚ç‚¹ï¼Œå®é™…ä¸Š<code>B+</code>æ ‘çš„å½¢æˆè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>æ¯å½“ä¸ºæŸä¸ªè¡¨åˆ›å»ºä¸€ä¸ª<code>B+</code>æ ‘ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ä¸æ˜¯äººä¸ºåˆ›å»ºçš„ï¼Œé»˜è®¤å°±æœ‰ï¼‰çš„æ—¶å€™ï¼Œéƒ½ä¼šä¸ºè¿™ä¸ªç´¢å¼•åˆ›å»ºä¸€ä¸ª<code>æ ¹èŠ‚ç‚¹</code>é¡µé¢ã€‚æœ€å¼€å§‹è¡¨ä¸­æ²¡æœ‰æ•°æ®çš„æ—¶å€™ï¼Œæ¯ä¸ª<code>B+</code>æ ‘ç´¢å¼•å¯¹åº”çš„<code>æ ¹èŠ‚ç‚¹</code>ä¸­æ—¢æ²¡æœ‰ç”¨æˆ·è®°å½•ï¼Œä¹Ÿæ²¡æœ‰ç›®å½•é¡¹è®°å½•ã€‚</li><li>éšåå‘è¡¨ä¸­æ’å…¥ç”¨æˆ·è®°å½•æ—¶ï¼Œå…ˆæŠŠç”¨æˆ·è®°å½•å­˜å‚¨åˆ°è¿™ä¸ª<code>æ ¹èŠ‚ç‚¹</code>ä¸­ã€‚</li><li>å½“<code>æ ¹èŠ‚ç‚¹</code>ä¸­çš„å¯ç”¨ç©ºé—´ç”¨å®Œæ—¶ç»§ç»­æ’å…¥è®°å½•ï¼Œæ­¤æ—¶ä¼šå°†<code>æ ¹èŠ‚ç‚¹</code>ä¸­çš„æ‰€æœ‰è®°å½•å¤åˆ¶åˆ°ä¸€ä¸ªæ–°åˆ†é…çš„é¡µï¼Œæ¯”å¦‚<code>é¡µa</code>ä¸­ï¼Œç„¶åå¯¹è¿™ä¸ªæ–°é¡µè¿›è¡Œ<code>é¡µåˆ†è£‚</code>çš„æ“ä½œï¼Œå¾—åˆ°å¦ä¸€ä¸ªæ–°é¡µï¼Œæ¯”å¦‚<code>é¡µb</code>ã€‚è¿™æ—¶æ–°æ’å…¥çš„è®°å½•æ ¹æ®é”®å€¼ï¼ˆä¹Ÿå°±æ˜¯èšç°‡ç´¢å¼•ä¸­çš„ä¸»é”®å€¼ï¼ŒäºŒçº§ç´¢å¼•ä¸­å¯¹åº”çš„ç´¢å¼•åˆ—çš„å€¼ï¼‰çš„å¤§å°å°±ä¼šè¢«åˆ†é…åˆ°<code>é¡µa</code>æˆ–è€…<code>é¡µb</code>ä¸­ï¼Œè€Œ<code>æ ¹èŠ‚ç‚¹</code>ä¾¿å‡çº§ä¸ºå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µã€‚</li></ul><p>è¿™ä¸ªè¿‡ç¨‹éœ€è¦å¤§å®¶ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼šä¸€ä¸ªB+æ ‘ç´¢å¼•çš„æ ¹èŠ‚ç‚¹è‡ªè¯ç”Ÿä¹‹æ—¥èµ·ï¼Œä¾¿ä¸ä¼šå†ç§»åŠ¨ã€‚è¿™æ ·åªè¦æˆ‘ä»¬å¯¹æŸä¸ªè¡¨å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆå®ƒçš„<code>æ ¹èŠ‚ç‚¹</code>çš„é¡µå·ä¾¿ä¼šè¢«è®°å½•åˆ°æŸä¸ªåœ°æ–¹ï¼Œç„¶åå‡¡æ˜¯<code>InnoDB</code>å­˜å‚¨å¼•æ“éœ€è¦ç”¨åˆ°è¿™ä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œéƒ½ä¼šä»é‚£ä¸ªå›ºå®šçš„åœ°æ–¹å–å‡º<code>æ ¹èŠ‚ç‚¹</code>çš„é¡µå·ï¼Œä»è€Œæ¥è®¿é—®è¿™ä¸ªç´¢å¼•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>è·Ÿå¤§å®¶å‰§é€ä¸€ä¸‹ï¼Œè¿™ä¸ªå­˜å‚¨æŸä¸ªç´¢å¼•çš„æ ¹èŠ‚ç‚¹åœ¨å“ªä¸ªé¡µé¢ä¸­çš„ä¿¡æ¯å°±æ˜¯ä¼ è¯´ä¸­çš„æ•°æ®å­—å…¸ä¸­çš„ä¸€é¡¹ä¿¡æ¯ï¼Œå…³äºæ›´å¤šæ•°æ®å­—å…¸çš„å†…å®¹ï¼Œåè¾¹ä¼šè¯¦ç»†å” å¨ï¼Œåˆ«ç€æ€¥å“ˆã€‚<br></code></pre></td></tr></table></figure><h4 id="å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å”¯ä¸€æ€§">å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å”¯ä¸€æ€§</h4><p>æˆ‘ä»¬çŸ¥é“<code>B+</code>æ ‘ç´¢å¼•çš„å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å†…å®¹æ˜¯<code>ç´¢å¼•åˆ— + é¡µå·</code>çš„æ­é…ï¼Œä½†æ˜¯è¿™ä¸ªæ­é…å¯¹äºäºŒçº§ç´¢å¼•æ¥è¯´æœ‰ç‚¹å„¿ä¸ä¸¥è°¨ã€‚è¿˜æ‹¿<code>index_demo</code>è¡¨ä¸ºä¾‹ï¼Œå‡è®¾è¿™ä¸ªè¡¨ä¸­çš„æ•°æ®æ˜¯è¿™æ ·çš„ï¼š</p><table><thead><tr><th><code>c1</code></th><th><code>c2</code></th><th><code>c3</code></th></tr></thead><tbody><tr><td>1</td><td>1</td><td>â€˜uâ€™</td></tr><tr><td>3</td><td>1</td><td>â€˜dâ€™</td></tr><tr><td>5</td><td>1</td><td>â€˜yâ€™</td></tr><tr><td>7</td><td>1</td><td>â€˜aâ€™</td></tr></tbody></table><p>å¦‚æœäºŒçº§ç´¢å¼•ä¸­ç›®å½•é¡¹è®°å½•çš„å†…å®¹åªæ˜¯<code>ç´¢å¼•åˆ— + é¡µå·</code>çš„æ­é…çš„è¯ï¼Œé‚£ä¹ˆä¸º<code>c2</code>åˆ—å»ºç«‹ç´¢å¼•åçš„<code>B+</code>æ ‘åº”è¯¥é•¿è¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd2c5b9ef01~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cp9vthl71h9n8091dkdjek16qg1j.png-58.6kB"><p>å¦‚æœæˆ‘ä»¬æƒ³æ–°æ’å…¥ä¸€è¡Œè®°å½•ï¼Œå…¶ä¸­<code>c1</code>ã€<code>c2</code>ã€<code>c3</code>çš„å€¼åˆ†åˆ«æ˜¯ï¼š<code>9</code>ã€<code>1</code>ã€<code>'c'</code>ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹è¿™ä¸ªä¸º<code>c2</code>åˆ—å»ºç«‹çš„äºŒçº§ç´¢å¼•å¯¹åº”çš„<code>B+</code>æ ‘æ—¶ä¾¿ç¢°åˆ°äº†ä¸ªå¤§é—®é¢˜ï¼šç”±äº<code>é¡µ3</code>ä¸­å­˜å‚¨çš„ç›®å½•é¡¹è®°å½•æ˜¯ç”±<code>c2åˆ— + é¡µå·</code>çš„å€¼æ„æˆçš„ï¼Œ<code>é¡µ3</code>ä¸­çš„ä¸¤æ¡ç›®å½•é¡¹è®°å½•å¯¹åº”çš„<code>c2</code>åˆ—çš„å€¼éƒ½æ˜¯<code>1</code>ï¼Œè€Œæˆ‘ä»¬æ–°æ’å…¥çš„è¿™æ¡è®°å½•çš„<code>c2</code>åˆ—çš„å€¼ä¹Ÿæ˜¯<code>1</code>ï¼Œé‚£æˆ‘ä»¬è¿™æ¡æ–°æ’å…¥çš„è®°å½•åˆ°åº•åº”è¯¥æ”¾åˆ°<code>é¡µ4</code>ä¸­ï¼Œè¿˜æ˜¯åº”è¯¥æ”¾åˆ°<code>é¡µ5</code>ä¸­å•Šï¼Ÿç­”æ¡ˆæ˜¯ï¼šå¯¹ä¸èµ·ï¼Œæ‡µé€¼äº†ã€‚</p><p>ä¸ºäº†è®©æ–°æ’å…¥è®°å½•èƒ½æ‰¾åˆ°è‡ªå·±åœ¨é‚£ä¸ªé¡µé‡Œï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯åœ¨B+æ ‘çš„åŒä¸€å±‚å†…èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•é™¤<code>é¡µå·</code>è¿™ä¸ªå­—æ®µä»¥å¤–æ˜¯å”¯ä¸€çš„ã€‚æ‰€ä»¥å¯¹äºäºŒçº§ç´¢å¼•çš„å†…èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•çš„å†…å®¹å®é™…ä¸Šæ˜¯ç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆçš„ï¼š</p><ul><li>ç´¢å¼•åˆ—çš„å€¼</li><li>ä¸»é”®å€¼</li><li>é¡µå·</li></ul><p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬æŠŠ<code>ä¸»é”®å€¼</code>ä¹Ÿæ·»åŠ åˆ°äºŒçº§ç´¢å¼•å†…èŠ‚ç‚¹ä¸­çš„ç›®å½•é¡¹è®°å½•äº†ï¼Œè¿™æ ·å°±èƒ½ä¿è¯<code>B+</code>æ ‘æ¯ä¸€å±‚èŠ‚ç‚¹ä¸­å„æ¡ç›®å½•é¡¹è®°å½•é™¤<code>é¡µå·</code>è¿™ä¸ªå­—æ®µå¤–æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸º<code>c2</code>åˆ—å»ºç«‹äºŒçº§ç´¢å¼•åçš„ç¤ºæ„å›¾å®é™…ä¸Šåº”è¯¥æ˜¯è¿™æ ·å­çš„ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd2c92fbca0~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cpb919suginpp7lbgsk0147f20.png-58.6kB"><p>è¿™æ ·æˆ‘ä»¬å†æ’å…¥è®°å½•<code>(9, 1, 'c')</code>æ—¶ï¼Œç”±äº<code>é¡µ3</code>ä¸­å­˜å‚¨çš„ç›®å½•é¡¹è®°å½•æ˜¯ç”±<code>c2åˆ— + ä¸»é”® + é¡µå·</code>çš„å€¼æ„æˆçš„ï¼Œå¯ä»¥å…ˆæŠŠæ–°è®°å½•çš„<code>c2</code>åˆ—çš„å€¼å’Œ<code>é¡µ3</code>ä¸­å„ç›®å½•é¡¹è®°å½•çš„<code>c2</code>åˆ—çš„å€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœ<code>c2</code>åˆ—çš„å€¼ç›¸åŒçš„è¯ï¼Œå¯ä»¥æ¥ç€æ¯”è¾ƒä¸»é”®å€¼ï¼Œå› ä¸º<code>B+</code>æ ‘åŒä¸€å±‚ä¸­ä¸åŒç›®å½•é¡¹è®°å½•çš„<code>c2åˆ— + ä¸»é”®</code>çš„å€¼è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æœ€åè‚¯å®šèƒ½å®šä½å”¯ä¸€çš„ä¸€æ¡ç›®å½•é¡¹è®°å½•ï¼Œåœ¨æœ¬ä¾‹ä¸­æœ€åç¡®å®šæ–°è®°å½•åº”è¯¥è¢«æ’å…¥åˆ°<code>é¡µ5</code>ä¸­ã€‚</p><h4 id="ä¸€ä¸ªé¡µé¢æœ€å°‘å­˜å‚¨2æ¡è®°å½•">ä¸€ä¸ªé¡µé¢æœ€å°‘å­˜å‚¨2æ¡è®°å½•</h4><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ä¸€ä¸ªB+æ ‘åªéœ€è¦å¾ˆå°‘çš„å±‚çº§å°±å¯ä»¥è½»æ¾å­˜å‚¨æ•°äº¿æ¡è®°å½•ï¼ŒæŸ¥è¯¢é€Ÿåº¦æ æ çš„ï¼è¿™æ˜¯å› ä¸ºB+æ ‘æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¤§çš„å¤šå±‚çº§ç›®å½•ï¼Œæ¯ç»è¿‡ä¸€ä¸ªç›®å½•æ—¶éƒ½ä¼šè¿‡æ»¤æ‰è®¸å¤šæ— æ•ˆçš„å­ç›®å½•ï¼Œç›´åˆ°æœ€åè®¿é—®åˆ°å­˜å‚¨çœŸå®æ•°æ®çš„ç›®å½•ã€‚é‚£å¦‚æœä¸€ä¸ªå¤§çš„ç›®å½•ä¸­åªå­˜æ”¾ä¸€ä¸ªå­ç›®å½•æ˜¯ä¸ªå•¥æ•ˆæœå‘¢ï¼Ÿé‚£å°±æ˜¯ç›®å½•å±‚çº§éå¸¸éå¸¸éå¸¸å¤šï¼Œè€Œä¸”æœ€åçš„é‚£ä¸ªå­˜æ”¾çœŸå®æ•°æ®çš„ç›®å½•ä¸­åªèƒ½å­˜æ”¾ä¸€æ¡è®°å½•ã€‚è´¹äº†åŠå¤©åŠ²åªèƒ½å­˜æ”¾ä¸€æ¡çœŸå®çš„ç”¨æˆ·è®°å½•ï¼Ÿé€—æˆ‘å‘¢ï¼Ÿæ‰€ä»¥<code>InnoDB</code>çš„ä¸€ä¸ªæ•°æ®é¡µè‡³å°‘å¯ä»¥å­˜æ”¾ä¸¤æ¡è®°å½•ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¹‹å‰å” å¨è®°å½•è¡Œæ ¼å¼çš„æ—¶å€™è¯´è¿‡ä¸€ä¸ªç»“è®ºï¼ˆæˆ‘ä»¬å½“æ—¶ä¾æ®è¿™ä¸ªç»“è®ºæ¨å¯¼äº†è¡¨ä¸­åªæœ‰ä¸€ä¸ªåˆ—æ—¶è¯¥åˆ—åœ¨ä¸å‘ç”Ÿè¡Œæº¢å‡ºçš„æƒ…å†µä¸‹æœ€å¤šèƒ½å­˜å‚¨å¤šå°‘å­—èŠ‚ï¼Œå¿˜äº†çš„è¯å›å»çœ‹çœ‹å§ï¼‰ã€‚</p><h3 id="MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆç®€å•ä»‹ç»">MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆç®€å•ä»‹ç»</h3><p>è‡³æ­¤ï¼Œæˆ‘ä»¬ä»‹ç»çš„éƒ½æ˜¯<code>InnoDB</code>å­˜å‚¨å¼•æ“ä¸­çš„ç´¢å¼•æ–¹æ¡ˆï¼Œä¸ºäº†å†…å®¹çš„å®Œæ•´æ€§ï¼Œä»¥åŠå„ä½å¯èƒ½åœ¨é¢è¯•çš„æ—¶å€™é‡åˆ°è¿™ç±»çš„é—®é¢˜ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å†ç®€å•ä»‹ç»ä¸€ä¸‹<code>MyISAM</code>å­˜å‚¨å¼•æ“ä¸­çš„ç´¢å¼•æ–¹æ¡ˆã€‚æˆ‘ä»¬çŸ¥é“<code>InnoDB</code>ä¸­ç´¢å¼•å³æ•°æ®ï¼Œä¹Ÿå°±æ˜¯èšç°‡ç´¢å¼•çš„é‚£æ£µ<code>B+</code>æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­å·²ç»æŠŠæ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½åŒ…å«äº†ï¼Œè€Œ<code>MyISAM</code>çš„ç´¢å¼•æ–¹æ¡ˆè™½ç„¶ä¹Ÿä½¿ç”¨æ ‘å½¢ç»“æ„ï¼Œä½†æ˜¯å´å°†ç´¢å¼•å’Œæ•°æ®åˆ†å¼€å­˜å‚¨ï¼š</p><ul><li><p>å°†è¡¨ä¸­çš„è®°å½•æŒ‰ç…§è®°å½•çš„æ’å…¥é¡ºåºå•ç‹¬å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç§°ä¹‹ä¸º<code>æ•°æ®æ–‡ä»¶</code>ã€‚è¿™ä¸ªæ–‡ä»¶å¹¶ä¸åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ•°æ®é¡µï¼Œæœ‰å¤šå°‘è®°å½•å°±å¾€è¿™ä¸ªæ–‡ä»¶ä¸­å¡å¤šå°‘è®°å½•å°±æˆäº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¡Œå·è€Œå¿«é€Ÿè®¿é—®åˆ°ä¸€æ¡è®°å½•ã€‚</p><p><code>MyISAM</code>è®°å½•ä¹Ÿéœ€è¦è®°å½•å¤´ä¿¡æ¯æ¥å­˜å‚¨ä¸€äº›é¢å¤–æ•°æ®ï¼Œæˆ‘ä»¬ä»¥ä¸Šè¾¹å” å¨è¿‡çš„<code>index_demo</code>è¡¨ä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªè¡¨ä¸­çš„è®°å½•ä½¿ç”¨<code>MyISAM</code>ä½œä¸ºå­˜å‚¨å¼•æ“åœ¨å­˜å‚¨ç©ºé—´ä¸­çš„è¡¨ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a01bd2d0c5ad53~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cpc7go2o12t1ocd17nvr6msth9.png-58.9kB"><p>ç”±äºåœ¨æ’å…¥æ•°æ®çš„æ—¶å€™å¹¶æ²¡æœ‰åˆ»æ„æŒ‰ç…§ä¸»é”®å¤§å°æ’åºï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸èƒ½åœ¨è¿™äº›æ•°æ®ä¸Šä½¿ç”¨äºŒåˆ†æ³•è¿›è¡ŒæŸ¥æ‰¾ã€‚</p></li><li><p>ä½¿ç”¨<code>MyISAM</code>å­˜å‚¨å¼•æ“çš„è¡¨ä¼šæŠŠç´¢å¼•ä¿¡æ¯å¦å¤–å­˜å‚¨åˆ°ä¸€ä¸ªç§°ä¸º<code>ç´¢å¼•æ–‡ä»¶</code>çš„å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚<code>MyISAM</code>ä¼šå•ç‹¬ä¸ºè¡¨çš„ä¸»é”®åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œåªä¸è¿‡åœ¨ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„ä¸æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œè€Œæ˜¯<code>ä¸»é”®å€¼ + è¡Œå·</code>çš„ç»„åˆã€‚ä¹Ÿå°±æ˜¯å…ˆé€šè¿‡ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„è¡Œå·ï¼Œå†é€šè¿‡è¡Œå·å»æ‰¾å¯¹åº”çš„è®°å½•ï¼</p><p>è¿™ä¸€ç‚¹å’Œ<code>InnoDB</code>æ˜¯å®Œå…¨ä¸ç›¸åŒçš„ï¼Œåœ¨<code>InnoDB</code>å­˜å‚¨å¼•æ“ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®ä¸»é”®å€¼å¯¹<code>èšç°‡ç´¢å¼•</code>è¿›è¡Œä¸€æ¬¡æŸ¥æ‰¾å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œè€Œåœ¨<code>MyISAM</code>ä¸­å´éœ€è¦è¿›è¡Œä¸€æ¬¡<code>å›è¡¨</code>æ“ä½œï¼Œæ„å‘³ç€<code>MyISAM</code>ä¸­å»ºç«‹çš„ç´¢å¼•ç›¸å½“äºå…¨éƒ¨éƒ½æ˜¯<code>äºŒçº§ç´¢å¼•</code>ï¼</p></li><li><p>å¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å…¶å®ƒçš„åˆ—åˆ†åˆ«å»ºç«‹ç´¢å¼•æˆ–è€…å»ºç«‹è”åˆç´¢å¼•ï¼ŒåŸç†å’Œ<code>InnoDB</code>ä¸­çš„ç´¢å¼•å·®ä¸å¤šï¼Œä¸è¿‡åœ¨å¶å­èŠ‚ç‚¹å¤„å­˜å‚¨çš„æ˜¯<code>ç›¸åº”çš„åˆ— + è¡Œå·</code>ã€‚è¿™äº›ç´¢å¼•ä¹Ÿå…¨éƒ¨éƒ½æ˜¯<code>äºŒçº§ç´¢å¼•</code>ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>MyISAMçš„è¡Œæ ¼å¼æœ‰å®šé•¿è®°å½•æ ¼å¼ï¼ˆStaticï¼‰ã€å˜é•¿è®°å½•æ ¼å¼ï¼ˆDynamicï¼‰ã€å‹ç¼©è®°å½•æ ¼å¼ï¼ˆCompressedï¼‰ã€‚ä¸Šè¾¹ç”¨åˆ°çš„index_demoè¡¨é‡‡ç”¨å®šé•¿è®°å½•æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¡è®°å½•å ç”¨å­˜å‚¨ç©ºé—´çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œè¿™æ ·å°±å¯ä»¥è½»æ¾ç®—å‡ºæŸæ¡è®°å½•åœ¨æ•°æ®æ–‡ä»¶ä¸­çš„åœ°å€åç§»é‡ã€‚ä½†æ˜¯å˜é•¿è®°å½•æ ¼å¼å°±ä¸è¡Œäº†ï¼ŒMyISAMä¼šç›´æ¥åœ¨ç´¢å¼•å¶å­èŠ‚ç‚¹å¤„å­˜å‚¨è¯¥æ¡è®°å½•åœ¨æ•°æ®æ–‡ä»¶ä¸­çš„åœ°å€åç§»é‡ã€‚é€šè¿‡è¿™ä¸ªå¯ä»¥çœ‹å‡ºï¼ŒMyISAMçš„å›è¡¨æ“ä½œæ˜¯ååˆ†å¿«é€Ÿçš„ï¼Œå› ä¸ºæ˜¯æ‹¿ç€åœ°å€åç§»é‡ç›´æ¥åˆ°æ–‡ä»¶ä¸­å–æ•°æ®çš„ï¼Œåè§‚InnoDBæ˜¯é€šè¿‡è·å–ä¸»é”®ä¹‹åå†å»èšç°‡ç´¢å¼•é‡Œè¾¹å„¿æ‰¾è®°å½•ï¼Œè™½ç„¶è¯´ä¹Ÿä¸æ…¢ï¼Œä½†è¿˜æ˜¯æ¯”ä¸ä¸Šç›´æ¥ç”¨åœ°å€å»è®¿é—®ã€‚<br><br>æ­¤å¤„æˆ‘ä»¬åªæ˜¯éå¸¸ç®€è¦çš„ä»‹ç»äº†ä¸€ä¸‹MyISAMçš„ç´¢å¼•ï¼Œå…·ä½“ç»†èŠ‚å…¨æ‹¿å‡ºæ¥åˆå¯ä»¥å†™ä¸€ç¯‡æ–‡ç« äº†ã€‚è¿™é‡Œåªæ˜¯å¸Œæœ›å¤§å®¶ç†è§£InnoDBä¸­çš„ç´¢å¼•å³æ•°æ®ï¼Œæ•°æ®å³ç´¢å¼•ï¼Œè€ŒMyISAMä¸­å´æ˜¯ç´¢å¼•æ˜¯ç´¢å¼•ã€æ•°æ®æ˜¯æ•°æ®ã€‚<br></code></pre></td></tr></table></figure><h3 id="MySQLä¸­åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•çš„è¯­å¥">MySQLä¸­åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•çš„è¯­å¥</h3><p>å…‰é¡¾ç€å” å¨ç´¢å¼•çš„åŸç†äº†ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨<code>MySQL</code>è¯­å¥å»å»ºç«‹è¿™ç§ç´¢å¼•å‘¢ï¼Ÿ<code>InnoDB</code>å’Œ<code>MyISAM</code>ä¼šè‡ªåŠ¨ä¸ºä¸»é”®æˆ–è€…å£°æ˜ä¸º<code>UNIQUE</code>çš„åˆ—å»è‡ªåŠ¨å»ºç«‹<code>B+</code>æ ‘ç´¢å¼•ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³ä¸ºå…¶ä»–çš„åˆ—å»ºç«‹ç´¢å¼•å°±éœ€è¦æˆ‘ä»¬æ˜¾å¼çš„å»æŒ‡æ˜ã€‚ä¸ºå•¥ä¸è‡ªåŠ¨ä¸ºæ¯ä¸ªåˆ—éƒ½å»ºç«‹ä¸ªç´¢å¼•å‘¢ï¼Ÿåˆ«å¿˜äº†ï¼Œæ¯å»ºç«‹ä¸€ä¸ªç´¢å¼•éƒ½ä¼šå»ºç«‹ä¸€æ£µ<code>B+</code>æ ‘ï¼Œæ¯æ’å…¥ä¸€æ¡è®°å½•éƒ½è¦ç»´æŠ¤å„ä¸ªè®°å½•ã€æ•°æ®é¡µçš„æ’åºå…³ç³»ï¼Œè¿™æ˜¯å¾ˆè´¹æ€§èƒ½å’Œå­˜å‚¨ç©ºé—´çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™æŒ‡å®šéœ€è¦å»ºç«‹ç´¢å¼•çš„å•ä¸ªåˆ—æˆ–è€…å»ºç«‹è”åˆç´¢å¼•çš„å¤šä¸ªåˆ—ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">CREATE</span> TALBE è¡¨å (<br>    å„ç§åˆ—çš„ä¿¡æ¯ Â·Â·Â· , <br>    [<span class="hljs-keyword">KEY</span>|<span class="hljs-keyword">INDEX</span>] ç´¢å¼•å (éœ€è¦è¢«ç´¢å¼•çš„å•ä¸ªåˆ—æˆ–å¤šä¸ªåˆ—)<br>)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­çš„<code>KEY</code>å’Œ<code>INDEX</code>æ˜¯åŒä¹‰è¯ï¼Œä»»æ„é€‰ç”¨ä¸€ä¸ªå°±å¯ä»¥ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä¿®æ”¹è¡¨ç»“æ„çš„æ—¶å€™æ·»åŠ ç´¢å¼•ï¼š</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-meta">ALTER</span> <span class="hljs-meta">TABLE</span> è¡¨å <span class="hljs-meta">ADD</span> [<span class="hljs-meta">INDEX</span>|<span class="hljs-meta">KEY</span>] ç´¢å¼•å (éœ€è¦è¢«ç´¢å¼•çš„å•ä¸ªåˆ—æˆ–å¤šä¸ªåˆ—);<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨ä¿®æ”¹è¡¨ç»“æ„çš„æ—¶å€™åˆ é™¤ç´¢å¼•ï¼š</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-meta">ALTER</span> <span class="hljs-meta">TABLE</span> è¡¨å <span class="hljs-meta">DROP</span> [<span class="hljs-meta">INDEX</span>|<span class="hljs-meta">KEY</span>] ç´¢å¼•å;<br></code></pre></td></tr></table></figure><p>æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³åœ¨åˆ›å»º<code>index_demo</code>è¡¨çš„æ—¶å€™å°±ä¸º<code>c2</code>å’Œ<code>c3</code>åˆ—æ·»åŠ ä¸€ä¸ª<code>è”åˆç´¢å¼•</code>ï¼Œå¯ä»¥è¿™ä¹ˆå†™å»ºè¡¨è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> index_demo(<br>    c1 <span class="hljs-type">INT</span>,<br>    c2 <span class="hljs-type">INT</span>,<br>    c3 <span class="hljs-type">CHAR</span>(<span class="hljs-number">1</span>),<br>    <span class="hljs-keyword">PRIMARY</span> KEY(c1),<br>    INDEX idx_c2_c3 (c2, c3)<br>);<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªå»ºè¡¨è¯­å¥ä¸­æˆ‘ä»¬åˆ›å»ºçš„ç´¢å¼•åæ˜¯<code>idx_c2_c3</code>ï¼Œè¿™ä¸ªåç§°å¯ä»¥éšä¾¿èµ·ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯å»ºè®®ä»¥<code>idx_</code>ä¸ºå‰ç¼€ï¼Œåè¾¹è·Ÿç€éœ€è¦å»ºç«‹ç´¢å¼•çš„åˆ—åï¼Œå¤šä¸ªåˆ—åä¹‹é—´ç”¨ä¸‹åˆ’çº¿<code>_</code>åˆ†éš”å¼€ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³åˆ é™¤è¿™ä¸ªç´¢å¼•ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> index_demo <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">INDEX</span> idx_c2_c3;<br></code></pre></td></tr></table></figure><h1>7.B+æ ‘ç´¢å¼•çš„ä½¿ç”¨</h1><p>æˆ‘ä»¬å‰è¾¹è¯¦ç»†ã€è¯¦ç»†åˆè¯¦ç»†çš„å” å¨äº†<code>InnoDB</code>å­˜å‚¨å¼•æ“çš„<code>B+</code>æ ‘ç´¢å¼•ï¼Œæˆ‘ä»¬å¿…é¡»ç†Ÿæ‚‰ä¸‹è¾¹è¿™äº›ç»“è®ºï¼š</p><ul><li>æ¯ä¸ªç´¢å¼•éƒ½å¯¹åº”ä¸€æ£µ<code>B+</code>æ ‘ï¼Œ<code>B+</code>æ ‘åˆ†ä¸ºå¥½å¤šå±‚ï¼Œæœ€ä¸‹è¾¹ä¸€å±‚æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå…¶ä½™çš„æ˜¯å†…èŠ‚ç‚¹ã€‚æ‰€æœ‰<code>ç”¨æˆ·è®°å½•</code>éƒ½å­˜å‚¨åœ¨<code>B+</code>æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œæ‰€æœ‰<code>ç›®å½•é¡¹è®°å½•</code>éƒ½å­˜å‚¨åœ¨éå¶èŠ‚ç‚¹ã€‚</li><li><code>InnoDB</code>å­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨ä¸ºä¸»é”®ï¼ˆå¦‚æœæ²¡æœ‰å®ƒä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ·»åŠ ï¼‰å»ºç«‹<code>èšç°‡ç´¢å¼•</code>ï¼Œèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</li><li>æˆ‘ä»¬å¯ä»¥ä¸ºè‡ªå·±æ„Ÿå…´è¶£çš„åˆ—å»ºç«‹<code>äºŒçº§ç´¢å¼•</code>ï¼Œ<code>äºŒçº§ç´¢å¼•</code>çš„å¶å­èŠ‚ç‚¹åŒ…å«çš„ç”¨æˆ·è®°å½•ç”±<code>ç´¢å¼•åˆ— + ä¸»é”®</code>ç»„æˆï¼Œæ‰€ä»¥å¦‚æœæƒ³é€šè¿‡<code>äºŒçº§ç´¢å¼•</code>æ¥æŸ¥æ‰¾å®Œæ•´çš„ç”¨æˆ·è®°å½•çš„è¯ï¼Œéœ€è¦é€šè¿‡<code>å›è¡¨</code>æ“ä½œï¼Œä¹Ÿå°±æ˜¯åœ¨é€šè¿‡<code>äºŒçº§ç´¢å¼•</code>æ‰¾åˆ°ä¸»é”®å€¼ä¹‹åå†åˆ°<code>èšç°‡ç´¢å¼•</code>ä¸­æŸ¥æ‰¾å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</li><li><code>B+</code>æ ‘ä¸­<strong>æ¯å±‚èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—å€¼ä»å°åˆ°å¤§çš„é¡ºåºæ’åºè€Œç»„æˆäº†åŒå‘é“¾è¡¨</strong>ï¼Œè€Œä¸”æ¯ä¸ª<strong>é¡µå†…çš„è®°å½•ï¼ˆä¸è®ºæ˜¯ç”¨æˆ·è®°å½•è¿˜æ˜¯ç›®å½•é¡¹è®°å½•ï¼‰éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ä»å°åˆ°å¤§çš„é¡ºåºè€Œå½¢æˆäº†ä¸€ä¸ªå•é“¾è¡¨</strong>ã€‚å¦‚æœæ˜¯<code>è”åˆç´¢å¼•</code>çš„è¯ï¼Œåˆ™é¡µé¢å’Œè®°å½•å…ˆæŒ‰ç…§<code>è”åˆç´¢å¼•</code>å‰è¾¹çš„åˆ—æ’åºï¼Œå¦‚æœè¯¥åˆ—å€¼ç›¸åŒï¼Œå†æŒ‰ç…§<code>è”åˆç´¢å¼•</code>åè¾¹çš„åˆ—æ’åºã€‚</li><li>é€šè¿‡ç´¢å¼•æŸ¥æ‰¾è®°å½•æ˜¯ä»<code>B+</code>æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¸€å±‚ä¸€å±‚å‘ä¸‹æœç´¢ã€‚ç”±äºæ¯ä¸ªé¡µé¢éƒ½æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼å»ºç«‹äº†<code>Page Directory</code>ï¼ˆé¡µç›®å½•ï¼‰ï¼Œæ‰€ä»¥åœ¨è¿™äº›é¡µé¢ä¸­çš„æŸ¥æ‰¾éå¸¸å¿«ã€‚</li></ul><p>å¦‚æœä½ è¯»ä¸Šè¾¹çš„å‡ ç‚¹ç»“è®ºæœ‰äº›ä»»ä½•ä¸€ç‚¹ç‚¹ç–‘æƒ‘çš„è¯ï¼Œé‚£ä¸‹è¾¹çš„å†…å®¹ä¸é€‚åˆä½ ï¼Œå›è¿‡å¤´å…ˆå»çœ‹å‰è¾¹çš„å†…å®¹å»ã€‚</p><h2 id="ç´¢å¼•çš„ä»£ä»·">ç´¢å¼•çš„ä»£ä»·</h2><p>åœ¨ç†Ÿæ‚‰äº†<code>B+</code>æ ‘ç´¢å¼•åŸç†ä¹‹åï¼Œæœ¬ç¯‡æ–‡ç« çš„ä¸»é¢˜æ˜¯å” å¨å¦‚ä½•æ›´å¥½çš„ä½¿ç”¨ç´¢å¼•ï¼Œè™½ç„¶ç´¢å¼•æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå¯ä¸èƒ½ä¹±å»ºï¼Œåœ¨ä»‹ç»å¦‚ä½•æ›´å¥½çš„ä½¿ç”¨ç´¢å¼•ä¹‹å‰å…ˆè¦äº†è§£ä¸€ä¸‹ä½¿ç”¨è¿™ç©æ„å„¿çš„ä»£ä»·ï¼Œå®ƒåœ¨ç©ºé—´å’Œæ—¶é—´ä¸Šéƒ½ä¼šæ‹–åè…¿ï¼š</p><ul><li><p>ç©ºé—´ä¸Šçš„ä»£ä»·</p><p>è¿™ä¸ªæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œæ¯å»ºç«‹ä¸€ä¸ªç´¢å¼•éƒ½è¦ä¸ºå®ƒå»ºç«‹ä¸€æ£µ<code>B+</code>æ ‘ï¼Œæ¯ä¸€æ£µ<code>B+</code>æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ•°æ®é¡µï¼Œä¸€ä¸ªé¡µé»˜è®¤ä¼šå ç”¨<code>16KB</code>çš„å­˜å‚¨ç©ºé—´ï¼Œä¸€æ£µå¾ˆå¤§çš„<code>B+</code>æ ‘ç”±è®¸å¤šæ•°æ®é¡µç»„æˆï¼Œé‚£å¯æ˜¯å¾ˆå¤§çš„ä¸€ç‰‡å­˜å‚¨ç©ºé—´å‘¢ã€‚</p></li><li><p>æ—¶é—´ä¸Šçš„ä»£ä»·</p><p>æ¯æ¬¡å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œæ—¶ï¼Œéƒ½éœ€è¦å»ä¿®æ”¹å„ä¸ª<code>B+</code>æ ‘ç´¢å¼•ã€‚è€Œä¸”æˆ‘ä»¬è®²è¿‡ï¼Œ<code>B+</code>æ ‘æ¯å±‚èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ä»å°åˆ°å¤§çš„é¡ºåºæ’åºè€Œç»„æˆäº†åŒå‘é“¾è¡¨ã€‚ä¸è®ºæ˜¯å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•ï¼Œè¿˜æ˜¯å†…èŠ‚ç‚¹ä¸­çš„è®°å½•ï¼ˆä¹Ÿå°±æ˜¯ä¸è®ºæ˜¯ç”¨æˆ·è®°å½•è¿˜æ˜¯ç›®å½•é¡¹è®°å½•ï¼‰éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ä»å°åˆ°å¤§çš„é¡ºåºè€Œå½¢æˆäº†ä¸€ä¸ªå•å‘é“¾è¡¨ã€‚è€Œå¢ã€åˆ ã€æ”¹æ“ä½œå¯èƒ½ä¼šå¯¹èŠ‚ç‚¹å’Œè®°å½•çš„æ’åºé€ æˆç ´åï¼Œæ‰€ä»¥å­˜å‚¨å¼•æ“éœ€è¦é¢å¤–çš„æ—¶é—´è¿›è¡Œä¸€äº›è®°å½•ç§»ä½ï¼Œé¡µé¢åˆ†è£‚ã€é¡µé¢å›æ”¶å•¥çš„æ“ä½œæ¥ç»´æŠ¤å¥½èŠ‚ç‚¹å’Œè®°å½•çš„æ’åºã€‚å¦‚æœæˆ‘ä»¬å»ºäº†è®¸å¤šç´¢å¼•ï¼Œæ¯ä¸ªç´¢å¼•å¯¹åº”çš„<code>B+</code>æ ‘éƒ½è¦è¿›è¡Œç›¸å…³çš„ç»´æŠ¤æ“ä½œï¼Œè¿™è¿˜èƒ½ä¸ç»™æ€§èƒ½æ‹–åè…¿ä¹ˆï¼Ÿ</p></li></ul><p>æ‰€ä»¥è¯´ï¼Œä¸€ä¸ªè¡¨ä¸Šç´¢å¼•å»ºçš„è¶Šå¤šï¼Œå°±ä¼šå ç”¨è¶Šå¤šçš„å­˜å‚¨ç©ºé—´ï¼Œåœ¨å¢åˆ æ”¹è®°å½•çš„æ—¶å€™æ€§èƒ½å°±è¶Šå·®ã€‚ä¸ºäº†èƒ½å»ºç«‹åˆå¥½åˆå°‘çš„ç´¢å¼•ï¼Œæˆ‘ä»¬å…ˆå¾—å­¦å­¦è¿™äº›ç´¢å¼•åœ¨å“ªäº›æ¡ä»¶ä¸‹èµ·ä½œç”¨çš„ã€‚</p><h2 id="B-æ ‘ç´¢å¼•é€‚ç”¨çš„æ¡ä»¶">B+æ ‘ç´¢å¼•é€‚ç”¨çš„æ¡ä»¶</h2><p>ä¸‹è¾¹æˆ‘ä»¬å°†å” å¨è®¸å¤šç§è®©<code>B+</code>æ ‘ç´¢å¼•å‘æŒ¥æœ€å¤§æ•ˆèƒ½çš„æŠ€å·§å’Œæ³¨æ„äº‹é¡¹ï¼Œä¸è¿‡å¤§å®¶è¦æ¸…æ¥šï¼Œæ‰€æœ‰çš„æŠ€å·§éƒ½æ˜¯æºè‡ªä½ å¯¹<code>B+</code>æ ‘ç´¢å¼•æœ¬è´¨çš„ç†è§£ï¼Œæ‰€ä»¥å¦‚æœä½ è¿˜ä¸èƒ½ä¿è¯å¯¹<code>B+</code>æ ‘ç´¢å¼•å……åˆ†çš„ç†è§£ï¼Œé‚£ä¹ˆå†æ¬¡å»ºè®®å›è¿‡å¤´æŠŠå‰è¾¹çš„å†…å®¹çœ‹å®Œäº†å†æ¥ï¼Œè¦ä¸ç„¶è¯»æ–‡ç« å¯¹ä½ æ¥è¯´æ˜¯ä¸€ç§æŠ˜ç£¨ã€‚é¦–å…ˆï¼Œ<code>B+</code>æ ‘ç´¢å¼•å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æŸ¥è¯¢è¯­å¥éƒ½èƒ½ç”¨åˆ°æˆ‘ä»¬å»ºç«‹çš„ç´¢å¼•ã€‚ä¸‹è¾¹ä»‹ç»å‡ ä¸ªæˆ‘ä»¬å¯èƒ½ä½¿ç”¨<code>B+</code>æ ‘ç´¢å¼•æ¥è¿›è¡ŒæŸ¥è¯¢çš„æƒ…å†µã€‚ä¸ºäº†æ•…äº‹çš„é¡ºåˆ©å‘å±•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªè¡¨ï¼Œè¿™ä¸ªè¡¨æ˜¯ç”¨æ¥å­˜å‚¨äººçš„ä¸€äº›åŸºæœ¬ä¿¡æ¯çš„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> person_info(<br>    id <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> auto_increment,<br>    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    birthday <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    phone_number <span class="hljs-type">CHAR</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    country <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-keyword">PRIMARY</span> KEY (id),<br>    KEY idx_name_birthday_phone_number (name, birthday, phone_number)<br>);<br></code></pre></td></tr></table></figure><p>å¯¹äºè¿™ä¸ª<code>person_info</code>è¡¨æˆ‘ä»¬éœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š</p><ul><li>è¡¨ä¸­çš„ä¸»é”®æ˜¯<code>id</code>åˆ—ï¼Œå®ƒå­˜å‚¨ä¸€ä¸ªè‡ªåŠ¨é€’å¢çš„æ•´æ•°ã€‚æ‰€ä»¥<code>InnoDB</code>å­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨ä¸º<code>id</code>åˆ—å»ºç«‹èšç°‡ç´¢å¼•ã€‚</li><li>æˆ‘ä»¬é¢å¤–å®šä¹‰äº†ä¸€ä¸ªäºŒçº§ç´¢å¼•<code>idx_name_birthday_phone_number</code>ï¼Œå®ƒæ˜¯ç”±3ä¸ªåˆ—ç»„æˆçš„è”åˆç´¢å¼•ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªç´¢å¼•å¯¹åº”çš„<code>B+</code>æ ‘çš„å¶å­èŠ‚ç‚¹å¤„å­˜å‚¨çš„ç”¨æˆ·è®°å½•åªä¿ç•™<code>name</code>ã€<code>birthday</code>ã€<code>phone_number</code>è¿™ä¸‰ä¸ªåˆ—çš„å€¼ä»¥åŠä¸»é”®<code>id</code>çš„å€¼ï¼Œå¹¶ä¸ä¼šä¿å­˜<code>country</code>åˆ—çš„å€¼ã€‚</li></ul><p>ä»è¿™ä¸¤ç‚¹æ³¨æ„ä¸­æˆ‘ä»¬å¯ä»¥å†æ¬¡çœ‹åˆ°ï¼Œä¸€ä¸ªè¡¨ä¸­æœ‰å¤šå°‘ç´¢å¼•å°±ä¼šå»ºç«‹å¤šå°‘æ£µ<code>B+</code>æ ‘ï¼Œ<code>person_info</code>è¡¨ä¼šä¸ºèšç°‡ç´¢å¼•å’Œ<code>idx_name_birthday_phone_number</code>ç´¢å¼•å»ºç«‹2æ£µ<code>B+</code>æ ‘ã€‚ä¸‹è¾¹æˆ‘ä»¬ç”»ä¸€ä¸‹ç´¢å¼•<code>idx_name_birthday_phone_number</code>çš„ç¤ºæ„å›¾ï¼Œä¸è¿‡æ—¢ç„¶æˆ‘ä»¬å·²ç»æŒæ¡äº†<code>InnoDB</code>çš„<code>B+</code>æ ‘ç´¢å¼•åŸç†ï¼Œé‚£æˆ‘ä»¬åœ¨ç”»å›¾çš„æ—¶å€™ä¸ºäº†è®©å›¾æ›´åŠ æ¸…æ™°ï¼Œæ‰€ä»¥åœ¨çœç•¥ä¸€äº›ä¸å¿…è¦çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚è®°å½•çš„é¢å¤–ä¿¡æ¯ï¼Œå„é¡µé¢çš„é¡µå·ç­‰ç­‰ï¼Œå…¶ä¸­å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„é¡µå·ä¿¡æ¯æˆ‘ä»¬ç”¨ç®­å¤´æ¥ä»£æ›¿ï¼Œåœ¨è®°å½•ç»“æ„ä¸­åªä¿ç•™<code>name</code>ã€<code>birthday</code>ã€<code>phone_number</code>ã€<code>id</code>è¿™å››ä¸ªåˆ—çš„çœŸå®æ•°æ®å€¼ï¼Œæ‰€ä»¥ç¤ºæ„å›¾å°±é•¿è¿™æ ·ï¼ˆç•™å¿ƒçš„åŒå­¦çœ‹å‡ºæ¥äº†ï¼Œè¿™å…¶å®å’Œã€Šé«˜æ€§èƒ½MySQLã€‹é‡Œä¸¾çš„ä¾‹å­çš„å›¾å·®ä¸å¤šï¼Œæˆ‘è§‰å¾—è¿™ä¸ªä¾‹å­ç‰¹åˆ«å¥½ï¼Œæ‰€ä»¥å°±å€Ÿé‰´äº†ä¸€ä¸‹ï¼‰ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16db02bc665cf0b1~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1dmo2n5c11ij019unpjtpf21tdr9.png-121.1kB"><p>ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œæˆ‘ä»¬ç‰¹æ„æ ‡æ˜äº†å“ªäº›æ˜¯å†…èŠ‚ç‚¹ï¼Œå“ªäº›æ˜¯å¶å­èŠ‚ç‚¹ã€‚å†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼Œå†…èŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ˜¯<code>ç›®å½•é¡¹è®°å½•</code>ï¼Œå¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ˜¯<code>ç”¨æˆ·è®°å½•</code>ï¼ˆç”±äºä¸æ˜¯èšç°‡ç´¢å¼•ï¼Œæ‰€ä»¥ç”¨æˆ·è®°å½•æ˜¯ä¸å®Œæ•´çš„ï¼Œç¼ºå°‘<code>country</code>åˆ—çš„å€¼ï¼‰ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ª<code>idx_name_birthday_phone_number</code>ç´¢å¼•å¯¹åº”çš„<code>B+</code>æ ‘ä¸­é¡µé¢å’Œè®°å½•çš„æ’åºæ–¹å¼å°±æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>å…ˆæŒ‰ç…§<code>name</code>åˆ—çš„å€¼è¿›è¡Œæ’åºã€‚</li><li>å¦‚æœ<code>name</code>åˆ—çš„å€¼ç›¸åŒï¼Œåˆ™æŒ‰ç…§<code>birthday</code>åˆ—çš„å€¼è¿›è¡Œæ’åºã€‚</li><li>å¦‚æœ<code>birthday</code>åˆ—çš„å€¼ä¹Ÿç›¸åŒï¼Œåˆ™æŒ‰ç…§<code>phone_number</code>çš„å€¼è¿›è¡Œæ’åºã€‚</li></ul><p>è¿™ä¸ªæ’åºæ–¹å¼ååˆ†ã€ç‰¹åˆ«ã€éå¸¸ã€å·¨ã€very very veryé‡è¦ï¼Œå› ä¸ºåªè¦é¡µé¢å’Œè®°å½•æ˜¯æ’å¥½åºçš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡äºŒåˆ†æ³•æ¥å¿«é€Ÿå®šä½æŸ¥æ‰¾ã€‚ä¸‹è¾¹çš„å†…å®¹éƒ½ä»°ä»—è¿™ä¸ªå›¾äº†ï¼Œå¤§å®¶å¯¹ç…§ç€å›¾ç†è§£ã€‚</p><h3 id="å…¨å€¼åŒ¹é…">å…¨å€¼åŒ¹é…</h3><p>å¦‚æœæˆ‘ä»¬çš„æœç´¢æ¡ä»¶ä¸­çš„åˆ—å’Œç´¢å¼•åˆ—ä¸€è‡´çš„è¯ï¼Œè¿™ç§æƒ…å†µå°±ç§°ä¸ºå…¨å€¼åŒ¹é…ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥æ‰¾è¯­å¥ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;Ashburn&#x27;</span> <span class="hljs-keyword">AND</span> birthday = <span class="hljs-string">&#x27;1990-09-27&#x27;</span> <span class="hljs-keyword">AND</span> phone_number = <span class="hljs-string">&#x27;15123983239&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å»ºç«‹çš„<code>idx_name_birthday_phone_number</code>ç´¢å¼•åŒ…å«çš„3ä¸ªåˆ—åœ¨è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¸­éƒ½å±•ç°å‡ºæ¥äº†ã€‚å¤§å®¶å¯ä»¥æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹ï¼š</p><ul><li>å› ä¸º<code>B+</code>æ ‘çš„æ•°æ®é¡µå’Œè®°å½•å…ˆæ˜¯æŒ‰ç…§<code>name</code>åˆ—çš„å€¼è¿›è¡Œæ’åºçš„ï¼Œæ‰€ä»¥å…ˆå¯ä»¥å¾ˆå¿«å®šä½<code>name</code>åˆ—çš„å€¼æ˜¯<code>Ashburn</code>çš„è®°å½•ä½ç½®ã€‚</li><li>åœ¨<code>name</code>åˆ—ç›¸åŒçš„è®°å½•é‡Œåˆæ˜¯æŒ‰ç…§<code>birthday</code>åˆ—çš„å€¼è¿›è¡Œæ’åºçš„ï¼Œæ‰€ä»¥åœ¨<code>name</code>åˆ—çš„å€¼æ˜¯<code>Ashburn</code>çš„è®°å½•é‡Œåˆå¯ä»¥å¿«é€Ÿå®šä½<code>birthday</code>åˆ—çš„å€¼æ˜¯<code>'1990-09-27'</code>çš„è®°å½•ã€‚</li><li>å¦‚æœå¾ˆä¸å¹¸ï¼Œ<code>name</code>å’Œ<code>birthday</code>åˆ—çš„å€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œé‚£è®°å½•æ˜¯æŒ‰ç…§<code>phone_number</code>åˆ—çš„å€¼æ’åºçš„ï¼Œæ‰€ä»¥è”åˆç´¢å¼•ä¸­çš„ä¸‰ä¸ªåˆ—éƒ½å¯èƒ½è¢«ç”¨åˆ°ã€‚</li></ul><p>æœ‰çš„åŒå­¦ä¹Ÿè®¸æœ‰ä¸ªç–‘é—®ï¼Œ<code>WHERE</code>å­å¥ä¸­çš„å‡ ä¸ªæœç´¢æ¡ä»¶çš„é¡ºåºå¯¹æŸ¥è¯¢ç»“æœæœ‰å•¥å½±å“ä¹ˆï¼Ÿä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬è°ƒæ¢<code>name</code>ã€<code>birthday</code>ã€<code>phone_number</code>è¿™å‡ ä¸ªæœç´¢åˆ—çš„é¡ºåºå¯¹æŸ¥è¯¢çš„æ‰§è¡Œè¿‡ç¨‹æœ‰å½±å“ä¹ˆï¼Ÿæ¯”æ–¹è¯´å†™æˆä¸‹è¾¹è¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> birthday = <span class="hljs-string">&#x27;1990-09-27&#x27;</span> <span class="hljs-keyword">AND</span> phone_number = <span class="hljs-string">&#x27;15123983239&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;Ashburn&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ç­”æ¡ˆæ˜¯ï¼šæ²¡å½±å“å“ˆã€‚<code>MySQL</code>æœ‰ä¸€ä¸ªå«æŸ¥è¯¢ä¼˜åŒ–å™¨çš„ä¸œä¸œï¼Œä¼šåˆ†æè¿™äº›æœç´¢æ¡ä»¶å¹¶ä¸”æŒ‰ç…§å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•ä¸­åˆ—çš„é¡ºåºæ¥å†³å®šå…ˆä½¿ç”¨å“ªä¸ªæœç´¢æ¡ä»¶ï¼Œåä½¿ç”¨å“ªä¸ªæœç´¢æ¡ä»¶ã€‚æˆ‘ä»¬åè¾¹å„¿ä¼šæœ‰ä¸“é—¨çš„ç« èŠ‚æ¥ä»‹ç»æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p><h3 id="åŒ¹é…å·¦è¾¹çš„åˆ—">åŒ¹é…å·¦è¾¹çš„åˆ—</h3><p>å…¶å®åœ¨æˆ‘ä»¬çš„æœç´¢è¯­å¥ä¸­ä¹Ÿå¯ä»¥ä¸ç”¨åŒ…å«å…¨éƒ¨è”åˆç´¢å¼•ä¸­çš„åˆ—ï¼ŒåªåŒ…å«å·¦è¾¹çš„å°±è¡Œï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹çš„æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;Ashburn&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æˆ–è€…åŒ…å«å¤šä¸ªå·¦è¾¹çš„åˆ—ä¹Ÿè¡Œï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;Ashburn&#x27;</span> <span class="hljs-keyword">AND</span> birthday = <span class="hljs-string">&#x27;1990-09-27&#x27;</span>;<br></code></pre></td></tr></table></figure><p>é‚£ä¸ºä»€ä¹ˆæœç´¢æ¡ä»¶ä¸­å¿…é¡»å‡ºç°å·¦è¾¹çš„åˆ—æ‰å¯ä»¥ä½¿ç”¨åˆ°è¿™ä¸ª<code>B+</code>æ ‘ç´¢å¼•å‘¢ï¼Ÿæ¯”å¦‚ä¸‹è¾¹çš„è¯­å¥å°±ç”¨ä¸åˆ°è¿™ä¸ª<code>B+</code>æ ‘ç´¢å¼•ä¹ˆï¼Ÿ</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> birthday = <span class="hljs-string">&#x27;1990-09-27&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æ˜¯çš„ï¼Œçš„ç¡®ç”¨ä¸åˆ°ï¼Œå› ä¸º<code>B+</code>æ ‘çš„æ•°æ®é¡µå’Œè®°å½•å…ˆæ˜¯æŒ‰ç…§<code>name</code>åˆ—çš„å€¼æ’åºçš„ï¼Œåœ¨<code>name</code>åˆ—çš„å€¼ç›¸åŒçš„æƒ…å†µä¸‹æ‰ä½¿ç”¨<code>birthday</code>åˆ—è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯è¯´<code>name</code>åˆ—çš„å€¼ä¸åŒçš„è®°å½•ä¸­<code>birthday</code>çš„å€¼å¯èƒ½æ˜¯æ— åºçš„ã€‚è€Œç°åœ¨ä½ è·³è¿‡<code>name</code>åˆ—ç›´æ¥æ ¹æ®<code>birthday</code>çš„å€¼å»æŸ¥æ‰¾ï¼Œè‡£å¦¾åšä¸åˆ°å‘€ï½ é‚£å¦‚æœæˆ‘å°±æƒ³åœ¨åªä½¿ç”¨<code>birthday</code>çš„å€¼å»é€šè¿‡<code>B+</code>æ ‘ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾å’‹åŠå‘¢ï¼Ÿè¿™å¥½åŠï¼Œä½ å†å¯¹<code>birthday</code>åˆ—å»ºä¸€ä¸ª<code>B+</code>æ ‘ç´¢å¼•å°±è¡Œäº†ï¼Œåˆ›å»ºç´¢å¼•çš„è¯­æ³•ä¸ç”¨æˆ‘å” å¨äº†å§ã€‚</p><p>ä½†æ˜¯éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨è”åˆç´¢å¼•ä¸­å°½å¯èƒ½å¤šçš„åˆ—ï¼Œæœç´¢æ¡ä»¶ä¸­çš„å„ä¸ªåˆ—å¿…é¡»æ˜¯è”åˆç´¢å¼•ä¸­ä»æœ€å·¦è¾¹è¿ç»­çš„åˆ—ã€‚æ¯”æ–¹è¯´è”åˆç´¢å¼•<code>idx_name_birthday_phone_number</code>ä¸­åˆ—çš„å®šä¹‰é¡ºåºæ˜¯<code>name</code>ã€<code>birthday</code>ã€<code>phone_number</code>ï¼Œå¦‚æœæˆ‘ä»¬çš„æœç´¢æ¡ä»¶ä¸­åªæœ‰<code>name</code>å’Œ<code>phone_number</code>ï¼Œè€Œæ²¡æœ‰ä¸­é—´çš„<code>birthday</code>ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;Ashburn&#x27;</span> <span class="hljs-keyword">AND</span> phone_number = <span class="hljs-string">&#x27;15123983239&#x27;</span>;<br></code></pre></td></tr></table></figure><p>è¿™æ ·åªèƒ½ç”¨åˆ°<code>name</code>åˆ—çš„ç´¢å¼•ï¼Œ<code>birthday</code>å’Œ<code>phone_number</code>çš„ç´¢å¼•å°±ç”¨ä¸ä¸Šäº†ï¼Œå› ä¸º<code>name</code>å€¼ç›¸åŒçš„è®°å½•å…ˆæŒ‰ç…§<code>birthday</code>çš„å€¼è¿›è¡Œæ’åºï¼Œ<code>birthday</code>å€¼ç›¸åŒçš„è®°å½•æ‰æŒ‰ç…§<code>phone_number</code>å€¼è¿›è¡Œæ’åºã€‚</p><h3 id="åŒ¹é…åˆ—å‰ç¼€">åŒ¹é…åˆ—å‰ç¼€</h3><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ä¸ºæŸä¸ªåˆ—å»ºç«‹ç´¢å¼•çš„æ„æ€å…¶å®å°±æ˜¯åœ¨å¯¹åº”çš„<code>B+</code>æ ‘çš„è®°å½•ä¸­ä½¿ç”¨è¯¥åˆ—çš„å€¼è¿›è¡Œæ’åºï¼Œæ¯”æ–¹è¯´<code>person_info</code>è¡¨ä¸Šå»ºç«‹çš„è”åˆç´¢å¼•<code>idx_name_birthday_phone_number</code>ä¼šå…ˆç”¨<code>name</code>åˆ—çš„å€¼è¿›è¡Œæ’åºï¼Œæ‰€ä»¥è¿™ä¸ªè”åˆç´¢å¼•å¯¹åº”çš„<code>B+</code>æ ‘ä¸­çš„è®°å½•çš„<code>name</code>åˆ—çš„æ’åˆ—å°±æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs node-repl">Aaron<br>Aaron<br><span class="hljs-meta">...</span><br>Aaron<br>Asa<br>Ashburn<br><span class="hljs-meta">...</span><br>Ashburn<br>Baird<br>Barlow<br><span class="hljs-meta">...</span><br>Barlow<br></code></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²æ’åºçš„æœ¬è´¨å°±æ˜¯æ¯”è¾ƒå“ªä¸ªå­—ç¬¦ä¸²å¤§ä¸€ç‚¹å„¿ï¼Œå“ªä¸ªå­—ç¬¦ä¸²å°ä¸€ç‚¹ï¼Œæ¯”è¾ƒå­—ç¬¦ä¸²å¤§å°å°±ç”¨åˆ°äº†è¯¥åˆ—çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œè¿™ä¸ªæˆ‘ä»¬å‰è¾¹å„¿å” å¨è¿‡ï¼Œå°±ä¸å¤šå” å¨äº†ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€èˆ¬çš„æ¯”è¾ƒè§„åˆ™éƒ½æ˜¯é€ä¸ªæ¯”è¾ƒå­—ç¬¦çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„å¤§å°çš„è¿‡ç¨‹å…¶å®æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>å…ˆæ¯”è¾ƒå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦å°çš„é‚£ä¸ªå­—ç¬¦ä¸²å°±æ¯”è¾ƒå°ã€‚</li><li>å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ç›¸åŒï¼Œé‚£å°±å†æ¯”è¾ƒç¬¬äºŒä¸ªå­—ç¬¦ï¼Œç¬¬äºŒä¸ªå­—ç¬¦æ¯”è¾ƒå°çš„é‚£ä¸ªå­—ç¬¦ä¸²å°±æ¯”è¾ƒå°ã€‚</li><li>å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„ç¬¬äºŒä¸ªå­—ç¬¦ä¹Ÿç›¸åŒï¼Œé‚£å°±æ¥ç€æ¯”è¾ƒç¬¬ä¸‰ä¸ªå­—ç¬¦ï¼Œä¾æ­¤ç±»æ¨ã€‚</li></ul><p>æ‰€ä»¥ä¸€ä¸ªæ’å¥½åºçš„å­—ç¬¦ä¸²åˆ—å…¶å®æœ‰è¿™æ ·çš„ç‰¹ç‚¹ï¼š</p><ul><li>å…ˆæŒ‰ç…§å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è¿›è¡Œæ’åºã€‚</li><li>å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ç›¸åŒå†æŒ‰ç…§ç¬¬äºŒä¸ªå­—ç¬¦è¿›è¡Œæ’åºã€‚</li><li>å¦‚æœç¬¬äºŒä¸ªå­—ç¬¦ç›¸åŒå†æŒ‰ç…§ç¬¬ä¸‰ä¸ªå­—ç¬¦è¿›è¡Œæ’åºï¼Œä¾æ­¤ç±»æ¨ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´è¿™äº›å­—ç¬¦ä¸²çš„å‰nä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯å‰ç¼€éƒ½æ˜¯æ’å¥½åºçš„ï¼Œæ‰€ä»¥å¯¹äºå­—ç¬¦ä¸²ç±»å‹çš„ç´¢å¼•åˆ—æ¥è¯´ï¼Œæˆ‘ä»¬åªåŒ¹é…å®ƒçš„å‰ç¼€ä¹Ÿæ˜¯å¯ä»¥å¿«é€Ÿå®šä½è®°å½•çš„ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬æƒ³æŸ¥è¯¢åå­—ä»¥<code>'As'</code>å¼€å¤´çš„è®°å½•ï¼Œé‚£å°±å¯ä»¥è¿™ä¹ˆå†™æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;As%&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåªç»™å‡ºåç¼€æˆ–è€…ä¸­é—´çš„æŸä¸ªå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%As%&#x27;</span>;<br></code></pre></td></tr></table></figure><p><code>MySQL</code>å°±æ— æ³•å¿«é€Ÿå®šä½è®°å½•ä½ç½®äº†ï¼Œå› ä¸ºå­—ç¬¦ä¸²ä¸­é—´æœ‰<code>'As'</code>çš„å­—ç¬¦ä¸²å¹¶æ²¡æœ‰æ’å¥½åºï¼Œæ‰€ä»¥åªèƒ½å…¨è¡¨æ‰«æäº†ã€‚æœ‰æ—¶å€™æˆ‘ä»¬æœ‰ä¸€äº›åŒ¹é…æŸäº›å­—ç¬¦ä¸²åç¼€çš„éœ€æ±‚ï¼Œæ¯”æ–¹è¯´æŸä¸ªè¡¨æœ‰ä¸€ä¸ª<code>url</code>åˆ—ï¼Œè¯¥åˆ—ä¸­å­˜å‚¨äº†è®¸å¤šurlï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----------------+</span><br><span class="hljs-section">| url            |</span><br><span class="hljs-section">+----------------+</span><br>| www.baidu.com  |<br>| www.google.com |<br>| www.gov.cn     |<br>| ...            |<br><span class="hljs-section">| www.wto.org    |</span><br><span class="hljs-section">+----------------+</span><br></code></pre></td></tr></table></figure><p>å‡è®¾å·²ç»å¯¹è¯¥<code>url</code>åˆ—åˆ›å»ºäº†ç´¢å¼•ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æŸ¥è¯¢ä»¥<code>com</code>ä¸ºåç¼€çš„ç½‘å€çš„è¯å¯ä»¥è¿™æ ·å†™æŸ¥è¯¢æ¡ä»¶ï¼š<code>WHERE url LIKE '%com'</code>ï¼Œä½†æ˜¯è¿™æ ·çš„è¯æ— æ³•ä½¿ç”¨è¯¥<code>url</code>åˆ—çš„ç´¢å¼•ã€‚ä¸ºäº†åœ¨æŸ¥è¯¢æ—¶ç”¨åˆ°è¿™ä¸ªç´¢å¼•è€Œä¸è‡³äºå…¨è¡¨æ‰«æï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåç¼€æŸ¥è¯¢æ”¹å†™æˆå‰ç¼€æŸ¥è¯¢ï¼Œä¸è¿‡æˆ‘ä»¬å°±å¾—æŠŠè¡¨ä¸­çš„æ•°æ®å…¨éƒ¨é€†åºå­˜å‚¨ä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è¿™æ ·ä¿å­˜<code>url</code>åˆ—ä¸­çš„æ•°æ®ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----------------+</span><br><span class="hljs-section">| url            |</span><br><span class="hljs-section">+----------------+</span><br>| moc.udiab.www  |<br>| moc.elgoog.www |<br>| nc.vog.www     |<br>| ...            |<br><span class="hljs-section">| gro.otw.www    |</span><br><span class="hljs-section">+----------------+</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·å†æŸ¥æ‰¾ä»¥<code>com</code>ä¸ºåç¼€çš„ç½‘å€æ—¶æœç´¢æ¡ä»¶ä¾¿å¯ä»¥è¿™ä¹ˆå†™ï¼š<code>WHERE url LIKE 'moc%'</code>ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨åˆ°ç´¢å¼•äº†ã€‚</p><h3 id="åŒ¹é…èŒƒå›´å€¼">åŒ¹é…èŒƒå›´å€¼</h3><p>å›å¤´çœ‹æˆ‘ä»¬<code>idx_name_birthday_phone_number</code>ç´¢å¼•çš„<code>B+</code>æ ‘ç¤ºæ„å›¾ï¼Œæ‰€æœ‰è®°å½•éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ä»å°åˆ°å¤§çš„é¡ºåºæ’å¥½åºçš„ï¼Œæ‰€ä»¥è¿™æå¤§çš„æ–¹ä¾¿æˆ‘ä»¬æŸ¥æ‰¾ç´¢å¼•åˆ—çš„å€¼åœ¨æŸä¸ªèŒƒå›´å†…çš„è®°å½•ã€‚æ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> &gt; <span class="hljs-string">&#x27;Asa&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-type">name</span> &lt; <span class="hljs-string">&#x27;Barlow&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ç”±äº<code>B+</code>æ ‘ä¸­çš„æ•°æ®é¡µå’Œè®°å½•æ˜¯å…ˆæŒ‰<code>name</code>åˆ—æ’åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸Šè¾¹çš„æŸ¥è¯¢è¿‡ç¨‹å…¶å®æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>é€šè¿‡B+æ ‘åœ¨å¶å­èŠ‚ç‚¹ä¸­æ‰¾åˆ°ç¬¬ä¸€æ¡<code>name</code>å€¼å¤§äº<code>Asa</code>çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œè¯»å–è¯¥è®°å½•çš„ä¸»é”®å€¼è¿›è¡Œå›è¡¨æ“ä½œï¼Œè·å¾—å¯¹åº”çš„èšç°‡ç´¢å¼•è®°å½•åå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li><li>æ ¹æ®ä¸Šä¸€æ­¥æ‰¾åˆ°çš„è®°å½•ï¼Œæ²¿ç€è®°å½•æ‰€åœ¨çš„é“¾è¡¨å‘åæŸ¥æ‰¾ï¼ˆåŒä¸€é¡µé¢ä¸­çš„è®°å½•ä½¿ç”¨å•å‘é“¾è¡¨è¿æ¥èµ·æ¥ï¼Œæ•°æ®é¡µä¹‹é—´ç”¨åŒå‘é“¾è¡¨è¿æ¥èµ·æ¥ï¼‰ä¸‹ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ï¼Œåˆ¤æ–­è¯¥è®°å½•æ˜¯å¦ç¬¦åˆname &lt; 'Barlowâ€™æ¡ä»¶ï¼Œå¦‚æœç¬¦åˆï¼Œåˆ™è¿›è¡Œå›è¡¨æ“ä½œåå‘é€è‡³å®¢æˆ·ç«¯ã€‚</li><li>é‡å¤ä¸Šä¸€æ­¥éª¤ï¼Œç›´åˆ°æŸæ¡äºŒçº§ç´¢å¼•è®°å½•ä¸ç¬¦åˆname &lt;'Barlowâ€™æ¡ä»¶ä¸ºæ­¢ã€‚</li></ul><p>ä¸è¿‡åœ¨ä½¿ç”¨è”åˆè¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œå¦‚æœå¯¹å¤šä¸ªåˆ—åŒæ—¶è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œåªæœ‰å¯¹ç´¢å¼•æœ€å·¦è¾¹çš„é‚£ä¸ªåˆ—è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™æ‰èƒ½ç”¨åˆ°<code>B+</code>æ ‘ç´¢å¼•ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> &gt; <span class="hljs-string">&#x27;Asa&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-type">name</span> &lt; <span class="hljs-string">&#x27;Barlow&#x27;</span> <span class="hljs-keyword">AND</span> birthday &gt; <span class="hljs-string">&#x27;1980-01-01&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ä¸Šè¾¹è¿™ä¸ªæŸ¥è¯¢å¯ä»¥åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>é€šè¿‡æ¡ä»¶<code>name &gt; 'Asa' AND name &lt; 'Barlow' </code>æ¥å¯¹<code>name</code>è¿›è¡ŒèŒƒå›´ï¼ŒæŸ¥æ‰¾çš„ç»“æœå¯èƒ½æœ‰å¤šæ¡<code>name</code>å€¼ä¸åŒçš„è®°å½•ï¼Œ</li><li>å¯¹è¿™äº›<code>name</code>å€¼ä¸åŒçš„è®°å½•ç»§ç»­é€šè¿‡<code>birthday &gt; '1980-01-01'</code>æ¡ä»¶ç»§ç»­è¿‡æ»¤ã€‚</li></ol><p>è¿™æ ·å­å¯¹äºè”åˆç´¢å¼•<code>idx_name_birthday_phone_number</code>æ¥è¯´ï¼Œåªèƒ½ç”¨åˆ°<code>name</code>åˆ—çš„éƒ¨åˆ†ï¼Œè€Œç”¨ä¸åˆ°<code>birthday</code>åˆ—çš„éƒ¨åˆ†ï¼Œå› ä¸ºåªæœ‰<code>name</code>å€¼ç›¸åŒçš„æƒ…å†µä¸‹æ‰èƒ½ç”¨<code>birthday</code>åˆ—çš„å€¼è¿›è¡Œæ’åºï¼Œè€Œè¿™ä¸ªæŸ¥è¯¢ä¸­é€šè¿‡<code>name</code>è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„è®°å½•ä¸­å¯èƒ½å¹¶ä¸æ˜¯æŒ‰ç…§<code>birthday</code>åˆ—è¿›è¡Œæ’åºçš„ï¼Œæ‰€ä»¥åœ¨æœç´¢æ¡ä»¶ä¸­ç»§ç»­ä»¥<code>birthday</code>åˆ—è¿›è¡ŒæŸ¥æ‰¾æ—¶æ˜¯ç”¨ä¸åˆ°è¿™ä¸ª<code>B+</code>æ ‘ç´¢å¼•çš„ã€‚</p><h3 id="ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ—">ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ—</h3><p>å¯¹äºåŒä¸€ä¸ªè”åˆç´¢å¼•æ¥è¯´ï¼Œè™½ç„¶å¯¹å¤šä¸ªåˆ—éƒ½è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾æ—¶åªèƒ½ç”¨åˆ°æœ€å·¦è¾¹é‚£ä¸ªç´¢å¼•åˆ—ï¼Œä½†æ˜¯å¦‚æœå·¦è¾¹çš„åˆ—æ˜¯ç²¾ç¡®æŸ¥æ‰¾ï¼Œåˆ™å³è¾¹çš„åˆ—å¯ä»¥è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;Ashburn&#x27;</span> <span class="hljs-keyword">AND</span> birthday &gt; <span class="hljs-string">&#x27;1980-01-01&#x27;</span> <span class="hljs-keyword">AND</span> birthday &lt; <span class="hljs-string">&#x27;2000-12-31&#x27;</span> <span class="hljs-keyword">AND</span> phone_number &gt; <span class="hljs-string">&#x27;15100000000&#x27;</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢çš„æ¡ä»¶å¯ä»¥åˆ†ä¸º3ä¸ªéƒ¨åˆ†ï¼š</p><ol><li><code>name = 'Ashburn'</code>ï¼Œå¯¹<code>name</code>åˆ—è¿›è¡Œç²¾ç¡®æŸ¥æ‰¾ï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨<code>B+</code>æ ‘ç´¢å¼•äº†ã€‚</li><li><code>birthday &gt; '1980-01-01' AND birthday &lt; '2000-12-31'</code>ï¼Œç”±äº<code>name</code>åˆ—æ˜¯ç²¾ç¡®æŸ¥æ‰¾ï¼Œæ‰€ä»¥é€šè¿‡<code>name = 'Ashburn'</code>æ¡ä»¶æŸ¥æ‰¾åå¾—åˆ°çš„ç»“æœçš„<code>name</code>å€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œå®ƒä»¬ä¼šå†æŒ‰ç…§<code>birthday</code>çš„å€¼è¿›è¡Œæ’åºã€‚æ‰€ä»¥æ­¤æ—¶å¯¹<code>birthday</code>åˆ—è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾æ˜¯å¯ä»¥ç”¨åˆ°<code>B+</code>æ ‘ç´¢å¼•çš„ã€‚</li><li><code>phone_number &gt; '15100000000'</code>ï¼Œé€šè¿‡<code>birthday</code>çš„èŒƒå›´æŸ¥æ‰¾çš„è®°å½•çš„<code>birthday</code>çš„å€¼å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥è¿™ä¸ªæ¡ä»¶æ— æ³•å†åˆ©ç”¨<code>B+</code>æ ‘ç´¢å¼•äº†ï¼Œåªèƒ½éå†ä¸Šä¸€æ­¥æŸ¥è¯¢å¾—åˆ°çš„è®°å½•ã€‚</li></ol><p>åŒç†ï¼Œä¸‹è¾¹çš„æŸ¥è¯¢ä¹Ÿæ˜¯å¯èƒ½ç”¨åˆ°è¿™ä¸ª<code>idx_name_birthday_phone_number</code>è”åˆç´¢å¼•çš„ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;Ashburn&#x27;</span> <span class="hljs-keyword">AND</span> birthday = <span class="hljs-string">&#x27;1980-01-01&#x27;</span> <span class="hljs-keyword">AND</span> phone_number &gt; <span class="hljs-string">&#x27;15100000000&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="ç”¨äºæ’åº">ç”¨äºæ’åº</h3><p>æˆ‘ä»¬åœ¨å†™æŸ¥è¯¢è¯­å¥çš„æ—¶å€™ç»å¸¸éœ€è¦å¯¹æŸ¥è¯¢å‡ºæ¥çš„è®°å½•é€šè¿‡<code>ORDER BY</code>å­å¥æŒ‰ç…§æŸç§è§„åˆ™è¿›è¡Œæ’åºã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½æŠŠè®°å½•éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå†ç”¨ä¸€äº›æ’åºç®—æ³•ï¼Œæ¯”å¦‚å¿«é€Ÿæ’åºã€å½’å¹¶æ’åºã€å§å•¦å§å•¦æ’åºç­‰ç­‰åœ¨å†…å­˜ä¸­å¯¹è¿™äº›è®°å½•è¿›è¡Œæ’åºï¼Œæœ‰çš„æ—¶å€™å¯èƒ½æŸ¥è¯¢çš„ç»“æœé›†å¤ªå¤§ä»¥è‡³äºä¸èƒ½åœ¨å†…å­˜ä¸­è¿›è¡Œæ’åºçš„è¯ï¼Œè¿˜å¯èƒ½æš‚æ—¶å€ŸåŠ©ç£ç›˜çš„ç©ºé—´æ¥å­˜æ”¾ä¸­é—´ç»“æœï¼Œæ’åºæ“ä½œå®Œæˆåå†æŠŠæ’å¥½åºçš„ç»“æœé›†è¿”å›åˆ°å®¢æˆ·ç«¯ã€‚åœ¨<code>MySQL</code>ä¸­ï¼ŒæŠŠè¿™ç§åœ¨å†…å­˜ä¸­æˆ–è€…ç£ç›˜ä¸Šè¿›è¡Œæ’åºçš„æ–¹å¼ç»Ÿç§°ä¸ºæ–‡ä»¶æ’åºï¼ˆè‹±æ–‡åï¼š<code>filesort</code>ï¼‰ï¼Œè·Ÿ<code>æ–‡ä»¶</code>è¿™ä¸ªè¯å„¿ä¸€æ²¾è¾¹å„¿ï¼Œå°±æ˜¾å¾—è¿™äº›æ’åºæ“ä½œéå¸¸æ…¢äº†ï¼ˆç£ç›˜å’Œå†…å­˜çš„é€Ÿåº¦æ¯”èµ·æ¥ï¼Œå°±åƒæ˜¯é£æœºå’Œèœ—ç‰›çš„å¯¹æ¯”ï¼‰ã€‚ä½†æ˜¯å¦‚æœ<code>ORDER BY</code>å­å¥é‡Œä½¿ç”¨åˆ°äº†æˆ‘ä»¬çš„ç´¢å¼•åˆ—ï¼Œå°±æœ‰å¯èƒ½çœå»åœ¨å†…å­˜æˆ–æ–‡ä»¶ä¸­æ’åºçš„æ­¥éª¤ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªç®€å•çš„æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-type">name</span>, birthday, phone_number <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢çš„ç»“æœé›†éœ€è¦å…ˆæŒ‰ç…§<code>name</code>å€¼æ’åºï¼Œå¦‚æœè®°å½•çš„<code>name</code>å€¼ç›¸åŒï¼Œåˆ™éœ€è¦æŒ‰ç…§<code>birthday</code>æ¥æ’åºï¼Œå¦‚æœ<code>birthday</code>çš„å€¼ç›¸åŒï¼Œåˆ™éœ€è¦æŒ‰ç…§<code>phone_number</code>æ’åºã€‚å¤§å®¶å¯ä»¥å›è¿‡å¤´å»çœ‹æˆ‘ä»¬å»ºç«‹çš„<code>idx_name_birthday_phone_number</code>ç´¢å¼•çš„ç¤ºæ„å›¾ï¼Œå› ä¸ºè¿™ä¸ª<code>B+</code>æ ‘ç´¢å¼•æœ¬èº«å°±æ˜¯æŒ‰ç…§ä¸Šè¿°è§„åˆ™æ’å¥½åºçš„ï¼Œæ‰€ä»¥ç›´æ¥ä»ç´¢å¼•ä¸­æå–æ•°æ®ï¼Œç„¶åè¿›è¡Œ<code>å›è¡¨</code>æ“ä½œå–å‡ºè¯¥ç´¢å¼•ä¸­ä¸åŒ…å«çš„åˆ—å°±å¥½äº†ã€‚ç®€å•å§ï¼Ÿæ˜¯çš„ï¼Œç´¢å¼•å°±æ˜¯è¿™ä¹ˆç‰›é€¼ã€‚</p><h4 id="ä½¿ç”¨è”åˆç´¢å¼•è¿›è¡Œæ’åºæ³¨æ„äº‹é¡¹">ä½¿ç”¨è”åˆç´¢å¼•è¿›è¡Œæ’åºæ³¨æ„äº‹é¡¹</h4><p>å¯¹äº<code>è”åˆç´¢å¼•</code>æœ‰ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼Œ<code>ORDER BY</code>çš„å­å¥åè¾¹çš„åˆ—çš„é¡ºåºä¹Ÿå¿…é¡»æŒ‰ç…§ç´¢å¼•åˆ—çš„é¡ºåºç»™å‡ºï¼Œå¦‚æœç»™å‡º<code>ORDER BY phone_number, birthday, name</code>çš„é¡ºåºï¼Œé‚£ä¹Ÿæ˜¯ç”¨ä¸äº†<code>B+</code>æ ‘ç´¢å¼•ï¼Œè¿™ç§é¢ å€’é¡ºåºå°±ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„åŸå› æˆ‘ä»¬ä¸Šè¾¹è¯¦ç»†è¯´è¿‡äº†ï¼Œè¿™å°±ä¸èµ˜è¿°äº†ã€‚</p><p>åŒç†ï¼Œ<code>ORDER BY name</code>ã€<code>ORDER BY name, birthday</code>è¿™ç§åŒ¹é…ç´¢å¼•å·¦è¾¹çš„åˆ—çš„å½¢å¼å¯ä»¥ä½¿ç”¨éƒ¨åˆ†çš„<code>B+</code>æ ‘ç´¢å¼•ã€‚å½“è”åˆç´¢å¼•å·¦è¾¹åˆ—çš„å€¼ä¸ºå¸¸é‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åè¾¹çš„åˆ—è¿›è¡Œæ’åºï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;A&#x27;</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> birthday, phone_number <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢èƒ½ä½¿ç”¨è”åˆç´¢å¼•è¿›è¡Œæ’åºæ˜¯å› ä¸º<code>name</code>åˆ—çš„å€¼ç›¸åŒçš„è®°å½•æ˜¯æŒ‰ç…§<code>birthday</code>, <code>phone_number</code>æ’åºçš„ï¼Œè¯´äº†å¥½å¤šéäº†éƒ½ã€‚</p><h4 id="ä¸å¯ä»¥ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºçš„å‡ ç§æƒ…å†µ">ä¸å¯ä»¥ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºçš„å‡ ç§æƒ…å†µ</h4><h5 id="ASCã€DESCæ··ç”¨">ASCã€DESCæ··ç”¨</h5><p>å¯¹äºä½¿ç”¨è”åˆç´¢å¼•è¿›è¡Œæ’åºçš„åœºæ™¯ï¼Œæˆ‘ä»¬è¦æ±‚å„ä¸ªæ’åºåˆ—çš„æ’åºé¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¦ä¹ˆå„ä¸ªåˆ—éƒ½æ˜¯<code>ASC</code>è§„åˆ™æ’åºï¼Œè¦ä¹ˆéƒ½æ˜¯<code>DESC</code>è§„åˆ™æ’åºã€‚</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">å°è´´å£«ï¼š<br><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span>å­å¥åçš„åˆ—å¦‚æœä¸åŠ <span class="hljs-keyword">ASC</span>æˆ–è€…<span class="hljs-keyword">DESC</span>é»˜è®¤æ˜¯æŒ‰ç…§<span class="hljs-keyword">ASC</span>æ’åºè§„åˆ™æ’åºçš„ï¼Œä¹Ÿå°±æ˜¯å‡åºæ’åºçš„ã€‚<br></code></pre></td></tr></table></figure><p>ä¸ºå•¥ä¼šæœ‰è¿™ç§å¥‡è‘©è§„å®šå‘¢ï¼Ÿè¿™ä¸ªè¿˜å¾—å›å¤´æƒ³æƒ³è¿™ä¸ª<code>idx_name_birthday_phone_number</code>è”åˆç´¢å¼•ä¸­è®°å½•çš„ç»“æ„ï¼š</p><ul><li>å…ˆæŒ‰ç…§è®°å½•çš„<code>name</code>åˆ—çš„å€¼è¿›è¡Œå‡åºæ’åˆ—ã€‚</li><li>å¦‚æœè®°å½•çš„<code>name</code>åˆ—çš„å€¼ç›¸åŒï¼Œå†æŒ‰ç…§<code>birthday</code>åˆ—çš„å€¼è¿›è¡Œå‡åºæ’åˆ—ã€‚</li><li>å¦‚æœè®°å½•çš„<code>birthday</code>åˆ—çš„å€¼ç›¸åŒï¼Œå†æŒ‰ç…§<code>phone_number</code>åˆ—çš„å€¼è¿›è¡Œå‡åºæ’åˆ—ã€‚</li></ul><p>å¦‚æœæŸ¥è¯¢ä¸­çš„å„ä¸ªæ’åºåˆ—çš„æ’åºé¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸¤ç§æƒ…å†µï¼š</p><ul><li><p><code>ORDER BY name, birthday LIMIT 10</code></p><p>è¿™ç§æƒ…å†µç›´æ¥ä»ç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹å¾€å³è¯»10è¡Œè®°å½•å°±å¯ä»¥äº†ã€‚</p></li><li><p><code>ORDER BY name DESC, birthday DESC LIMIT 10</code>ï¼Œ</p><p>è¿™ç§æƒ…å†µç›´æ¥ä»ç´¢å¼•çš„æœ€å³è¾¹å¼€å§‹å¾€å·¦è¯»10è¡Œè®°å½•å°±å¯ä»¥äº†ã€‚</p></li></ul><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬æŸ¥è¯¢çš„éœ€æ±‚æ˜¯å…ˆæŒ‰ç…§<code>name</code>åˆ—è¿›è¡Œå‡åºæ’åˆ—ï¼Œå†æŒ‰ç…§<code>birthday</code>åˆ—è¿›è¡Œé™åºæ’åˆ—çš„è¯ï¼Œæ¯”å¦‚è¯´è¿™æ ·çš„æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-type">name</span>, birthday <span class="hljs-keyword">DESC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å¦‚æœä½¿ç”¨ç´¢å¼•æ’åºçš„è¯è¿‡ç¨‹å°±æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>å…ˆä»ç´¢å¼•çš„æœ€å·¦è¾¹ç¡®å®š<code>name</code>åˆ—æœ€å°çš„å€¼ï¼Œç„¶åæ‰¾åˆ°<code>name</code>åˆ—ç­‰äºè¯¥å€¼çš„æ‰€æœ‰è®°å½•ï¼Œç„¶åä»<code>name</code>åˆ—ç­‰äºè¯¥å€¼çš„æœ€å³è¾¹çš„é‚£æ¡è®°å½•å¼€å§‹å¾€å·¦æ‰¾10æ¡è®°å½•ã€‚</li><li>å¦‚æœ<code>name</code>åˆ—ç­‰äºæœ€å°çš„å€¼çš„è®°å½•ä¸è¶³10æ¡ï¼Œå†ç»§ç»­å¾€å³æ‰¾<code>name</code>å€¼ç¬¬äºŒå°çš„è®°å½•ï¼Œé‡å¤ä¸Šè¾¹é‚£ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ‰¾åˆ°10æ¡è®°å½•ä¸ºæ­¢ã€‚</li></ul><p>ç´¯ä¸ç´¯ï¼Ÿç´¯ï¼é‡ç‚¹æ˜¯è¿™æ ·ä¸èƒ½é«˜æ•ˆä½¿ç”¨ç´¢å¼•ï¼Œè€Œè¦é‡‡å–æ›´å¤æ‚çš„ç®—æ³•å»ä»ç´¢å¼•ä¸­å–æ•°æ®ï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”è§‰å¾—è¿™æ ·è¿˜ä¸å¦‚ç›´æ¥æ–‡ä»¶æ’åºæ¥çš„å¿«ï¼Œæ‰€ä»¥å°±è§„å®šä½¿ç”¨è”åˆç´¢å¼•çš„å„ä¸ªæ’åºåˆ—çš„æ’åºé¡ºåºå¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚</p><h5 id="æ’åºåˆ—åŒ…å«éåŒä¸€ä¸ªç´¢å¼•çš„åˆ—">æ’åºåˆ—åŒ…å«éåŒä¸€ä¸ªç´¢å¼•çš„åˆ—</h5><p>æœ‰æ—¶å€™ç”¨æ¥æ’åºçš„å¤šä¸ªåˆ—ä¸æ˜¯ä¸€ä¸ªç´¢å¼•é‡Œçš„ï¼Œè¿™ç§æƒ…å†µä¹Ÿä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºï¼Œæ¯”æ–¹è¯´ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-type">name</span>, country <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p><code>name</code>å’Œ<code>country</code>å¹¶ä¸å±äºä¸€ä¸ªè”åˆç´¢å¼•ä¸­çš„åˆ—ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºï¼Œè‡³äºä¸ºå•¥æˆ‘å°±ä¸æƒ³å†å” å¨äº†ï¼Œè‡ªå·±ç”¨å‰è¾¹çš„ç†è®ºè‡ªå·±æ‹ä¸€æ‹å§ï½</p><h5 id="æ’åºåˆ—ä½¿ç”¨äº†å¤æ‚çš„è¡¨è¾¾å¼">æ’åºåˆ—ä½¿ç”¨äº†å¤æ‚çš„è¡¨è¾¾å¼</h5><p>è¦æƒ³ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºæ“ä½œï¼Œå¿…é¡»ä¿è¯ç´¢å¼•åˆ—æ˜¯ä»¥å•ç‹¬åˆ—çš„å½¢å¼å‡ºç°ï¼Œè€Œä¸æ˜¯ä¿®é¥°è¿‡çš„å½¢å¼ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> UPPER(<span class="hljs-type">name</span>) <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨äº†<code>UPPER</code>å‡½æ•°ä¿®é¥°è¿‡çš„åˆ—å°±ä¸æ˜¯å•ç‹¬çš„åˆ—å•¦ï¼Œè¿™æ ·å°±æ— æ³•ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºå•¦ã€‚</p><h3 id="ç”¨äºåˆ†ç»„">ç”¨äºåˆ†ç»„</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿ç»Ÿè®¡è¡¨ä¸­çš„ä¸€äº›ä¿¡æ¯ï¼Œä¼šæŠŠè¡¨ä¸­çš„è®°å½•æŒ‰ç…§æŸäº›åˆ—è¿›è¡Œåˆ†ç»„ã€‚æ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªåˆ†ç»„æŸ¥è¯¢ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> <span class="hljs-type">name</span>, birthday, phone_number, COUNT(*) <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-type">name</span>, birthday, phone_number<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢è¯­å¥ç›¸å½“äºåšäº†3æ¬¡åˆ†ç»„æ“ä½œï¼š</p><ol><li>å…ˆæŠŠè®°å½•æŒ‰ç…§<code>name</code>å€¼è¿›è¡Œåˆ†ç»„ï¼Œæ‰€æœ‰<code>name</code>å€¼ç›¸åŒçš„è®°å½•åˆ’åˆ†ä¸ºä¸€ç»„ã€‚</li><li>å°†æ¯ä¸ª<code>name</code>å€¼ç›¸åŒçš„åˆ†ç»„é‡Œçš„è®°å½•å†æŒ‰ç…§<code>birthday</code>çš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå°†<code>birthday</code>å€¼ç›¸åŒçš„è®°å½•æ”¾åˆ°ä¸€ä¸ªå°åˆ†ç»„é‡Œï¼Œæ‰€ä»¥çœ‹èµ·æ¥å°±åƒåœ¨ä¸€ä¸ªå¤§åˆ†ç»„é‡ŒåˆåŒ–åˆ†äº†å¥½å¤šå°åˆ†ç»„ã€‚</li><li>å†å°†ä¸Šä¸€æ­¥ä¸­äº§ç”Ÿçš„å°åˆ†ç»„æŒ‰ç…§<code>phone_number</code>çš„å€¼åˆ†æˆæ›´å°çš„åˆ†ç»„ï¼Œæ‰€ä»¥æ•´ä½“ä¸Šçœ‹èµ·æ¥å°±åƒæ˜¯å…ˆæŠŠè®°å½•åˆ†æˆä¸€ä¸ªå¤§åˆ†ç»„ï¼Œç„¶åæŠŠ<code>å¤§åˆ†ç»„</code>åˆ†æˆè‹¥å¹²ä¸ª<code>å°åˆ†ç»„</code>ï¼Œç„¶åæŠŠè‹¥å¹²ä¸ª<code>å°åˆ†ç»„</code>å†ç»†åˆ†æˆæ›´å¤šçš„<code>å°å°åˆ†ç»„</code>ã€‚</li></ol><p>ç„¶åé’ˆå¯¹é‚£äº›<code>å°å°åˆ†ç»„</code>è¿›è¡Œç»Ÿè®¡ï¼Œæ¯”å¦‚åœ¨æˆ‘ä»¬è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¸­å°±æ˜¯ç»Ÿè®¡æ¯ä¸ª<code>å°å°åˆ†ç»„</code>åŒ…å«çš„è®°å½•æ¡æ•°ã€‚å¦‚æœæ²¡æœ‰ç´¢å¼•çš„è¯ï¼Œè¿™ä¸ªåˆ†ç»„è¿‡ç¨‹å…¨éƒ¨éœ€è¦åœ¨å†…å­˜é‡Œå®ç°ï¼Œè€Œå¦‚æœæœ‰äº†ç´¢å¼•çš„è¯ï¼Œæ°å·§è¿™ä¸ªåˆ†ç»„é¡ºåºåˆå’Œæˆ‘ä»¬çš„<code>B+</code>æ ‘ä¸­çš„ç´¢å¼•åˆ—çš„é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œè€Œæˆ‘ä»¬çš„<code>B+</code>æ ‘ç´¢å¼•åˆæ˜¯æŒ‰ç…§ç´¢å¼•åˆ—æ’å¥½åºçš„ï¼Œè¿™ä¸æ­£å¥½ä¹ˆï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨<code>B+</code>æ ‘ç´¢å¼•è¿›è¡Œåˆ†ç»„ã€‚</p><p>å’Œä½¿ç”¨<code>B+</code>æ ‘ç´¢å¼•è¿›è¡Œæ’åºæ˜¯ä¸€ä¸ªé“ç†ï¼Œåˆ†ç»„åˆ—çš„é¡ºåºä¹Ÿéœ€è¦å’Œç´¢å¼•åˆ—çš„é¡ºåºä¸€è‡´ï¼Œä¹Ÿå¯ä»¥åªä½¿ç”¨ç´¢å¼•åˆ—ä¸­å·¦è¾¹çš„åˆ—è¿›è¡Œåˆ†ç»„ï¼Œå§å•¦å§å•¦çš„ï½</p><h2 id="å›è¡¨çš„ä»£ä»·">å›è¡¨çš„ä»£ä»·</h2><p>ä¸Šè¾¹çš„è®¨è®ºå¯¹<code>å›è¡¨</code>è¿™ä¸ªè¯å„¿å¤šæ˜¯ä¸€å¸¦è€Œè¿‡ï¼Œå¯èƒ½å¤§å®¶æ²¡å•¥æ·±åˆ»çš„ä½“ä¼šï¼Œä¸‹è¾¹æˆ‘ä»¬è¯¦ç»†å” å¨ä¸‹ã€‚è¿˜æ˜¯ç”¨<code>idx_name_birthday_phone_number</code>ç´¢å¼•ä¸ºä¾‹ï¼Œçœ‹ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> &gt; <span class="hljs-string">&#x27;Asa&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-type">name</span> &lt; <span class="hljs-string">&#x27;Barlow&#x27;</span>;<br></code></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨<code>idx_name_birthday_phone_number</code>ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶å¤§è‡´å¯ä»¥åˆ†ä¸ºè¿™ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li>ä»ç´¢å¼•<code>idx_name_birthday_phone_number</code>å¯¹åº”çš„<code>B+</code>æ ‘ä¸­å–å‡º<code>name</code>å€¼åœ¨<code>Asa</code>ï½<code>Barlow</code>ä¹‹é—´çš„ç”¨æˆ·è®°å½•ã€‚</li><li>ç”±äºç´¢å¼•<code>idx_name_birthday_phone_number</code>å¯¹åº”çš„<code>B+</code>æ ‘ç”¨æˆ·è®°å½•ä¸­åªåŒ…å«<code>name</code>ã€<code>birthday</code>ã€<code>phone_number</code>ã€<code>id</code>è¿™4ä¸ªå­—æ®µï¼Œè€ŒæŸ¥è¯¢åˆ—è¡¨æ˜¯<code>*</code>ï¼Œæ„å‘³ç€è¦æŸ¥è¯¢è¡¨ä¸­æ‰€æœ‰å­—æ®µï¼Œä¹Ÿå°±æ˜¯è¿˜è¦åŒ…æ‹¬<code>country</code>å­—æ®µã€‚è¿™æ—¶éœ€è¦æŠŠä»ä¸Šä¸€æ­¥ä¸­è·å–åˆ°çš„æ¯ä¸€æ¡è®°å½•çš„<code>id</code>å­—æ®µéƒ½åˆ°èšç°‡ç´¢å¼•å¯¹åº”çš„<code>B+</code>æ ‘ä¸­æ‰¾åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„<code>å›è¡¨</code>ï¼Œç„¶åæŠŠå®Œæ•´çš„ç”¨æˆ·è®°å½•è¿”å›ç»™æŸ¥è¯¢ç”¨æˆ·ã€‚</li></ol><p>ç”±äºç´¢å¼•<code>idx_name_birthday_phone_number</code>å¯¹åº”çš„<code>B+</code>æ ‘ä¸­çš„è®°å½•é¦–å…ˆä¼šæŒ‰ç…§<code>name</code>åˆ—çš„å€¼è¿›è¡Œæ’åºï¼Œæ‰€ä»¥å€¼åœ¨<code>Asa</code>ï½<code>Barlow</code>ä¹‹é—´çš„è®°å½•åœ¨ç£ç›˜ä¸­çš„å­˜å‚¨æ˜¯ç›¸è¿çš„ï¼Œé›†ä¸­åˆ†å¸ƒåœ¨ä¸€ä¸ªæˆ–å‡ ä¸ªæ•°æ®é¡µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«çš„æŠŠè¿™äº›è¿ç€çš„è®°å½•ä»ç£ç›˜ä¸­è¯»å‡ºæ¥ï¼Œè¿™ç§è¯»å–æ–¹å¼æˆ‘ä»¬ä¹Ÿå¯ä»¥ç§°ä¸º<code>é¡ºåºI/O</code>ã€‚æ ¹æ®ç¬¬1æ­¥ä¸­è·å–åˆ°çš„**è®°å½•çš„<code>id</code>å­—æ®µçš„å€¼å¯èƒ½å¹¶ä¸ç›¸è¿ï¼Œè€Œåœ¨èšç°‡ç´¢å¼•ä¸­è®°å½•æ˜¯æ ¹æ®<code>id</code>ï¼ˆä¹Ÿå°±æ˜¯ä¸»é”®ï¼‰çš„é¡ºåºæ’åˆ—çš„ï¼Œæ‰€ä»¥æ ¹æ®è¿™äº›å¹¶ä¸è¿ç»­çš„<code>id</code>å€¼åˆ°èšç°‡ç´¢å¼•ä¸­è®¿é—®å®Œæ•´çš„ç”¨æˆ·è®°å½•å¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„æ•°æ®é¡µä¸­ï¼Œè¿™æ ·è¯»å–å®Œæ•´çš„ç”¨æˆ·è®°å½•å¯èƒ½è¦è®¿é—®æ›´å¤šçš„æ•°æ®é¡µï¼Œè¿™ç§è¯»å–æ–¹å¼æˆ‘ä»¬ä¹Ÿå¯ä»¥ç§°ä¸º<code>éšæœºI/O</code>ã€‚**ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé¡ºåºI/Oæ¯”éšæœºI/Oçš„æ€§èƒ½é«˜å¾ˆå¤šï¼Œæ‰€ä»¥æ­¥éª¤1çš„æ‰§è¡Œå¯èƒ½å¾ˆå¿«ï¼Œè€Œæ­¥éª¤2å°±æ…¢ä¸€äº›ã€‚æ‰€ä»¥è¿™ä¸ªä½¿ç”¨ç´¢å¼•<code>idx_name_birthday_phone_number</code>çš„æŸ¥è¯¢æœ‰è¿™ä¹ˆä¸¤ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>ä¼šä½¿ç”¨åˆ°ä¸¤ä¸ª<code>B+</code>æ ‘ç´¢å¼•ï¼Œä¸€ä¸ªäºŒçº§ç´¢å¼•ï¼Œä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚</li><li>è®¿é—®äºŒçº§ç´¢å¼•ä½¿ç”¨<code>é¡ºåºI/O</code>ï¼Œè®¿é—®èšç°‡ç´¢å¼•ä½¿ç”¨<code>éšæœºI/O</code>ã€‚</li></ul><p>éœ€è¦å›è¡¨çš„è®°å½•è¶Šå¤šï¼Œä½¿ç”¨äºŒçº§ç´¢å¼•çš„æ€§èƒ½å°±è¶Šä½ï¼Œç”šè‡³è®©æŸäº›æŸ¥è¯¢å®æ„¿ä½¿ç”¨å…¨è¡¨æ‰«æä¹Ÿä¸ä½¿ç”¨<code>äºŒçº§ç´¢å¼•</code>ã€‚æ¯”æ–¹è¯´<code>name</code>å€¼åœ¨<code>Asa</code>ï½<code>Barlow</code>ä¹‹é—´çš„ç”¨æˆ·è®°å½•æ•°é‡å å…¨éƒ¨è®°å½•æ•°é‡90%ä»¥ä¸Šï¼Œé‚£ä¹ˆå¦‚æœä½¿ç”¨<code>idx_name_birthday_phone_number</code>ç´¢å¼•çš„è¯ï¼Œæœ‰90%å¤šçš„<code>id</code>å€¼éœ€è¦å›è¡¨ï¼Œè¿™ä¸æ˜¯åƒåŠ›ä¸è®¨å¥½ä¹ˆï¼Œè¿˜ä¸å¦‚ç›´æ¥å»æ‰«æèšç°‡ç´¢å¼•ï¼ˆä¹Ÿå°±æ˜¯å…¨è¡¨æ‰«æï¼‰ã€‚</p><p>é‚£ä»€ä¹ˆæ—¶å€™é‡‡ç”¨å…¨è¡¨æ‰«æçš„æ–¹å¼ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨é‡‡ç”¨<code>äºŒçº§ç´¢å¼• + å›è¡¨</code>çš„æ–¹å¼å»æ‰§è¡ŒæŸ¥è¯¢å‘¢ï¼Ÿè¿™ä¸ªå°±æ˜¯ä¼ è¯´ä¸­çš„æŸ¥è¯¢ä¼˜åŒ–å™¨åšçš„å·¥ä½œï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šäº‹å…ˆå¯¹è¡¨ä¸­çš„è®°å½•è®¡ç®—ä¸€äº›ç»Ÿè®¡æ•°æ®ï¼Œç„¶åå†åˆ©ç”¨è¿™äº›ç»Ÿè®¡æ•°æ®æ ¹æ®æŸ¥è¯¢çš„æ¡ä»¶æ¥è®¡ç®—ä¸€ä¸‹éœ€è¦å›è¡¨çš„è®°å½•æ•°ï¼Œéœ€è¦å›è¡¨çš„è®°å½•æ•°è¶Šå¤šï¼Œå°±è¶Šå€¾å‘äºä½¿ç”¨å…¨è¡¨æ‰«æï¼Œåä¹‹å€¾å‘äºä½¿ç”¨<code>äºŒçº§ç´¢å¼• + å›è¡¨</code>çš„æ–¹å¼ã€‚å½“ç„¶ä¼˜åŒ–å™¨åšçš„åˆ†æå·¥ä½œä¸ä»…ä»…æ˜¯è¿™ä¹ˆç®€å•ï¼Œä½†æ˜¯å¤§è‡´ä¸Šæ˜¯ä¸ªè¿™ä¸ªè¿‡ç¨‹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™åˆ¶æŸ¥è¯¢è·å–è¾ƒå°‘çš„è®°å½•æ•°ä¼šè®©ä¼˜åŒ–å™¨æ›´å€¾å‘äºé€‰æ‹©ä½¿ç”¨<code>äºŒçº§ç´¢å¼• + å›è¡¨</code>çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ï¼Œå› ä¸ºå›è¡¨çš„è®°å½•è¶Šå°‘ï¼Œæ€§èƒ½æå‡å°±è¶Šé«˜ï¼Œæ¯”æ–¹è¯´ä¸Šè¾¹çš„æŸ¥è¯¢å¯ä»¥æ”¹å†™æˆè¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> &gt; <span class="hljs-string">&#x27;Asa&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-type">name</span> &lt; <span class="hljs-string">&#x27;Barlow&#x27;</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p>æ·»åŠ äº†<code>LIMIT 10</code>çš„æŸ¥è¯¢æ›´å®¹æ˜“è®©ä¼˜åŒ–å™¨é‡‡ç”¨<code>äºŒçº§ç´¢å¼• + å›è¡¨</code>çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>å¯¹äºæœ‰æ’åºéœ€æ±‚çš„æŸ¥è¯¢ï¼Œä¸Šè¾¹è®¨è®ºçš„é‡‡ç”¨<code>å…¨è¡¨æ‰«æ</code>è¿˜æ˜¯<code>äºŒçº§ç´¢å¼• + å›è¡¨</code>çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢çš„æ¡ä»¶ä¹Ÿæ˜¯æˆç«‹çš„ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-type">name</span>, birthday, phone_number;<br></code></pre></td></tr></table></figure><p>ç”±äºæŸ¥è¯¢åˆ—è¡¨æ˜¯<code>*</code>ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨äºŒçº§ç´¢å¼•è¿›è¡Œæ’åºçš„è¯ï¼Œéœ€è¦æŠŠæ’åºå®Œçš„äºŒçº§ç´¢å¼•è®°å½•å…¨éƒ¨è¿›è¡Œå›è¡¨æ“ä½œï¼Œè¿™æ ·æ“ä½œçš„æˆæœ¬è¿˜ä¸å¦‚ç›´æ¥éå†èšç°‡ç´¢å¼•ç„¶åå†è¿›è¡Œæ–‡ä»¶æ’åºï¼ˆ<code>filesort</code>ï¼‰ä½ï¼Œæ‰€ä»¥ä¼˜åŒ–å™¨ä¼šå€¾å‘äºä½¿ç”¨<code>å…¨è¡¨æ‰«æ</code>çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ã€‚å¦‚æœæˆ‘ä»¬åŠ äº†<code>LIMIT</code>å­å¥ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-type">name</span>, birthday, phone_number <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p>è¿™æ ·éœ€è¦å›è¡¨çš„è®°å½•ç‰¹åˆ«å°‘ï¼Œä¼˜åŒ–å™¨å°±ä¼šå€¾å‘äºä½¿ç”¨<code>äºŒçº§ç´¢å¼• + å›è¡¨</code>çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ã€‚</p><h3 id="è¦†ç›–ç´¢å¼•">è¦†ç›–ç´¢å¼•</h3><p>ä¸ºäº†å½»åº•å‘Šåˆ«<code>å›è¡¨</code>æ“ä½œå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œæˆ‘ä»¬å»ºè®®ï¼šæœ€å¥½åœ¨æŸ¥è¯¢åˆ—è¡¨é‡ŒåªåŒ…å«ç´¢å¼•åˆ—ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> <span class="hljs-type">name</span>, birthday, phone_number <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> &gt; <span class="hljs-string">&#x27;Asa&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-type">name</span> &lt; <span class="hljs-string">&#x27;Barlow&#x27;</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬åªæŸ¥è¯¢<code>name</code>, <code>birthday</code>, <code>phone_number</code>è¿™ä¸‰ä¸ªç´¢å¼•åˆ—çš„å€¼ï¼Œæ‰€ä»¥åœ¨é€šè¿‡<code>idx_name_birthday_phone_number</code>ç´¢å¼•å¾—åˆ°ç»“æœåå°±ä¸å¿…åˆ°<code>èšç°‡ç´¢å¼•</code>ä¸­å†æŸ¥æ‰¾è®°å½•çš„å‰©ä½™åˆ—ï¼Œä¹Ÿå°±æ˜¯<code>country</code>åˆ—çš„å€¼äº†ï¼Œè¿™æ ·å°±çœå»äº†<code>å›è¡¨</code>æ“ä½œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚æˆ‘ä»¬æŠŠè¿™ç§åªéœ€è¦ç”¨åˆ°ç´¢å¼•çš„æŸ¥è¯¢æ–¹å¼ç§°ä¸º<code>ç´¢å¼•è¦†ç›–</code>ã€‚æ’åºæ“ä½œä¹Ÿä¼˜å…ˆä½¿ç”¨<code>è¦†ç›–ç´¢å¼•</code>çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ï¼Œæ¯”æ–¹è¯´è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> <span class="hljs-type">name</span>, birthday, phone_number  <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-type">name</span>, birthday, phone_number;<br></code></pre></td></tr></table></figure><p>è™½ç„¶è¿™ä¸ªæŸ¥è¯¢ä¸­æ²¡æœ‰<code>LIMIT</code>å­å¥ï¼Œä½†æ˜¯é‡‡ç”¨äº†<code>è¦†ç›–ç´¢å¼•</code>ï¼Œæ‰€ä»¥æŸ¥è¯¢ä¼˜åŒ–å™¨å°±ä¼šç›´æ¥ä½¿ç”¨<code>idx_name_birthday_phone_number</code>ç´¢å¼•è¿›è¡Œæ’åºè€Œä¸éœ€è¦å›è¡¨æ“ä½œäº†ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœä¸šåŠ¡éœ€è¦æŸ¥è¯¢å‡ºç´¢å¼•ä»¥å¤–çš„åˆ—ï¼Œé‚£è¿˜æ˜¯ä»¥ä¿è¯ä¸šåŠ¡éœ€æ±‚ä¸ºé‡ã€‚ä½†æ˜¯æˆ‘ä»¬å¾ˆä¸é¼“åŠ±ç”¨<code>*</code>å·ä½œä¸ºæŸ¥è¯¢åˆ—è¡¨ï¼Œæœ€å¥½æŠŠæˆ‘ä»¬éœ€è¦æŸ¥è¯¢çš„åˆ—ä¾æ¬¡æ ‡æ˜ã€‚</p><h2 id="å¦‚ä½•æŒ‘é€‰ç´¢å¼•">å¦‚ä½•æŒ‘é€‰ç´¢å¼•</h2><p>ä¸Šè¾¹æˆ‘ä»¬ä»¥<code>idx_name_birthday_phone_number</code>ç´¢å¼•ä¸ºä¾‹å¯¹ç´¢å¼•çš„é€‚ç”¨æ¡ä»¶è¿›è¡Œäº†è¯¦ç»†çš„å” å¨ï¼Œä¸‹è¾¹çœ‹ä¸€ä¸‹æˆ‘ä»¬åœ¨å»ºç«‹ç´¢å¼•æ—¶æˆ–è€…ç¼–å†™æŸ¥è¯¢è¯­å¥æ—¶å°±åº”è¯¥æ³¨æ„çš„ä¸€äº›äº‹é¡¹ã€‚</p><h3 id="åªä¸ºç”¨äºæœç´¢ã€æ’åºæˆ–åˆ†ç»„çš„åˆ—åˆ›å»ºç´¢å¼•">åªä¸ºç”¨äºæœç´¢ã€æ’åºæˆ–åˆ†ç»„çš„åˆ—åˆ›å»ºç´¢å¼•</h3><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªä¸ºå‡ºç°åœ¨<code>WHERE</code>å­å¥ä¸­çš„åˆ—ã€è¿æ¥å­å¥ä¸­çš„è¿æ¥åˆ—ï¼Œæˆ–è€…å‡ºç°åœ¨<code>ORDER BY</code>æˆ–<code>GROUP BY</code>å­å¥ä¸­çš„åˆ—åˆ›å»ºç´¢å¼•ã€‚è€Œå‡ºç°åœ¨æŸ¥è¯¢åˆ—è¡¨ä¸­çš„åˆ—å°±æ²¡å¿…è¦å»ºç«‹ç´¢å¼•äº†ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> birthday, country <span class="hljs-keyword">FROM</span> person_name <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;Ashburn&#x27;</span>;<br></code></pre></td></tr></table></figure><p>åƒæŸ¥è¯¢åˆ—è¡¨ä¸­çš„<code>birthday</code>ã€<code>country</code>è¿™ä¸¤ä¸ªåˆ—å°±ä¸éœ€è¦å»ºç«‹ç´¢å¼•ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸ºå‡ºç°åœ¨<code>WHERE</code>å­å¥ä¸­çš„<code>name</code>åˆ—åˆ›å»ºç´¢å¼•å°±å¯ä»¥äº†ã€‚</p><h3 id="è€ƒè™‘åˆ—çš„åŸºæ•°">è€ƒè™‘åˆ—çš„åŸºæ•°</h3><p><code>åˆ—çš„åŸºæ•°</code>æŒ‡çš„æ˜¯æŸä¸€åˆ—ä¸­ä¸é‡å¤æ•°æ®çš„ä¸ªæ•°ï¼Œæ¯”æ–¹è¯´æŸä¸ªåˆ—åŒ…å«å€¼<code>2, 5, 8, 2, 5, 8, 2, 5, 8</code>ï¼Œè™½ç„¶æœ‰<code>9</code>æ¡è®°å½•ï¼Œä½†è¯¥åˆ—çš„åŸºæ•°å´æ˜¯<code>3</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è®°å½•è¡Œæ•°ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œåˆ—çš„åŸºæ•°è¶Šå¤§ï¼Œè¯¥åˆ—ä¸­çš„å€¼è¶Šåˆ†æ•£ï¼Œåˆ—çš„åŸºæ•°è¶Šå°ï¼Œè¯¥åˆ—ä¸­çš„å€¼è¶Šé›†ä¸­ã€‚è¿™ä¸ª<code>åˆ—çš„åŸºæ•°</code>æŒ‡æ ‡éå¸¸é‡è¦ï¼Œç›´æ¥å½±å“æˆ‘ä»¬æ˜¯å¦èƒ½æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•ã€‚å‡è®¾æŸä¸ªåˆ—çš„åŸºæ•°ä¸º<code>1</code>ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰è®°å½•åœ¨è¯¥åˆ—ä¸­çš„å€¼éƒ½ä¸€æ ·ï¼Œé‚£ä¸ºè¯¥åˆ—å»ºç«‹ç´¢å¼•æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œå› ä¸ºæ‰€æœ‰å€¼éƒ½ä¸€æ ·å°±æ— æ³•æ’åºï¼Œæ— æ³•è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾äº†ï½ è€Œä¸”å¦‚æœæŸä¸ªå»ºç«‹äº†äºŒçº§ç´¢å¼•çš„åˆ—çš„é‡å¤å€¼ç‰¹åˆ«å¤šï¼Œé‚£ä¹ˆä½¿ç”¨è¿™ä¸ªäºŒçº§ç´¢å¼•æŸ¥å‡ºçš„è®°å½•è¿˜å¯èƒ½è¦åšå›è¡¨æ“ä½œï¼Œè¿™æ ·æ€§èƒ½æŸè€—å°±æ›´å¤§äº†ã€‚æ‰€ä»¥ç»“è®ºå°±æ˜¯ï¼š<strong>æœ€å¥½ä¸ºé‚£äº›åˆ—çš„åŸºæ•°å¤§çš„åˆ—å»ºç«‹ç´¢å¼•ï¼Œä¸ºåŸºæ•°å¤ªå°åˆ—çš„å»ºç«‹ç´¢å¼•æ•ˆæœå¯èƒ½ä¸å¥½ã€‚</strong></p><h3 id="ç´¢å¼•åˆ—çš„ç±»å‹å°½é‡å°">ç´¢å¼•åˆ—çš„ç±»å‹å°½é‡å°</h3><p>æˆ‘ä»¬åœ¨å®šä¹‰è¡¨ç»“æ„çš„æ—¶å€™è¦æ˜¾å¼çš„æŒ‡å®šåˆ—çš„ç±»å‹ï¼Œä»¥æ•´æ•°ç±»å‹ä¸ºä¾‹ï¼Œæœ‰<code>TINYINT</code>ã€<code>MEDIUMINT</code>ã€<code>INT</code>ã€<code>BIGINT</code>è¿™ä¹ˆå‡ ç§ï¼Œå®ƒä»¬å ç”¨çš„å­˜å‚¨ç©ºé—´ä¾æ¬¡é€’å¢ï¼Œæˆ‘ä»¬è¿™é‡Œæ‰€è¯´çš„<code>ç±»å‹å¤§å°</code>æŒ‡çš„å°±æ˜¯è¯¥ç±»å‹è¡¨ç¤ºçš„æ•°æ®èŒƒå›´çš„å¤§å°ã€‚èƒ½è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´å½“ç„¶ä¹Ÿæ˜¯ä¾æ¬¡é€’å¢ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹æŸä¸ªæ•´æ•°åˆ—å»ºç«‹ç´¢å¼•çš„è¯ï¼Œåœ¨è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´å…è®¸çš„æƒ…å†µä¸‹ï¼Œå°½é‡è®©ç´¢å¼•åˆ—ä½¿ç”¨è¾ƒå°çš„ç±»å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬èƒ½ä½¿ç”¨<code>INT</code>å°±ä¸è¦ä½¿ç”¨<code>BIGINT</code>ï¼Œèƒ½ä½¿ç”¨<code>MEDIUMINT</code>å°±ä¸è¦ä½¿ç”¨<code>INT</code>ï½ è¿™æ˜¯å› ä¸ºï¼š</p><ul><li>æ•°æ®ç±»å‹è¶Šå°ï¼Œåœ¨æŸ¥è¯¢æ—¶è¿›è¡Œçš„æ¯”è¾ƒæ“ä½œè¶Šå¿«ï¼ˆè¿™æ˜¯CPUå±‚æ¬¡çš„ä¸œä¸œï¼‰</li><li>æ•°æ®ç±»å‹è¶Šå°ï¼Œç´¢å¼•å ç”¨çš„å­˜å‚¨ç©ºé—´å°±è¶Šå°‘ï¼Œåœ¨ä¸€ä¸ªæ•°æ®é¡µå†…å°±å¯ä»¥æ”¾ä¸‹æ›´å¤šçš„è®°å½•ï¼Œä»è€Œå‡å°‘ç£ç›˜<code>I/O</code>å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥æŠŠæ›´å¤šçš„æ•°æ®é¡µç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€ŒåŠ å¿«è¯»å†™æ•ˆç‡ã€‚</li></ul><p>è¿™ä¸ªå»ºè®®å¯¹äºè¡¨çš„ä¸»é”®æ¥è¯´æ›´åŠ é€‚ç”¨ï¼Œå› ä¸ºä¸ä»…æ˜¯èšç°‡ç´¢å¼•ä¸­ä¼šå­˜å‚¨ä¸»é”®å€¼ï¼Œå…¶ä»–æ‰€æœ‰çš„äºŒçº§ç´¢å¼•çš„èŠ‚ç‚¹å¤„éƒ½ä¼šå­˜å‚¨ä¸€ä»½è®°å½•çš„ä¸»é”®å€¼ï¼Œå¦‚æœä¸»é”®é€‚ç”¨æ›´å°çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ„å‘³ç€èŠ‚çœæ›´å¤šçš„å­˜å‚¨ç©ºé—´å’Œæ›´é«˜æ•ˆçš„<code>I/O</code>ã€‚</p><h3 id="ç´¢å¼•å­—ç¬¦ä¸²å€¼çš„å‰ç¼€">ç´¢å¼•å­—ç¬¦ä¸²å€¼çš„å‰ç¼€</h3><p>æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªå­—ç¬¦ä¸²å…¶å®æ˜¯ç”±è‹¥å¹²ä¸ªå­—ç¬¦ç»„æˆï¼Œå¦‚æœæˆ‘ä»¬åœ¨<code>MySQL</code>ä¸­ä½¿ç”¨<code>utf8</code>å­—ç¬¦é›†å»å­˜å‚¨å­—ç¬¦ä¸²çš„è¯ï¼Œç¼–ç ä¸€ä¸ªå­—ç¬¦éœ€è¦å ç”¨<code>1~3</code>ä¸ªå­—èŠ‚ã€‚å‡è®¾æˆ‘ä»¬çš„å­—ç¬¦ä¸²å¾ˆé•¿ï¼Œé‚£å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ä¸²å°±éœ€è¦å ç”¨å¾ˆå¤§çš„å­˜å‚¨ç©ºé—´ã€‚åœ¨æˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²åˆ—å»ºç«‹ç´¢å¼•æ—¶ï¼Œé‚£å°±æ„å‘³ç€åœ¨å¯¹åº”çš„<code>B+</code>æ ‘ä¸­æœ‰è¿™ä¹ˆä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li><code>B+</code>æ ‘ç´¢å¼•ä¸­çš„è®°å½•éœ€è¦æŠŠè¯¥åˆ—çš„å®Œæ•´å­—ç¬¦ä¸²å­˜å‚¨èµ·æ¥ï¼Œè€Œä¸”å­—ç¬¦ä¸²è¶Šé•¿ï¼Œåœ¨ç´¢å¼•ä¸­å ç”¨çš„å­˜å‚¨ç©ºé—´è¶Šå¤§ã€‚</li><li>å¦‚æœ<code>B+</code>æ ‘ç´¢å¼•ä¸­ç´¢å¼•åˆ—å­˜å‚¨çš„å­—ç¬¦ä¸²å¾ˆé•¿ï¼Œé‚£åœ¨åšå­—ç¬¦ä¸²æ¯”è¾ƒæ—¶ä¼šå ç”¨æ›´å¤šçš„æ—¶é—´ã€‚</li></ul><p>æˆ‘ä»¬å‰è¾¹å„¿è¯´è¿‡ç´¢å¼•åˆ—çš„å­—ç¬¦ä¸²å‰ç¼€å…¶å®ä¹Ÿæ˜¯æ’å¥½åºçš„ï¼Œæ‰€ä»¥ç´¢å¼•çš„è®¾è®¡è€…æå‡ºäº†ä¸ªæ–¹æ¡ˆ â€” åªå¯¹å­—ç¬¦ä¸²çš„å‰å‡ ä¸ªå­—ç¬¦è¿›è¡Œç´¢å¼•ä¹Ÿå°±æ˜¯è¯´åœ¨äºŒçº§ç´¢å¼•çš„è®°å½•ä¸­åªä¿ç•™å­—ç¬¦ä¸²å‰å‡ ä¸ªå­—ç¬¦ã€‚è¿™æ ·åœ¨æŸ¥æ‰¾è®°å½•æ—¶è™½ç„¶ä¸èƒ½ç²¾ç¡®çš„å®šä½åˆ°è®°å½•çš„ä½ç½®ï¼Œä½†æ˜¯èƒ½å®šä½åˆ°ç›¸åº”å‰ç¼€æ‰€åœ¨çš„ä½ç½®ï¼Œç„¶åæ ¹æ®å‰ç¼€ç›¸åŒçš„è®°å½•çš„ä¸»é”®å€¼å›è¡¨æŸ¥è¯¢å®Œæ•´çš„å­—ç¬¦ä¸²å€¼ï¼Œå†å¯¹æ¯”å°±å¥½äº†ã€‚è¿™æ ·åªåœ¨<code>B+</code>æ ‘ä¸­å­˜å‚¨å­—ç¬¦ä¸²çš„å‰å‡ ä¸ªå­—ç¬¦çš„ç¼–ç ï¼Œæ—¢èŠ‚çº¦ç©ºé—´ï¼Œåˆå‡å°‘äº†å­—ç¬¦ä¸²çš„æ¯”è¾ƒæ—¶é—´ï¼Œè¿˜å¤§æ¦‚èƒ½è§£å†³æ’åºçš„é—®é¢˜ï¼Œä½•ä¹è€Œä¸ä¸ºï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬åœ¨å»ºè¡¨è¯­å¥ä¸­åªå¯¹<code>name</code>åˆ—çš„å‰10ä¸ªå­—ç¬¦è¿›è¡Œç´¢å¼•å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> person_info(<br>    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    birthday <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    phone_number <span class="hljs-type">CHAR</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    country <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    KEY idx_name_birthday_phone_number (name(<span class="hljs-number">10</span>), birthday, phone_number)<br>);    <br></code></pre></td></tr></table></figure><p><code>name(10)</code>å°±è¡¨ç¤ºåœ¨å»ºç«‹çš„<code>B+</code>æ ‘ç´¢å¼•ä¸­åªä¿ç•™è®°å½•çš„å‰<code>10</code>ä¸ªå­—ç¬¦çš„ç¼–ç ï¼Œè¿™ç§åªç´¢å¼•å­—ç¬¦ä¸²å€¼çš„å‰ç¼€çš„ç­–ç•¥æ˜¯æˆ‘ä»¬éå¸¸é¼“åŠ±çš„ï¼Œå°¤å…¶æ˜¯åœ¨å­—ç¬¦ä¸²ç±»å‹èƒ½å­˜å‚¨çš„å­—ç¬¦æ¯”è¾ƒå¤šçš„æ—¶å€™ã€‚</p><h4 id="ç´¢å¼•åˆ—å‰ç¼€å¯¹æ’åºçš„å½±å“">ç´¢å¼•åˆ—å‰ç¼€å¯¹æ’åºçš„å½±å“</h4><p>å¦‚æœä½¿ç”¨äº†ç´¢å¼•åˆ—å‰ç¼€ï¼Œæ¯”æ–¹è¯´å‰è¾¹åªæŠŠ<code>name</code>åˆ—çš„å‰10ä¸ªå­—ç¬¦æ”¾åˆ°äº†äºŒçº§ç´¢å¼•ä¸­ï¼Œä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢å¯èƒ½å°±æœ‰ç‚¹å„¿å°´å°¬äº†ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> person_info <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-type">name</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p>å› ä¸ºäºŒçº§ç´¢å¼•ä¸­ä¸åŒ…å«å®Œæ•´çš„<code>name</code>åˆ—ä¿¡æ¯ï¼Œæ‰€ä»¥æ— æ³•å¯¹å‰åä¸ªå­—ç¬¦ç›¸åŒï¼Œåè¾¹çš„å­—ç¬¦ä¸åŒçš„è®°å½•è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ç´¢å¼•åˆ—å‰ç¼€çš„æ–¹å¼æ— æ³•æ”¯æŒä½¿ç”¨ç´¢å¼•æ’åºï¼Œåªå¥½ä¹–ä¹–çš„ç”¨æ–‡ä»¶æ’åºå–½ã€‚</p><h3 id="è®©ç´¢å¼•åˆ—åœ¨æ¯”è¾ƒè¡¨è¾¾å¼ä¸­å•ç‹¬å‡ºç°">è®©ç´¢å¼•åˆ—åœ¨æ¯”è¾ƒè¡¨è¾¾å¼ä¸­å•ç‹¬å‡ºç°</h3><p>å‡è®¾è¡¨ä¸­æœ‰ä¸€ä¸ªæ•´æ•°åˆ—<code>my_col</code>ï¼Œæˆ‘ä»¬ä¸ºè¿™ä¸ªåˆ—å»ºç«‹äº†ç´¢å¼•ã€‚ä¸‹è¾¹çš„ä¸¤ä¸ª<code>WHERE</code>å­å¥è™½ç„¶è¯­ä¹‰æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯åœ¨æ•ˆç‡ä¸Šå´æœ‰å·®åˆ«ï¼š</p><ol><li><code>WHERE my_col * 2 &lt; 4</code></li><li><code>WHERE my_col &lt; 4/2</code></li></ol><p>ç¬¬1ä¸ª<code>WHERE</code>å­å¥ä¸­<code>my_col</code>åˆ—å¹¶ä¸æ˜¯ä»¥å•ç‹¬åˆ—çš„å½¢å¼å‡ºç°çš„ï¼Œè€Œæ˜¯ä»¥<code>my_col * 2</code>è¿™æ ·çš„è¡¨è¾¾å¼çš„å½¢å¼å‡ºç°çš„ï¼Œå­˜å‚¨å¼•æ“ä¼šä¾æ¬¡éå†æ‰€æœ‰çš„è®°å½•ï¼Œè®¡ç®—è¿™ä¸ªè¡¨è¾¾å¼çš„å€¼æ˜¯ä¸æ˜¯å°äº<code>4</code>ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹æ˜¯ä½¿ç”¨ä¸åˆ°ä¸º<code>my_col</code>åˆ—å»ºç«‹çš„<code>B+</code>æ ‘ç´¢å¼•çš„ã€‚è€Œç¬¬2ä¸ª<code>WHERE</code>å­å¥ä¸­<code>my_col</code>åˆ—å¹¶æ˜¯ä»¥å•ç‹¬åˆ—çš„å½¢å¼å‡ºç°çš„ï¼Œè¿™æ ·çš„æƒ…å†µå¯ä»¥ç›´æ¥ä½¿ç”¨<code>B+</code>æ ‘ç´¢å¼•ã€‚</p><p>æ‰€ä»¥ç»“è®ºå°±æ˜¯ï¼šå¦‚æœç´¢å¼•åˆ—åœ¨æ¯”è¾ƒè¡¨è¾¾å¼ä¸­ä¸æ˜¯ä»¥å•ç‹¬åˆ—çš„å½¢å¼å‡ºç°ï¼Œè€Œæ˜¯ä»¥æŸä¸ªè¡¨è¾¾å¼ï¼Œæˆ–è€…å‡½æ•°è°ƒç”¨å½¢å¼å‡ºç°çš„è¯ï¼Œæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ã€‚</p><h3 id="ä¸»é”®æ’å…¥é¡ºåº">ä¸»é”®æ’å…¥é¡ºåº</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºä¸€ä¸ªä½¿ç”¨<code>InnoDB</code>å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œåœ¨æˆ‘ä»¬æ²¡æœ‰æ˜¾å¼çš„åˆ›å»ºç´¢å¼•æ—¶ï¼Œè¡¨ä¸­çš„æ•°æ®å®é™…ä¸Šéƒ½æ˜¯å­˜å‚¨åœ¨<code>èšç°‡ç´¢å¼•</code>çš„å¶å­èŠ‚ç‚¹çš„ã€‚è€Œè®°å½•åˆæ˜¯å­˜å‚¨åœ¨æ•°æ®é¡µä¸­çš„ï¼Œæ•°æ®é¡µå’Œè®°å½•åˆæ˜¯æŒ‰ç…§è®°å½•ä¸»é”®å€¼ä»å°åˆ°å¤§çš„é¡ºåºè¿›è¡Œæ’åºï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æ’å…¥çš„è®°å½•çš„ä¸»é”®å€¼æ˜¯ä¾æ¬¡å¢å¤§çš„è¯ï¼Œé‚£æˆ‘ä»¬æ¯æ’æ»¡ä¸€ä¸ªæ•°æ®é¡µå°±æ¢åˆ°ä¸‹ä¸€ä¸ªæ•°æ®é¡µç»§ç»­æ’ï¼Œè€Œå¦‚æœæˆ‘ä»¬æ’å…¥çš„ä¸»é”®å€¼å¿½å¤§å¿½å°çš„è¯ï¼Œè¿™å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œå‡è®¾æŸä¸ªæ•°æ®é¡µå­˜å‚¨çš„è®°å½•å·²ç»æ»¡äº†ï¼Œå®ƒå­˜å‚¨çš„ä¸»é”®å€¼åœ¨<code>1~100</code>ä¹‹é—´ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16db02bc7153fee5~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1capq3r1o1geqdck1cnc1fkihj39.png-28.1kB"><p>å¦‚æœæ­¤æ—¶å†æ’å…¥ä¸€æ¡ä¸»é”®å€¼ä¸º<code>9</code>çš„è®°å½•ï¼Œé‚£å®ƒæ’å…¥çš„ä½ç½®å°±å¦‚ä¸‹å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16db02bc77059366~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1capq7nnv13en8b31lvtj2i1e8lm.png-35.3kB"><p>å¯è¿™ä¸ªæ•°æ®é¡µå·²ç»æ»¡äº†å•Šï¼Œå†æ’è¿›æ¥å’‹åŠå‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦æŠŠå½“å‰é¡µé¢åˆ†è£‚æˆä¸¤ä¸ªé¡µé¢ï¼ŒæŠŠæœ¬é¡µä¸­çš„ä¸€äº›è®°å½•ç§»åŠ¨åˆ°æ–°åˆ›å»ºçš„è¿™ä¸ªé¡µä¸­ã€‚é¡µé¢åˆ†è£‚å’Œè®°å½•ç§»ä½æ„å‘³ç€ä»€ä¹ˆï¼Ÿæ„å‘³ç€ï¼šæ€§èƒ½æŸè€—ï¼æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³å°½é‡é¿å…è¿™æ ·æ— è°“çš„æ€§èƒ½æŸè€—ï¼Œæœ€å¥½è®©æ’å…¥çš„è®°å½•çš„ä¸»é”®å€¼ä¾æ¬¡é€’å¢ï¼Œè¿™æ ·å°±ä¸ä¼šå‘ç”Ÿè¿™æ ·çš„æ€§èƒ½æŸè€—äº†ã€‚æ‰€ä»¥æˆ‘ä»¬å»ºè®®ï¼šè®©ä¸»é”®å…·æœ‰<code>AUTO_INCREMENT</code>ï¼Œè®©å­˜å‚¨å¼•æ“è‡ªå·±ä¸ºè¡¨ç”Ÿæˆä¸»é”®ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ’å…¥ ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰<code>person_info</code>è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> person_info(<br>    id <span class="hljs-type">INT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    birthday <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    phone_number <span class="hljs-type">CHAR</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    country <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-keyword">PRIMARY</span> KEY (id),<br>    KEY idx_name_birthday_phone_number (name(<span class="hljs-number">10</span>), birthday, phone_number)<br>);    <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸»é”®åˆ—<code>id</code>æ‹¥æœ‰<code>AUTO_INCREMENT</code>å±æ€§ï¼Œåœ¨æ’å…¥è®°å½•æ—¶å­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬å¡«å…¥è‡ªå¢çš„ä¸»é”®å€¼ã€‚</p><h3 id="å†—ä½™å’Œé‡å¤ç´¢å¼•">å†—ä½™å’Œé‡å¤ç´¢å¼•</h3><p>æœ‰æ—¶å€™æœ‰çš„åŒå­¦æœ‰æ„æˆ–è€…æ— æ„çš„å°±å¯¹åŒä¸€ä¸ªåˆ—åˆ›å»ºäº†å¤šä¸ªç´¢å¼•ï¼Œæ¯”æ–¹è¯´è¿™æ ·å†™å»ºè¡¨è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> person_info(<br>    id <span class="hljs-type">INT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    birthday <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    phone_number <span class="hljs-type">CHAR</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    country <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-keyword">PRIMARY</span> KEY (id),<br>    KEY idx_name_birthday_phone_number (name(<span class="hljs-number">10</span>), birthday, phone_number),<br>    KEY idx_name (name(<span class="hljs-number">10</span>))<br>);    <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“ï¼Œé€šè¿‡<code>idx_name_birthday_phone_number</code>ç´¢å¼•å°±å¯ä»¥å¯¹<code>name</code>åˆ—è¿›è¡Œå¿«é€Ÿæœç´¢ï¼Œå†åˆ›å»ºä¸€ä¸ªä¸“é—¨é’ˆå¯¹<code>name</code>åˆ—çš„ç´¢å¼•å°±ç®—æ˜¯ä¸€ä¸ª<code>å†—ä½™</code>ç´¢å¼•ï¼Œç»´æŠ¤è¿™ä¸ªç´¢å¼•åªä¼šå¢åŠ ç»´æŠ¤çš„æˆæœ¬ï¼Œå¹¶ä¸ä¼šå¯¹æœç´¢æœ‰ä»€ä¹ˆå¥½å¤„ã€‚</p><p>å¦ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¯¹æŸä¸ªåˆ—é‡å¤å»ºç«‹ç´¢å¼•ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> repeat_index_demo (<br>    c1 <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,<br>    c2 <span class="hljs-type">INT</span>,<br>    <span class="hljs-keyword">UNIQUE</span> uidx_c1 (c1),<br>    INDEX idx_c1 (c1)<br>);  <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œ<code>c1</code>æ—¢æ˜¯ä¸»é”®ã€åˆç»™å®ƒå®šä¹‰ä¸ºä¸€ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œè¿˜ç»™å®ƒå®šä¹‰äº†ä¸€ä¸ªæ™®é€šç´¢å¼•ï¼Œå¯æ˜¯ä¸»é”®æœ¬èº«å°±ä¼šç”Ÿæˆèšç°‡ç´¢å¼•ï¼Œæ‰€ä»¥å®šä¹‰çš„å”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•æ˜¯é‡å¤çš„ï¼Œè¿™ç§æƒ…å†µè¦é¿å…ã€‚</p><h2 id="æ€»ç»“-4">æ€»ç»“</h2><p>ä¸Šè¾¹åªæ˜¯æˆ‘ä»¬åœ¨åˆ›å»ºå’Œä½¿ç”¨<code>B+</code>æ ‘ç´¢å¼•çš„è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„ä¸€äº›ç‚¹ï¼Œåè¾¹æˆ‘ä»¬è¿˜ä¼šé™†ç»­ä»‹ç»æ›´å¤šçš„ä¼˜åŒ–æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹ï¼Œæ•¬è¯·æœŸå¾…ã€‚æœ¬é›†å†…å®¹æ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li><code>B+</code>æ ‘ç´¢å¼•åœ¨ç©ºé—´å’Œæ—¶é—´ä¸Šéƒ½æœ‰ä»£ä»·ï¼Œæ‰€ä»¥æ²¡äº‹å„¿åˆ«çå»ºç´¢å¼•ã€‚</li><li><code>B+</code>æ ‘ç´¢å¼•é€‚ç”¨äºä¸‹è¾¹è¿™äº›æƒ…å†µï¼š<ul><li>å…¨å€¼åŒ¹é…</li><li>åŒ¹é…å·¦è¾¹çš„åˆ—</li><li>åŒ¹é…èŒƒå›´å€¼</li><li>ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ—</li><li>ç”¨äºæ’åº</li><li>ç”¨äºåˆ†ç»„</li></ul></li><li>åœ¨ä½¿ç”¨ç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä¸‹è¾¹è¿™äº›äº‹é¡¹ï¼š<ul><li>åªä¸ºç”¨äºæœç´¢ã€æ’åºæˆ–åˆ†ç»„çš„åˆ—åˆ›å»ºç´¢å¼•</li><li>ä¸ºåˆ—çš„åŸºæ•°å¤§çš„åˆ—åˆ›å»ºç´¢å¼•</li><li>ç´¢å¼•åˆ—çš„ç±»å‹å°½é‡å°</li><li>å¯ä»¥åªå¯¹å­—ç¬¦ä¸²å€¼çš„å‰ç¼€å»ºç«‹ç´¢å¼•</li><li>åªæœ‰ç´¢å¼•åˆ—åœ¨æ¯”è¾ƒè¡¨è¾¾å¼ä¸­å•ç‹¬å‡ºç°æ‰å¯ä»¥é€‚ç”¨ç´¢å¼•</li><li>ä¸ºäº†å°½å¯èƒ½å°‘çš„è®©<code>èšç°‡ç´¢å¼•</code>å‘ç”Ÿé¡µé¢åˆ†è£‚å’Œè®°å½•ç§»ä½çš„æƒ…å†µï¼Œå»ºè®®è®©ä¸»é”®æ‹¥æœ‰<code>AUTO_INCREMENT</code>å±æ€§ã€‚</li><li>å®šä½å¹¶åˆ é™¤è¡¨ä¸­çš„é‡å¤å’Œå†—ä½™ç´¢å¼•</li><li>å°½é‡ä½¿ç”¨<code>è¦†ç›–ç´¢å¼•</code>è¿›è¡ŒæŸ¥è¯¢ï¼Œé¿å…<code>å›è¡¨</code>å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</li></ul></li></ol><h1>8.MySQL çš„æ•°æ®ç›®å½•</h1><h2 id="æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿçš„å…³ç³»">æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿçš„å…³ç³»</h2><p>æˆ‘ä»¬çŸ¥é“åƒ<code>InnoDB</code>ã€<code>MyISAM</code>è¿™æ ·çš„å­˜å‚¨å¼•æ“éƒ½æ˜¯æŠŠè¡¨å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ï¼Œè€Œæ“ä½œç³»ç»Ÿç”¨æ¥ç®¡ç†ç£ç›˜çš„é‚£ä¸ªä¸œä¸œåˆè¢«ç§°ä¸º<code>æ–‡ä»¶ç³»ç»Ÿ</code>ï¼Œæ‰€ä»¥ç”¨ä¸“ä¸šä¸€ç‚¹çš„è¯æ¥è¡¨è¿°å°±æ˜¯ï¼šåƒ <em><strong>InnoDB</strong></em> ã€ <em><strong>MyISAM</strong></em> è¿™æ ·çš„å­˜å‚¨å¼•æ“éƒ½æ˜¯æŠŠè¡¨å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ã€‚å½“æˆ‘ä»¬æƒ³è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œè¿™äº›å­˜å‚¨å¼•æ“ä¼šä»æ–‡ä»¶ç³»ç»Ÿä¸­æŠŠæ•°æ®è¯»å‡ºæ¥è¿”å›ç»™æˆ‘ä»¬ï¼Œå½“æˆ‘ä»¬æƒ³å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œè¿™äº›å­˜å‚¨å¼•æ“ä¼šæŠŠè¿™äº›æ•°æ®åˆå†™å›æ–‡ä»¶ç³»ç»Ÿã€‚æœ¬ç« å°±æ˜¯è¦å” å¨ä¸€ä¸‹<code>InnoDB</code>å’Œ<code>MyISAM</code>è¿™ä¸¤ä¸ªå­˜å‚¨å¼•æ“çš„æ•°æ®å¦‚ä½•åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å­˜å‚¨çš„ã€‚</p><h2 id="MySQLæ•°æ®ç›®å½•">MySQLæ•°æ®ç›®å½•</h2><p>MySQLæœåŠ¡å™¨ç¨‹åºåœ¨å¯åŠ¨æ—¶ä¼šåˆ°æ–‡ä»¶ç³»ç»Ÿçš„æŸä¸ªç›®å½•ä¸‹åŠ è½½ä¸€äº›æ–‡ä»¶ï¼Œä¹‹ååœ¨è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ•°æ®ä¹Ÿéƒ½ä¼šå­˜å‚¨åˆ°è¿™ä¸ªç›®å½•ä¸‹çš„æŸäº›æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªç›®å½•å°±ç§°ä¸º<code>æ•°æ®ç›®å½•</code>ï¼Œæˆ‘ä»¬ä¸‹è¾¹å°±è¦è¯¦ç»†å” å” è¿™ä¸ªç›®å½•ä¸‹å…·ä½“éƒ½æœ‰å“ªäº›é‡è¦çš„ä¸œè¥¿ã€‚</p><h3 id="æ•°æ®ç›®å½•å’Œå®‰è£…ç›®å½•çš„åŒºåˆ«">æ•°æ®ç›®å½•å’Œå®‰è£…ç›®å½•çš„åŒºåˆ«</h3><p>æˆ‘ä»¬ä¹‹å‰åªæ¥è§¦è¿‡<code>MySQL</code>çš„å®‰è£…ç›®å½•ï¼ˆåœ¨å®‰è£…<code>MySQL</code>çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥è‡ªå·±æŒ‡å®šï¼‰ï¼Œæˆ‘ä»¬é‡ç‚¹å¼ºè°ƒè¿‡è¿™ä¸ª<code>å®‰è£…ç›®å½•</code>ä¸‹éå¸¸é‡è¦çš„<code>bin</code>ç›®å½•ï¼Œå®ƒé‡Œè¾¹å­˜å‚¨äº†è®¸å¤šå…³äºæ§åˆ¶å®¢æˆ·ç«¯ç¨‹åºå’ŒæœåŠ¡å™¨ç¨‹åºçš„å‘½ä»¤ï¼ˆè®¸å¤šå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ¯”å¦‚<code>mysql</code>ï¼Œ<code>mysqld</code>ï¼Œ<code>mysqld_safe</code>ç­‰ç­‰ç­‰ç­‰å¥½å‡ åä¸ªï¼‰ã€‚è€Œ<code>æ•°æ®ç›®å½•</code>æ˜¯ç”¨æ¥å­˜å‚¨<code>MySQL</code>åœ¨è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ•°æ®ï¼Œä¸€å®šè¦å’Œæœ¬ç« è¦è®¨è®ºçš„<code>å®‰è£…ç›®å½•</code>åŒºåˆ«å¼€ï¼ä¸€å®šè¦åŒºåˆ†å¼€ï¼ä¸€å®šè¦åŒºåˆ†å¼€ï¼ä¸€å®šè¦åŒºåˆ†å¼€ï¼</p><h3 id="å¦‚ä½•ç¡®å®šMySQLä¸­çš„æ•°æ®ç›®å½•">å¦‚ä½•ç¡®å®šMySQLä¸­çš„æ•°æ®ç›®å½•</h3><p>é‚£è¯´äº†åŠå¤©ï¼Œåˆ°åº•<code>MySQL</code>æŠŠæ•°æ®éƒ½å­˜åˆ°å“ªä¸ªè·¯å¾„ä¸‹å‘¢ï¼Ÿå…¶å®<code>æ•°æ®ç›®å½•</code>å¯¹åº”ç€ä¸€ä¸ªç³»ç»Ÿå˜é‡<code>datadir</code>ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ä¹‹åæŸ¥çœ‹è¿™ä¸ªç³»ç»Ÿå˜é‡çš„å€¼å°±å¯ä»¥äº†ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;datadir&#x27;;</span><br><span class="hljs-section">+---------------+-----------------------+</span><br><span class="hljs-section">| Variable_name | Value                 |</span><br><span class="hljs-section">+---------------+-----------------------+</span><br><span class="hljs-section">| datadir       | /usr/local/var/mysql/ |</span><br><span class="hljs-section">+---------------+-----------------------+</span><br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨æˆ‘çš„è®¡ç®—æœºä¸Š<code>MySQL</code>çš„æ•°æ®ç›®å½•å°±æ˜¯<code>/usr/local/var/mysql/</code>ï¼Œä½ ç”¨ä½ çš„è®¡ç®—æœºè¯•è¯•å‘—ï½</p><h2 id="æ•°æ®ç›®å½•çš„ç»“æ„">æ•°æ®ç›®å½•çš„ç»“æ„</h2><p><code>MySQL</code>åœ¨è¿è¡Œè¿‡ç¨‹ä¸­éƒ½ä¼šäº§ç”Ÿå“ªäº›æ•°æ®å‘¢ï¼Ÿå½“ç„¶ä¼šåŒ…å«æˆ‘ä»¬åˆ›å»ºçš„æ•°æ®åº“ã€è¡¨ã€è§†å›¾å’Œè§¦å‘å™¨å§å•¦å§å•¦çš„ç”¨æˆ·æ•°æ®ï¼Œé™¤äº†è¿™äº›ç”¨æˆ·æ•°æ®ï¼Œä¸ºäº†ç¨‹åºæ›´å¥½çš„è¿è¡Œï¼Œ<code>MySQL</code>ä¹Ÿä¼šåˆ›å»ºä¸€äº›å…¶ä»–çš„é¢å¤–æ•°æ®ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ç»†ç»†çš„å“å‘³ä¸€ä¸‹è¿™ä¸ª<code>æ•°æ®ç›®å½•</code>ä¸‹çš„å†…å®¹ã€‚</p><h3 id="æ•°æ®åº“åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¡¨ç¤º">æ•°æ®åº“åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¡¨ç¤º</h3><p>æ¯å½“æˆ‘ä»¬ä½¿ç”¨<code>CREATE DATABASE æ•°æ®åº“å</code>è¯­å¥åˆ›å»ºä¸€ä¸ªæ•°æ®åº“çš„æ—¶å€™ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šå®é™…å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œæ¯ä¸ªæ•°æ®åº“éƒ½å¯¹åº”æ•°æ®ç›®å½•ä¸‹çš„ä¸€ä¸ªå­ç›®å½•ï¼Œæˆ–è€…è¯´å¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬æ¯å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ•°æ®åº“æ—¶ï¼Œ<code>MySQL</code>ä¼šå¸®æˆ‘ä»¬åšè¿™ä¸¤ä»¶äº‹å„¿ï¼š</p><ol><li>åœ¨<code>æ•°æ®ç›®å½•</code>ä¸‹åˆ›å»ºä¸€ä¸ªå’Œæ•°æ®åº“ååŒåçš„å­ç›®å½•ï¼ˆæˆ–è€…è¯´æ˜¯æ–‡ä»¶å¤¹ï¼‰ã€‚</li><li>åœ¨è¯¥ä¸æ•°æ®åº“ååŒåçš„å­ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>db.opt</code>çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«äº†è¯¥æ•°æ®åº“çš„å„ç§å±æ€§ï¼Œæ¯”æ–¹è¯´è¯¥æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™æ˜¯ä¸ªå•¥ã€‚</li></ol><p>æ¯”æ–¹è¯´æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹åœ¨æˆ‘çš„è®¡ç®—æœºä¸Šå½“å‰æœ‰å“ªäº›æ•°æ®åº“ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW DATABASES;</span><br><span class="hljs-section">+--------------------+</span><br><span class="hljs-section">| Database           |</span><br><span class="hljs-section">+--------------------+</span><br>| information<span class="hljs-emphasis">_schema |</span><br><span class="hljs-emphasis">| charset_demo_db    |</span><br><span class="hljs-emphasis">| dahaizi            |</span><br><span class="hljs-emphasis">| mysql              |</span><br><span class="hljs-emphasis">| performance_</span>schema |<br>| sys                |<br><span class="hljs-section">| xiaohaizi          |</span><br><span class="hljs-section">+--------------------+</span><br>7 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨æˆ‘çš„è®¡ç®—æœºä¸Šå½“å‰æœ‰7ä¸ªæ•°æ®åº“ï¼Œå…¶ä¸­<code>charset_demo_db</code>ã€<code>dahaizi</code>å’Œ<code>xiaohaizi</code>æ•°æ®åº“æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ï¼Œå…¶ä½™4ä¸ªæ•°æ®åº“æ˜¯å±äºMySQLè‡ªå¸¦çš„ç³»ç»Ÿæ•°æ®åº“ã€‚æˆ‘ä»¬å†çœ‹ä¸€ä¸‹æˆ‘çš„è®¡ç®—æœºä¸Šçš„<code>æ•°æ®ç›®å½•</code>ä¸‹çš„å†…å®¹ï¼š</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs stata">.<br>â”œâ”€â”€ auto.cnf<br>â”œâ”€â”€ <span class="hljs-keyword">ca</span>-key.pem<br>â”œâ”€â”€ <span class="hljs-keyword">ca</span>.pem<br>â”œâ”€â”€ charset_demo_db<br>â”œâ”€â”€ client-cert.pem<br>â”œâ”€â”€ client-key.pem<br>â”œâ”€â”€ dahaizi<br>â”œâ”€â”€ ib_buffer_pool<br>â”œâ”€â”€ ib_logfile0<br>â”œâ”€â”€ ib_logfile1<br>â”œâ”€â”€ ibdata1<br>â”œâ”€â”€ ibtmp1<br>â”œâ”€â”€ mysql<br>â”œâ”€â”€ performance_schema<br>â”œâ”€â”€ private_key.pem<br>â”œâ”€â”€ public_key.pem<br>â”œâ”€â”€ server-cert.pem<br>â”œâ”€â”€ server-key.pem<br>â”œâ”€â”€ sys<br>â”œâ”€â”€ xiaohaizideMacBook-<span class="hljs-keyword">Pro</span>.<span class="hljs-keyword">local</span>.<span class="hljs-keyword">err</span><br>â”œâ”€â”€ xiaohaizideMacBook-<span class="hljs-keyword">Pro</span>.<span class="hljs-keyword">local</span>.pid<br>â””â”€â”€ xiaohaizi<br><br>6 directories, 16 files<br></code></pre></td></tr></table></figure><p>å½“ç„¶è¿™ä¸ªæ•°æ®ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•æ¯”è¾ƒå¤šå“ˆï¼Œä½†æ˜¯å¦‚æœä»”ç»†çœ‹çš„è¯ï¼Œé™¤äº†<code>information_schema</code>è¿™ä¸ªç³»ç»Ÿæ•°æ®åº“å¤–ï¼Œå…¶ä»–çš„æ•°æ®åº“åœ¨<code>æ•°æ®ç›®å½•</code>ä¸‹éƒ½æœ‰å¯¹åº”çš„å­ç›®å½•ã€‚è¿™ä¸ª<code>information_schema</code>æ¯”è¾ƒç‰¹æ®Šï¼Œè®¾è®¡MySQLçš„å¤§å”ä»¬å¯¹å®ƒçš„å®ç°è¿›è¡Œäº†ç‰¹æ®Šå¯¹å¾…ï¼Œæ²¡æœ‰ä½¿ç”¨ç›¸åº”çš„æ•°æ®åº“ç›®å½•ï¼Œæˆ‘ä»¬å¿½ç•¥å®ƒçš„å­˜åœ¨å°±å¥½äº†å“ˆã€‚</p><h3 id="è¡¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¡¨ç¤º">è¡¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¡¨ç¤º</h3><p>æˆ‘ä»¬çš„æ•°æ®å…¶å®éƒ½æ˜¯ä»¥è®°å½•çš„å½¢å¼æ’å…¥åˆ°è¡¨ä¸­çš„ï¼Œæ¯ä¸ªè¡¨çš„ä¿¡æ¯å…¶å®å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š</p><ol><li>è¡¨ç»“æ„çš„å®šä¹‰</li><li>è¡¨ä¸­çš„æ•°æ®</li></ol><p><code>è¡¨ç»“æ„</code>å°±æ˜¯è¯¥è¡¨çš„åç§°æ˜¯å•¥ï¼Œè¡¨é‡Œè¾¹æœ‰å¤šå°‘åˆ—ï¼Œæ¯ä¸ªåˆ—çš„æ•°æ®ç±»å‹æ˜¯å•¥ï¼Œæœ‰å•¥çº¦æŸæ¡ä»¶å’Œç´¢å¼•ï¼Œç”¨çš„æ˜¯å•¥å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™å§å•¦å§å•¦çš„å„ç§ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éƒ½ä½“ç°åœ¨äº†æˆ‘ä»¬çš„å»ºè¡¨è¯­å¥ä¸­äº†ã€‚ä¸ºäº†ä¿å­˜è¿™äº›ä¿¡æ¯ï¼Œ<code>InnoDB</code>å’Œ<code>MyISAM</code>è¿™ä¸¤ç§å­˜å‚¨å¼•æ“éƒ½åœ¨<code>æ•°æ®ç›®å½•</code>ä¸‹å¯¹åº”çš„æ•°æ®åº“å­ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸“é—¨ç”¨äºæè¿°è¡¨ç»“æ„çš„æ–‡ä»¶ï¼Œæ–‡ä»¶åæ˜¯è¿™æ ·ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">è¡¨å<span class="hljs-string">.frm</span><br></code></pre></td></tr></table></figure><p>æ¯”æ–¹è¯´æˆ‘ä»¬åœ¨<code>dahaizi</code>æ•°æ®åº“ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>test</code>çš„è¡¨ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql&gt; USE dahaizi;<br><span class="hljs-keyword">Database</span> changed<br><br>mysql&gt; <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> test (<br>    -&gt;     c1 <span class="hljs-type">INT</span><br>    -&gt; );<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br></code></pre></td></tr></table></figure><p>é‚£åœ¨æ•°æ®åº“<code>dahaizi</code>å¯¹åº”çš„å­ç›®å½•ä¸‹å°±ä¼šåˆ›å»ºä¸€ä¸ªåä¸º<code>test.frm</code>çš„ç”¨äºæè¿°è¡¨ç»“æ„çš„æ–‡ä»¶ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåç¼€åä¸º.frmæ˜¯ä»¥äºŒè¿›åˆ¶æ ¼å¼å­˜å‚¨çš„ï¼Œæˆ‘ä»¬ç›´æ¥æ‰“å¼€ä¼šæ˜¯ä¹±ç çš„ï½ ä½ è¿˜ä¸èµ¶ç´§åœ¨ä½ çš„è®¡ç®—æœºä¸Šåˆ›å»ºä¸ªè¡¨è¯•è¯•ï½</p><p>æè¿°è¡¨ç»“æ„çš„æ–‡ä»¶æˆ‘ä»¬çŸ¥é“æ€ä¹ˆå­˜å‚¨äº†ï¼Œé‚£è¡¨ä¸­çš„æ•°æ®å­˜åˆ°ä»€ä¹ˆæ–‡ä»¶ä¸­äº†å‘¢ï¼Ÿåœ¨è¿™ä¸ªé—®é¢˜ä¸Šï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“å°±äº§ç”Ÿäº†åˆ†æ­§äº†ï¼Œä¸‹è¾¹æˆ‘ä»¬åˆ†åˆ«çœ‹ä¸€ä¸‹<code>InnoDB</code>å’Œ<code>MyISAM</code>æ˜¯ç”¨ä»€ä¹ˆæ–‡ä»¶æ¥ä¿å­˜è¡¨ä¸­æ•°æ®çš„ã€‚</p><h4 id="InnoDBæ˜¯å¦‚ä½•å­˜å‚¨è¡¨æ•°æ®çš„">InnoDBæ˜¯å¦‚ä½•å­˜å‚¨è¡¨æ•°æ®çš„</h4><p>æˆ‘ä»¬å‰è¾¹é‡ç‚¹å” å¨è¿‡<code>InnoDB</code>çš„ä¸€äº›å®ç°åŸç†ï¼Œåˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬åº”è¯¥ç†Ÿæ‚‰ä¸‹è¾¹è¿™äº›ä¸œä¸œï¼š</p><ul><li><code>InnoDB</code>å…¶å®æ˜¯ä½¿ç”¨<code>é¡µ</code>ä¸ºåŸºæœ¬å•ä½æ¥ç®¡ç†å­˜å‚¨ç©ºé—´çš„ï¼Œé»˜è®¤çš„<code>é¡µ</code>å¤§å°ä¸º<code>16KB</code>ã€‚</li><li>å¯¹äº<code>InnoDB</code>å­˜å‚¨å¼•æ“æ¥è¯´ï¼Œæ¯ä¸ªç´¢å¼•éƒ½å¯¹åº”ç€ä¸€æ£µ<code>B+</code>æ ‘ï¼Œè¯¥<code>B+</code>æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ•°æ®é¡µï¼Œæ•°æ®é¡µä¹‹é—´ä¸å¿…è¦æ˜¯ç‰©ç†è¿ç»­çš„ï¼Œå› ä¸ºæ•°æ®é¡µä¹‹é—´æœ‰<code>åŒå‘é“¾è¡¨</code>æ¥ç»´æŠ¤ç€è¿™äº›é¡µçš„é¡ºåºã€‚</li><li><code>InnoDB</code>çš„èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ç´¢å¼•å³æ•°æ®ï¼Œæ•°æ®å³ç´¢å¼•ã€‚</li></ul><p>ä¸ºäº†æ›´å¥½çš„ç®¡ç†è¿™äº›é¡µï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬æå‡ºäº†ä¸€ä¸ª<code>è¡¨ç©ºé—´</code>æˆ–è€…<code>æ–‡ä»¶ç©ºé—´</code>ï¼ˆè‹±æ–‡åï¼š<code>table space</code>æˆ–è€…<code>file space</code>ï¼‰çš„æ¦‚å¿µï¼Œè¿™ä¸ªè¡¨ç©ºé—´æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œå®ƒå¯ä»¥å¯¹åº”æ–‡ä»¶ç³»ç»Ÿä¸Šä¸€ä¸ªæˆ–å¤šä¸ªçœŸå®æ–‡ä»¶ï¼ˆä¸åŒè¡¨ç©ºé—´å¯¹åº”çš„æ–‡ä»¶æ•°é‡å¯èƒ½ä¸åŒï¼‰ã€‚æ¯ä¸€ä¸ª<code>è¡¨ç©ºé—´</code>å¯ä»¥è¢«åˆ’åˆ†ä¸ºå¾ˆå¤šå¾ˆå¤šå¾ˆå¤šä¸ª<code>é¡µ</code>ï¼Œæˆ‘ä»¬çš„è¡¨æ•°æ®å°±å­˜æ”¾åœ¨æŸä¸ª<code>è¡¨ç©ºé—´</code>ä¸‹çš„æŸäº›é¡µé‡Œã€‚è®¾è®¡<code>InnoDB</code>çš„å¤§å”å°†è¡¨ç©ºé—´åˆ’åˆ†ä¸ºå‡ ç§ä¸åŒçš„ç±»å‹ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªçœ‹ä¸€ä¸‹ã€‚</p><h5 id="ç³»ç»Ÿè¡¨ç©ºé—´ï¼ˆsystem-tablespaceï¼‰">ç³»ç»Ÿè¡¨ç©ºé—´ï¼ˆsystem tablespaceï¼‰</h5><p>è¿™ä¸ªæ‰€è°“çš„<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>å¯ä»¥å¯¹åº”æ–‡ä»¶ç³»ç»Ÿä¸Šä¸€ä¸ªæˆ–å¤šä¸ªå®é™…çš„æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>InnoDB</code>ä¼šåœ¨<code>æ•°æ®ç›®å½•</code>ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>ibdata1</code>ï¼ˆåœ¨ä½ çš„æ•°æ®ç›®å½•ä¸‹æ‰¾æ‰¾çœ‹æœ‰æœ¨æœ‰ï¼‰ã€å¤§å°ä¸º<code>12M</code>çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯å¯¹åº”çš„<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„è¡¨ç¤ºã€‚æ€ä¹ˆæ‰<code>12M</code>ï¼Ÿè¿™ä¹ˆç‚¹å„¿è¿˜æ²¡æ’å¤šå°‘æ•°æ®å°±ç”¨å®Œäº†ï¼Œå“ˆå“ˆï¼Œé‚£æ˜¯å› ä¸ºè¿™ä¸ªæ–‡ä»¶æ˜¯æ‰€è°“çš„<code>è‡ªæ‰©å±•æ–‡ä»¶</code>ï¼Œä¹Ÿå°±æ˜¯å½“ä¸å¤Ÿç”¨çš„æ—¶å€™å®ƒä¼šè‡ªå·±å¢åŠ æ–‡ä»¶å¤§å°ï½</p><p>å½“ç„¶ï¼Œå¦‚æœä½ æƒ³è®©ç³»ç»Ÿè¡¨ç©ºé—´å¯¹åº”æ–‡ä»¶ç³»ç»Ÿä¸Šå¤šä¸ªå®é™…æ–‡ä»¶ï¼Œæˆ–è€…ä»…ä»…è§‰å¾—åŸæ¥çš„<code>ibdata1</code>è¿™ä¸ªæ–‡ä»¶åéš¾å¬ï¼Œé‚£å¯ä»¥åœ¨<code>MySQL</code>å¯åŠ¨æ—¶é…ç½®å¯¹åº”çš„æ–‡ä»¶è·¯å¾„ä»¥åŠå®ƒä»¬çš„å¤§å°ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™æ ·ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[server]</span><br><span class="hljs-attr">innodb_data_file_path</span>=data1:<span class="hljs-number">512</span>M<span class="hljs-comment">;data2:512M:autoextend</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·åœ¨<code>MySQL</code>å¯åŠ¨ä¹‹åå°±ä¼šåˆ›å»ºè¿™ä¸¤ä¸ª512Må¤§å°çš„æ–‡ä»¶ä½œä¸º<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>ï¼Œå…¶ä¸­çš„<code>autoextend</code>è¡¨æ˜è¿™ä¸¤ä¸ªæ–‡ä»¶å¦‚æœä¸å¤Ÿç”¨ä¼šè‡ªåŠ¨æ‰©å±•<code>data2</code>æ–‡ä»¶çš„å¤§å°ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>å¯¹åº”çš„æ–‡ä»¶è·¯å¾„ä¸é…ç½®åˆ°<code>æ•°æ®ç›®å½•</code>ä¸‹ï¼Œç”šè‡³å¯ä»¥é…ç½®åˆ°å•ç‹¬çš„ç£ç›˜åˆ†åŒºä¸Šï¼Œæ¶‰åŠåˆ°çš„å¯åŠ¨å‚æ•°å°±æ˜¯<code>innodb_data_file_path</code>å’Œ<code>innodb_data_home_dir</code>ï¼Œå…·ä½“çš„é…ç½®é€»è¾‘æŒºç»•çš„ï¼Œæˆ‘ä»¬è¿™å°±ä¸å¤šå” å¨äº†ï¼ŒçŸ¥é“æ”¹å“ªä¸ªå‚æ•°å¯ä»¥ä¿®æ”¹<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>å¯¹åº”çš„æ–‡ä»¶ï¼Œæœ‰éœ€è¦çš„æ—¶å€™åˆ°å®˜æ–¹æ–‡æ¡£é‡Œä¸€æŸ¥å°±å¥½äº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨ä¸€ä¸ªMySQLæœåŠ¡å™¨ä¸­ï¼Œç³»ç»Ÿè¡¨ç©ºé—´åªæœ‰ä¸€ä»½ã€‚ä»MySQL5.5.7åˆ°MySQL5.6.6ä¹‹é—´çš„å„ä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬è¡¨ä¸­çš„æ•°æ®éƒ½ä¼šè¢«é»˜è®¤å­˜å‚¨åˆ°è¿™ä¸ª <em><strong>ç³»ç»Ÿè¡¨ç©ºé—´</strong></em>ã€‚</p><h5 id="ç‹¬ç«‹è¡¨ç©ºé—´-file-per-table-tablespace">ç‹¬ç«‹è¡¨ç©ºé—´(file-per-table tablespace)</h5><p>åœ¨MySQL5.6.6ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œ<code>InnoDB</code>å¹¶ä¸ä¼šé»˜è®¤çš„æŠŠå„ä¸ªè¡¨çš„æ•°æ®å­˜å‚¨åˆ°ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸€ä¸ªè¡¨å»ºç«‹ä¸€ä¸ªç‹¬ç«‹è¡¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åˆ›å»ºäº†å¤šå°‘ä¸ªè¡¨ï¼Œå°±æœ‰å¤šå°‘ä¸ªç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä½¿ç”¨<code>ç‹¬ç«‹è¡¨ç©ºé—´</code>æ¥å­˜å‚¨è¡¨æ•°æ®çš„è¯ï¼Œä¼šåœ¨è¯¥è¡¨æ‰€å±æ•°æ®åº“å¯¹åº”çš„å­ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºè¯¥<code>ç‹¬ç«‹è¡¨ç©ºé—´</code>çš„æ–‡ä»¶ï¼Œæ–‡ä»¶åå’Œè¡¨åç›¸åŒï¼Œåªä¸è¿‡æ·»åŠ äº†ä¸€ä¸ª<code>.ibd</code>çš„æ‰©å±•åè€Œå·²ï¼Œæ‰€ä»¥å®Œæ•´çš„æ–‡ä»¶åç§°é•¿è¿™æ ·ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">è¡¨å<span class="hljs-string">.ibd</span><br></code></pre></td></tr></table></figure><p>æ¯”æ–¹è¯´å‡å¦‚æˆ‘ä»¬ä½¿ç”¨äº†<code>ç‹¬ç«‹è¡¨ç©ºé—´</code>å»å­˜å‚¨<code>xiaohaizi</code>æ•°æ®åº“ä¸‹çš„<code>test</code>è¡¨çš„è¯ï¼Œé‚£ä¹ˆåœ¨è¯¥è¡¨æ‰€åœ¨æ•°æ®åº“å¯¹åº”çš„<code>xiaohaizi</code>ç›®å½•ä¸‹ä¼šä¸º<code>test</code>è¡¨åˆ›å»ºè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">test</span>.frm<br><span class="hljs-keyword">test</span>.ibd<br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>test.ibd</code>æ–‡ä»¶å°±ç”¨æ¥å­˜å‚¨<code>test</code>è¡¨ä¸­çš„æ•°æ®å’Œç´¢å¼•ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šä½¿ç”¨<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>è¿˜æ˜¯<code>ç‹¬ç«‹è¡¨ç©ºé—´</code>æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™ä¸ªåŠŸèƒ½ç”±å¯åŠ¨å‚æ•°<code>innodb_file_per_table</code>æ§åˆ¶ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬æƒ³åˆ»æ„å°†è¡¨æ•°æ®éƒ½å­˜å‚¨åˆ°<code>ç³»ç»Ÿè¡¨ç©ºé—´</code>æ—¶ï¼Œå¯ä»¥åœ¨å¯åŠ¨<code>MySQL</code>æœåŠ¡å™¨çš„æ—¶å€™è¿™æ ·é…ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[server]</span><br><span class="hljs-attr">innodb_file_per_table</span>=<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>å½“<code>innodb_file_per_table</code>çš„å€¼ä¸º<code>0</code>æ—¶ï¼Œä»£è¡¨ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´ï¼›å½“<code>innodb_file_per_table</code>çš„å€¼ä¸º<code>1</code>æ—¶ï¼Œä»£è¡¨ä½¿ç”¨ç‹¬ç«‹è¡¨ç©ºé—´ã€‚ä¸è¿‡<code>innodb_file_per_table</code>å‚æ•°åªå¯¹æ–°å»ºçš„è¡¨èµ·ä½œç”¨ï¼Œå¯¹äºå·²ç»åˆ†é…äº†è¡¨ç©ºé—´çš„è¡¨å¹¶ä¸èµ·ä½œç”¨ã€‚å¦‚æœæˆ‘ä»¬æƒ³æŠŠå·²ç»å­˜åœ¨ç³»ç»Ÿè¡¨ç©ºé—´ä¸­çš„è¡¨è½¬ç§»åˆ°ç‹¬ç«‹è¡¨ç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¾¹çš„è¯­æ³•ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å <span class="hljs-keyword">TABLESPACE</span> [=] innodb_file_per_table;<br></code></pre></td></tr></table></figure><p>æˆ–è€…æŠŠå·²ç»å­˜åœ¨ç‹¬ç«‹è¡¨ç©ºé—´çš„è¡¨è½¬ç§»åˆ°ç³»ç»Ÿè¡¨ç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¾¹çš„è¯­æ³•ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å <span class="hljs-keyword">TABLESPACE</span> [=] innodb_system;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ä¸­æ‹¬å·æ‰©èµ·æ¥çš„<code>=</code>å¯æœ‰å¯æ— ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬æƒ³æŠŠ<code>test</code>è¡¨ä»ç‹¬ç«‹è¡¨ç©ºé—´ç§»åŠ¨åˆ°ç³»ç»Ÿè¡¨ç©ºé—´ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> test <span class="hljs-keyword">TABLESPACE</span> innodb_system;<br></code></pre></td></tr></table></figure><h5 id="å…¶ä»–ç±»å‹çš„è¡¨ç©ºé—´">å…¶ä»–ç±»å‹çš„è¡¨ç©ºé—´</h5><p>éšç€MySQLçš„å‘å±•ï¼Œé™¤äº†ä¸Šè¿°ä¸¤ç§è€ç‰Œè¡¨ç©ºé—´ä¹‹å¤–ï¼Œç°åœ¨è¿˜æ–°æå‡ºäº†ä¸€äº›ä¸åŒç±»å‹çš„è¡¨ç©ºé—´ï¼Œæ¯”å¦‚é€šç”¨è¡¨ç©ºé—´ï¼ˆgeneral tablespaceï¼‰ã€undoè¡¨ç©ºé—´ï¼ˆundo tablespaceï¼‰ã€ä¸´æ—¶è¡¨ç©ºé—´ï¼ˆtemporary tablespaceï¼‰å§å•¦å§å•¦çš„ï¼Œå…·ä½“æƒ…å†µæˆ‘ä»¬å°±ä¸ç»†å” å¨äº†ï¼Œç­‰ç”¨åˆ°çš„æ—¶å€™å†æã€‚</p><h4 id="MyISAMæ˜¯å¦‚ä½•å­˜å‚¨è¡¨æ•°æ®çš„">MyISAMæ˜¯å¦‚ä½•å­˜å‚¨è¡¨æ•°æ®çš„</h4><p>å¥½äº†ï¼Œå” å¨å®Œäº†<code>InnoDB</code>çš„ç³»ç»Ÿè¡¨ç©ºé—´å’Œç‹¬ç«‹è¡¨ç©ºé—´ï¼Œç°åœ¨è½®åˆ°<code>MyISAM</code>äº†ã€‚æˆ‘ä»¬çŸ¥é“ä¸åƒ<code>InnoDB</code>çš„ç´¢å¼•å’Œæ•°æ®æ˜¯ä¸€ä¸ªä¸œä¸œï¼Œåœ¨<code>MyISAM</code>ä¸­çš„ç´¢å¼•å…¨éƒ¨éƒ½æ˜¯<code>äºŒçº§ç´¢å¼•</code>ï¼Œè¯¥å­˜å‚¨å¼•æ“çš„æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€å­˜æ”¾çš„ã€‚æ‰€ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¹Ÿæ˜¯ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æ¥å­˜å‚¨æ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶ã€‚è€Œä¸”å’Œ<code>InnoDB</code>ä¸åŒçš„æ˜¯ï¼Œ<code>MyISAM</code>å¹¶æ²¡æœ‰ä»€ä¹ˆæ‰€è°“çš„<code>è¡¨ç©ºé—´</code>ä¸€è¯´ï¼Œè¡¨æ•°æ®éƒ½å­˜æ”¾åˆ°å¯¹åº”çš„æ•°æ®åº“å­ç›®å½•ä¸‹ã€‚å‡å¦‚<code>test</code>è¡¨ä½¿ç”¨<code>MyISAM</code>å­˜å‚¨å¼•æ“çš„è¯ï¼Œé‚£ä¹ˆåœ¨å®ƒæ‰€åœ¨æ•°æ®åº“å¯¹åº”çš„<code>xiaohaizi</code>ç›®å½•ä¸‹ä¼šä¸º<code>test</code>è¡¨åˆ›å»ºè¿™ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">test</span>.frm<br><span class="hljs-keyword">test</span>.MYD<br><span class="hljs-keyword">test</span>.MYI<br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>test.MYD</code>ä»£è¡¨è¡¨çš„æ•°æ®æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ’å…¥çš„ç”¨æˆ·è®°å½•ï¼›<code>test.MYI</code>ä»£è¡¨è¡¨çš„ç´¢å¼•æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸ºè¯¥è¡¨åˆ›å»ºçš„ç´¢å¼•éƒ½ä¼šæ”¾åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p><h3 id="è§†å›¾åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¡¨ç¤º">è§†å›¾åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¡¨ç¤º</h3><p>æˆ‘ä»¬çŸ¥é“<code>MySQL</code>ä¸­çš„è§†å›¾å…¶å®æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œä¹Ÿå°±æ˜¯æŸä¸ªæŸ¥è¯¢è¯­å¥çš„ä¸€ä¸ªåˆ«åè€Œå·²ï¼Œæ‰€ä»¥åœ¨å­˜å‚¨<code>è§†å›¾</code>çš„æ—¶å€™æ˜¯ä¸éœ€è¦å­˜å‚¨çœŸå®çš„æ•°æ®çš„ï¼Œåªéœ€è¦æŠŠå®ƒçš„ç»“æ„å­˜å‚¨èµ·æ¥å°±è¡Œäº†ã€‚å’Œ<code>è¡¨</code>ä¸€æ ·ï¼Œæè¿°è§†å›¾ç»“æ„çš„æ–‡ä»¶ä¹Ÿä¼šè¢«å­˜å‚¨åˆ°æ‰€å±æ•°æ®åº“å¯¹åº”çš„å­ç›®å½•ä¸‹è¾¹ï¼Œåªä¼šå­˜å‚¨ä¸€ä¸ª<code>è§†å›¾å.frm</code>çš„æ–‡ä»¶ã€‚</p><h3 id="å…¶ä»–çš„æ–‡ä»¶">å…¶ä»–çš„æ–‡ä»¶</h3><p>é™¤äº†æˆ‘ä»¬ä¸Šè¾¹è¯´çš„è¿™äº›ç”¨æˆ·è‡ªå·±å­˜å‚¨çš„æ•°æ®ä»¥å¤–ï¼Œ<code>æ•°æ®ç›®å½•</code>ä¸‹è¿˜åŒ…æ‹¬ä¸ºäº†æ›´å¥½è¿è¡Œç¨‹åºçš„ä¸€äº›é¢å¤–æ–‡ä»¶ï¼Œä¸»è¦åŒ…æ‹¬è¿™å‡ ç§ç±»å‹çš„æ–‡ä»¶ï¼š</p><ul><li><p>æœåŠ¡å™¨è¿›ç¨‹æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬çŸ¥é“æ¯è¿è¡Œä¸€ä¸ª<code>MySQL</code>æœåŠ¡å™¨ç¨‹åºï¼Œéƒ½æ„å‘³ç€å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ã€‚<code>MySQL</code>æœåŠ¡å™¨ä¼šæŠŠè‡ªå·±çš„è¿›ç¨‹IDå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p></li><li><p>æœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶ã€‚</p><p>åœ¨æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå„ç§å„æ ·çš„æ—¥å¿—ï¼Œæ¯”å¦‚å¸¸è§„çš„æŸ¥è¯¢æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ã€äºŒè¿›åˆ¶æ—¥å¿—ã€redoæ—¥å¿—å§å•¦å§å•¦å„ç§æ—¥å¿—ï¼Œè¿™äº›æ—¥å¿—å„æœ‰å„çš„ç”¨é€”ï¼Œæˆ‘ä»¬ä¹‹åä¼šé‡ç‚¹å” å¨å„ç§æ—¥å¿—çš„ç”¨é€”ï¼Œç°åœ¨å…ˆäº†è§£ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p></li><li><p>é»˜è®¤/è‡ªåŠ¨ç”Ÿæˆçš„SSLå’ŒRSAè¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ã€‚</p><p>ä¸»è¦æ˜¯ä¸ºäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®‰å…¨é€šä¿¡è€Œåˆ›å»ºçš„ä¸€äº›æ–‡ä»¶ï¼Œ å¤§å®¶çœ‹ä¸æ‡‚å¯ä»¥å¿½ç•¥ï½</p></li></ul><h2 id="æ–‡ä»¶ç³»ç»Ÿå¯¹æ•°æ®åº“çš„å½±å“">æ–‡ä»¶ç³»ç»Ÿå¯¹æ•°æ®åº“çš„å½±å“</h2><p>å› ä¸º<code>MySQL</code>çš„æ•°æ®éƒ½æ˜¯å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ï¼Œå°±ä¸å¾—ä¸å—åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ä¸€äº›åˆ¶çº¦ï¼Œè¿™åœ¨æ•°æ®åº“å’Œè¡¨çš„å‘½åã€è¡¨çš„å¤§å°å’Œæ€§èƒ½æ–¹é¢ä½“ç°çš„æ¯”è¾ƒæ˜æ˜¾ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™äº›æ–¹é¢ï¼š</p><ul><li><p>æ•°æ®åº“åç§°å’Œè¡¨åç§°ä¸å¾—è¶…è¿‡æ–‡ä»¶ç³»ç»Ÿæ‰€å…è®¸çš„æœ€å¤§é•¿åº¦ã€‚</p><p>æ¯ä¸ªæ•°æ®åº“éƒ½å¯¹åº”<code>æ•°æ®ç›®å½•</code>çš„ä¸€ä¸ªå­ç›®å½•ï¼Œæ•°æ®åº“åç§°å°±æ˜¯è¿™ä¸ªå­ç›®å½•çš„åç§°ï¼›æ¯ä¸ªè¡¨éƒ½ä¼šåœ¨æ•°æ®åº“å­ç›®å½•ä¸‹äº§ç”Ÿä¸€ä¸ªå’Œè¡¨ååŒåçš„<code>.frm</code>æ–‡ä»¶ï¼Œå¦‚æœæ˜¯<code>InnoDB</code>çš„ç‹¬ç«‹è¡¨ç©ºé—´æˆ–è€…ä½¿ç”¨<code>MyISAM</code>å¼•æ“è¿˜ä¼šæœ‰åˆ«çš„æ–‡ä»¶çš„åç§°ä¸è¡¨åä¸€è‡´ã€‚è¿™äº›ç›®å½•æˆ–æ–‡ä»¶åçš„é•¿åº¦éƒ½å—é™äºæ–‡ä»¶ç³»ç»Ÿæ‰€å…è®¸çš„é•¿åº¦ï½</p></li><li><p>ç‰¹æ®Šå­—ç¬¦çš„é—®é¢˜</p><p>ä¸ºäº†é¿å…å› ä¸ºæ•°æ®åº“åå’Œè¡¨åå‡ºç°æŸäº›ç‰¹æ®Šå­—ç¬¦è€Œé€ æˆæ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒçš„æƒ…å†µï¼Œ<code>MySQL</code>ä¼šæŠŠæ•°æ®åº“åå’Œè¡¨åä¸­æ‰€æœ‰é™¤æ•°å­—å’Œæ‹‰ä¸å­—æ¯ä»¥å¤–çš„æ‰€æœ‰å­—ç¬¦åœ¨æ–‡ä»¶åé‡Œéƒ½æ˜ å°„æˆ <code>@+ç¼–ç å€¼</code>çš„å½¢å¼ä½œä¸ºæ–‡ä»¶åã€‚æ¯”æ–¹è¯´æˆ‘ä»¬åˆ›å»ºçš„è¡¨çš„åç§°ä¸º<code>'test?'</code>ï¼Œç”±äº<code>?</code>ä¸å±äºæ•°å­—æˆ–è€…æ‹‰ä¸å­—æ¯ï¼Œæ‰€ä»¥ä¼šè¢«æ˜ å°„æˆç¼–ç å€¼ï¼Œæ‰€ä»¥è¿™ä¸ªè¡¨å¯¹åº”çš„<code>.frm</code>æ–‡ä»¶çš„åç§°å°±å˜æˆäº†<code>test@003f.frm</code>ã€‚</p></li><li><p>æ–‡ä»¶é•¿åº¦å—æ–‡ä»¶ç³»ç»Ÿæœ€å¤§é•¿åº¦é™åˆ¶</p><p>å¯¹äº<code>InnoDB</code>çš„ç‹¬ç«‹è¡¨ç©ºé—´æ¥è¯´ï¼Œæ¯ä¸ªè¡¨çš„æ•°æ®éƒ½ä¼šè¢«å­˜å‚¨åˆ°ä¸€ä¸ªä¸è¡¨ååŒåçš„<code>.ibd</code>æ–‡ä»¶ä¸­ï¼›å¯¹äº<code>MyISAM</code>å­˜å‚¨å¼•æ“æ¥è¯´ï¼Œæ•°æ®å’Œç´¢å¼•ä¼šåˆ†åˆ«å­˜æ”¾åˆ°ä¸è¡¨åŒåçš„<code>.MYD</code>å’Œ<code>.MYI</code>æ–‡ä»¶ä¸­ã€‚è¿™äº›æ–‡ä»¶ä¼šéšç€è¡¨ä¸­è®°å½•çš„å¢åŠ è€Œå¢å¤§ï¼Œå®ƒä»¬çš„å¤§å°å—é™äºæ–‡ä»¶ç³»ç»Ÿæ”¯æŒçš„æœ€å¤§æ–‡ä»¶å¤§å°ã€‚</p></li></ul><h2 id="MySQLç³»ç»Ÿæ•°æ®åº“ç®€ä»‹">MySQLç³»ç»Ÿæ•°æ®åº“ç®€ä»‹</h2><p>æˆ‘ä»¬å‰è¾¹æåˆ°äº†MySQLçš„å‡ ä¸ªç³»ç»Ÿæ•°æ®åº“ï¼Œè¿™å‡ ä¸ªæ•°æ®åº“åŒ…å«äº†MySQLæœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€çš„ä¸€äº›ä¿¡æ¯ä»¥åŠä¸€äº›è¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼Œæˆ‘ä»¬ç°åœ¨ç¨å¾®äº†è§£ä¸€ä¸‹ã€‚</p><ul><li><p><code>mysql</code></p><p>è¿™ä¸ªæ•°æ®åº“è´¼æ ¸å¿ƒï¼Œå®ƒå­˜å‚¨äº†MySQLçš„ç”¨æˆ·è´¦æˆ·å’Œæƒé™ä¿¡æ¯ï¼Œä¸€äº›å­˜å‚¨è¿‡ç¨‹ã€äº‹ä»¶çš„å®šä¹‰ä¿¡æ¯ï¼Œä¸€äº›è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ—¥å¿—ä¿¡æ¯ï¼Œä¸€äº›å¸®åŠ©ä¿¡æ¯ä»¥åŠæ—¶åŒºä¿¡æ¯ç­‰ã€‚</p></li><li><p><code>information_schema</code></p><p>è¿™ä¸ªæ•°æ®åº“ä¿å­˜ç€MySQLæœåŠ¡å™¨ç»´æŠ¤çš„æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æœ‰å“ªäº›è¡¨ã€å“ªäº›è§†å›¾ã€å“ªäº›è§¦å‘å™¨ã€å“ªäº›åˆ—ã€å“ªäº›ç´¢å¼•å§å•¦å§å•¦ã€‚è¿™äº›ä¿¡æ¯å¹¶ä¸æ˜¯çœŸå®çš„ç”¨æˆ·æ•°æ®ï¼Œè€Œæ˜¯ä¸€äº›æè¿°æ€§ä¿¡æ¯ï¼Œæœ‰æ—¶å€™ä¹Ÿç§°ä¹‹ä¸ºå…ƒæ•°æ®ã€‚</p></li><li><p><code>performance_schema</code></p><p>è¿™ä¸ªæ•°æ®åº“é‡Œä¸»è¦ä¿å­˜MySQLæœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼Œç®—æ˜¯å¯¹MySQLæœåŠ¡å™¨çš„ä¸€ä¸ªæ€§èƒ½ç›‘æ§ã€‚åŒ…æ‹¬ç»Ÿè®¡æœ€è¿‘æ‰§è¡Œäº†å“ªäº›è¯­å¥ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹çš„æ¯ä¸ªé˜¶æ®µéƒ½èŠ±è´¹äº†å¤šé•¿æ—¶é—´ï¼Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µç­‰ç­‰ä¿¡æ¯ã€‚</p></li><li><p><code>sys</code></p><p>è¿™ä¸ªæ•°æ®åº“ä¸»è¦æ˜¯é€šè¿‡è§†å›¾çš„å½¢å¼æŠŠ<code>information_schema</code>å’Œ<code>performance_schema</code>ç»“åˆèµ·æ¥ï¼Œè®©ç¨‹åºå‘˜å¯ä»¥æ›´æ–¹ä¾¿çš„äº†è§£MySQLæœåŠ¡å™¨çš„ä¸€äº›æ€§èƒ½ä¿¡æ¯ã€‚</p></li></ul><h1>9.InnoDBçš„è¡¨ç©ºé—´</h1><p>é€šè¿‡å‰è¾¹å„¿çš„å†…å®¹å¤§å®¶çŸ¥é“ï¼Œ<code>è¡¨ç©ºé—´</code>æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œå¯¹äºç³»ç»Ÿè¡¨ç©ºé—´æ¥è¯´ï¼Œå¯¹åº”ç€æ–‡ä»¶ç³»ç»Ÿä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå®é™…æ–‡ä»¶ï¼›å¯¹äºæ¯ä¸ªç‹¬ç«‹è¡¨ç©ºé—´æ¥è¯´ï¼Œå¯¹åº”ç€æ–‡ä»¶ç³»ç»Ÿä¸­ä¸€ä¸ªåä¸º<code>è¡¨å.ibd</code>çš„å®é™…æ–‡ä»¶ã€‚å¤§å®¶å¯ä»¥æŠŠè¡¨ç©ºé—´æƒ³è±¡æˆè¢«åˆ‡åˆ†ä¸ºè®¸è®¸å¤šå¤šä¸ª<code>é¡µ</code>çš„æ± å­ï¼Œå½“æˆ‘ä»¬æƒ³ä¸ºæŸä¸ªè¡¨æ’å…¥ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œå°±ä»æ± å­ä¸­æå‡ºä¸€ä¸ªå¯¹åº”çš„é¡µæ¥æŠŠæ•°æ®å†™è¿›å»ã€‚æœ¬ç« å†…å®¹ä¼šæ·±å…¥åˆ°è¡¨ç©ºé—´çš„å„ä¸ªç»†èŠ‚ä¸­ï¼Œå¸¦é¢†å¤§å®¶åœ¨<code>InnoDB</code>å­˜å‚¨ç»“æ„çš„æ± å­ä¸­ç•…æ¸¸ã€‚ç”±äºæœ¬ç« ä¸­å°†ä¼šæ¶‰åŠæ¯”è¾ƒå¤šçš„æ¦‚å¿µï¼Œè™½ç„¶è¿™äº›æ¦‚å¿µéƒ½ä¸éš¾ï¼Œä½†æ˜¯å´ç›¸äº’ä¾èµ–ï¼Œæ‰€ä»¥å¥‰åŠå¤§å®¶åœ¨çœ‹çš„æ—¶å€™ï¼š</p><ul><li>ä¸è¦è·³ç€çœ‹ï¼</li><li>ä¸è¦è·³ç€çœ‹ï¼</li><li>ä¸è¦è·³ç€çœ‹ï¼</li></ul><h2 id="å›å¿†ä¸€äº›æ—§çŸ¥è¯†">å›å¿†ä¸€äº›æ—§çŸ¥è¯†</h2><h3 id="é¡µé¢ç±»å‹">é¡µé¢ç±»å‹</h3><p>å†ä¸€æ¬¡å¼ºè°ƒï¼ŒInnoDBæ˜¯ä»¥é¡µä¸ºå•ä½ç®¡ç†å­˜å‚¨ç©ºé—´çš„ï¼Œæˆ‘ä»¬çš„èšç°‡ç´¢å¼•ï¼ˆä¹Ÿå°±æ˜¯å®Œæ•´çš„è¡¨æ•°æ®ï¼‰å’Œå…¶ä»–çš„äºŒçº§ç´¢å¼•éƒ½æ˜¯ä»¥<code>B+</code>æ ‘çš„å½¢å¼ä¿å­˜åˆ°è¡¨ç©ºé—´çš„ï¼Œè€Œ<code>B+</code>æ ‘çš„èŠ‚ç‚¹å°±æ˜¯æ•°æ®é¡µã€‚æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œè¿™ä¸ªæ•°æ®é¡µçš„ç±»å‹åå…¶å®æ˜¯ï¼š<code>FIL_PAGE_INDEX</code>ï¼Œé™¤äº†è¿™ç§å­˜æ”¾ç´¢å¼•æ•°æ®çš„é¡µé¢ç±»å‹ä¹‹å¤–ï¼ŒInnoDBä¹Ÿä¸ºäº†ä¸åŒçš„ç›®çš„è®¾è®¡äº†è‹¥å¹²ç§ä¸åŒç±»å‹çš„é¡µé¢ï¼Œä¸ºäº†å”¤é†’å¤§å®¶çš„è®°å¿†ï¼Œæˆ‘ä»¬å†ä¸€æ¬¡æŠŠå„ç§å¸¸ç”¨çš„é¡µé¢ç±»å‹æå‡ºæ¥ï¼š</p><table><thead><tr><th>ç±»å‹åç§°</th><th>åå…­è¿›åˆ¶</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>FIL_PAGE_TYPE_ALLOCATED</code></td><td>0x0000</td><td>æœ€æ–°åˆ†é…ï¼Œè¿˜æ²¡ä½¿ç”¨</td></tr><tr><td><code>FIL_PAGE_UNDO_LOG</code></td><td>0x0002</td><td>Undoæ—¥å¿—é¡µ</td></tr><tr><td><code>FIL_PAGE_INODE</code></td><td>0x0003</td><td>æ®µä¿¡æ¯èŠ‚ç‚¹</td></tr><tr><td><code>FIL_PAGE_IBUF_FREE_LIST</code></td><td>0x0004</td><td>Insert Bufferç©ºé—²åˆ—è¡¨</td></tr><tr><td><code>FIL_PAGE_IBUF_BITMAP</code></td><td>0x0005</td><td>Insert Bufferä½å›¾</td></tr><tr><td><code>FIL_PAGE_TYPE_SYS</code></td><td>0x0006</td><td>ç³»ç»Ÿé¡µ</td></tr><tr><td><code>FIL_PAGE_TYPE_TRX_SYS</code></td><td>0x0007</td><td>äº‹åŠ¡ç³»ç»Ÿæ•°æ®</td></tr><tr><td><code>FIL_PAGE_TYPE_FSP_HDR</code></td><td>0x0008</td><td>è¡¨ç©ºé—´å¤´éƒ¨ä¿¡æ¯</td></tr><tr><td><code>FIL_PAGE_TYPE_XDES</code></td><td>0x0009</td><td>æ‰©å±•æè¿°é¡µ</td></tr><tr><td><code>FIL_PAGE_TYPE_BLOB</code></td><td>0x000A</td><td>BLOBé¡µ</td></tr><tr><td><code>FIL_PAGE_INDEX</code></td><td>0x45BF</td><td>ç´¢å¼•é¡µï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„<code>æ•°æ®é¡µ</code></td></tr></tbody></table><p>å› ä¸ºé¡µé¢ç±»å‹å‰è¾¹éƒ½æœ‰ä¸ª<code>FIL_PAGE</code>æˆ–è€…<code>FIL_PAGE_TYPE</code>çš„å‰ç¼€ï¼Œä¸ºç®€ä¾¿èµ·è§æˆ‘ä»¬åè¾¹å” å¨é¡µé¢ç±»å‹çš„æ—¶å€™å°±æŠŠè¿™äº›å‰ç¼€çœç•¥æ‰äº†ï¼Œæ¯”æ–¹è¯´<code>FIL_PAGE_TYPE_ALLOCATED</code>ç±»å‹ç§°ä¸º<code>ALLOCATED</code>ç±»å‹ï¼Œ<code>FIL_PAGE_INDEX</code>ç±»å‹ç§°ä¸º<code>INDEX</code>ç±»å‹ã€‚</p><h3 id="é¡µé¢é€šç”¨éƒ¨åˆ†">é¡µé¢é€šç”¨éƒ¨åˆ†</h3><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡æ•°æ®é¡µï¼Œä¹Ÿå°±æ˜¯<code>INDEX</code>ç±»å‹çš„é¡µç”±7ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­çš„ä¸¤ä¸ªéƒ¨åˆ†æ˜¯æ‰€æœ‰ç±»å‹çš„é¡µé¢éƒ½é€šç”¨çš„ã€‚å½“ç„¶æˆ‘ä¸èƒ½å¯„å¸Œæœ›äºä½ æŠŠæˆ‘è¯´çš„è¯éƒ½è®°ä½ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œé‡æ–°å¼ºè°ƒä¸€éï¼Œä»»ä½•ç±»å‹çš„é¡µé¢éƒ½æœ‰ä¸‹è¾¹è¿™ç§é€šç”¨çš„ç»“æ„ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f33c338667~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1crjupisqne61uer17ikh6l1v8k9.png-44.9kB"><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä»»ä½•ç±»å‹çš„é¡µéƒ½ä¼šåŒ…å«è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><code>File Header</code>ï¼šè®°å½•é¡µé¢çš„ä¸€äº›é€šç”¨ä¿¡æ¯</li><li><code>File Trailer</code>ï¼šæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ï¼Œä¿è¯ä»å†…å­˜åˆ°ç£ç›˜åˆ·æ–°æ—¶å†…å®¹çš„ä¸€è‡´æ€§ã€‚</li></ul><p>å¯¹äº<code>File Trailer</code>æˆ‘ä»¬ä¸å†åšè¿‡å¤šå¼ºè°ƒï¼Œå…¨éƒ¨å¿˜è®°äº†çš„è¯å¯ä»¥åˆ°å°†æ•°æ®é¡µçš„é‚£ä¸€ç« å›é¡¾ä¸€ä¸‹ã€‚æˆ‘ä»¬è¿™é‡Œå†å¼ºè°ƒä¸€é<code>File Header</code>çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p><table><thead><tr><th>åç§°</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>FIL_PAGE_SPACE_OR_CHKSUM</code></td><td><code>4</code>å­—èŠ‚</td><td>é¡µçš„æ ¡éªŒå’Œï¼ˆchecksumå€¼ï¼‰</td></tr><tr><td><code>FIL_PAGE_OFFSET</code></td><td><code>4</code>å­—èŠ‚</td><td>é¡µå·</td></tr><tr><td><code>FIL_PAGE_PREV</code></td><td><code>4</code>å­—èŠ‚</td><td>ä¸Šä¸€ä¸ªé¡µçš„é¡µå·</td></tr><tr><td><code>FIL_PAGE_NEXT</code></td><td><code>4</code>å­—èŠ‚</td><td>ä¸‹ä¸€ä¸ªé¡µçš„é¡µå·</td></tr><tr><td><code>FIL_PAGE_LSN</code></td><td><code>8</code>å­—èŠ‚</td><td>é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®ï¼ˆè‹±æ–‡åæ˜¯ï¼šLog Sequence Numberï¼‰</td></tr><tr><td><code>FIL_PAGE_TYPE</code></td><td><code>2</code>å­—èŠ‚</td><td>è¯¥é¡µçš„ç±»å‹</td></tr><tr><td><code>FIL_PAGE_FILE_FLUSH_LSN</code></td><td><code>8</code>å­—èŠ‚</td><td>ä»…åœ¨ç³»ç»Ÿè¡¨ç©ºé—´çš„ä¸€ä¸ªé¡µä¸­å®šä¹‰ï¼Œä»£è¡¨æ–‡ä»¶è‡³å°‘è¢«åˆ·æ–°åˆ°äº†å¯¹åº”çš„LSNå€¼</td></tr><tr><td><code>FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID</code></td><td><code>4</code>å­—èŠ‚</td><td>é¡µå±äºå“ªä¸ªè¡¨ç©ºé—´</td></tr></tbody></table><p>ç°åœ¨é™¤äº†åç§°é‡Œè¾¹å„¿å¸¦æœ‰<code>LSN</code>çš„ä¸¤ä¸ªå­—æ®µå¤§å®¶å¯èƒ½çœ‹ä¸æ‡‚ä»¥å¤–ï¼Œå…¶ä»–çš„å­—æ®µè‚¯å®šéƒ½æ˜¯å€å„¿ç†Ÿäº†ï¼Œä¸è¿‡æˆ‘ä»¬ä»è¦å¼ºè°ƒè¿™ä¹ˆå‡ ç‚¹ï¼š</p><ul><li>è¡¨ç©ºé—´ä¸­çš„æ¯ä¸€ä¸ªé¡µéƒ½å¯¹åº”ç€ä¸€ä¸ªé¡µå·ï¼Œä¹Ÿå°±æ˜¯<code>FIL_PAGE_OFFSET</code>ï¼Œè¿™ä¸ªé¡µå·ç”±4ä¸ªå­—èŠ‚ç»„æˆï¼Œä¹Ÿå°±æ˜¯32ä¸ªæ¯”ç‰¹ä½ï¼Œæ‰€ä»¥ä¸€ä¸ªè¡¨ç©ºé—´æœ€å¤šå¯ä»¥æ‹¥æœ‰2Â³Â²ä¸ªé¡µï¼Œ**å¦‚æœæŒ‰ç…§é¡µçš„é»˜è®¤å¤§å°16KBæ¥ç®—ï¼Œä¸€ä¸ªè¡¨ç©ºé—´æœ€å¤šæ”¯æŒ64TBçš„æ•°æ®ã€‚**è¡¨ç©ºé—´çš„ç¬¬ä¸€ä¸ªé¡µçš„é¡µå·ä¸º0ï¼Œä¹‹åçš„é¡µå·åˆ†åˆ«æ˜¯1ï¼Œ2ï¼Œ3â€¦ä¾æ­¤ç±»æ¨</li><li>æŸäº›ç±»å‹çš„é¡µå¯ä»¥ç»„æˆé“¾è¡¨ï¼Œé“¾è¡¨ä¸­çš„é¡µå¯ä»¥ä¸æŒ‰ç…§ç‰©ç†é¡ºåºå­˜å‚¨ï¼Œè€Œæ˜¯æ ¹æ®<code>FIL_PAGE_PREV</code>å’Œ<code>FIL_PAGE_NEXT</code>æ¥å­˜å‚¨ä¸Šä¸€ä¸ªé¡µå’Œä¸‹ä¸€ä¸ªé¡µçš„é¡µå·ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªå­—æ®µä¸»è¦æ˜¯ä¸ºäº†<code>INDEX</code>ç±»å‹çš„é¡µï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä¸€ç›´è¯´çš„æ•°æ®é¡µå»ºç«‹<code>B+</code>æ ‘åï¼Œä¸ºæ¯å±‚èŠ‚ç‚¹å»ºç«‹åŒå‘é“¾è¡¨ç”¨çš„ï¼Œä¸€èˆ¬ç±»å‹çš„é¡µæ˜¯ä¸ä½¿ç”¨è¿™ä¸¤ä¸ªå­—æ®µçš„ã€‚</li><li>æ¯ä¸ªé¡µçš„ç±»å‹ç”±<code>FIL_PAGE_TYPE</code>è¡¨ç¤ºï¼Œæ¯”å¦‚åƒæ•°æ®é¡µçš„è¯¥å­—æ®µçš„å€¼å°±æ˜¯<code>0x45BF</code>ï¼Œæˆ‘ä»¬åè¾¹ä¼šä»‹ç»å„ç§ä¸åŒç±»å‹çš„é¡µï¼Œä¸åŒç±»å‹çš„é¡µåœ¨è¯¥å­—æ®µä¸Šçš„å€¼æ˜¯ä¸åŒçš„ã€‚</li></ul><h2 id="ç‹¬ç«‹è¡¨ç©ºé—´ç»“æ„">ç‹¬ç«‹è¡¨ç©ºé—´ç»“æ„</h2><p>æˆ‘ä»¬çŸ¥é“<code>InnoDB</code>æ”¯æŒè®¸å¤šç§ç±»å‹çš„è¡¨ç©ºé—´ï¼Œæœ¬ç« é‡ç‚¹å…³æ³¨ç‹¬ç«‹è¡¨ç©ºé—´å’Œç³»ç»Ÿè¡¨ç©ºé—´çš„ç»“æ„ã€‚å®ƒä»¬çš„ç»“æ„æ¯”è¾ƒç›¸ä¼¼ï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿè¡¨ç©ºé—´ä¸­é¢å¤–åŒ…å«äº†ä¸€äº›å…³äºæ•´ä¸ªç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæŒ‘ç®€å•ä¸€ç‚¹çš„ç‹¬ç«‹è¡¨ç©ºé—´æ¥å” å¨ï¼Œç¨åå†è¯´ç³»ç»Ÿè¡¨ç©ºé—´çš„ç»“æ„ã€‚</p><h3 id="åŒºï¼ˆextentï¼‰çš„æ¦‚å¿µ">åŒºï¼ˆextentï¼‰çš„æ¦‚å¿µ</h3><p>è¡¨ç©ºé—´ä¸­çš„é¡µå®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œä¸ºäº†æ›´å¥½çš„ç®¡ç†è¿™äº›é¡µé¢ï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬æå‡ºäº†<code>åŒº</code>ï¼ˆè‹±æ–‡åï¼š<code>extent</code>ï¼‰çš„æ¦‚å¿µã€‚**å¯¹äº16KBçš„é¡µæ¥è¯´ï¼Œè¿ç»­çš„64ä¸ªé¡µå°±æ˜¯ä¸€ä¸ª<code>åŒº</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªåŒºé»˜è®¤å ç”¨1MBç©ºé—´å¤§å°ã€‚**ä¸è®ºæ˜¯ç³»ç»Ÿè¡¨ç©ºé—´è¿˜æ˜¯ç‹¬ç«‹è¡¨ç©ºé—´ï¼Œéƒ½å¯ä»¥çœ‹æˆæ˜¯ç”±è‹¥å¹²ä¸ªåŒºç»„æˆçš„ï¼Œæ¯256ä¸ªåŒºè¢«åˆ’åˆ†æˆä¸€ç»„ã€‚ç”»ä¸ªå›¾è¡¨ç¤ºå°±æ˜¯è¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f33c4a1c3a~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cri1nutcorp5ghf5c7vqagt1j.png-71.4kB"><p>å…¶ä¸­<code>extent 0</code> ~ <code>extent 255</code>è¿™256ä¸ªåŒºç®—æ˜¯ç¬¬ä¸€ä¸ªç»„ï¼Œ<code>extent 256</code> ~ <code>extent 511</code>è¿™256ä¸ªåŒºç®—æ˜¯ç¬¬äºŒä¸ªç»„ï¼Œ<code>extent 512</code> ~ <code>extent 767</code>è¿™256ä¸ªåŒºç®—æ˜¯ç¬¬ä¸‰ä¸ªç»„ï¼ˆä¸Šå›¾ä¸­å¹¶æœªç”»å…¨ç¬¬ä¸‰ä¸ªç»„å…¨éƒ¨çš„åŒºï¼Œè¯·è‡ªè¡Œè„‘è¡¥ï¼‰ï¼Œä¾æ­¤ç±»æ¨å¯ä»¥åˆ’åˆ†æ›´å¤šçš„ç»„ã€‚è¿™äº›ç»„çš„å¤´å‡ ä¸ªé¡µé¢çš„ç±»å‹éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå°±åƒè¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f33df9307a~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1crjo0hl4q8u1dkdofe187b10fa9.png-105.2kB"><p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬èƒ½å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p><ul><li><strong>ç¬¬ä¸€ä¸ªç»„æœ€å¼€å§‹çš„3ä¸ªé¡µé¢çš„ç±»å‹æ˜¯å›ºå®šçš„</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´<code>extent 0</code>è¿™ä¸ªåŒºæœ€å¼€å§‹çš„3ä¸ªé¡µé¢çš„ç±»å‹æ˜¯å›ºå®šçš„ï¼Œåˆ†åˆ«æ˜¯ï¼š<ul><li><code>FSP_HDR</code>ç±»å‹ï¼šè¿™ä¸ªç±»å‹çš„é¡µé¢æ˜¯ç”¨æ¥ç™»è®°æ•´ä¸ªè¡¨ç©ºé—´çš„ä¸€äº›æ•´ä½“å±æ€§ä»¥åŠæœ¬ç»„æ‰€æœ‰çš„<code>åŒº</code>ï¼Œä¹Ÿå°±æ˜¯<code>extent 0</code> ~ <code>extent 255</code>è¿™256ä¸ªåŒºçš„å±æ€§ï¼Œç¨åè¯¦ç»†å” å¨ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæ•´ä¸ªè¡¨ç©ºé—´åªæœ‰ä¸€ä¸ª<code>FSP_HDR</code>ç±»å‹çš„é¡µé¢ã€‚</li><li><code>IBUF_BITMAP</code>ç±»å‹ï¼šè¿™ä¸ªç±»å‹çš„é¡µé¢æ˜¯å­˜å‚¨æœ¬ç»„æ‰€æœ‰çš„åŒºçš„æ‰€æœ‰é¡µé¢å…³äº<code>INSERT BUFFER</code>çš„ä¿¡æ¯ã€‚å½“ç„¶ï¼Œä½ ç°åœ¨ä¸ç”¨çŸ¥é“å•¥æ˜¯ä¸ª<code>INSERT BUFFER</code>ï¼Œåè¾¹ä¼šè¯¦ç»†è¯´åˆ°ä½ åã€‚</li><li><code>INODE</code>ç±»å‹ï¼šè¿™ä¸ªç±»å‹çš„é¡µé¢å­˜å‚¨äº†è®¸å¤šç§°ä¸º<code>INODE</code>çš„æ•°æ®ç»“æ„ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œç°åœ¨ä½ ä¸éœ€è¦çŸ¥é“å•¥æ˜¯ä¸ª<code>INODE</code>ï¼Œåè¾¹å„¿ä¼šè¯´åˆ°ä½ åã€‚</li></ul></li><li><strong>å…¶ä½™å„ç»„æœ€å¼€å§‹çš„2ä¸ªé¡µé¢çš„ç±»å‹æ˜¯å›ºå®šçš„</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´<code>extent 256</code>ã€<code>extent 512</code>è¿™äº›åŒºæœ€å¼€å§‹çš„2ä¸ªé¡µé¢çš„ç±»å‹æ˜¯å›ºå®šçš„ï¼Œåˆ†åˆ«æ˜¯ï¼š<ul><li><code>XDES</code>ç±»å‹ï¼šå…¨ç§°æ˜¯<code>extent descriptor</code>ï¼Œç”¨æ¥ç™»è®°æœ¬ç»„256ä¸ªåŒºçš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºåœ¨<code>extent 256</code>åŒºä¸­çš„è¯¥ç±»å‹é¡µé¢å­˜å‚¨çš„å°±æ˜¯<code>extent 256</code> ~ <code>extent 511</code>è¿™äº›åŒºçš„å±æ€§ï¼Œå¯¹äºåœ¨<code>extent 512</code>åŒºä¸­çš„è¯¥ç±»å‹é¡µé¢å­˜å‚¨çš„å°±æ˜¯<code>extent 512</code> ~ <code>extent 767</code>è¿™äº›åŒºçš„å±æ€§ã€‚ä¸Šè¾¹ä»‹ç»çš„<code>FSP_HDR</code>ç±»å‹çš„é¡µé¢å…¶å®å’Œ<code>XDES</code>ç±»å‹çš„é¡µé¢çš„ä½œç”¨ç±»ä¼¼ï¼Œåªä¸è¿‡<code>FSP_HDR</code>ç±»å‹çš„é¡µé¢è¿˜ä¼šé¢å¤–å­˜å‚¨ä¸€äº›è¡¨ç©ºé—´çš„å±æ€§ã€‚</li><li><code>IBUF_BITMAP</code>ç±»å‹ï¼šä¸Šè¾¹ä»‹ç»è¿‡äº†ã€‚</li></ul></li></ul><p>å¥½äº†ï¼Œå®è§‚çš„ç»“æ„ä»‹ç»å®Œäº†ï¼Œé‡Œè¾¹å„¿çš„åè¯å¤§å®¶ä¹Ÿä¸ç”¨è®°æ¸…æ¥šï¼Œåªè¦å¤§è‡´è®°å¾—ï¼šè¡¨ç©ºé—´è¢«åˆ’åˆ†ä¸ºè®¸å¤šè¿ç»­çš„<code>åŒº</code>ï¼Œæ¯ä¸ªåŒºé»˜è®¤ç”±64ä¸ªé¡µç»„æˆï¼Œæ¯256ä¸ªåŒºåˆ’åˆ†ä¸ºä¸€ç»„ï¼Œæ¯ä¸ªç»„çš„æœ€å¼€å§‹çš„å‡ ä¸ªé¡µé¢ç±»å‹æ˜¯å›ºå®šçš„å°±å¥½äº†ã€‚</p><h3 id="æ®µï¼ˆsegmentï¼‰çš„æ¦‚å¿µ">æ®µï¼ˆsegmentï¼‰çš„æ¦‚å¿µ</h3><p>ä¸ºå•¥å¥½ç«¯ç«¯çš„æå‡ºä¸€ä¸ª<code>åŒº</code>ï¼ˆ<code>extent</code>ï¼‰çš„æ¦‚å¿µå‘¢ï¼Ÿæˆ‘ä»¬ä»¥å‰åˆ†æé—®é¢˜çš„å¥—è·¯éƒ½æ˜¯è¿™æ ·çš„ï¼šè¡¨ä¸­çš„è®°å½•å­˜å‚¨åˆ°é¡µé‡Œè¾¹å„¿ï¼Œç„¶åé¡µä½œä¸ºèŠ‚ç‚¹ç»„æˆ<code>B+</code>æ ‘ï¼Œè¿™ä¸ª<code>B+</code>æ ‘å°±æ˜¯ç´¢å¼•ï¼Œç„¶åå§å•¦å§å•¦ä¸€å †èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•çš„åŒºåˆ«ã€‚è¿™å¥—è·¯ä¹Ÿæ²¡å•¥ä¸å¦¥çš„å‘€ï½</p><p>æ˜¯çš„ï¼Œå¦‚æœæˆ‘ä»¬è¡¨ä¸­æ•°æ®é‡å¾ˆå°‘çš„è¯ï¼Œæ¯”å¦‚è¯´ä½ çš„è¡¨ä¸­åªæœ‰å‡ åæ¡ã€å‡ ç™¾æ¡æ•°æ®çš„è¯ï¼Œçš„ç¡®ç”¨ä¸åˆ°<code>åŒº</code>çš„æ¦‚å¿µï¼Œå› ä¸ºç®€å•çš„å‡ ä¸ªé¡µå°±èƒ½æŠŠå¯¹åº”çš„æ•°æ®å­˜å‚¨èµ·æ¥ï¼Œä½†æ˜¯ä½ æ¶ä¸ä½è¡¨é‡Œçš„è®°å½•è¶Šæ¥è¶Šå¤šå‘€ã€‚</p><p>ï¼Ÿï¼Ÿå•¥ï¼Ÿï¼Ÿè¡¨é‡Œçš„è®°å½•å¤šäº†åˆæ€æ ·ï¼Ÿ<code>B+</code>æ ‘çš„æ¯ä¸€å±‚ä¸­çš„é¡µéƒ½ä¼šå½¢æˆä¸€ä¸ªåŒå‘é“¾è¡¨å‘€ï¼Œ<code>File Header</code>ä¸­çš„<code>FIL_PAGE_PREV</code>å’Œ<code>FIL_PAGE_NEXT</code>å­—æ®µä¸å°±æ˜¯ä¸ºäº†å½¢æˆåŒå‘é“¾è¡¨è®¾ç½®çš„ä¹ˆï¼Ÿ</p><p>æ˜¯çš„æ˜¯çš„ï¼Œæ‚¨è¯´çš„éƒ½å¯¹ï¼Œä»ç†è®ºä¸Šè¯´ï¼Œä¸å¼•å…¥<code>åŒº</code>çš„æ¦‚å¿µåªä½¿ç”¨<code>é¡µ</code>çš„æ¦‚å¿µå¯¹å­˜å‚¨å¼•æ“çš„è¿è¡Œå¹¶æ²¡å•¥å½±å“ï¼Œä½†æ˜¯æˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸‹ä¸‹è¾¹è¿™ä¸ªåœºæ™¯ï¼š</p><ul><li>æˆ‘ä»¬æ¯å‘è¡¨ä¸­**æ’å…¥ä¸€æ¡è®°å½•ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å‘è¯¥è¡¨çš„èšç°‡ç´¢å¼•ä»¥åŠæ‰€æœ‰äºŒçº§ç´¢å¼•ä»£è¡¨çš„<code>B+</code>æ ‘çš„èŠ‚ç‚¹ä¸­æ’å…¥æ•°æ®ã€‚**è€Œ<code>B+</code>æ ‘çš„æ¯ä¸€å±‚ä¸­çš„é¡µéƒ½ä¼šå½¢æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¦‚æœæ˜¯ä»¥<code>é¡µ</code>ä¸ºå•ä½æ¥åˆ†é…å­˜å‚¨ç©ºé—´çš„è¯ï¼ŒåŒå‘é“¾è¡¨ç›¸é‚»çš„ä¸¤ä¸ªé¡µä¹‹é—´çš„ç‰©ç†ä½ç½®å¯èƒ½ç¦»å¾—éå¸¸è¿œã€‚æˆ‘ä»¬ä»‹ç»<code>B+</code>æ ‘ç´¢å¼•çš„é€‚ç”¨åœºæ™¯çš„æ—¶å€™ç‰¹åˆ«æåˆ°èŒƒå›´æŸ¥è¯¢åªéœ€è¦å®šä½åˆ°æœ€å·¦è¾¹çš„è®°å½•å’Œæœ€å³è¾¹çš„è®°å½•ï¼Œç„¶åæ²¿ç€åŒå‘é“¾è¡¨ä¸€ç›´æ‰«æå°±å¯ä»¥äº†ï¼Œè€Œå¦‚æœé“¾è¡¨ä¸­ç›¸é‚»çš„ä¸¤ä¸ªé¡µç‰©ç†ä½ç½®ç¦»å¾—éå¸¸è¿œï¼Œå°±æ˜¯æ‰€è°“çš„<code>éšæœºI/O</code>ã€‚å†ä¸€æ¬¡å¼ºè°ƒï¼Œç£ç›˜çš„é€Ÿåº¦å’Œå†…å­˜çš„é€Ÿåº¦å·®äº†å¥½å‡ ä¸ªæ•°é‡çº§ï¼Œ<code>éšæœºI/O</code>æ˜¯éå¸¸æ…¢çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½é‡è®©é“¾è¡¨ä¸­ç›¸é‚»çš„é¡µçš„ç‰©ç†ä½ç½®ä¹Ÿç›¸é‚»ï¼Œè¿™æ ·è¿›è¡ŒèŒƒå›´æŸ¥è¯¢çš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨æ‰€è°“çš„<code>é¡ºåºI/O</code>ã€‚</li></ul><p>æ‰€ä»¥ï¼Œæ‰€ä»¥ï¼Œæ‰€ä»¥æ‰å¼•å…¥äº†<code>åŒº</code>ï¼ˆ<code>extent</code>ï¼‰çš„æ¦‚å¿µï¼Œä¸€ä¸ªåŒºå°±æ˜¯åœ¨ç‰©ç†ä½ç½®ä¸Šè¿ç»­çš„64ä¸ªé¡µã€‚åœ¨è¡¨ä¸­æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œä¸ºæŸä¸ªç´¢å¼•åˆ†é…ç©ºé—´çš„æ—¶å€™å°±ä¸å†æŒ‰ç…§é¡µä¸ºå•ä½åˆ†é…äº†ï¼Œè€Œæ˜¯æŒ‰ç…§<code>åŒº</code>ä¸ºå•ä½åˆ†é…ï¼Œç”šè‡³åœ¨è¡¨ä¸­çš„æ•°æ®ååˆ†éå¸¸ç‰¹åˆ«å¤šçš„æ—¶å€™ï¼Œå¯ä»¥ä¸€æ¬¡æ€§åˆ†é…å¤šä¸ªè¿ç»­çš„åŒºã€‚è™½ç„¶å¯èƒ½é€ æˆä¸€ç‚¹ç‚¹ç©ºé—´çš„æµªè´¹ï¼ˆæ•°æ®ä¸è¶³å¡«å……æ»¡æ•´ä¸ªåŒºï¼‰ï¼Œä½†æ˜¯ä»æ€§èƒ½è§’åº¦çœ‹ï¼Œå¯ä»¥æ¶ˆé™¤å¾ˆå¤šçš„éšæœº<code>I/O</code>ï¼ŒåŠŸå¤§äºè¿‡å˜›ï¼</p><p>äº‹æƒ…åˆ°è¿™é‡Œå°±ç»“æŸäº†ä¹ˆï¼Ÿå¤ªå¤©çœŸäº†ï¼Œæˆ‘ä»¬æåˆ°çš„èŒƒå›´æŸ¥è¯¢ï¼Œå…¶å®æ˜¯å¯¹<code>B+</code>æ ‘å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•è¿›è¡Œé¡ºåºæ‰«æï¼Œè€Œå¦‚æœä¸åŒºåˆ†å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹ï¼Œç»Ÿç»ŸæŠŠèŠ‚ç‚¹ä»£è¡¨çš„é¡µé¢æ”¾åˆ°ç”³è¯·åˆ°çš„åŒºä¸­çš„è¯ï¼Œè¿›è¡ŒèŒƒå›´æ‰«æçš„æ•ˆæœå°±å¤§æ‰“æŠ˜æ‰£äº†ã€‚æ‰€ä»¥è®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬å¯¹<code>B+</code>æ ‘çš„å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹è¿›è¡Œäº†åŒºåˆ«å¯¹å¾…ï¼Œä¹Ÿå°±æ˜¯è¯´å¶å­èŠ‚ç‚¹æœ‰è‡ªå·±ç‹¬æœ‰çš„<code>åŒº</code>ï¼Œéå¶å­èŠ‚ç‚¹ä¹Ÿæœ‰è‡ªå·±ç‹¬æœ‰çš„<code>åŒº</code>ã€‚<strong>å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆå°±ç®—æ˜¯ä¸€ä¸ª<code>æ®µ</code>ï¼ˆ<code>segment</code>ï¼‰ï¼Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆä¹Ÿç®—æ˜¯ä¸€ä¸ª<code>æ®µ</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç´¢å¼•ä¼šç”Ÿæˆ2ä¸ªæ®µï¼Œä¸€ä¸ªå¶å­èŠ‚ç‚¹æ®µï¼Œä¸€ä¸ªéå¶å­èŠ‚ç‚¹æ®µã€‚</strong></p><p>é»˜è®¤æƒ…å†µä¸‹<strong>ä¸€ä¸ªä½¿ç”¨<code>InnoDB</code>å­˜å‚¨å¼•æ“çš„è¡¨åªæœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œä¸€ä¸ªç´¢å¼•ä¼šç”Ÿæˆ2ä¸ªæ®µ</strong>ï¼Œè€Œæ®µæ˜¯ä»¥åŒºä¸ºå•ä½ç”³è¯·å­˜å‚¨ç©ºé—´çš„ï¼Œä¸€ä¸ªåŒºé»˜è®¤å ç”¨1Må­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªåªå­˜äº†å‡ æ¡è®°å½•çš„å°è¡¨ä¹Ÿéœ€è¦2Mçš„å­˜å‚¨ç©ºé—´ä¹ˆï¼Ÿä»¥åæ¯æ¬¡æ·»åŠ ä¸€ä¸ªç´¢å¼•éƒ½è¦å¤šç”³è¯·2Mçš„å­˜å‚¨ç©ºé—´ä¹ˆï¼Ÿè¿™å¯¹äºå­˜å‚¨è®°å½•æ¯”è¾ƒå°‘çš„è¡¨ç®€ç›´æ˜¯å¤©å¤§çš„æµªè´¹ã€‚è®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬éƒ½æŒºèŠ‚ä¿­çš„ï¼Œå½“ç„¶ä¹Ÿè€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µã€‚è¿™ä¸ªé—®é¢˜çš„ç—‡ç»“åœ¨äºåˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬ä»‹ç»çš„åŒºéƒ½æ˜¯éå¸¸<code>çº¯ç²¹</code>çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåŒºè¢«æ•´ä¸ªåˆ†é…ç»™æŸä¸€ä¸ªæ®µï¼Œæˆ–è€…è¯´åŒºä¸­çš„æ‰€æœ‰é¡µé¢éƒ½æ˜¯ä¸ºäº†å­˜å‚¨åŒä¸€ä¸ªæ®µçš„æ•°æ®è€Œå­˜åœ¨çš„ï¼Œå³ä½¿æ®µçš„æ•°æ®å¡«ä¸æ»¡åŒºä¸­æ‰€æœ‰çš„é¡µé¢ï¼Œé‚£ä½™ä¸‹çš„é¡µé¢ä¹Ÿä¸èƒ½æŒªä½œä»–ç”¨ã€‚**ç°åœ¨ä¸ºäº†è€ƒè™‘ä»¥å®Œæ•´çš„åŒºä¸ºå•ä½åˆ†é…ç»™æŸä¸ªæ®µå¯¹äºæ•°æ®é‡è¾ƒå°çš„è¡¨å¤ªæµªè´¹å­˜å‚¨ç©ºé—´çš„è¿™ç§æƒ…å†µï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬æå‡ºäº†ä¸€ä¸ªç¢ç‰‡ï¼ˆfragmentï¼‰åŒºçš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ªç¢ç‰‡åŒºä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„é¡µéƒ½æ˜¯ä¸ºäº†å­˜å‚¨åŒä¸€ä¸ªæ®µçš„æ•°æ®è€Œå­˜åœ¨çš„ï¼Œè€Œæ˜¯ç¢ç‰‡åŒºä¸­çš„é¡µå¯ä»¥ç”¨äºä¸åŒçš„ç›®çš„ï¼Œæ¯”å¦‚æœ‰äº›é¡µç”¨äºæ®µAï¼Œæœ‰äº›é¡µç”¨äºæ®µBï¼Œæœ‰äº›é¡µç”šè‡³å“ªä¸ªæ®µéƒ½ä¸å±äºã€‚**ç¢ç‰‡åŒºç›´å±äºè¡¨ç©ºé—´ï¼Œå¹¶ä¸å±äºä»»ä½•ä¸€ä¸ªæ®µã€‚æ‰€ä»¥æ­¤åä¸ºæŸä¸ªæ®µåˆ†é…å­˜å‚¨ç©ºé—´çš„ç­–ç•¥æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>åœ¨åˆšå¼€å§‹å‘è¡¨ä¸­æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæ®µæ˜¯ä»æŸä¸ªç¢ç‰‡åŒºä»¥å•ä¸ªé¡µé¢ä¸ºå•ä½æ¥åˆ†é…å­˜å‚¨ç©ºé—´çš„ã€‚</li><li>å½“æŸä¸ªæ®µå·²ç»å ç”¨äº†32ä¸ªç¢ç‰‡åŒºé¡µé¢ä¹‹åï¼Œå°±ä¼šä»¥å®Œæ•´çš„åŒºä¸ºå•ä½æ¥åˆ†é…å­˜å‚¨ç©ºé—´ã€‚</li></ul><p>æ‰€ä»¥ç°åœ¨æ®µä¸èƒ½ä»…å®šä¹‰ä¸ºæ˜¯æŸäº›åŒºçš„é›†åˆï¼Œæ›´ç²¾ç¡®çš„åº”è¯¥æ˜¯æŸäº›é›¶æ•£çš„é¡µé¢ä»¥åŠä¸€äº›å®Œæ•´çš„åŒºçš„é›†åˆã€‚é™¤äº†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ®µå’Œéå¶å­èŠ‚ç‚¹æ®µä¹‹å¤–ï¼Œ<code>InnoDB</code>ä¸­è¿˜æœ‰ä¸ºå­˜å‚¨ä¸€äº›ç‰¹æ®Šçš„æ•°æ®è€Œå®šä¹‰çš„æ®µï¼Œæ¯”å¦‚å›æ»šæ®µï¼Œå½“ç„¶æˆ‘ä»¬ç°åœ¨å¹¶ä¸å…³å¿ƒåˆ«çš„ç±»å‹çš„æ®µï¼Œç°åœ¨åªéœ€è¦çŸ¥é“æ®µæ˜¯ä¸€äº›é›¶æ•£çš„é¡µé¢ä»¥åŠä¸€äº›å®Œæ•´çš„åŒºçš„é›†åˆå°±å¥½äº†ã€‚</p><h3 id="åŒºçš„åˆ†ç±»">åŒºçš„åˆ†ç±»</h3><p>é€šè¿‡ä¸Šè¾¹ä¸€é€šå” å¨ï¼Œå¤§å®¶çŸ¥é“äº†è¡¨ç©ºé—´çš„æ˜¯ç”±è‹¥å¹²ä¸ªåŒºç»„æˆçš„ï¼Œè¿™äº›åŒºå¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸º4ç§ç±»å‹ï¼š</p><ul><li>ç©ºé—²çš„åŒºï¼šç°åœ¨è¿˜æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªåŒºä¸­çš„ä»»ä½•é¡µé¢ã€‚</li><li>æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒºï¼šè¡¨ç¤ºç¢ç‰‡åŒºä¸­è¿˜æœ‰å¯ç”¨çš„é¡µé¢ã€‚</li><li>æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒºï¼šè¡¨ç¤ºç¢ç‰‡åŒºä¸­çš„æ‰€æœ‰é¡µé¢éƒ½è¢«ä½¿ç”¨ï¼Œæ²¡æœ‰ç©ºé—²é¡µé¢ã€‚</li><li>é™„å±äºæŸä¸ªæ®µçš„åŒºã€‚æ¯ä¸€ä¸ªç´¢å¼•éƒ½å¯ä»¥åˆ†ä¸ºå¶å­èŠ‚ç‚¹æ®µå’Œéå¶å­èŠ‚ç‚¹æ®µï¼Œé™¤æ­¤ä¹‹å¤–InnoDBè¿˜ä¼šå¦å¤–å®šä¹‰ä¸€äº›ç‰¹æ®Šä½œç”¨çš„æ®µï¼Œåœ¨è¿™äº›æ®µä¸­çš„æ•°æ®é‡å¾ˆå¤§æ—¶å°†ä½¿ç”¨åŒºæ¥ä½œä¸ºåŸºæœ¬çš„åˆ†é…å•ä½ã€‚</li></ul><p>è¿™4ç§ç±»å‹çš„åŒºä¹Ÿå¯ä»¥è¢«ç§°ä¸ºåŒºçš„4ç§çŠ¶æ€ï¼ˆ<code>State</code>ï¼‰ï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬ä¸ºè¿™4ç§çŠ¶æ€çš„åŒºå®šä¹‰äº†ç‰¹å®šçš„åè¯å„¿ï¼š</p><table><thead><tr><th>çŠ¶æ€å</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>FREE</code></td><td>ç©ºé—²çš„åŒº</td></tr><tr><td><code>FREE_FRAG</code></td><td>æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº</td></tr><tr><td><code>FULL_FRAG</code></td><td>æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº</td></tr><tr><td><code>FSEG</code></td><td>é™„å±äºæŸä¸ªæ®µçš„åŒº</td></tr></tbody></table><p>éœ€è¦å†æ¬¡å¼ºè°ƒä¸€éçš„æ˜¯ï¼Œå¤„äº<code>FREE</code>ã€<code>FREE_FRAG</code>ä»¥åŠ<code>FULL_FRAG</code>è¿™ä¸‰ç§çŠ¶æ€çš„åŒºéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œç®—æ˜¯ç›´å±äºè¡¨ç©ºé—´ï¼›è€Œå¤„äº<code>FSEG</code>çŠ¶æ€çš„åŒºæ˜¯é™„å±äºæŸä¸ªæ®µçš„ã€‚</p><blockquote><p>å°è´´å£«ï¼š å¦‚æœæŠŠè¡¨ç©ºé—´æ¯”ä½œæ˜¯ä¸€ä¸ªé›†å›¢å†›ï¼Œæ®µå°±ç›¸å½“äºå¸ˆï¼ŒåŒºå°±ç›¸å½“äºå›¢ã€‚ä¸€èˆ¬çš„å›¢éƒ½æ˜¯éš¶å±äºæŸä¸ªå¸ˆçš„ï¼Œå°±åƒæ˜¯å¤„äº<code>FSEG</code>çš„åŒºå…¨éƒ½éš¶å±äºæŸä¸ªæ®µï¼Œè€Œå¤„äº<code>FREE</code>ã€<code>FREE_FRAG</code>ä»¥åŠ<code>FULL_FRAG</code>è¿™ä¸‰ç§çŠ¶æ€çš„åŒºå´ç›´æ¥éš¶å±äºè¡¨ç©ºé—´ï¼Œå°±åƒç‹¬ç«‹å›¢ç›´æ¥å¬å‘½äºå†›éƒ¨ä¸€æ ·ã€‚</p></blockquote><p>ä¸ºäº†æ–¹ä¾¿ç®¡ç†è¿™äº›åŒºï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”è®¾è®¡äº†ä¸€ä¸ªç§°ä¸º<code>XDES Entry</code>çš„ç»“æ„ï¼ˆå…¨ç§°å°±æ˜¯Extent Descriptor Entryï¼‰ï¼Œæ¯ä¸€ä¸ªåŒºéƒ½å¯¹åº”ç€ä¸€ä¸ª<code>XDES Entry</code>ç»“æ„ï¼Œè¿™ä¸ªç»“æ„è®°å½•äº†å¯¹åº”çš„åŒºçš„ä¸€äº›å±æ€§ã€‚æˆ‘ä»¬å…ˆçœ‹å›¾æ¥å¯¹è¿™ä¸ªç»“æ„æœ‰ä¸ªå¤§è‡´çš„äº†è§£ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f343654829~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1crre79uq9971bsdj9s1i0j11en8a.png-96.2kB"><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<code>XDES Entry</code>æ˜¯ä¸€ä¸ª40ä¸ªå­—èŠ‚çš„ç»“æ„ï¼Œå¤§è‡´åˆ†ä¸º4ä¸ªéƒ¨åˆ†ï¼Œå„ä¸ªéƒ¨åˆ†çš„é‡Šä¹‰å¦‚ä¸‹ï¼š</p><ul><li><p><code>Segment ID</code>ï¼ˆ8å­—èŠ‚ï¼‰</p><p>æ¯ä¸€ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ï¼Œç”¨IDè¡¨ç¤ºï¼Œæ­¤å¤„çš„<code>Segment ID</code>å­—æ®µè¡¨ç¤ºå°±æ˜¯è¯¥åŒºæ‰€åœ¨çš„æ®µã€‚å½“ç„¶å‰ææ˜¯è¯¥åŒºå·²ç»è¢«åˆ†é…ç»™æŸä¸ªæ®µäº†ï¼Œä¸ç„¶çš„è¯è¯¥å­—æ®µçš„å€¼æ²¡å•¥æ„ä¹‰ã€‚</p></li><li><p><code>List Node</code>ï¼ˆ12å­—èŠ‚ï¼‰</p><p>è¿™ä¸ªéƒ¨åˆ†å¯ä»¥å°†è‹¥å¹²ä¸ª<code>XDES Entry</code>ç»“æ„ä¸²è”æˆä¸€ä¸ªé“¾è¡¨ï¼Œå¤§å®¶çœ‹ä¸€ä¸‹è¿™ä¸ª<code>List Node</code>çš„ç»“æ„ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f3444b1515~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1crre8tlh1vmqtfipk663l173q97.png-69.1kB"><p>å¦‚æœæˆ‘ä»¬æƒ³å®šä½è¡¨ç©ºé—´å†…çš„æŸä¸€ä¸ªä½ç½®çš„è¯ï¼Œåªéœ€æŒ‡å®šé¡µå·ä»¥åŠè¯¥ä½ç½®åœ¨æŒ‡å®šé¡µå·ä¸­çš„é¡µå†…åç§»é‡å³å¯ã€‚æ‰€ä»¥ï¼š</p><ul><li><code>Pre Node Page Number</code>å’Œ<code>Pre Node Offset</code>çš„ç»„åˆå°±æ˜¯æŒ‡å‘å‰ä¸€ä¸ª<code>XDES Entry</code>çš„æŒ‡é’ˆ</li><li><code>Next Node Page Number</code>å’Œ<code>Next Node Offset</code>çš„ç»„åˆå°±æ˜¯æŒ‡å‘åä¸€ä¸ª<code>XDES Entry</code>çš„æŒ‡é’ˆã€‚</li></ul><p>æŠŠä¸€äº›<code>XDES Entry</code>ç»“æ„è¿æˆä¸€ä¸ªé“¾è¡¨æœ‰å•¥ç”¨ï¼Ÿç¨å®‰å‹¿èºï¼Œæˆ‘ä»¬ç¨åå” å¨<code>XDES Entry</code>ç»“æ„ç»„æˆçš„é“¾è¡¨é—®é¢˜ã€‚</p></li><li><p><code>State</code>ï¼ˆ4å­—èŠ‚ï¼‰</p><p>è¿™ä¸ªå­—æ®µè¡¨æ˜åŒºçš„çŠ¶æ€ã€‚å¯é€‰çš„å€¼å°±æ˜¯æˆ‘ä»¬å‰è¾¹è¯´è¿‡çš„é‚£4ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼š<code>FREE</code>ã€<code>FREE_FRAG</code>ã€<code>FULL_FRAG</code>å’Œ<code>FSEG</code>ã€‚å…·ä½“é‡Šä¹‰å°±ä¸å¤šå” å¨äº†ï¼Œå‰è¾¹è¯´çš„å¤Ÿä»”ç»†äº†ã€‚</p></li><li><p><code>Page State Bitmap</code>ï¼ˆ16å­—èŠ‚ï¼‰</p><p>è¿™ä¸ªéƒ¨åˆ†å…±å ç”¨16ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯128ä¸ªæ¯”ç‰¹ä½ã€‚æˆ‘ä»¬è¯´ä¸€ä¸ªåŒºé»˜è®¤æœ‰64ä¸ªé¡µï¼Œè¿™128ä¸ªæ¯”ç‰¹ä½è¢«åˆ’åˆ†ä¸º64ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†2ä¸ªæ¯”ç‰¹ä½ï¼Œå¯¹åº”åŒºä¸­çš„ä¸€ä¸ªé¡µã€‚æ¯”å¦‚<code>Page State Bitmap</code>éƒ¨åˆ†çš„ç¬¬1å’Œç¬¬2ä¸ªæ¯”ç‰¹ä½å¯¹åº”ç€åŒºä¸­çš„ç¬¬1ä¸ªé¡µé¢ï¼Œç¬¬3å’Œç¬¬4ä¸ªæ¯”ç‰¹ä½å¯¹åº”ç€åŒºä¸­çš„ç¬¬2ä¸ªé¡µé¢ï¼Œä¾æ­¤ç±»æ¨ï¼Œ<code>Page State Bitmap</code>éƒ¨åˆ†çš„ç¬¬127å’Œ128ä¸ªæ¯”ç‰¹ä½å¯¹åº”ç€åŒºä¸­çš„ç¬¬64ä¸ªé¡µé¢ã€‚è¿™ä¸¤ä¸ªæ¯”ç‰¹ä½çš„ç¬¬ä¸€ä¸ªä½è¡¨ç¤ºå¯¹åº”çš„é¡µæ˜¯å¦æ˜¯ç©ºé—²çš„ï¼Œç¬¬äºŒä¸ªæ¯”ç‰¹ä½è¿˜æ²¡æœ‰ç”¨ã€‚</p></li></ul><h4 id="XDES-Entryé“¾è¡¨">XDES Entryé“¾è¡¨</h4><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æå‡ºäº†äº”èŠ±å…«é—¨çš„æ¦‚å¿µï¼Œä»€ä¹ˆåŒºã€æ®µã€ç¢ç‰‡åŒºã€é™„å±äºæ®µçš„åŒºã€<code>XDES Entry</code>ç»“æ„å§å•¦å§å•¦çš„æ¦‚å¿µï¼Œèµ°è¿œäº†åƒä¸‡åˆ«å¿˜äº†è‡ªå·±ä¸ºä»€ä¹ˆå‡ºå‘ï¼Œæˆ‘ä»¬æŠŠäº‹æƒ…æè¿™ä¹ˆéº»çƒ¦çš„åˆå¿ƒä»…ä»…æ˜¯æƒ³**æé«˜å‘è¡¨æ’å…¥æ•°æ®çš„æ•ˆç‡åˆä¸è‡³äºæ•°æ®é‡å°‘çš„è¡¨æµªè´¹ç©ºé—´ã€‚**ç°åœ¨æˆ‘ä»¬çŸ¥é“å‘è¡¨ä¸­æ’å…¥æ•°æ®æœ¬è´¨ä¸Šå°±æ˜¯å‘è¡¨ä¸­å„ä¸ªç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ®µã€éå¶å­èŠ‚ç‚¹æ®µæ’å…¥æ•°æ®ï¼Œä¹ŸçŸ¥é“äº†ä¸åŒçš„åŒºæœ‰ä¸åŒçš„çŠ¶æ€ï¼Œå†å›åˆ°æœ€åˆçš„èµ·ç‚¹ï¼Œæ‹ä¸€æ‹å‘æŸä¸ªæ®µä¸­æ’å…¥æ•°æ®çš„è¿‡ç¨‹ï¼š</p><ul><li><p>å½“æ®µä¸­æ•°æ®è¾ƒå°‘çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šæŸ¥çœ‹è¡¨ç©ºé—´ä¸­æ˜¯å¦æœ‰çŠ¶æ€ä¸º<code>FREE_FRAG</code>çš„åŒºï¼Œä¹Ÿå°±æ˜¯æ‰¾è¿˜æœ‰ç©ºé—²ç©ºé—´çš„ç¢ç‰‡åŒºï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œé‚£ä¹ˆä»è¯¥åŒºä¸­å–ä¸€äº›é›¶æ•£çš„é¡µæŠŠæ•°æ®æ’è¿›å»ï¼›å¦åˆ™åˆ°è¡¨ç©ºé—´ä¸‹ç”³è¯·ä¸€ä¸ªçŠ¶æ€ä¸º<code>FREE</code>çš„åŒºï¼Œä¹Ÿå°±æ˜¯ç©ºé—²çš„åŒºï¼ŒæŠŠè¯¥åŒºçš„çŠ¶æ€å˜ä¸º<code>FREE_FRAG</code>ï¼Œç„¶åä»è¯¥æ–°ç”³è¯·çš„åŒºä¸­å–ä¸€äº›é›¶æ•£çš„é¡µæŠŠæ•°æ®æ’è¿›å»ã€‚ä¹‹åä¸åŒçš„æ®µä½¿ç”¨é›¶æ•£é¡µçš„æ—¶å€™éƒ½ä¼šä»è¯¥åŒºä¸­å–ï¼Œç›´åˆ°è¯¥åŒºä¸­æ²¡æœ‰ç©ºé—²ç©ºé—´ï¼Œç„¶åè¯¥åŒºçš„çŠ¶æ€å°±å˜æˆäº†<code>FULL_FRAG</code>ã€‚</p><p>ç°åœ¨çš„é—®é¢˜æ˜¯ä½ æ€ä¹ˆçŸ¥é“è¡¨ç©ºé—´é‡Œçš„å“ªäº›åŒºæ˜¯<code>FREE</code>çš„ï¼Œå“ªäº›åŒºçš„çŠ¶æ€æ˜¯<code>FREE_FRAG</code>çš„ï¼Œå“ªäº›åŒºæ˜¯<code>FULL_FRAG</code>çš„ï¼Ÿè¦çŸ¥é“è¡¨ç©ºé—´çš„å¤§å°æ˜¯å¯ä»¥ä¸æ–­å¢å¤§çš„ï¼Œå½“å¢é•¿åˆ°GBçº§åˆ«çš„æ—¶å€™ï¼ŒåŒºçš„æ•°é‡ä¹Ÿå°±ä¸Šåƒäº†ï¼Œæˆ‘ä»¬æ€»ä¸èƒ½æ¯æ¬¡éƒ½éå†è¿™äº›åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„å§ï¼Ÿè¿™æ—¶å€™å°±æ˜¯<code>XDES Entry</code>ä¸­çš„<code>List Node</code>éƒ¨åˆ†å‘æŒ¥å¥‡æ•ˆçš„æ—¶å€™äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>List Node</code>ä¸­çš„æŒ‡é’ˆï¼Œåšè¿™ä¹ˆä¸‰ä»¶äº‹ï¼š</p><ul><li>æŠŠçŠ¶æ€ä¸º<code>FREE</code>çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„é€šè¿‡<code>List Node</code>æ¥è¿æ¥æˆä¸€ä¸ªé“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨æˆ‘ä»¬å°±ç§°ä¹‹ä¸º<code>FREE</code>é“¾è¡¨ã€‚</li><li>æŠŠçŠ¶æ€ä¸º<code>FREE_FRAG</code>çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„é€šè¿‡<code>List Node</code>æ¥è¿æ¥æˆä¸€ä¸ªé“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨æˆ‘ä»¬å°±ç§°ä¹‹ä¸º<code>FREE_FRAG</code>é“¾è¡¨ã€‚</li><li>æŠŠçŠ¶æ€ä¸º<code>FULL_FRAG</code>çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„é€šè¿‡<code>List Node</code>æ¥è¿æ¥æˆä¸€ä¸ªé“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨æˆ‘ä»¬å°±ç§°ä¹‹ä¸º<code>FULL_FRAG</code>é“¾è¡¨ã€‚</li></ul><p>è¿™æ ·æ¯å½“æˆ‘ä»¬æƒ³æ‰¾ä¸€ä¸ª<code>FREE_FRAG</code>çŠ¶æ€çš„åŒºæ—¶ï¼Œå°±ç›´æ¥æŠŠ<code>FREE_FRAG</code>é“¾è¡¨çš„å¤´èŠ‚ç‚¹æ‹¿å‡ºæ¥ï¼Œä»è¿™ä¸ªèŠ‚ç‚¹ä¸­å–ä¸€äº›é›¶æ•£çš„é¡µæ¥æ’å…¥æ•°æ®ï¼Œå½“è¿™ä¸ªèŠ‚ç‚¹å¯¹åº”çš„åŒºç”¨å®Œæ—¶ï¼Œå°±ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªèŠ‚ç‚¹çš„<code>State</code>å­—æ®µçš„å€¼ï¼Œç„¶åä»<code>FREE_FRAG</code>é“¾è¡¨ä¸­ç§»åˆ°<code>FULL_FRAG</code>é“¾è¡¨ä¸­ã€‚åŒç†ï¼Œå¦‚æœ<code>FREE_FRAG</code>é“¾è¡¨ä¸­ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ²¡æœ‰ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä»<code>FREE</code>é“¾è¡¨ä¸­å–ä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨åˆ°<code>FREE_FRAG</code>é“¾è¡¨çš„çŠ¶æ€ï¼Œå¹¶ä¿®æ”¹è¯¥èŠ‚ç‚¹çš„<code>STATE</code>å­—æ®µå€¼ä¸º<code>FREE_FRAG</code>ï¼Œç„¶åä»è¿™ä¸ªèŠ‚ç‚¹å¯¹åº”çš„åŒºä¸­è·å–é›¶æ•£çš„é¡µå°±å¥½äº†ã€‚</p></li><li><p>å½“æ®µä¸­æ•°æ®å·²ç»å æ»¡äº†32ä¸ªé›¶æ•£çš„é¡µåï¼Œå°±ç›´æ¥ç”³è¯·å®Œæ•´çš„åŒºæ¥æ’å…¥æ•°æ®äº†ã€‚</p><p>è¿˜æ˜¯é‚£ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ€ä¹ˆçŸ¥é“å“ªäº›åŒºå±äºå“ªä¸ªæ®µçš„å‘¢ï¼Ÿå†éå†å„ä¸ª<code>XDES Entry</code>ç»“æ„ï¼Ÿéå†æ˜¯ä¸å¯èƒ½éå†çš„ï¼Œè¿™è¾ˆå­éƒ½ä¸å¯èƒ½éå†çš„ï¼Œæœ‰é“¾è¡¨è¿˜éå†ä¸ªæ¯›çº¿å•Šã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠçŠ¶æ€ä¸º<code>FSEG</code>çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„éƒ½åŠ å…¥åˆ°ä¸€ä¸ªé“¾è¡¨å–½ï¼Ÿå‚»å‘€ï¼Œä¸åŒçš„æ®µå“ªèƒ½å…±ç”¨ä¸€ä¸ªåŒºå‘¢ï¼Ÿä½ æƒ³æŠŠç´¢å¼•açš„å¶å­èŠ‚ç‚¹æ®µå’Œç´¢å¼•bçš„å¶å­èŠ‚ç‚¹æ®µéƒ½å­˜å‚¨åˆ°ä¸€ä¸ªåŒºä¸­ä¹ˆï¼Ÿæ˜¾ç„¶æˆ‘ä»¬æƒ³è¦æ¯ä¸ªæ®µéƒ½æœ‰å®ƒç‹¬ç«‹çš„é“¾è¡¨ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®æ®µå·ï¼ˆä¹Ÿå°±æ˜¯<code>Segment ID</code>ï¼‰æ¥å»ºç«‹é“¾è¡¨ï¼Œæœ‰å¤šå°‘ä¸ªæ®µå°±å»ºå¤šå°‘ä¸ªé“¾è¡¨ï¼Ÿå¥½åƒä¹Ÿæœ‰ç‚¹é—®é¢˜ï¼Œå› ä¸ºä¸€ä¸ªæ®µä¸­å¯ä»¥æœ‰å¥½å¤šä¸ªåŒºï¼Œæœ‰çš„åŒºæ˜¯å®Œå…¨ç©ºé—²çš„ï¼Œæœ‰çš„åŒºè¿˜æœ‰ä¸€äº›é¡µé¢å¯ä»¥ç”¨ï¼Œæœ‰çš„åŒºå·²ç»æ²¡æœ‰ç©ºé—²é¡µé¢å¯ä»¥ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰å¿…è¦ç»§ç»­ç»†åˆ†ï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬ä¸ºæ¯ä¸ªæ®µä¸­çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„å»ºç«‹äº†ä¸‰ä¸ªé“¾è¡¨ï¼š</p><ul><li><code>FREE</code>é“¾è¡¨ï¼šåŒä¸€ä¸ªæ®µä¸­ï¼Œæ‰€æœ‰é¡µé¢éƒ½æ˜¯ç©ºé—²çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„ä¼šè¢«åŠ å…¥åˆ°è¿™ä¸ªé“¾è¡¨ã€‚æ³¨æ„å’Œç›´å±äºè¡¨ç©ºé—´çš„<code>FREE</code>é“¾è¡¨åŒºåˆ«å¼€äº†ï¼Œæ­¤å¤„çš„<code>FREE</code>é“¾è¡¨æ˜¯é™„å±äºæŸä¸ªæ®µçš„ã€‚</li><li><code>NOT_FULL</code>é“¾è¡¨ï¼šåŒä¸€ä¸ªæ®µä¸­ï¼Œä»æœ‰ç©ºé—²ç©ºé—´çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„ä¼šè¢«åŠ å…¥åˆ°è¿™ä¸ªé“¾è¡¨ã€‚</li><li><code>FULL</code>é“¾è¡¨ï¼šåŒä¸€ä¸ªæ®µä¸­ï¼Œå·²ç»æ²¡æœ‰ç©ºé—²ç©ºé—´çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„ä¼šè¢«åŠ å…¥åˆ°è¿™ä¸ªé“¾è¡¨ã€‚</li></ul><p>å†æ¬¡å¼ºè°ƒä¸€éï¼Œæ¯ä¸€ä¸ªç´¢å¼•éƒ½å¯¹åº”ä¸¤ä¸ªæ®µï¼Œæ¯ä¸ªæ®µéƒ½ä¼šç»´æŠ¤ä¸Šè¿°çš„3ä¸ªé“¾è¡¨ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t (<br>    c1 <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    c2 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    c3 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    <span class="hljs-keyword">PRIMARY</span> KEY (c1),<br>    KEY idx_c2 (c2)<br>)ENGINE<span class="hljs-operator">=</span>InnoDB;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè¡¨<code>t</code>å…±æœ‰ä¸¤ä¸ªç´¢å¼•ï¼Œä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œä¸€ä¸ªäºŒçº§ç´¢å¼•<code>idx_c2</code>ï¼Œæ‰€ä»¥è¿™ä¸ªè¡¨å…±æœ‰4ä¸ªæ®µï¼Œæ¯ä¸ªæ®µéƒ½ä¼šç»´æŠ¤ä¸Šè¿°3ä¸ªé“¾è¡¨ï¼Œæ€»å…±æ˜¯12ä¸ªé“¾è¡¨ï¼ŒåŠ ä¸Šæˆ‘ä»¬ä¸Šè¾¹è¯´è¿‡çš„ç›´å±äºè¡¨ç©ºé—´çš„3ä¸ªé“¾è¡¨ï¼Œæ•´ä¸ªç‹¬ç«‹è¡¨ç©ºé—´å…±éœ€è¦ç»´æŠ¤15ä¸ªé“¾è¡¨ã€‚æ‰€ä»¥æ®µåœ¨æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶æ’å…¥æ•°æ®çš„è¯ï¼Œä¼šå…ˆè·å–<code>NOT_FULL</code>é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œç›´æ¥æŠŠæ•°æ®æ’å…¥è¿™ä¸ªå¤´èŠ‚ç‚¹å¯¹åº”çš„åŒºä¸­å³å¯ï¼Œå¦‚æœè¯¥åŒºçš„ç©ºé—´å·²ç»è¢«ç”¨å®Œï¼Œå°±æŠŠè¯¥èŠ‚ç‚¹ç§»åˆ°<code>FULL</code>é“¾è¡¨ä¸­ã€‚</p></li></ul><h4 id="é“¾è¡¨åŸºèŠ‚ç‚¹">é“¾è¡¨åŸºèŠ‚ç‚¹</h4><p>ä¸Šè¾¹å…‰æ˜¯ä»‹ç»äº†ä¸€å †é“¾è¡¨ï¼Œå¯æˆ‘ä»¬æ€ä¹ˆæ‰¾åˆ°è¿™äº›é“¾è¡¨å‘¢ï¼Œæˆ–è€…è¯´æ€ä¹ˆæ‰¾åˆ°æŸä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹æˆ–è€…å°¾èŠ‚ç‚¹åœ¨è¡¨ç©ºé—´ä¸­çš„ä½ç½®å‘¢ï¼Ÿè®¾è®¡<code>InnoDB</code>çš„å¤§å”å½“ç„¶è€ƒè™‘äº†è¿™ä¸ªé—®é¢˜ï¼Œä»–ä»¬è®¾è®¡äº†ä¸€ä¸ªå«<code>List Base Node</code>çš„ç»“æ„ï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯é“¾è¡¨çš„åŸºèŠ‚ç‚¹ã€‚è¿™ä¸ªç»“æ„ä¸­åŒ…å«äº†é“¾è¡¨çš„å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹çš„æŒ‡é’ˆä»¥åŠè¿™ä¸ªé“¾è¡¨ä¸­åŒ…å«äº†å¤šå°‘èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ç”»å›¾çœ‹ä¸€ä¸‹è¿™ä¸ªç»“æ„çš„ç¤ºæ„å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f388927e1c~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1crrehf6i1jsq1j5cubj1mdoh77a4.png-81.6kB"><p>æˆ‘ä»¬ä¸Šè¾¹ä»‹ç»çš„æ¯ä¸ªé“¾è¡¨éƒ½å¯¹åº”è¿™ä¹ˆä¸€ä¸ª<code>List Base Node</code>ç»“æ„ï¼Œå…¶ä¸­ï¼š</p><ul><li><code>List Length</code>è¡¨æ˜è¯¥é“¾è¡¨ä¸€å…±æœ‰å¤šå°‘èŠ‚ç‚¹ï¼Œ</li><li><code>First Node Page Number</code>å’Œ<code>First Node Offset</code>è¡¨æ˜è¯¥é“¾è¡¨çš„å¤´èŠ‚ç‚¹åœ¨è¡¨ç©ºé—´ä¸­çš„ä½ç½®ã€‚</li><li><code>Last Node Page Number</code>å’Œ<code>Last Node Offset</code>è¡¨æ˜è¯¥é“¾è¡¨çš„å°¾èŠ‚ç‚¹åœ¨è¡¨ç©ºé—´ä¸­çš„ä½ç½®ã€‚</li></ul><p>ä¸€èˆ¬æˆ‘ä»¬æŠŠæŸä¸ªé“¾è¡¨å¯¹åº”çš„<code>List Base Node</code>ç»“æ„æ”¾ç½®åœ¨è¡¨ç©ºé—´ä¸­å›ºå®šçš„ä½ç½®ï¼Œè¿™æ ·æƒ³æ‰¾å®šä½æŸä¸ªé“¾è¡¨å°±å˜å¾—so easyå•¦ã€‚</p><h4 id="é“¾è¡¨å°ç»“">é“¾è¡¨å°ç»“</h4><p>ç»¼ä¸Šæ‰€è¿°ï¼Œè¡¨ç©ºé—´æ˜¯ç”±è‹¥å¹²ä¸ªåŒºç»„æˆçš„ï¼Œæ¯ä¸ªåŒºéƒ½å¯¹åº”ä¸€ä¸ª<code>XDES Entry</code>çš„ç»“æ„ï¼Œç›´å±äºè¡¨ç©ºé—´çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„å¯ä»¥åˆ†æˆ<code>FREE</code>ã€<code>FREE_FRAG</code>å’Œ<code>FULL_FRAG</code>è¿™3ä¸ªé“¾è¡¨ï¼›æ¯ä¸ªæ®µå¯ä»¥é™„å±è‹¥å¹²ä¸ªåŒºï¼Œæ¯ä¸ªæ®µä¸­çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„å¯ä»¥åˆ†æˆ<code>FREE</code>ã€<code>NOT_FULL</code>å’Œ<code>FULL</code>è¿™3ä¸ªé“¾è¡¨ã€‚æ¯ä¸ªé“¾è¡¨éƒ½å¯¹åº”ä¸€ä¸ª<code>List Base Node</code>çš„ç»“æ„ï¼Œè¿™ä¸ªç»“æ„é‡Œè®°å½•äº†é“¾è¡¨çš„å¤´ã€å°¾èŠ‚ç‚¹çš„ä½ç½®ä»¥åŠè¯¥é“¾è¡¨ä¸­åŒ…å«çš„èŠ‚ç‚¹æ•°ã€‚æ­£æ˜¯å› ä¸ºè¿™äº›é“¾è¡¨çš„å­˜åœ¨ï¼Œç®¡ç†è¿™äº›åŒºæ‰å˜æˆäº†ä¸€ä»¶so easyçš„äº‹æƒ…ã€‚</p><h3 id="æ®µçš„ç»“æ„">æ®µçš„ç»“æ„</h3><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œæ®µå…¶å®ä¸å¯¹åº”è¡¨ç©ºé—´ä¸­æŸä¸€ä¸ªè¿ç»­çš„ç‰©ç†åŒºåŸŸï¼Œè€Œæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±è‹¥å¹²ä¸ªé›¶æ•£çš„é¡µé¢ä»¥åŠä¸€äº›å®Œæ•´çš„åŒºç»„æˆã€‚åƒæ¯ä¸ªåŒºéƒ½æœ‰å¯¹åº”çš„<code>XDES Entry</code>æ¥è®°å½•è¿™ä¸ªåŒºä¸­çš„å±æ€§ä¸€æ ·ï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä¸ºæ¯ä¸ªæ®µéƒ½å®šä¹‰äº†ä¸€ä¸ª<code>INODE Entry</code>ç»“æ„æ¥è®°å½•ä¸€ä¸‹æ®µä¸­çš„å±æ€§ã€‚å¤§å®¶çœ‹ä¸€ä¸‹ç¤ºæ„å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f4087c4a56~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1crrju0cnji91a2fhv91ijb15hgb1.png-111.4kB"><p>å®ƒçš„å„ä¸ªéƒ¨åˆ†é‡Šä¹‰å¦‚ä¸‹ï¼š</p><ul><li><p><code>Segment ID</code></p><p>å°±æ˜¯æŒ‡è¿™ä¸ª<code>INODE Entry</code>ç»“æ„å¯¹åº”çš„æ®µçš„ç¼–å·ï¼ˆIDï¼‰ã€‚</p></li><li><p><code>NOT_FULL_N_USED</code></p><p>è¿™ä¸ªå­—æ®µæŒ‡çš„æ˜¯åœ¨<code>NOT_FULL</code>é“¾è¡¨ä¸­å·²ç»ä½¿ç”¨äº†å¤šå°‘ä¸ªé¡µé¢ã€‚</p></li><li><p>3ä¸ª<code>List Base Node</code></p><p>åˆ†åˆ«ä¸ºæ®µçš„<code>FREE</code>é“¾è¡¨ã€<code>NOT_FULL</code>é“¾è¡¨ã€<code>FULL</code>é“¾è¡¨å®šä¹‰äº†<code>List Base Node</code>ï¼Œè¿™æ ·æˆ‘ä»¬æƒ³æŸ¥æ‰¾æŸä¸ªæ®µçš„æŸä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥åˆ°è¿™ä¸ªéƒ¨åˆ†æ‰¾åˆ°å¯¹åº”é“¾è¡¨çš„<code>List Base Node</code>ã€‚so easy!</p></li><li><p><code>Magic Number</code>ï¼š</p><p>è¿™ä¸ªå€¼æ˜¯ç”¨æ¥æ ‡è®°è¿™ä¸ª<code>INODE Entry</code>æ˜¯å¦å·²ç»è¢«åˆå§‹åŒ–äº†ï¼ˆåˆå§‹åŒ–çš„æ„æ€å°±æ˜¯æŠŠå„ä¸ªå­—æ®µçš„å€¼éƒ½å¡«è¿›å»äº†ï¼‰ã€‚å¦‚æœè¿™ä¸ªæ•°å­—æ˜¯å€¼çš„<code>97937874</code>ï¼Œè¡¨æ˜è¯¥<code>INODE Entry</code>å·²ç»åˆå§‹åŒ–ï¼Œå¦åˆ™æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚ï¼ˆä¸ç”¨çº ç»“è¿™ä¸ªå€¼æœ‰å•¥ç‰¹æ®Šå«ä¹‰ï¼Œäººå®¶è§„å®šçš„ï¼‰ã€‚</p></li><li><p><code>Fragment Array Entry</code></p><p>æˆ‘ä»¬å‰è¾¹å¼ºè°ƒè¿‡æ— æ•°æ¬¡æ®µæ˜¯ä¸€äº›é›¶æ•£é¡µé¢å’Œä¸€äº›å®Œæ•´çš„åŒºçš„é›†åˆï¼Œæ¯ä¸ª<code>Fragment Array Entry</code>ç»“æ„éƒ½å¯¹åº”ç€ä¸€ä¸ªé›¶æ•£çš„é¡µé¢ï¼Œè¿™ä¸ªç»“æ„ä¸€å…±4ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºä¸€ä¸ªé›¶æ•£é¡µé¢çš„é¡µå·ã€‚</p></li></ul><p>ç»“åˆç€è¿™ä¸ª<code>INODE Entry</code>ç»“æ„ï¼Œå¤§å®¶å¯èƒ½å¯¹æ®µæ˜¯ä¸€äº›é›¶æ•£é¡µé¢å’Œä¸€äº›å®Œæ•´çš„åŒºçš„é›†åˆçš„ç†è§£å†æ¬¡æ·±åˆ»ä¸€äº›ã€‚</p><h3 id="å„ç±»å‹é¡µé¢è¯¦ç»†æƒ…å†µ">å„ç±»å‹é¡µé¢è¯¦ç»†æƒ…å†µ</h3><p>åˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬å·²ç»å¤§æ¦‚æ¸…æ¥šäº†è¡¨ç©ºé—´ã€æ®µã€åŒºã€XDES Entryã€INODE Entryã€å„ç§ä»¥<code>XDES Entry</code>ä¸ºèŠ‚ç‚¹çš„é“¾è¡¨çš„åŸºæœ¬æ¦‚å¿µäº†ï¼Œå¯æ˜¯æ€»æœ‰ä¸€ç§é£åœ¨å¤©ä¸Šä¸è¸å®çš„æ„Ÿè§‰ï¼Œæ¯ä¸ªåŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„åˆ°åº•å­˜å‚¨åœ¨è¡¨ç©ºé—´çš„ä»€ä¹ˆåœ°æ–¹ï¼Ÿç›´å±äºè¡¨ç©ºé—´çš„<code>FREE</code>ã€<code>FREE_FRAG</code>ã€<code>FULL_FRAG</code>é“¾è¡¨çš„åŸºèŠ‚ç‚¹åˆ°åº•å­˜å‚¨åœ¨è¡¨ç©ºé—´çš„ä»€ä¹ˆåœ°æ–¹ï¼Ÿæ¯ä¸ªæ®µå¯¹åº”çš„<code>INODE Entry</code>ç»“æ„åˆ°åº•å­˜åœ¨è¡¨ç©ºé—´çš„ä»€ä¹ˆåœ°æ–¹ï¼Ÿæˆ‘ä»¬å‰è¾¹ä»‹ç»äº†æ¯256ä¸ªè¿ç»­çš„åŒºç®—æ˜¯ä¸€ä¸ªç»„ï¼Œæƒ³è§£å†³åˆšæ‰æå‡ºæ¥çš„è¿™äº›ä¸ªç–‘é—®è¿˜å¾—ä»æ¯ä¸ªç»„å¼€å¤´çš„ä¸€äº›ç±»å‹ç›¸åŒçš„é¡µé¢è¯´èµ·ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€ä¸ªé¡µé¢ä¸€ä¸ªé¡µé¢çš„åˆ†æï¼ŒçœŸç›¸é©¬ä¸Šå°±è¦æµ®å‡ºæ°´é¢äº†ã€‚</p><h4 id="FSP-HDRç±»å‹">FSP_HDRç±»å‹</h4><p>é¦–å…ˆçœ‹ç¬¬ä¸€ä¸ªç»„çš„ç¬¬ä¸€ä¸ªé¡µé¢ï¼Œå½“ç„¶ä¹Ÿæ˜¯è¡¨ç©ºé—´çš„ç¬¬ä¸€ä¸ªé¡µé¢ï¼Œé¡µå·ä¸º<code>0</code>ã€‚è¿™ä¸ªé¡µé¢çš„ç±»å‹æ˜¯<code>FSP_HDR</code>ï¼Œå®ƒå­˜å‚¨äº†è¡¨ç©ºé—´çš„ä¸€äº›æ•´ä½“å±æ€§ä»¥åŠç¬¬ä¸€ä¸ªç»„å†…256ä¸ªåŒºçš„å¯¹åº”çš„<code>XDES Entry</code>ç»“æ„ï¼Œç›´æ¥çœ‹è¿™ä¸ªç±»å‹çš„é¡µé¢çš„ç¤ºæ„å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f4733af475~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1crmfvigk938c8h1hahglr15329.png-146.8kB"><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªå®Œæ•´çš„<code>FSP_HDR</code>ç±»å‹çš„é¡µé¢å¤§è‡´ç”±5ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå„ä¸ªéƒ¨åˆ†çš„å…·ä½“é‡Šä¹‰å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>åç§°</th><th>ä¸­æ–‡å</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>ç®€å•æè¿°</th></tr></thead><tbody><tr><td><code>File Header</code></td><td>æ–‡ä»¶å¤´éƒ¨</td><td><code>38</code>å­—èŠ‚</td><td>é¡µçš„ä¸€äº›é€šç”¨ä¿¡æ¯</td></tr><tr><td><code>File Space Header</code></td><td>è¡¨ç©ºé—´å¤´éƒ¨</td><td><code>112</code>å­—èŠ‚</td><td>è¡¨ç©ºé—´çš„ä¸€äº›æ•´ä½“å±æ€§ä¿¡æ¯</td></tr><tr><td><code>XDES Entry</code></td><td>åŒºæè¿°ä¿¡æ¯</td><td><code>10240</code>å­—èŠ‚</td><td>å­˜å‚¨æœ¬ç»„256ä¸ªåŒºå¯¹åº”çš„å±æ€§ä¿¡æ¯</td></tr><tr><td><code>Empty Space</code></td><td>å°šæœªä½¿ç”¨ç©ºé—´</td><td><code>5986</code>å­—èŠ‚</td><td>ç”¨äºé¡µç»“æ„çš„å¡«å……ï¼Œæ²¡å•¥å®é™…æ„ä¹‰</td></tr><tr><td><code>File Trailer</code></td><td>æ–‡ä»¶å°¾éƒ¨</td><td><code>8</code>å­—èŠ‚</td><td>æ ¡éªŒé¡µæ˜¯å¦å®Œæ•´</td></tr></tbody></table><p><code>File Header</code>å’Œ<code>File Trailer</code>å°±ä¸å†å¼ºè°ƒäº†ï¼Œå¦å¤–çš„å‡ ä¸ªéƒ¨åˆ†ä¸­ï¼Œ<code>Empty Space</code>æ˜¯å°šæœªä½¿ç”¨çš„ç©ºé—´ï¼Œæˆ‘ä»¬ä¸ç”¨ç®¡å®ƒï¼Œé‡ç‚¹æ¥çœ‹çœ‹<code>File Space Header</code>å’Œ<code>XDES Entry</code>è¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p><h5 id="File-Space-Headeréƒ¨åˆ†">File Space Headeréƒ¨åˆ†</h5><p>ä»åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªéƒ¨åˆ†æ˜¯ç”¨æ¥å­˜å‚¨è¡¨ç©ºé—´çš„ä¸€äº›æ•´ä½“å±æ€§çš„ï¼ŒåºŸè¯å°‘è¯´ï¼Œçœ‹å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f47508ede5~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1crrp2qp310rc10fd33ch716hcp.png-148.1kB"><p>å“‡å””ï¼Œå­—æ®µæœ‰ç‚¹å„¿å¤šå“¦ï¼Œä¸æ€¥ä¸€ä¸ªä¸€ä¸ªæ…¢æ…¢çœ‹ã€‚ä¸‹é¢æ˜¯å„ä¸ªå±æ€§çš„ç®€å•æè¿°ï¼š</p><table><thead><tr><th>åç§°</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>Space ID</code></td><td><code>4</code>å­—èŠ‚</td><td>è¡¨ç©ºé—´çš„ID</td></tr><tr><td><code>Not Used</code></td><td><code>4</code>å­—èŠ‚</td><td>è¿™4ä¸ªå­—èŠ‚æœªè¢«ä½¿ç”¨ï¼Œå¯ä»¥å¿½ç•¥</td></tr><tr><td><code>Size</code></td><td><code>4</code>å­—èŠ‚</td><td>å½“å‰è¡¨ç©ºé—´å æœ‰çš„é¡µé¢æ•°</td></tr><tr><td><code>FREE Limit</code></td><td><code>4</code>å­—èŠ‚</td><td>å°šæœªè¢«åˆå§‹åŒ–çš„æœ€å°é¡µå·ï¼Œå¤§äºæˆ–ç­‰äºè¿™ä¸ªé¡µå·çš„åŒºå¯¹åº”çš„XDES Entryç»“æ„éƒ½æ²¡æœ‰è¢«åŠ å…¥FREEé“¾è¡¨</td></tr><tr><td><code>Space Flags</code></td><td><code>4</code>å­—èŠ‚</td><td>è¡¨ç©ºé—´çš„ä¸€äº›å ç”¨å­˜å‚¨ç©ºé—´æ¯”è¾ƒå°çš„å±æ€§</td></tr><tr><td><code>FRAG_N_USED</code></td><td><code>4</code>å­—èŠ‚</td><td>FREE_FRAGé“¾è¡¨ä¸­å·²ä½¿ç”¨çš„é¡µé¢æ•°é‡</td></tr><tr><td><code>List Base Node for FREE List</code></td><td><code>16</code>å­—èŠ‚</td><td>FREEé“¾è¡¨çš„åŸºèŠ‚ç‚¹</td></tr><tr><td><code>List Base Node for FREE_FRAG List</code></td><td><code>16</code>å­—èŠ‚</td><td>FREE_FRAGé“¾è¡¨çš„åŸºèŠ‚ç‚¹</td></tr><tr><td><code>List Base Node for FULL_FRAG List</code></td><td><code>16</code>å­—èŠ‚</td><td>FULL_FRAGé“¾è¡¨çš„åŸºèŠ‚ç‚¹</td></tr><tr><td><code>Next Unused Segment ID</code></td><td><code>8</code>å­—èŠ‚</td><td>å½“å‰è¡¨ç©ºé—´ä¸­ä¸‹ä¸€ä¸ªæœªä½¿ç”¨çš„ Segment ID</td></tr><tr><td><code>List Base Node for SEG_INODES_FULL List</code></td><td><code>16</code>å­—èŠ‚</td><td>SEG_INODES_FULLé“¾è¡¨çš„åŸºèŠ‚ç‚¹</td></tr><tr><td><code>List Base Node for SEG_INODES_FREE List</code></td><td><code>16</code>å­—èŠ‚</td><td>SEG_INODES_FREEé“¾è¡¨çš„åŸºèŠ‚ç‚¹</td></tr></tbody></table><p>è¿™é‡Œå¤´çš„<code>Space ID</code>ã€<code>Not Used</code>ã€<code>Size</code>è¿™ä¸‰ä¸ªå­—æ®µå¤§å®¶è‚¯å®šä¸€çœ‹å°±æ‡‚ï¼Œå…¶ä»–çš„å­—æ®µæˆ‘ä»¬å†è¯¦ç»†ç…ç…ï¼Œä¸ºäº†å¤§å®¶çš„é˜…è¯»ä½“éªŒï¼Œæˆ‘å°±ä¸ä¸¥æ ¼æŒ‰ç…§å®é™…çš„å­—æ®µé¡ºåºæ¥è§£é‡Šå„ä¸ªå­—æ®µäº†å“ˆã€‚</p><ul><li><p><code>List Base Node for FREE List</code>ã€<code>List Base Node for FREE_FRAG List</code>ã€<code>List Base Node for FULL_FRAG List</code>ã€‚</p><p>è¿™ä¸‰ä¸ªå¤§å®¶çœ‹ç€å¤ªäº²åˆ‡äº†ï¼Œåˆ†åˆ«æ˜¯ç›´å±äºè¡¨ç©ºé—´çš„<code>FREE</code>é“¾è¡¨çš„åŸºèŠ‚ç‚¹ã€<code>FREE_FRAG</code>é“¾è¡¨çš„åŸºèŠ‚ç‚¹ã€<code>FULL_FRAG</code>é“¾è¡¨çš„åŸºèŠ‚ç‚¹ï¼Œè¿™ä¸‰ä¸ªé“¾è¡¨çš„åŸºèŠ‚ç‚¹åœ¨è¡¨ç©ºé—´çš„ä½ç½®æ˜¯å›ºå®šçš„ï¼Œå°±æ˜¯åœ¨è¡¨ç©ºé—´çš„ç¬¬ä¸€ä¸ªé¡µé¢ï¼ˆä¹Ÿå°±æ˜¯<code>FSP_HDR</code>ç±»å‹çš„é¡µé¢ï¼‰çš„<code>File Space Header</code>éƒ¨åˆ†ã€‚æ‰€ä»¥ä¹‹åå®šä½è¿™å‡ ä¸ªé“¾è¡¨å°±so easyå•¦ã€‚</p></li><li><p><code>FRAG_N_USED</code></p><p>è¿™ä¸ªå­—æ®µè¡¨æ˜åœ¨<code>FREE_FRAG</code>é“¾è¡¨ä¸­å·²ç»ä½¿ç”¨çš„é¡µé¢æ•°é‡ã€‚</p></li><li><p><code>FREE Limit</code></p><p>æˆ‘ä»¬çŸ¥é“è¡¨ç©ºé—´éƒ½å¯¹åº”ç€å…·ä½“çš„ç£ç›˜æ–‡ä»¶ï¼Œä¸€å¼€å§‹æˆ‘ä»¬åˆ›å»ºè¡¨ç©ºé—´çš„æ—¶å€™å¯¹åº”çš„ç£ç›˜æ–‡ä»¶ä¸­éƒ½æ²¡æœ‰æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹è¡¨ç©ºé—´å®Œæˆä¸€ä¸ªåˆå§‹åŒ–æ“ä½œï¼ŒåŒ…æ‹¬ä¸ºè¡¨ç©ºé—´ä¸­çš„åŒºå»ºç«‹<code>XDES Entry</code>ç»“æ„ï¼Œä¸ºå„ä¸ªæ®µå»ºç«‹<code>INODE Entry</code>ç»“æ„ï¼Œå»ºç«‹å„ç§é“¾è¡¨å§å•¦å§å•¦çš„å„ç§æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥ä¸€å¼€å§‹å°±ä¸ºè¡¨ç©ºé—´ç”³è¯·ä¸€ä¸ªç‰¹åˆ«å¤§çš„ç©ºé—´ï¼Œä½†æ˜¯å®é™…ä¸Šæœ‰ç»å¤§éƒ¨åˆ†çš„åŒºæ˜¯ç©ºé—²çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æŠŠæ‰€æœ‰çš„è¿™äº›ç©ºé—²åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„åŠ å…¥<code>FREE</code>é“¾è¡¨ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åªæŠŠä¸€éƒ¨åˆ†çš„ç©ºé—²åŒºåŠ å…¥<code>FREE</code>é“¾è¡¨ï¼Œç­‰å•¥æ—¶å€™ç©ºé—²é“¾è¡¨ä¸­çš„<code>XDES Entry</code>ç»“æ„å¯¹åº”çš„åŒºä¸å¤Ÿä½¿äº†ï¼Œå†æŠŠä¹‹å‰æ²¡æœ‰åŠ å…¥<code>FREE</code>é“¾è¡¨çš„ç©ºé—²åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„åŠ å…¥<code>FREE</code>é“¾è¡¨ï¼Œä¸­å¿ƒæ€æƒ³å°±æ˜¯å•¥æ—¶å€™ç”¨åˆ°å•¥æ—¶å€™åˆå§‹åŒ–ï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”é‡‡ç”¨çš„å°±æ˜¯åè€…ï¼Œä»–ä»¬ä¸ºè¡¨ç©ºé—´å®šä¹‰äº†<code>FREE Limit</code>è¿™ä¸ªå­—æ®µï¼Œåœ¨è¯¥å­—æ®µè¡¨ç¤ºçš„é¡µå·ä¹‹å‰çš„åŒºéƒ½è¢«åˆå§‹åŒ–äº†ï¼Œä¹‹åçš„åŒºå°šæœªè¢«åˆå§‹åŒ–ã€‚</p></li><li><p><code>Next Unused Segment ID</code></p><p>è¡¨ä¸­æ¯ä¸ªç´¢å¼•éƒ½å¯¹åº”2ä¸ªæ®µï¼Œæ¯ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œé‚£å½“æˆ‘ä»¬ä¸ºæŸä¸ªè¡¨æ–°åˆ›å»ºä¸€ä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå°±æ„å‘³ç€è¦åˆ›å»ºä¸¤ä¸ªæ–°çš„æ®µã€‚é‚£æ€ä¹ˆä¸ºè¿™ä¸ªæ–°åˆ›å»ºçš„æ®µæ‰¾ä¸€ä¸ªå”¯ä¸€çš„IDå‘¢ï¼Ÿå»éå†ç°åœ¨è¡¨ç©ºé—´ä¸­æ‰€æœ‰çš„æ®µä¹ˆï¼Ÿæˆ‘ä»¬è¯´è¿‡ï¼Œéå†æ˜¯ä¸å¯èƒ½éå†çš„ï¼Œè¿™è¾ˆå­éƒ½ä¸å¯èƒ½éå†ï¼Œæ‰€ä»¥è®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬æå‡ºäº†è¿™ä¸ªåå«<code>Next Unused Segment ID</code>çš„å­—æ®µï¼Œè¯¥å­—æ®µè¡¨æ˜å½“å‰è¡¨ç©ºé—´ä¸­æœ€å¤§çš„æ®µIDçš„ä¸‹ä¸€ä¸ªIDï¼Œè¿™æ ·åœ¨åˆ›å»ºæ–°æ®µçš„æ—¶å€™èµ‹äºˆæ–°æ®µä¸€ä¸ªå”¯ä¸€çš„IDå€¼å°±so easyå•¦ï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸ªå­—æ®µçš„å€¼å°±å¥½äº†ã€‚</p></li><li><p><code>Space Flags</code></p><p>è¡¨ç©ºé—´å¯¹äºä¸€äº›å¸ƒå°”ç±»å‹çš„å±æ€§ï¼Œæˆ–è€…åªéœ€è¦å¯¥å¯¥å‡ ä¸ªæ¯”ç‰¹ä½æå®šçš„å±æ€§éƒ½æ”¾åœ¨äº†è¿™ä¸ª<code>Space Flags</code>ä¸­å­˜å‚¨ï¼Œè™½ç„¶å®ƒåªæœ‰4ä¸ªå­—èŠ‚ï¼Œ32ä¸ªæ¯”ç‰¹ä½å¤§å°ï¼Œå´å­˜å‚¨äº†å¥½å¤šè¡¨ç©ºé—´çš„å±æ€§ï¼Œè¯¦ç»†æƒ…å†µå¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>æ ‡å¿—åç§°</th><th>å ç”¨çš„ç©ºé—´ï¼ˆå•ä½ï¼šbitï¼‰</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>POST_ANTELOPE</code></td><td>1</td><td>è¡¨ç¤ºæ–‡ä»¶æ ¼å¼æ˜¯å¦å¤§äº<code>ANTELOPE</code></td></tr><tr><td><code>ZIP_SSIZE</code></td><td>4</td><td>è¡¨ç¤ºå‹ç¼©é¡µé¢çš„å¤§å°</td></tr><tr><td><code>ATOMIC_BLOBS</code></td><td>1</td><td>è¡¨ç¤ºæ˜¯å¦è‡ªåŠ¨æŠŠå€¼éå¸¸é•¿çš„å­—æ®µæ”¾åˆ°BLOBé¡µé‡Œ</td></tr><tr><td><code>PAGE_SSIZE</code></td><td>4</td><td>é¡µé¢å¤§å°</td></tr><tr><td><code>DATA_DIR</code></td><td>1</td><td>è¡¨ç¤ºè¡¨ç©ºé—´æ˜¯å¦æ˜¯ä»é»˜è®¤çš„æ•°æ®ç›®å½•ä¸­è·å–çš„</td></tr><tr><td><code>SHARED</code></td><td>1</td><td>æ˜¯å¦ä¸ºå…±äº«è¡¨ç©ºé—´</td></tr><tr><td><code>TEMPORARY</code></td><td>1</td><td>æ˜¯å¦ä¸ºä¸´æ—¶è¡¨ç©ºé—´</td></tr><tr><td><code>ENCRYPTION</code></td><td>1</td><td>è¡¨ç©ºé—´æ˜¯å¦åŠ å¯†</td></tr><tr><td><code>UNUSED</code></td><td>18</td><td>æ²¡æœ‰ä½¿ç”¨åˆ°çš„æ¯”ç‰¹ä½</td></tr></tbody></table><blockquote><p>å°è´´å£«ï¼š ä¸åŒMySQLç‰ˆæœ¬é‡Œ SPACE_FLAGS ä»£è¡¨çš„å±æ€§å¯èƒ½æœ‰äº›å·®å¼‚ï¼Œæˆ‘ä»¬è¿™é‡Œåˆ—ä¸¾çš„æ˜¯5.7.21ç‰ˆæœ¬çš„ã€‚ä¸è¿‡å¤§å®¶ç°åœ¨ä¸å¿…æ·±ç©¶å®ƒä»¬çš„æ„æ€ï¼Œå› ä¸ºæˆ‘ä»¬ä¸€æ—¦æŠŠè¿™äº›æ¦‚å¿µå±•å¼€ï¼Œå°±éœ€è¦éå¸¸å¤§çš„ç¯‡å¹…ï¼Œä¸»è¦æ€•å¤§å®¶å—ä¸äº†ã€‚æˆ‘ä»¬è¿˜æ˜¯å…ˆæŒ‘é‡è¦çš„çœ‹ï¼ŒæŠŠä¸»è¦çš„è¡¨ç©ºé—´ç»“æ„äº†è§£å®Œï¼Œè¿™äº› SPACE_FLAGS é‡Œçš„å±æ€§çš„ç»†èŠ‚å°±æš‚æ—¶ä¸æ·±ç©¶äº†ã€‚</p></blockquote></li><li><p><code>List Base Node for SEG_INODES_FULL List</code>å’Œ<code>List Base Node for SEG_INODES_FREE List</code></p><p>æ¯ä¸ªæ®µå¯¹åº”çš„<code>INODE Entry</code>ç»“æ„ä¼šé›†ä¸­å­˜æ”¾åˆ°ä¸€ä¸ªç±»å‹ä¸º<code>INODE</code>çš„é¡µä¸­ï¼Œå¦‚æœè¡¨ç©ºé—´ä¸­çš„æ®µç‰¹åˆ«å¤šï¼Œåˆ™ä¼šæœ‰å¤šä¸ª<code>INODE Entry</code>ç»“æ„ï¼Œå¯èƒ½ä¸€ä¸ªé¡µæ”¾ä¸ä¸‹ï¼Œè¿™äº›<code>INODE</code>ç±»å‹çš„é¡µä¼šç»„æˆä¸¤ç§åˆ—è¡¨ï¼š</p><ul><li><code>SEG_INODES_FULL</code>é“¾è¡¨ï¼Œè¯¥é“¾è¡¨ä¸­çš„<code>INODE</code>ç±»å‹çš„é¡µé¢éƒ½å·²ç»è¢«<code>INODE Entry</code>ç»“æ„å¡«å……æ»¡äº†ï¼Œæ²¡ç©ºé—²ç©ºé—´å­˜æ”¾é¢å¤–çš„<code>INODE Entry</code>äº†ã€‚</li><li><code>SEG_INODES_FREE</code>é“¾è¡¨ï¼Œè¯¥é“¾è¡¨ä¸­çš„<code>INODE</code>ç±»å‹çš„é¡µé¢ä»æœ‰ç©ºé—²ç©ºé—´æ¥å­˜æ”¾<code>INODE Entry</code>ç»“æ„ã€‚</li></ul><p>ç”±äºæˆ‘ä»¬ç°åœ¨è¿˜æ²¡æœ‰è¯¦ç»†å” å¨<code>INODE</code>ç±»å‹é¡µï¼Œæ‰€ä»¥ç­‰ä¼šè¯´è¿‡<code>INODE</code>ç±»å‹çš„é¡µä¹‹åå†å›è¿‡å¤´æ¥çœ‹ç€ä¸¤ä¸ªé“¾è¡¨ã€‚</p></li></ul><h5 id="XDES-Entryéƒ¨åˆ†">XDES Entryéƒ¨åˆ†</h5><p>ç´§æ¥ç€<code>File Space Header</code>éƒ¨åˆ†çš„å°±æ˜¯<code>XDES Entry</code>éƒ¨åˆ†äº†ï¼Œæˆ‘ä»¬å˜´ä¸Šå” å¨è¿‡æ— æ•°æ¬¡ï¼Œå´ä»æ²¡è§è¿‡çœŸèº«çš„<code>XDES Entry</code>å°±æ˜¯åœ¨è¡¨ç©ºé—´çš„ç¬¬ä¸€ä¸ªé¡µé¢ä¸­ä¿å­˜çš„ã€‚æˆ‘ä»¬çŸ¥é“ä¸€ä¸ª<code>XDES Entry</code>ç»“æ„çš„å¤§å°æ˜¯40å­—èŠ‚ï¼Œä½†æ˜¯ä¸€ä¸ªé¡µé¢çš„å¤§å°æœ‰é™ï¼Œåªèƒ½å­˜æ”¾æœ‰é™ä¸ª<code>XDES Entry</code>ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰æŠŠ256ä¸ªåŒºåˆ’åˆ†æˆä¸€ç»„ï¼Œåœ¨æ¯ç»„çš„ç¬¬ä¸€ä¸ªé¡µé¢ä¸­å­˜æ”¾256ä¸ª<code>XDES Entry</code>ç»“æ„ã€‚å¤§å®¶å›çœ‹é‚£ä¸ª<code>FSP_HDR</code>ç±»å‹é¡µé¢çš„ç¤ºæ„å›¾ï¼Œ<code>XDES Entry 0</code>å°±å¯¹åº”ç€<code>extent 0</code>ï¼Œ<code>XDES Entry 1</code>å°±å¯¹åº”ç€<code>extent 1</code>â€¦ ä¾æ­¤ç±»æ¨ï¼Œ<code>XDES Entry255</code>å°±å¯¹åº”ç€<code>extent 255</code>ã€‚</p><p>å› ä¸ºæ¯ä¸ªåŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„çš„åœ°å€æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¿é—®è¿™äº›ç»“æ„å°±so easyå•¦ï¼Œè‡³äºè¯¥ç»“æ„çš„è¯¦ç»†ä½¿ç”¨æƒ…å†µæˆ‘ä»¬å·²ç»å” å¨çš„å¤Ÿæ˜ç™½äº†ï¼Œåœ¨è¿™å°±ä¸èµ˜è¿°äº†ã€‚</p><h4 id="XDESç±»å‹">XDESç±»å‹</h4><p>æˆ‘ä»¬è¯´è¿‡ï¼Œæ¯ä¸€ä¸ª<code>XDES Entry</code>ç»“æ„å¯¹åº”è¡¨ç©ºé—´çš„ä¸€ä¸ªåŒºï¼Œè™½ç„¶ä¸€ä¸ª<code>XDES Entry</code>ç»“æ„åªå ç”¨40å­—èŠ‚ï¼Œä½†ä½ æŠµä¸ä½è¡¨ç©ºé—´çš„åŒºçš„æ•°é‡ä¹Ÿå¤šå•Šã€‚åœ¨åŒºçš„æ•°é‡éå¸¸å¤šæ—¶ï¼Œä¸€ä¸ªå•ç‹¬çš„é¡µå¯èƒ½å°±ä¸å¤Ÿå­˜æ”¾è¶³å¤Ÿå¤šçš„<code>XDES Entry</code>ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¡¨ç©ºé—´çš„åŒºåˆ†ä¸ºäº†è‹¥å¹²ä¸ªç»„ï¼Œæ¯ç»„å¼€å¤´çš„ä¸€ä¸ªé¡µé¢è®°å½•ç€æœ¬ç»„å†…æ‰€æœ‰çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„ã€‚ç”±äºç¬¬ä¸€ä¸ªç»„çš„ç¬¬ä¸€ä¸ªé¡µé¢æœ‰äº›ç‰¹æ®Šï¼Œå› ä¸ºå®ƒä¹Ÿæ˜¯æ•´ä¸ªè¡¨ç©ºé—´çš„ç¬¬ä¸€ä¸ªé¡µé¢ï¼Œæ‰€ä»¥é™¤äº†è®°å½•æœ¬ç»„ä¸­çš„æ‰€æœ‰åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„ä»¥å¤–ï¼Œè¿˜è®°å½•ç€è¡¨ç©ºé—´çš„ä¸€äº›æ•´ä½“å±æ€§ï¼Œè¿™ä¸ªé¡µé¢çš„ç±»å‹å°±æ˜¯æˆ‘ä»¬åˆšåˆšè¯´å®Œçš„<code>FSP_HDR</code>ç±»å‹ï¼Œæ•´ä¸ªè¡¨ç©ºé—´é‡Œåªæœ‰ä¸€ä¸ªè¿™ä¸ªç±»å‹çš„é¡µé¢ã€‚é™¤å»ç¬¬ä¸€ä¸ªåˆ†ç»„ä»¥å¤–ï¼Œä¹‹åçš„æ¯ä¸ªåˆ†ç»„çš„ç¬¬ä¸€ä¸ªé¡µé¢åªéœ€è¦è®°å½•æœ¬ç»„å†…æ‰€æœ‰çš„åŒºå¯¹åº”çš„<code>XDES Entry</code>ç»“æ„å³å¯ï¼Œä¸éœ€è¦å†è®°å½•è¡¨ç©ºé—´çš„å±æ€§äº†ï¼Œä¸ºäº†å’Œ<code>FSP_HDR</code>ç±»å‹åšåŒºåˆ«ï¼Œæˆ‘ä»¬æŠŠä¹‹åæ¯ä¸ªåˆ†ç»„çš„ç¬¬ä¸€ä¸ªé¡µé¢çš„ç±»å‹å®šä¹‰ä¸º<code>XDES</code>ï¼Œå®ƒçš„ç»“æ„å’Œ<code>FSP_HDR</code>ç±»å‹æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f475c0ec2a~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cs3vmoii1h971aje1iveack1l109.png-149.5kB"><p>ä¸<code>FSP_HDR</code>ç±»å‹çš„é¡µé¢å¯¹æ¯”ï¼Œé™¤äº†å°‘äº†<code>File Space Header</code>éƒ¨åˆ†ä¹‹å¤–ï¼Œä¹Ÿå°±æ˜¯é™¤äº†å°‘äº†è®°å½•è¡¨ç©ºé—´æ•´ä½“å±æ€§çš„éƒ¨åˆ†ä¹‹å¤–ï¼Œå…¶ä½™çš„éƒ¨åˆ†æ˜¯ä¸€æ ·ä¸€æ ·çš„ã€‚ç”±äºæˆ‘ä»¬ä¸Šè¾¹å” å¨çš„å·²ç»å¤Ÿä»”ç»†äº†ï¼Œå¯¹äº<code>XDES</code>ç±»å‹çš„é¡µé¢ä¹Ÿå°±ä¸é‡å¤å” å¨äº†å“ˆã€‚</p><h4 id="IBUF-BITMAPç±»å‹">IBUF_BITMAPç±»å‹</h4><p>å¯¹æ¯”å‰è¾¹ä»‹ç»è¡¨ç©ºé—´çš„å›¾ï¼Œæ¯ä¸ªåˆ†ç»„çš„ç¬¬äºŒä¸ªé¡µé¢çš„ç±»å‹éƒ½æ˜¯<code>IBUF_BITMAP</code>ï¼Œè¿™ç§ç±»å‹çš„é¡µé‡Œè¾¹è®°å½•äº†ä¸€äº›æœ‰å…³<code>Change Buffer</code>çš„ä¸œä¸œï¼Œç”±äºè¿™ä¸ª<code>Change Buffer</code>é‡ŒåˆåŒ…å«äº†è´¼å¤šçš„æ¦‚å¿µï¼Œè€ƒè™‘åˆ°å¤§å®¶åœ¨ä¸€ç« ä¸­æ¥å—è¿™ä¹ˆå¤šæ–°æ¦‚å¿µæœ‰ç‚¹å‘¼å¸ä¸é€‚ï¼Œæ€•å¤§å®¶å¿ƒè„ç—…çŠ¯äº†æ‰€ä»¥å°±æŠŠ<code>Change Buffer</code>çš„ç›¸å…³çŸ¥è¯†æ”¾åˆ°åè¾¹çš„ç« èŠ‚ä¸­ï¼Œå¤§å®¶ç¨å®‰å‹¿èºå“ˆã€‚</p><h4 id="INODEç±»å‹">INODEç±»å‹</h4><p>å†æ¬¡å¯¹æ¯”å‰è¾¹ä»‹ç»è¡¨ç©ºé—´çš„å›¾ï¼Œç¬¬ä¸€ä¸ªåˆ†ç»„çš„ç¬¬ä¸‰ä¸ªé¡µé¢çš„ç±»å‹æ˜¯<code>INODE</code>ã€‚æˆ‘ä»¬å‰è¾¹è¯´è¿‡è®¾è®¡<code>InnoDB</code>çš„å¤§å”ä¸ºæ¯ä¸ªç´¢å¼•å®šä¹‰äº†ä¸¤ä¸ªæ®µï¼Œè€Œä¸”ä¸ºæŸäº›ç‰¹æ®ŠåŠŸèƒ½å®šä¹‰äº†äº›ç‰¹æ®Šçš„æ®µã€‚ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œä»–ä»¬åˆä¸ºæ¯ä¸ªæ®µè®¾è®¡äº†ä¸€ä¸ª<code>INODE Entry</code>ç»“æ„ï¼Œè¿™ä¸ªç»“æ„ä¸­è®°å½•äº†å…³äºè¿™ä¸ªæ®µçš„ç›¸å…³å±æ€§ã€‚è€Œæˆ‘ä»¬è¿™ä¼šå„¿è¦ä»‹ç»çš„è¿™ä¸ª<code>INODE</code>ç±»å‹çš„é¡µå°±æ˜¯ä¸ºäº†å­˜å‚¨<code>INODE Entry</code>ç»“æ„è€Œå­˜åœ¨çš„ã€‚å¥½äº†ï¼ŒåºŸè¯å°‘è¯´ï¼Œç›´æ¥çœ‹å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16ef3a8df380813e~tplv-t2oaga2asx-watermark.awebp" class="" title="img"><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ª<code>INODE</code>ç±»å‹çš„é¡µé¢æ˜¯ç”±è¿™å‡ éƒ¨åˆ†æ„æˆçš„ï¼š</p><table><thead><tr><th>åç§°</th><th>ä¸­æ–‡å</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>ç®€å•æè¿°</th></tr></thead><tbody><tr><td><code>File Header</code></td><td>æ–‡ä»¶å¤´éƒ¨</td><td><code>38</code>å­—èŠ‚</td><td>é¡µçš„ä¸€äº›é€šç”¨ä¿¡æ¯</td></tr><tr><td><code>List Node for INODE Page List</code></td><td>é€šç”¨é“¾è¡¨èŠ‚ç‚¹</td><td><code>12</code>å­—èŠ‚</td><td>å­˜å‚¨ä¸Šä¸€ä¸ªINODEé¡µé¢å’Œä¸‹ä¸€ä¸ªINODEé¡µé¢çš„æŒ‡é’ˆ</td></tr><tr><td><code>INODE Entry</code></td><td>æ®µæè¿°ä¿¡æ¯</td><td><code>16320</code>å­—èŠ‚</td><td></td></tr><tr><td><code>Empty Space</code></td><td>å°šæœªä½¿ç”¨ç©ºé—´</td><td><code>6</code>å­—èŠ‚</td><td>ç”¨äºé¡µç»“æ„çš„å¡«å……ï¼Œæ²¡å•¥å®é™…æ„ä¹‰</td></tr><tr><td><code>File Trailer</code></td><td>æ–‡ä»¶å°¾éƒ¨</td><td><code>8</code>å­—èŠ‚</td><td>æ ¡éªŒé¡µæ˜¯å¦å®Œæ•´</td></tr></tbody></table><p>é™¤äº†<code>File Header</code>ã€<code>Empty Space</code>ã€<code>File Trailer</code>è¿™å‡ ä¸ªè€æœ‹å‹å¤–ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨<code>List Node for INODE Page List</code>å’Œ<code>INODE Entry</code>è¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p><p>é¦–å…ˆçœ‹<code>INODE Entry</code>éƒ¨åˆ†ï¼Œæˆ‘ä»¬å‰è¾¹å·²ç»è¯¦ç»†ä»‹ç»è¿‡è¿™ä¸ªç»“æ„çš„ç»„æˆäº†ï¼Œä¸»è¦åŒ…æ‹¬å¯¹åº”çš„æ®µå†…é›¶æ•£é¡µé¢çš„åœ°å€ä»¥åŠé™„å±äºè¯¥æ®µçš„<code>FREE</code>ã€<code>NOT_FULL</code>å’Œ<code>FULL</code>é“¾è¡¨çš„åŸºèŠ‚ç‚¹ã€‚æ¯ä¸ª<code>INODE Entry</code>ç»“æ„å ç”¨192å­—èŠ‚ï¼Œä¸€ä¸ªé¡µé¢é‡Œå¯ä»¥å­˜å‚¨<code>85</code>ä¸ªè¿™æ ·çš„ç»“æ„ã€‚</p><p>é‡ç‚¹çœ‹ä¸€ä¸‹<code>List Node for INODE Page List</code>è¿™ä¸ªç©æ„å„¿ï¼Œå› ä¸ºä¸€ä¸ªè¡¨ç©ºé—´ä¸­å¯èƒ½å­˜åœ¨è¶…è¿‡85ä¸ªæ®µï¼Œæ‰€ä»¥å¯èƒ½ä¸€ä¸ª<code>INODE</code>ç±»å‹çš„é¡µé¢ä¸è¶³ä»¥å­˜å‚¨æ‰€æœ‰çš„æ®µå¯¹åº”çš„<code>INODE Entry</code>ç»“æ„ï¼Œæ‰€ä»¥å°±éœ€è¦é¢å¤–çš„<code>INODE</code>ç±»å‹çš„é¡µé¢æ¥å­˜å‚¨è¿™äº›ç»“æ„ã€‚è¿˜æ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†è¿™äº›<code>INODE</code>ç±»å‹çš„é¡µé¢ï¼Œè®¾è®¡<code>InnoDB</code>çš„å¤§å”ä»¬å°†è¿™äº›<code>INODE</code>ç±»å‹çš„é¡µé¢ä¸²è”æˆä¸¤ä¸ªä¸åŒçš„é“¾è¡¨ï¼š</p><ul><li><code>SEG_INODES_FULL</code>é“¾è¡¨ï¼šè¯¥é“¾è¡¨ä¸­çš„<code>INODE</code>ç±»å‹çš„é¡µé¢ä¸­å·²ç»æ²¡æœ‰ç©ºé—²ç©ºé—´æ¥å­˜å‚¨é¢å¤–çš„<code>INODE Entry</code>ç»“æ„äº†ã€‚</li><li><code>SEG_INODES_FREE</code>é“¾è¡¨ï¼šè¯¥é“¾è¡¨ä¸­çš„<code>INODE</code>ç±»å‹çš„é¡µé¢ä¸­è¿˜æœ‰ç©ºé—²ç©ºé—´æ¥å­˜å‚¨é¢å¤–çš„<code>INODE Entry</code>ç»“æ„äº†ã€‚</li></ul><p>æƒ³å¿…å¤§å®¶å·²ç»è®¤å‡ºè¿™ä¸¤ä¸ªé“¾è¡¨äº†ï¼Œæˆ‘ä»¬å‰è¾¹æåˆ°è¿‡è¿™ä¸¤ä¸ªé“¾è¡¨çš„åŸºèŠ‚ç‚¹å°±å­˜å‚¨åœ¨<code>File Space Header</code>é‡Œè¾¹ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸¤ä¸ªé“¾è¡¨çš„åŸºèŠ‚ç‚¹çš„ä½ç½®æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾çš„è®¿é—®åˆ°è¿™ä¸¤ä¸ªé“¾è¡¨ã€‚ä»¥åæ¯å½“æˆ‘ä»¬æ–°åˆ›å»ºä¸€ä¸ªæ®µï¼ˆåˆ›å»ºç´¢å¼•æ—¶å°±ä¼šåˆ›å»ºæ®µï¼‰æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ª<code>INODE Entry</code>ç»“æ„ä¸ä¹‹å¯¹åº”ï¼Œå­˜å‚¨<code>INODE Entry</code>çš„å¤§è‡´è¿‡ç¨‹å°±æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>å…ˆçœ‹çœ‹<code>SEG_INODES_FREE</code>é“¾è¡¨æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œç›´æ¥ä»è¯¥é“¾è¡¨ä¸­è·å–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±ç›¸å½“äºè·å–åˆ°ä¸€ä¸ªä»æœ‰ç©ºé—²ç©ºé—´çš„<code>INODE</code>ç±»å‹çš„é¡µé¢ï¼Œç„¶åæŠŠè¯¥<code>INODE Entry</code>ç»“æ„æ”¾åˆ°è¯¥é¡µé¢ä¸­ã€‚å½“è¯¥é¡µé¢ä¸­æ— å‰©ä½™ç©ºé—´æ—¶ï¼Œå°±æŠŠè¯¥é¡µæ”¾åˆ°<code>SEG_INODES_FULL</code>é“¾è¡¨ä¸­ã€‚</li><li>å¦‚æœ<code>SEG_INODES_FREE</code>é“¾è¡¨ä¸ºç©ºï¼Œåˆ™éœ€è¦ä»è¡¨ç©ºé—´çš„<code>FREE_FRAG</code>é“¾è¡¨ä¸­ç”³è¯·ä¸€ä¸ªé¡µé¢ï¼Œä¿®æ”¹è¯¥é¡µé¢çš„ç±»å‹ä¸º<code>INODE</code>ï¼ŒæŠŠè¯¥é¡µé¢æ”¾åˆ°<code>SEG_INODES_FREE</code>é“¾è¡¨ä¸­ï¼Œä¸æ­¤åŒæ—¶æŠŠè¯¥<code>INODE Entry</code>ç»“æ„æ”¾å…¥è¯¥é¡µé¢ã€‚</li></ul><h3 id="Segment-Header-ç»“æ„çš„è¿ç”¨">Segment Header ç»“æ„çš„è¿ç”¨</h3><p>æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªç´¢å¼•ä¼šäº§ç”Ÿä¸¤ä¸ªæ®µï¼Œåˆ†åˆ«æ˜¯å¶å­èŠ‚ç‚¹æ®µå’Œéå¶å­èŠ‚ç‚¹æ®µï¼Œè€Œæ¯ä¸ªæ®µéƒ½ä¼šå¯¹åº”ä¸€ä¸ª<code>INODE Entry</code>ç»“æ„ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆçŸ¥é“æŸä¸ªæ®µå¯¹åº”å“ªä¸ª<code>INODE Entry</code>ç»“æ„å‘¢ï¼Ÿæ‰€ä»¥å¾—æ‰¾ä¸ªåœ°æ–¹è®°ä¸‹æ¥è¿™ä¸ªå¯¹åº”å…³ç³»ã€‚å¸Œæœ›ä½ è¿˜è®°å¾—æˆ‘ä»¬åœ¨å” å¨æ•°æ®é¡µï¼Œä¹Ÿå°±æ˜¯<code>INDEX</code>ç±»å‹çš„é¡µæ—¶æœ‰ä¸€ä¸ª<code>Page Header</code>éƒ¨åˆ†ï¼Œå½“ç„¶æˆ‘ä¸èƒ½æŒ‡æœ›ä½ è®°ä½ï¼Œæ‰€ä»¥æŠŠ<code>Page Header</code>éƒ¨åˆ†å†æŠ„ä¸€éç»™ä½ çœ‹ï¼š</p><p><strong>Page Headeréƒ¨åˆ†</strong>ï¼ˆä¸ºçªå‡ºé‡ç‚¹ï¼Œçœç•¥äº†å¥½å¤šå±æ€§ï¼‰</p><table><thead><tr><th>åç§°</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>æè¿°</th></tr></thead><tbody><tr><td>â€¦</td><td>â€¦</td><td>â€¦</td></tr><tr><td><code>PAGE_BTR_SEG_LEAF</code></td><td><code>10</code>å­—èŠ‚</td><td>B+æ ‘å¶å­æ®µçš„å¤´éƒ¨ä¿¡æ¯ï¼Œä»…åœ¨B+æ ‘çš„æ ¹é¡µå®šä¹‰</td></tr><tr><td><code>PAGE_BTR_SEG_TOP</code></td><td><code>10</code>å­—èŠ‚</td><td>B+æ ‘éå¶å­æ®µçš„å¤´éƒ¨ä¿¡æ¯ï¼Œä»…åœ¨B+æ ‘çš„æ ¹é¡µå®šä¹‰</td></tr></tbody></table><p>å…¶ä¸­çš„<code>PAGE_BTR_SEG_LEAF</code>å’Œ<code>PAGE_BTR_SEG_TOP</code>éƒ½å ç”¨10ä¸ªå­—èŠ‚ï¼Œå®ƒä»¬å…¶å®å¯¹åº”ä¸€ä¸ªå«<code>Segment Header</code>çš„ç»“æ„ï¼Œè¯¥ç»“æ„å›¾ç¤ºå¦‚ä¸‹ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f48c4472a3~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1d6a74gu41fuqcqm1htri771d1k16.png-65.1kB"><p>å„ä¸ªéƒ¨åˆ†çš„å…·ä½“é‡Šä¹‰å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åç§°</th><th>å ç”¨å­—èŠ‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>Space ID of the INODE Entry</code></td><td><code>4</code></td><td>INODE Entryç»“æ„æ‰€åœ¨çš„è¡¨ç©ºé—´ID</td></tr><tr><td><code>Page Number of the INODE Entry</code></td><td><code>4</code></td><td>INODE Entryç»“æ„æ‰€åœ¨çš„é¡µé¢é¡µå·</td></tr><tr><td><code>Byte Offset of the INODE Ent</code></td><td><code>2</code></td><td>INODE Entryç»“æ„åœ¨è¯¥é¡µé¢ä¸­çš„åç§»é‡</td></tr></tbody></table><p>è¿™æ ·å­å°±å¾ˆæ¸…æ™°äº†ï¼Œ<code>PAGE_BTR_SEG_LEAF</code>è®°å½•ç€å¶å­èŠ‚ç‚¹æ®µå¯¹åº”çš„<code>INODE Entry</code>ç»“æ„çš„åœ°å€æ˜¯å“ªä¸ªè¡¨ç©ºé—´çš„å“ªä¸ªé¡µé¢çš„å“ªä¸ªåç§»é‡ï¼Œ<code>PAGE_BTR_SEG_TOP</code>è®°å½•ç€éå¶å­èŠ‚ç‚¹æ®µå¯¹åº”çš„<code>INODE Entry</code>ç»“æ„çš„åœ°å€æ˜¯å“ªä¸ªè¡¨ç©ºé—´çš„å“ªä¸ªé¡µé¢çš„å“ªä¸ªåç§»é‡ã€‚è¿™æ ·å­ç´¢å¼•å’Œå…¶å¯¹åº”çš„æ®µçš„å…³ç³»å°±å»ºç«‹èµ·æ¥äº†ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå› ä¸ºä¸€ä¸ªç´¢å¼•åªå¯¹åº”ä¸¤ä¸ªæ®µï¼Œæ‰€ä»¥åªéœ€è¦åœ¨ç´¢å¼•çš„æ ¹é¡µé¢ä¸­è®°å½•è¿™ä¸¤ä¸ªç»“æ„å³å¯ã€‚</p><h3 id="çœŸå®è¡¨ç©ºé—´å¯¹åº”çš„æ–‡ä»¶å¤§å°">çœŸå®è¡¨ç©ºé—´å¯¹åº”çš„æ–‡ä»¶å¤§å°</h3><p>ç­‰ä¼šå„¿ç­‰ä¼šå„¿ï¼Œä¸Šè¾¹çš„è¿™äº›æ¦‚å¿µå·²ç»å‹çš„å¿«å–˜ä¸è¿‡æ°”äº†ã€‚ä¸è¿‡ç‹¬ç«‹è¡¨ç©ºé—´æœ‰é‚£ä¹ˆå¤§ä¹ˆï¼Ÿæˆ‘åˆ°æ•°æ®ç›®å½•é‡Œçœ‹äº†ï¼Œä¸€ä¸ªæ–°å»ºçš„è¡¨å¯¹åº”çš„<code>.ibd</code>æ–‡ä»¶åªå ç”¨äº†96Kï¼Œæ‰6ä¸ªé¡µé¢å¤§å°ï¼Œä¸Šè¾¹çš„å†…å®¹è¯¥ä¸æ˜¯æ‰¯çŠŠå­å§ï¼Ÿ</p><p>å“ˆï¼Œä¸€å¼€å§‹è¡¨ç©ºé—´å ç”¨çš„ç©ºé—´è‡ªç„¶æ˜¯å¾ˆå°ï¼Œå› ä¸ºè¡¨é‡Œè¾¹éƒ½æ²¡æœ‰æ•°æ®å˜›ï¼ä¸è¿‡åˆ«å¿˜äº†è¿™äº›<code>.ibd</code>æ–‡ä»¶æ˜¯è‡ªæ‰©å±•çš„ï¼Œéšç€è¡¨ä¸­æ•°æ®çš„å¢å¤šï¼Œè¡¨ç©ºé—´å¯¹åº”çš„æ–‡ä»¶ä¹Ÿé€æ¸å¢å¤§ã€‚</p><h2 id="ç³»ç»Ÿè¡¨ç©ºé—´">ç³»ç»Ÿè¡¨ç©ºé—´</h2><p>äº†è§£å®Œäº†ç‹¬ç«‹è¡¨ç©ºé—´çš„åŸºæœ¬ç»“æ„ï¼Œç³»ç»Ÿè¡¨ç©ºé—´çš„ç»“æ„ä¹Ÿå°±å¥½ç†è§£å¤šäº†ï¼Œç³»ç»Ÿè¡¨ç©ºé—´çš„ç»“æ„å’Œç‹¬ç«‹è¡¨ç©ºé—´åŸºæœ¬ç±»ä¼¼ï¼Œåªä¸è¿‡ç”±äºæ•´ä¸ªMySQLè¿›ç¨‹åªæœ‰ä¸€ä¸ªç³»ç»Ÿè¡¨ç©ºé—´ï¼Œåœ¨ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ä¼šé¢å¤–è®°å½•ä¸€äº›æœ‰å…³æ•´ä¸ªç³»ç»Ÿä¿¡æ¯çš„é¡µé¢ï¼Œæ‰€ä»¥ä¼šæ¯”ç‹¬ç«‹è¡¨ç©ºé—´å¤šå‡ºä¸€äº›è®°å½•è¿™äº›ä¿¡æ¯çš„é¡µé¢ã€‚å› ä¸ºè¿™ä¸ªç³»ç»Ÿè¡¨ç©ºé—´æœ€ç‰›é€¼ï¼Œç›¸å½“äºæ˜¯è¡¨ç©ºé—´ä¹‹é¦–ï¼Œæ‰€ä»¥å®ƒçš„<code>è¡¨ç©ºé—´ ID</code>ï¼ˆSpace IDï¼‰æ˜¯<code>0</code>ã€‚</p><h3 id="ç³»ç»Ÿè¡¨ç©ºé—´çš„æ•´ä½“ç»“æ„">ç³»ç»Ÿè¡¨ç©ºé—´çš„æ•´ä½“ç»“æ„</h3><p>ç³»ç»Ÿè¡¨ç©ºé—´ä¸ç‹¬ç«‹è¡¨ç©ºé—´çš„ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„ä¸åŒä¹‹å¤„å°±æ˜¯åœ¨è¡¨ç©ºé—´å¼€å¤´æœ‰è®¸å¤šè®°å½•æ•´ä¸ªç³»ç»Ÿå±æ€§çš„é¡µé¢ï¼Œå¦‚å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f4911220d8~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1csbied27ohe1rgg32gquulplm.png-147.4kB"><p>å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿè¡¨ç©ºé—´å’Œç‹¬ç«‹è¡¨ç©ºé—´çš„å‰ä¸‰ä¸ªé¡µé¢ï¼ˆé¡µå·åˆ†åˆ«ä¸º<code>0</code>ã€<code>1</code>ã€<code>2</code>ï¼Œç±»å‹åˆ†åˆ«æ˜¯<code>FSP_HDR</code>ã€<code>IBUF_BITMAP</code>ã€<code>INODE</code>ï¼‰çš„ç±»å‹æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯é¡µå·ä¸º<code>3</code>ï½<code>7</code>çš„é¡µé¢æ˜¯ç³»ç»Ÿè¡¨ç©ºé—´ç‰¹æœ‰çš„ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™äº›å¤šå‡ºæ¥çš„é¡µé¢éƒ½æ˜¯å¹²å•¥ä½¿çš„ï¼š</p><table><thead><tr><th>é¡µå·</th><th>é¡µé¢ç±»å‹</th><th>è‹±æ–‡æè¿°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>3</code></td><td><code>SYS</code></td><td>Insert Buffer Header</td><td>å­˜å‚¨Insert Bufferçš„å¤´éƒ¨ä¿¡æ¯</td></tr><tr><td><code>4</code></td><td><code>INDEX</code></td><td>Insert Buffer Root</td><td>å­˜å‚¨Insert Bufferçš„æ ¹é¡µé¢</td></tr><tr><td><code>5</code></td><td><code>TRX_SYS</code></td><td>Transction System</td><td>äº‹åŠ¡ç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯</td></tr><tr><td><code>6</code></td><td><code>SYS</code></td><td>First Rollback Segment</td><td>ç¬¬ä¸€ä¸ªå›æ»šæ®µçš„é¡µé¢</td></tr><tr><td><code>7</code></td><td><code>SYS</code></td><td>Data Dictionary Header</td><td>æ•°æ®å­—å…¸å¤´éƒ¨ä¿¡æ¯</td></tr></tbody></table><p>é™¤äº†è¿™å‡ ä¸ªè®°å½•ç³»ç»Ÿå±æ€§çš„é¡µé¢ä¹‹å¤–ï¼Œç³»ç»Ÿè¡¨ç©ºé—´çš„<code>extent 1</code>å’Œ<code>extent 2</code>è¿™ä¸¤ä¸ªåŒºï¼Œä¹Ÿå°±æ˜¯é¡µå·ä»<code>64</code>~<code>191</code>è¿™128ä¸ªé¡µé¢è¢«ç§°ä¸º<code>Doublewrite buffer</code>ï¼Œä¹Ÿå°±æ˜¯åŒå†™ç¼“å†²åŒºã€‚ä¸è¿‡ä¸Šè¿°çš„å¤§éƒ¨åˆ†çŸ¥è¯†éƒ½æ¶‰åŠåˆ°äº†äº‹åŠ¡å’Œå¤šç‰ˆæœ¬æ§åˆ¶çš„é—®é¢˜ï¼Œè¿™äº›é—®é¢˜æˆ‘ä»¬ä¼šæ”¾åœ¨åè¾¹çš„ç« èŠ‚é›†ä¸­å” å¨ï¼Œç°åœ¨è®²è¿°å¤ªå½±å“ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬åªå” å¨ä¸€ä¸‹æœ‰å…³InnoDBæ•°æ®å­—å…¸çš„çŸ¥è¯†ï¼Œå…¶ä½™çš„æ¦‚å¿µåœ¨åè¾¹å†çœ‹ã€‚</p><h4 id="InnoDBæ•°æ®å­—å…¸">InnoDBæ•°æ®å­—å…¸</h4><p>æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨<code>INSERT</code>è¯­å¥å‘è¡¨ä¸­æ’å…¥çš„é‚£äº›è®°å½•ç§°ä¹‹ä¸ºç”¨æˆ·æ•°æ®ï¼ŒMySQLåªæ˜¯ä½œä¸ºä¸€ä¸ªè½¯ä»¶æ¥ä¸ºæˆ‘ä»¬æ¥ä¿ç®¡è¿™äº›æ•°æ®ï¼Œæä¾›æ–¹ä¾¿çš„å¢åˆ æ”¹æŸ¥æ¥å£è€Œå·²ã€‚ä½†æ˜¯æ¯å½“æˆ‘ä»¬å‘ä¸€ä¸ªè¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼ŒMySQLå…ˆè¦æ ¡éªŒä¸€ä¸‹æ’å…¥è¯­å¥å¯¹åº”çš„è¡¨å­˜ä¸å­˜åœ¨ï¼Œæ’å…¥çš„åˆ—å’Œè¡¨ä¸­çš„åˆ—æ˜¯å¦ç¬¦åˆï¼Œå¦‚æœè¯­æ³•æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œè¿˜éœ€è¦çŸ¥é“è¯¥è¡¨çš„èšç°‡ç´¢å¼•å’Œæ‰€æœ‰äºŒçº§ç´¢å¼•å¯¹åº”çš„æ ¹é¡µé¢æ˜¯å“ªä¸ªè¡¨ç©ºé—´çš„å“ªä¸ªé¡µé¢ï¼Œç„¶åæŠŠè®°å½•æ’å…¥å¯¹åº”ç´¢å¼•çš„<code>B+</code>æ ‘ä¸­ã€‚æ‰€ä»¥è¯´ï¼ŒMySQLé™¤äº†ä¿å­˜ç€æˆ‘ä»¬æ’å…¥çš„ç”¨æˆ·æ•°æ®ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä¿å­˜è®¸å¤šé¢å¤–çš„ä¿¡æ¯ï¼Œæ¯”æ–¹è¯´ï¼š</p><ul><li>æŸä¸ªè¡¨å±äºå“ªä¸ªè¡¨ç©ºé—´ï¼Œè¡¨é‡Œè¾¹æœ‰å¤šå°‘åˆ—</li><li>è¡¨å¯¹åº”çš„æ¯ä¸€ä¸ªåˆ—çš„ç±»å‹æ˜¯ä»€ä¹ˆ</li><li>è¯¥è¡¨æœ‰å¤šå°‘ç´¢å¼•ï¼Œæ¯ä¸ªç´¢å¼•å¯¹åº”å“ªå‡ ä¸ªå­—æ®µï¼Œè¯¥ç´¢å¼•å¯¹åº”çš„æ ¹é¡µé¢åœ¨å“ªä¸ªè¡¨ç©ºé—´çš„å“ªä¸ªé¡µé¢</li><li>è¯¥è¡¨æœ‰å“ªäº›å¤–é”®ï¼Œå¤–é”®å¯¹åº”å“ªä¸ªè¡¨çš„å“ªäº›åˆ—</li><li>æŸä¸ªè¡¨ç©ºé—´å¯¹åº”æ–‡ä»¶ç³»ç»Ÿä¸Šæ–‡ä»¶è·¯å¾„æ˜¯ä»€ä¹ˆ</li><li>balabala â€¦ è¿˜æœ‰å¥½å¤šï¼Œä¸ä¸€ä¸€åˆ—ä¸¾äº†</li></ul><p>ä¸Šè¿°è¿™äº›æ•°æ®å¹¶ä¸æ˜¯æˆ‘ä»¬ä½¿ç”¨<code>INSERT</code>è¯­å¥æ’å…¥çš„ç”¨æˆ·æ•°æ®ï¼Œå®é™…ä¸Šæ˜¯ä¸ºäº†æ›´å¥½çš„ç®¡ç†æˆ‘ä»¬è¿™äº›ç”¨æˆ·æ•°æ®è€Œä¸å¾—å·²å¼•å…¥çš„ä¸€äº›é¢å¤–æ•°æ®ï¼Œè¿™äº›æ•°æ®ä¹Ÿç§°ä¸º<code>å…ƒæ•°æ®</code>ã€‚InnoDBå­˜å‚¨å¼•æ“ç‰¹æ„å®šä¹‰äº†ä¸€äº›åˆ—çš„å†…éƒ¨ç³»ç»Ÿè¡¨ï¼ˆinternal system tableï¼‰æ¥è®°å½•è¿™äº›è¿™äº›<code>å…ƒæ•°æ®</code>ï¼š</p><table><thead><tr><th>è¡¨å</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>SYS_TABLES</code></td><td>æ•´ä¸ªInnoDBå­˜å‚¨å¼•æ“ä¸­æ‰€æœ‰çš„è¡¨çš„ä¿¡æ¯</td></tr><tr><td><code>SYS_COLUMNS</code></td><td>æ•´ä¸ªInnoDBå­˜å‚¨å¼•æ“ä¸­æ‰€æœ‰çš„åˆ—çš„ä¿¡æ¯</td></tr><tr><td><code>SYS_INDEXES</code></td><td>æ•´ä¸ªInnoDBå­˜å‚¨å¼•æ“ä¸­æ‰€æœ‰çš„ç´¢å¼•çš„ä¿¡æ¯</td></tr><tr><td><code>SYS_FIELDS</code></td><td>æ•´ä¸ªInnoDBå­˜å‚¨å¼•æ“ä¸­æ‰€æœ‰çš„ç´¢å¼•å¯¹åº”çš„åˆ—çš„ä¿¡æ¯</td></tr><tr><td><code>SYS_FOREIGN</code></td><td>æ•´ä¸ªInnoDBå­˜å‚¨å¼•æ“ä¸­æ‰€æœ‰çš„å¤–é”®çš„ä¿¡æ¯</td></tr><tr><td><code>SYS_FOREIGN_COLS</code></td><td>æ•´ä¸ªInnoDBå­˜å‚¨å¼•æ“ä¸­æ‰€æœ‰çš„å¤–é”®å¯¹åº”åˆ—çš„ä¿¡æ¯</td></tr><tr><td><code>SYS_TABLESPACES</code></td><td>æ•´ä¸ªInnoDBå­˜å‚¨å¼•æ“ä¸­æ‰€æœ‰çš„è¡¨ç©ºé—´ä¿¡æ¯</td></tr><tr><td><code>SYS_DATAFILES</code></td><td>æ•´ä¸ªInnoDBå­˜å‚¨å¼•æ“ä¸­æ‰€æœ‰çš„è¡¨ç©ºé—´å¯¹åº”æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶è·¯å¾„ä¿¡æ¯</td></tr><tr><td><code>SYS_VIRTUAL</code></td><td>æ•´ä¸ªInnoDBå­˜å‚¨å¼•æ“ä¸­æ‰€æœ‰çš„è™šæ‹Ÿç”Ÿæˆåˆ—çš„ä¿¡æ¯</td></tr></tbody></table><p>è¿™äº›ç³»ç»Ÿè¡¨ä¹Ÿè¢«ç§°ä¸º<code>æ•°æ®å­—å…¸</code>ï¼Œå®ƒä»¬éƒ½æ˜¯ä»¥<code>B+</code>æ ‘çš„å½¢å¼ä¿å­˜åœ¨ç³»ç»Ÿè¡¨ç©ºé—´çš„æŸäº›é¡µé¢ä¸­ï¼Œå…¶ä¸­<code>SYS_TABLES</code>ã€<code>SYS_COLUMNS</code>ã€<code>SYS_INDEXES</code>ã€<code>SYS_FIELDS</code>è¿™å››ä¸ªè¡¨å°¤å…¶é‡è¦ï¼Œç§°ä¹‹ä¸ºåŸºæœ¬ç³»ç»Ÿè¡¨ï¼ˆbasic system tablesï¼‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹è¿™4ä¸ªè¡¨çš„ç»“æ„ï¼š</p><h5 id="SYS-TABLESè¡¨">SYS_TABLESè¡¨</h5><p><strong>SYS_TABLESè¡¨çš„åˆ—</strong></p><table><thead><tr><th>åˆ—å</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>NAME</code></td><td>è¡¨çš„åç§°</td></tr><tr><td><code>ID</code></td><td>InnoDBå­˜å‚¨å¼•æ“ä¸­æ¯ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ID</td></tr><tr><td><code>N_COLS</code></td><td>è¯¥è¡¨æ‹¥æœ‰åˆ—çš„ä¸ªæ•°</td></tr><tr><td><code>TYPE</code></td><td>è¡¨çš„ç±»å‹ï¼Œè®°å½•äº†ä¸€äº›æ–‡ä»¶æ ¼å¼ã€è¡Œæ ¼å¼ã€å‹ç¼©ç­‰ä¿¡æ¯</td></tr><tr><td><code>MIX_ID</code></td><td>å·²è¿‡æ—¶ï¼Œå¿½ç•¥</td></tr><tr><td><code>MIX_LEN</code></td><td>è¡¨çš„ä¸€äº›é¢å¤–çš„å±æ€§</td></tr><tr><td><code>CLUSTER_ID</code></td><td>æœªä½¿ç”¨ï¼Œå¿½ç•¥</td></tr><tr><td><code>SPACE</code></td><td>è¯¥è¡¨æ‰€å±è¡¨ç©ºé—´çš„ID</td></tr></tbody></table><p>è¿™ä¸ª<code>SYS_TABLES</code>è¡¨æœ‰ä¸¤ä¸ªç´¢å¼•ï¼š</p><ul><li>ä»¥<code>NAME</code>åˆ—ä¸ºä¸»é”®çš„èšç°‡ç´¢å¼•</li><li>ä»¥<code>ID</code>åˆ—å»ºç«‹çš„äºŒçº§ç´¢å¼•</li></ul><h5 id="SYS-COLUMNSè¡¨">SYS_COLUMNSè¡¨</h5><p><strong>SYS_COLUMNSè¡¨çš„åˆ—</strong></p><table><thead><tr><th>åˆ—å</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>TABLE_ID</code></td><td>è¯¥åˆ—æ‰€å±è¡¨å¯¹åº”çš„ID</td></tr><tr><td><code>POS</code></td><td>è¯¥åˆ—åœ¨è¡¨ä¸­æ˜¯ç¬¬å‡ åˆ—</td></tr><tr><td><code>NAME</code></td><td>è¯¥åˆ—çš„åç§°</td></tr><tr><td><code>MTYPE</code></td><td>main data typeï¼Œä¸»æ•°æ®ç±»å‹ï¼Œå°±æ˜¯é‚£å †INTã€CHARã€VARCHARã€FLOATã€DOUBLEä¹‹ç±»çš„ä¸œä¸œ</td></tr><tr><td><code>PRTYPE</code></td><td>precise typeï¼Œç²¾ç¡®æ•°æ®ç±»å‹ï¼Œå°±æ˜¯ä¿®é¥°ä¸»æ•°æ®ç±»å‹çš„é‚£å †ä¸œä¸œï¼Œæ¯”å¦‚æ˜¯å¦å…è®¸NULLå€¼ï¼Œæ˜¯å¦å…è®¸è´Ÿæ•°å•¥çš„</td></tr><tr><td><code>LEN</code></td><td>è¯¥åˆ—æœ€å¤šå ç”¨å­˜å‚¨ç©ºé—´çš„å­—èŠ‚æ•°</td></tr><tr><td><code>PREC</code></td><td>è¯¥åˆ—çš„ç²¾åº¦ï¼Œä¸è¿‡è¿™åˆ—è²Œä¼¼éƒ½æ²¡æœ‰ä½¿ç”¨ï¼Œé»˜è®¤å€¼éƒ½æ˜¯0</td></tr></tbody></table><p>è¿™ä¸ª<code>SYS_COLUMNS</code>è¡¨åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼š</p><ul><li>ä»¥<code>(TABLE_ID, POS)</code>åˆ—ä¸ºä¸»é”®çš„èšç°‡ç´¢å¼•</li></ul><h5 id="SYS-INDEXESè¡¨">SYS_INDEXESè¡¨</h5><p><strong>SYS_INDEXESè¡¨çš„åˆ—</strong></p><table><thead><tr><th>åˆ—å</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>TABLE_ID</code></td><td>è¯¥ç´¢å¼•æ‰€å±è¡¨å¯¹åº”çš„ID</td></tr><tr><td><code>ID</code></td><td>InnoDBå­˜å‚¨å¼•æ“ä¸­æ¯ä¸ªç´¢å¼•éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ID</td></tr><tr><td><code>NAME</code></td><td>è¯¥ç´¢å¼•çš„åç§°</td></tr><tr><td><code>N_FIELDS</code></td><td>è¯¥ç´¢å¼•åŒ…å«åˆ—çš„ä¸ªæ•°</td></tr><tr><td><code>TYPE</code></td><td>è¯¥ç´¢å¼•çš„ç±»å‹ï¼Œæ¯”å¦‚èšç°‡ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ›´æ”¹ç¼“å†²åŒºçš„ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ã€æ™®é€šçš„äºŒçº§ç´¢å¼•ç­‰ç­‰å„ç§ç±»å‹</td></tr><tr><td><code>SPACE</code></td><td>è¯¥ç´¢å¼•æ ¹é¡µé¢æ‰€åœ¨çš„è¡¨ç©ºé—´ID</td></tr><tr><td><code>PAGE_NO</code></td><td>è¯¥ç´¢å¼•æ ¹é¡µé¢æ‰€åœ¨çš„é¡µé¢å·</td></tr><tr><td><code>MERGE_THRESHOLD</code></td><td>å¦‚æœé¡µé¢ä¸­çš„è®°å½•è¢«åˆ é™¤åˆ°æŸä¸ªæ¯”ä¾‹ï¼Œå°±æŠŠè¯¥é¡µé¢å’Œç›¸é‚»é¡µé¢åˆå¹¶ï¼Œè¿™ä¸ªå€¼å°±æ˜¯è¿™ä¸ªæ¯”ä¾‹</td></tr></tbody></table><p>è¿™ä¸ª<code>SYS_INDEXES</code>è¡¨åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼š</p><ul><li>ä»¥<code>(TABLE_ID, ID)</code>åˆ—ä¸ºä¸»é”®çš„èšç°‡ç´¢å¼•</li></ul><h5 id="SYS-FIELDSè¡¨">SYS_FIELDSè¡¨</h5><p><strong>SYS_FIELDSè¡¨çš„åˆ—</strong></p><table><thead><tr><th>åˆ—å</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>INDEX_ID</code></td><td>è¯¥ç´¢å¼•åˆ—æ‰€å±çš„ç´¢å¼•çš„ID</td></tr><tr><td><code>POS</code></td><td>è¯¥ç´¢å¼•åˆ—åœ¨æŸä¸ªç´¢å¼•ä¸­æ˜¯ç¬¬å‡ åˆ—</td></tr><tr><td><code>COL_NAME</code></td><td>è¯¥ç´¢å¼•åˆ—çš„åç§°</td></tr></tbody></table><p>è¿™ä¸ª<code>SYS_FIELDS</code>è¡¨åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼š</p><ul><li>ä»¥<code>(INDEX_ID, POS)</code>åˆ—ä¸ºä¸»é”®çš„èšç°‡ç´¢å¼•</li></ul><h5 id="Data-Dictionary-Headeré¡µé¢">Data Dictionary Headeré¡µé¢</h5><p>åªè¦æœ‰äº†ä¸Šè¿°4ä¸ªåŸºæœ¬ç³»ç»Ÿè¡¨ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥è·å–å…¶ä»–ç³»ç»Ÿè¡¨ä»¥åŠç”¨æˆ·å®šä¹‰çš„è¡¨çš„æ‰€æœ‰å…ƒæ•°æ®ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³çœ‹çœ‹<code>SYS_TABLESPACES</code>è¿™ä¸ªç³»ç»Ÿè¡¨é‡Œå­˜å‚¨äº†å“ªäº›è¡¨ç©ºé—´ä»¥åŠè¡¨ç©ºé—´å¯¹åº”çš„å±æ€§ï¼Œé‚£å°±å¯ä»¥ï¼š</p><ul><li>åˆ°<code>SYS_TABLES</code>è¡¨ä¸­æ ¹æ®è¡¨åå®šä½åˆ°å…·ä½“çš„è®°å½•ï¼Œå°±å¯ä»¥è·å–åˆ°<code>SYS_TABLESPACES</code>è¡¨çš„<code>TABLE_ID</code></li><li>ä½¿ç”¨è¿™ä¸ª<code>TABLE_ID</code>åˆ°<code>SYS_COLUMNS</code>è¡¨ä¸­å°±å¯ä»¥è·å–åˆ°å±äºè¯¥è¡¨çš„æ‰€æœ‰åˆ—çš„ä¿¡æ¯ã€‚</li><li>ä½¿ç”¨è¿™ä¸ª<code>TABLE_ID</code>è¿˜å¯ä»¥åˆ°<code>SYS_INDEXES</code>è¡¨ä¸­è·å–æ‰€æœ‰çš„ç´¢å¼•çš„ä¿¡æ¯ï¼Œç´¢å¼•çš„ä¿¡æ¯ä¸­åŒ…æ‹¬å¯¹åº”çš„<code>INDEX_ID</code>ï¼Œè¿˜è®°å½•ç€è¯¥ç´¢å¼•å¯¹åº”çš„<code>B+</code>æ•°æ ¹é¡µé¢æ˜¯å“ªä¸ªè¡¨ç©ºé—´çš„å“ªä¸ªé¡µé¢ã€‚</li><li>ä½¿ç”¨<code>INDEX_ID</code>å°±å¯ä»¥åˆ°<code>SYS_FIELDS</code>è¡¨ä¸­è·å–æ‰€æœ‰ç´¢å¼•åˆ—çš„ä¿¡æ¯ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´è¿™4ä¸ªè¡¨æ˜¯è¡¨ä¸­ä¹‹è¡¨ï¼Œé‚£è¿™4ä¸ªè¡¨çš„å…ƒæ•°æ®å»å“ªé‡Œè·å–å‘¢ï¼Ÿæ²¡æ³•æäº†ï¼Œåªèƒ½æŠŠè¿™4ä¸ªè¡¨çš„å…ƒæ•°æ®ï¼Œå°±æ˜¯å®ƒä»¬æœ‰å“ªäº›åˆ—ã€å“ªäº›ç´¢å¼•ç­‰ä¿¡æ¯ç¡¬ç¼–ç åˆ°ä»£ç ä¸­ï¼Œç„¶åè®¾è®¡<code>InnoDB</code>çš„å¤§å”åˆæ‹¿å‡ºä¸€ä¸ªå›ºå®šçš„é¡µé¢æ¥è®°å½•è¿™4ä¸ªè¡¨çš„èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•å¯¹åº”çš„<code>B+æ ‘</code>ä½ç½®ï¼Œè¿™ä¸ªé¡µé¢å°±æ˜¯é¡µå·ä¸º<code>7</code>çš„é¡µé¢ï¼Œç±»å‹ä¸º<code>SYS</code>ï¼Œè®°å½•äº†<code>Data Dictionary Header</code>ï¼Œä¹Ÿå°±æ˜¯æ•°æ®å­—å…¸çš„å¤´éƒ¨ä¿¡æ¯ã€‚é™¤äº†è¿™4ä¸ªè¡¨çš„5ä¸ªç´¢å¼•çš„æ ¹é¡µé¢ä¿¡æ¯å¤–ï¼Œè¿™ä¸ªé¡µå·ä¸º<code>7</code>çš„é¡µé¢è¿˜è®°å½•äº†æ•´ä¸ªInnoDBå­˜å‚¨å¼•æ“çš„ä¸€äº›å…¨å±€å±æ€§ï¼Œè¯´è¯å¤ªå•°å—¦ï¼Œç›´æ¥çœ‹è¿™ä¸ªé¡µé¢çš„ç¤ºæ„å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16efe1e5a01aeac9~tplv-t2oaga2asx-watermark.awebp" class="" title="img"><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡µé¢ç”±ä¸‹è¾¹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><table><thead><tr><th>åç§°</th><th>ä¸­æ–‡å</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>ç®€å•æè¿°</th></tr></thead><tbody><tr><td><code>File Header</code></td><td>æ–‡ä»¶å¤´éƒ¨</td><td><code>38</code>å­—èŠ‚</td><td>é¡µçš„ä¸€äº›é€šç”¨ä¿¡æ¯</td></tr><tr><td><code>Data Dictionary Header</code></td><td>æ•°æ®å­—å…¸å¤´éƒ¨ä¿¡æ¯</td><td><code>56</code>å­—èŠ‚</td><td>è®°å½•ä¸€äº›åŸºæœ¬ç³»ç»Ÿè¡¨çš„æ ¹é¡µé¢ä½ç½®ä»¥åŠInnoDBå­˜å‚¨å¼•æ“çš„ä¸€äº›å…¨å±€ä¿¡æ¯</td></tr><tr><td><code>Segment Header</code></td><td>æ®µå¤´éƒ¨ä¿¡æ¯</td><td><code>10</code>å­—èŠ‚</td><td>è®°å½•æœ¬é¡µé¢æ‰€åœ¨æ®µå¯¹åº”çš„INODE Entryä½ç½®ä¿¡æ¯</td></tr><tr><td><code>Empty Space</code></td><td>å°šæœªä½¿ç”¨ç©ºé—´</td><td><code>16272</code>å­—èŠ‚</td><td>ç”¨äºé¡µç»“æ„çš„å¡«å……ï¼Œæ²¡å•¥å®é™…æ„ä¹‰</td></tr><tr><td><code>File Trailer</code></td><td>æ–‡ä»¶å°¾éƒ¨</td><td><code>8</code>å­—èŠ‚</td><td>æ ¡éªŒé¡µæ˜¯å¦å®Œæ•´</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡µé¢é‡Œç«Ÿç„¶æœ‰<code>Segment Header</code>éƒ¨åˆ†ï¼Œæ„å‘³ç€è®¾è®¡InnoDBçš„å¤§å”æŠŠè¿™äº›æœ‰å…³æ•°æ®å­—å…¸çš„ä¿¡æ¯å½“æˆä¸€ä¸ªæ®µæ¥åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œæˆ‘ä»¬å°±å§‘ä¸”ç§°ä¹‹ä¸º<code>æ•°æ®å­—å…¸æ®µ</code>å§ã€‚ç”±äºç›®å‰æˆ‘ä»¬éœ€è¦è®°å½•çš„æ•°æ®å­—å…¸ä¿¡æ¯éå¸¸å°‘ï¼ˆå¯ä»¥çœ‹åˆ°<code>Data Dictionary Header</code>éƒ¨åˆ†ä»…å ç”¨äº†56å­—èŠ‚ï¼‰ï¼Œæ‰€ä»¥è¯¥æ®µåªæœ‰ä¸€ä¸ªç¢ç‰‡é¡µï¼Œä¹Ÿå°±æ˜¯é¡µå·ä¸º<code>7</code>çš„è¿™ä¸ªé¡µã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç»†ç»†å” å¨ä¸€ä¸‹<code>Data Dictionary Header</code>éƒ¨åˆ†çš„å„ä¸ªå­—æ®µï¼š</p><ul><li><code>Max Row ID</code>ï¼šæˆ‘ä»¬è¯´è¿‡å¦‚æœæˆ‘ä»¬ä¸æ˜¾å¼çš„ä¸ºè¡¨å®šä¹‰ä¸»é”®ï¼Œè€Œä¸”è¡¨ä¸­ä¹Ÿæ²¡æœ‰<code>UNIQUE</code>ç´¢å¼•ï¼Œé‚£ä¹ˆ<code>InnoDB</code>å­˜å‚¨å¼•æ“ä¼šé»˜è®¤ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªåä¸º<code>row_id</code>çš„åˆ—ä½œä¸ºä¸»é”®ã€‚å› ä¸ºå®ƒæ˜¯ä¸»é”®ï¼Œæ‰€ä»¥æ¯æ¡è®°å½•çš„<code>row_id</code>åˆ—çš„å€¼ä¸èƒ½é‡å¤ã€‚åŸåˆ™ä¸Šåªè¦ä¸€ä¸ªè¡¨ä¸­çš„<code>row_id</code>åˆ—ä¸é‡å¤å°±å¯ä»¥äº†ï¼Œä¹Ÿå°±æ˜¯è¯´è¡¨aå’Œè¡¨bæ‹¥æœ‰ä¸€æ ·çš„<code>row_id</code>åˆ—ä¹Ÿæ²¡å•¥å…³ç³»ï¼Œä¸è¿‡è®¾è®¡InnoDBçš„å¤§å”åªæä¾›äº†è¿™ä¸ª<code>Max Row ID</code>å­—æ®µï¼Œä¸è®ºå“ªä¸ªæ‹¥æœ‰<code>row_id</code>åˆ—çš„è¡¨æ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼Œè¯¥è®°å½•çš„<code>row_id</code>åˆ—çš„å€¼å°±æ˜¯<code>Max Row ID</code>å¯¹åº”çš„å€¼ï¼Œç„¶åå†æŠŠ<code>Max Row ID</code>å¯¹åº”çš„å€¼åŠ 1ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ª<code>Max Row ID</code>æ˜¯å…¨å±€å…±äº«çš„ã€‚</li><li><code>Max Table ID</code>ï¼šInnoDBå­˜å‚¨å¼•æ“ä¸­çš„æ‰€æœ‰çš„è¡¨éƒ½å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œæ¯æ¬¡æ–°å»ºä¸€ä¸ªè¡¨æ—¶ï¼Œå°±ä¼šæŠŠæœ¬å­—æ®µçš„å€¼ä½œä¸ºè¯¥è¡¨çš„IDï¼Œç„¶åè‡ªå¢æœ¬å­—æ®µçš„å€¼ã€‚</li><li><code>Max Index ID</code>ï¼šInnoDBå­˜å‚¨å¼•æ“ä¸­çš„æ‰€æœ‰çš„ç´¢å¼•éƒ½å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œæ¯æ¬¡æ–°å»ºä¸€ä¸ªç´¢å¼•æ—¶ï¼Œå°±ä¼šæŠŠæœ¬å­—æ®µçš„å€¼ä½œä¸ºè¯¥ç´¢å¼•çš„IDï¼Œç„¶åè‡ªå¢æœ¬å­—æ®µçš„å€¼ã€‚</li><li><code>Max Space ID</code>ï¼šInnoDBå­˜å‚¨å¼•æ“ä¸­çš„æ‰€æœ‰çš„è¡¨ç©ºé—´éƒ½å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œæ¯æ¬¡æ–°å»ºä¸€ä¸ªè¡¨ç©ºé—´æ—¶ï¼Œå°±ä¼šæŠŠæœ¬å­—æ®µçš„å€¼ä½œä¸ºè¯¥è¡¨ç©ºé—´çš„IDï¼Œç„¶åè‡ªå¢æœ¬å­—æ®µçš„å€¼ã€‚</li><li><code>Mix ID Low(Unused)</code>ï¼šè¿™ä¸ªå­—æ®µæ²¡å•¥ç”¨ï¼Œè·³è¿‡ã€‚</li><li><code>Root of SYS_TABLES clust index</code>ï¼šæœ¬å­—æ®µä»£è¡¨<code>SYS_TABLES</code>è¡¨èšç°‡ç´¢å¼•çš„æ ¹é¡µé¢çš„é¡µå·ã€‚</li><li><code>Root of SYS_TABLE_IDS sec index</code>ï¼šæœ¬å­—æ®µä»£è¡¨<code>SYS_TABLES</code>è¡¨ä¸º<code>ID</code>åˆ—å»ºç«‹çš„äºŒçº§ç´¢å¼•çš„æ ¹é¡µé¢çš„é¡µå·ã€‚</li><li><code>Root of SYS_COLUMNS clust index</code>ï¼šæœ¬å­—æ®µä»£è¡¨<code>SYS_COLUMNS</code>è¡¨èšç°‡ç´¢å¼•çš„æ ¹é¡µé¢çš„é¡µå·ã€‚</li><li><code>Root of SYS_INDEXES clust index</code>æœ¬å­—æ®µä»£è¡¨<code>SYS_INDEXES</code>è¡¨èšç°‡ç´¢å¼•çš„æ ¹é¡µé¢çš„é¡µå·ã€‚</li><li><code>Root of SYS_FIELDS clust index</code>ï¼šæœ¬å­—æ®µä»£è¡¨<code>SYS_FIELDS</code>è¡¨èšç°‡ç´¢å¼•çš„æ ¹é¡µé¢çš„é¡µå·ã€‚</li><li><code>Unused</code>ï¼šè¿™4ä¸ªå­—èŠ‚æ²¡ç”¨ï¼Œè·³è¿‡ã€‚</li></ul><p>ä»¥ä¸Šå°±æ˜¯é¡µå·ä¸º<code>7</code>çš„é¡µé¢çš„å…¨éƒ¨å†…å®¹ï¼Œåˆæ¬¡çœ‹å¯èƒ½ä¼šæ‡µé€¼ï¼ˆå› ä¸ºæœ‰ç‚¹å„¿ç»•ï¼‰ï¼Œå¤§å®¶å¤šç…å‡ æ¬¡ã€‚</p><h5 id="information-schemaç³»ç»Ÿæ•°æ®åº“">information_schemaç³»ç»Ÿæ•°æ®åº“</h5><p>éœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œç”¨æˆ·æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®<code>InnoDB</code>çš„è¿™äº›å†…éƒ¨ç³»ç»Ÿè¡¨çš„ï¼Œé™¤éä½ ç›´æ¥å»è§£æç³»ç»Ÿè¡¨ç©ºé—´å¯¹åº”æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚ä¸è¿‡è®¾è®¡InnoDBçš„å¤§å”è€ƒè™‘åˆ°æŸ¥çœ‹è¿™äº›è¡¨çš„å†…å®¹å¯èƒ½æœ‰åŠ©äºå¤§å®¶åˆ†æé—®é¢˜ï¼Œæ‰€ä»¥åœ¨ç³»ç»Ÿæ•°æ®åº“<code>information_schema</code>ä¸­æä¾›äº†ä¸€äº›ä»¥<code>innodb_sys</code>å¼€å¤´çš„è¡¨ï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; USE information_schema;<br>Database changed<br><br>mysql&gt; SHOW TABLES LIKE &#x27;innodb_sys%&#x27;;<br>+--------------------------------------------+<br>|<span class="hljs-string"> Tables_in_information_schema (innodb_sys%) </span>|<br>+--------------------------------------------+<br>|<span class="hljs-string"> INNODB_SYS_DATAFILES                       </span>|<br>|<span class="hljs-string"> INNODB_SYS_VIRTUAL                         </span>|<br>|<span class="hljs-string"> INNODB_SYS_INDEXES                         </span>|<br>|<span class="hljs-string"> INNODB_SYS_TABLES                          </span>|<br>|<span class="hljs-string"> INNODB_SYS_FIELDS                          </span>|<br>|<span class="hljs-string"> INNODB_SYS_TABLESPACES                     </span>|<br>|<span class="hljs-string"> INNODB_SYS_FOREIGN_COLS                    </span>|<br>|<span class="hljs-string"> INNODB_SYS_COLUMNS                         </span>|<br>|<span class="hljs-string"> INNODB_SYS_FOREIGN                         </span>|<br>|<span class="hljs-string"> INNODB_SYS_TABLESTATS                      </span>|<br>+--------------------------------------------+<br>10 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>åœ¨<code>information_schema</code>æ•°æ®åº“ä¸­çš„è¿™äº›ä»¥<code>INNODB_SYS</code>å¼€å¤´çš„è¡¨å¹¶ä¸æ˜¯çœŸæ­£çš„å†…éƒ¨ç³»ç»Ÿè¡¨ï¼ˆå†…éƒ¨ç³»ç»Ÿè¡¨å°±æ˜¯æˆ‘ä»¬ä¸Šè¾¹å” å¨çš„ä»¥<code>SYS</code>å¼€å¤´çš„é‚£äº›è¡¨ï¼‰ï¼Œè€Œæ˜¯åœ¨å­˜å‚¨å¼•æ“å¯åŠ¨æ—¶è¯»å–è¿™äº›ä»¥<code>SYS</code>å¼€å¤´çš„ç³»ç»Ÿè¡¨ï¼Œç„¶åå¡«å……åˆ°è¿™äº›ä»¥<code>INNODB_SYS</code>å¼€å¤´çš„è¡¨ä¸­ã€‚ä»¥<code>INNODB_SYS</code>å¼€å¤´çš„è¡¨å’Œä»¥<code>SYS</code>å¼€å¤´çš„è¡¨ä¸­çš„å­—æ®µå¹¶ä¸å®Œå…¨ä¸€æ ·ï¼Œä½†ä¾›å¤§å®¶å‚è€ƒå·²ç»è¶³çŸ£ã€‚è¿™äº›è¡¨å¤ªå¤šäº†ï¼Œæˆ‘å°±ä¸å” å¨äº†ï¼Œå¤§å®¶è‡ªä¸ªå„¿åŠ¨æ‰‹è¯•ç€æŸ¥ä¸€æŸ¥è¿™äº›è¡¨ä¸­çš„æ•°æ®å§å“ˆï½</p><h3 id="æ€»ç»“å›¾">æ€»ç»“å›¾</h3><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a739f4a99c9a08~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1d9ppsbelendcbb13hghhn18pe9.png-3564.2kB"><h1>10.å•è¡¨è®¿é—®æ–¹æ³•</h1><p>å¯¹äºæˆ‘ä»¬è¿™äº›<code>MySQL</code>çš„ä½¿ç”¨è€…æ¥è¯´ï¼Œ<code>MySQL</code>å…¶å®å°±æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼Œå¹³æ—¶ç”¨çš„æœ€å¤šçš„å°±æ˜¯æŸ¥è¯¢åŠŸèƒ½ã€‚DBAæ—¶ä¸æ—¶ä¸¢è¿‡æ¥ä¸€äº›æ…¢æŸ¥è¯¢è¯­å¥è®©ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¦‚æœè¿æŸ¥è¯¢æ˜¯æ€ä¹ˆæ‰§è¡Œçš„éƒ½ä¸æ¸…æ¥šè¿˜ä¼˜åŒ–ä¸ªæ¯›çº¿ï¼Œæ‰€ä»¥æ˜¯æ—¶å€™æŒæ¡çœŸæ­£çš„æŠ€æœ¯äº†ã€‚æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« çš„æ—¶å€™å°±æ›¾è¯´è¿‡ï¼Œ<code>MySQL Server</code>æœ‰ä¸€ä¸ªç§°ä¸º<code>æŸ¥è¯¢ä¼˜åŒ–å™¨</code>çš„æ¨¡å—ï¼Œä¸€æ¡æŸ¥è¯¢è¯­å¥è¿›è¡Œè¯­æ³•è§£æä¹‹åå°±ä¼šè¢«äº¤ç»™æŸ¥è¯¢ä¼˜åŒ–å™¨æ¥è¿›è¡Œä¼˜åŒ–ï¼Œä¼˜åŒ–çš„ç»“æœå°±æ˜¯ç”Ÿæˆä¸€ä¸ªæ‰€è°“çš„<code>æ‰§è¡Œè®¡åˆ’</code>ï¼Œè¿™ä¸ªæ‰§è¡Œè®¡åˆ’è¡¨æ˜äº†åº”è¯¥ä½¿ç”¨å“ªäº›ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œè¡¨ä¹‹é—´çš„è¿æ¥é¡ºåºæ˜¯å•¥æ ·çš„ï¼Œæœ€åä¼šæŒ‰ç…§æ‰§è¡Œè®¡åˆ’ä¸­çš„æ­¥éª¤è°ƒç”¨å­˜å‚¨å¼•æ“æä¾›çš„æ–¹æ³•æ¥çœŸæ­£çš„æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚ä¸è¿‡æŸ¥è¯¢ä¼˜åŒ–è¿™ä¸ªä¸»é¢˜æœ‰ç‚¹å„¿å¤§ï¼Œåœ¨å­¦ä¼šè·‘ä¹‹å‰è¿˜å¾—å…ˆå­¦ä¼šèµ°ï¼Œæ‰€ä»¥æœ¬ç« å…ˆæ¥ç…ç…<code>MySQL</code>æ€ä¹ˆæ‰§è¡Œå•è¡¨æŸ¥è¯¢ï¼ˆå°±æ˜¯<code>FROM</code>å­å¥åè¾¹åªæœ‰ä¸€ä¸ªè¡¨ï¼Œæœ€ç®€å•çš„é‚£ç§æŸ¥è¯¢ï½ï¼‰ã€‚ä¸è¿‡éœ€è¦å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨å­¦ä¹ æœ¬ç« å‰åŠ¡å¿…çœ‹è¿‡å‰è¾¹å…³äºè®°å½•ç»“æ„ã€æ•°æ®é¡µç»“æ„ä»¥åŠç´¢å¼•çš„éƒ¨åˆ†ï¼Œå¦‚æœä½ ä¸èƒ½ä¿è¯è¿™äº›ä¸œè¥¿å·²ç»å®Œå…¨æŒæ¡ï¼Œé‚£ä¹ˆæœ¬ç« ä¸é€‚åˆä½ ã€‚</p><p>ä¸ºäº†æ•…äº‹çš„é¡ºåˆ©å‘å±•ï¼Œæˆ‘ä»¬å…ˆå¾—æœ‰ä¸ªè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> single_table (<br>    id <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    key1 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    key2 <span class="hljs-type">INT</span>,<br>    key3 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    key_part1 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    key_part2 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    key_part3 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    common_field <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    <span class="hljs-keyword">PRIMARY</span> KEY (id),<br>    KEY idx_key1 (key1),<br>    <span class="hljs-keyword">UNIQUE</span> KEY idx_key2 (key2),<br>    KEY idx_key3 (key3),<br>    KEY idx_key_part(key_part1, key_part2, key_part3)<br>) Engine<span class="hljs-operator">=</span>InnoDB CHARSET<span class="hljs-operator">=</span>utf8;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸ºè¿™ä¸ª<code>single_table</code>è¡¨å»ºç«‹äº†1ä¸ªèšç°‡ç´¢å¼•å’Œ4ä¸ªäºŒçº§ç´¢å¼•ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>ä¸º<code>id</code>åˆ—å»ºç«‹çš„èšç°‡ç´¢å¼•ã€‚</li><li>ä¸º<code>key1</code>åˆ—å»ºç«‹çš„<code>idx_key1</code>äºŒçº§ç´¢å¼•ã€‚</li><li>ä¸º<code>key2</code>åˆ—å»ºç«‹çš„<code>idx_key2</code>äºŒçº§ç´¢å¼•ï¼Œè€Œä¸”è¯¥ç´¢å¼•æ˜¯å”¯ä¸€äºŒçº§ç´¢å¼•ã€‚</li><li>ä¸º<code>key3</code>åˆ—å»ºç«‹çš„<code>idx_key3</code>äºŒçº§ç´¢å¼•ã€‚</li><li>ä¸º<code>key_part1</code>ã€<code>key_part2</code>ã€<code>key_part3</code>åˆ—å»ºç«‹çš„<code>idx_key_part</code>äºŒçº§ç´¢å¼•ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªè”åˆç´¢å¼•ã€‚</li></ul><p>ç„¶åæˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ªè¡¨æ’å…¥10000è¡Œè®°å½•ï¼Œé™¤<code>id</code>åˆ—å¤–å…¶ä½™çš„åˆ—éƒ½æ’å…¥éšæœºå€¼å°±å¥½äº†ï¼Œå…·ä½“çš„æ’å…¥è¯­å¥æˆ‘å°±ä¸å†™äº†ï¼Œè‡ªå·±å†™ä¸ªç¨‹åºæ’å…¥å§ï¼ˆidåˆ—æ˜¯è‡ªå¢ä¸»é”®åˆ—ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ’å…¥ï¼‰ã€‚</p><h2 id="è®¿é—®æ–¹æ³•ï¼ˆaccess-methodï¼‰çš„æ¦‚å¿µ">è®¿é—®æ–¹æ³•ï¼ˆaccess methodï¼‰çš„æ¦‚å¿µ</h2><p>æƒ³å¿…å„ä½éƒ½ç”¨è¿‡é«˜å¾·åœ°å›¾æ¥æŸ¥æ‰¾åˆ°æŸä¸ªåœ°æ–¹çš„è·¯çº¿å§ï¼ˆæ­¤å¤„æ²¡æœ‰ä¸ºé«˜å¾·åœ°å›¾æ‰“å¹¿å‘Šçš„æ„æ€ï¼Œä»–ä»¬æ²¡ç»™æˆ‘é’±ï¼Œå¤§å®¶ç”¨ç™¾åº¦åœ°å›¾ä¹Ÿå¯ä»¥å•Šï¼‰ï¼Œå¦‚æœæˆ‘ä»¬æœè¥¿å®‰é’Ÿæ¥¼åˆ°å¤§é›å¡”ä¹‹é—´çš„è·¯çº¿çš„è¯ï¼Œåœ°å›¾è½¯ä»¶ä¼šç»™å‡ºnç§è·¯çº¿ä¾›æˆ‘ä»¬é€‰æ‹©ï¼Œå¦‚æœæˆ‘ä»¬å®åœ¨é—²çš„æ²¡äº‹å„¿å¹²å¹¶ä¸”è¶³å¤Ÿæœ‰é’±çš„è¯ï¼Œè¿˜å¯ä»¥ç”¨å—è¾•åŒ—è¾™çš„æ–¹å¼ç»•åœ°çƒä¸€åœˆåˆ°è¾¾ç›®çš„åœ°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸è®ºé‡‡ç”¨å“ªä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ç›®æ ‡å°±æ˜¯åˆ°è¾¾å¤§é›å¡”è¿™ä¸ªåœ°æ–¹ã€‚å›åˆ°<code>MySQL</code>ä¸­æ¥ï¼Œæˆ‘ä»¬å¹³æ—¶æ‰€å†™çš„é‚£äº›æŸ¥è¯¢è¯­å¥æœ¬è´¨ä¸Šåªæ˜¯ä¸€ç§å£°æ˜å¼çš„è¯­æ³•ï¼Œåªæ˜¯å‘Šè¯‰<code>MySQL</code>æˆ‘ä»¬è¦è·å–çš„æ•°æ®ç¬¦åˆå“ªäº›è§„åˆ™ï¼Œè‡³äº<code>MySQL</code>èƒŒåœ°é‡Œæ˜¯æ€ä¹ˆæŠŠæŸ¥è¯¢ç»“æœæå‡ºæ¥çš„é‚£æ˜¯<code>MySQL</code>è‡ªå·±çš„äº‹å„¿ã€‚å¯¹äºå•ä¸ªè¡¨çš„æŸ¥è¯¢æ¥è¯´ï¼Œè®¾è®¡MySQLçš„å¤§å”æŠŠæŸ¥è¯¢çš„æ‰§è¡Œæ–¹å¼å¤§è‡´åˆ†ä¸ºä¸‹è¾¹ä¸¤ç§ï¼š</p><ul><li><p>ä½¿ç”¨å…¨è¡¨æ‰«æè¿›è¡ŒæŸ¥è¯¢</p><p>è¿™ç§æ‰§è¡Œæ–¹å¼å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯æŠŠè¡¨çš„æ¯ä¸€è¡Œè®°å½•éƒ½æ‰«ä¸€éå˜›ï¼ŒæŠŠç¬¦åˆæœç´¢æ¡ä»¶çš„è®°å½•åŠ å…¥åˆ°ç»“æœé›†å°±å®Œäº†ã€‚ä¸ç®¡æ˜¯å•¥æŸ¥è¯¢éƒ½å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼æ‰§è¡Œï¼Œå½“ç„¶ï¼Œè¿™ç§ä¹Ÿæ˜¯æœ€ç¬¨çš„æ‰§è¡Œæ–¹å¼ã€‚</p></li><li><p>ä½¿ç”¨ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢</p><p>å› ä¸ºç›´æ¥ä½¿ç”¨å…¨è¡¨æ‰«æçš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢è¦éå†å¥½å¤šè®°å½•ï¼Œæ‰€ä»¥ä»£ä»·å¯èƒ½å¤ªå¤§äº†ã€‚å¦‚æœæŸ¥è¯¢è¯­å¥ä¸­çš„æœç´¢æ¡ä»¶å¯ä»¥ä½¿ç”¨åˆ°æŸä¸ªç´¢å¼•ï¼Œé‚£ç›´æ¥ä½¿ç”¨ç´¢å¼•æ¥æ‰§è¡ŒæŸ¥è¯¢å¯èƒ½ä¼šåŠ å¿«æŸ¥è¯¢æ‰§è¡Œçš„æ—¶é—´ã€‚ä½¿ç”¨ç´¢å¼•æ¥æ‰§è¡ŒæŸ¥è¯¢çš„æ–¹å¼äº”èŠ±å…«é—¨ï¼Œåˆå¯ä»¥ç»†åˆ†ä¸ºè®¸å¤šç§ç±»ï¼š</p><ul><li>é’ˆå¯¹ä¸»é”®æˆ–å”¯ä¸€äºŒçº§ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢</li><li>é’ˆå¯¹æ™®é€šäºŒçº§ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢</li><li>é’ˆå¯¹ç´¢å¼•åˆ—çš„èŒƒå›´æŸ¥è¯¢</li><li>ç›´æ¥æ‰«ææ•´ä¸ªç´¢å¼•</li></ul></li></ul><p>è®¾è®¡<code>MySQL</code>çš„å¤§å”æŠŠ<code>MySQL</code>æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ–¹å¼ç§°ä¹‹ä¸º<code>è®¿é—®æ–¹æ³•</code>æˆ–è€…<code>è®¿é—®ç±»å‹</code>ã€‚åŒä¸€ä¸ªæŸ¥è¯¢è¯­å¥å¯èƒ½å¯ä»¥ä½¿ç”¨å¤šç§ä¸åŒçš„è®¿é—®æ–¹æ³•æ¥æ‰§è¡Œï¼Œè™½ç„¶æœ€åçš„æŸ¥è¯¢ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ—¶é—´å¯èƒ½å·®è€é¼»å­è¿œäº†ï¼Œå°±åƒæ˜¯ä»é’Ÿæ¥¼åˆ°å¤§é›å¡”ï¼Œä½ å¯ä»¥åç«ç®­å»ï¼Œä¹Ÿå¯ä»¥åé£æœºå»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åä¹Œé¾Ÿå»ã€‚ä¸‹è¾¹ç»†ç»†é“æ¥å„ç§<code>è®¿é—®æ–¹æ³•</code>çš„å…·ä½“å†…å®¹ã€‚</p><h2 id="const">const</h2><p>æœ‰çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸»é”®åˆ—æ¥å®šä½ä¸€æ¡è®°å½•ï¼Œæ¯”æ–¹è¯´è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> id = <span class="hljs-number">1438</span>;<br></code></pre></td></tr></table></figure><p><code>MySQL</code>ä¼šç›´æ¥åˆ©ç”¨ä¸»é”®å€¼åœ¨èšç°‡ç´¢å¼•ä¸­å®šä½å¯¹åº”çš„ç”¨æˆ·è®°å½•ï¼Œå°±åƒè¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a7b843dec61b4e~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ctendl4319v659s1dfoj6lssl16.png-36.4kB"><p>åŸè°…æˆ‘æŠŠèšç°‡ç´¢å¼•å¯¹åº”çš„å¤æ‚çš„<code>B+</code>æ ‘ç»“æ„æäº†ä¸€ä¸ªæåº¦ç²¾ç®€ç‰ˆï¼Œä¸ºäº†çªå‡ºé‡ç‚¹ï¼Œæˆ‘ä»¬å¿½ç•¥æ‰äº†<code>é¡µ</code>çš„ç»“æ„ï¼Œç›´æ¥æŠŠæ‰€æœ‰çš„å¶å­èŠ‚ç‚¹çš„è®°å½•éƒ½æ”¾åœ¨ä¸€èµ·å±•ç¤ºï¼Œè€Œä¸”è®°å½•ä¸­åªå±•ç¤ºæˆ‘ä»¬å…³å¿ƒçš„ç´¢å¼•åˆ—ï¼Œå¯¹äº<code>single_table</code>è¡¨çš„èšç°‡ç´¢å¼•æ¥è¯´ï¼Œå±•ç¤ºçš„å°±æ˜¯<code>id</code>åˆ—ã€‚æˆ‘ä»¬æƒ³çªå‡ºçš„é‡ç‚¹å°±æ˜¯ï¼š<code>B+</code>æ ‘å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—æ’åºçš„ï¼Œå¯¹äºçš„èšç°‡ç´¢å¼•æ¥è¯´ï¼Œå®ƒå¯¹åº”çš„<code>B+</code>æ ‘å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•å°±æ˜¯æŒ‰ç…§<code>id</code>åˆ—æ’åºçš„ã€‚<code>B+</code>æ ‘æœ¬æ¥å°±æ˜¯ä¸€ä¸ªçŸ®çŸ®çš„å¤§èƒ–å­ï¼Œæ‰€ä»¥è¿™æ ·æ ¹æ®ä¸»é”®å€¼å®šä½ä¸€æ¡è®°å½•çš„é€Ÿåº¦è´¼å¿«ã€‚ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬æ ¹æ®å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—æ¥å®šä½ä¸€æ¡è®°å½•çš„é€Ÿåº¦ä¹Ÿæ˜¯è´¼å¿«çš„ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key2 = <span class="hljs-number">3841</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè¿‡ç¨‹çš„ç¤ºæ„å›¾å°±æ˜¯è¿™æ ·ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a7b843e05c8e33~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cthurrlpbhlotsjru1dsjrrl30.png-110.2kB"><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œåˆ†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥å…ˆä»<code>idx_key2</code>å¯¹åº”çš„<code>B+</code>æ ‘ç´¢å¼•ä¸­æ ¹æ®<code>key2</code>åˆ—ä¸å¸¸æ•°çš„ç­‰å€¼æ¯”è¾ƒæ¡ä»¶å®šä½åˆ°ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ï¼Œç„¶åå†æ ¹æ®è¯¥è®°å½•çš„<code>id</code>å€¼åˆ°èšç°‡ç´¢å¼•ä¸­è·å–åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</p><p>è®¾è®¡<code>MySQL</code>çš„å¤§å”è®¤ä¸ºé€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ä¸å¸¸æ•°çš„ç­‰å€¼æ¯”è¾ƒæ¥å®šä½ä¸€æ¡è®°å½•æ˜¯åƒåç«ç®­ä¸€æ ·å¿«çš„ï¼Œæ‰€ä»¥ä»–ä»¬æŠŠè¿™ç§é€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—æ¥å®šä½ä¸€æ¡è®°å½•çš„è®¿é—®æ–¹æ³•å®šä¹‰ä¸ºï¼š**<code>const</code>ï¼Œæ„æ€æ˜¯å¸¸æ•°çº§åˆ«çš„ï¼Œä»£ä»·æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ã€‚**ä¸è¿‡è¿™ç§<code>const</code>è®¿é—®æ–¹æ³•åªèƒ½åœ¨ä¸»é”®åˆ—æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—å’Œä¸€ä¸ªå¸¸æ•°è¿›è¡Œç­‰å€¼æ¯”è¾ƒæ—¶æ‰æœ‰æ•ˆï¼Œå¦‚æœä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•æ˜¯ç”±å¤šä¸ªåˆ—æ„æˆçš„è¯ï¼Œç´¢å¼•ä¸­çš„æ¯ä¸€ä¸ªåˆ—éƒ½éœ€è¦ä¸å¸¸æ•°è¿›è¡Œç­‰å€¼æ¯”è¾ƒï¼Œè¿™ä¸ª<code>const</code>è®¿é—®æ–¹æ³•æ‰æœ‰æ•ˆï¼ˆè¿™æ˜¯å› ä¸ºåªæœ‰è¯¥ç´¢å¼•ä¸­å…¨éƒ¨åˆ—éƒ½é‡‡ç”¨ç­‰å€¼æ¯”è¾ƒæ‰å¯ä»¥å®šä½å”¯ä¸€çš„ä¸€æ¡è®°å½•ï¼‰ã€‚</p><p>å¯¹äºå”¯ä¸€äºŒçº§ç´¢å¼•æ¥è¯´ï¼ŒæŸ¥è¯¢è¯¥åˆ—ä¸º<code>NULL</code>å€¼çš„æƒ…å†µæ¯”è¾ƒç‰¹æ®Šï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key2 <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>;<br></code></pre></td></tr></table></figure><p>å› ä¸ºå”¯ä¸€äºŒçº§ç´¢å¼•åˆ—å¹¶ä¸é™åˆ¶ NULL å€¼çš„æ•°é‡ï¼Œæ‰€ä»¥ä¸Šè¿°è¯­å¥å¯èƒ½è®¿é—®åˆ°å¤šæ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´ ä¸Šè¾¹è¿™ä¸ªè¯­å¥ä¸å¯ä»¥ä½¿ç”¨<code>const</code>è®¿é—®æ–¹æ³•æ¥æ‰§è¡Œï¼ˆè‡³äºæ˜¯ä»€ä¹ˆè®¿é—®æ–¹æ³•æˆ‘ä»¬ä¸‹è¾¹é©¬ä¸Šè¯´ï¼‰ã€‚</p><h2 id="ref">ref</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬å¯¹æŸä¸ªæ™®é€šçš„äºŒçº§ç´¢å¼•åˆ—ä¸å¸¸æ•°è¿›è¡Œç­‰å€¼æ¯”è¾ƒï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 = <span class="hljs-string">&#x27;abc&#x27;</span>;<br></code></pre></td></tr></table></figure><p>å¯¹äºè¿™ä¸ªæŸ¥è¯¢ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥é€‰æ‹©å…¨è¡¨æ‰«ææ¥é€ä¸€å¯¹æ¯”æœç´¢æ¡ä»¶æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å…ˆä½¿ç”¨äºŒçº§ç´¢å¼•æ‰¾åˆ°å¯¹åº”è®°å½•çš„<code>id</code>å€¼ï¼Œç„¶åå†å›è¡¨åˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚**ç”±äºæ™®é€šäºŒçº§ç´¢å¼•å¹¶ä¸é™åˆ¶ç´¢å¼•åˆ—å€¼çš„å”¯ä¸€æ€§ï¼Œæ‰€ä»¥å¯èƒ½æ‰¾åˆ°å¤šæ¡å¯¹åº”çš„è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨äºŒçº§ç´¢å¼•æ¥æ‰§è¡ŒæŸ¥è¯¢çš„ä»£ä»·å–å†³äºç­‰å€¼åŒ¹é…åˆ°çš„äºŒçº§ç´¢å¼•è®°å½•æ¡æ•°ã€‚**å¦‚æœåŒ¹é…çš„è®°å½•è¾ƒå°‘ï¼Œåˆ™å›è¡¨çš„ä»£ä»·è¿˜æ˜¯æ¯”è¾ƒä½çš„ï¼Œæ‰€ä»¥<code>MySQL</code>å¯èƒ½é€‰æ‹©ä½¿ç”¨ç´¢å¼•è€Œä¸æ˜¯å…¨è¡¨æ‰«æçš„æ–¹å¼æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚è®¾è®¡<code>MySQL</code>çš„å¤§å”å°±æŠŠè¿™ç§æœç´¢æ¡ä»¶ä¸ºäºŒçº§ç´¢å¼•åˆ—ä¸å¸¸æ•°ç­‰å€¼æ¯”è¾ƒï¼Œé‡‡ç”¨äºŒçº§ç´¢å¼•æ¥æ‰§è¡ŒæŸ¥è¯¢çš„è®¿é—®æ–¹æ³•ç§°ä¸ºï¼š<code>ref</code>ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹é‡‡ç”¨<code>ref</code>è®¿é—®æ–¹æ³•æ‰§è¡ŒæŸ¥è¯¢çš„å›¾ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a7b843e5e227f1~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ctf14vso11cdclsmc6ac8pru9h.png-109.5kB"><p>ä»å›¾ç¤ºä¸­å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºæ™®é€šçš„äºŒçº§ç´¢å¼•æ¥è¯´ï¼Œé€šè¿‡ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼æ¯”è¾ƒåå¯èƒ½åŒ¹é…åˆ°å¤šæ¡è¿ç»­çš„è®°å½•ï¼Œè€Œä¸æ˜¯åƒä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•é‚£æ ·æœ€å¤šåªèƒ½åŒ¹é…1æ¡è®°å½•ï¼Œæ‰€ä»¥è¿™ç§<code>ref</code>è®¿é—®æ–¹æ³•æ¯”<code>const</code>å·®äº†é‚£ä¹ˆä¸€ä¸¢ä¸¢ï¼Œä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•ç­‰å€¼æ¯”è¾ƒæ—¶åŒ¹é…çš„è®°å½•æ•°è¾ƒå°‘æ—¶çš„æ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„ï¼ˆå¦‚æœåŒ¹é…çš„äºŒçº§ç´¢å¼•è®°å½•å¤ªå¤šé‚£ä¹ˆå›è¡¨çš„æˆæœ¬å°±å¤ªå¤§äº†ï¼‰ï¼Œè·Ÿåé«˜é“å·®ä¸å¤šã€‚ä¸è¿‡éœ€è¦æ³¨æ„ä¸‹è¾¹ä¸¤ç§æƒ…å†µï¼š</p><ul><li><p>äºŒçº§ç´¢å¼•åˆ—å€¼ä¸º<code>NULL</code>çš„æƒ…å†µ</p><p>ä¸è®ºæ˜¯æ™®é€šçš„äºŒçº§ç´¢å¼•ï¼Œè¿˜æ˜¯å”¯ä¸€äºŒçº§ç´¢å¼•ï¼Œå®ƒä»¬çš„ç´¢å¼•åˆ—å¯¹åŒ…å«<code>NULL</code>å€¼çš„æ•°é‡å¹¶ä¸é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨<code>key IS NULL</code>è¿™ç§å½¢å¼çš„æœç´¢æ¡ä»¶æœ€å¤šåªèƒ½ä½¿ç”¨<code>ref</code>çš„è®¿é—®æ–¹æ³•ï¼Œè€Œä¸æ˜¯<code>const</code>çš„è®¿é—®æ–¹æ³•ã€‚</p></li><li><p>å¯¹äºæŸä¸ªåŒ…å«å¤šä¸ªç´¢å¼•åˆ—çš„äºŒçº§ç´¢å¼•æ¥è¯´ï¼Œåªè¦æ˜¯æœ€å·¦è¾¹çš„è¿ç»­ç´¢å¼•åˆ—æ˜¯ä¸å¸¸æ•°çš„ç­‰å€¼æ¯”è¾ƒå°±å¯èƒ½é‡‡ç”¨<code>ref</code>çš„è®¿é—®æ–¹æ³•ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™å‡ ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key_part1 = <span class="hljs-string">&#x27;god like&#x27;</span>;<br><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key_part1 = <span class="hljs-string">&#x27;god like&#x27;</span> <span class="hljs-keyword">AND</span> key_part2 = <span class="hljs-string">&#x27;legendary&#x27;</span>;<br><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key_part1 = <span class="hljs-string">&#x27;god like&#x27;</span> <span class="hljs-keyword">AND</span> key_part2 = <span class="hljs-string">&#x27;legendary&#x27;</span> <span class="hljs-keyword">AND</span> key_part3 = <span class="hljs-string">&#x27;penta kill&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœæœ€å·¦è¾¹çš„è¿ç»­ç´¢å¼•åˆ—å¹¶ä¸å…¨éƒ¨æ˜¯ç­‰å€¼æ¯”è¾ƒçš„è¯ï¼Œå®ƒçš„è®¿é—®æ–¹æ³•å°±ä¸èƒ½ç§°ä¸º<code>ref</code>äº†ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key_part1 = <span class="hljs-string">&#x27;god like&#x27;</span> <span class="hljs-keyword">AND</span> key_part2 &gt; <span class="hljs-string">&#x27;legendary&#x27;</span>;<br></code></pre></td></tr></table></figure></li></ul><h2 id="ref-or-null">ref_or_null</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¸ä»…æƒ³æ‰¾å‡ºæŸä¸ªäºŒçº§ç´¢å¼•åˆ—çš„å€¼ç­‰äºæŸä¸ªå¸¸æ•°çš„è®°å½•ï¼Œè¿˜æƒ³æŠŠè¯¥åˆ—çš„å€¼ä¸º<code>NULL</code>çš„è®°å½•ä¹Ÿæ‰¾å‡ºæ¥ï¼Œå°±åƒä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 = <span class="hljs-string">&#x27;abc&#x27;</span> <span class="hljs-keyword">OR</span> key1 <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>;<br></code></pre></td></tr></table></figure><p>å½“ä½¿ç”¨äºŒçº§ç´¢å¼•è€Œä¸æ˜¯å…¨è¡¨æ‰«æçš„æ–¹å¼æ‰§è¡Œè¯¥æŸ¥è¯¢æ—¶ï¼Œè¿™ç§ç±»å‹çš„æŸ¥è¯¢ä½¿ç”¨çš„è®¿é—®æ–¹æ³•å°±ç§°ä¸º<code>ref_or_null</code>ï¼Œè¿™ä¸ª<code>ref_or_null</code>è®¿é—®æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a7b843e8927bee~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ctf21uu8113m1ajm1rcitgf5eeco.png-122.5kB"><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¾¹çš„æŸ¥è¯¢ç›¸å½“äºå…ˆåˆ†åˆ«ä»<code>idx_key1</code>ç´¢å¼•å¯¹åº”çš„<code>B+</code>æ ‘ä¸­æ‰¾å‡º<code>key1 IS NULL</code>å’Œ<code>key1 = 'abc'</code>çš„ä¸¤ä¸ªè¿ç»­çš„è®°å½•èŒƒå›´ï¼Œç„¶åæ ¹æ®è¿™äº›äºŒçº§ç´¢å¼•è®°å½•ä¸­çš„<code>id</code>å€¼å†å›è¡¨æŸ¥æ‰¾å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</p><h2 id="range">range</h2><p>æˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„å‡ ç§è®¿é—®æ–¹æ³•éƒ½æ˜¯åœ¨å¯¹ç´¢å¼•åˆ—ä¸æŸä¸€ä¸ªå¸¸æ•°è¿›è¡Œç­‰å€¼æ¯”è¾ƒçš„æ—¶å€™æ‰å¯èƒ½ä½¿ç”¨åˆ°ï¼ˆ<code>ref_or_null</code>æ¯”è¾ƒå¥‡ç‰¹ï¼Œè¿˜è®¡ç®—äº†å€¼ä¸º<code>NULL</code>çš„æƒ…å†µï¼‰ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬é¢å¯¹çš„æœç´¢æ¡ä»¶æ›´å¤æ‚ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> * FROM single_table WHERE key<span class="hljs-number">2</span> IN (<span class="hljs-number">1438</span>, <span class="hljs-number">6328</span>) OR (key<span class="hljs-number">2</span> &gt;= <span class="hljs-number">38</span> AND key<span class="hljs-number">2</span> &lt;= <span class="hljs-number">79</span>);<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å½“ç„¶è¿˜å¯ä»¥ä½¿ç”¨å…¨è¡¨æ‰«æçš„æ–¹å¼æ¥æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥ä½¿ç”¨<code>äºŒçº§ç´¢å¼• + å›è¡¨</code>çš„æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœé‡‡ç”¨<code>äºŒçº§ç´¢å¼• + å›è¡¨</code>çš„æ–¹å¼æ¥æ‰§è¡Œçš„è¯ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„æœç´¢æ¡ä»¶å°±ä¸åªæ˜¯è¦æ±‚ç´¢å¼•åˆ—ä¸å¸¸æ•°çš„ç­‰å€¼åŒ¹é…äº†ï¼Œè€Œæ˜¯ç´¢å¼•åˆ—éœ€è¦åŒ¹é…æŸä¸ªæˆ–æŸäº›èŒƒå›´çš„å€¼ï¼Œåœ¨æœ¬æŸ¥è¯¢ä¸­<code>key2</code>åˆ—çš„å€¼åªè¦åŒ¹é…ä¸‹åˆ—3ä¸ªèŒƒå›´ä¸­çš„ä»»ä½•ä¸€ä¸ªå°±ç®—æ˜¯åŒ¹é…æˆåŠŸäº†ï¼š</p><ul><li><code>key2</code>çš„å€¼æ˜¯<code>1438</code></li><li><code>key2</code>çš„å€¼æ˜¯<code>6328</code></li><li><code>key2</code>çš„å€¼åœ¨<code>38</code>å’Œ<code>79</code>ä¹‹é—´ã€‚</li></ul><p>è®¾è®¡<code>MySQL</code>çš„å¤§å”æŠŠè¿™ç§åˆ©ç”¨ç´¢å¼•è¿›è¡ŒèŒƒå›´åŒ¹é…çš„è®¿é—®æ–¹æ³•ç§°ä¹‹ä¸ºï¼š<code>range</code>ã€‚</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">å°è´´å£«ï¼š<br><br>æ­¤å¤„æ‰€è¯´çš„ä½¿ç”¨ç´¢å¼•è¿›è¡ŒèŒƒå›´åŒ¹é…ä¸­çš„ `ç´¢å¼•` å¯ä»¥æ˜¯èšç°‡ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒçº§ç´¢å¼•ã€‚<br></code></pre></td></tr></table></figure><p>å¦‚æœæŠŠè¿™å‡ ä¸ªæ‰€è°“çš„<code>key2</code>åˆ—çš„å€¼éœ€è¦æ»¡è¶³çš„<code>èŒƒå›´</code>åœ¨æ•°è½´ä¸Šä½“ç°å‡ºæ¥çš„è¯ï¼Œé‚£åº”è¯¥æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a7b843e91231c9~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cth9mkf41li1dad1tnd6dm5139.png-9.2kB"><p>ä¹Ÿå°±æ˜¯ä»æ•°å­¦çš„è§’åº¦çœ‹ï¼Œæ¯ä¸€ä¸ªæ‰€è°“çš„èŒƒå›´éƒ½æ˜¯æ•°è½´ä¸Šçš„ä¸€ä¸ª<code>åŒºé—´</code>ï¼Œ3ä¸ªèŒƒå›´ä¹Ÿå°±å¯¹åº”ç€3ä¸ªåŒºé—´ï¼š</p><ul><li>èŒƒå›´1ï¼š<code>key2 = 1438</code></li><li>èŒƒå›´2ï¼š<code>key2 = 6328</code></li><li>èŒƒå›´3ï¼š<code>key2 âˆˆ [38, 79]</code>ï¼Œæ³¨æ„è¿™é‡Œæ˜¯é—­åŒºé—´ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥æŠŠé‚£ç§ç´¢å¼•åˆ—ç­‰å€¼åŒ¹é…çš„æƒ…å†µç§°ä¹‹ä¸º<code>å•ç‚¹åŒºé—´</code>ï¼Œä¸Šè¾¹æ‰€è¯´çš„<code>èŒƒå›´1</code>å’Œ<code>èŒƒå›´2</code>éƒ½å¯ä»¥è¢«ç§°ä¸ºå•ç‚¹åŒºé—´ï¼Œåƒ<code>èŒƒå›´3</code>è¿™ç§çš„æˆ‘ä»¬å¯ä»¥ç§°ä¸ºè¿ç»­èŒƒå›´åŒºé—´ã€‚</p><h2 id="index">index</h2><p>çœ‹ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> key_part<span class="hljs-number">1</span>, key_part<span class="hljs-number">2</span>, key_part<span class="hljs-number">3</span> FROM single_table WHERE key_part<span class="hljs-number">2</span> = &#x27;abc&#x27;;<br></code></pre></td></tr></table></figure><p>ç”±äº<code>key_part2</code>å¹¶ä¸æ˜¯è”åˆç´¢å¼•<code>idx_key_part</code>æœ€å·¦ç´¢å¼•åˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ä½¿ç”¨<code>ref</code>æˆ–è€…<code>range</code>è®¿é—®æ–¹æ³•æ¥æ‰§è¡Œè¿™ä¸ªè¯­å¥ã€‚ä½†æ˜¯è¿™ä¸ªæŸ¥è¯¢ç¬¦åˆä¸‹è¾¹è¿™ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>å®ƒçš„æŸ¥è¯¢åˆ—è¡¨åªæœ‰3ä¸ªåˆ—ï¼š<code>key_part1</code>, <code>key_part2</code>, <code>key_part3</code>ï¼Œè€Œç´¢å¼•<code>idx_key_part</code>åˆåŒ…å«è¿™ä¸‰ä¸ªåˆ—ã€‚</li><li>æœç´¢æ¡ä»¶ä¸­åªæœ‰<code>key_part2</code>åˆ—ã€‚è¿™ä¸ªåˆ—ä¹ŸåŒ…å«åœ¨ç´¢å¼•<code>idx_key_part</code>ä¸­ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡éå†<code>idx_key_part</code>ç´¢å¼•çš„å¶å­èŠ‚ç‚¹çš„è®°å½•æ¥æ¯”è¾ƒ<code>key_part2 = 'abc'</code>è¿™ä¸ªæ¡ä»¶æ˜¯å¦æˆç«‹ï¼ŒæŠŠåŒ¹é…æˆåŠŸçš„äºŒçº§ç´¢å¼•è®°å½•çš„<code>key_part1</code>, <code>key_part2</code>, <code>key_part3</code>åˆ—çš„å€¼ç›´æ¥åŠ åˆ°ç»“æœé›†ä¸­å°±è¡Œäº†ã€‚ç”±äºäºŒçº§ç´¢å¼•è®°å½•æ¯”èšç°‡ç´¢è®°å½•å°çš„å¤šï¼ˆèšç°‡ç´¢å¼•è®°å½•è¦å­˜å‚¨æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„åˆ—ä»¥åŠæ‰€è°“çš„éšè—åˆ—ï¼Œè€ŒäºŒçº§ç´¢å¼•è®°å½•åªéœ€è¦å­˜æ”¾ç´¢å¼•åˆ—å’Œä¸»é”®ï¼‰ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ä¹Ÿä¸ç”¨è¿›è¡Œå›è¡¨æ“ä½œï¼Œæ‰€ä»¥ç›´æ¥éå†äºŒçº§ç´¢å¼•æ¯”ç›´æ¥éå†èšç°‡ç´¢å¼•çš„æˆæœ¬è¦å°å¾ˆå¤šï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”å°±æŠŠè¿™ç§é‡‡ç”¨éå†äºŒçº§ç´¢å¼•è®°å½•çš„æ‰§è¡Œæ–¹å¼ç§°ä¹‹ä¸ºï¼š<code>index</code>ã€‚</p><h2 id="all">all</h2><p>æœ€ç›´æ¥çš„æŸ¥è¯¢æ‰§è¡Œæ–¹å¼å°±æ˜¯æˆ‘ä»¬å·²ç»æäº†æ— æ•°éçš„å…¨è¡¨æ‰«æï¼Œå¯¹äº<code>InnoDB</code>è¡¨æ¥è¯´ä¹Ÿå°±æ˜¯ç›´æ¥æ‰«æèšç°‡ç´¢å¼•ï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”æŠŠè¿™ç§ä½¿ç”¨å…¨è¡¨æ‰«ææ‰§è¡ŒæŸ¥è¯¢çš„æ–¹å¼ç§°ä¹‹ä¸ºï¼š<code>all</code>ã€‚</p><h2 id="æ³¨æ„äº‹é¡¹-2">æ³¨æ„äº‹é¡¹</h2><h3 id="é‡æ¸©-äºŒçº§ç´¢å¼•-å›è¡¨">é‡æ¸© äºŒçº§ç´¢å¼• + å›è¡¨</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹åªèƒ½åˆ©ç”¨å•ä¸ªäºŒçº§ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹çš„è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 = <span class="hljs-string">&#x27;abc&#x27;</span> <span class="hljs-keyword">AND</span> key2 &gt; <span class="hljs-number">1000</span>;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè¯†åˆ«åˆ°è¿™ä¸ªæŸ¥è¯¢ä¸­çš„ä¸¤ä¸ªæœç´¢æ¡ä»¶ï¼š</p><ul><li><code>key1 = 'abc'</code></li><li><code>key2 &gt; 1000</code></li></ul><p>ä¼˜åŒ–å™¨ä¸€èˆ¬ä¼šæ ¹æ®<code>single_table</code>è¡¨çš„ç»Ÿè®¡æ•°æ®æ¥åˆ¤æ–­åˆ°åº•ä½¿ç”¨å“ªä¸ªæ¡ä»¶åˆ°å¯¹åº”çš„äºŒçº§ç´¢å¼•ä¸­æŸ¥è¯¢æ‰«æçš„è¡Œæ•°ä¼šæ›´å°‘ï¼Œé€‰æ‹©é‚£ä¸ªæ‰«æè¡Œæ•°è¾ƒå°‘çš„æ¡ä»¶åˆ°å¯¹åº”çš„äºŒçº§ç´¢å¼•ä¸­æŸ¥è¯¢ï¼ˆå…³äºå¦‚ä½•æ¯”è¾ƒçš„ç»†èŠ‚æˆ‘ä»¬åè¾¹çš„ç« èŠ‚ä¸­ä¼šå” å¨ï¼‰ã€‚ç„¶åå°†ä»è¯¥äºŒçº§ç´¢å¼•ä¸­æŸ¥è¯¢åˆ°çš„ç»“æœç»è¿‡å›è¡¨å¾—åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•åå†æ ¹æ®å…¶ä½™çš„<code>WHERE</code>æ¡ä»¶è¿‡æ»¤è®°å½•ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç­‰å€¼æŸ¥æ‰¾æ¯”èŒƒå›´æŸ¥æ‰¾éœ€è¦æ‰«æçš„è¡Œæ•°æ›´å°‘ï¼ˆä¹Ÿå°±æ˜¯<code>ref</code>çš„è®¿é—®æ–¹æ³•ä¸€èˆ¬æ¯”<code>range</code>å¥½ï¼Œä½†è¿™ä¹Ÿä¸æ€»æ˜¯ä¸€å®šçš„ï¼Œä¹Ÿå¯èƒ½é‡‡ç”¨<code>ref</code>è®¿é—®æ–¹æ³•çš„é‚£ä¸ªç´¢å¼•åˆ—çš„å€¼ä¸ºç‰¹å®šå€¼çš„è¡Œæ•°ç‰¹åˆ«å¤šï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œå‡è®¾ä¼˜åŒ–å™¨å†³å®šä½¿ç”¨<code>idx_key1</code>ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œé‚£ä¹ˆæ•´ä¸ªæŸ¥è¯¢è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li>æ­¥éª¤1ï¼šä½¿ç”¨äºŒçº§ç´¢å¼•å®šä½è®°å½•çš„é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯æ ¹æ®æ¡ä»¶<code>key1 = 'abc'</code>ä»<code>idx_key1</code>ç´¢å¼•ä»£è¡¨çš„<code>B+</code>æ ‘ä¸­æ‰¾åˆ°å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•ã€‚</li><li>æ­¥éª¤2ï¼šå›è¡¨é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯æ ¹æ®ä¸Šä¸€æ­¥éª¤ä¸­æ‰¾åˆ°çš„è®°å½•çš„ä¸»é”®å€¼è¿›è¡Œ<code>å›è¡¨</code>æ“ä½œï¼Œä¹Ÿå°±æ˜¯åˆ°èšç°‡ç´¢å¼•ä¸­æ‰¾åˆ°å¯¹åº”çš„å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œå†æ ¹æ®æ¡ä»¶<code>key2 &gt; 1000</code>åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ç»§ç»­è¿‡æ»¤ã€‚å°†æœ€ç»ˆç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„è®°å½•è¿”å›ç»™ç”¨æˆ·ã€‚</li></ul><p>è¿™é‡Œéœ€è¦ç‰¹åˆ«æé†’å¤§å®¶çš„ä¸€ç‚¹æ˜¯ï¼Œ<strong>å› ä¸ºäºŒçº§ç´¢å¼•çš„èŠ‚ç‚¹ä¸­çš„è®°å½•åªåŒ…å«ç´¢å¼•åˆ—å’Œä¸»é”®ï¼Œæ‰€ä»¥åœ¨æ­¥éª¤1ä¸­ä½¿ç”¨<code>idx_key1</code>ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶åªä¼šç”¨åˆ°ä¸<code>key1</code>åˆ—æœ‰å…³çš„æœç´¢æ¡ä»¶ï¼Œå…¶ä½™æ¡ä»¶ï¼Œæ¯”å¦‚<code>key2 &gt; 1000</code>è¿™ä¸ªæ¡ä»¶åœ¨æ­¥éª¤1ä¸­æ˜¯ç”¨ä¸åˆ°çš„ï¼Œåªæœ‰åœ¨æ­¥éª¤2å®Œæˆå›è¡¨æ“ä½œåæ‰èƒ½ç»§ç»­é’ˆå¯¹å®Œæ•´çš„ç”¨æˆ·è®°å½•ä¸­ç»§ç»­è¿‡æ»¤ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è¯´ä¸€èˆ¬æƒ…å†µä¸‹æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢åªä¼šç”¨åˆ°å•ä¸ªäºŒçº§ç´¢å¼•ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰ç‰¹æ®Šæƒ…å†µçš„ï¼Œæˆ‘ä»¬åè¾¹ä¼šè¯¦ç»†å” å¨çš„ã€‚<br></code></pre></td></tr></table></figure><h3 id="æ˜ç¡®rangeè®¿é—®æ–¹æ³•ä½¿ç”¨çš„èŒƒå›´åŒºé—´">æ˜ç¡®rangeè®¿é—®æ–¹æ³•ä½¿ç”¨çš„èŒƒå›´åŒºé—´</h3><p>å…¶å®å¯¹äº<code>B+</code>æ ‘ç´¢å¼•æ¥è¯´ï¼Œåªè¦ç´¢å¼•åˆ—å’Œå¸¸æ•°ä½¿ç”¨<code>=</code>ã€<code>&lt;=&gt;</code>ã€<code>IN</code>ã€<code>NOT IN</code>ã€<code>IS NULL</code>ã€<code>IS NOT NULL</code>ã€<code>&gt;</code>ã€<code>&lt;</code>ã€<code>&gt;=</code>ã€<code>&lt;=</code>ã€<code>BETWEEN</code>ã€<code>!=</code>ï¼ˆä¸ç­‰äºä¹Ÿå¯ä»¥å†™æˆ<code>&lt;&gt;</code>ï¼‰æˆ–è€…<code>LIKE</code>æ“ä½œç¬¦è¿æ¥èµ·æ¥ï¼Œå°±å¯ä»¥äº§ç”Ÿä¸€ä¸ªæ‰€è°“çš„<code>åŒºé—´</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>LIKEæ“ä½œç¬¦æ¯”è¾ƒç‰¹æ®Šï¼Œåªæœ‰åœ¨åŒ¹é…å®Œæ•´å­—ç¬¦ä¸²æˆ–è€…åŒ¹é…å­—ç¬¦ä¸²å‰ç¼€æ—¶æ‰å¯ä»¥åˆ©ç”¨ç´¢å¼•ï¼Œå…·ä½“åŸå› æˆ‘ä»¬åœ¨å‰è¾¹çš„ç« èŠ‚ä¸­å” å¨è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚<br><br>INæ“ä½œç¬¦çš„æ•ˆæœå’Œè‹¥å¹²ä¸ªç­‰å€¼åŒ¹é…æ“ä½œç¬¦`=`ä¹‹é—´ç”¨`OR`è¿æ¥èµ·æ¥æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šäº§ç”Ÿå¤šä¸ªå•ç‚¹åŒºé—´ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸¤ä¸ªè¯­å¥çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š<br><br>SELECT * FROM single_table WHERE key2 IN (1438, 6328);<br>    <br>SELECT * FROM single_table WHERE key2 = 1438 OR key2 = 6328;<br></code></pre></td></tr></table></figure><p>ä¸è¿‡åœ¨æ—¥å¸¸çš„å·¥ä½œä¸­ï¼Œä¸€ä¸ªæŸ¥è¯¢çš„<code>WHERE</code>å­å¥å¯èƒ½æœ‰å¾ˆå¤šä¸ªå°çš„æœç´¢æ¡ä»¶ï¼Œè¿™äº›æœç´¢æ¡ä»¶éœ€è¦ä½¿ç”¨<code>AND</code>æˆ–è€…<code>OR</code>æ“ä½œç¬¦è¿æ¥èµ·æ¥ï¼Œè™½ç„¶å¤§å®¶éƒ½çŸ¥é“è¿™ä¸¤ä¸ªæ“ä½œç¬¦çš„ä½œç”¨ï¼Œä½†æˆ‘è¿˜æ˜¯è¦å†è¯´ä¸€éï¼š</p><ul><li><code>cond1 AND cond2</code> ï¼šåªæœ‰å½“<code>cond1</code>å’Œ<code>cond2</code>éƒ½ä¸º<code>TRUE</code>æ—¶æ•´ä¸ªè¡¨è¾¾å¼æ‰ä¸º<code>TRUE</code>ã€‚</li><li><code>cond1 OR cond2</code>ï¼šåªè¦<code>cond1</code>æˆ–è€…<code>cond2</code>ä¸­æœ‰ä¸€ä¸ªä¸º<code>TRUE</code>æ•´ä¸ªè¡¨è¾¾å¼å°±ä¸º<code>TRUE</code>ã€‚</li></ul><p>å½“æˆ‘ä»¬æƒ³ä½¿ç”¨<code>range</code>è®¿é—®æ–¹æ³•æ¥æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢è¯­å¥æ—¶ï¼Œé‡ç‚¹å°±æ˜¯æ‰¾å‡ºè¯¥æŸ¥è¯¢å¯ç”¨çš„ç´¢å¼•ä»¥åŠè¿™äº›ç´¢å¼•å¯¹åº”çš„èŒƒå›´åŒºé—´ã€‚ä¸‹è¾¹åˆ†ä¸¤ç§æƒ…å†µçœ‹ä¸€ä¸‹æ€ä¹ˆä»ç”±<code>AND</code>æˆ–<code>OR</code>ç»„æˆçš„å¤æ‚æœç´¢æ¡ä»¶ä¸­æå–å‡ºæ­£ç¡®çš„èŒƒå›´åŒºé—´ã€‚</p><h4 id="æ‰€æœ‰æœç´¢æ¡ä»¶éƒ½å¯ä»¥ä½¿ç”¨æŸä¸ªç´¢å¼•çš„æƒ…å†µ">æ‰€æœ‰æœç´¢æ¡ä»¶éƒ½å¯ä»¥ä½¿ç”¨æŸä¸ªç´¢å¼•çš„æƒ…å†µ</h4><p>æœ‰æ—¶å€™æ¯ä¸ªæœç´¢æ¡ä»¶éƒ½å¯ä»¥ä½¿ç”¨åˆ°æŸä¸ªç´¢å¼•ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> * FROM single_table WHERE key<span class="hljs-number">2</span> &gt; <span class="hljs-number">100</span> AND key<span class="hljs-number">2</span> &gt; <span class="hljs-number">200</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢ä¸­çš„æœç´¢æ¡ä»¶éƒ½å¯ä»¥ä½¿ç”¨åˆ°<code>key2</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªæœç´¢æ¡ä»¶éƒ½å¯¹åº”ç€ä¸€ä¸ª<code>idx_key2</code>çš„èŒƒå›´åŒºé—´ã€‚è¿™ä¸¤ä¸ªå°çš„æœç´¢æ¡ä»¶ä½¿ç”¨<code>AND</code>è¿æ¥èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯è¦å–ä¸¤ä¸ªèŒƒå›´åŒºé—´çš„äº¤é›†ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨<code>range</code>è®¿é—®æ–¹æ³•æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨çš„<code>idx_key2</code>ç´¢å¼•çš„èŒƒå›´åŒºé—´çš„ç¡®å®šè¿‡ç¨‹å°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a7b843e0fb74ac~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ctia5p09rqss4413qq16gdbbj3q.png-44kB"><p><code>key2 &gt; 100</code>å’Œ<code>key2 &gt; 200</code>äº¤é›†å½“ç„¶å°±æ˜¯<code>key2 &gt; 200</code>äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸Šè¾¹è¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨<code>idx_key2</code>çš„èŒƒå›´åŒºé—´å°±æ˜¯<code>(200, +âˆ)</code>ã€‚è¿™ä¸œè¥¿å°å­¦éƒ½å­¦è¿‡å§ï¼Œå†ä¸æµåˆä¸­è‚¯å®šéƒ½å­¦è¿‡ã€‚æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ä½¿ç”¨<code>OR</code>å°†å¤šä¸ªæœç´¢æ¡ä»¶è¿æ¥åœ¨ä¸€èµ·çš„æƒ…å†µï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> * FROM single_table WHERE key<span class="hljs-number">2</span> &gt; <span class="hljs-number">100</span> OR key<span class="hljs-number">2</span> &gt; <span class="hljs-number">200</span>;<br></code></pre></td></tr></table></figure><p><code>OR</code>æ„å‘³ç€éœ€è¦å–å„ä¸ªèŒƒå›´åŒºé—´çš„å¹¶é›†ï¼Œæ‰€ä»¥ä¸Šè¾¹è¿™ä¸ªæŸ¥è¯¢åœ¨æˆ‘ä»¬ä½¿ç”¨<code>range</code>è®¿é—®æ–¹æ³•æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨çš„<code>idx_key2</code>ç´¢å¼•çš„èŒƒå›´åŒºé—´çš„ç¡®å®šè¿‡ç¨‹å°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16a7b8448ea4909c~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ctia94i617ihr5ncku4ed1gg247.png-49.1kB"><p>ä¹Ÿå°±æ˜¯è¯´ä¸Šè¾¹è¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨<code>idx_key2</code>çš„èŒƒå›´åŒºé—´å°±æ˜¯<code>(100ï¼Œ +âˆ)</code>ã€‚</p><h4 id="æœ‰çš„æœç´¢æ¡ä»¶æ— æ³•ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ">æœ‰çš„æœç´¢æ¡ä»¶æ— æ³•ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ</h4><p>æ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key2 &gt; <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> common_field = <span class="hljs-string">&#x27;abc&#x27;</span>;<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¸­èƒ½åˆ©ç”¨çš„ç´¢å¼•åªæœ‰<code>idx_key2</code>ä¸€ä¸ªï¼Œè€Œ<code>idx_key2</code>è¿™ä¸ªäºŒçº§ç´¢å¼•çš„è®°å½•ä¸­åˆä¸åŒ…å«<code>common_field</code>è¿™ä¸ªå­—æ®µï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨äºŒçº§ç´¢å¼•<code>idx_key2</code>å®šä½è®°å½•çš„é˜¶æ®µç”¨ä¸åˆ°<code>common_field = 'abc'</code>è¿™ä¸ªæ¡ä»¶ï¼Œè¿™ä¸ªæ¡ä»¶æ˜¯åœ¨å›è¡¨è·å–äº†å®Œæ•´çš„ç”¨æˆ·è®°å½•åæ‰ä½¿ç”¨çš„ï¼Œè€Œ<code>èŒƒå›´åŒºé—´</code>æ˜¯ä¸ºäº†åˆ°ç´¢å¼•ä¸­å–è®°å½•ä¸­æå‡ºçš„æ¦‚å¿µï¼Œæ‰€ä»¥åœ¨ç¡®å®š<code>èŒƒå›´åŒºé—´</code>çš„æ—¶å€™ä¸éœ€è¦è€ƒè™‘<code>common_field = 'abc'</code>è¿™ä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬åœ¨ä¸ºæŸä¸ªç´¢å¼•ç¡®å®šèŒƒå›´åŒºé—´çš„æ—¶å€™åªéœ€è¦æŠŠç”¨ä¸åˆ°ç›¸å…³ç´¢å¼•çš„æœç´¢æ¡ä»¶æ›¿æ¢ä¸º<code>TRUE</code>å°±å¥½äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>ä¹‹æ‰€ä»¥æŠŠç”¨ä¸åˆ°ç´¢å¼•çš„æœç´¢æ¡ä»¶æ›¿æ¢ä¸ºTRUEï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸æ‰“ç®—ä½¿ç”¨è¿™äº›æ¡ä»¶è¿›è¡Œåœ¨è¯¥ç´¢å¼•ä¸Šè¿›è¡Œè¿‡æ»¤ï¼Œæ‰€ä»¥ä¸ç®¡ç´¢å¼•çš„è®°å½•æ»¡ä¸æ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œæˆ‘ä»¬éƒ½æŠŠå®ƒä»¬é€‰å–å‡ºæ¥ï¼Œå¾…åˆ°ä¹‹åå›è¡¨çš„æ—¶å€™å†ä½¿ç”¨å®ƒä»¬è¿‡æ»¤ã€‚<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠä¸Šè¾¹çš„æŸ¥è¯¢ä¸­ç”¨ä¸åˆ°<code>idx_key2</code>çš„æœç´¢æ¡ä»¶æ›¿æ¢åå°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key2 &gt; <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> <span class="hljs-literal">TRUE</span>;<br></code></pre></td></tr></table></figure><p>åŒ–ç®€ä¹‹åå°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key2 &gt; <span class="hljs-number">100</span>;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´æœ€ä¸Šè¾¹é‚£ä¸ªæŸ¥è¯¢ä½¿ç”¨<code>idx_key2</code>çš„èŒƒå›´åŒºé—´å°±æ˜¯ï¼š<code>(100, +âˆ)</code>ã€‚</p><p>å†æ¥çœ‹ä¸€ä¸‹ä½¿ç”¨<code>OR</code>çš„æƒ…å†µï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key2 &gt; <span class="hljs-number">100</span> <span class="hljs-keyword">OR</span> common_field = <span class="hljs-string">&#x27;abc&#x27;</span>;<br></code></pre></td></tr></table></figure><p>åŒç†ï¼Œæˆ‘ä»¬æŠŠä½¿ç”¨ä¸åˆ°<code>idx_key2</code>ç´¢å¼•çš„æœç´¢æ¡ä»¶æ›¿æ¢ä¸º<code>TRUE</code>ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key2 &gt; <span class="hljs-number">100</span> <span class="hljs-keyword">OR</span> <span class="hljs-literal">TRUE</span>;<br></code></pre></td></tr></table></figure><p>æ¥ç€åŒ–ç®€ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> <span class="hljs-literal">TRUE</span>;<br></code></pre></td></tr></table></figure><p>é¢ï¼Œè¿™ä¹Ÿå°±è¯´è¯´æ˜å¦‚æœæˆ‘ä»¬å¼ºåˆ¶ä½¿ç”¨<code>idx_key2</code>æ‰§è¡ŒæŸ¥è¯¢çš„è¯ï¼Œå¯¹åº”çš„èŒƒå›´åŒºé—´å°±æ˜¯<code>(-âˆ, +âˆ)</code>ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å°†å…¨éƒ¨äºŒçº§ç´¢å¼•çš„è®°å½•è¿›è¡Œå›è¡¨ï¼Œè¿™ä¸ªä»£ä»·è‚¯å®šæ¯”ç›´æ¥å…¨è¡¨æ‰«æéƒ½å¤§äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªä½¿ç”¨åˆ°ç´¢å¼•çš„æœç´¢æ¡ä»¶å’Œæ²¡æœ‰ä½¿ç”¨è¯¥ç´¢å¼•çš„æœç´¢æ¡ä»¶ä½¿ç”¨<code>OR</code>è¿æ¥èµ·æ¥åæ˜¯æ— æ³•ä½¿ç”¨è¯¥ç´¢å¼•çš„ã€‚</p><h4 id="å¤æ‚æœç´¢æ¡ä»¶ä¸‹æ‰¾å‡ºèŒƒå›´åŒ¹é…çš„åŒºé—´">å¤æ‚æœç´¢æ¡ä»¶ä¸‹æ‰¾å‡ºèŒƒå›´åŒ¹é…çš„åŒºé—´</h4><p>æœ‰çš„æŸ¥è¯¢çš„æœç´¢æ¡ä»¶å¯èƒ½ç‰¹åˆ«å¤æ‚ï¼Œå…‰æ˜¯æ‰¾å‡ºèŒƒå›´åŒ¹é…çš„å„ä¸ªåŒºé—´å°±æŒºçƒ¦çš„ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> <br>        (key1 &gt; <span class="hljs-string">&#x27;xyz&#x27;</span> <span class="hljs-keyword">AND</span> key2 = <span class="hljs-number">748</span> ) <span class="hljs-keyword">OR</span><br>        (key1 &lt; <span class="hljs-string">&#x27;abc&#x27;</span> <span class="hljs-keyword">AND</span> key1 &gt; <span class="hljs-string">&#x27;lmn&#x27;</span>) <span class="hljs-keyword">OR</span><br>        (key1 <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%suf&#x27;</span> <span class="hljs-keyword">AND</span> key1 &gt; <span class="hljs-string">&#x27;zzz&#x27;</span> <span class="hljs-keyword">AND</span> (key2 &lt; <span class="hljs-number">8000</span> <span class="hljs-keyword">OR</span> common_field = <span class="hljs-string">&#x27;abc&#x27;</span>)) ;<br></code></pre></td></tr></table></figure><p>æˆ‘æ»´ä¸ªç¥ï¼Œè¿™ä¸ªæœç´¢æ¡ä»¶çœŸæ˜¯ç»äº†ï¼Œä¸è¿‡å¤§å®¶ä¸è¦è¢«å¤æ‚çš„è¡¨è±¡è¿·ä½äº†åŒçœ¼ï¼ŒæŒ‰ç€ä¸‹è¾¹è¿™ä¸ªå¥—è·¯åˆ†æä¸€ä¸‹ï¼š</p><ul><li><p>é¦–å…ˆæŸ¥çœ‹<code>WHERE</code>å­å¥ä¸­çš„æœç´¢æ¡ä»¶éƒ½æ¶‰åŠåˆ°äº†å“ªäº›åˆ—ï¼Œå“ªäº›åˆ—å¯èƒ½ä½¿ç”¨åˆ°ç´¢å¼•ã€‚</p><p>è¿™ä¸ªæŸ¥è¯¢çš„æœç´¢æ¡ä»¶æ¶‰åŠåˆ°äº†<code>key1</code>ã€<code>key2</code>ã€<code>common_field</code>è¿™3ä¸ªåˆ—ï¼Œç„¶å<code>key1</code>åˆ—æœ‰æ™®é€šçš„äºŒçº§ç´¢å¼•<code>idx_key1</code>ï¼Œ<code>key2</code>åˆ—æœ‰å”¯ä¸€äºŒçº§ç´¢å¼•<code>idx_key2</code>ã€‚</p></li><li><p>å¯¹äºé‚£äº›å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•ï¼Œåˆ†æå®ƒä»¬çš„èŒƒå›´åŒºé—´ã€‚</p><ul><li><p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨<code>idx_key1</code>æ‰§è¡ŒæŸ¥è¯¢</p><ul><li><p>æˆ‘ä»¬éœ€è¦æŠŠé‚£äº›ç”¨ä¸åˆ°è¯¥ç´¢å¼•çš„æœç´¢æ¡ä»¶æš‚æ—¶ç§»é™¤æ‰ï¼Œç§»é™¤æ–¹æ³•ä¹Ÿç®€å•ï¼Œç›´æ¥æŠŠå®ƒä»¬æ›¿æ¢ä¸º<code>TRUE</code>å°±å¥½äº†ã€‚ä¸Šè¾¹çš„æŸ¥è¯¢ä¸­é™¤äº†æœ‰å…³<code>key2</code>å’Œ<code>common_field</code>åˆ—ä¸èƒ½ä½¿ç”¨åˆ°<code>idx_key1</code>ç´¢å¼•å¤–ï¼Œ<code>key1 LIKE '%suf'</code>ä¹Ÿä½¿ç”¨ä¸åˆ°ç´¢å¼•ï¼Œæ‰€ä»¥æŠŠè¿™äº›æœç´¢æ¡ä»¶æ›¿æ¢ä¸º<code>TRUE</code>ä¹‹åçš„æ ·å­å°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">(key1 &gt; <span class="hljs-symbol">&#x27;xyz</span>&#x27; <span class="hljs-keyword">AND</span> <span class="hljs-literal">TRUE</span> ) <span class="hljs-keyword">OR</span><br>(key1 &lt; <span class="hljs-symbol">&#x27;abc</span>&#x27; <span class="hljs-keyword">AND</span> key1 &gt; <span class="hljs-symbol">&#x27;lmn</span>&#x27;) <span class="hljs-keyword">OR</span><br>(<span class="hljs-literal">TRUE</span> <span class="hljs-keyword">AND</span> key1 &gt; <span class="hljs-symbol">&#x27;zzz</span>&#x27; <span class="hljs-keyword">AND</span> (<span class="hljs-literal">TRUE</span> <span class="hljs-keyword">OR</span> <span class="hljs-literal">TRUE</span>))<br></code></pre></td></tr></table></figure><p>åŒ–ç®€ä¸€ä¸‹ä¸Šè¾¹çš„æœç´¢æ¡ä»¶å°±æ˜¯ä¸‹è¾¹è¿™æ ·ï¼š</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lisp">(<span class="hljs-name">key1</span> &gt; &#x27;xyz&#x27;) OR<br>(<span class="hljs-name">key1</span> &lt; &#x27;abc&#x27; AND key1 &gt; &#x27;lmn&#x27;) OR<br>(<span class="hljs-name">key1</span> &gt; &#x27;zzz&#x27;)<br></code></pre></td></tr></table></figure></li><li><p>æ›¿æ¢æ‰æ°¸è¿œä¸º<code>TRUE</code>æˆ–<code>FALSE</code>çš„æ¡ä»¶</p><p>å› ä¸ºç¬¦åˆ<code>key1 &lt; 'abc' AND key1 &gt; 'lmn'</code>æ°¸è¿œä¸º<code>FALSE</code>ï¼Œæ‰€ä»¥ä¸Šè¾¹çš„æœç´¢æ¡ä»¶å¯ä»¥è¢«å†™æˆè¿™æ ·ï¼š</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">(<span class="hljs-name">key1</span> &gt; &#x27;xyz&#x27;) OR (<span class="hljs-name">key1</span> &gt; &#x27;zzz&#x27;)<br></code></pre></td></tr></table></figure></li><li><p>ç»§ç»­åŒ–ç®€åŒºé—´</p><p><code>key1 &gt; 'xyz'</code>å’Œ<code>key1 &gt; 'zzz'</code>ä¹‹é—´ä½¿ç”¨<code>OR</code>æ“ä½œç¬¦è¿æ¥èµ·æ¥çš„ï¼Œæ„å‘³ç€è¦å–å¹¶é›†ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ç»“æœåŒ–ç®€çš„åˆ°çš„åŒºé—´å°±æ˜¯ï¼š<code>key1 &gt; xyz</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šä¸Šè¾¹é‚£ä¸ªæœ‰ä¸€å¨æœç´¢æ¡ä»¶çš„æŸ¥è¯¢è¯­å¥å¦‚æœä½¿ç”¨ idx_key1 ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢çš„è¯ï¼Œéœ€è¦æŠŠæ»¡è¶³<code>key1 &gt; xyz</code>çš„äºŒçº§ç´¢å¼•è®°å½•éƒ½å–å‡ºæ¥ï¼Œç„¶åæ‹¿ç€è¿™äº›è®°å½•çš„idå†è¿›è¡Œå›è¡¨ï¼Œå¾—åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ä¹‹åå†ä½¿ç”¨å…¶ä»–çš„æœç´¢æ¡ä»¶è¿›è¡Œè¿‡æ»¤ã€‚</p></li></ul></li><li><p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨<code>idx_key2</code>æ‰§è¡ŒæŸ¥è¯¢</p><ul><li><p>æˆ‘ä»¬éœ€è¦æŠŠé‚£äº›ç”¨ä¸åˆ°è¯¥ç´¢å¼•çš„æœç´¢æ¡ä»¶æš‚æ—¶ä½¿ç”¨<code>TRUE</code>æ¡ä»¶æ›¿æ¢æ‰ï¼Œå…¶ä¸­æœ‰å…³<code>key1</code>å’Œ<code>common_field</code>çš„æœç´¢æ¡ä»¶éƒ½éœ€è¦è¢«æ›¿æ¢æ‰ï¼Œæ›¿æ¢ç»“æœå°±æ˜¯ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">(TRUE <span class="hljs-keyword">AND </span>key2 = <span class="hljs-number">748</span> ) <span class="hljs-keyword">OR</span><br><span class="hljs-keyword"></span>(TRUE <span class="hljs-keyword">AND </span>TRUE) <span class="hljs-keyword">OR</span><br><span class="hljs-keyword"></span>(TRUE <span class="hljs-keyword">AND </span>TRUE <span class="hljs-keyword">AND </span>(key2 &lt; <span class="hljs-number">8000</span> <span class="hljs-keyword">OR </span>TRUE))<br></code></pre></td></tr></table></figure><p>å“å‘€å‘€ï¼Œ<code>key2 &lt; 8000 OR TRUE</code>çš„ç»“æœè‚¯å®šæ˜¯<code>TRUE</code>å‘€ï¼Œä¹Ÿå°±æ˜¯è¯´åŒ–ç®€ä¹‹åçš„æœç´¢æ¡ä»¶æˆè¿™æ ·äº†ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">key2</span> = <span class="hljs-number">748</span> OR <span class="hljs-literal">TRUE</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªåŒ–ç®€ä¹‹åçš„ç»“æœå°±æ›´ç®€å•äº†ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-literal">TRUE</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç»“æœä¹Ÿå°±æ„å‘³ç€å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨<code>idx_key2</code>ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„è¯ï¼Œéœ€è¦æ‰«æ<code>idx_key2</code>äºŒçº§ç´¢å¼•çš„æ‰€æœ‰è®°å½•ï¼Œç„¶åå†å›è¡¨ï¼Œè¿™ä¸æ˜¯å¾—ä¸å¿å¤±ä¹ˆï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ä¸ä¼šä½¿ç”¨<code>idx_key2</code>ç´¢å¼•çš„ã€‚</p></li></ul></li></ul></li></ul><h3 id="ç´¢å¼•åˆå¹¶">ç´¢å¼•åˆå¹¶</h3><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡<code>MySQL</code>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢æ—¶æœ€å¤šåªä¼šç”¨åˆ°å•ä¸ªäºŒçº§ç´¢å¼•ï¼Œä½†ä¸æ˜¯è¿˜æœ‰ç‰¹æ®Šæƒ…å†µä¹ˆï¼Œåœ¨è¿™äº›ç‰¹æ®Šæƒ…å†µä¸‹ä¹Ÿå¯èƒ½åœ¨ä¸€ä¸ªæŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°å¤šä¸ªäºŒçº§ç´¢å¼•ï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”æŠŠè¿™ç§ä½¿ç”¨åˆ°å¤šä¸ªç´¢å¼•æ¥å®Œæˆä¸€æ¬¡æŸ¥è¯¢çš„æ‰§è¡Œæ–¹æ³•ç§°ä¹‹ä¸ºï¼š<code>index merge</code>ï¼Œå…·ä½“çš„ç´¢å¼•åˆå¹¶ç®—æ³•æœ‰ä¸‹è¾¹ä¸‰ç§ã€‚</p><h4 id="Intersectionåˆå¹¶">Intersectionåˆå¹¶</h4><p><code>Intersection</code>ç¿»è¯‘è¿‡æ¥çš„æ„æ€æ˜¯<code>äº¤é›†</code>ã€‚è¿™é‡Œæ˜¯è¯´æŸä¸ªæŸ¥è¯¢å¯ä»¥ä½¿ç”¨å¤šä¸ªäºŒçº§ç´¢å¼•ï¼Œå°†ä»å¤šä¸ªäºŒçº§ç´¢å¼•ä¸­æŸ¥è¯¢åˆ°çš„ç»“æœå–äº¤é›†ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">AND</span> key3 = <span class="hljs-string">&#x27;b&#x27;</span>;<br></code></pre></td></tr></table></figure><p>å‡è®¾è¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨<code>Intersection</code>åˆå¹¶çš„æ–¹å¼æ‰§è¡Œçš„è¯ï¼Œé‚£è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>ä»<code>idx_key1</code>äºŒçº§ç´¢å¼•å¯¹åº”çš„<code>B+</code>æ ‘ä¸­å–å‡º<code>key1 = 'a'</code>çš„ç›¸å…³è®°å½•ã€‚</li><li>ä»<code>idx_key3</code>äºŒçº§ç´¢å¼•å¯¹åº”çš„<code>B+</code>æ ‘ä¸­å–å‡º<code>key3 = 'b'</code>çš„ç›¸å…³è®°å½•ã€‚</li><li>äºŒçº§ç´¢å¼•çš„è®°å½•éƒ½æ˜¯ç”±<code>ç´¢å¼•åˆ— + ä¸»é”®</code>æ„æˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºè¿™ä¸¤ä¸ªç»“æœé›†ä¸­<code>id</code>å€¼çš„äº¤é›†ã€‚</li><li>æŒ‰ç…§ä¸Šä¸€æ­¥ç”Ÿæˆçš„<code>id</code>å€¼åˆ—è¡¨è¿›è¡Œå›è¡¨æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä»èšç°‡ç´¢å¼•ä¸­æŠŠæŒ‡å®š<code>id</code>å€¼çš„å®Œæ•´ç”¨æˆ·è®°å½•å–å‡ºæ¥ï¼Œè¿”å›ç»™ç”¨æˆ·ã€‚</li></ul><p>è¿™é‡Œæœ‰åŒå­¦ä¼šæ€è€ƒï¼šä¸ºå•¥ä¸ç›´æ¥ä½¿ç”¨<code>idx_key1</code>æˆ–è€…<code>idx_key3</code>åªæ ¹æ®æŸä¸ªæœç´¢æ¡ä»¶å»è¯»å–ä¸€ä¸ªäºŒçº§ç´¢å¼•ï¼Œç„¶åå›è¡¨åå†è¿‡æ»¤å¦å¤–ä¸€ä¸ªæœç´¢æ¡ä»¶å‘¢ï¼Ÿè¿™é‡Œè¦åˆ†æä¸€ä¸‹ä¸¤ç§æŸ¥è¯¢æ‰§è¡Œæ–¹å¼ä¹‹é—´éœ€è¦çš„æˆæœ¬ä»£ä»·ã€‚</p><p>åªè¯»å–ä¸€ä¸ªäºŒçº§ç´¢å¼•çš„æˆæœ¬ï¼š</p><ul><li>æŒ‰ç…§æŸä¸ªæœç´¢æ¡ä»¶è¯»å–ä¸€ä¸ªäºŒçº§ç´¢å¼•</li><li>æ ¹æ®ä»è¯¥äºŒçº§ç´¢å¼•å¾—åˆ°çš„ä¸»é”®å€¼è¿›è¡Œå›è¡¨æ“ä½œï¼Œç„¶åå†è¿‡æ»¤å…¶ä»–çš„æœç´¢æ¡ä»¶</li></ul><p>è¯»å–å¤šä¸ªäºŒçº§ç´¢å¼•ä¹‹åå–äº¤é›†æˆæœ¬ï¼š</p><ul><li>æŒ‰ç…§ä¸åŒçš„æœç´¢æ¡ä»¶åˆ†åˆ«è¯»å–ä¸åŒçš„äºŒçº§ç´¢å¼•</li><li>å°†ä»å¤šä¸ªäºŒçº§ç´¢å¼•å¾—åˆ°çš„ä¸»é”®å€¼å–äº¤é›†ï¼Œç„¶åè¿›è¡Œå›è¡¨æ“ä½œ</li></ul><p>è™½ç„¶è¯»å–å¤šä¸ªäºŒçº§ç´¢å¼•æ¯”è¯»å–ä¸€ä¸ªäºŒçº§ç´¢å¼•æ¶ˆè€—æ€§èƒ½ï¼Œä½†æ˜¯è¯»å–äºŒçº§ç´¢å¼•çš„æ“ä½œæ˜¯<code>é¡ºåºI/O</code>ï¼Œè€Œå›è¡¨æ“ä½œæ˜¯<code>éšæœºI/O</code>ï¼Œæ‰€ä»¥å¦‚æœåªè¯»å–ä¸€ä¸ªäºŒçº§ç´¢å¼•æ—¶éœ€è¦å›è¡¨çš„è®°å½•æ•°ç‰¹åˆ«å¤šï¼Œè€Œè¯»å–å¤šä¸ªäºŒçº§ç´¢å¼•ä¹‹åå–äº¤é›†çš„è®°å½•æ•°éå¸¸å°‘ï¼Œå½“èŠ‚çœçš„å› ä¸º<code>å›è¡¨</code>è€Œé€ æˆçš„æ€§èƒ½æŸè€—æ¯”è®¿é—®å¤šä¸ªäºŒçº§ç´¢å¼•å¸¦æ¥çš„æ€§èƒ½æŸè€—æ›´é«˜æ—¶ï¼Œè¯»å–å¤šä¸ªäºŒçº§ç´¢å¼•åå–äº¤é›†æ¯”åªè¯»å–ä¸€ä¸ªäºŒçº§ç´¢å¼•çš„æˆæœ¬æ›´ä½ã€‚</p><p><code>MySQL</code>åœ¨æŸäº›ç‰¹å®šçš„æƒ…å†µä¸‹æ‰å¯èƒ½ä¼šä½¿ç”¨åˆ°<code>Intersection</code>ç´¢å¼•åˆå¹¶ï¼š</p><ul><li><p>æƒ…å†µä¸€ï¼š<strong>äºŒçº§ç´¢å¼•åˆ—æ˜¯ç­‰å€¼åŒ¹é…çš„æƒ…å†µï¼Œå¯¹äºè”åˆç´¢å¼•æ¥è¯´ï¼Œåœ¨è”åˆç´¢å¼•ä¸­çš„æ¯ä¸ªåˆ—éƒ½å¿…é¡»ç­‰å€¼åŒ¹é…ï¼Œä¸èƒ½å‡ºç°åªåŒ¹é…éƒ¨åˆ†åˆ—çš„æƒ…å†µã€‚</strong></p><p>æ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢å¯èƒ½ç”¨åˆ°<code>idx_key1</code>å’Œ<code>idx_key_part</code>è¿™ä¸¤ä¸ªäºŒçº§ç´¢å¼•è¿›è¡Œ<code>Intersection</code>ç´¢å¼•åˆå¹¶çš„æ“ä½œï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">AND</span> key_part1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">AND</span> key_part2 = <span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">AND</span> key_part3 = <span class="hljs-string">&#x27;c&#x27;</span>;<br></code></pre></td></tr></table></figure><p>è€Œä¸‹è¾¹è¿™ä¸¤ä¸ªæŸ¥è¯¢å°±ä¸èƒ½è¿›è¡Œ<code>Intersection</code>ç´¢å¼•åˆå¹¶ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 &gt; <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">AND</span> key_part1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">AND</span> key_part2 = <span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">AND</span> key_part3 = <span class="hljs-string">&#x27;c&#x27;</span>;<br><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">AND</span> key_part1 = <span class="hljs-string">&#x27;a&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªæŸ¥è¯¢æ˜¯å› ä¸ºå¯¹<code>key1</code>è¿›è¡Œäº†èŒƒå›´åŒ¹é…ï¼Œç¬¬äºŒä¸ªæŸ¥è¯¢æ˜¯å› ä¸ºè”åˆç´¢å¼•<code>idx_key_part</code>ä¸­çš„<code>key_part2</code>å’Œ<code>key_part3</code>åˆ—å¹¶æ²¡æœ‰å‡ºç°åœ¨æœç´¢æ¡ä»¶ä¸­ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæŸ¥è¯¢ä¸èƒ½è¿›è¡Œ<code>Intersection</code>ç´¢å¼•åˆå¹¶ã€‚</p></li><li><p>æƒ…å†µäºŒï¼š<strong>ä¸»é”®åˆ—å¯ä»¥æ˜¯èŒƒå›´åŒ¹é…</strong></p><p>æ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢å¯èƒ½ç”¨åˆ°ä¸»é”®å’Œ<code>idx_key1</code>è¿›è¡Œ<code>Intersection</code>ç´¢å¼•åˆå¹¶çš„æ“ä½œï¼š</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> id &gt; <span class="hljs-number">100</span> <span class="hljs-built_in">AND</span> key1 = <span class="hljs-comment">&#x27;a&#x27;;</span><br></code></pre></td></tr></table></figure></li></ul><p>ä¸ºå•¥å‘¢ï¼Ÿå‡­å•¥å‘€ï¼Ÿçªç„¶å†’å‡ºè¿™ä¹ˆä¸¤ä¸ªè§„å®šè®©å¤§å®¶ä¸€è„¸æ‡µé€¼ï¼Œä¸‹è¾¹æˆ‘ä»¬æ…¢æ…¢å“ä¸€å“è¿™é‡Œå¤´çš„ç„æœºã€‚è¿™è¯è¿˜å¾—ä»<code>InnoDB</code>çš„ç´¢å¼•ç»“æ„è¯´èµ·ï¼Œä½ è¦æ˜¯è®°ä¸æ¸…éº»çƒ¦å†å›å¤´çœ‹çœ‹ã€‚å¯¹äº<code>InnoDB</code>çš„äºŒçº§ç´¢å¼•æ¥è¯´ï¼Œè®°å½•å…ˆæ˜¯æŒ‰ç…§ç´¢å¼•åˆ—è¿›è¡Œæ’åºï¼Œå¦‚æœè¯¥äºŒçº§ç´¢å¼•æ˜¯ä¸€ä¸ªè”åˆç´¢å¼•ï¼Œé‚£ä¹ˆä¼šæŒ‰ç…§è”åˆç´¢å¼•ä¸­çš„å„ä¸ªåˆ—ä¾æ¬¡æ’åºã€‚è€ŒäºŒçº§ç´¢å¼•çš„ç”¨æˆ·è®°å½•æ˜¯ç”±<code>ç´¢å¼•åˆ— + ä¸»é”®</code>æ„æˆçš„ï¼ŒäºŒçº§ç´¢å¼•åˆ—çš„å€¼ç›¸åŒçš„è®°å½•å¯èƒ½ä¼šæœ‰å¥½å¤šæ¡ï¼Œè¿™äº›ç´¢å¼•åˆ—çš„å€¼ç›¸åŒçš„è®°å½•åˆæ˜¯æŒ‰ç…§<code>ä¸»é”®</code>çš„å€¼è¿›è¡Œæ’åºçš„ã€‚æ‰€ä»¥é‡ç‚¹æ¥äº†ï¼Œä¹‹æ‰€ä»¥åœ¨äºŒçº§ç´¢å¼•åˆ—éƒ½æ˜¯ç­‰å€¼åŒ¹é…çš„æƒ…å†µä¸‹æ‰å¯èƒ½ä½¿ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶ï¼Œæ˜¯å› ä¸ºåªæœ‰åœ¨è¿™ç§æƒ…å†µä¸‹æ ¹æ®äºŒçº§ç´¢å¼•æŸ¥è¯¢å‡ºçš„ç»“æœé›†æ˜¯æŒ‰ç…§ä¸»é”®å€¼æ’åºçš„ã€‚</p><p>soï¼Ÿè¿˜æ˜¯æ²¡çœ‹æ‡‚æ ¹æ®äºŒçº§ç´¢å¼•æŸ¥è¯¢å‡ºçš„ç»“æœé›†æ˜¯æŒ‰ç…§ä¸»é”®å€¼æ’åºçš„å¯¹ä½¿ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶æœ‰å•¥å¥½å¤„ï¼Ÿå°ä¼™å­ï¼Œåˆ«å¿˜äº†<code>Intersection</code>ç´¢å¼•åˆå¹¶ä¼šæŠŠä»å¤šä¸ªäºŒçº§ç´¢å¼•ä¸­æŸ¥è¯¢å‡ºçš„ä¸»é”®å€¼æ±‚äº¤é›†ï¼Œå¦‚æœä»å„ä¸ªäºŒçº§ç´¢å¼•ä¸­æŸ¥è¯¢çš„åˆ°çš„ç»“æœé›†æœ¬èº«å°±æ˜¯å·²ç»æŒ‰ç…§ä¸»é”®æ’å¥½åºçš„ï¼Œé‚£ä¹ˆæ±‚äº¤é›†çš„è¿‡ç¨‹å°±å¾ˆeasyå•¦ã€‚å‡è®¾æŸä¸ªæŸ¥è¯¢ä½¿ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶çš„æ–¹å¼ä»<code>idx_key1</code>å’Œ<code>idx_key2</code>è¿™ä¸¤ä¸ªäºŒçº§ç´¢å¼•ä¸­è·å–åˆ°çš„ä¸»é”®å€¼åˆ†åˆ«æ˜¯ï¼š</p><ul><li>ä»<code>idx_key1</code>ä¸­è·å–åˆ°å·²ç»æ’å¥½åºçš„ä¸»é”®å€¼ï¼š1ã€3ã€5</li><li>ä»<code>idx_key2</code>ä¸­è·å–åˆ°å·²ç»æ’å¥½åºçš„ä¸»é”®å€¼ï¼š2ã€3ã€4</li></ul><p>é‚£ä¹ˆæ±‚äº¤é›†çš„è¿‡ç¨‹å°±æ˜¯è¿™æ ·ï¼šé€ä¸ªå–å‡ºè¿™ä¸¤ä¸ªç»“æœé›†ä¸­æœ€å°çš„ä¸»é”®å€¼ï¼Œå¦‚æœä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œåˆ™åŠ å…¥æœ€åçš„äº¤é›†ç»“æœä¸­ï¼Œå¦åˆ™ä¸¢å¼ƒå½“å‰è¾ƒå°çš„ä¸»é”®å€¼ï¼Œå†å–è¯¥ä¸¢å¼ƒçš„ä¸»é”®å€¼æ‰€åœ¨ç»“æœé›†çš„åä¸€ä¸ªä¸»é”®å€¼æ¥æ¯”è¾ƒï¼Œç›´åˆ°æŸä¸ªç»“æœé›†ä¸­çš„ä¸»é”®å€¼ç”¨å®Œäº†ï¼Œå¦‚æœè¿˜æ˜¯è§‰å¾—ä¸å¤ªæ˜ç™½é‚£ç»§ç»­å¾€ä¸‹çœ‹ï¼š</p><ul><li>å…ˆå–å‡ºè¿™ä¸¤ä¸ªç»“æœé›†ä¸­è¾ƒå°çš„ä¸»é”®å€¼åšæ¯”è¾ƒï¼Œå› ä¸º<code>1 &lt; 2</code>ï¼Œæ‰€ä»¥æŠŠ<code>idx_key1</code>çš„ç»“æœé›†çš„ä¸»é”®å€¼<code>1</code>ä¸¢å¼ƒï¼Œå–å‡ºåè¾¹çš„<code>3</code>æ¥æ¯”è¾ƒã€‚</li><li>å› ä¸º<code>3 &gt; 2</code>ï¼Œæ‰€ä»¥æŠŠ<code>idx_key2</code>çš„ç»“æœé›†çš„ä¸»é”®å€¼<code>2</code>ä¸¢å¼ƒï¼Œå–å‡ºåè¾¹çš„<code>3</code>æ¥æ¯”è¾ƒã€‚</li><li>å› ä¸º<code>3 = 3</code>ï¼Œæ‰€ä»¥æŠŠ<code>3</code>åŠ å…¥åˆ°æœ€åçš„äº¤é›†ç»“æœä¸­ï¼Œç»§ç»­ä¸¤ä¸ªç»“æœé›†åè¾¹çš„ä¸»é”®å€¼æ¥æ¯”è¾ƒã€‚</li><li>åè¾¹çš„ä¸»é”®å€¼ä¹Ÿä¸ç›¸ç­‰ï¼Œæ‰€ä»¥æœ€åçš„äº¤é›†ç»“æœä¸­åªåŒ…å«ä¸»é”®å€¼<code>3</code>ã€‚</li></ul><p>åˆ«çœ‹æˆ‘ä»¬å†™çš„å•°å—¦ï¼Œè¿™ä¸ªè¿‡ç¨‹å…¶å®å¯å¿«äº†ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯<code>O(n)</code>ï¼Œä½†æ˜¯å¦‚æœä»å„ä¸ªäºŒçº§ç´¢å¼•ä¸­æŸ¥è¯¢å‡ºçš„ç»“æœé›†å¹¶ä¸æ˜¯æŒ‰ç…§ä¸»é”®æ’åºçš„è¯ï¼Œé‚£å°±è¦å…ˆæŠŠç»“æœé›†ä¸­çš„ä¸»é”®å€¼æ’åºå®Œå†æ¥åšä¸Šè¾¹çš„é‚£ä¸ªè¿‡ç¨‹ï¼Œå°±æ¯”è¾ƒè€—æ—¶äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>æŒ‰ç…§æœ‰åºçš„ä¸»é”®å€¼å»å›è¡¨å–è®°å½•æœ‰ä¸ªä¸“æœ‰åè¯å„¿ï¼Œå«ï¼šRowid Ordered Retrievalï¼Œç®€ç§°RORï¼Œä»¥åå¤§å®¶åœ¨æŸäº›åœ°æ–¹è§åˆ°è¿™ä¸ªåè¯å„¿å°±çœ¼ç†Ÿäº†ã€‚<br></code></pre></td></tr></table></figure><p>å¦å¤–ï¼Œä¸ä»…æ˜¯å¤šä¸ªäºŒçº§ç´¢å¼•ä¹‹é—´å¯ä»¥é‡‡ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶ï¼Œç´¢å¼•åˆå¹¶ä¹Ÿå¯ä»¥æœ‰èšç°‡ç´¢å¼•å‚åŠ ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šè¾¹å†™çš„<code>æƒ…å†µäºŒ</code>ï¼šåœ¨æœç´¢æ¡ä»¶ä¸­æœ‰ä¸»é”®çš„èŒƒå›´åŒ¹é…çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ä½¿ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶ç´¢å¼•åˆå¹¶ã€‚ä¸ºå•¥ä¸»é”®è¿™å°±å¯ä»¥èŒƒå›´åŒ¹é…äº†ï¼Ÿè¿˜æ˜¯å¾—å›åˆ°åº”ç”¨åœºæ™¯é‡Œï¼Œæ¯”å¦‚çœ‹ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 = <span class="hljs-comment">&#x27;a&#x27; AND id &gt; 100;</span><br></code></pre></td></tr></table></figure><p>å‡è®¾è¿™ä¸ªæŸ¥è¯¢å¯ä»¥é‡‡ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶ï¼Œæˆ‘ä»¬ç†æ‰€å½“ç„¶çš„ä»¥ä¸ºè¿™ä¸ªæŸ¥è¯¢ä¼šåˆ†åˆ«æŒ‰ç…§<code>id &gt; 100</code>è¿™ä¸ªæ¡ä»¶ä»èšç°‡ç´¢å¼•ä¸­è·å–ä¸€äº›è®°å½•ï¼Œåœ¨é€šè¿‡<code>key1 = 'a'</code>è¿™ä¸ªæ¡ä»¶ä»<code>idx_key1</code>äºŒçº§ç´¢å¼•ä¸­è·å–ä¸€äº›è®°å½•ï¼Œç„¶åå†æ±‚äº¤é›†ï¼Œå…¶å®è¿™æ ·å°±æŠŠé—®é¢˜å¤æ‚åŒ–äº†ï¼Œæ²¡å¿…è¦ä»èšç°‡ç´¢å¼•ä¸­è·å–ä¸€æ¬¡è®°å½•ã€‚åˆ«å¿˜äº†äºŒçº§ç´¢å¼•çš„è®°å½•ä¸­éƒ½å¸¦æœ‰ä¸»é”®å€¼çš„ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä»<code>idx_key1</code>ä¸­è·å–åˆ°çš„ä¸»é”®å€¼ä¸Šç›´æ¥è¿ç”¨æ¡ä»¶<code>id &gt; 100</code>è¿‡æ»¤å°±è¡Œäº†ï¼Œè¿™æ ·å¤šç®€å•ã€‚æ‰€ä»¥æ¶‰åŠä¸»é”®çš„æœç´¢æ¡ä»¶åªä¸è¿‡æ˜¯ä¸ºäº†ä»åˆ«çš„äºŒçº§ç´¢å¼•å¾—åˆ°çš„ç»“æœé›†ä¸­è¿‡æ»¤è®°å½•ç½¢äº†ï¼Œæ˜¯ä¸æ˜¯ç­‰å€¼åŒ¹é…ä¸é‡è¦ã€‚</p><p>å½“ç„¶ï¼Œä¸Šè¾¹è¯´çš„<code>æƒ…å†µä¸€</code>å’Œ<code>æƒ…å†µäºŒ</code>åªæ˜¯å‘ç”Ÿ<code>Intersection</code>ç´¢å¼•åˆå¹¶çš„å¿…è¦æ¡ä»¶ï¼Œä¸æ˜¯å……åˆ†æ¡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´å³ä½¿æƒ…å†µä¸€ã€æƒ…å†µäºŒæˆç«‹ï¼Œä¹Ÿä¸ä¸€å®šå‘ç”Ÿ<code>Intersection</code>ç´¢å¼•åˆå¹¶ï¼Œè¿™å¾—çœ‹ä¼˜åŒ–å™¨çš„å¿ƒæƒ…ã€‚ä¼˜åŒ–å™¨åªæœ‰åœ¨å•ç‹¬æ ¹æ®æœç´¢æ¡ä»¶ä»æŸä¸ªäºŒçº§ç´¢å¼•ä¸­è·å–çš„è®°å½•æ•°å¤ªå¤šï¼Œå¯¼è‡´å›è¡¨å¼€é”€å¤ªå¤§ï¼Œè€Œé€šè¿‡<code>Intersection</code>ç´¢å¼•åˆå¹¶åéœ€è¦å›è¡¨çš„è®°å½•æ•°å¤§å¤§å‡å°‘æ—¶æ‰ä¼šä½¿ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶ã€‚</p><h4 id="Unionåˆå¹¶">Unionåˆå¹¶</h4><p>æˆ‘ä»¬åœ¨å†™æŸ¥è¯¢è¯­å¥æ—¶ç»å¸¸æƒ³æŠŠæ—¢ç¬¦åˆæŸä¸ªæœç´¢æ¡ä»¶çš„è®°å½•å–å‡ºæ¥ï¼Œä¹ŸæŠŠç¬¦åˆå¦å¤–çš„æŸä¸ªæœç´¢æ¡ä»¶çš„è®°å½•å–å‡ºæ¥ï¼Œæˆ‘ä»¬è¯´è¿™äº›ä¸åŒçš„æœç´¢æ¡ä»¶ä¹‹é—´æ˜¯<code>OR</code>å…³ç³»ã€‚æœ‰æ—¶å€™<code>OR</code>å…³ç³»çš„ä¸åŒæœç´¢æ¡ä»¶ä¼šä½¿ç”¨åˆ°ä¸åŒçš„ç´¢å¼•ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">OR</span> key3 = <span class="hljs-string">&#x27;b&#x27;</span><br></code></pre></td></tr></table></figure><p><code>Intersection</code>æ˜¯äº¤é›†çš„æ„æ€ï¼Œè¿™é€‚ç”¨äºä½¿ç”¨ä¸åŒç´¢å¼•çš„æœç´¢æ¡ä»¶ä¹‹é—´ä½¿ç”¨<code>AND</code>è¿æ¥èµ·æ¥çš„æƒ…å†µï¼›<code>Union</code>æ˜¯å¹¶é›†çš„æ„æ€ï¼Œé€‚ç”¨äºä½¿ç”¨ä¸åŒç´¢å¼•çš„æœç´¢æ¡ä»¶ä¹‹é—´ä½¿ç”¨<code>OR</code>è¿æ¥èµ·æ¥çš„æƒ…å†µã€‚ä¸<code>Intersection</code>ç´¢å¼•åˆå¹¶ç±»ä¼¼ï¼Œ<code>MySQL</code>åœ¨æŸäº›ç‰¹å®šçš„æƒ…å†µä¸‹æ‰å¯èƒ½ä¼šä½¿ç”¨åˆ°<code>Union</code>ç´¢å¼•åˆå¹¶ï¼š</p><ul><li><p>æƒ…å†µä¸€ï¼š<strong>äºŒçº§ç´¢å¼•åˆ—æ˜¯ç­‰å€¼åŒ¹é…çš„æƒ…å†µï¼Œå¯¹äºè”åˆç´¢å¼•æ¥è¯´ï¼Œåœ¨è”åˆç´¢å¼•ä¸­çš„æ¯ä¸ªåˆ—éƒ½å¿…é¡»ç­‰å€¼åŒ¹é…ï¼Œä¸èƒ½å‡ºç°åªå‡ºç°åŒ¹é…éƒ¨åˆ†åˆ—çš„æƒ…å†µã€‚</strong></p><p>æ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢å¯èƒ½ç”¨åˆ°<code>idx_key1</code>å’Œ<code>idx_key_part</code>è¿™ä¸¤ä¸ªäºŒçº§ç´¢å¼•è¿›è¡Œ<code>Union</code>ç´¢å¼•åˆå¹¶çš„æ“ä½œï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">OR</span> ( key_part1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">AND</span> key_part2 = <span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">AND</span> key_part3 = <span class="hljs-string">&#x27;c&#x27;</span>);<br></code></pre></td></tr></table></figure><p>è€Œä¸‹è¾¹è¿™ä¸¤ä¸ªæŸ¥è¯¢å°±ä¸èƒ½è¿›è¡Œ<code>Union</code>ç´¢å¼•åˆå¹¶ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 &gt; <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">OR</span> (key_part1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">AND</span> key_part2 = <span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">AND</span> key_part3 = <span class="hljs-string">&#x27;c&#x27;</span>);<br><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">OR</span> key_part1 = <span class="hljs-string">&#x27;a&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªæŸ¥è¯¢æ˜¯å› ä¸ºå¯¹<code>key1</code>è¿›è¡Œäº†èŒƒå›´åŒ¹é…ï¼Œç¬¬äºŒä¸ªæŸ¥è¯¢æ˜¯å› ä¸ºè”åˆç´¢å¼•<code>idx_key_part</code>ä¸­çš„<code>key_part2</code>å’Œ<code>key_part3</code>åˆ—å¹¶æ²¡æœ‰å‡ºç°åœ¨æœç´¢æ¡ä»¶ä¸­ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæŸ¥è¯¢ä¸èƒ½è¿›è¡Œ<code>Union</code>ç´¢å¼•åˆå¹¶ã€‚</p></li><li><p>æƒ…å†µäºŒï¼š<strong>ä¸»é”®åˆ—å¯ä»¥æ˜¯èŒƒå›´åŒ¹é…</strong></p></li><li><p>æƒ…å†µä¸‰ï¼š<strong>ä½¿ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶çš„æœç´¢æ¡ä»¶</strong></p><p>è¿™ç§æƒ…å†µå…¶å®ä¹ŸæŒºå¥½ç†è§£ï¼Œå°±æ˜¯æœç´¢æ¡ä»¶çš„æŸäº›éƒ¨åˆ†ä½¿ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶çš„æ–¹å¼å¾—åˆ°çš„ä¸»é”®é›†åˆå’Œå…¶ä»–æ–¹å¼å¾—åˆ°çš„ä¸»é”®é›†åˆå–äº¤é›†ï¼Œæ¯”æ–¹è¯´è¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key_part1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">AND</span> key_part2 = <span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">AND</span> key_part3 = <span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">OR</span> (key1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">AND</span> key3 = <span class="hljs-string">&#x27;b&#x27;</span>);<br></code></pre></td></tr></table></figure><p>ä¼˜åŒ–å™¨å¯èƒ½é‡‡ç”¨è¿™æ ·çš„æ–¹å¼æ¥æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢ï¼š</p><ul><li>å…ˆæŒ‰ç…§æœç´¢æ¡ä»¶<code>key1 = 'a' AND key3 = 'b'</code>ä»ç´¢å¼•<code>idx_key1</code>å’Œ<code>idx_key3</code>ä¸­ä½¿ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶çš„æ–¹å¼å¾—åˆ°ä¸€ä¸ªä¸»é”®é›†åˆã€‚</li><li>å†æŒ‰ç…§æœç´¢æ¡ä»¶<code>key_part1 = 'a' AND key_part2 = 'b' AND key_part3 = 'c'</code>ä»è”åˆç´¢å¼•<code>idx_key_part</code>ä¸­å¾—åˆ°å¦ä¸€ä¸ªä¸»é”®é›†åˆã€‚</li><li>é‡‡ç”¨<code>Union</code>ç´¢å¼•åˆå¹¶çš„æ–¹å¼æŠŠä¸Šè¿°ä¸¤ä¸ªä¸»é”®é›†åˆå–å¹¶é›†ï¼Œç„¶åè¿›è¡Œå›è¡¨æ“ä½œï¼Œå°†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</li></ul></li></ul><p>å½“ç„¶ï¼ŒæŸ¥è¯¢æ¡ä»¶ç¬¦åˆäº†è¿™äº›æƒ…å†µä¹Ÿä¸ä¸€å®šå°±ä¼šé‡‡ç”¨<code>Union</code>ç´¢å¼•åˆå¹¶ï¼Œä¹Ÿå¾—çœ‹ä¼˜åŒ–å™¨çš„å¿ƒæƒ…ã€‚ä¼˜åŒ–å™¨åªæœ‰åœ¨å•ç‹¬æ ¹æ®æœç´¢æ¡ä»¶ä»æŸä¸ªäºŒçº§ç´¢å¼•ä¸­è·å–çš„è®°å½•æ•°æ¯”è¾ƒå°‘ï¼Œé€šè¿‡<code>Union</code>ç´¢å¼•åˆå¹¶åè¿›è¡Œè®¿é—®çš„ä»£ä»·æ¯”å…¨è¡¨æ‰«ææ›´å°æ—¶æ‰ä¼šä½¿ç”¨<code>Union</code>ç´¢å¼•åˆå¹¶ã€‚</p><h4 id="Sort-Unionåˆå¹¶">Sort-Unionåˆå¹¶</h4><p><code>Union</code>ç´¢å¼•åˆå¹¶çš„ä½¿ç”¨æ¡ä»¶å¤ªè‹›åˆ»ï¼Œå¿…é¡»ä¿è¯å„ä¸ªäºŒçº§ç´¢å¼•åˆ—åœ¨è¿›è¡Œç­‰å€¼åŒ¹é…çš„æ¡ä»¶ä¸‹æ‰å¯èƒ½è¢«ç”¨åˆ°ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢å°±æ— æ³•ä½¿ç”¨åˆ°<code>Union</code>ç´¢å¼•åˆå¹¶ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 &lt; <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">OR</span> key3 &gt; <span class="hljs-string">&#x27;z&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºæ ¹æ®<code>key1 &lt; 'a'</code>ä»<code>idx_key1</code>ç´¢å¼•ä¸­è·å–çš„äºŒçº§ç´¢å¼•è®°å½•çš„ä¸»é”®å€¼ä¸æ˜¯æ’å¥½åºçš„ï¼Œæ ¹æ®<code>key3 &gt; 'z'</code>ä»<code>idx_key3</code>ç´¢å¼•ä¸­è·å–çš„äºŒçº§ç´¢å¼•è®°å½•çš„ä¸»é”®å€¼ä¹Ÿä¸æ˜¯æ’å¥½åºçš„ï¼Œä½†æ˜¯<code>key1 &lt; 'a'</code>å’Œ<code>key3 &gt; 'z'</code>è¿™ä¸¤ä¸ªæ¡ä»¶åˆç‰¹åˆ«è®©æˆ‘ä»¬åŠ¨å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š</p><ul><li>å…ˆæ ¹æ®<code>key1 &lt; 'a'</code>æ¡ä»¶ä»<code>idx_key1</code>äºŒçº§ç´¢å¼•ä¸­è·å–è®°å½•ï¼Œå¹¶æŒ‰ç…§è®°å½•çš„ä¸»é”®å€¼è¿›è¡Œæ’åº</li><li>å†æ ¹æ®<code>key3 &gt; 'z'</code>æ¡ä»¶ä»<code>idx_key3</code>äºŒçº§ç´¢å¼•ä¸­è·å–è®°å½•ï¼Œå¹¶æŒ‰ç…§è®°å½•çš„ä¸»é”®å€¼è¿›è¡Œæ’åº</li><li>å› ä¸ºä¸Šè¿°çš„ä¸¤ä¸ªäºŒçº§ç´¢å¼•ä¸»é”®å€¼éƒ½æ˜¯æ’å¥½åºçš„ï¼Œå‰©ä¸‹çš„æ“ä½œå’Œ<code>Union</code>ç´¢å¼•åˆå¹¶æ–¹å¼å°±ä¸€æ ·äº†ã€‚</li></ul><p>æˆ‘ä»¬æŠŠä¸Šè¿°è¿™ç§å…ˆæŒ‰ç…§äºŒçº§ç´¢å¼•è®°å½•çš„ä¸»é”®å€¼è¿›è¡Œæ’åºï¼Œä¹‹åæŒ‰ç…§<code>Union</code>ç´¢å¼•åˆå¹¶æ–¹å¼æ‰§è¡Œçš„æ–¹å¼ç§°ä¹‹ä¸º<code>Sort-Union</code>ç´¢å¼•åˆå¹¶ï¼Œå¾ˆæ˜¾ç„¶ï¼Œè¿™ç§<code>Sort-Union</code>ç´¢å¼•åˆå¹¶æ¯”å•çº¯çš„<code>Union</code>ç´¢å¼•åˆå¹¶å¤šäº†ä¸€æ­¥å¯¹äºŒçº§ç´¢å¼•è®°å½•çš„ä¸»é”®å€¼æ’åºçš„è¿‡ç¨‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>ä¸ºå•¥æœ‰Sort-Unionç´¢å¼•åˆå¹¶ï¼Œå°±æ²¡æœ‰Sort-Intersectionç´¢å¼•åˆå¹¶ä¹ˆï¼Ÿæ˜¯çš„ï¼Œçš„ç¡®æ²¡æœ‰Sort-Intersectionç´¢å¼•åˆå¹¶è¿™ä¹ˆä¸€è¯´ï¼Œ<br><br>Sort-Unionçš„é€‚ç”¨åœºæ™¯æ˜¯å•ç‹¬æ ¹æ®æœç´¢æ¡ä»¶ä»æŸä¸ªäºŒçº§ç´¢å¼•ä¸­è·å–çš„è®°å½•æ•°æ¯”è¾ƒå°‘ï¼Œè¿™æ ·å³ä½¿å¯¹è¿™äº›äºŒçº§ç´¢å¼•è®°å½•æŒ‰ç…§ä¸»é”®å€¼è¿›è¡Œæ’åºçš„æˆæœ¬ä¹Ÿä¸ä¼šå¤ªé«˜<br><br>è€ŒIntersectionç´¢å¼•åˆå¹¶çš„é€‚ç”¨åœºæ™¯æ˜¯å•ç‹¬æ ¹æ®æœç´¢æ¡ä»¶ä»æŸä¸ªäºŒçº§ç´¢å¼•ä¸­è·å–çš„è®°å½•æ•°å¤ªå¤šï¼Œå¯¼è‡´å›è¡¨å¼€é”€å¤ªå¤§ï¼Œåˆå¹¶åå¯ä»¥æ˜æ˜¾é™ä½å›è¡¨å¼€é”€ï¼Œä½†æ˜¯å¦‚æœåŠ å…¥Sort-Intersectionåï¼Œå°±éœ€è¦ä¸ºå¤§é‡çš„äºŒçº§ç´¢å¼•è®°å½•æŒ‰ç…§ä¸»é”®å€¼è¿›è¡Œæ’åºï¼Œè¿™ä¸ªæˆæœ¬å¯èƒ½æ¯”å›è¡¨æŸ¥è¯¢éƒ½é«˜äº†ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡æœ‰å¼•å…¥Sort-Intersectionè¿™ä¸ªç©æ„å„¿ã€‚<br></code></pre></td></tr></table></figure><h4 id="ç´¢å¼•åˆå¹¶æ³¨æ„äº‹é¡¹">ç´¢å¼•åˆå¹¶æ³¨æ„äº‹é¡¹</h4><h4 id="è”åˆç´¢å¼•æ›¿ä»£Intersectionç´¢å¼•åˆå¹¶">è”åˆç´¢å¼•æ›¿ä»£Intersectionç´¢å¼•åˆå¹¶</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> key1 = <span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">AND</span> key3 = <span class="hljs-string">&#x27;b&#x27;</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢ä¹‹æ‰€ä»¥å¯èƒ½ä½¿ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶çš„æ–¹å¼æ‰§è¡Œï¼Œè¿˜ä¸æ˜¯å› ä¸º<code>idx_key1</code>å’Œ<code>idx_key3</code>æ˜¯ä¸¤ä¸ªå•ç‹¬çš„<code>B+</code>æ ‘ç´¢å¼•ï¼Œä½ è¦æ˜¯æŠŠè¿™ä¸¤ä¸ªåˆ—æä¸€ä¸ªè”åˆç´¢å¼•ï¼Œé‚£ç›´æ¥ä½¿ç”¨è¿™ä¸ªè”åˆç´¢å¼•å°±æŠŠäº‹æƒ…æå®šäº†ï¼Œä½•å¿…ç”¨å•¥ç´¢å¼•åˆå¹¶å‘¢ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ALTER</span> TABLE single_table drop index idx_key<span class="hljs-number">1</span>, idx_key<span class="hljs-number">3</span>, add index idx_key<span class="hljs-number">1</span>_key<span class="hljs-number">3</span>(key<span class="hljs-number">1</span>, key<span class="hljs-number">3</span>);<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬æŠŠæ²¡ç”¨çš„<code>idx_key1</code>ã€<code>idx_key3</code>éƒ½å¹²æ‰ï¼Œå†æ·»åŠ ä¸€ä¸ªè”åˆç´¢å¼•<code>idx_key1_key3</code>ï¼Œä½¿ç”¨è¿™ä¸ªè”åˆç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ç®€ç›´æ˜¯åˆå¿«åˆå¥½ï¼Œæ—¢ä¸ç”¨å¤šè¯»ä¸€æ£µ<code>B+</code>æ ‘ï¼Œä¹Ÿä¸ç”¨åˆå¹¶ç»“æœï¼Œä½•ä¹è€Œä¸ä¸ºï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å°è´´å£«ï¼š<br><br>ä¸è¿‡å°å¿ƒæœ‰å•ç‹¬å¯¹key3åˆ—è¿›è¡ŒæŸ¥è¯¢çš„ä¸šåŠ¡åœºæ™¯ï¼Œè¿™æ ·å­ä¸å¾—ä¸å†æŠŠkey3åˆ—çš„å•ç‹¬ç´¢å¼•ç»™åŠ ä¸Šã€‚<br></code></pre></td></tr></table></figure><h1>11.è¿æ¥çš„åŸç†</h1><p>ææ•°æ®åº“ä¸€ä¸ªé¿ä¸å¼€çš„æ¦‚å¿µå°±æ˜¯<code>Join</code>ï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯<code>è¿æ¥</code>ã€‚ç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´åœ¨åˆå­¦è¿æ¥çš„æ—¶å€™æœ‰äº›ä¸€è„¸æ‡µé€¼ï¼Œç†è§£äº†è¿æ¥çš„è¯­ä¹‰ä¹‹ååˆå¯èƒ½ä¸æ˜ç™½å„ä¸ªè¡¨ä¸­çš„è®°å½•åˆ°åº•æ˜¯æ€ä¹ˆè¿èµ·æ¥çš„ï¼Œä»¥è‡³äºåœ¨ä½¿ç”¨çš„æ—¶å€™å¸¸å¸¸é™·å…¥ä¸‹è¾¹ä¸¤ç§è¯¯åŒºï¼š</p><ul><li>è¯¯åŒºä¸€ï¼šä¸šåŠ¡è‡³ä¸Šï¼Œç®¡ä»–ä¸‰ä¸ƒäºŒåä¸€ï¼Œå†å¤æ‚çš„æŸ¥è¯¢ä¹Ÿç”¨åœ¨ä¸€ä¸ªè¿æ¥è¯­å¥ä¸­æå®šã€‚</li><li>è¯¯åŒºäºŒï¼šæ•¬è€Œè¿œä¹‹ï¼Œä¸Šæ¬¡ DBA é‚£ç»™æŠ¥è¿‡æ¥çš„æ…¢æŸ¥è¯¢å°±æ˜¯å› ä¸ºä½¿ç”¨äº†è¿æ¥å¯¼è‡´çš„ï¼Œä»¥åå†ä¹Ÿä¸æ•¢ç”¨äº†ã€‚</li></ul><p>æ‰€ä»¥æœ¬ç« å°±æ¥æ‰’ä¸€æ‰’è¿æ¥çš„åŸç†ã€‚è€ƒè™‘åˆ°ä¸€éƒ¨åˆ†å°ä¼™ä¼´å¯èƒ½å¿˜äº†è¿æ¥æ˜¯ä¸ªå•¥æˆ–è€…å‹æ ¹å„¿å°±ä¸çŸ¥é“ï¼Œä¸ºäº†èŠ‚çœä»–ä»¬ç™¾åº¦æˆ–è€…çœ‹å…¶ä»–ä¹¦çš„å®è´µæ—¶é—´ä»¥åŠä¸ºäº†æˆ‘çš„ä¹¦å‡‘å­—æ•°ï¼Œæˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸‹ MySQL ä¸­æ”¯æŒçš„ä¸€äº›è¿æ¥è¯­æ³•ã€‚</p><h2 id="è¿æ¥ç®€ä»‹">è¿æ¥ç®€ä»‹</h2><h3 id="è¿æ¥çš„æœ¬è´¨">è¿æ¥çš„æœ¬è´¨</h3><p>ä¸ºäº†æ•…äº‹çš„é¡ºåˆ©å‘å±•ï¼Œæˆ‘ä»¬å…ˆå»ºç«‹ä¸¤ä¸ªç®€å•çš„è¡¨å¹¶ç»™å®ƒä»¬å¡«å……ä¸€ç‚¹æ•°æ®ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; CREATE TABLE t<span class="hljs-number">1</span> (m<span class="hljs-number">1</span> int, n<span class="hljs-number">1</span> char(<span class="hljs-number">1</span>));<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">02</span> sec)<br><br><span class="hljs-attribute">mysql</span>&gt; CREATE TABLE t<span class="hljs-number">2</span> (m<span class="hljs-number">2</span> int, n<span class="hljs-number">2</span> char(<span class="hljs-number">1</span>));<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">02</span> sec)<br><br><span class="hljs-attribute">mysql</span>&gt; INSERT INTO t<span class="hljs-number">1</span> VALUES(<span class="hljs-number">1</span>, &#x27;a&#x27;), (<span class="hljs-number">2</span>, &#x27;b&#x27;), (<span class="hljs-number">3</span>, &#x27;c&#x27;);<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">3</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)<br><span class="hljs-attribute">Records</span>: <span class="hljs-number">3</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br><span class="hljs-attribute">mysql</span>&gt; INSERT INTO t<span class="hljs-number">2</span> VALUES(<span class="hljs-number">2</span>, &#x27;b&#x27;), (<span class="hljs-number">3</span>, &#x27;c&#x27;), (<span class="hljs-number">4</span>, &#x27;d&#x27;);<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">3</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)<br><span class="hljs-attribute">Records</span>: <span class="hljs-number">3</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æˆåŠŸå»ºç«‹äº†<code>t1</code>ã€<code>t2</code>ä¸¤ä¸ªè¡¨ï¼Œè¿™ä¸¤ä¸ªè¡¨éƒ½æœ‰ä¸¤ä¸ªåˆ—ï¼Œä¸€ä¸ªæ˜¯<code>INT</code>ç±»å‹çš„ï¼Œä¸€ä¸ªæ˜¯<code>CHAR(1)</code>ç±»å‹çš„ï¼Œå¡«å……å¥½æ•°æ®çš„ä¸¤ä¸ªè¡¨é•¿è¿™æ ·ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SELECT * FROM t1;</span><br><span class="hljs-section">+------+------+</span><br><span class="hljs-section">| m1   | n1   |</span><br><span class="hljs-section">+------+------+</span><br>|    1 | a    |<br>|    2 | b    |<br><span class="hljs-section">|    3 | c    |</span><br><span class="hljs-section">+------+------+</span><br>3 rows in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SELECT * FROM t2;</span><br><span class="hljs-section">+------+------+</span><br><span class="hljs-section">| m2   | n2   |</span><br><span class="hljs-section">+------+------+</span><br>|    2 | b    |<br>|    3 | c    |<br><span class="hljs-section">|    4 | d    |</span><br><span class="hljs-section">+------+------+</span><br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><code>è¿æ¥</code>çš„æœ¬è´¨å°±æ˜¯æŠŠå„ä¸ªè¿æ¥è¡¨ä¸­çš„è®°å½•éƒ½å–å‡ºæ¥ä¾æ¬¡åŒ¹é…çš„ç»„åˆåŠ å…¥ç»“æœé›†å¹¶è¿”å›ç»™ç”¨æˆ·ã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠ<code>t1</code>å’Œ<code>t2</code>ä¸¤ä¸ªè¡¨è¿æ¥èµ·æ¥çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/167e43ab3feccc29~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cql4ae7flug1itskat1ojgi7g3m.png-67.4kB"><p>è¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥å°±æ˜¯æŠŠ<code>t1</code>è¡¨çš„è®°å½•å’Œ<code>t2</code>çš„è®°å½•è¿èµ·æ¥ç»„æˆæ–°çš„æ›´å¤§çš„è®°å½•ï¼Œæ‰€ä»¥è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹ç§°ä¹‹ä¸ºè¿æ¥æŸ¥è¯¢ã€‚è¿æ¥æŸ¥è¯¢çš„ç»“æœé›†ä¸­åŒ…å«ä¸€ä¸ªè¡¨ä¸­çš„æ¯ä¸€æ¡è®°å½•ä¸å¦ä¸€ä¸ªè¡¨ä¸­çš„æ¯ä¸€æ¡è®°å½•ç›¸äº’åŒ¹é…çš„ç»„åˆï¼Œåƒè¿™æ ·çš„ç»“æœé›†å°±å¯ä»¥ç§°ä¹‹ä¸º<code>ç¬›å¡å°”ç§¯</code>ã€‚å› ä¸ºè¡¨<code>t1</code>ä¸­æœ‰3æ¡è®°å½•ï¼Œè¡¨<code>t2</code>ä¸­ä¹Ÿæœ‰3æ¡è®°å½•ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªè¡¨è¿æ¥ä¹‹åçš„ç¬›å¡å°”ç§¯å°±æœ‰<code>3Ã—3=9</code>è¡Œè®°å½•ã€‚åœ¨<code>MySQL</code>ä¸­ï¼Œè¿æ¥æŸ¥è¯¢çš„è¯­æ³•ä¹Ÿå¾ˆéšæ„ï¼Œåªè¦åœ¨<code>FROM</code>è¯­å¥åè¾¹è·Ÿå¤šä¸ªè¡¨åå°±å¥½äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠ<code>t1</code>è¡¨å’Œ<code>t2</code>è¡¨è¿æ¥èµ·æ¥çš„æŸ¥è¯¢è¯­å¥å¯ä»¥å†™æˆè¿™æ ·ï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; SELECT <span class="hljs-symbol">*</span> FROM t1, t2;<br>+------+------+------+------+<br>|<span class="hljs-string"> m1   </span>|<span class="hljs-string"> n1   </span>|<span class="hljs-string"> m2   </span>|<span class="hljs-string"> n2   </span>|<br>+------+------+------+------+<br>|<span class="hljs-string">    1 </span>|<span class="hljs-string"> a    </span>|<span class="hljs-string">    2 </span>|<span class="hljs-string"> b    </span>|<br>|<span class="hljs-string">    2 </span>|<span class="hljs-string"> b    </span>|<span class="hljs-string">    2 </span>|<span class="hljs-string"> b    </span>|<br>|<span class="hljs-string">    3 </span>|<span class="hljs-string"> c    </span>|<span class="hljs-string">    2 </span>|<span class="hljs-string"> b    </span>|<br>|<span class="hljs-string">    1 </span>|<span class="hljs-string"> a    </span>|<span class="hljs-string">    3 </span>|<span class="hljs-string"> c    </span>|<br>|<span class="hljs-string">    2 </span>|<span class="hljs-string"> b    </span>|<span class="hljs-string">    3 </span>|<span class="hljs-string"> c    </span>|<br>|<span class="hljs-string">    3 </span>|<span class="hljs-string"> c    </span>|<span class="hljs-string">    3 </span>|<span class="hljs-string"> c    </span>|<br>|<span class="hljs-string">    1 </span>|<span class="hljs-string"> a    </span>|<span class="hljs-string">    4 </span>|<span class="hljs-string"> d    </span>|<br>|<span class="hljs-string">    2 </span>|<span class="hljs-string"> b    </span>|<span class="hljs-string">    4 </span>|<span class="hljs-string"> d    </span>|<br>|<span class="hljs-string">    3 </span>|<span class="hljs-string"> c    </span>|<span class="hljs-string">    4 </span>|<span class="hljs-string"> d    </span>|<br>+------+------+------+------+<br>9 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="è¿æ¥è¿‡ç¨‹ç®€ä»‹">è¿æ¥è¿‡ç¨‹ç®€ä»‹</h3><p>å¦‚æœæˆ‘ä»¬ä¹æ„ï¼Œæˆ‘ä»¬å¯ä»¥è¿æ¥ä»»æ„æ•°é‡å¼ è¡¨ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰ä»»ä½•é™åˆ¶æ¡ä»¶çš„è¯ï¼Œè¿™äº›è¡¨è¿æ¥èµ·æ¥äº§ç”Ÿçš„<code>ç¬›å¡å°”ç§¯</code>å¯èƒ½æ˜¯éå¸¸å·¨å¤§çš„ã€‚æ¯”æ–¹è¯´3ä¸ª100è¡Œè®°å½•çš„è¡¨è¿æ¥èµ·æ¥äº§ç”Ÿçš„<code>ç¬›å¡å°”ç§¯</code>å°±æœ‰<code>100Ã—100Ã—100=1000000</code>è¡Œæ•°æ®ï¼æ‰€ä»¥åœ¨è¿æ¥çš„æ—¶å€™è¿‡æ»¤æ‰ç‰¹å®šè®°å½•ç»„åˆæ˜¯æœ‰å¿…è¦çš„ï¼Œåœ¨è¿æ¥æŸ¥è¯¢ä¸­çš„è¿‡æ»¤æ¡ä»¶å¯ä»¥åˆ†æˆä¸¤ç§ï¼š</p><ul><li><p>æ¶‰åŠå•è¡¨çš„æ¡ä»¶</p><p>è¿™ç§åªæ¶‰åŠå•è¡¨çš„è¿‡æ»¤æ¡ä»¶æˆ‘ä»¬ä¹‹å‰éƒ½æåˆ°è¿‡ä¸€ä¸‡éäº†ï¼Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿä¸€ç›´ç§°ä¸º<code>æœç´¢æ¡ä»¶</code>ï¼Œæ¯”å¦‚<code>t1.m1 &gt; 1</code>æ˜¯åªé’ˆå¯¹<code>t1</code>è¡¨çš„è¿‡æ»¤æ¡ä»¶ï¼Œ<code>t2.n2 &lt; 'd'</code>æ˜¯åªé’ˆå¯¹<code>t2</code>è¡¨çš„è¿‡æ»¤æ¡ä»¶ã€‚</p></li><li><p>æ¶‰åŠä¸¤è¡¨çš„æ¡ä»¶</p><p>è¿™ç§è¿‡æ»¤æ¡ä»¶æˆ‘ä»¬ä¹‹å‰æ²¡è§è¿‡ï¼Œæ¯”å¦‚<code>t1.m1 = t2.m2</code>ã€<code>t1.n1 &gt; t2.n2</code>ç­‰ï¼Œè¿™äº›æ¡ä»¶ä¸­æ¶‰åŠåˆ°äº†ä¸¤ä¸ªè¡¨ï¼Œæˆ‘ä»¬ç¨åä¼šä»”ç»†åˆ†æè¿™ç§è¿‡æ»¤æ¡ä»¶æ˜¯å¦‚ä½•ä½¿ç”¨çš„å“ˆã€‚</p></li></ul><p>ä¸‹è¾¹æˆ‘ä»¬å°±è¦çœ‹ä¸€ä¸‹æºå¸¦è¿‡æ»¤æ¡ä»¶çš„è¿æ¥æŸ¥è¯¢çš„å¤§è‡´æ‰§è¡Œè¿‡ç¨‹äº†ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> * FROM t<span class="hljs-number">1</span>, t<span class="hljs-number">2</span> WHERE t<span class="hljs-number">1</span>.m<span class="hljs-number">1</span> &gt; <span class="hljs-number">1</span> AND t<span class="hljs-number">1</span>.m<span class="hljs-number">1</span> = t<span class="hljs-number">2</span>.m<span class="hljs-number">2</span> AND t<span class="hljs-number">2</span>.n<span class="hljs-number">2</span> &lt; &#x27;d&#x27;;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­æˆ‘ä»¬æŒ‡æ˜äº†è¿™ä¸‰ä¸ªè¿‡æ»¤æ¡ä»¶ï¼š</p><ul><li><code>t1.m1 &gt; 1</code></li><li><code>t1.m1 = t2.m2</code></li><li><code>t2.n2 &lt; 'd'</code></li></ul><p>é‚£ä¹ˆè¿™ä¸ªè¿æ¥æŸ¥è¯¢çš„å¤§è‡´æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>é¦–å…ˆç¡®å®šç¬¬ä¸€ä¸ªéœ€è¦æŸ¥è¯¢çš„è¡¨ï¼Œè¿™ä¸ªè¡¨ç§°ä¹‹ä¸º<code>é©±åŠ¨è¡¨</code>ã€‚æ€æ ·åœ¨å•è¡¨ä¸­æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æˆ‘ä»¬åœ¨å‰ä¸€ç« éƒ½å” å¨è¿‡äº†ï¼Œåªéœ€è¦é€‰å–ä»£ä»·æœ€å°çš„é‚£ç§è®¿é—®æ–¹æ³•å»æ‰§è¡Œå•è¡¨æŸ¥è¯¢è¯­å¥å°±å¥½äº†ï¼ˆå°±æ˜¯è¯´ä»constã€refã€ref_or_nullã€rangeã€indexã€allè¿™äº›æ‰§è¡Œæ–¹æ³•ä¸­é€‰å–ä»£ä»·æœ€å°çš„å»æ‰§è¡ŒæŸ¥è¯¢ï¼‰ã€‚æ­¤å¤„å‡è®¾ä½¿ç”¨<code>t1</code>ä½œä¸ºé©±åŠ¨è¡¨ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ°<code>t1</code>è¡¨ä¸­æ‰¾æ»¡è¶³<code>t1.m1 &gt; 1</code>çš„è®°å½•ï¼Œå› ä¸ºè¡¨ä¸­çš„æ•°æ®å¤ªå°‘ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡åœ¨è¡¨ä¸Šå»ºç«‹äºŒçº§ç´¢å¼•ï¼Œæ‰€ä»¥æ­¤å¤„æŸ¥è¯¢<code>t1</code>è¡¨çš„è®¿é—®æ–¹æ³•å°±è®¾å®šä¸º<code>all</code>å§ï¼Œä¹Ÿå°±æ˜¯é‡‡ç”¨å…¨è¡¨æ‰«æçš„æ–¹å¼æ‰§è¡Œå•è¡¨æŸ¥è¯¢ã€‚å…³äºå¦‚ä½•æå‡è¿æ¥æŸ¥è¯¢çš„æ€§èƒ½æˆ‘ä»¬ä¹‹åå†è¯´ï¼Œç°åœ¨å…ˆæŠŠåŸºæœ¬æ¦‚å¿µæ‹æ¸…æ¥šå“ˆã€‚æ‰€ä»¥æŸ¥è¯¢è¿‡ç¨‹å°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/167e43ab3dfab5ed~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ctpnftbge08uf1ek61qor1fh14g.png-23.9kB"><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>t1</code>è¡¨ä¸­ç¬¦åˆ<code>t1.m1 &gt; 1</code>çš„è®°å½•æœ‰ä¸¤æ¡ã€‚</p></li><li><p>é’ˆå¯¹ä¸Šä¸€æ­¥éª¤ä¸­ä»é©±åŠ¨è¡¨äº§ç”Ÿçš„ç»“æœé›†ä¸­çš„æ¯ä¸€æ¡è®°å½•ï¼Œåˆ†åˆ«éœ€è¦åˆ°<code>t2</code>è¡¨ä¸­æŸ¥æ‰¾åŒ¹é…çš„è®°å½•ï¼Œæ‰€è°“<code>åŒ¹é…çš„è®°å½•</code>ï¼ŒæŒ‡çš„æ˜¯ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„è®°å½•ã€‚å› ä¸ºæ˜¯æ ¹æ®<code>t1</code>è¡¨ä¸­çš„è®°å½•å»æ‰¾<code>t2</code>è¡¨ä¸­çš„è®°å½•ï¼Œæ‰€ä»¥<code>t2</code>è¡¨ä¹Ÿå¯ä»¥è¢«ç§°ä¹‹ä¸º<code>è¢«é©±åŠ¨è¡¨</code>ã€‚ä¸Šä¸€æ­¥éª¤ä»é©±åŠ¨è¡¨ä¸­å¾—åˆ°äº†2æ¡è®°å½•ï¼Œæ‰€ä»¥éœ€è¦æŸ¥è¯¢2æ¬¡<code>t2</code>è¡¨ã€‚æ­¤æ—¶æ¶‰åŠä¸¤ä¸ªè¡¨çš„åˆ—çš„è¿‡æ»¤æ¡ä»¶<code>t1.m1 = t2.m2</code>å°±æ´¾ä¸Šç”¨åœºäº†ï¼š</p><ul><li>å½“<code>t1.m1 = 2</code>æ—¶ï¼Œè¿‡æ»¤æ¡ä»¶<code>t1.m1 = t2.m2</code>å°±ç›¸å½“äº<code>t2.m2 = 2</code>ï¼Œæ‰€ä»¥æ­¤æ—¶<code>t2</code>è¡¨ç›¸å½“äºæœ‰äº†<code>t2.m2 = 2</code>ã€<code>t2.n2 &lt; 'd'</code>è¿™ä¸¤ä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œç„¶ååˆ°<code>t2</code>è¡¨ä¸­æ‰§è¡Œå•è¡¨æŸ¥è¯¢ã€‚</li><li>å½“<code>t1.m1 = 3</code>æ—¶ï¼Œè¿‡æ»¤æ¡ä»¶<code>t1.m1 = t2.m2</code>å°±ç›¸å½“äº<code>t2.m2 = 3</code>ï¼Œæ‰€ä»¥æ­¤æ—¶<code>t2</code>è¡¨ç›¸å½“äºæœ‰äº†<code>t2.m2 = 3</code>ã€<code>t2.n2 &lt; 'd'</code>è¿™ä¸¤ä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œç„¶ååˆ°<code>t2</code>è¡¨ä¸­æ‰§è¡Œå•è¡¨æŸ¥è¯¢ã€‚</li></ul><p>æ‰€ä»¥æ•´ä¸ªè¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè¿‡ç¨‹å°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/167e43ab3a02660b~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ctrsprar1bbh17lee79le63ls2m.png-49.6kB"><p>ä¹Ÿå°±æ˜¯è¯´æ•´ä¸ªè¿æ¥æŸ¥è¯¢æœ€åçš„ç»“æœåªæœ‰ä¸¤æ¡ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„è®°å½•ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+------+</span>------<span class="hljs-code">+------+</span>------+<br><span class="hljs-section">| m1   | n1   | m2   | n2   |</span><br><span class="hljs-section">+------+------+------+------+</span><br>|    2 | b    |    2 | b    |<br><span class="hljs-section">|    3 | c    |    3 | c    |</span><br><span class="hljs-section">+------+------+------+------+</span><br></code></pre></td></tr></table></figure></li></ol><p>ä»ä¸Šè¾¹ä¸¤ä¸ªæ­¥éª¤å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬ä¸Šè¾¹å” å¨çš„è¿™ä¸ªä¸¤è¡¨è¿æ¥æŸ¥è¯¢å…±éœ€è¦æŸ¥è¯¢1æ¬¡<code>t1</code>è¡¨ï¼Œ2æ¬¡<code>t2</code>è¡¨ã€‚å½“ç„¶è¿™æ˜¯åœ¨ç‰¹å®šçš„è¿‡æ»¤æ¡ä»¶ä¸‹çš„ç»“æœï¼Œå¦‚æœæˆ‘ä»¬æŠŠ<code>t1.m1 &gt; 1</code>è¿™ä¸ªæ¡ä»¶å»æ‰ï¼Œé‚£ä¹ˆä»<code>t1</code>è¡¨ä¸­æŸ¥å‡ºçš„è®°å½•å°±æœ‰3æ¡ï¼Œå°±éœ€è¦æŸ¥è¯¢3æ¬¡<code>t2</code>è¡¨äº†ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸¤è¡¨è¿æ¥æŸ¥è¯¢ä¸­ï¼Œé©±åŠ¨è¡¨åªéœ€è¦è®¿é—®ä¸€æ¬¡ï¼Œè¢«é©±åŠ¨è¡¨å¯èƒ½è¢«è®¿é—®å¤šæ¬¡ã€‚</p><h3 id="å†…è¿æ¥å’Œå¤–è¿æ¥">å†…è¿æ¥å’Œå¤–è¿æ¥</h3><p>ä¸ºäº†å¤§å®¶æ›´å¥½ç†è§£åè¾¹å†…å®¹ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸¤ä¸ªæœ‰ç°å®æ„ä¹‰çš„è¡¨ï¼Œ</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> student (<br>    number <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;å­¦å·&#x27;</span>,<br>    <span class="hljs-type">name</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">5</span>) <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;å§“å&#x27;</span>,<br>    major <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;ä¸“ä¸š&#x27;</span>,<br>    <span class="hljs-keyword">PRIMARY KEY</span> (number)<br>) Engine=InnoDB CHARSET=utf8 <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;å­¦ç”Ÿä¿¡æ¯è¡¨&#x27;</span>;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> score (<br>    number <span class="hljs-type">INT</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;å­¦å·&#x27;</span>,<br>    subject <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;ç§‘ç›®&#x27;</span>,<br>    score TINYINT <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;æˆç»©&#x27;</span>,<br>    <span class="hljs-keyword">PRIMARY KEY</span> (number, subject)<br>) Engine=InnoDB CHARSET=utf8 <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;å­¦ç”Ÿæˆç»©è¡¨&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªå­¦ç”Ÿä¿¡æ¯è¡¨ï¼Œä¸€ä¸ªå­¦ç”Ÿæˆç»©è¡¨ï¼Œç„¶åæˆ‘ä»¬å‘ä¸Šè¿°ä¸¤ä¸ªè¡¨ä¸­æ’å…¥ä¸€äº›æ•°æ®ï¼Œä¸ºèŠ‚çœç¯‡å¹…ï¼Œå…·ä½“æ’å…¥è¿‡ç¨‹å°±ä¸å” å¨äº†ï¼Œæ’å…¥åä¸¤è¡¨ä¸­çš„æ•°æ®å¦‚ä¸‹ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SELECT * FROM student;</span><br><span class="hljs-section">+----------+-----------+--------------------------+</span><br><span class="hljs-section">| number   | name      | major                    |</span><br><span class="hljs-section">+----------+-----------+--------------------------+</span><br>| 20180101 | æœå­è…¾    | è½¯ä»¶å­¦é™¢                 |<br>| 20180102 | èŒƒç»Ÿ      | è®¡ç®—æœºç§‘å­¦ä¸å·¥ç¨‹         |<br><span class="hljs-section">| 20180103 | å²çé¦™    | è®¡ç®—æœºç§‘å­¦ä¸å·¥ç¨‹         |</span><br><span class="hljs-section">+----------+-----------+--------------------------+</span><br>3 rows in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SELECT * FROM score;</span><br><span class="hljs-section">+----------+-----------------------------+-------+</span><br><span class="hljs-section">| number   | subject                     | score |</span><br><span class="hljs-section">+----------+-----------------------------+-------+</span><br>| 20180101 | æ¯çŒªçš„äº§åæŠ¤ç†              |    78 |<br>| 20180101 | è®ºè¨è¾¾å§†çš„æˆ˜äº‰å‡†å¤‡          |    88 |<br>| 20180102 | è®ºè¨è¾¾å§†çš„æˆ˜äº‰å‡†å¤‡          |    98 |<br><span class="hljs-section">| 20180102 | æ¯çŒªçš„äº§åæŠ¤ç†              |   100 |</span><br><span class="hljs-section">+----------+-----------------------------+-------+</span><br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æƒ³æŠŠæ¯ä¸ªå­¦ç”Ÿçš„è€ƒè¯•æˆç»©éƒ½æŸ¥è¯¢å‡ºæ¥å°±éœ€è¦è¿›è¡¨è¿æ¥äº†ï¼ˆå› ä¸º<code>score</code>ä¸­æ²¡æœ‰å§“åä¿¡æ¯ï¼Œæ‰€ä»¥ä¸èƒ½å•çº¯åªæŸ¥è¯¢<code>score</code>è¡¨ï¼‰ã€‚è¿æ¥è¿‡ç¨‹å°±æ˜¯ä»<code>student</code>è¡¨ä¸­å–å‡ºè®°å½•ï¼Œåœ¨<code>score</code>è¡¨ä¸­æŸ¥æ‰¾<code>number</code>ç›¸åŒçš„æˆç»©è®°å½•ï¼Œæ‰€ä»¥è¿‡æ»¤æ¡ä»¶å°±æ˜¯<code>student.number = socre.number</code>ï¼Œæ•´ä¸ªæŸ¥è¯¢è¯­å¥å°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; SELECT <span class="hljs-symbol">*</span> FROM student, score WHERE student.number = score.number;<br>+----------+-----------+--------------------------+----------+-----------------------------+-------+<br>|<span class="hljs-string"> number   </span>|<span class="hljs-string"> name      </span>|<span class="hljs-string"> major                    </span>|<span class="hljs-string"> number   </span>|<span class="hljs-string"> subject                     </span>|<span class="hljs-string"> score </span>|<br>+----------+-----------+--------------------------+----------+-----------------------------+-------+<br>|<span class="hljs-string"> 20180101 </span>|<span class="hljs-string"> æœå­è…¾    </span>|<span class="hljs-string"> è½¯ä»¶å­¦é™¢                 </span>|<span class="hljs-string"> 20180101 </span>|<span class="hljs-string"> æ¯çŒªçš„äº§åæŠ¤ç†              </span>|<span class="hljs-string">    78 </span>|<br>|<span class="hljs-string"> 20180101 </span>|<span class="hljs-string"> æœå­è…¾    </span>|<span class="hljs-string"> è½¯ä»¶å­¦é™¢                 </span>|<span class="hljs-string"> 20180101 </span>|<span class="hljs-string"> è®ºè¨è¾¾å§†çš„æˆ˜äº‰å‡†å¤‡          </span>|<span class="hljs-string">    88 </span>|<br>|<span class="hljs-string"> 20180102 </span>|<span class="hljs-string"> èŒƒç»Ÿ      </span>|<span class="hljs-string"> è®¡ç®—æœºç§‘å­¦ä¸å·¥ç¨‹         </span>|<span class="hljs-string"> 20180102 </span>|<span class="hljs-string"> è®ºè¨è¾¾å§†çš„æˆ˜äº‰å‡†å¤‡          </span>|<span class="hljs-string">    98 </span>|<br>|<span class="hljs-string"> 20180102 </span>|<span class="hljs-string"> èŒƒç»Ÿ      </span>|<span class="hljs-string"> è®¡ç®—æœºç§‘å­¦ä¸å·¥ç¨‹         </span>|<span class="hljs-string"> 20180102 </span>|<span class="hljs-string"> æ¯çŒªçš„äº§åæŠ¤ç†              </span>|<span class="hljs-string">   100 </span>|<br>+----------+-----------+--------------------------+----------+-----------------------------+-------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å­—æ®µæœ‰ç‚¹å¤šå“¦ï¼Œæˆ‘ä»¬å°‘æŸ¥è¯¢å‡ ä¸ªå­—æ®µï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SELECT s1.number, s1.name, s2.subject, s2.score FROM student AS s1, score AS s2 WHERE s1.number = s2.number;</span><br><span class="hljs-section">+----------+-----------+-----------------------------+-------+</span><br><span class="hljs-section">| number   | name      | subject                     | score |</span><br><span class="hljs-section">+----------+-----------+-----------------------------+-------+</span><br>| 20180101 | æœå­è…¾    | æ¯çŒªçš„äº§åæŠ¤ç†              |    78 |<br>| 20180101 | æœå­è…¾    | è®ºè¨è¾¾å§†çš„æˆ˜äº‰å‡†å¤‡          |    88 |<br>| 20180102 | èŒƒç»Ÿ      | è®ºè¨è¾¾å§†çš„æˆ˜äº‰å‡†å¤‡          |    98 |<br><span class="hljs-section">| 20180102 | èŒƒç»Ÿ      | æ¯çŒªçš„äº§åæŠ¤ç†              |   100 |</span><br><span class="hljs-section">+----------+-----------+-----------------------------+-------+</span><br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°æŸ¥è¯¢ç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå„ä¸ªåŒå­¦å¯¹åº”çš„å„ç§‘æˆç»©å°±éƒ½è¢«æŸ¥å‡ºæ¥äº†ï¼Œå¯æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œ<code>å²çé¦™</code>åŒå­¦ï¼Œä¹Ÿå°±æ˜¯å­¦å·ä¸º<code>20180103</code>çš„åŒå­¦å› ä¸ºæŸäº›åŸå› æ²¡æœ‰å‚åŠ è€ƒè¯•ï¼Œæ‰€ä»¥åœ¨<code>score</code>è¡¨ä¸­æ²¡æœ‰å¯¹åº”çš„æˆç»©è®°å½•ã€‚é‚£å¦‚æœè€å¸ˆæƒ³æŸ¥çœ‹æ‰€æœ‰åŒå­¦çš„è€ƒè¯•æˆç»©ï¼Œå³ä½¿æ˜¯ç¼ºè€ƒçš„åŒå­¦ä¹Ÿåº”è¯¥å±•ç¤ºå‡ºæ¥ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬ä»‹ç»çš„<code>è¿æ¥æŸ¥è¯¢</code>æ˜¯æ— æ³•å®Œæˆè¿™æ ·çš„éœ€æ±‚çš„ã€‚æˆ‘ä»¬ç¨å¾®æ€è€ƒä¸€ä¸‹è¿™ä¸ªéœ€æ±‚ï¼Œå…¶æœ¬è´¨æ˜¯æƒ³ï¼šé©±åŠ¨è¡¨ä¸­çš„è®°å½•å³ä½¿åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼Œä¹Ÿä»ç„¶éœ€è¦åŠ å…¥åˆ°ç»“æœé›†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æœ‰äº†<code>å†…è¿æ¥</code>å’Œ<code>å¤–è¿æ¥</code>çš„æ¦‚å¿µï¼š</p><blockquote><p>å¤–è¿æ¥è§£å†³çš„é—®é¢˜æ˜¯ï¼šé©±åŠ¨è¡¨ä¸­çš„è®°å½•å³ä½¿åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼Œä¹Ÿä»ç„¶éœ€è¦åŠ å…¥åˆ°ç»“æœé›†ã€‚</p></blockquote><ul><li><p>å¯¹äº<code>å†…è¿æ¥</code>çš„ä¸¤ä¸ªè¡¨ï¼Œé©±åŠ¨è¡¨ä¸­çš„è®°å½•åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ‰¾ä¸åˆ°åŒ¹é…çš„è®°å½•ï¼Œè¯¥è®°å½•ä¸ä¼šåŠ å…¥åˆ°æœ€åçš„ç»“æœé›†ï¼Œæˆ‘ä»¬ä¸Šè¾¹æåˆ°çš„è¿æ¥éƒ½æ˜¯æ‰€è°“çš„<code>å†…è¿æ¥</code>ã€‚</p></li><li><p>å¯¹äº<code>å¤–è¿æ¥</code>çš„ä¸¤ä¸ªè¡¨ï¼Œé©±åŠ¨è¡¨ä¸­çš„è®°å½•å³ä½¿åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼Œä¹Ÿä»ç„¶éœ€è¦åŠ å…¥åˆ°ç»“æœé›†ã€‚</p><p>åœ¨<code>MySQL</code>ä¸­ï¼Œæ ¹æ®é€‰å–é©±åŠ¨è¡¨çš„ä¸åŒï¼Œå¤–è¿æ¥ä»ç„¶å¯ä»¥ç»†åˆ†ä¸º2ç§ï¼š</p><ul><li><p>å·¦å¤–è¿æ¥</p><p>é€‰å–å·¦ä¾§çš„è¡¨ä¸ºé©±åŠ¨è¡¨ã€‚</p></li><li><p>å³å¤–è¿æ¥</p><p>é€‰å–å³ä¾§çš„è¡¨ä¸ºé©±åŠ¨è¡¨ã€‚</p></li></ul></li></ul><p>å¯æ˜¯è¿™æ ·ä»ç„¶å­˜åœ¨é—®é¢˜ï¼Œå³ä½¿å¯¹äºå¤–è¿æ¥æ¥è¯´ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿå¹¶ä¸æƒ³æŠŠé©±åŠ¨è¡¨çš„å…¨éƒ¨è®°å½•éƒ½åŠ å…¥åˆ°æœ€åçš„ç»“æœé›†ã€‚è¿™å°±çŠ¯éš¾äº†ï¼Œæœ‰æ—¶å€™åŒ¹é…å¤±è´¥è¦åŠ å…¥ç»“æœé›†ï¼Œæœ‰æ—¶å€™åˆä¸è¦åŠ å…¥ç»“æœé›†ï¼Œè¿™å’‹åŠï¼Œæœ‰ç‚¹å„¿æ„å•Šã€‚ã€‚ã€‚å™«ï¼ŒæŠŠè¿‡æ»¤æ¡ä»¶åˆ†ä¸ºä¸¤ç§ä¸å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜äº†ä¹ˆï¼Œæ‰€ä»¥æ”¾åœ¨ä¸åŒåœ°æ–¹çš„è¿‡æ»¤æ¡ä»¶æ˜¯æœ‰ä¸åŒè¯­ä¹‰çš„ï¼š</p><ul><li><p><code>WHERE</code>å­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶</p><p><code>WHERE</code>å­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶å°±æ˜¯æˆ‘ä»¬å¹³æ—¶è§çš„é‚£ç§ï¼Œä¸è®ºæ˜¯å†…è¿æ¥è¿˜æ˜¯å¤–è¿æ¥ï¼Œå‡¡æ˜¯ä¸ç¬¦åˆ<code>WHERE</code>å­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶çš„è®°å½•éƒ½ä¸ä¼šè¢«åŠ å…¥æœ€åçš„ç»“æœé›†ã€‚</p></li><li><p><code>ON</code>å­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶</p><p>å¯¹äºå¤–è¿æ¥çš„é©±åŠ¨è¡¨çš„è®°å½•æ¥è¯´ï¼Œå¦‚æœæ— æ³•åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ‰¾åˆ°åŒ¹é…<code>ON</code>å­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶çš„è®°å½•ï¼Œé‚£ä¹ˆè¯¥è®°å½•ä»ç„¶ä¼šè¢«åŠ å…¥åˆ°ç»“æœé›†ä¸­ï¼Œå¯¹åº”çš„è¢«é©±åŠ¨è¡¨è®°å½•çš„å„ä¸ªå­—æ®µä½¿ç”¨<code>NULL</code>å€¼å¡«å……ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ª<code>ON</code>å­å¥æ˜¯ä¸“é—¨ä¸ºå¤–è¿æ¥é©±åŠ¨è¡¨ä¸­çš„è®°å½•åœ¨è¢«é©±åŠ¨è¡¨æ‰¾ä¸åˆ°åŒ¹é…è®°å½•æ—¶åº”ä¸åº”è¯¥æŠŠè¯¥è®°å½•åŠ å…¥ç»“æœé›†è¿™ä¸ªåœºæ™¯ä¸‹æå‡ºçš„ï¼Œæ‰€ä»¥å¦‚æœæŠŠ<code>ON</code>å­å¥æ”¾åˆ°å†…è¿æ¥ä¸­ï¼Œ<code>MySQL</code>ä¼šæŠŠå®ƒå’Œ<code>WHERE</code>å­å¥ä¸€æ ·å¯¹å¾…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå†…è¿æ¥ä¸­çš„WHEREå­å¥å’ŒONå­å¥æ˜¯ç­‰ä»·çš„ã€‚</p></li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æŠŠåªæ¶‰åŠå•è¡¨çš„è¿‡æ»¤æ¡ä»¶æ”¾åˆ°<code>WHERE</code>å­å¥ä¸­ï¼ŒæŠŠæ¶‰åŠä¸¤è¡¨çš„è¿‡æ»¤æ¡ä»¶éƒ½æ”¾åˆ°<code>ON</code>å­å¥ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¸€èˆ¬æŠŠæ”¾åˆ°<code>ON</code>å­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶ä¹Ÿç§°ä¹‹ä¸º<code>è¿æ¥æ¡ä»¶</code>ã€‚</p><blockquote><p>å°è´´å£«ï¼š å·¦å¤–è¿æ¥å’Œå³å¤–è¿æ¥ç®€ç§°å·¦è¿æ¥å’Œå³è¿æ¥ï¼Œæ‰€ä»¥ä¸‹è¾¹æåˆ°çš„å·¦å¤–è¿æ¥å’Œå³å¤–è¿æ¥ä¸­çš„<code>å¤–</code>å­—éƒ½ç”¨æ‹¬å·æ‰©èµ·æ¥ï¼Œä»¥è¡¨ç¤ºè¿™ä¸ªå­—å„¿å¯æœ‰å¯æ— ã€‚</p></blockquote><h4 id="å·¦ï¼ˆå¤–ï¼‰è¿æ¥çš„è¯­æ³•">å·¦ï¼ˆå¤–ï¼‰è¿æ¥çš„è¯­æ³•</h4><p>å·¦ï¼ˆå¤–ï¼‰è¿æ¥çš„è¯­æ³•è¿˜æ˜¯æŒºç®€å•çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦æŠŠ<code>t1</code>è¡¨å’Œ<code>t2</code>è¡¨è¿›è¡Œå·¦å¤–è¿æ¥æŸ¥è¯¢å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> t1 <span class="hljs-keyword">LEFT</span> [<span class="hljs-keyword">OUTER</span>] <span class="hljs-keyword">JOIN</span> t2 <span class="hljs-keyword">ON</span> è¿æ¥æ¡ä»¶ [<span class="hljs-keyword">WHERE</span> æ™®é€šè¿‡æ»¤æ¡ä»¶];<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ä¸­æ‹¬å·é‡Œçš„<code>OUTER</code>å•è¯æ˜¯å¯ä»¥çœç•¥çš„ã€‚å¯¹äº<code>LEFT JOIN</code>ç±»å‹çš„è¿æ¥æ¥è¯´ï¼Œæˆ‘ä»¬æŠŠæ”¾åœ¨å·¦è¾¹çš„è¡¨ç§°ä¹‹ä¸ºå¤–è¡¨æˆ–è€…é©±åŠ¨è¡¨ï¼Œå³è¾¹çš„è¡¨ç§°ä¹‹ä¸ºå†…è¡¨æˆ–è€…è¢«é©±åŠ¨è¡¨ã€‚æ‰€ä»¥ä¸Šè¿°ä¾‹å­ä¸­<code>t1</code>å°±æ˜¯å¤–è¡¨æˆ–è€…é©±åŠ¨è¡¨ï¼Œ<code>t2</code>å°±æ˜¯å†…è¡¨æˆ–è€…è¢«é©±åŠ¨è¡¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå·¦ï¼ˆå¤–ï¼‰è¿æ¥å’Œå³ï¼ˆå¤–ï¼‰è¿æ¥æ¥è¯´ï¼Œå¿…é¡»ä½¿ç”¨<code>ON</code>å­å¥æ¥æŒ‡å‡ºè¿æ¥æ¡ä»¶ã€‚äº†è§£äº†å·¦ï¼ˆå¤–ï¼‰è¿æ¥çš„åŸºæœ¬è¯­æ³•ä¹‹åï¼Œå†æ¬¡å›åˆ°æˆ‘ä»¬ä¸Šè¾¹é‚£ä¸ªç°å®é—®é¢˜ä¸­æ¥ï¼Œçœ‹çœ‹æ€æ ·å†™æŸ¥è¯¢è¯­å¥æ‰èƒ½æŠŠæ‰€æœ‰çš„å­¦ç”Ÿçš„æˆç»©ä¿¡æ¯éƒ½æŸ¥è¯¢å‡ºæ¥ï¼Œå³ä½¿æ˜¯ç¼ºè€ƒçš„è€ƒç”Ÿä¹Ÿåº”è¯¥è¢«æ”¾åˆ°ç»“æœé›†ä¸­ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SELECT s1.number, s1.name, s2.subject, s2.score FROM student AS s1 LEFT JOIN score AS s2 ON s1.number = s2.number;</span><br><span class="hljs-section">+----------+-----------+-----------------------------+-------+</span><br><span class="hljs-section">| number   | name      | subject                     | score |</span><br><span class="hljs-section">+----------+-----------+-----------------------------+-------+</span><br>| 20180101 | æœå­è…¾    | æ¯çŒªçš„äº§åæŠ¤ç†              |    78 |<br>| 20180101 | æœå­è…¾    | è®ºè¨è¾¾å§†çš„æˆ˜äº‰å‡†å¤‡          |    88 |<br>| 20180102 | èŒƒç»Ÿ      | è®ºè¨è¾¾å§†çš„æˆ˜äº‰å‡†å¤‡          |    98 |<br>| 20180102 | èŒƒç»Ÿ      | æ¯çŒªçš„äº§åæŠ¤ç†              |   100 |<br><span class="hljs-section">| 20180103 | å²çé¦™    | NULL                        |  NULL |</span><br><span class="hljs-section">+----------+-----------+-----------------------------+-------+</span><br>5 rows in set (0.04 sec)<br></code></pre></td></tr></table></figure><p>ä»ç»“æœé›†ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œè™½ç„¶<code>å²çé¦™</code>å¹¶æ²¡æœ‰å¯¹åº”çš„æˆç»©è®°å½•ï¼Œä½†æ˜¯ç”±äºé‡‡ç”¨çš„æ˜¯è¿æ¥ç±»å‹ä¸ºå·¦ï¼ˆå¤–ï¼‰è¿æ¥ï¼Œæ‰€ä»¥ä»ç„¶æŠŠå¥¹æ”¾åˆ°äº†ç»“æœé›†ä¸­ï¼Œåªä¸è¿‡åœ¨å¯¹åº”çš„æˆç»©è®°å½•çš„å„åˆ—ä½¿ç”¨<code>NULL</code>å€¼å¡«å……è€Œå·²ã€‚</p><h4 id="å³ï¼ˆå¤–ï¼‰è¿æ¥çš„è¯­æ³•">å³ï¼ˆå¤–ï¼‰è¿æ¥çš„è¯­æ³•</h4><p>å³ï¼ˆå¤–ï¼‰è¿æ¥å’Œå·¦ï¼ˆå¤–ï¼‰è¿æ¥çš„åŸç†æ˜¯ä¸€æ ·ä¸€æ ·çš„ï¼Œè¯­æ³•ä¹Ÿåªæ˜¯æŠŠ<code>LEFT</code>æ¢æˆ<code>RIGHT</code>è€Œå·²ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> t1 <span class="hljs-keyword">RIGHT</span> [<span class="hljs-keyword">OUTER</span>] <span class="hljs-keyword">JOIN</span> t2 <span class="hljs-keyword">ON</span> è¿æ¥æ¡ä»¶ [<span class="hljs-keyword">WHERE</span> æ™®é€šè¿‡æ»¤æ¡ä»¶];<br></code></pre></td></tr></table></figure><p>åªä¸è¿‡é©±åŠ¨è¡¨æ˜¯å³è¾¹çš„è¡¨ï¼Œè¢«é©±åŠ¨è¡¨æ˜¯å·¦è¾¹çš„è¡¨ï¼Œå…·ä½“å°±ä¸å” å¨äº†ã€‚</p><h4 id="å†…è¿æ¥çš„è¯­æ³•">å†…è¿æ¥çš„è¯­æ³•</h4><p>å†…è¿æ¥å’Œå¤–è¿æ¥çš„æ ¹æœ¬åŒºåˆ«å°±æ˜¯åœ¨é©±åŠ¨è¡¨ä¸­çš„è®°å½•ä¸ç¬¦åˆ<code>ON</code>å­å¥ä¸­çš„è¿æ¥æ¡ä»¶æ—¶ä¸ä¼šæŠŠè¯¥è®°å½•åŠ å…¥åˆ°æœ€åçš„ç»“æœé›†ï¼Œæˆ‘ä»¬æœ€å¼€å§‹å” å¨çš„é‚£äº›è¿æ¥æŸ¥è¯¢çš„ç±»å‹éƒ½æ˜¯å†…è¿æ¥ã€‚ä¸è¿‡ä¹‹å‰ä»…ä»…æåˆ°äº†ä¸€ç§æœ€ç®€å•çš„å†…è¿æ¥è¯­æ³•ï¼Œå°±æ˜¯ç›´æ¥æŠŠéœ€è¦è¿æ¥çš„å¤šä¸ªè¡¨éƒ½æ”¾åˆ°<code>FROM</code>å­å¥åè¾¹ã€‚å…¶å®é’ˆå¯¹å†…è¿æ¥ï¼ŒMySQLæä¾›äº†å¥½å¤šä¸åŒçš„è¯­æ³•ï¼Œæˆ‘ä»¬ä»¥<code>t1</code>å’Œ<code>t2</code>è¡¨ä¸ºä¾‹ç…ç…ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> t1 [<span class="hljs-keyword">INNER</span> | <span class="hljs-keyword">CROSS</span>] <span class="hljs-keyword">JOIN</span> t2 [<span class="hljs-keyword">ON</span> è¿æ¥æ¡ä»¶] [<span class="hljs-keyword">WHERE</span> æ™®é€šè¿‡æ»¤æ¡ä»¶];<br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´åœ¨<code>MySQL</code>ä¸­ï¼Œä¸‹è¾¹è¿™å‡ ç§å†…è¿æ¥çš„å†™æ³•éƒ½æ˜¯ç­‰ä»·çš„ï¼š</p><ul><li>SELECT * FROM t1 JOIN t2;</li><li>SELECT * FROM t1 INNER JOIN t2;</li><li>SELECT * FROM t1 CROSS JOIN t2;</li></ul><p>ä¸Šè¾¹çš„è¿™äº›å†™æ³•å’Œç›´æ¥æŠŠéœ€è¦è¿æ¥çš„è¡¨åæ”¾åˆ°<code>FROM</code>è¯­å¥ä¹‹åï¼Œç”¨é€—å·<code>,</code>åˆ†éš”å¼€çš„å†™æ³•æ˜¯ç­‰ä»·çš„ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> * FROM t<span class="hljs-number">1</span>, t<span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬è™½ç„¶ä»‹ç»äº†å¾ˆå¤šç§<code>å†…è¿æ¥</code>çš„ä¹¦å†™æ–¹å¼ï¼Œä¸è¿‡ç†Ÿæ‚‰ä¸€ç§å°±å¥½äº†ï¼Œè¿™é‡Œæˆ‘ä»¬æ¨è<code>INNER JOIN</code>çš„å½¢å¼ä¹¦å†™å†…è¿æ¥ï¼ˆå› ä¸º<code>INNER JOIN</code>è¯­ä¹‰å¾ˆæ˜ç¡®å˜›ï¼Œå¯ä»¥å’Œ<code>LEFT JOIN</code>å’Œ<code>RIGHT JOIN</code>å¾ˆè½»æ¾çš„åŒºåˆ†å¼€ï¼‰ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºåœ¨å†…è¿æ¥ä¸­ONå­å¥å’ŒWHEREå­å¥æ˜¯ç­‰ä»·çš„ï¼Œæ‰€ä»¥å†…è¿æ¥ä¸­ä¸è¦æ±‚å¼ºåˆ¶å†™æ˜ONå­å¥ã€‚</p><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œè¿æ¥çš„æœ¬è´¨å°±æ˜¯æŠŠå„ä¸ªè¿æ¥è¡¨ä¸­çš„è®°å½•éƒ½å–å‡ºæ¥ä¾æ¬¡åŒ¹é…çš„ç»„åˆåŠ å…¥ç»“æœé›†å¹¶è¿”å›ç»™ç”¨æˆ·ã€‚ä¸è®ºå“ªä¸ªè¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œä¸¤è¡¨è¿æ¥äº§ç”Ÿçš„ç¬›å¡å°”ç§¯è‚¯å®šæ˜¯ä¸€æ ·çš„ã€‚è€Œå¯¹äºå†…è¿æ¥æ¥è¯´ï¼Œç”±äºå‡¡æ˜¯ä¸ç¬¦åˆ<code>ON</code>å­å¥æˆ–<code>WHERE</code>å­å¥ä¸­çš„æ¡ä»¶çš„è®°å½•éƒ½ä¼šè¢«è¿‡æ»¤æ‰ï¼Œå…¶å®ä¹Ÿå°±ç›¸å½“äºä»ä¸¤è¡¨è¿æ¥çš„ç¬›å¡å°”ç§¯ä¸­æŠŠä¸ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„è®°å½•ç»™è¸¢å‡ºå»ï¼Œæ‰€ä»¥å¯¹äºå†…è¿æ¥æ¥è¯´ï¼Œé©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨æ˜¯å¯ä»¥äº’æ¢çš„ï¼Œå¹¶ä¸ä¼šå½±å“æœ€åçš„æŸ¥è¯¢ç»“æœã€‚ä½†æ˜¯å¯¹äºå¤–è¿æ¥æ¥è¯´ï¼Œç”±äºé©±åŠ¨è¡¨ä¸­çš„è®°å½•å³ä½¿åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ‰¾ä¸åˆ°ç¬¦åˆONå­å¥æ¡ä»¶çš„è®°å½•æ—¶ä¹Ÿè¦å°†å…¶åŠ å…¥åˆ°ç»“æœé›†ï¼Œæ‰€ä»¥æ­¤æ—¶é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨çš„å…³ç³»å°±å¾ˆé‡è¦äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å·¦å¤–è¿æ¥å’Œå³å¤–è¿æ¥çš„é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨ä¸èƒ½è½»æ˜“äº’æ¢ã€‚</p><h4 id="å°ç»“">å°ç»“</h4><p>ä¸Šè¾¹è¯´äº†å¾ˆå¤šï¼Œç»™å¤§å®¶çš„æ„Ÿè§‰ä¸æ˜¯å¾ˆç›´è§‚ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠè¡¨<code>t1</code>å’Œ<code>t2</code>çš„ä¸‰ç§è¿æ¥æ–¹å¼å†™åœ¨ä¸€èµ·ï¼Œè¿™æ ·å¤§å®¶ç†è§£èµ·æ¥å°±å¾ˆeasyäº†ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SELECT * FROM t1 INNER JOIN t2 ON t1.m1 = t2.m2;</span><br><span class="hljs-section">+------+------+------+------+</span><br><span class="hljs-section">| m1   | n1   | m2   | n2   |</span><br><span class="hljs-section">+------+------+------+------+</span><br>|    2 | b    |    2 | b    |<br><span class="hljs-section">|    3 | c    |    3 | c    |</span><br><span class="hljs-section">+------+------+------+------+</span><br>2 rows in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SELECT * FROM t1 LEFT JOIN t2 ON t1.m1 = t2.m2;</span><br><span class="hljs-section">+------+------+------+------+</span><br><span class="hljs-section">| m1   | n1   | m2   | n2   |</span><br><span class="hljs-section">+------+------+------+------+</span><br>|    2 | b    |    2 | b    |<br>|    3 | c    |    3 | c    |<br><span class="hljs-section">|    1 | a    | NULL | NULL |</span><br><span class="hljs-section">+------+------+------+------+</span><br>3 rows in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SELECT * FROM t1 RIGHT JOIN t2 ON t1.m1 = t2.m2;</span><br><span class="hljs-section">+------+------+------+------+</span><br><span class="hljs-section">| m1   | n1   | m2   | n2   |</span><br><span class="hljs-section">+------+------+------+------+</span><br>|    2 | b    |    2 | b    |<br>|    3 | c    |    3 | c    |<br><span class="hljs-section">| NULL | NULL |    4 | d    |</span><br><span class="hljs-section">+------+------+------+------+</span><br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="è¿æ¥çš„åŸç†">è¿æ¥çš„åŸç†</h2><p>ä¸Šè¾¹è´¼å•°å—¦çš„ä»‹ç»éƒ½åªæ˜¯ä¸ºäº†å”¤é†’å¤§å®¶å¯¹<code>è¿æ¥</code>ã€<code>å†…è¿æ¥</code>ã€<code>å¤–è¿æ¥</code>è¿™äº›æ¦‚å¿µçš„è®°å¿†ï¼Œè¿™äº›åŸºæœ¬æ¦‚å¿µæ˜¯ä¸ºäº†çœŸæ­£è¿›å…¥æœ¬ç« ä¸»é¢˜åšçš„é“ºå«ã€‚çœŸæ­£çš„é‡ç‚¹æ˜¯MySQLé‡‡ç”¨äº†ä»€ä¹ˆæ ·çš„ç®—æ³•æ¥è¿›è¡Œè¡¨ä¸è¡¨ä¹‹é—´çš„è¿æ¥ï¼Œäº†è§£äº†è¿™ä¸ªä¹‹åï¼Œå¤§å®¶æ‰èƒ½æ˜ç™½ä¸ºå•¥æœ‰çš„è¿æ¥æŸ¥è¯¢è¿è¡Œçš„å¿«å¦‚é—ªç”µï¼Œæœ‰çš„å´æ…¢å¦‚èœ—ç‰›ã€‚</p><h3 id="åµŒå¥—å¾ªç¯è¿æ¥ï¼ˆNested-Loop-Joinï¼‰">åµŒå¥—å¾ªç¯è¿æ¥ï¼ˆNested-Loop Joinï¼‰</h3><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œå¯¹äºä¸¤è¡¨è¿æ¥æ¥è¯´ï¼Œé©±åŠ¨è¡¨åªä¼šè¢«è®¿é—®ä¸€éï¼Œä½†è¢«é©±åŠ¨è¡¨å´è¦è¢«è®¿é—®åˆ°å¥½å¤šéï¼Œå…·ä½“è®¿é—®å‡ éå–å†³äºå¯¹é©±åŠ¨è¡¨æ‰§è¡Œå•è¡¨æŸ¥è¯¢åçš„ç»“æœé›†ä¸­çš„è®°å½•æ¡æ•°ã€‚å¯¹äºå†…è¿æ¥æ¥è¯´ï¼Œé€‰å–å“ªä¸ªè¡¨ä¸ºé©±åŠ¨è¡¨éƒ½æ²¡å…³ç³»ï¼Œè€Œå¤–è¿æ¥çš„é©±åŠ¨è¡¨æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å·¦ï¼ˆå¤–ï¼‰è¿æ¥çš„é©±åŠ¨è¡¨å°±æ˜¯å·¦è¾¹çš„é‚£ä¸ªè¡¨ï¼Œå³ï¼ˆå¤–ï¼‰è¿æ¥çš„é©±åŠ¨è¡¨å°±æ˜¯å³è¾¹çš„é‚£ä¸ªè¡¨ã€‚æˆ‘ä»¬ä¸Šè¾¹å·²ç»å¤§è‡´ä»‹ç»è¿‡<code>t1</code>è¡¨å’Œ<code>t2</code>è¡¨æ‰§è¡Œå†…è¿æ¥æŸ¥è¯¢çš„å¤§è‡´è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ¸©ä¹ ä¸€ä¸‹ï¼š</p><ul><li>æ­¥éª¤1ï¼šé€‰å–é©±åŠ¨è¡¨ï¼Œä½¿ç”¨ä¸é©±åŠ¨è¡¨ç›¸å…³çš„è¿‡æ»¤æ¡ä»¶ï¼Œé€‰å–ä»£ä»·æœ€ä½çš„å•è¡¨è®¿é—®æ–¹æ³•æ¥æ‰§è¡Œå¯¹é©±åŠ¨è¡¨çš„å•è¡¨æŸ¥è¯¢ã€‚</li><li>æ­¥éª¤2ï¼šå¯¹ä¸Šä¸€æ­¥éª¤ä¸­æŸ¥è¯¢é©±åŠ¨è¡¨å¾—åˆ°çš„ç»“æœé›†ä¸­æ¯ä¸€æ¡è®°å½•ï¼Œéƒ½åˆ†åˆ«åˆ°è¢«é©±åŠ¨è¡¨ä¸­æŸ¥æ‰¾åŒ¹é…çš„è®°å½•ã€‚</li></ul><p>é€šç”¨çš„ä¸¤è¡¨è¿æ¥è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/167e43ab3fa0f107~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ctsr5ui2cdk1jduqafm7p1d3426.png-129.4kB"><p>å¦‚æœæœ‰3ä¸ªè¡¨è¿›è¡Œè¿æ¥çš„è¯ï¼Œé‚£ä¹ˆ<code>æ­¥éª¤2</code>ä¸­å¾—åˆ°çš„ç»“æœé›†å°±åƒæ˜¯æ–°çš„é©±åŠ¨è¡¨ï¼Œç„¶åç¬¬ä¸‰ä¸ªè¡¨å°±æˆä¸ºäº†è¢«é©±åŠ¨è¡¨ï¼Œé‡å¤ä¸Šè¾¹è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯<code>æ­¥éª¤2</code>ä¸­å¾—åˆ°çš„ç»“æœé›†ä¸­çš„æ¯ä¸€æ¡è®°å½•éƒ½éœ€è¦åˆ°<code>t3</code>è¡¨ä¸­æ‰¾ä¸€æ‰¾æœ‰æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼Œç”¨ä¼ªä»£ç è¡¨ç¤ºä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">row</span> <span class="hljs-keyword">in</span> t1 &#123;   #æ­¤å¤„è¡¨ç¤ºéå†æ»¡è¶³å¯¹t1å•è¡¨æŸ¥è¯¢ç»“æœé›†ä¸­çš„æ¯ä¸€æ¡è®°å½•<br>    <br>    <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">row</span> <span class="hljs-keyword">in</span> t2 &#123;   #æ­¤å¤„è¡¨ç¤ºå¯¹äºæŸæ¡t1è¡¨çš„è®°å½•æ¥è¯´ï¼Œéå†æ»¡è¶³å¯¹t2å•è¡¨æŸ¥è¯¢ç»“æœé›†ä¸­çš„æ¯ä¸€æ¡è®°å½•<br>    <br>        <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">row</span> <span class="hljs-keyword">in</span> t3 &#123;   #æ­¤å¤„è¡¨ç¤ºå¯¹äºæŸæ¡t1å’Œt2è¡¨çš„è®°å½•ç»„åˆæ¥è¯´ï¼Œå¯¹t3è¡¨è¿›è¡Œå•è¡¨æŸ¥è¯¢<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">row</span> satisfies <span class="hljs-keyword">join</span> conditions, send <span class="hljs-keyword">to</span> client<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè¿‡ç¨‹å°±åƒæ˜¯ä¸€ä¸ªåµŒå¥—çš„å¾ªç¯ï¼Œæ‰€ä»¥è¿™ç§é©±åŠ¨è¡¨åªè®¿é—®ä¸€æ¬¡ï¼Œä½†è¢«é©±åŠ¨è¡¨å´å¯èƒ½è¢«å¤šæ¬¡è®¿é—®ï¼Œè®¿é—®æ¬¡æ•°å–å†³äºå¯¹é©±åŠ¨è¡¨æ‰§è¡Œå•è¡¨æŸ¥è¯¢åçš„ç»“æœé›†ä¸­çš„è®°å½•æ¡æ•°çš„è¿æ¥æ‰§è¡Œæ–¹å¼ç§°ä¹‹ä¸º<code>åµŒå¥—å¾ªç¯è¿æ¥</code>ï¼ˆ<code>Nested-Loop Join</code>ï¼‰ï¼Œè¿™æ˜¯æœ€ç®€å•ï¼Œä¹Ÿæ˜¯æœ€ç¬¨æ‹™çš„ä¸€ç§è¿æ¥æŸ¥è¯¢ç®—æ³•ã€‚</p><h3 id="ä½¿ç”¨ç´¢å¼•åŠ å¿«è¿æ¥é€Ÿåº¦">ä½¿ç”¨ç´¢å¼•åŠ å¿«è¿æ¥é€Ÿåº¦</h3><p>æˆ‘ä»¬çŸ¥é“åœ¨<code>åµŒå¥—å¾ªç¯è¿æ¥</code>çš„<code>æ­¥éª¤2</code>ä¸­å¯èƒ½éœ€è¦è®¿é—®å¤šæ¬¡è¢«é©±åŠ¨è¡¨ï¼Œå¦‚æœè®¿é—®è¢«é©±åŠ¨è¡¨çš„æ–¹å¼éƒ½æ˜¯å…¨è¡¨æ‰«æçš„è¯ï¼Œå¦ˆå‘€ï¼Œé‚£å¾—è¦æ‰«æå¥½å¤šæ¬¡å‘€ï½ï½ï½ ä½†æ˜¯åˆ«å¿˜äº†ï¼ŒæŸ¥è¯¢<code>t2</code>è¡¨å…¶å®å°±ç›¸å½“äºä¸€æ¬¡å•è¡¨æ‰«æï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç´¢å¼•æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦å“¦ã€‚å›é¡¾ä¸€ä¸‹æœ€å¼€å§‹ä»‹ç»çš„<code>t1</code>è¡¨å’Œ<code>t2</code>è¡¨è¿›è¡Œå†…è¿æ¥çš„ä¾‹å­ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> * FROM t<span class="hljs-number">1</span>, t<span class="hljs-number">2</span> WHERE t<span class="hljs-number">1</span>.m<span class="hljs-number">1</span> &gt; <span class="hljs-number">1</span> AND t<span class="hljs-number">1</span>.m<span class="hljs-number">1</span> = t<span class="hljs-number">2</span>.m<span class="hljs-number">2</span> AND t<span class="hljs-number">2</span>.n<span class="hljs-number">2</span> &lt; &#x27;d&#x27;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨çš„å…¶å®æ˜¯<code>åµŒå¥—å¾ªç¯è¿æ¥</code>ç®—æ³•æ‰§è¡Œçš„è¿æ¥æŸ¥è¯¢ï¼Œå†æŠŠä¸Šè¾¹é‚£ä¸ªæŸ¥è¯¢æ‰§è¡Œè¿‡ç¨‹è¡¨æ‹‰ä¸‹æ¥ç»™å¤§å®¶çœ‹ä¸€ä¸‹ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/167e43ab3a02660b~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ctrsprar1bbh17lee79le63ls2m.png-49.6kB"><p>æŸ¥è¯¢é©±åŠ¨è¡¨<code>t1</code>åçš„ç»“æœé›†ä¸­æœ‰ä¸¤æ¡è®°å½•ï¼Œ<code>åµŒå¥—å¾ªç¯è¿æ¥</code>ç®—æ³•éœ€è¦å¯¹è¢«é©±åŠ¨è¡¨æŸ¥è¯¢2æ¬¡ï¼š</p><ul><li><p>å½“<code>t1.m1 = 2</code>æ—¶ï¼Œå»æŸ¥è¯¢ä¸€é<code>t2</code>è¡¨ï¼Œå¯¹<code>t2</code>è¡¨çš„æŸ¥è¯¢è¯­å¥ç›¸å½“äºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> * FROM t<span class="hljs-number">2</span> WHERE t<span class="hljs-number">2</span>.m<span class="hljs-number">2</span> = <span class="hljs-number">2</span> AND t<span class="hljs-number">2</span>.n<span class="hljs-number">2</span> &lt; &#x27;d&#x27;;<br></code></pre></td></tr></table></figure></li><li><p>å½“<code>t1.m1 = 3</code>æ—¶ï¼Œå†å»æŸ¥è¯¢ä¸€é<code>t2</code>è¡¨ï¼Œæ­¤æ—¶å¯¹<code>t2</code>è¡¨çš„æŸ¥è¯¢è¯­å¥ç›¸å½“äºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> * FROM t<span class="hljs-number">2</span> WHERE t<span class="hljs-number">2</span>.m<span class="hljs-number">2</span> = <span class="hljs-number">3</span> AND t<span class="hljs-number">2</span>.n<span class="hljs-number">2</span> &lt; &#x27;d&#x27;;<br></code></pre></td></tr></table></figure></li></ul><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŸæ¥çš„<code>t1.m1 = t2.m2</code>è¿™ä¸ªæ¶‰åŠä¸¤ä¸ªè¡¨çš„è¿‡æ»¤æ¡ä»¶åœ¨é’ˆå¯¹<code>t2</code>è¡¨åšæŸ¥è¯¢æ—¶å…³äº<code>t1</code>è¡¨çš„æ¡ä»¶å°±å·²ç»ç¡®å®šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å•å•ä¼˜åŒ–å¯¹<code>t2</code>è¡¨çš„æŸ¥è¯¢äº†ï¼Œä¸Šè¿°ä¸¤ä¸ªå¯¹<code>t2</code>è¡¨çš„æŸ¥è¯¢è¯­å¥ä¸­åˆ©ç”¨åˆ°çš„åˆ—æ˜¯<code>m2</code>å’Œ<code>n2</code>åˆ—ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p><ul><li><p>åœ¨<code>m2</code>åˆ—ä¸Šå»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºå¯¹<code>m2</code>åˆ—çš„æ¡ä»¶æ˜¯ç­‰å€¼æŸ¥æ‰¾ï¼Œæ¯”å¦‚<code>t2.m2 = 2</code>ã€<code>t2.m2 = 3</code>ç­‰ï¼Œæ‰€ä»¥å¯èƒ½ä½¿ç”¨åˆ°<code>ref</code>çš„è®¿é—®æ–¹æ³•ï¼Œå‡è®¾ä½¿ç”¨<code>ref</code>çš„è®¿é—®æ–¹æ³•å»æ‰§è¡Œå¯¹<code>t2</code>è¡¨çš„æŸ¥è¯¢çš„è¯ï¼Œéœ€è¦å›è¡¨ä¹‹åå†åˆ¤æ–­<code>t2.n2 &lt; d</code>è¿™ä¸ªæ¡ä»¶æ˜¯å¦æˆç«‹ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µï¼Œå°±æ˜¯å‡è®¾<code>m2</code>åˆ—æ˜¯<code>t2</code>è¡¨çš„ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆä½¿ç”¨<code>t2.m2 = å¸¸æ•°å€¼</code>è¿™æ ·çš„æ¡ä»¶ä»<code>t2</code>è¡¨ä¸­æŸ¥æ‰¾è®°å½•çš„è¿‡ç¨‹çš„ä»£ä»·å°±æ˜¯å¸¸æ•°çº§åˆ«çš„ã€‚æˆ‘ä»¬çŸ¥é“åœ¨å•è¡¨ä¸­ä½¿ç”¨ä¸»é”®å€¼æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—çš„å€¼è¿›è¡Œç­‰å€¼æŸ¥æ‰¾çš„æ–¹å¼ç§°ä¹‹ä¸º<code>const</code>ï¼Œè€Œè®¾è®¡<code>MySQL</code>çš„å¤§å”æŠŠåœ¨è¿æ¥æŸ¥è¯¢ä¸­å¯¹è¢«é©±åŠ¨è¡¨ä½¿ç”¨ä¸»é”®å€¼æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—çš„å€¼è¿›è¡Œç­‰å€¼æŸ¥æ‰¾çš„æŸ¥è¯¢æ‰§è¡Œæ–¹å¼ç§°ä¹‹ä¸ºï¼š<code>eq_ref</code>ã€‚</p></li><li><p>åœ¨<code>n2</code>åˆ—ä¸Šå»ºç«‹ç´¢å¼•ï¼Œæ¶‰åŠåˆ°çš„æ¡ä»¶æ˜¯<code>t2.n2 &lt; 'd'</code>ï¼Œå¯èƒ½ç”¨åˆ°<code>range</code>çš„è®¿é—®æ–¹æ³•ï¼Œå‡è®¾ä½¿ç”¨<code>range</code>çš„è®¿é—®æ–¹æ³•å¯¹<code>t2</code>è¡¨çš„æŸ¥è¯¢çš„è¯ï¼Œéœ€è¦å›è¡¨ä¹‹åå†åˆ¤æ–­åœ¨<code>m2</code>åˆ—ä¸Šçš„æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚</p></li></ul><p>å‡è®¾<code>m2</code>å’Œ<code>n2</code>åˆ—ä¸Šéƒ½å­˜åœ¨ç´¢å¼•çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦ä»è¿™ä¸¤ä¸ªé‡Œè¾¹å„¿æŒ‘ä¸€ä¸ªä»£ä»·æ›´ä½çš„å»æ‰§è¡Œå¯¹<code>t2</code>è¡¨çš„æŸ¥è¯¢ã€‚å½“ç„¶ï¼Œå»ºç«‹äº†ç´¢å¼•ä¸ä¸€å®šä½¿ç”¨ç´¢å¼•ï¼Œåªæœ‰åœ¨<code>äºŒçº§ç´¢å¼• + å›è¡¨</code>çš„ä»£ä»·æ¯”å…¨è¡¨æ‰«æçš„ä»£ä»·æ›´ä½æ—¶æ‰ä¼šä½¿ç”¨ç´¢å¼•ã€‚</p><p>å¦å¤–ï¼Œæœ‰æ—¶å€™è¿æ¥æŸ¥è¯¢çš„æŸ¥è¯¢åˆ—è¡¨å’Œè¿‡æ»¤æ¡ä»¶ä¸­å¯èƒ½åªæ¶‰åŠè¢«é©±åŠ¨è¡¨çš„éƒ¨åˆ†åˆ—ï¼Œè€Œè¿™äº›åˆ—éƒ½æ˜¯æŸä¸ªç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼Œè¿™ç§æƒ…å†µä¸‹å³ä½¿ä¸èƒ½ä½¿ç”¨<code>eq_ref</code>ã€<code>ref</code>ã€<code>ref_or_null</code>æˆ–è€…<code>range</code>è¿™äº›è®¿é—®æ–¹æ³•æ‰§è¡Œå¯¹è¢«é©±åŠ¨è¡¨çš„æŸ¥è¯¢çš„è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç´¢å¼•æ‰«æï¼Œä¹Ÿå°±æ˜¯<code>index</code>çš„è®¿é—®æ–¹æ³•æ¥æŸ¥è¯¢è¢«é©±åŠ¨è¡¨ã€‚æ‰€ä»¥æˆ‘ä»¬å»ºè®®åœ¨çœŸå®å·¥ä½œä¸­æœ€å¥½ä¸è¦ä½¿ç”¨<code>*</code>ä½œä¸ºæŸ¥è¯¢åˆ—è¡¨ï¼Œæœ€å¥½æŠŠçœŸå®ç”¨åˆ°çš„åˆ—ä½œä¸ºæŸ¥è¯¢åˆ—è¡¨ã€‚</p><h3 id="åŸºäºå—çš„åµŒå¥—å¾ªç¯è¿æ¥ï¼ˆBlock-Nested-Loop-Joinï¼‰">åŸºäºå—çš„åµŒå¥—å¾ªç¯è¿æ¥ï¼ˆBlock Nested-Loop Joinï¼‰</h3><p>**æ‰«æä¸€ä¸ªè¡¨çš„è¿‡ç¨‹å…¶å®æ˜¯å…ˆæŠŠè¿™ä¸ªè¡¨ä»ç£ç›˜ä¸ŠåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åä»å†…å­˜ä¸­æ¯”è¾ƒåŒ¹é…æ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚**ç°å®ç”Ÿæ´»ä¸­çš„è¡¨å¯ä¸åƒ<code>t1</code>ã€<code>t2</code>è¿™ç§åªæœ‰3æ¡è®°å½•ï¼Œæˆåƒä¸Šä¸‡æ¡è®°å½•éƒ½æ˜¯å°‘çš„ï¼Œå‡ ç™¾ä¸‡ã€å‡ åƒä¸‡ç”šè‡³å‡ äº¿æ¡è®°å½•çš„è¡¨åˆ°å¤„éƒ½æ˜¯ã€‚å†…å­˜é‡Œå¯èƒ½å¹¶ä¸èƒ½å®Œå…¨å­˜æ”¾çš„ä¸‹è¡¨ä¸­æ‰€æœ‰çš„è®°å½•ï¼Œæ‰€ä»¥åœ¨æ‰«æè¡¨å‰è¾¹è®°å½•çš„æ—¶å€™åè¾¹çš„è®°å½•å¯èƒ½è¿˜åœ¨ç£ç›˜ä¸Šï¼Œç­‰æ‰«æåˆ°åè¾¹è®°å½•çš„æ—¶å€™å¯èƒ½å†…å­˜ä¸è¶³ï¼Œæ‰€ä»¥éœ€è¦æŠŠå‰è¾¹çš„è®°å½•ä»å†…å­˜ä¸­é‡Šæ”¾æ‰ã€‚æˆ‘ä»¬å‰è¾¹åˆè¯´è¿‡ï¼Œé‡‡ç”¨<code>åµŒå¥—å¾ªç¯è¿æ¥</code>ç®—æ³•çš„ä¸¤è¡¨è¿æ¥è¿‡ç¨‹ä¸­ï¼Œè¢«é©±åŠ¨è¡¨å¯æ˜¯è¦è¢«è®¿é—®å¥½å¤šæ¬¡çš„ï¼Œå¦‚æœè¿™ä¸ªè¢«é©±åŠ¨è¡¨ä¸­çš„æ•°æ®ç‰¹åˆ«å¤šè€Œä¸”ä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œè®¿é—®ï¼Œé‚£å°±ç›¸å½“äºè¦ä»ç£ç›˜ä¸Šè¯»å¥½å‡ æ¬¡è¿™ä¸ªè¡¨ï¼Œè¿™ä¸ª<code>I/O</code>ä»£ä»·å°±éå¸¸å¤§äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—æƒ³åŠæ³•ï¼š<strong>å°½é‡å‡å°‘è®¿é—®è¢«é©±åŠ¨è¡¨çš„æ¬¡æ•°</strong>ã€‚</p><p>å½“è¢«é©±åŠ¨è¡¨ä¸­çš„æ•°æ®éå¸¸å¤šæ—¶ï¼Œæ¯æ¬¡è®¿é—®è¢«é©±åŠ¨è¡¨ï¼Œè¢«é©±åŠ¨è¡¨çš„è®°å½•ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåœ¨å†…å­˜ä¸­çš„æ¯ä¸€æ¡è®°å½•åªä¼šå’Œé©±åŠ¨è¡¨ç»“æœé›†çš„ä¸€æ¡è®°å½•åšåŒ¹é…ï¼Œä¹‹åå°±ä¼šè¢«ä»å†…å­˜ä¸­æ¸…é™¤æ‰ã€‚ç„¶åå†ä»é©±åŠ¨è¡¨ç»“æœé›†ä¸­æ‹¿å‡ºå¦ä¸€æ¡è®°å½•ï¼Œå†ä¸€æ¬¡æŠŠè¢«é©±åŠ¨è¡¨çš„è®°å½•åŠ è½½åˆ°å†…å­˜ä¸­ä¸€éï¼Œå‘¨è€Œå¤å§‹ï¼Œé©±åŠ¨è¡¨ç»“æœé›†ä¸­æœ‰å¤šå°‘æ¡è®°å½•ï¼Œå°±å¾—æŠŠè¢«é©±åŠ¨è¡¨ä»ç£ç›˜ä¸ŠåŠ è½½åˆ°å†…å­˜ä¸­å¤šå°‘æ¬¡ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä¸å¯ä»¥åœ¨æŠŠè¢«é©±åŠ¨è¡¨çš„è®°å½•åŠ è½½åˆ°å†…å­˜çš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§å’Œå¤šæ¡é©±åŠ¨è¡¨ä¸­çš„è®°å½•åšåŒ¹é…ï¼Œè¿™æ ·å°±å¯ä»¥å¤§å¤§å‡å°‘é‡å¤ä»ç£ç›˜ä¸ŠåŠ è½½è¢«é©±åŠ¨è¡¨çš„ä»£ä»·äº†ã€‚æ‰€ä»¥è®¾è®¡<code>MySQL</code>çš„å¤§å”æå‡ºäº†ä¸€ä¸ª<code>join buffer</code>çš„æ¦‚å¿µï¼Œ<code>join buffer</code>å°±æ˜¯æ‰§è¡Œè¿æ¥æŸ¥è¯¢å‰ç”³è¯·çš„ä¸€å—å›ºå®šå¤§å°çš„å†…å­˜ï¼Œå…ˆæŠŠè‹¥å¹²æ¡é©±åŠ¨è¡¨ç»“æœé›†ä¸­çš„è®°å½•è£…åœ¨è¿™ä¸ª<code>join buffer</code>ä¸­ï¼Œç„¶åå¼€å§‹æ‰«æè¢«é©±åŠ¨è¡¨ï¼Œæ¯ä¸€æ¡è¢«é©±åŠ¨è¡¨çš„è®°å½•ä¸€æ¬¡æ€§å’Œ<code>join buffer</code>ä¸­çš„å¤šæ¡é©±åŠ¨è¡¨è®°å½•åšåŒ¹é…ï¼Œå› ä¸ºåŒ¹é…çš„è¿‡ç¨‹éƒ½æ˜¯åœ¨å†…å­˜ä¸­å®Œæˆçš„ï¼Œæ‰€ä»¥è¿™æ ·å¯ä»¥æ˜¾è‘—å‡å°‘è¢«é©±åŠ¨è¡¨çš„<code>I/O</code>ä»£ä»·ã€‚ä½¿ç”¨<code>join buffer</code>çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/167e43ab3e5fa2f6~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1ctuhe3t71ahd10gn19917fo1nft4g.png-57.7kB"><p>æœ€å¥½çš„æƒ…å†µæ˜¯<code>join buffer</code>è¶³å¤Ÿå¤§ï¼Œèƒ½å®¹çº³é©±åŠ¨è¡¨ç»“æœé›†ä¸­çš„æ‰€æœ‰è®°å½•ï¼Œè¿™æ ·åªéœ€è¦è®¿é—®ä¸€æ¬¡è¢«é©±åŠ¨è¡¨å°±å¯ä»¥å®Œæˆè¿æ¥æ“ä½œäº†ã€‚è®¾è®¡<code>MySQL</code>çš„å¤§å”æŠŠè¿™ç§åŠ å…¥äº†<code>join buffer</code>çš„åµŒå¥—å¾ªç¯è¿æ¥ç®—æ³•ç§°ä¹‹ä¸º<code>åŸºäºå—çš„åµŒå¥—è¿æ¥</code>ï¼ˆBlock Nested-Loop Joinï¼‰ç®—æ³•ã€‚</p><p>è¿™ä¸ª<code>join buffer</code>çš„å¤§å°æ˜¯å¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°æˆ–è€…ç³»ç»Ÿå˜é‡<code>join_buffer_size</code>è¿›è¡Œé…ç½®ï¼Œé»˜è®¤å¤§å°ä¸º<code>262144å­—èŠ‚</code>ï¼ˆä¹Ÿå°±æ˜¯<code>256KB</code>ï¼‰ï¼Œæœ€å°å¯ä»¥è®¾ç½®ä¸º<code>128å­—èŠ‚</code>ã€‚å½“ç„¶ï¼Œå¯¹äºä¼˜åŒ–è¢«é©±åŠ¨è¡¨çš„æŸ¥è¯¢æ¥è¯´ï¼Œæœ€å¥½æ˜¯ä¸ºè¢«é©±åŠ¨è¡¨åŠ ä¸Šæ•ˆç‡é«˜çš„ç´¢å¼•ï¼Œå¦‚æœå®åœ¨ä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œå¹¶ä¸”è‡ªå·±çš„æœºå™¨çš„å†…å­˜ä¹Ÿæ¯”è¾ƒå¤§å¯ä»¥å°è¯•è°ƒå¤§<code>join_buffer_size</code>çš„å€¼æ¥å¯¹è¿æ¥æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚</p><p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé©±åŠ¨è¡¨çš„è®°å½•å¹¶ä¸æ˜¯æ‰€æœ‰åˆ—éƒ½ä¼šè¢«æ”¾åˆ°<code>join buffer</code>ä¸­ï¼Œåªæœ‰æŸ¥è¯¢åˆ—è¡¨ä¸­çš„åˆ—å’Œè¿‡æ»¤æ¡ä»¶ä¸­çš„åˆ—æ‰ä¼šè¢«æ”¾åˆ°<code>join buffer</code>ä¸­ï¼Œæ‰€ä»¥å†æ¬¡æé†’æˆ‘ä»¬ï¼Œæœ€å¥½ä¸è¦æŠŠ<code>*</code>ä½œä¸ºæŸ¥è¯¢åˆ—è¡¨ï¼Œåªéœ€è¦æŠŠæˆ‘ä»¬å…³å¿ƒçš„åˆ—æ”¾åˆ°æŸ¥è¯¢åˆ—è¡¨å°±å¥½äº†ï¼Œè¿™æ ·è¿˜å¯ä»¥åœ¨<code>join buffer</code>ä¸­æ”¾ç½®æ›´å¤šçš„è®°å½•å‘¢å“ˆã€‚</p><h1>12.åŸºäºæˆæœ¬çš„ä¼˜åŒ–</h1><h2 id="ä»€ä¹ˆæ˜¯æˆæœ¬">ä»€ä¹ˆæ˜¯æˆæœ¬</h2><p>æˆ‘ä»¬ä¹‹å‰è€è¯´<code>MySQL</code>æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢å¯ä»¥æœ‰ä¸åŒçš„æ‰§è¡Œæ–¹æ¡ˆï¼Œå®ƒä¼šé€‰æ‹©å…¶ä¸­æˆæœ¬æœ€ä½ï¼Œæˆ–è€…è¯´ä»£ä»·æœ€ä½çš„é‚£ç§æ–¹æ¡ˆå»çœŸæ­£çš„æ‰§è¡ŒæŸ¥è¯¢ã€‚ä¸è¿‡æˆ‘ä»¬ä¹‹å‰å¯¹<code>æˆæœ¬</code>çš„æè¿°æ˜¯éå¸¸æ¨¡ç³Šçš„ï¼Œå…¶å®åœ¨<code>MySQL</code>ä¸­ä¸€æ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæˆæœ¬æ˜¯ç”±ä¸‹è¾¹è¿™ä¸¤ä¸ªæ–¹é¢ç»„æˆçš„ï¼š</p><ul><li><p><code>I/O</code>æˆæœ¬</p><p>æˆ‘ä»¬çš„è¡¨ç»å¸¸ä½¿ç”¨çš„<code>MyISAM</code>ã€<code>InnoDB</code>å­˜å‚¨å¼•æ“éƒ½æ˜¯å°†æ•°æ®å’Œç´¢å¼•éƒ½å­˜å‚¨åˆ°ç£ç›˜ä¸Šçš„ï¼Œå½“æˆ‘ä»¬æƒ³æŸ¥è¯¢è¡¨ä¸­çš„è®°å½•æ—¶ï¼Œéœ€è¦å…ˆæŠŠæ•°æ®æˆ–è€…ç´¢å¼•åŠ è½½åˆ°å†…å­˜ä¸­ç„¶åå†æ“ä½œã€‚è¿™ä¸ªä»ç£ç›˜åˆ°å†…å­˜è¿™ä¸ªåŠ è½½çš„è¿‡ç¨‹æŸè€—çš„æ—¶é—´ç§°ä¹‹ä¸º<code>I/O</code>æˆæœ¬ã€‚</p></li><li><p><code>CPU</code>æˆæœ¬</p><p>è¯»å–ä»¥åŠæ£€æµ‹è®°å½•æ˜¯å¦æ»¡è¶³å¯¹åº”çš„æœç´¢æ¡ä»¶ã€å¯¹ç»“æœé›†è¿›è¡Œæ’åºç­‰è¿™äº›æ“ä½œæŸè€—çš„æ—¶é—´ç§°ä¹‹ä¸º<code>CPU</code>æˆæœ¬ã€‚</p></li></ul><p>å¯¹äº<code>InnoDB</code>å­˜å‚¨å¼•æ“æ¥è¯´ï¼Œé¡µæ˜¯ç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤äº’çš„åŸºæœ¬å•ä½ï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”è§„å®šè¯»å–ä¸€ä¸ªé¡µé¢èŠ±è´¹çš„æˆæœ¬é»˜è®¤æ˜¯<code>1.0</code>ï¼Œè¯»å–ä»¥åŠæ£€æµ‹ä¸€æ¡è®°å½•æ˜¯å¦ç¬¦åˆæœç´¢æ¡ä»¶çš„æˆæœ¬é»˜è®¤æ˜¯<code>0.2</code>ã€‚<code>1.0</code>ã€<code>0.2</code>è¿™äº›æ•°å­—ç§°ä¹‹ä¸º<code>æˆæœ¬å¸¸æ•°</code>ï¼Œè¿™ä¸¤ä¸ªæˆæœ¬å¸¸æ•°æˆ‘ä»¬æœ€å¸¸ç”¨åˆ°ï¼Œå…¶ä½™çš„æˆæœ¬å¸¸æ•°æˆ‘ä»¬åè¾¹å†è¯´å“ˆã€‚</p><blockquote><p>å°è´´å£«ï¼š éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ç®¡è¯»å–è®°å½•æ—¶éœ€ä¸éœ€è¦æ£€æµ‹æ˜¯å¦æ»¡è¶³æœç´¢æ¡ä»¶ï¼Œå…¶æˆæœ¬éƒ½ç®—æ˜¯0.2ã€‚</p></blockquote><h2 id="å•è¡¨æŸ¥è¯¢çš„æˆæœ¬">å•è¡¨æŸ¥è¯¢çš„æˆæœ¬</h2><h3 id="å‡†å¤‡å·¥ä½œ-2">å‡†å¤‡å·¥ä½œ</h3><p>ä¸ºäº†æ•…äº‹çš„é¡ºåˆ©å‘å±•ï¼Œæˆ‘ä»¬è¿˜å¾—æŠŠä¹‹å‰ç”¨åˆ°çš„<code>single_table</code>è¡¨æ¬æ¥ï¼Œæ€•å¤§å®¶å¿˜äº†è¿™ä¸ªè¡¨é•¿å•¥æ ·ï¼Œå†ç»™å¤§å®¶æŠ„ä¸€éï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> single_table (<br>    id <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    key1 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    key2 <span class="hljs-type">INT</span>,<br>    key3 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    key_part1 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    key_part2 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    key_part3 <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    common_field <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    <span class="hljs-keyword">PRIMARY</span> KEY (id),<br>    KEY idx_key1 (key1),<br>    <span class="hljs-keyword">UNIQUE</span> KEY idx_key2 (key2),<br>    KEY idx_key3 (key3),<br>    KEY idx_key_part(key_part1, key_part2, key_part3)<br>) Engine<span class="hljs-operator">=</span>InnoDB CHARSET<span class="hljs-operator">=</span>utf8;<br></code></pre></td></tr></table></figure><p>è¿˜æ˜¯å‡è®¾è¿™ä¸ªè¡¨é‡Œè¾¹å„¿æœ‰10000æ¡è®°å½•ï¼Œé™¤<code>id</code>åˆ—å¤–å…¶ä½™çš„åˆ—éƒ½æ’å…¥éšæœºå€¼ã€‚ä¸‹è¾¹æ­£å¼å¼€å§‹æˆ‘ä»¬çš„è¡¨æ¼”ã€‚</p><h3 id="åŸºäºæˆæœ¬çš„ä¼˜åŒ–æ­¥éª¤">åŸºäºæˆæœ¬çš„ä¼˜åŒ–æ­¥éª¤</h3><p>åœ¨ä¸€æ¡å•è¡¨æŸ¥è¯¢è¯­å¥çœŸæ­£æ‰§è¡Œä¹‹å‰ï¼Œ<code>MySQL</code>çš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šæ‰¾å‡ºæ‰§è¡Œè¯¥è¯­å¥æ‰€æœ‰å¯èƒ½ä½¿ç”¨çš„æ–¹æ¡ˆï¼Œå¯¹æ¯”ä¹‹åæ‰¾å‡ºæˆæœ¬æœ€ä½çš„æ–¹æ¡ˆï¼Œè¿™ä¸ªæˆæœ¬æœ€ä½çš„æ–¹æ¡ˆå°±æ˜¯æ‰€è°“çš„<code>æ‰§è¡Œè®¡åˆ’</code>ï¼Œä¹‹åæ‰ä¼šè°ƒç”¨å­˜å‚¨å¼•æ“æä¾›çš„æ¥å£çœŸæ­£çš„æ‰§è¡ŒæŸ¥è¯¢ï¼Œè¿™ä¸ªè¿‡ç¨‹æ€»ç»“ä¸€ä¸‹å°±æ˜¯è¿™æ ·ï¼š</p><ol><li>æ ¹æ®æœç´¢æ¡ä»¶ï¼Œæ‰¾å‡ºæ‰€æœ‰å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•</li><li>è®¡ç®—å…¨è¡¨æ‰«æçš„ä»£ä»·</li><li>è®¡ç®—ä½¿ç”¨ä¸åŒç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢çš„ä»£ä»·</li><li>å¯¹æ¯”å„ç§æ‰§è¡Œæ–¹æ¡ˆçš„ä»£ä»·ï¼Œæ‰¾å‡ºæˆæœ¬æœ€ä½çš„é‚£ä¸€ä¸ª</li></ol><p>ä¸‹è¾¹æˆ‘ä»¬å°±ä»¥ä¸€ä¸ªå®ä¾‹æ¥åˆ†æä¸€ä¸‹è¿™äº›æ­¥éª¤ï¼Œå•è¡¨æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">WHERE</span> <br>    key1 <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>) <span class="hljs-keyword">AND</span> <br>    key2 &gt; <span class="hljs-number">10</span> <span class="hljs-keyword">AND</span> key2 &lt; <span class="hljs-number">1000</span> <span class="hljs-keyword">AND</span> <br>    key3 &gt; key2 <span class="hljs-keyword">AND</span> <br>    key_part1 <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%hello%&#x27;</span> <span class="hljs-keyword">AND</span><br>    common_field = <span class="hljs-string">&#x27;123&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ä¹çœ‹ä¸Šå»æœ‰ç‚¹å„¿å¤æ‚å“¦ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åˆ†æä¸€ä¸‹ã€‚</p><h4 id="1-æ ¹æ®æœç´¢æ¡ä»¶ï¼Œæ‰¾å‡ºæ‰€æœ‰å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•">1. æ ¹æ®æœç´¢æ¡ä»¶ï¼Œæ‰¾å‡ºæ‰€æœ‰å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•</h4><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œå¯¹äº<code>B+</code>æ ‘ç´¢å¼•æ¥è¯´ï¼Œåªè¦ç´¢å¼•åˆ—å’Œå¸¸æ•°ä½¿ç”¨<code>=</code>ã€<code>&lt;=&gt;</code>ã€<code>IN</code>ã€<code>NOT IN</code>ã€<code>IS NULL</code>ã€<code>IS NOT NULL</code>ã€<code>&gt;</code>ã€<code>&lt;</code>ã€<code>&gt;=</code>ã€<code>&lt;=</code>ã€<code>BETWEEN</code>ã€<code>!=</code>ï¼ˆä¸ç­‰äºä¹Ÿå¯ä»¥å†™æˆ<code>&lt;&gt;</code>ï¼‰æˆ–è€…<code>LIKE</code>æ“ä½œç¬¦è¿æ¥èµ·æ¥ï¼Œå°±å¯ä»¥äº§ç”Ÿä¸€ä¸ªæ‰€è°“çš„<code>èŒƒå›´åŒºé—´</code>ï¼ˆ<code>LIKE</code>åŒ¹é…å­—ç¬¦ä¸²å‰ç¼€ä¹Ÿè¡Œï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›æœç´¢æ¡ä»¶éƒ½å¯èƒ½ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”æŠŠä¸€ä¸ªæŸ¥è¯¢ä¸­å¯èƒ½ä½¿ç”¨åˆ°çš„ç´¢å¼•ç§°ä¹‹ä¸º<code>possible keys</code>ã€‚</p><p>æˆ‘ä»¬åˆ†æä¸€ä¸‹ä¸Šè¾¹æŸ¥è¯¢ä¸­æ¶‰åŠåˆ°çš„å‡ ä¸ªæœç´¢æ¡ä»¶ï¼š</p><ul><li><code>key1 IN ('a', 'b', 'c')</code>ï¼Œè¿™ä¸ªæœç´¢æ¡ä»¶å¯ä»¥ä½¿ç”¨äºŒçº§ç´¢å¼•<code>idx_key1</code>ã€‚</li><li><code>key2 &gt; 10 AND key2 &lt; 1000</code>ï¼Œè¿™ä¸ªæœç´¢æ¡ä»¶å¯ä»¥ä½¿ç”¨äºŒçº§ç´¢å¼•<code>idx_key2</code>ã€‚</li><li><code>key3 &gt; key2</code>ï¼Œè¿™ä¸ªæœç´¢æ¡ä»¶çš„ç´¢å¼•åˆ—ç”±äºæ²¡æœ‰å’Œå¸¸æ•°æ¯”è¾ƒï¼Œæ‰€ä»¥å¹¶ä¸èƒ½ä½¿ç”¨åˆ°ç´¢å¼•ã€‚</li><li><code>key_part1 LIKE '%hello%'</code>ï¼Œ<code>key_part1</code>é€šè¿‡<code>LIKE</code>æ“ä½œç¬¦å’Œä»¥é€šé…ç¬¦å¼€å¤´çš„å­—ç¬¦ä¸²åšæ¯”è¾ƒï¼Œä¸å¯ä»¥é€‚ç”¨ç´¢å¼•ã€‚</li><li><code>common_field = '123'</code>ï¼Œç”±äºè¯¥åˆ—ä¸Šå‹æ ¹å„¿æ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¸ä¼šç”¨åˆ°ç´¢å¼•ã€‚</li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œä¸Šè¾¹çš„æŸ¥è¯¢è¯­å¥å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯<code>possible keys</code>åªæœ‰<code>idx_key1</code>å’Œ<code>idx_key2</code>ã€‚</p><h4 id="2-è®¡ç®—å…¨è¡¨æ‰«æçš„ä»£ä»·">2. è®¡ç®—å…¨è¡¨æ‰«æçš„ä»£ä»·</h4><p>å¯¹äº<code>InnoDB</code>å­˜å‚¨å¼•æ“æ¥è¯´ï¼Œå…¨è¡¨æ‰«æçš„æ„æ€å°±æ˜¯æŠŠèšç°‡ç´¢å¼•ä¸­çš„è®°å½•éƒ½ä¾æ¬¡å’Œç»™å®šçš„æœç´¢æ¡ä»¶åšä¸€ä¸‹æ¯”è¾ƒï¼ŒæŠŠç¬¦åˆæœç´¢æ¡ä»¶çš„è®°å½•åŠ å…¥åˆ°ç»“æœé›†ï¼Œæ‰€ä»¥éœ€è¦å°†èšç°‡ç´¢å¼•å¯¹åº”çš„é¡µé¢åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åå†æ£€æµ‹è®°å½•æ˜¯å¦ç¬¦åˆæœç´¢æ¡ä»¶ã€‚ç”±äºæŸ¥è¯¢æˆæœ¬=<code>I/O</code>æˆæœ¬+<code>CPU</code>æˆæœ¬ï¼Œæ‰€ä»¥è®¡ç®—å…¨è¡¨æ‰«æçš„ä»£ä»·éœ€è¦ä¸¤ä¸ªä¿¡æ¯ï¼š</p><ul><li>èšç°‡ç´¢å¼•å ç”¨çš„é¡µé¢æ•°</li><li>è¯¥è¡¨ä¸­çš„è®°å½•æ•°</li></ul><p>è¿™ä¸¤ä¸ªä¿¡æ¯ä»å“ªæ¥å‘¢ï¼Ÿè®¾è®¡<code>MySQL</code>çš„å¤§å”ä¸ºæ¯ä¸ªè¡¨ç»´æŠ¤äº†ä¸€ç³»åˆ—çš„<code>ç»Ÿè®¡ä¿¡æ¯</code>ï¼Œå…³äºè¿™äº›ç»Ÿè®¡ä¿¡æ¯æ˜¯å¦‚ä½•æ”¶é›†èµ·æ¥çš„æˆ‘ä»¬æ”¾åœ¨æœ¬ç« åè¾¹è¯¦ç»†å” å¨ï¼Œç°åœ¨çœ‹çœ‹æ€ä¹ˆæŸ¥çœ‹è¿™äº›ç»Ÿè®¡ä¿¡æ¯å“ˆã€‚è®¾è®¡<code>MySQL</code>çš„å¤§å”ç»™æˆ‘ä»¬æä¾›äº†<code>SHOW TABLE STATUS</code>è¯­å¥æ¥æŸ¥çœ‹è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¦‚æœè¦çœ‹æŒ‡å®šçš„æŸä¸ªè¡¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œåœ¨è¯¥è¯­å¥ååŠ å¯¹åº”çš„<code>LIKE</code>è¯­å¥å°±å¥½äº†ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬è¦æŸ¥çœ‹<code>single_table</code>è¿™ä¸ªè¡¨çš„ç»Ÿè®¡ä¿¡æ¯å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">mysql&gt;</span> <span class="hljs-string">USE</span> <span class="hljs-string">xiaohaizi;</span><br><span class="hljs-string">Database</span> <span class="hljs-string">changed</span><br><br><span class="hljs-string">mysql&gt;</span> <span class="hljs-string">SHOW</span> <span class="hljs-string">TABLE</span> <span class="hljs-string">STATUS</span> <span class="hljs-string">LIKE</span> <span class="hljs-string">&#x27;single_table&#x27;</span><span class="hljs-string">\G</span><br><span class="hljs-string">***************************</span> <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">row</span> <span class="hljs-string">***************************</span><br>           <span class="hljs-attr">Name:</span> <span class="hljs-string">single_table</span><br>         <span class="hljs-attr">Engine:</span> <span class="hljs-string">InnoDB</span><br>        <span class="hljs-attr">Version:</span> <span class="hljs-number">10</span><br>     <span class="hljs-attr">Row_format:</span> <span class="hljs-string">Dynamic</span><br>           <span class="hljs-attr">Rows:</span> <span class="hljs-number">9693</span><br> <span class="hljs-attr">Avg_row_length:</span> <span class="hljs-number">163</span><br>    <span class="hljs-attr">Data_length:</span> <span class="hljs-number">1589248</span><br><span class="hljs-attr">Max_data_length:</span> <span class="hljs-number">0</span><br>   <span class="hljs-attr">Index_length:</span> <span class="hljs-number">2752512</span><br>      <span class="hljs-attr">Data_free:</span> <span class="hljs-number">4194304</span><br> <span class="hljs-attr">Auto_increment:</span> <span class="hljs-number">10001</span><br>    <span class="hljs-attr">Create_time:</span> <span class="hljs-number">2018-12-10 13:37:23</span><br>    <span class="hljs-attr">Update_time:</span> <span class="hljs-number">2018-12-10 13:38:03</span><br>     <span class="hljs-attr">Check_time:</span> <span class="hljs-literal">NULL</span><br>      <span class="hljs-attr">Collation:</span> <span class="hljs-string">utf8_general_ci</span><br>       <span class="hljs-attr">Checksum:</span> <span class="hljs-literal">NULL</span><br> <span class="hljs-attr">Create_options:</span><br>        <span class="hljs-attr">Comment:</span><br><span class="hljs-number">1</span> <span class="hljs-string">row</span> <span class="hljs-string">in</span> <span class="hljs-string">set</span> <span class="hljs-string">(0.01</span> <span class="hljs-string">sec)</span><br></code></pre></td></tr></table></figure><p>è™½ç„¶å‡ºç°äº†å¾ˆå¤šç»Ÿè®¡é€‰é¡¹ï¼Œä½†æˆ‘ä»¬ç›®å‰åªå…³å¿ƒä¸¤ä¸ªï¼š</p><ul><li><p><code>Rows</code></p><p>æœ¬é€‰é¡¹è¡¨ç¤ºè¡¨ä¸­çš„è®°å½•æ¡æ•°**ã€‚å¯¹äºä½¿ç”¨<code>MyISAM</code>å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œè¯¥å€¼æ˜¯å‡†ç¡®çš„ï¼Œå¯¹äºä½¿ç”¨<code>InnoDB</code>å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œè¯¥å€¼æ˜¯ä¸€ä¸ªä¼°è®¡å€¼ã€‚**ä»æŸ¥è¯¢ç»“æœæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œç”±äºæˆ‘ä»¬çš„<code>single_table</code>è¡¨æ˜¯ä½¿ç”¨<code>InnoDB</code>å­˜å‚¨å¼•æ“çš„ï¼Œæ‰€ä»¥è™½ç„¶å®é™…ä¸Šè¡¨ä¸­æœ‰10000æ¡è®°å½•ï¼Œä½†æ˜¯<code>SHOW TABLE STATUS</code>æ˜¾ç¤ºçš„<code>Rows</code>å€¼åªæœ‰9693æ¡è®°å½•ã€‚</p></li><li><p><code>Data_length</code></p><p>æœ¬é€‰é¡¹è¡¨ç¤ºè¡¨å ç”¨çš„å­˜å‚¨ç©ºé—´å­—èŠ‚æ•°ã€‚ä½¿ç”¨<code>MyISAM</code>å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œè¯¥å€¼å°±æ˜¯æ•°æ®æ–‡ä»¶çš„å¤§å°ï¼Œå¯¹äºä½¿ç”¨<code>InnoDB</code>å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œè¯¥å€¼å°±ç›¸å½“äºèšç°‡ç´¢å¼•å ç”¨çš„å­˜å‚¨ç©ºé—´å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥è¿™æ ·è®¡ç®—è¯¥å€¼çš„å¤§å°ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">Data_length</span> = èšç°‡ç´¢å¼•çš„é¡µé¢æ•°é‡ x æ¯ä¸ªé¡µé¢çš„å¤§å°<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„<code>single_table</code>ä½¿ç”¨é»˜è®¤<code>16KB</code>çš„é¡µé¢å¤§å°ï¼Œè€Œä¸Šè¾¹æŸ¥è¯¢ç»“æœæ˜¾ç¤º<code>Data_length</code>çš„å€¼æ˜¯<code>1589248</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åå‘æ¥æ¨å¯¼å‡º<code>èšç°‡ç´¢å¼•çš„é¡µé¢æ•°é‡</code>ï¼š</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tap">èšç°‡ç´¢å¼•çš„é¡µé¢æ•°é‡ =<span class="hljs-number"> 1589248 </span>Ã·<span class="hljs-number"> 16 </span>Ã·<span class="hljs-number"> 1024 </span>= 97<br></code></pre></td></tr></table></figure></li></ul><p>æˆ‘ä»¬ç°åœ¨å·²ç»å¾—åˆ°äº†èšç°‡ç´¢å¼•å ç”¨çš„é¡µé¢æ•°é‡ä»¥åŠè¯¥è¡¨è®°å½•æ•°çš„ä¼°è®¡å€¼ï¼Œæ‰€ä»¥å°±å¯ä»¥è®¡ç®—å…¨è¡¨æ‰«ææˆæœ¬äº†ï¼Œä½†æ˜¯è®¾è®¡<code>MySQL</code>çš„å¤§å”åœ¨çœŸå®è®¡ç®—æˆæœ¬æ—¶ä¼šè¿›è¡Œä¸€äº›<code>å¾®è°ƒ</code>ï¼Œè¿™äº›å¾®è°ƒçš„å€¼æ˜¯ç›´æ¥ç¡¬ç¼–ç åˆ°ä»£ç é‡Œçš„ï¼Œç”±äºæ²¡æœ‰æ³¨é‡Šï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¿™äº›å¾®è°ƒå€¼æ˜¯ä¸ªå•¥å­æ„æ€ï¼Œä½†æ˜¯ç”±äºè¿™äº›å¾®è°ƒçš„å€¼ååˆ†çš„å°ï¼Œå¹¶ä¸å½±å“æˆ‘ä»¬åˆ†æï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿæ²¡æœ‰å¿…è¦åœ¨è¿™äº›å¾®è°ƒå€¼ä¸Šçº ç»“äº†ã€‚ç°åœ¨å¯ä»¥çœ‹ä¸€ä¸‹å…¨è¡¨æ‰«ææˆæœ¬çš„è®¡ç®—è¿‡ç¨‹ï¼š</p><ul><li><p><code>I/O</code>æˆæœ¬</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">97 </span>x <span class="hljs-number">1.0</span> + <span class="hljs-number">1.1</span> = <span class="hljs-number">98.1</span><br></code></pre></td></tr></table></figure><p><code>97</code>æŒ‡çš„æ˜¯èšç°‡ç´¢å¼•å ç”¨çš„é¡µé¢æ•°ï¼Œ<code>1.0</code>æŒ‡çš„æ˜¯åŠ è½½ä¸€ä¸ªé¡µé¢çš„æˆæœ¬å¸¸æ•°ï¼Œåè¾¹çš„<code>1.1</code>æ˜¯ä¸€ä¸ªå¾®è°ƒå€¼ï¼Œæˆ‘ä»¬ä¸ç”¨åœ¨æ„ã€‚</p></li><li><p><code>CPU</code>æˆæœ¬ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">9693 </span>x <span class="hljs-number">0.2</span> + <span class="hljs-number">1.0</span> = <span class="hljs-number">1939.6</span><br></code></pre></td></tr></table></figure><p><code>9693</code>æŒ‡çš„æ˜¯ç»Ÿè®¡æ•°æ®ä¸­è¡¨çš„è®°å½•æ•°ï¼Œå¯¹äº<code>InnoDB</code>å­˜å‚¨å¼•æ“æ¥è¯´æ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œ<code>0.2</code>æŒ‡çš„æ˜¯è®¿é—®ä¸€æ¡è®°å½•æ‰€éœ€çš„æˆæœ¬å¸¸æ•°ï¼Œåè¾¹çš„<code>1.0</code>æ˜¯ä¸€ä¸ªå¾®è°ƒå€¼ï¼Œæˆ‘ä»¬ä¸ç”¨åœ¨æ„ã€‚</p></li><li><p>æ€»æˆæœ¬ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">98</span>.<span class="hljs-number">1</span> + <span class="hljs-number">1939</span>.<span class="hljs-number">6</span> = <span class="hljs-number">2037</span>.<span class="hljs-number">7</span><br></code></pre></td></tr></table></figure></li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¯¹äº<code>single_table</code>çš„å…¨è¡¨æ‰«ææ‰€éœ€çš„æ€»æˆæœ¬å°±æ˜¯<code>2037.7</code>ã€‚</p><blockquote><p>å°è´´å£«ï¼š æˆ‘ä»¬å‰è¾¹è¯´è¿‡è¡¨ä¸­çš„è®°å½•å…¶å®éƒ½å­˜å‚¨åœ¨èšç°‡ç´¢å¼•å¯¹åº”B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬é€šè¿‡æ ¹èŠ‚ç‚¹è·å¾—äº†æœ€å·¦è¾¹çš„å¶å­èŠ‚ç‚¹ï¼Œå°±å¯ä»¥æ²¿ç€å¶å­èŠ‚ç‚¹ç»„æˆçš„åŒå‘é“¾è¡¨æŠŠæ‰€æœ‰è®°å½•éƒ½æŸ¥çœ‹ä¸€éã€‚ä¹Ÿå°±æ˜¯è¯´å…¨è¡¨æ‰«æè¿™ä¸ªè¿‡ç¨‹å…¶å®æœ‰çš„B+æ ‘å†…èŠ‚ç‚¹æ˜¯ä¸éœ€è¦è®¿é—®çš„ï¼Œä½†æ˜¯è®¾è®¡MySQLçš„å¤§å”ä»¬åœ¨è®¡ç®—å…¨è¡¨æ‰«ææˆæœ¬æ—¶ç›´æ¥ä½¿ç”¨èšç°‡ç´¢å¼•å ç”¨çš„é¡µé¢æ•°ä½œä¸ºè®¡ç®—I/Oæˆæœ¬çš„ä¾æ®ï¼Œæ˜¯ä¸åŒºåˆ†å†…èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹çš„ï¼Œæœ‰ç‚¹å„¿ç®€å•æš´åŠ›ï¼Œå¤§å®¶æ³¨æ„ä¸€ä¸‹å°±å¥½äº†ã€‚</p></blockquote><h4 id="3-è®¡ç®—ä½¿ç”¨ä¸åŒç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢çš„ä»£ä»·">3. è®¡ç®—ä½¿ç”¨ä¸åŒç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢çš„ä»£ä»·</h4><p>ä»ç¬¬1æ­¥åˆ†ææˆ‘ä»¬å¾—åˆ°ï¼Œä¸Šè¿°æŸ¥è¯¢å¯èƒ½ä½¿ç”¨åˆ°<code>idx_key1</code>å’Œ<code>idx_key2</code>è¿™ä¸¤ä¸ªç´¢å¼•ï¼Œæˆ‘ä»¬éœ€è¦åˆ†åˆ«åˆ†æå•ç‹¬ä½¿ç”¨è¿™äº›ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢çš„æˆæœ¬ï¼Œæœ€åè¿˜è¦åˆ†ææ˜¯å¦å¯èƒ½ä½¿ç”¨åˆ°ç´¢å¼•åˆå¹¶ã€‚è¿™é‡Œéœ€è¦æä¸€ç‚¹çš„æ˜¯ï¼Œ<code>MySQL</code>æŸ¥è¯¢ä¼˜åŒ–å™¨å…ˆåˆ†æä½¿ç”¨å”¯ä¸€äºŒçº§ç´¢å¼•çš„æˆæœ¬ï¼Œå†åˆ†æä½¿ç”¨æ™®é€šç´¢å¼•çš„æˆæœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå…ˆåˆ†æ<code>idx_key2</code>çš„æˆæœ¬ï¼Œç„¶åå†çœ‹ä½¿ç”¨<code>idx_key1</code>çš„æˆæœ¬ã€‚</p><h5 id="ä½¿ç”¨idx-key2æ‰§è¡ŒæŸ¥è¯¢çš„æˆæœ¬åˆ†æ">ä½¿ç”¨idx_key2æ‰§è¡ŒæŸ¥è¯¢çš„æˆæœ¬åˆ†æ</h5><p><code>idx_key2</code>å¯¹åº”çš„æœç´¢æ¡ä»¶æ˜¯ï¼š<code>key2 &gt; 10 AND key2 &lt; 1000</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹åº”çš„èŒƒå›´åŒºé—´å°±æ˜¯ï¼š<code>(10, 1000)</code>ï¼Œä½¿ç”¨<code>idx_key2</code>æœç´¢çš„ç¤ºæ„å›¾å°±æ˜¯è¿™æ ·å­ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16998b505d671d4e~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1d6cb8nolj1714dimrf1iu64l99.png-124.3kB"><p>å¯¹äºä½¿ç”¨<code>äºŒçº§ç´¢å¼• + å›è¡¨</code>æ–¹å¼çš„æŸ¥è¯¢ï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”è®¡ç®—è¿™ç§æŸ¥è¯¢çš„æˆæœ¬ä¾èµ–ä¸¤ä¸ªæ–¹é¢çš„æ•°æ®ï¼š</p><ul><li><p>èŒƒå›´åŒºé—´æ•°é‡</p><p>ä¸è®ºæŸä¸ªèŒƒå›´åŒºé—´çš„äºŒçº§ç´¢å¼•åˆ°åº•å ç”¨äº†å¤šå°‘é¡µé¢ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ç²—æš´çš„è®¤ä¸ºè¯»å–ç´¢å¼•çš„ä¸€ä¸ªèŒƒå›´åŒºé—´çš„<code>I/O</code>æˆæœ¬å’Œè¯»å–ä¸€ä¸ªé¡µé¢æ˜¯ç›¸åŒçš„ã€‚æœ¬ä¾‹ä¸­ä½¿ç”¨<code>idx_key2</code>çš„èŒƒå›´åŒºé—´åªæœ‰ä¸€ä¸ªï¼š<code>(10, 1000)</code>ï¼Œæ‰€ä»¥ç›¸å½“äºè®¿é—®è¿™ä¸ªèŒƒå›´åŒºé—´çš„äºŒçº§ç´¢å¼•ä»˜å‡ºçš„<code>I/O</code>æˆæœ¬å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>x <span class="hljs-number">1.0</span> = <span class="hljs-number">1.0</span><br></code></pre></td></tr></table></figure></li><li><p>éœ€è¦å›è¡¨çš„è®°å½•æ•°</p><p>ä¼˜åŒ–å™¨éœ€è¦è®¡ç®—äºŒçº§ç´¢å¼•çš„æŸä¸ªèŒƒå›´åŒºé—´åˆ°åº•åŒ…å«å¤šå°‘æ¡è®°å½•ï¼Œå¯¹äºæœ¬ä¾‹æ¥è¯´å°±æ˜¯è¦è®¡ç®—<code>idx_key2</code>åœ¨<code>(10, 1000)</code>è¿™ä¸ªèŒƒå›´åŒºé—´ä¸­åŒ…å«å¤šå°‘äºŒçº§ç´¢å¼•è®°å½•ï¼Œè®¡ç®—è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li><p>æ­¥éª¤1ï¼šå…ˆæ ¹æ®<code>key2 &gt; 10</code>è¿™ä¸ªæ¡ä»¶è®¿é—®ä¸€ä¸‹<code>idx_key2</code>å¯¹åº”çš„<code>B+</code>æ ‘ç´¢å¼•ï¼Œæ‰¾åˆ°æ»¡è¶³<code>key2 &gt; 10</code>è¿™ä¸ªæ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œæˆ‘ä»¬æŠŠè¿™æ¡è®°å½•ç§°ä¹‹ä¸º<code>åŒºé—´æœ€å·¦è®°å½•</code>ã€‚æˆ‘ä»¬å‰å¤´è¯´è¿‡åœ¨<code>B+</code>æ•°æ ‘ä¸­å®šä½ä¸€æ¡è®°å½•çš„è¿‡ç¨‹æ˜¯è´¼å¿«çš„ï¼Œæ˜¯å¸¸æ•°çº§åˆ«çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹çš„æ€§èƒ½æ¶ˆè€—æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ã€‚</p></li><li><p>æ­¥éª¤2ï¼šç„¶åå†æ ¹æ®<code>key2 &lt; 1000</code>è¿™ä¸ªæ¡ä»¶ç»§ç»­ä»<code>idx_key2</code>å¯¹åº”çš„<code>B+</code>æ ‘ç´¢å¼•ä¸­æ‰¾å‡ºæœ€åä¸€æ¡æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„è®°å½•ï¼Œæˆ‘ä»¬æŠŠè¿™æ¡è®°å½•ç§°ä¹‹ä¸º<code>åŒºé—´æœ€å³è®°å½•</code>ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„æ€§èƒ½æ¶ˆè€—ä¹Ÿå¯ä»¥å¿½ç•¥ä¸è®¡çš„ã€‚</p></li><li><p>æ­¥éª¤3ï¼šå¦‚æœ<code>åŒºé—´æœ€å·¦è®°å½•</code>å’Œ<code>åŒºé—´æœ€å³è®°å½•</code>ç›¸éš”ä¸å¤ªè¿œï¼ˆåœ¨<code>MySQL 5.7.21</code>è¿™ä¸ªç‰ˆæœ¬é‡Œï¼Œåªè¦ç›¸éš”ä¸å¤§äº10ä¸ªé¡µé¢å³å¯ï¼‰ï¼Œé‚£å°±å¯ä»¥ç²¾ç¡®ç»Ÿè®¡å‡ºæ»¡è¶³<code>key2 &gt; 10 AND key2 &lt; 1000</code>æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•æ¡æ•°ã€‚å¦åˆ™åªæ²¿ç€<code>åŒºé—´æœ€å·¦è®°å½•</code>å‘å³è¯»10ä¸ªé¡µé¢ï¼Œè®¡ç®—å¹³å‡æ¯ä¸ªé¡µé¢ä¸­åŒ…å«å¤šå°‘è®°å½•ï¼Œç„¶åç”¨è¿™ä¸ªå¹³å‡å€¼ä¹˜ä»¥<code>åŒºé—´æœ€å·¦è®°å½•</code>å’Œ<code>åŒºé—´æœ€å³è®°å½•</code>ä¹‹é—´çš„é¡µé¢æ•°é‡å°±å¯ä»¥äº†ã€‚é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œæ€ä¹ˆä¼°è®¡<code>åŒºé—´æœ€å·¦è®°å½•</code>å’Œ<code>åŒºé—´æœ€å³è®°å½•</code>ä¹‹é—´æœ‰å¤šå°‘ä¸ªé¡µé¢å‘¢ï¼Ÿè§£å†³è¿™ä¸ªé—®é¢˜è¿˜å¾—å›åˆ°<code>B+</code>æ ‘ç´¢å¼•çš„ç»“æ„ä¸­æ¥ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16998b505d7a278a~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cubndfil1i02ddfas1j3brq9m.png-85.3kB"><p>å¦‚å›¾ï¼Œæˆ‘ä»¬å‡è®¾<code>åŒºé—´æœ€å·¦è®°å½•</code>åœ¨<code>é¡µb</code>ä¸­ï¼Œ<code>åŒºé—´æœ€å³è®°å½•</code>åœ¨<code>é¡µc</code>ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³è®¡ç®—<code>åŒºé—´æœ€å·¦è®°å½•</code>å’Œ<code>åŒºé—´æœ€å³è®°å½•</code>ä¹‹é—´çš„é¡µé¢æ•°é‡å°±ç›¸å½“äºè®¡ç®—<code>é¡µb</code>å’Œ<code>é¡µc</code>ä¹‹é—´æœ‰å¤šå°‘é¡µé¢ï¼Œè€Œæ¯ä¸€æ¡<code>ç›®å½•é¡¹è®°å½•</code>éƒ½å¯¹åº”ä¸€ä¸ªæ•°æ®é¡µï¼Œæ‰€ä»¥è®¡ç®—<code>é¡µb</code>å’Œ<code>é¡µc</code>ä¹‹é—´æœ‰å¤šå°‘é¡µé¢å°±ç›¸å½“äºè®¡ç®—å®ƒä»¬çˆ¶èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯é¡µaï¼‰ä¸­å¯¹åº”çš„ç›®å½•é¡¹è®°å½•ä¹‹é—´éš”ç€å‡ æ¡è®°å½•ã€‚åœ¨ä¸€ä¸ªé¡µé¢ä¸­ç»Ÿè®¡ä¸¤æ¡è®°å½•ä¹‹é—´æœ‰å‡ æ¡è®°å½•çš„æˆæœ¬å°±è´¼å°äº†ã€‚</p><p>ä¸è¿‡è¿˜æœ‰é—®é¢˜ï¼Œå¦‚æœ<code>é¡µb</code>å’Œ<code>é¡µc</code>ä¹‹é—´çš„é¡µé¢å®åœ¨å¤ªå¤šï¼Œä»¥è‡³äº<code>é¡µb</code>å’Œ<code>é¡µc</code>å¯¹åº”çš„ç›®å½•é¡¹è®°å½•éƒ½ä¸åœ¨ä¸€ä¸ªé¡µé¢ä¸­è¯¥å’‹åŠï¼Ÿç»§ç»­é€’å½’å•Šï¼Œä¹Ÿå°±æ˜¯å†ç»Ÿè®¡<code>é¡µb</code>å’Œ<code>é¡µc</code>å¯¹åº”çš„ç›®å½•é¡¹è®°å½•æ‰€åœ¨é¡µä¹‹é—´æœ‰å¤šå°‘ä¸ªé¡µé¢ã€‚ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ä¸€ä¸ª<code>B+</code>æ ‘æœ‰4å±‚é«˜å·²ç»å¾ˆäº†ä¸å¾—äº†ï¼Œæ‰€ä»¥è¿™ä¸ªç»Ÿè®¡è¿‡ç¨‹ä¹Ÿä¸æ˜¯å¾ˆè€—è´¹æ€§èƒ½ã€‚</p></li></ul><p>çŸ¥é“äº†å¦‚ä½•ç»Ÿè®¡äºŒçº§ç´¢å¼•æŸä¸ªèŒƒå›´åŒºé—´çš„è®°å½•æ•°ä¹‹åï¼Œå°±éœ€è¦å›åˆ°ç°å®é—®é¢˜ä¸­æ¥ï¼Œæ ¹æ®ä¸Šè¿°ç®—æ³•æµ‹å¾—<code>idx_key2</code>åœ¨åŒºé—´<code>(10, 1000)</code>ä¹‹é—´å¤§çº¦æœ‰<code>95</code>æ¡è®°å½•ã€‚è¯»å–è¿™<code>95</code>æ¡äºŒçº§ç´¢å¼•è®°å½•éœ€è¦ä»˜å‡ºçš„<code>CPU</code>æˆæœ¬å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">95 </span>x <span class="hljs-number">0.2</span> + <span class="hljs-number">0.01</span> = <span class="hljs-number">19.01</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>95</code>æ˜¯éœ€è¦è¯»å–çš„äºŒçº§ç´¢å¼•è®°å½•æ¡æ•°ï¼Œ<code>0.2</code>æ˜¯è¯»å–ä¸€æ¡è®°å½•æˆæœ¬å¸¸æ•°ï¼Œ<code>0.01</code>æ˜¯å¾®è°ƒã€‚</p><p>åœ¨é€šè¿‡äºŒçº§ç´¢å¼•è·å–åˆ°è®°å½•ä¹‹åï¼Œè¿˜éœ€è¦å¹²ä¸¤ä»¶äº‹å„¿ï¼š</p><ul><li><p>æ ¹æ®è¿™äº›è®°å½•é‡Œçš„ä¸»é”®å€¼åˆ°èšç°‡ç´¢å¼•ä¸­åšå›è¡¨æ“ä½œ</p><p>è¿™é‡Œéœ€è¦å¤§å®¶ä½¿åŠ²å„¿çå¤§è‡ªå·±æ»´æºœæºœçš„å¤§çœ¼ç›ä»”ç»†ç§ï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”è¯„ä¼°å›è¡¨æ“ä½œçš„<code>I/O</code>æˆæœ¬ä¾æ—§å¾ˆè±ªæ”¾ï¼Œä»–ä»¬è®¤ä¸ºæ¯æ¬¡å›è¡¨æ“ä½œéƒ½ç›¸å½“äºè®¿é—®ä¸€ä¸ªé¡µé¢ï¼Œä¹Ÿå°±æ˜¯è¯´äºŒçº§ç´¢å¼•èŒƒå›´åŒºé—´æœ‰å¤šå°‘è®°å½•ï¼Œå°±éœ€è¦è¿›è¡Œå¤šå°‘æ¬¡å›è¡¨æ“ä½œï¼Œä¹Ÿå°±æ˜¯éœ€è¦è¿›è¡Œå¤šå°‘æ¬¡é¡µé¢<code>I/O</code>ã€‚æˆ‘ä»¬ä¸Šè¾¹ç»Ÿè®¡äº†ä½¿ç”¨<code>idx_key2</code>äºŒçº§ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œé¢„è®¡æœ‰<code>95</code>æ¡äºŒçº§ç´¢å¼•è®°å½•éœ€è¦è¿›è¡Œå›è¡¨æ“ä½œï¼Œæ‰€ä»¥å›è¡¨æ“ä½œå¸¦æ¥çš„<code>I/O</code>æˆæœ¬å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">95 </span>x <span class="hljs-number">1.0</span> = <span class="hljs-number">95.0</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>95</code>æ˜¯é¢„è®¡çš„äºŒçº§ç´¢å¼•è®°å½•æ•°ï¼Œ<code>1.0</code>æ˜¯ä¸€ä¸ªé¡µé¢çš„<code>I/O</code>æˆæœ¬å¸¸æ•°ã€‚</p></li><li><p>å›è¡¨æ“ä½œåå¾—åˆ°çš„å®Œæ•´ç”¨æˆ·è®°å½•ï¼Œç„¶åå†æ£€æµ‹å…¶ä»–æœç´¢æ¡ä»¶æ˜¯å¦æˆç«‹</p><p>å›è¡¨æ“ä½œçš„æœ¬è´¨å°±æ˜¯é€šè¿‡äºŒçº§ç´¢å¼•è®°å½•çš„ä¸»é”®å€¼åˆ°èšç°‡ç´¢å¼•ä¸­æ‰¾åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œç„¶åå†æ£€æµ‹é™¤<code>key2 &gt; 10 AND key2 &lt; 1000</code>è¿™ä¸ªæœç´¢æ¡ä»¶ä»¥å¤–çš„æœç´¢æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚å› ä¸ºæˆ‘ä»¬é€šè¿‡èŒƒå›´åŒºé—´è·å–åˆ°äºŒçº§ç´¢å¼•è®°å½•å…±<code>95</code>æ¡ï¼Œä¹Ÿå°±å¯¹åº”ç€èšç°‡ç´¢å¼•ä¸­<code>95</code>æ¡å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œè¯»å–å¹¶æ£€æµ‹è¿™äº›å®Œæ•´çš„ç”¨æˆ·è®°å½•æ˜¯å¦ç¬¦åˆå…¶ä½™çš„æœç´¢æ¡ä»¶çš„<code>CPU</code>æˆæœ¬å¦‚ä¸‹ï¼š</p><p>è®¾è®¡<code>MySQL</code>çš„å¤§å”åªè®¡ç®—è¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹æ‰€éœ€çš„<code>I/O</code>æˆæœ¬ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šä¸€æ­¥éª¤ä¸­å¾—åˆ°çš„<code>95.0</code>ï¼Œåœ¨å†…å­˜ä¸­çš„å®šä½å®Œæ•´ç”¨æˆ·è®°å½•çš„è¿‡ç¨‹çš„æˆæœ¬æ˜¯å¿½ç•¥ä¸è®¡çš„ã€‚åœ¨å®šä½åˆ°è¿™äº›å®Œæ•´çš„ç”¨æˆ·è®°å½•åï¼Œéœ€è¦æ£€æµ‹é™¤<code>key2 &gt; 10 AND key2 &lt; 1000</code>è¿™ä¸ªæœç´¢æ¡ä»¶ä»¥å¤–çš„æœç´¢æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œè¿™ä¸ªæ¯”è¾ƒè¿‡ç¨‹èŠ±è´¹çš„<code>CPU</code>æˆæœ¬å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">95 </span>x <span class="hljs-number">0.2</span> = <span class="hljs-number">19.0</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>95</code>æ˜¯å¾…æ£€æµ‹è®°å½•çš„æ¡æ•°ï¼Œ<code>0.2</code>æ˜¯æ£€æµ‹ä¸€æ¡è®°å½•æ˜¯å¦ç¬¦åˆç»™å®šçš„æœç´¢æ¡ä»¶çš„æˆæœ¬å¸¸æ•°ã€‚</p></li></ul></li></ul><p>æ‰€ä»¥æœ¬ä¾‹ä¸­ä½¿ç”¨<code>idx_key2</code>æ‰§è¡ŒæŸ¥è¯¢çš„æˆæœ¬å°±å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li><p><code>I/O</code>æˆæœ¬ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>.<span class="hljs-number">0</span> + <span class="hljs-number">95</span> x <span class="hljs-number">1</span>.<span class="hljs-number">0</span> = <span class="hljs-number">96</span>.<span class="hljs-number">0</span> (èŒƒå›´åŒºé—´çš„æ•°é‡ + é¢„ä¼°çš„äºŒçº§ç´¢å¼•è®°å½•æ¡æ•°)<br></code></pre></td></tr></table></figure></li><li><p><code>CPU</code>æˆæœ¬ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">95 </span>x <span class="hljs-number">0.2</span> + <span class="hljs-number">0.01</span> + <span class="hljs-number">95</span> x <span class="hljs-number">0.2</span> = <span class="hljs-number">38.01</span> ï¼ˆè¯»å–äºŒçº§ç´¢å¼•è®°å½•çš„æˆæœ¬ + è¯»å–å¹¶æ£€æµ‹å›è¡¨åèšç°‡ç´¢å¼•è®°å½•çš„æˆæœ¬ï¼‰<br></code></pre></td></tr></table></figure></li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨<code>idx_key2</code>æ‰§è¡ŒæŸ¥è¯¢çš„æ€»æˆæœ¬å°±æ˜¯ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">96</span>.<span class="hljs-number">0</span> + <span class="hljs-number">38</span>.<span class="hljs-number">01</span> = <span class="hljs-number">134</span>.<span class="hljs-number">01</span><br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨idx-key1æ‰§è¡ŒæŸ¥è¯¢çš„æˆæœ¬åˆ†æ">ä½¿ç”¨idx_key1æ‰§è¡ŒæŸ¥è¯¢çš„æˆæœ¬åˆ†æ</h5><p><code>idx_key1</code>å¯¹åº”çš„æœç´¢æ¡ä»¶æ˜¯ï¼š<code>key1 IN ('a', 'b', 'c')</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ç›¸å½“äº3ä¸ªå•ç‚¹åŒºé—´ï¼š</p><ul><li><code>['a', 'a']</code></li><li><code>['b', 'b']</code></li><li><code>['c', 'c']</code></li></ul><p>ä½¿ç”¨<code>idx_key1</code>æœç´¢çš„ç¤ºæ„å›¾å°±æ˜¯è¿™æ ·å­ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/16998b505eab86e6~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cubvsars1i0rvdc11b3118th9830.png-124.1kB"><p>ä¸ä½¿ç”¨<code>idx_key2</code>çš„æƒ…å†µç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è®¡ç®—ä½¿ç”¨<code>idx_key1</code>æ—¶éœ€è¦è®¿é—®çš„èŒƒå›´åŒºé—´æ•°é‡ä»¥åŠéœ€è¦å›è¡¨çš„è®°å½•æ•°ï¼š</p><ul><li><p>èŒƒå›´åŒºé—´æ•°é‡</p><p>ä½¿ç”¨<code>idx_key1</code>æ‰§è¡ŒæŸ¥è¯¢æ—¶å¾ˆæ˜¾ç„¶æœ‰3ä¸ªå•ç‚¹åŒºé—´ï¼Œæ‰€ä»¥è®¿é—®è¿™3ä¸ªèŒƒå›´åŒºé—´çš„äºŒçº§ç´¢å¼•ä»˜å‡ºçš„I/Oæˆæœ¬å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">3 </span>x <span class="hljs-number">1.0</span> = <span class="hljs-number">3.0</span><br></code></pre></td></tr></table></figure></li><li><p>éœ€è¦å›è¡¨çš„è®°å½•æ•°</p><p>ç”±äºä½¿ç”¨<code>idx_key1</code>æ—¶æœ‰3ä¸ªå•ç‚¹åŒºé—´ï¼Œæ‰€ä»¥æ¯ä¸ªå•ç‚¹åŒºé—´éƒ½éœ€è¦æŸ¥æ‰¾ä¸€éå¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•æ•°ï¼š</p><ul><li><p>æŸ¥æ‰¾å•ç‚¹åŒºé—´<code>['a', 'a']</code>å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•æ•°</p><p>è®¡ç®—å•ç‚¹åŒºé—´å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•æ•°å’Œè®¡ç®—è¿ç»­èŒƒå›´åŒºé—´å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•æ•°æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å…ˆè®¡ç®—<code>åŒºé—´æœ€å·¦è®°å½•</code>å’Œ<code>åŒºé—´æœ€å³è®°å½•</code>ï¼Œç„¶åå†è®¡ç®—å®ƒä»¬ä¹‹é—´çš„è®°å½•æ•°ï¼Œå…·ä½“ç®—æ³•ä¸Šè¾¹éƒ½å” å¨è¿‡äº†ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚æœ€åè®¡ç®—å¾—åˆ°å•ç‚¹åŒºé—´<code>['a', 'a']</code>å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•æ•°æ˜¯ï¼š<code>35</code>ã€‚</p></li><li><p>æŸ¥æ‰¾å•ç‚¹åŒºé—´<code>['b', 'b']</code>å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•æ•°</p><p>ä¸ä¸ŠåŒç†ï¼Œè®¡ç®—å¾—åˆ°æœ¬å•ç‚¹åŒºé—´å¯¹åº”çš„è®°å½•æ•°æ˜¯ï¼š<code>44</code>ã€‚</p></li><li><p>æŸ¥æ‰¾å•ç‚¹åŒºé—´<code>['c', 'c']</code>å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•æ•°</p><p>ä¸ä¸ŠåŒç†ï¼Œè®¡ç®—å¾—åˆ°æœ¬å•ç‚¹åŒºé—´å¯¹åº”çš„è®°å½•æ•°æ˜¯ï¼š<code>39</code>ã€‚</p></li></ul><p>æ‰€ä»¥ï¼Œè¿™ä¸‰ä¸ªå•ç‚¹åŒºé—´æ€»å…±éœ€è¦å›è¡¨çš„è®°å½•æ•°å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">35 </span>+ <span class="hljs-number">44</span> + <span class="hljs-number">39</span> = <span class="hljs-number">118</span><br></code></pre></td></tr></table></figure><p>è¯»å–è¿™äº›äºŒçº§ç´¢å¼•è®°å½•çš„<code>CPU</code>æˆæœ¬å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">118 </span>x <span class="hljs-number">0.2</span> + <span class="hljs-number">0.01</span> = <span class="hljs-number">23.61</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ°æ€»å…±éœ€è¦å›è¡¨çš„è®°å½•æ•°ä¹‹åï¼Œå°±è¦è€ƒè™‘ï¼š</p><ul><li><p>æ ¹æ®è¿™äº›è®°å½•é‡Œçš„ä¸»é”®å€¼åˆ°èšç°‡ç´¢å¼•ä¸­åšå›è¡¨æ“ä½œ</p><p>æ‰€éœ€çš„<code>I/O</code>æˆæœ¬å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">118 </span>x <span class="hljs-number">1.0</span> = <span class="hljs-number">118.0</span><br></code></pre></td></tr></table></figure></li><li><p>å›è¡¨æ“ä½œåå¾—åˆ°çš„å®Œæ•´ç”¨æˆ·è®°å½•ï¼Œç„¶åå†æ¯”è¾ƒå…¶ä»–æœç´¢æ¡ä»¶æ˜¯å¦æˆç«‹</p><p>æ­¤æ­¥éª¤å¯¹åº”çš„<code>CPU</code>æˆæœ¬å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">118 </span>x <span class="hljs-number">0.2</span> = <span class="hljs-number">23.6</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><p>æ‰€ä»¥æœ¬ä¾‹ä¸­ä½¿ç”¨<code>idx_key1</code>æ‰§è¡ŒæŸ¥è¯¢çš„æˆæœ¬å°±å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li><p><code>I/O</code>æˆæœ¬ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">3</span>.<span class="hljs-number">0</span> + <span class="hljs-number">118</span> x <span class="hljs-number">1</span>.<span class="hljs-number">0</span> = <span class="hljs-number">121</span>.<span class="hljs-number">0</span> (èŒƒå›´åŒºé—´çš„æ•°é‡ + é¢„ä¼°çš„äºŒçº§ç´¢å¼•è®°å½•æ¡æ•°)<br></code></pre></td></tr></table></figure></li><li><p><code>CPU</code>æˆæœ¬ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">118 </span>x <span class="hljs-number">0.2</span> + <span class="hljs-number">0.01</span> + <span class="hljs-number">118</span> x <span class="hljs-number">0.2</span> = <span class="hljs-number">47.21</span> ï¼ˆè¯»å–äºŒçº§ç´¢å¼•è®°å½•çš„æˆæœ¬ + è¯»å–å¹¶æ£€æµ‹å›è¡¨åèšç°‡ç´¢å¼•è®°å½•çš„æˆæœ¬ï¼‰<br></code></pre></td></tr></table></figure></li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨<code>idx_key1</code>æ‰§è¡ŒæŸ¥è¯¢çš„æ€»æˆæœ¬å°±æ˜¯ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">121</span>.<span class="hljs-number">0</span> + <span class="hljs-number">47</span>.<span class="hljs-number">21</span> = <span class="hljs-number">168</span>.<span class="hljs-number">21</span><br></code></pre></td></tr></table></figure><h5 id="æ˜¯å¦æœ‰å¯èƒ½ä½¿ç”¨ç´¢å¼•åˆå¹¶ï¼ˆIndex-Mergeï¼‰">æ˜¯å¦æœ‰å¯èƒ½ä½¿ç”¨ç´¢å¼•åˆå¹¶ï¼ˆIndex Mergeï¼‰</h5><p>æœ¬ä¾‹ä¸­æœ‰å…³<code>key1</code>å’Œ<code>key2</code>çš„æœç´¢æ¡ä»¶æ˜¯ä½¿ç”¨<code>AND</code>è¿æ¥èµ·æ¥çš„ï¼Œè€Œå¯¹äº<code>idx_key1</code>å’Œ<code>idx_key2</code>éƒ½æ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥æ‰¾åˆ°çš„äºŒçº§ç´¢å¼•è®°å½•å¹¶ä¸æ˜¯æŒ‰ç…§ä¸»é”®å€¼è¿›è¡Œæ’åºçš„ï¼Œå¹¶ä¸æ»¡è¶³ä½¿ç”¨<code>Intersection</code>ç´¢å¼•åˆå¹¶çš„æ¡ä»¶ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šä½¿ç”¨ç´¢å¼•åˆå¹¶ã€‚</p><blockquote><p>å°è´´å£«ï¼š MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨è®¡ç®—ç´¢å¼•åˆå¹¶æˆæœ¬çš„ç®—æ³•ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¹Ÿå°±ä¸å±•å¼€å” å¨äº†ã€‚</p></blockquote><h4 id="4-å¯¹æ¯”å„ç§æ‰§è¡Œæ–¹æ¡ˆçš„ä»£ä»·ï¼Œæ‰¾å‡ºæˆæœ¬æœ€ä½çš„é‚£ä¸€ä¸ª">4. å¯¹æ¯”å„ç§æ‰§è¡Œæ–¹æ¡ˆçš„ä»£ä»·ï¼Œæ‰¾å‡ºæˆæœ¬æœ€ä½çš„é‚£ä¸€ä¸ª</h4><p>ä¸‹è¾¹æŠŠæ‰§è¡Œæœ¬ä¾‹ä¸­çš„æŸ¥è¯¢çš„å„ç§å¯æ‰§è¡Œæ–¹æ¡ˆä»¥åŠå®ƒä»¬å¯¹åº”çš„æˆæœ¬åˆ—å‡ºæ¥ï¼š</p><ul><li>å…¨è¡¨æ‰«æçš„æˆæœ¬ï¼š<code>2037.7</code></li><li>ä½¿ç”¨<code>idx_key2</code>çš„æˆæœ¬ï¼š<code>134.01</code></li><li>ä½¿ç”¨<code>idx_key1</code>çš„æˆæœ¬ï¼š<code>168.21</code></li></ul><p>å¾ˆæ˜¾ç„¶ï¼Œä½¿ç”¨<code>idx_key2</code>çš„æˆæœ¬æœ€ä½ï¼Œæ‰€ä»¥å½“ç„¶é€‰æ‹©<code>idx_key2</code>æ¥æ‰§è¡ŒæŸ¥è¯¢å–½ã€‚</p><blockquote><p>å°è´´å£«ï¼š è€ƒè™‘åˆ°å¤§å®¶çš„é˜…è¯»ä½“éªŒï¼Œä¸ºäº†æœ€å¤§é™åº¦çš„å‡å°‘å¤§å®¶åœ¨ç†è§£ä¼˜åŒ–å™¨å·¥ä½œåŸç†çš„è¿‡ç¨‹ä¸­é‡åˆ°çš„æ‡µé€¼æƒ…å†µï¼Œè¿™é‡Œå¯¹ä¼˜åŒ–å™¨åœ¨å•è¡¨æŸ¥è¯¢ä¸­å¯¹æ¯”å„ç§æ‰§è¡Œæ–¹æ¡ˆçš„ä»£ä»·çš„æ–¹å¼ç¨ç¨çš„åšäº†ç®€åŒ–ï¼Œä¸è¿‡æ¯•ç«Ÿå¤§éƒ¨åˆ†åŒå­¦ä¸éœ€è¦å»çœ‹MySQLçš„æºç ï¼ŒæŠŠå¤§è‡´çš„ç²¾ç¥ä¼ é€’æ­£ç¡®å°±å¥½äº†å“ˆã€‚</p></blockquote><h3 id="åŸºäºç´¢å¼•ç»Ÿè®¡æ•°æ®çš„æˆæœ¬è®¡ç®—">åŸºäºç´¢å¼•ç»Ÿè®¡æ•°æ®çš„æˆæœ¬è®¡ç®—</h3><p>æœ‰æ—¶å€™ä½¿ç”¨ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶ä¼šæœ‰è®¸å¤šå•ç‚¹åŒºé—´ï¼Œæ¯”å¦‚ä½¿ç”¨<code>IN</code>è¯­å¥å°±å¾ˆå®¹æ˜“äº§ç”Ÿéå¸¸å¤šçš„å•ç‚¹åŒºé—´ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼ˆä¸‹è¾¹æŸ¥è¯¢è¯­å¥ä¸­çš„<code>...</code>è¡¨ç¤ºè¿˜æœ‰å¾ˆå¤šå‚æ•°ï¼‰ï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-keyword">SELECT</span> * FROM single_table <span class="hljs-keyword">WHERE</span> key1 <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;aa1&#x27;</span>, <span class="hljs-string">&#x27;aa2&#x27;</span>, <span class="hljs-string">&#x27;aa3&#x27;</span>, <span class="hljs-params">...</span> , <span class="hljs-string">&#x27;zzz&#x27;</span>);<br></code></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªæŸ¥è¯¢å¯èƒ½ä½¿ç”¨åˆ°çš„ç´¢å¼•å°±æ˜¯<code>idx_key1</code>ï¼Œç”±äºè¿™ä¸ªç´¢å¼•å¹¶ä¸æ˜¯å”¯ä¸€äºŒçº§ç´¢å¼•ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½ç¡®å®šä¸€ä¸ªå•ç‚¹åŒºé—´å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•çš„æ¡æ•°æœ‰å¤šå°‘ï¼Œéœ€è¦æˆ‘ä»¬å»è®¡ç®—ã€‚è®¡ç®—æ–¹å¼æˆ‘ä»¬ä¸Šè¾¹å·²ç»ä»‹ç»è¿‡äº†ï¼Œå°±æ˜¯å…ˆè·å–ç´¢å¼•å¯¹åº”çš„<code>B+</code>æ ‘çš„<code>åŒºé—´æœ€å·¦è®°å½•</code>å’Œ<code>åŒºé—´æœ€å³è®°å½•</code>ï¼Œç„¶åå†è®¡ç®—è¿™ä¸¤æ¡è®°å½•ä¹‹é—´æœ‰å¤šå°‘è®°å½•ï¼ˆè®°å½•æ¡æ•°å°‘çš„æ—¶å€™å¯ä»¥åšåˆ°ç²¾ç¡®è®¡ç®—ï¼Œå¤šçš„æ—¶å€™åªèƒ½ä¼°ç®—ï¼‰ã€‚è®¾è®¡<code>MySQL</code>çš„å¤§å”æŠŠè¿™ç§é€šè¿‡ç›´æ¥è®¿é—®ç´¢å¼•å¯¹åº”çš„<code>B+</code>æ ‘æ¥è®¡ç®—æŸä¸ªèŒƒå›´åŒºé—´å¯¹åº”çš„ç´¢å¼•è®°å½•æ¡æ•°çš„æ–¹å¼ç§°ä¹‹ä¸º<code>index dive</code>ã€‚</p><blockquote><p>å°è´´å£«ï¼š diveç›´è¯‘ä¸ºä¸­æ–‡çš„æ„æ€æ˜¯è·³æ°´ã€ä¿¯å†²çš„æ„æ€ï¼ŒåŸè°…æˆ‘çš„è‹±æ–‡æ°´å¹³æ‰æ€¥ï¼Œæˆ‘å®åœ¨ä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘ index diveï¼Œç´¢å¼•è·³æ°´ï¼Ÿç´¢å¼•ä¿¯å†²ï¼Ÿå¥½åƒéƒ½ä¸å¤ªåˆé€‚ï¼Œæ‰€ä»¥å‹æ ¹å„¿å°±ä¸ç¿»è¯‘äº†ã€‚ä¸è¿‡å¤§å®¶è¦æ„ä¼šindex diveå°±æ˜¯ç›´æ¥åˆ©ç”¨ç´¢å¼•å¯¹åº”çš„B+æ ‘æ¥è®¡ç®—æŸä¸ªèŒƒå›´åŒºé—´å¯¹åº”çš„è®°å½•æ¡æ•°ã€‚</p></blockquote><p>æœ‰é›¶æ˜Ÿå‡ ä¸ªå•ç‚¹åŒºé—´çš„è¯ï¼Œä½¿ç”¨<code>index dive</code>çš„æ–¹å¼å»è®¡ç®—è¿™äº›å•ç‚¹åŒºé—´å¯¹åº”çš„è®°å½•æ•°ä¹Ÿä¸æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œå¯æ˜¯ä½ æ¶ä¸ä½æœ‰çš„å­©å­æ†‹è¶³äº†åŠ²å¾€<code>IN</code>è¯­å¥é‡Œå¡ä¸œè¥¿å‘€ï¼Œæˆ‘å°±è§è¿‡æœ‰çš„åŒå­¦å†™çš„<code>IN</code>è¯­å¥é‡Œæœ‰20000ä¸ªå‚æ•°çš„ğŸ¤£ğŸ¤£ï¼Œè¿™å°±æ„å‘³ç€<code>MySQL</code>çš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸ºäº†è®¡ç®—è¿™äº›å•ç‚¹åŒºé—´å¯¹åº”çš„ç´¢å¼•è®°å½•æ¡æ•°ï¼Œè¦è¿›è¡Œ20000æ¬¡<code>index dive</code>æ“ä½œï¼Œè¿™æ€§èƒ½æŸè€—å¯å°±å¤§äº†ï¼Œæä¸å¥½è®¡ç®—è¿™äº›å•ç‚¹åŒºé—´å¯¹åº”çš„ç´¢å¼•è®°å½•æ¡æ•°çš„æˆæœ¬æ¯”ç›´æ¥å…¨è¡¨æ‰«æçš„æˆæœ¬éƒ½å¤§äº†ã€‚è®¾è®¡<code>MySQL</code>çš„å¤§å”ä»¬å¤šèªæ˜å•Šï¼Œä»–ä»¬å½“ç„¶è€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥æä¾›äº†ä¸€ä¸ªç³»ç»Ÿå˜é‡<code>eq_range_index_dive_limit</code>ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹åœ¨<code>MySQL 5.7.21</code>ä¸­è¿™ä¸ªç³»ç»Ÿå˜é‡çš„é»˜è®¤å€¼ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;%dive%&#x27;;</span><br><span class="hljs-section">+---------------------------+-------+</span><br><span class="hljs-section">| Variable_name             | Value |</span><br><span class="hljs-section">+---------------------------+-------+</span><br><span class="hljs-section">| eq_range_index_dive_limit | 200   |</span><br><span class="hljs-section">+---------------------------+-------+</span><br>1 row in set (0.08 sec)<br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬çš„<code>IN</code>è¯­å¥ä¸­çš„å‚æ•°ä¸ªæ•°å°äº200ä¸ªçš„è¯ï¼Œå°†ä½¿ç”¨<code>index dive</code>çš„æ–¹å¼è®¡ç®—å„ä¸ªå•ç‚¹åŒºé—´å¯¹åº”çš„è®°å½•æ¡æ•°ï¼Œå¦‚æœå¤§äºæˆ–ç­‰äº200ä¸ªçš„è¯ï¼Œå¯å°±ä¸èƒ½ä½¿ç”¨<code>index dive</code>äº†ï¼Œè¦ä½¿ç”¨æ‰€è°“çš„ç´¢å¼•ç»Ÿè®¡æ•°æ®æ¥è¿›è¡Œä¼°ç®—ã€‚æ€ä¹ˆä¸ªä¼°ç®—æ³•ï¼Ÿç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><p>åƒä¼šä¸ºæ¯ä¸ªè¡¨ç»´æŠ¤ä¸€ä»½ç»Ÿè®¡æ•°æ®ä¸€æ ·ï¼Œ<code>MySQL</code>ä¹Ÿä¼šä¸ºè¡¨ä¸­çš„æ¯ä¸€ä¸ªç´¢å¼•ç»´æŠ¤ä¸€ä»½ç»Ÿè®¡æ•°æ®ï¼ŒæŸ¥çœ‹æŸä¸ªè¡¨ä¸­ç´¢å¼•çš„ç»Ÿè®¡æ•°æ®å¯ä»¥ä½¿ç”¨<code>SHOW INDEX FROM è¡¨å</code>çš„è¯­æ³•ï¼Œæ¯”å¦‚æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹<code>single_table</code>çš„å„ä¸ªç´¢å¼•çš„ç»Ÿè®¡æ•°æ®å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; SHOW INDEX FROM single_table; <span class="hljs-comment"># åœ¨æœ€å+ \G è¡¨ç¤ºæ¢è¡Œ</span><br>+--------------+------------+--------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+<br>|<span class="hljs-string"> Table        </span>|<span class="hljs-string"> Non_unique </span>|<span class="hljs-string"> Key_name     </span>|<span class="hljs-string"> Seq_in_index </span>|<span class="hljs-string"> Column_name </span>|<span class="hljs-string"> Collation </span>|<span class="hljs-string"> Cardinality </span>|<span class="hljs-string"> Sub_part </span>|<span class="hljs-string"> Packed </span>|<span class="hljs-string"> Null </span>|<span class="hljs-string"> Index_type </span>|<span class="hljs-string"> Comment </span>|<span class="hljs-string"> Index_comment </span>|<br>+--------------+------------+--------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+<br>|<span class="hljs-string"> single_table </span>|<span class="hljs-string">          0 </span>|<span class="hljs-string"> PRIMARY      </span>|<span class="hljs-string">            1 </span>|<span class="hljs-string"> id          </span>|<span class="hljs-string"> A         </span>|<span class="hljs-string">       9693  </span>|<span class="hljs-string">     NULL </span>|<span class="hljs-string"> NULL   </span>|<span class="hljs-string">      </span>|<span class="hljs-string"> BTREE      </span>|<span class="hljs-string">         </span>|<span class="hljs-string">               </span>|<br>|<span class="hljs-string"> single_table </span>|<span class="hljs-string">          0 </span>|<span class="hljs-string"> idx_key2     </span>|<span class="hljs-string">            1 </span>|<span class="hljs-string"> key2        </span>|<span class="hljs-string"> A         </span>|<span class="hljs-string">       9693  </span>|<span class="hljs-string">     NULL </span>|<span class="hljs-string"> NULL   </span>|<span class="hljs-string"> YES  </span>|<span class="hljs-string"> BTREE      </span>|<span class="hljs-string">         </span>|<span class="hljs-string">               </span>|<br>|<span class="hljs-string"> single_table </span>|<span class="hljs-string">          1 </span>|<span class="hljs-string"> idx_key1     </span>|<span class="hljs-string">            1 </span>|<span class="hljs-string"> key1        </span>|<span class="hljs-string"> A         </span>|<span class="hljs-string">        968 </span>|<span class="hljs-string">     NULL </span>|<span class="hljs-string"> NULL   </span>|<span class="hljs-string"> YES  </span>|<span class="hljs-string"> BTREE      </span>|<span class="hljs-string">         </span>|<span class="hljs-string">               </span>|<br>|<span class="hljs-string"> single_table </span>|<span class="hljs-string">          1 </span>|<span class="hljs-string"> idx_key3     </span>|<span class="hljs-string">            1 </span>|<span class="hljs-string"> key3        </span>|<span class="hljs-string"> A         </span>|<span class="hljs-string">        799 </span>|<span class="hljs-string">     NULL </span>|<span class="hljs-string"> NULL   </span>|<span class="hljs-string"> YES  </span>|<span class="hljs-string"> BTREE      </span>|<span class="hljs-string">         </span>|<span class="hljs-string">               </span>|<br>|<span class="hljs-string"> single_table </span>|<span class="hljs-string">          1 </span>|<span class="hljs-string"> idx_key_part </span>|<span class="hljs-string">            1 </span>|<span class="hljs-string"> key_part1   </span>|<span class="hljs-string"> A         </span>|<span class="hljs-string">        9673 </span>|<span class="hljs-string">     NULL </span>|<span class="hljs-string"> NULL   </span>|<span class="hljs-string"> YES  </span>|<span class="hljs-string"> BTREE      </span>|<span class="hljs-string">         </span>|<span class="hljs-string">               </span>|<br>|<span class="hljs-string"> single_table </span>|<span class="hljs-string">          1 </span>|<span class="hljs-string"> idx_key_part </span>|<span class="hljs-string">            2 </span>|<span class="hljs-string"> key_part2   </span>|<span class="hljs-string"> A         </span>|<span class="hljs-string">        9999 </span>|<span class="hljs-string">     NULL </span>|<span class="hljs-string"> NULL   </span>|<span class="hljs-string"> YES  </span>|<span class="hljs-string"> BTREE      </span>|<span class="hljs-string">         </span>|<span class="hljs-string">               </span>|<br>|<span class="hljs-string"> single_table </span>|<span class="hljs-string">          1 </span>|<span class="hljs-string"> idx_key_part </span>|<span class="hljs-string">            3 </span>|<span class="hljs-string"> key_part3   </span>|<span class="hljs-string"> A         </span>|<span class="hljs-string">       10000 </span>|<span class="hljs-string">     NULL </span>|<span class="hljs-string"> NULL   </span>|<span class="hljs-string"> YES  </span>|<span class="hljs-string"> BTREE      </span>|<span class="hljs-string">         </span>|<span class="hljs-string">               </span>|<br>+--------------+------------+--------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+<br>7 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><p>å“‡å””ï¼Œç«Ÿç„¶æœ‰è¿™ä¹ˆå¤šå±æ€§ï¼Œä¸è¿‡å¥½åœ¨è¿™äº›å±æ€§éƒ½ä¸éš¾ç†è§£ï¼Œæˆ‘ä»¬å°±éƒ½ä»‹ç»ä¸€éå§ï¼š</p><table><thead><tr><th>å±æ€§å</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>Table</code></td><td>ç´¢å¼•æ‰€å±è¡¨çš„åç§°ã€‚</td></tr><tr><td><code>Non_unique</code></td><td>ç´¢å¼•åˆ—çš„å€¼æ˜¯å¦æ˜¯å”¯ä¸€çš„ï¼Œèšç°‡ç´¢å¼•å’Œå”¯ä¸€äºŒçº§ç´¢å¼•çš„è¯¥åˆ—å€¼ä¸º<code>0</code>ï¼Œæ™®é€šäºŒçº§ç´¢å¼•è¯¥åˆ—å€¼ä¸º<code>1</code>ã€‚</td></tr><tr><td><code>Key_name</code></td><td>ç´¢å¼•çš„åç§°ã€‚</td></tr><tr><td><code>Seq_in_index</code></td><td>ç´¢å¼•åˆ—åœ¨ç´¢å¼•ä¸­çš„ä½ç½®ï¼Œä»1å¼€å§‹è®¡æ•°ã€‚æ¯”å¦‚å¯¹äºè”åˆç´¢å¼•<code>idx_key_part</code>ï¼Œæ¥è¯´ï¼Œ<code>key_part1</code>ã€<code>key_part2</code>å’Œ<code>key_part3</code>å¯¹åº”çš„ä½ç½®åˆ†åˆ«æ˜¯1ã€2ã€3ã€‚</td></tr><tr><td><code>Column_name</code></td><td>ç´¢å¼•åˆ—çš„åç§°ã€‚</td></tr><tr><td><code>Collation</code></td><td>ç´¢å¼•åˆ—ä¸­çš„å€¼æ˜¯æŒ‰ç…§ä½•ç§æ’åºæ–¹å¼å­˜æ”¾çš„ï¼Œå€¼ä¸º<code>A</code>æ—¶ä»£è¡¨å‡åºå­˜æ”¾ï¼Œä¸º<code>NULL</code>æ—¶ä»£è¡¨é™åºå­˜æ”¾ã€‚</td></tr><tr><td><code>Cardinality</code></td><td>ç´¢å¼•åˆ—ä¸­ä¸é‡å¤å€¼çš„æ•°é‡ã€‚åè¾¹æˆ‘ä»¬ä¼šé‡ç‚¹çœ‹è¿™ä¸ªå±æ€§çš„ã€‚</td></tr><tr><td><code>Sub_part</code></td><td>å¯¹äºå­˜å‚¨å­—ç¬¦ä¸²æˆ–è€…å­—èŠ‚ä¸²çš„åˆ—æ¥è¯´ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬åªæƒ³å¯¹è¿™äº›ä¸²çš„å‰<code>n</code>ä¸ªå­—ç¬¦æˆ–å­—èŠ‚å»ºç«‹ç´¢å¼•ï¼Œè¿™ä¸ªå±æ€§è¡¨ç¤ºçš„å°±æ˜¯é‚£ä¸ª<code>n</code>å€¼ã€‚å¦‚æœå¯¹å®Œæ•´çš„åˆ—å»ºç«‹ç´¢å¼•çš„è¯ï¼Œè¯¥å±æ€§çš„å€¼å°±æ˜¯<code>NULL</code>ã€‚</td></tr><tr><td><code>Packed</code></td><td>ç´¢å¼•åˆ—å¦‚ä½•è¢«å‹ç¼©ï¼Œ<code>NULL</code>å€¼è¡¨ç¤ºæœªè¢«å‹ç¼©ã€‚è¿™ä¸ªå±æ€§æˆ‘ä»¬æš‚æ—¶ä¸äº†è§£ï¼Œå¯ä»¥å…ˆå¿½ç•¥æ‰ã€‚</td></tr><tr><td><code>Null</code></td><td>è¯¥ç´¢å¼•åˆ—æ˜¯å¦å…è®¸å­˜å‚¨<code>NULL</code>å€¼ã€‚</td></tr><tr><td><code>Index_type</code></td><td>ä½¿ç”¨ç´¢å¼•çš„ç±»å‹ï¼Œæˆ‘ä»¬æœ€å¸¸è§çš„å°±æ˜¯<code>BTREE</code>ï¼Œå…¶å®ä¹Ÿå°±æ˜¯<code>B+</code>æ ‘ç´¢å¼•ã€‚</td></tr><tr><td><code>Comment</code></td><td>ç´¢å¼•åˆ—æ³¨é‡Šä¿¡æ¯ã€‚</td></tr><tr><td><code>Index_comment</code></td><td>ç´¢å¼•æ³¨é‡Šä¿¡æ¯ã€‚</td></tr></tbody></table><p>ä¸Šè¿°å±æ€§é™¤äº†<code>Packed</code>å¤§å®¶å¯èƒ½çœ‹ä¸æ‡‚ä»¥å¤–ï¼Œåº”è¯¥æ²¡æœ‰å•¥çœ‹ä¸æ‡‚çš„äº†ï¼Œå¦‚æœæœ‰çš„è¯è‚¯å®šæ˜¯å¤§å®¶çœ‹å‰è¾¹æ–‡ç« çš„æ—¶å€™è·³è¿‡äº†å•¥ä¸œè¥¿ã€‚å…¶å®æˆ‘ä»¬ç°åœ¨æœ€åœ¨æ„çš„æ˜¯<code>Cardinality</code>å±æ€§ï¼Œ<code>Cardinality</code>ç›´è¯‘è¿‡æ¥å°±æ˜¯<code>åŸºæ•°</code>çš„æ„æ€ï¼Œè¡¨ç¤ºç´¢å¼•åˆ—ä¸­ä¸é‡å¤å€¼çš„ä¸ªæ•°ã€‚æ¯”å¦‚å¯¹äºä¸€ä¸ªä¸€ä¸‡è¡Œè®°å½•çš„è¡¨æ¥è¯´ï¼ŒæŸä¸ªç´¢å¼•åˆ—çš„<code>Cardinality</code>å±æ€§æ˜¯<code>10000</code>ï¼Œé‚£æ„å‘³ç€è¯¥åˆ—ä¸­æ²¡æœ‰é‡å¤çš„å€¼ï¼Œå¦‚æœ<code>Cardinality</code>å±æ€§æ˜¯<code>1</code>çš„è¯ï¼Œå°±æ„å‘³ç€è¯¥åˆ—çš„å€¼å…¨éƒ¨æ˜¯é‡å¤çš„ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºInnoDBå­˜å‚¨å¼•æ“æ¥è¯´ï¼Œä½¿ç”¨SHOW INDEXè¯­å¥å±•ç¤ºå‡ºæ¥çš„æŸä¸ªç´¢å¼•åˆ—çš„Cardinalityå±æ€§æ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œå¹¶ä¸æ˜¯ç²¾ç¡®çš„ã€‚å…³äºè¿™ä¸ª<code>Cardinality</code>å±æ€§çš„å€¼æ˜¯å¦‚ä½•è¢«è®¡ç®—å‡ºæ¥çš„æˆ‘ä»¬åè¾¹å†è¯´ï¼Œå…ˆçœ‹çœ‹å®ƒæœ‰ä»€ä¹ˆç”¨é€”ã€‚</p><p>å‰è¾¹è¯´é“ï¼Œå½“<code>IN</code>è¯­å¥ä¸­çš„å‚æ•°ä¸ªæ•°å¤§äºæˆ–ç­‰äºç³»ç»Ÿå˜é‡<code>eq_range_index_dive_limit</code>çš„å€¼çš„è¯ï¼Œå°±ä¸ä¼šä½¿ç”¨<code>index dive</code>çš„æ–¹å¼è®¡ç®—å„ä¸ªå•ç‚¹åŒºé—´å¯¹åº”çš„ç´¢å¼•è®°å½•æ¡æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨ç´¢å¼•ç»Ÿè®¡æ•°æ®ï¼Œè¿™é‡Œæ‰€æŒ‡çš„<code>ç´¢å¼•ç»Ÿè®¡æ•°æ®</code>æŒ‡çš„æ˜¯è¿™ä¸¤ä¸ªå€¼ï¼š</p><ul><li><p>ä½¿ç”¨<code>SHOW TABLE STATUS</code>å±•ç¤ºå‡ºçš„<code>Rows</code>å€¼ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªè¡¨ä¸­æœ‰å¤šå°‘æ¡è®°å½•ã€‚</p><p>è¿™ä¸ªç»Ÿè®¡æ•°æ®æˆ‘ä»¬åœ¨å‰è¾¹å” å¨å…¨è¡¨æ‰«ææˆæœ¬çš„æ—¶å€™è¯´è¿‡å¾ˆå¤šéäº†ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚</p></li><li><p>ä½¿ç”¨<code>SHOW INDEX</code>è¯­å¥å±•ç¤ºå‡ºçš„<code>Cardinality</code>å±æ€§ã€‚</p><p>ç»“åˆä¸Šä¸€ä¸ª<code>Rows</code>ç»Ÿè®¡æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ç´¢å¼•åˆ—ï¼Œè®¡ç®—å‡ºå¹³å‡ä¸€ä¸ªå€¼é‡å¤å¤šå°‘æ¬¡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">ä¸€ä¸ªå€¼çš„é‡å¤æ¬¡æ•° â‰ˆ <span class="hljs-keyword">Rows</span> Ã· <span class="hljs-keyword">Cardinality</span><br></code></pre></td></tr></table></figure></li></ul><p>ä»¥<code>single_table</code>è¡¨çš„<code>idx_key1</code>ç´¢å¼•ä¸ºä¾‹ï¼Œå®ƒçš„<code>Rows</code>å€¼æ˜¯<code>9693</code>ï¼Œå®ƒå¯¹åº”ç´¢å¼•åˆ—<code>key1</code>çš„<code>Cardinality</code>å€¼æ˜¯<code>968</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¡ç®—<code>key1</code>åˆ—å¹³å‡å•ä¸ªå€¼çš„é‡å¤æ¬¡æ•°å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">9693 </span>Ã· <span class="hljs-number">968</span> â‰ˆ <span class="hljs-number">10</span>ï¼ˆæ¡ï¼‰<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶å†çœ‹ä¸Šè¾¹é‚£æ¡æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-keyword">SELECT</span> * FROM single_table <span class="hljs-keyword">WHERE</span> key1 <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;aa1&#x27;</span>, <span class="hljs-string">&#x27;aa2&#x27;</span>, <span class="hljs-string">&#x27;aa3&#x27;</span>, <span class="hljs-params">...</span> , <span class="hljs-string">&#x27;zzz&#x27;</span>);<br></code></pre></td></tr></table></figure><p>å‡è®¾<code>IN</code>è¯­å¥ä¸­æœ‰20000ä¸ªå‚æ•°çš„è¯ï¼Œå°±ç›´æ¥ä½¿ç”¨ç»Ÿè®¡æ•°æ®æ¥ä¼°ç®—è¿™äº›å‚æ•°éœ€è¦å•ç‚¹åŒºé—´å¯¹åº”çš„è®°å½•æ¡æ•°äº†ï¼Œæ¯ä¸ªå‚æ•°å¤§çº¦å¯¹åº”<code>10</code>æ¡è®°å½•ï¼Œæ‰€ä»¥æ€»å…±éœ€è¦å›è¡¨çš„è®°å½•æ•°å°±æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">20000 </span>x <span class="hljs-number">10</span> = <span class="hljs-number">200000</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ç»Ÿè®¡æ•°æ®æ¥è®¡ç®—å•ç‚¹åŒºé—´å¯¹åº”çš„ç´¢å¼•è®°å½•æ¡æ•°å¯æ¯”<code>index dive</code>çš„æ–¹å¼ç®€å•å¤šäº†ï¼Œä½†æ˜¯å®ƒçš„è‡´å‘½å¼±ç‚¹å°±æ˜¯ï¼šä¸ç²¾ç¡®ï¼ã€‚ä½¿ç”¨ç»Ÿè®¡æ•°æ®ç®—å‡ºæ¥çš„æŸ¥è¯¢æˆæœ¬ä¸å®é™…æ‰€éœ€çš„æˆæœ¬å¯èƒ½ç›¸å·®éå¸¸å¤§ã€‚</p><blockquote><p>å°è´´å£«ï¼š å¤§å®¶éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œåœ¨MySQL 5.7.3ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œeq_range_index_dive_limitçš„é»˜è®¤å€¼ä¸º10ï¼Œä¹‹åçš„ç‰ˆæœ¬é»˜è®¤å€¼ä¸º200ã€‚æ‰€ä»¥å¦‚æœå¤§å®¶é‡‡ç”¨çš„æ˜¯5.7.3ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬çš„è¯ï¼Œå¾ˆå®¹æ˜“é‡‡ç”¨ç´¢å¼•ç»Ÿè®¡æ•°æ®è€Œä¸æ˜¯index diveçš„æ–¹å¼æ¥è®¡ç®—æŸ¥è¯¢æˆæœ¬ã€‚å½“ä½ çš„æŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°äº†INæŸ¥è¯¢ï¼Œä½†æ˜¯å´å®é™…æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œå°±åº”è¯¥è€ƒè™‘ä¸€ä¸‹æ˜¯ä¸æ˜¯ç”±äº eq_range_index_dive_limit å€¼å¤ªå°å¯¼è‡´çš„ã€‚</p></blockquote><h2 id="è¿æ¥æŸ¥è¯¢çš„æˆæœ¬">è¿æ¥æŸ¥è¯¢çš„æˆæœ¬</h2><h3 id="å‡†å¤‡å·¥ä½œ-3">å‡†å¤‡å·¥ä½œ</h3><p>è¿æ¥æŸ¥è¯¢è‡³å°‘æ˜¯è¦æœ‰ä¸¤ä¸ªè¡¨çš„ï¼Œåªæœ‰ä¸€ä¸ª<code>single_table</code>è¡¨æ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥ä¸ºäº†æ•…äº‹çš„é¡ºåˆ©å‘å±•ï¼Œæˆ‘ä»¬ç›´æ¥æ„é€ ä¸€ä¸ªå’Œ<code>single_table</code>è¡¨ä¸€æ¨¡ä¸€æ ·çš„<code>single_table2</code>è¡¨ã€‚ä¸ºäº†ç®€ä¾¿èµ·è§ï¼Œæˆ‘ä»¬æŠŠ<code>single_table</code>è¡¨ç§°ä¸º<code>s1</code>è¡¨ï¼ŒæŠŠ<code>single_table2</code>è¡¨ç§°ä¸º<code>s2</code>è¡¨ã€‚</p><h3 id="Condition-filteringä»‹ç»">Condition filteringä»‹ç»</h3><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œ<code>MySQL</code>ä¸­è¿æ¥æŸ¥è¯¢é‡‡ç”¨çš„æ˜¯<strong>åµŒå¥—å¾ªç¯è¿æ¥ç®—æ³•</strong>ï¼Œé©±åŠ¨è¡¨ä¼šè¢«è®¿é—®ä¸€æ¬¡ï¼Œè¢«é©±åŠ¨è¡¨å¯èƒ½ä¼šè¢«è®¿é—®å¤šæ¬¡ï¼Œæ‰€ä»¥å¯¹äºä¸¤è¡¨è¿æ¥æŸ¥è¯¢æ¥è¯´ï¼Œå®ƒçš„æŸ¥è¯¢æˆæœ¬ç”±ä¸‹è¾¹ä¸¤ä¸ªéƒ¨åˆ†æ„æˆï¼š</p><ul><li>å•æ¬¡æŸ¥è¯¢é©±åŠ¨è¡¨çš„æˆæœ¬</li><li>å¤šæ¬¡æŸ¥è¯¢è¢«é©±åŠ¨è¡¨çš„æˆæœ¬ï¼ˆå…·ä½“æŸ¥è¯¢å¤šå°‘æ¬¡å–å†³äºå¯¹é©±åŠ¨è¡¨æŸ¥è¯¢çš„ç»“æœé›†ä¸­æœ‰å¤šå°‘æ¡è®°å½•ï¼‰</li></ul><p>æˆ‘ä»¬æŠŠå¯¹é©±åŠ¨è¡¨è¿›è¡ŒæŸ¥è¯¢åå¾—åˆ°çš„è®°å½•æ¡æ•°ç§°ä¹‹ä¸ºé©±åŠ¨è¡¨çš„<code>æ‰‡å‡º</code>ï¼ˆè‹±æ–‡åï¼š<code>fanout</code>ï¼‰ã€‚å¾ˆæ˜¾ç„¶é©±åŠ¨è¡¨çš„æ‰‡å‡ºå€¼è¶Šå°ï¼Œå¯¹è¢«é©±åŠ¨è¡¨çš„æŸ¥è¯¢æ¬¡æ•°ä¹Ÿå°±è¶Šå°‘ï¼Œè¿æ¥æŸ¥è¯¢çš„æ€»æˆæœ¬ä¹Ÿå°±è¶Šä½ã€‚å½“æŸ¥è¯¢ä¼˜åŒ–å™¨æƒ³è®¡ç®—æ•´ä¸ªè¿æ¥æŸ¥è¯¢æ‰€ä½¿ç”¨çš„æˆæœ¬æ—¶ï¼Œå°±éœ€è¦è®¡ç®—å‡ºé©±åŠ¨è¡¨çš„æ‰‡å‡ºå€¼ï¼Œæœ‰çš„æ—¶å€™æ‰‡å‡ºå€¼çš„è®¡ç®—æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œæ¯”å¦‚ä¸‹è¾¹è¿™ä¸¤ä¸ªæŸ¥è¯¢ï¼š</p><ul><li><p>æŸ¥è¯¢ä¸€ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">AS</span> s1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> single_table2 <span class="hljs-keyword">AS</span> s2;<br></code></pre></td></tr></table></figure><p>å‡è®¾ä½¿ç”¨<code>s1</code>è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå¾ˆæ˜¾ç„¶å¯¹é©±åŠ¨è¡¨çš„å•è¡¨æŸ¥è¯¢åªèƒ½ä½¿ç”¨å…¨è¡¨æ‰«æçš„æ–¹å¼æ‰§è¡Œï¼Œé©±åŠ¨è¡¨çš„æ‰‡å‡ºå€¼ä¹Ÿå¾ˆæ˜ç¡®ï¼Œé‚£å°±æ˜¯é©±åŠ¨è¡¨ä¸­æœ‰å¤šå°‘è®°å½•ï¼Œæ‰‡å‡ºå€¼å°±æ˜¯å¤šå°‘ã€‚æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œç»Ÿè®¡æ•°æ®ä¸­<code>s1</code>è¡¨çš„è®°å½•è¡Œæ•°æ˜¯<code>9693</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼˜åŒ–å™¨å°±ç›´æ¥ä¼šæŠŠ<code>9693</code>å½“ä½œåœ¨<code>s1</code>è¡¨çš„æ‰‡å‡ºå€¼ã€‚</p></li><li><p>æŸ¥è¯¢äºŒï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> * FROM single_table AS s<span class="hljs-number">1</span> INNER JOIN single_table<span class="hljs-number">2</span> AS s<span class="hljs-number">2</span> <br><span class="hljs-attribute">WHERE</span> s<span class="hljs-number">1</span>.key<span class="hljs-number">2</span> &gt;<span class="hljs-number">10</span> AND s<span class="hljs-number">1</span>.key<span class="hljs-number">2</span> &lt; <span class="hljs-number">1000</span>;<br></code></pre></td></tr></table></figure><p>ä»ç„¶å‡è®¾<code>s1</code>è¡¨æ˜¯é©±åŠ¨è¡¨çš„è¯ï¼Œå¾ˆæ˜¾ç„¶å¯¹é©±åŠ¨è¡¨çš„å•è¡¨æŸ¥è¯¢å¯ä»¥ä½¿ç”¨<code>idx_key2</code>ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢ã€‚æ­¤æ—¶<code>idx_key2</code>çš„èŒƒå›´åŒºé—´<code>(10, 1000)</code>ä¸­æœ‰å¤šå°‘æ¡è®°å½•ï¼Œé‚£ä¹ˆæ‰‡å‡ºå€¼å°±æ˜¯å¤šå°‘ã€‚æˆ‘ä»¬å‰è¾¹è®¡ç®—è¿‡ï¼Œæ»¡è¶³<code>idx_key2</code>çš„èŒƒå›´åŒºé—´<code>(10, 1000)</code>çš„è®°å½•æ•°æ˜¯95æ¡ï¼Œä¹Ÿå°±æ˜¯è¯´æœ¬æŸ¥è¯¢ä¸­ä¼˜åŒ–å™¨ä¼šæŠŠ<code>95</code>å½“ä½œé©±åŠ¨è¡¨<code>s1</code>çš„æ‰‡å‡ºå€¼ã€‚</p></li></ul><p>äº‹æƒ…å½“ç„¶ä¸ä¼šæ€»æ˜¯ä¸€å¸†é£é¡ºçš„ï¼Œè¦ä¸ç„¶å‰§æƒ…å°±å¤ªå¹³æ·¡äº†ã€‚æœ‰çš„æ—¶å€™æ‰‡å‡ºå€¼çš„è®¡ç®—å°±å˜å¾—å¾ˆæ£˜æ‰‹ï¼Œæ¯”æ–¹è¯´ä¸‹è¾¹å‡ ä¸ªæŸ¥è¯¢ï¼š</p><ul><li><p>æŸ¥è¯¢ä¸‰ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">AS</span> s1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> single_table2 <span class="hljs-keyword">AS</span> s2 <br>    <span class="hljs-keyword">WHERE</span> s1.common_field &gt; <span class="hljs-string">&#x27;xyz&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æœ¬æŸ¥è¯¢å’Œ<code>æŸ¥è¯¢ä¸€</code>ç±»ä¼¼ï¼Œåªä¸è¿‡å¯¹äºé©±åŠ¨è¡¨<code>s1</code>å¤šäº†ä¸€ä¸ª<code>common_field &gt; 'xyz'</code>çš„æœç´¢æ¡ä»¶ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨åˆä¸ä¼šçœŸæ­£çš„å»æ‰§è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥å®ƒåªèƒ½<code>çŒœ</code>è¿™<code>9693</code>è®°å½•é‡Œæœ‰å¤šå°‘æ¡è®°å½•æ»¡è¶³<code>common_field &gt; 'xyz'</code>æ¡ä»¶ã€‚</p></li><li><p>æŸ¥è¯¢å››ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> * FROM single_table AS s<span class="hljs-number">1</span> INNER JOIN single_table<span class="hljs-number">2</span> AS s<span class="hljs-number">2</span> <br>    <span class="hljs-attribute">WHERE</span> s<span class="hljs-number">1</span>.key<span class="hljs-number">2</span> &gt; <span class="hljs-number">10</span> AND s<span class="hljs-number">1</span>.key<span class="hljs-number">2</span> &lt; <span class="hljs-number">1000</span> AND<br>          <span class="hljs-attribute">s1</span>.common_field &gt; &#x27;xyz&#x27;;<br></code></pre></td></tr></table></figure><p>æœ¬æŸ¥è¯¢å’Œ<code>æŸ¥è¯¢äºŒ</code>ç±»ä¼¼ï¼Œåªä¸è¿‡å¯¹äºé©±åŠ¨è¡¨<code>s1</code>ä¹Ÿå¤šäº†ä¸€ä¸ª<code>common_field &gt; 'xyz'</code>çš„æœç´¢æ¡ä»¶ã€‚ä¸è¿‡å› ä¸ºæœ¬æŸ¥è¯¢å¯ä»¥ä½¿ç”¨<code>idx_key2</code>ç´¢å¼•ï¼Œæ‰€ä»¥åªéœ€è¦ä»ç¬¦åˆäºŒçº§ç´¢å¼•èŒƒå›´åŒºé—´çš„è®°å½•ä¸­çŒœæœ‰å¤šå°‘æ¡è®°å½•ç¬¦åˆ<code>common_field &gt; 'xyz'</code>æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯åªéœ€è¦çŒœåœ¨<code>95</code>æ¡è®°å½•ä¸­æœ‰å¤šå°‘ç¬¦åˆ<code>common_field &gt; 'xyz'</code>æ¡ä»¶ã€‚</p></li><li><p>æŸ¥è¯¢äº”ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> single_table <span class="hljs-keyword">AS</span> s1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> single_table2 <span class="hljs-keyword">AS</span> s2 <br>    <span class="hljs-keyword">WHERE</span> s1.key2 &gt; <span class="hljs-number">10</span> <span class="hljs-keyword">AND</span> s1.key2 &lt; <span class="hljs-number">1000</span> <span class="hljs-keyword">AND</span><br>          s1.key1 <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>) <span class="hljs-keyword">AND</span><br>          s1.common_field &gt; <span class="hljs-string">&#x27;xyz&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æœ¬æŸ¥è¯¢å’Œ<code>æŸ¥è¯¢äºŒ</code>ç±»ä¼¼ï¼Œä¸è¿‡åœ¨é©±åŠ¨è¡¨<code>s1</code>é€‰å–<code>idx_key2</code>ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢åï¼Œä¼˜åŒ–å™¨éœ€è¦ä»ç¬¦åˆäºŒçº§ç´¢å¼•èŒƒå›´åŒºé—´çš„è®°å½•ä¸­çŒœæœ‰å¤šå°‘æ¡è®°å½•ç¬¦åˆä¸‹è¾¹ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li><code>key1 IN ('a', 'b', 'c')</code></li><li><code>common_field &gt; 'xyz'</code></li></ul><p>ä¹Ÿå°±æ˜¯ä¼˜åŒ–å™¨éœ€è¦çŒœåœ¨<code>95</code>æ¡è®°å½•ä¸­æœ‰å¤šå°‘ç¬¦åˆä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶çš„ã€‚</p></li></ul><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œå…¶å®å°±æ˜¯æƒ³è¡¨è¾¾åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹è®¡ç®—é©±åŠ¨è¡¨æ‰‡å‡ºå€¼æ—¶éœ€è¦é <code>çŒœ</code>ï¼š</p><ul><li>å¦‚æœä½¿ç”¨çš„æ˜¯å…¨è¡¨æ‰«æçš„æ–¹å¼æ‰§è¡Œçš„å•è¡¨æŸ¥è¯¢ï¼Œé‚£ä¹ˆè®¡ç®—é©±åŠ¨è¡¨æ‰‡å‡ºæ—¶éœ€è¦çŒœæ»¡è¶³æœç´¢æ¡ä»¶çš„è®°å½•åˆ°åº•æœ‰å¤šå°‘æ¡ã€‚</li><li>å¦‚æœä½¿ç”¨çš„æ˜¯ç´¢å¼•æ‰§è¡Œçš„å•è¡¨æ‰«æï¼Œé‚£ä¹ˆè®¡ç®—é©±åŠ¨è¡¨æ‰‡å‡ºçš„æ—¶å€™éœ€è¦çŒœæ»¡è¶³é™¤ä½¿ç”¨åˆ°å¯¹åº”ç´¢å¼•çš„æœç´¢æ¡ä»¶å¤–çš„å…¶ä»–æœç´¢æ¡ä»¶çš„è®°å½•æœ‰å¤šå°‘æ¡ã€‚</li></ul><p>è®¾è®¡<code>MySQL</code>çš„å¤§å”æŠŠè¿™ä¸ª<code>çŒœ</code>çš„è¿‡ç¨‹ç§°ä¹‹ä¸º<code>condition filtering</code>ã€‚å½“ç„¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šä½¿ç”¨åˆ°ç´¢å¼•ï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨åˆ°ç»Ÿè®¡æ•°æ®ï¼Œä¹Ÿå¯èƒ½å°±æ˜¯è®¾è®¡<code>MySQL</code>çš„å¤§å”å•çº¯çš„ççŒœï¼Œæ•´ä¸ªè¯„ä¼°è¿‡ç¨‹æŒºå¤æ‚çš„ï¼Œå†ä»”ç»†çš„å” å¨ä¸€éå¯èƒ½å¼•èµ·å¤§å®¶çš„ç”Ÿç†ä¸é€‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è·³è¿‡äº†å“ˆã€‚</p><blockquote><p>å°è´´å£«ï¼š åœ¨MySQL 5.7ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨åœ¨è®¡ç®—é©±åŠ¨è¡¨æ‰‡å‡ºæ—¶ï¼Œ<strong>å¦‚æœæ˜¯ä½¿ç”¨å…¨è¡¨æ‰«æçš„è¯ï¼Œå°±ç›´æ¥ä½¿ç”¨è¡¨ä¸­è®°å½•çš„æ•°é‡ä½œä¸ºæ‰‡å‡ºå€¼ï¼Œå¦‚æœä½¿ç”¨ç´¢å¼•çš„è¯ï¼Œå°±ç›´æ¥ä½¿ç”¨æ»¡è¶³èŒƒå›´æ¡ä»¶çš„ç´¢å¼•è®°å½•æ¡æ•°ä½œä¸ºæ‰‡å‡ºå€¼</strong>ã€‚åœ¨MySQL 5.7ä¸­ï¼Œè®¾è®¡MySQLçš„å¤§å”å¼•å…¥äº†è¿™ä¸ªcondition filteringçš„åŠŸèƒ½ï¼Œå°±æ˜¯è¿˜è¦çŒœä¸€çŒœå‰©ä½™çš„é‚£äº›æœç´¢æ¡ä»¶èƒ½æŠŠé©±åŠ¨è¡¨ä¸­çš„è®°å½•å†è¿‡æ»¤å¤šå°‘æ¡ï¼Œå…¶å®æœ¬è´¨ä¸Šå°±æ˜¯ä¸ºäº†è®©æˆæœ¬ä¼°ç®—æ›´ç²¾ç¡®ã€‚ æˆ‘ä»¬æ‰€è¯´çš„çº¯ç²¹ççŒœå…¶å®æ˜¯å¾ˆä¸ä¸¥è°¨çš„ï¼Œè®¾è®¡MySQLçš„å¤§å”ä»¬ç§°ä¹‹ä¸ºå¯å‘å¼è§„åˆ™ï¼ˆheuristicï¼‰ï¼Œå¤§å®¶æœ‰å…´è¶£çš„å¯ä»¥å†æ·±å…¥äº†è§£ä¸€ä¸‹å“ˆã€‚</p></blockquote><h3 id="ä¸¤è¡¨è¿æ¥çš„æˆæœ¬åˆ†æ">ä¸¤è¡¨è¿æ¥çš„æˆæœ¬åˆ†æ</h3><p>è¿æ¥æŸ¥è¯¢çš„æˆæœ¬è®¡ç®—å…¬å¼æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">è¿æ¥æŸ¥è¯¢æ€»æˆæœ¬ </span>=<span class="hljs-string"> å•æ¬¡è®¿é—®é©±åŠ¨è¡¨çš„æˆæœ¬ + é©±åŠ¨è¡¨æ‰‡å‡ºæ•° x å•æ¬¡è®¿é—®è¢«é©±åŠ¨è¡¨çš„æˆæœ¬</span><br></code></pre></td></tr></table></figure><p>å¯¹äºå·¦ï¼ˆå¤–ï¼‰è¿æ¥å’Œå³ï¼ˆå¤–ï¼‰è¿æ¥æŸ¥è¯¢æ¥è¯´ï¼Œå®ƒä»¬çš„é©±åŠ¨è¡¨æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æƒ³è¦å¾—åˆ°æœ€ä¼˜çš„æŸ¥è¯¢æ–¹æ¡ˆåªéœ€è¦ï¼š</p><ul><li>åˆ†åˆ«ä¸ºé©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨é€‰æ‹©æˆæœ¬æœ€ä½çš„è®¿é—®æ–¹æ³•ã€‚</li></ul><p>å¯æ˜¯å¯¹äºå†…è¿æ¥æ¥è¯´ï¼Œé©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨çš„ä½ç½®æ˜¯å¯ä»¥äº’æ¢çš„ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘ä¸¤ä¸ªæ–¹é¢çš„é—®é¢˜ï¼š</p><ul><li>ä¸åŒçš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨æœ€ç»ˆçš„æŸ¥è¯¢æˆæœ¬å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯éœ€è¦è€ƒè™‘æœ€ä¼˜çš„è¡¨è¿æ¥é¡ºåºã€‚</li><li>ç„¶ååˆ†åˆ«ä¸ºé©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨é€‰æ‹©æˆæœ¬æœ€ä½çš„è®¿é—®æ–¹æ³•ã€‚</li></ul><p>å¾ˆæ˜¾ç„¶ï¼Œè®¡ç®—å†…è¿æ¥æŸ¥è¯¢æˆæœ¬çš„æ–¹å¼æ›´éº»çƒ¦ä¸€äº›ï¼Œä¸‹è¾¹æˆ‘ä»¬å°±ä»¥å†…è¿æ¥ä¸ºä¾‹æ¥çœ‹çœ‹å¦‚ä½•è®¡ç®—å‡ºæœ€ä¼˜çš„è¿æ¥æŸ¥è¯¢æ–¹æ¡ˆã€‚</p><blockquote><p>å°è´´å£«ï¼š å·¦ï¼ˆå¤–ï¼‰è¿æ¥å’Œå³ï¼ˆå¤–ï¼‰è¿æ¥æŸ¥è¯¢åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹å¯ä»¥è¢«ä¼˜åŒ–ä¸ºå†…è¿æ¥æŸ¥è¯¢ï¼Œæˆ‘ä»¬åœ¨ä¹‹åçš„ç« èŠ‚ä¸­ä¼šä»”ç»†å” å¨çš„ï¼Œç¨å®‰å‹¿èºã€‚</p></blockquote><p>æ¯”å¦‚å¯¹äºä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢æ¥è¯´ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SELECT</span> * FROM single_table AS s<span class="hljs-number">1</span> INNER JOIN single_table<span class="hljs-number">2</span> AS s<span class="hljs-number">2</span> <br>    <span class="hljs-attribute">ON</span> s<span class="hljs-number">1</span>.key<span class="hljs-number">1</span> = s<span class="hljs-number">2</span>.common_field <br>    <span class="hljs-attribute">WHERE</span> s<span class="hljs-number">1</span>.key<span class="hljs-number">2</span> &gt; <span class="hljs-number">10</span> AND s<span class="hljs-number">1</span>.key<span class="hljs-number">2</span> &lt; <span class="hljs-number">1000</span> AND <br>          <span class="hljs-attribute">s2</span>.key<span class="hljs-number">2</span> &gt; <span class="hljs-number">1000</span> AND s<span class="hljs-number">2</span>.key<span class="hljs-number">2</span> &lt; <span class="hljs-number">2000</span>;<br></code></pre></td></tr></table></figure><p>å¯ä»¥é€‰æ‹©çš„è¿æ¥é¡ºåºæœ‰ä¸¤ç§ï¼š</p><ul><li><code>s1</code>è¿æ¥<code>s2</code>ï¼Œä¹Ÿå°±æ˜¯<code>s1</code>ä½œä¸ºé©±åŠ¨è¡¨ï¼Œ<code>s2</code>ä½œä¸ºè¢«é©±åŠ¨è¡¨ã€‚</li><li><code>s2</code>è¿æ¥<code>s1</code>ï¼Œä¹Ÿå°±æ˜¯<code>s2</code>ä½œä¸ºé©±åŠ¨è¡¨ï¼Œ<code>s1</code>ä½œä¸ºè¢«é©±åŠ¨è¡¨ã€‚</li></ul><p>æŸ¥è¯¢ä¼˜åŒ–å™¨éœ€è¦åˆ†åˆ«è€ƒè™‘è¿™ä¸¤ç§æƒ…å†µä¸‹çš„æœ€ä¼˜æŸ¥è¯¢æˆæœ¬ï¼Œç„¶åé€‰å–é‚£ä¸ªæˆæœ¬æ›´ä½çš„è¿æ¥é¡ºåºä»¥åŠè¯¥è¿æ¥é¡ºåºä¸‹å„ä¸ªè¡¨çš„æœ€ä¼˜è®¿é—®æ–¹æ³•ä½œä¸ºæœ€ç»ˆçš„æŸ¥è¯¢è®¡åˆ’ã€‚æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸€ä¸‹ï¼ˆå®šæ€§çš„åˆ†æä¸€ä¸‹ï¼Œä¸åƒåˆ†æå•è¡¨æŸ¥è¯¢é‚£æ ·å®šé‡çš„åˆ†æäº†ï¼‰ï¼š</p><ul><li><p>ä½¿ç”¨<code>s1</code>ä½œä¸ºé©±åŠ¨è¡¨çš„æƒ…å†µ</p><ul><li><p>åˆ†æå¯¹äºé©±åŠ¨è¡¨çš„æˆæœ¬æœ€ä½çš„æ‰§è¡Œæ–¹æ¡ˆ</p><p>é¦–å…ˆçœ‹ä¸€ä¸‹æ¶‰åŠ<code>s1</code>è¡¨å•è¡¨çš„æœç´¢æ¡ä»¶æœ‰å“ªäº›ï¼š</p><ul><li><code>s1.key2 &gt; 10 AND s1.key2 &lt; 1000</code></li></ul><p>æ‰€ä»¥è¿™ä¸ªæŸ¥è¯¢å¯èƒ½ä½¿ç”¨åˆ°<code>idx_key2</code>ç´¢å¼•ï¼Œä»å…¨è¡¨æ‰«æå’Œä½¿ç”¨<code>idx_key2</code>è¿™ä¸¤ä¸ªæ–¹æ¡ˆä¸­é€‰å‡ºæˆæœ¬æœ€ä½çš„é‚£ä¸ªï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ä¸Šè¾¹éƒ½å” å¨è¿‡äº†ï¼Œå¾ˆæ˜¾ç„¶ä½¿ç”¨<code>idx_key2</code>æ‰§è¡ŒæŸ¥è¯¢çš„æˆæœ¬æ›´ä½äº›ã€‚</p></li><li><p>ç„¶ååˆ†æå¯¹äºè¢«é©±åŠ¨è¡¨çš„æˆæœ¬æœ€ä½çš„æ‰§è¡Œæ–¹æ¡ˆ</p><p>æ­¤æ—¶æ¶‰åŠè¢«é©±åŠ¨è¡¨<code>s2</code>çš„æœç´¢æ¡ä»¶å°±æ˜¯ï¼š</p><ul><li><code>s2.common_field = å¸¸æ•°</code>ï¼ˆè¿™æ˜¯å› ä¸ºå¯¹é©±åŠ¨è¡¨<code>s1</code>ç»“æœé›†ä¸­çš„æ¯ä¸€æ¡è®°å½•ï¼Œéƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡è¢«é©±åŠ¨è¡¨<code>s2</code>çš„è®¿é—®ï¼Œæ­¤æ—¶é‚£äº›æ¶‰åŠä¸¤è¡¨çš„æ¡ä»¶ç°åœ¨ç›¸å½“äºåªæ¶‰åŠè¢«é©±åŠ¨è¡¨<code>s2</code>äº†ã€‚ï¼‰</li><li><code>s2.key2 &gt; 1000 AND s2.key2 &lt; 2000</code></li></ul><p>å¾ˆæ˜¾ç„¶ï¼Œç¬¬ä¸€ä¸ªæ¡ä»¶ç”±äº<code>common_field</code>æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œæ­¤æ—¶è®¿é—®<code>s2</code>è¡¨æ—¶å¯ç”¨çš„æ–¹æ¡ˆä¹Ÿæ˜¯å…¨è¡¨æ‰«æå’Œä½¿ç”¨<code>idx_key2</code>ä¸¤ç§ï¼Œå‡è®¾ä½¿ç”¨<code>idx_key2</code>çš„æˆæœ¬æ›´å°ã€‚</p></li></ul><p>æ‰€ä»¥æ­¤æ—¶ä½¿ç”¨<code>s1</code>ä½œä¸ºé©±åŠ¨è¡¨æ—¶çš„æ€»æˆæœ¬å°±æ˜¯ï¼ˆæš‚æ—¶ä¸è€ƒè™‘ä½¿ç”¨<code>join buffer</code>å¯¹æˆæœ¬çš„å½±å“ï¼‰ï¼š</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">ä½¿ç”¨idx_key2è®¿é—®<span class="hljs-built_in">s1</span>çš„æˆæœ¬ + <span class="hljs-built_in">s1</span>çš„æ‰‡å‡º Ã— ä½¿ç”¨idx_key2è®¿é—®<span class="hljs-built_in">s2</span>çš„æˆæœ¬<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨<code>s2</code>ä½œä¸ºé©±åŠ¨è¡¨çš„æƒ…å†µ</p><ul><li><p>åˆ†æå¯¹äºé©±åŠ¨è¡¨çš„æˆæœ¬æœ€ä½çš„æ‰§è¡Œæ–¹æ¡ˆ</p><p>é¦–å…ˆçœ‹ä¸€ä¸‹æ¶‰åŠ<code>s2</code>è¡¨å•è¡¨çš„æœç´¢æ¡ä»¶æœ‰å“ªäº›ï¼š</p><ul><li><code>s2.key2 &gt; 1000 AND s2.key2 &lt; 2000</code></li></ul><p>æ‰€ä»¥è¿™ä¸ªæŸ¥è¯¢å¯èƒ½ä½¿ç”¨åˆ°<code>idx_key2</code>ç´¢å¼•ï¼Œä»å…¨è¡¨æ‰«æå’Œä½¿ç”¨<code>idx_key2</code>è¿™ä¸¤ä¸ªæ–¹æ¡ˆä¸­é€‰å‡ºæˆæœ¬æœ€ä½çš„é‚£ä¸ªï¼Œå‡è®¾ä½¿ç”¨<code>idx_key2</code>æ‰§è¡ŒæŸ¥è¯¢çš„æˆæœ¬æ›´ä½äº›ã€‚</p></li><li><p>ç„¶ååˆ†æå¯¹äºè¢«é©±åŠ¨è¡¨çš„æˆæœ¬æœ€ä½çš„æ‰§è¡Œæ–¹æ¡ˆ</p><p>æ­¤æ—¶æ¶‰åŠè¢«é©±åŠ¨è¡¨<code>s1</code>çš„æœç´¢æ¡ä»¶å°±æ˜¯ï¼š</p><ul><li><code>s1.key1 = å¸¸æ•°</code></li><li><code>s1.key2 &gt; 10 AND s1.key2 &lt; 2000</code></li></ul><p>è¿™æ—¶å°±å¾ˆæœ‰è¶£äº†ï¼Œä½¿ç”¨<code>idx_key1</code>å¯ä»¥è¿›è¡Œ<code>ref</code>æ–¹å¼çš„è®¿é—®ï¼Œä½¿ç”¨<code>idx_key2</code>å¯ä»¥ä½¿ç”¨<code>range</code>æ–¹å¼çš„è®¿é—®ã€‚è¿™æ˜¯ä¼˜åŒ–å™¨éœ€è¦ä»å…¨è¡¨æ‰«æã€ä½¿ç”¨<code>idx_key1</code>ã€ä½¿ç”¨<code>idx_key2</code>è¿™å‡ ä¸ªæ–¹æ¡ˆé‡Œé€‰å‡ºä¸€ä¸ªæˆæœ¬æœ€ä½çš„æ–¹æ¡ˆã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜å•Šï¼Œå› ä¸º<code>idx_key2</code>çš„èŒƒå›´åŒºé—´æ˜¯ç¡®å®šçš„ï¼š<code>(10, 1000)</code>ï¼Œæ€ä¹ˆè®¡ç®—ä½¿ç”¨<code>idx_key2</code>çš„æˆæœ¬æˆ‘ä»¬ä¸Šè¾¹å·²ç»è¯´è¿‡äº†ï¼Œå¯æ˜¯åœ¨æ²¡æœ‰çœŸæ­£æ‰§è¡ŒæŸ¥è¯¢å‰ï¼Œ<code>s1.key1 = å¸¸æ•°</code>ä¸­çš„<code>å¸¸æ•°</code>å€¼æˆ‘ä»¬æ˜¯ä¸çŸ¥é“çš„ï¼Œæ€ä¹ˆè¡¡é‡ä½¿ç”¨<code>idx_key1</code>æ‰§è¡ŒæŸ¥è¯¢çš„æˆæœ¬å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œç›´æ¥ä½¿ç”¨ç´¢å¼•ç»Ÿè®¡æ•°æ®å°±å¥½äº†ï¼ˆå°±æ˜¯ç´¢å¼•åˆ—å¹³å‡ä¸€ä¸ªå€¼é‡å¤å¤šå°‘æ¬¡ï¼‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>ref</code>çš„è®¿é—®æ–¹å¼è¦æ¯”<code>range</code>æˆæœ¬æ›´ä½ï¼Œè¿™é‡Œå‡è®¾ä½¿ç”¨<code>idx_key1</code>è¿›è¡Œå¯¹<code>s1</code>çš„è®¿é—®ã€‚</p></li></ul><p>æ‰€ä»¥æ­¤æ—¶ä½¿ç”¨<code>s2</code>ä½œä¸ºé©±åŠ¨è¡¨æ—¶çš„æ€»æˆæœ¬å°±æ˜¯ï¼š</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">ä½¿ç”¨idx_key2è®¿é—®<span class="hljs-built_in">s2</span>çš„æˆæœ¬ + <span class="hljs-built_in">s2</span>çš„æ‰‡å‡º Ã— ä½¿ç”¨idx_key1è®¿é—®<span class="hljs-built_in">s1</span>çš„æˆæœ¬<br></code></pre></td></tr></table></figure></li></ul><p>æœ€åä¼˜åŒ–å™¨ä¼šæ¯”è¾ƒè¿™ä¸¤ç§æ–¹å¼çš„æœ€ä¼˜è®¿é—®æˆæœ¬ï¼Œé€‰å–é‚£ä¸ªæˆæœ¬æ›´ä½çš„è¿æ¥é¡ºåºå»çœŸæ­£çš„æ‰§è¡ŒæŸ¥è¯¢ã€‚ä»ä¸Šè¾¹çš„è®¡ç®—è¿‡ç¨‹ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿æ¥æŸ¥è¯¢æˆæœ¬å å¤§å¤´çš„å…¶å®æ˜¯<code>é©±åŠ¨è¡¨æ‰‡å‡ºæ•° x å•æ¬¡è®¿é—®è¢«é©±åŠ¨è¡¨çš„æˆæœ¬</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¼˜åŒ–é‡ç‚¹å…¶å®æ˜¯ä¸‹è¾¹è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>å°½é‡å‡å°‘é©±åŠ¨è¡¨çš„æ‰‡å‡º</p></li><li><p>å¯¹è¢«é©±åŠ¨è¡¨çš„è®¿é—®æˆæœ¬å°½é‡ä½</p><p>è¿™ä¸€ç‚¹å¯¹äºæˆ‘ä»¬å®é™…ä¹¦å†™è¿æ¥æŸ¥è¯¢è¯­å¥æ—¶ååˆ†æœ‰ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å°½é‡åœ¨è¢«é©±åŠ¨è¡¨çš„è¿æ¥åˆ—ä¸Šå»ºç«‹ç´¢å¼•ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨<code>ref</code>è®¿é—®æ–¹æ³•æ¥é™ä½è®¿é—®è¢«é©±åŠ¨è¡¨çš„æˆæœ¬äº†ã€‚å¦‚æœå¯ä»¥ï¼Œè¢«é©±åŠ¨è¡¨çš„è¿æ¥åˆ—æœ€å¥½æ˜¯è¯¥è¡¨çš„ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠè®¿é—®è¢«é©±åŠ¨è¡¨çš„æˆæœ¬é™åˆ°æ›´ä½äº†ã€‚</p></li></ul><h3 id="å¤šè¡¨è¿æ¥çš„æˆæœ¬åˆ†æ">å¤šè¡¨è¿æ¥çš„æˆæœ¬åˆ†æ</h3><p>é¦–å…ˆè¦è€ƒè™‘ä¸€ä¸‹å¤šè¡¨è¿æ¥æ—¶å¯èƒ½äº§ç”Ÿå‡ºå¤šå°‘ç§è¿æ¥é¡ºåºï¼š</p><ul><li><p>å¯¹äºä¸¤è¡¨è¿æ¥ï¼Œæ¯”å¦‚è¡¨Aå’Œè¡¨Bè¿æ¥</p><p>åªæœ‰ ABã€BAè¿™ä¸¤ç§è¿æ¥é¡ºåºã€‚å…¶å®ç›¸å½“äº<code>2 Ã— 1 = 2</code>ç§è¿æ¥é¡ºåºã€‚</p></li><li><p>å¯¹äºä¸‰è¡¨è¿æ¥ï¼Œæ¯”å¦‚è¡¨Aã€è¡¨Bã€è¡¨Cè¿›è¡Œè¿æ¥</p><p>æœ‰ABCã€ACBã€BACã€BCAã€CABã€CBAè¿™ä¹ˆ6ç§è¿æ¥é¡ºåºã€‚å…¶å®ç›¸å½“äº<code>3 Ã— 2 Ã— 1 = 6</code>ç§è¿æ¥é¡ºåºã€‚</p></li><li><p>å¯¹äºå››è¡¨è¿æ¥çš„è¯ï¼Œåˆ™ä¼šæœ‰<code>4 Ã— 3 Ã— 2 Ã— 1 = 24</code>ç§è¿æ¥é¡ºåºã€‚</p></li><li><p>å¯¹äº<code>n</code>è¡¨è¿æ¥çš„è¯ï¼Œåˆ™æœ‰ <code>n Ã— (n-1) Ã— (n-2) Ã— Â·Â·Â· Ã— 1</code>ç§è¿æ¥é¡ºåºï¼Œå°±æ˜¯nçš„é˜¶ä¹˜ç§è¿æ¥é¡ºåºï¼Œä¹Ÿå°±æ˜¯<code>n!</code>ã€‚</p></li></ul><p>æœ‰<code>n</code>ä¸ªè¡¨è¿›è¡Œè¿æ¥ï¼Œ<code>MySQL</code>æŸ¥è¯¢ä¼˜åŒ–å™¨è¦æ¯ä¸€ç§è¿æ¥é¡ºåºçš„æˆæœ¬éƒ½è®¡ç®—ä¸€éä¹ˆï¼Ÿé‚£å¯æ˜¯<code>n!</code>ç§è¿æ¥é¡ºåºå‘€ã€‚å…¶å®çœŸçš„æ˜¯è¦éƒ½ç®—ä¸€éï¼Œä¸è¿‡è®¾è®¡<code>MySQL</code>çš„å¤§å”ä»¬æƒ³äº†å¾ˆå¤šåŠæ³•å‡å°‘è®¡ç®—éå¸¸å¤šç§è¿æ¥é¡ºåºçš„æˆæœ¬çš„æ–¹æ³•ï¼š</p><ul><li><p>æå‰ç»“æŸæŸç§é¡ºåºçš„æˆæœ¬è¯„ä¼°</p><p><code>MySQL</code>åœ¨è®¡ç®—å„ç§é“¾æ¥é¡ºåºçš„æˆæœ¬ä¹‹å‰ï¼Œä¼šç»´æŠ¤ä¸€ä¸ªå…¨å±€çš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡è¡¨ç¤ºå½“å‰æœ€å°çš„è¿æ¥æŸ¥è¯¢æˆæœ¬ã€‚å¦‚æœåœ¨åˆ†ææŸä¸ªè¿æ¥é¡ºåºçš„æˆæœ¬æ—¶ï¼Œè¯¥æˆæœ¬å·²ç»è¶…è¿‡å½“å‰æœ€å°çš„è¿æ¥æŸ¥è¯¢æˆæœ¬ï¼Œé‚£å°±å‹æ ¹å„¿ä¸å¯¹è¯¥è¿æ¥é¡ºåºç»§ç»­å¾€ä¸‹åˆ†æäº†ã€‚æ¯”æ–¹è¯´Aã€Bã€Cä¸‰ä¸ªè¡¨è¿›è¡Œè¿æ¥ï¼Œå·²ç»å¾—åˆ°è¿æ¥é¡ºåº<code>ABC</code>æ˜¯å½“å‰çš„æœ€å°è¿æ¥æˆæœ¬ï¼Œæ¯”æ–¹è¯´<code>10.0</code>ï¼Œåœ¨è®¡ç®—è¿æ¥é¡ºåº<code>BCA</code>æ—¶ï¼Œå‘ç°<code>B</code>å’Œ<code>C</code>çš„è¿æ¥æˆæœ¬å°±å·²ç»å¤§äº<code>10.0</code>æ—¶ï¼Œå°±ä¸å†ç»§ç»­å¾€ååˆ†æ<code>BCA</code>è¿™ä¸ªè¿æ¥é¡ºåºçš„æˆæœ¬äº†ã€‚</p></li><li><p>ç³»ç»Ÿå˜é‡<code>optimizer_search_depth</code></p><p>ä¸ºäº†é˜²æ­¢æ— ç©·æ— å°½çš„åˆ†æå„ç§è¿æ¥é¡ºåºçš„æˆæœ¬ï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”ä»¬æå‡ºäº†<code>optimizer_search_depth</code>ç³»ç»Ÿå˜é‡ï¼Œå¦‚æœè¿æ¥è¡¨çš„ä¸ªæ•°å°äºè¯¥å€¼ï¼Œé‚£ä¹ˆå°±ç»§ç»­ç©·ä¸¾åˆ†ææ¯ä¸€ç§è¿æ¥é¡ºåºçš„æˆæœ¬ï¼Œå¦åˆ™åªå¯¹ä¸<code>optimizer_search_depth</code>å€¼ç›¸åŒæ•°é‡çš„è¡¨è¿›è¡Œç©·ä¸¾åˆ†æã€‚å¾ˆæ˜¾ç„¶ï¼Œè¯¥å€¼è¶Šå¤§ï¼Œæˆæœ¬åˆ†æçš„è¶Šç²¾ç¡®ï¼Œè¶Šå®¹æ˜“å¾—åˆ°å¥½çš„æ‰§è¡Œè®¡åˆ’ï¼Œä½†æ˜¯æ¶ˆè€—çš„æ—¶é—´ä¹Ÿå°±è¶Šé•¿ï¼Œå¦åˆ™å¾—åˆ°ä¸æ˜¯å¾ˆå¥½çš„æ‰§è¡Œè®¡åˆ’ï¼Œä½†å¯ä»¥çœæ‰å¾ˆå¤šåˆ†æè¿æ¥æˆæœ¬çš„æ—¶é—´ã€‚</p></li><li><p>æ ¹æ®æŸäº›è§„åˆ™å‹æ ¹å„¿å°±ä¸è€ƒè™‘æŸäº›è¿æ¥é¡ºåº</p><p>å³ä½¿æ˜¯æœ‰ä¸Šè¾¹ä¸¤æ¡è§„åˆ™çš„é™åˆ¶ï¼Œä½†æ˜¯åˆ†æå¤šä¸ªè¡¨ä¸åŒè¿æ¥é¡ºåºæˆæœ¬èŠ±è´¹çš„æ—¶é—´è¿˜æ˜¯ä¼šå¾ˆé•¿ï¼Œæ‰€ä»¥è®¾è®¡<code>MySQL</code>çš„å¤§å”å¹²è„†æå‡ºäº†ä¸€äº›æ‰€è°“çš„<code>å¯å‘å¼è§„åˆ™</code>ï¼ˆå°±æ˜¯æ ¹æ®ä»¥å¾€ç»éªŒæŒ‡å®šçš„ä¸€äº›è§„åˆ™ï¼‰ï¼Œå‡¡æ˜¯ä¸æ»¡è¶³è¿™äº›è§„åˆ™çš„è¿æ¥é¡ºåºå‹æ ¹å„¿å°±ä¸åˆ†æï¼Œè¿™æ ·å¯ä»¥æå¤§çš„å‡å°‘éœ€è¦åˆ†æçš„è¿æ¥é¡ºåºçš„æ•°é‡ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½é€ æˆé”™å¤±æœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚ä»–ä»¬æä¾›äº†ä¸€ä¸ªç³»ç»Ÿå˜é‡<code>optimizer_prune_level</code>æ¥æ§åˆ¶åˆ°åº•æ˜¯ä¸æ˜¯ç”¨è¿™äº›å¯å‘å¼è§„åˆ™ã€‚</p></li></ul><h2 id="è°ƒèŠ‚æˆæœ¬å¸¸æ•°">è°ƒèŠ‚æˆæœ¬å¸¸æ•°</h2><p>æˆ‘ä»¬å‰è¾¹å·²ç»ä»‹ç»äº†ä¸¤ä¸ª<code>æˆæœ¬å¸¸æ•°</code>ï¼š</p><ul><li>è¯»å–ä¸€ä¸ªé¡µé¢èŠ±è´¹çš„æˆæœ¬é»˜è®¤æ˜¯<code>1.0</code></li><li>æ£€æµ‹ä¸€æ¡è®°å½•æ˜¯å¦ç¬¦åˆæœç´¢æ¡ä»¶çš„æˆæœ¬é»˜è®¤æ˜¯<code>0.2</code></li></ul><p>å…¶å®é™¤äº†è¿™ä¸¤ä¸ªæˆæœ¬å¸¸æ•°ï¼Œ<code>MySQL</code>è¿˜æ”¯æŒå¥½å¤šå‘¢ï¼Œå®ƒä»¬è¢«å­˜å‚¨åˆ°äº†<code>mysql</code>æ•°æ®åº“ï¼ˆè¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿæ•°æ®åº“ï¼Œæˆ‘ä»¬ä¹‹å‰ä»‹ç»è¿‡ï¼‰çš„ä¸¤ä¸ªè¡¨ä¸­ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW TABLES FROM mysql LIKE &#x27;%cost%&#x27;;</span><br><span class="hljs-section">+--------------------------+</span><br><span class="hljs-section">| Tables_in_mysql (%cost%) |</span><br><span class="hljs-section">+--------------------------+</span><br>| engine<span class="hljs-emphasis">_cost              |</span><br><span class="hljs-emphasis">| server_</span>cost              |<br><span class="hljs-code">+--------------------------+</span><br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« ä¸­å°±è¯´è¿‡ï¼Œä¸€æ¡è¯­å¥çš„æ‰§è¡Œå…¶å®æ˜¯åˆ†ä¸ºä¸¤å±‚çš„ï¼š</p><ul><li><code>server</code>å±‚</li><li>å­˜å‚¨å¼•æ“å±‚</li></ul><p>åœ¨<code>server</code>å±‚è¿›è¡Œè¿æ¥ç®¡ç†ã€æŸ¥è¯¢ç¼“å­˜ã€è¯­æ³•è§£æã€æŸ¥è¯¢ä¼˜åŒ–ç­‰æ“ä½œï¼Œåœ¨å­˜å‚¨å¼•æ“å±‚æ‰§è¡Œå…·ä½“çš„æ•°æ®å­˜å–æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€æ¡è¯­å¥åœ¨<code>server</code>å±‚ä¸­æ‰§è¡Œçš„æˆæœ¬æ˜¯å’Œå®ƒæ“ä½œçš„è¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯æ²¡å…³ç³»çš„ï¼Œæ‰€ä»¥å…³äºè¿™äº›æ“ä½œå¯¹åº”çš„<code>æˆæœ¬å¸¸æ•°</code>å°±å­˜å‚¨åœ¨äº†<code>server_cost</code>è¡¨ä¸­ï¼Œè€Œä¾èµ–äºå­˜å‚¨å¼•æ“çš„ä¸€äº›æ“ä½œå¯¹åº”çš„<code>æˆæœ¬å¸¸æ•°</code>å°±å­˜å‚¨åœ¨äº†<code>engine_cost</code>è¡¨ä¸­ã€‚</p><h3 id="mysql-server-costè¡¨">mysql.server_costè¡¨</h3><p><code>server_cost</code>è¡¨ä¸­åœ¨<code>server</code>å±‚è¿›è¡Œçš„ä¸€äº›æ“ä½œå¯¹åº”çš„<code>æˆæœ¬å¸¸æ•°</code>ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; SELECT <span class="hljs-symbol">*</span> FROM mysql.server_cost;<br>+------------------------------+------------+---------------------+---------+<br>|<span class="hljs-string"> cost_name                    </span>|<span class="hljs-string"> cost_value </span>|<span class="hljs-string"> last_update         </span>|<span class="hljs-string"> comment </span>|<br>+------------------------------+------------+---------------------+---------+<br>|<span class="hljs-string"> disk_temptable_create_cost   </span>|<span class="hljs-string">       NULL </span>|<span class="hljs-string"> 2018-01-20 12:03:21 </span>|<span class="hljs-string"> NULL    </span>|<br>|<span class="hljs-string"> disk_temptable_row_cost      </span>|<span class="hljs-string">       NULL </span>|<span class="hljs-string"> 2018-01-20 12:03:21 </span>|<span class="hljs-string"> NULL    </span>|<br>|<span class="hljs-string"> key_compare_cost             </span>|<span class="hljs-string">       NULL </span>|<span class="hljs-string"> 2018-01-20 12:03:21 </span>|<span class="hljs-string"> NULL    </span>|<br>|<span class="hljs-string"> memory_temptable_create_cost </span>|<span class="hljs-string">       NULL </span>|<span class="hljs-string"> 2018-01-20 12:03:21 </span>|<span class="hljs-string"> NULL    </span>|<br>|<span class="hljs-string"> memory_temptable_row_cost    </span>|<span class="hljs-string">       NULL </span>|<span class="hljs-string"> 2018-01-20 12:03:21 </span>|<span class="hljs-string"> NULL    </span>|<br>|<span class="hljs-string"> row_evaluate_cost            </span>|<span class="hljs-string">       NULL </span>|<span class="hljs-string"> 2018-01-20 12:03:21 </span>|<span class="hljs-string"> NULL    </span>|<br>+------------------------------+------------+---------------------+---------+<br>6 rows in set (0.05 sec)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹<code>server_cost</code>å„ä¸ªåˆ—éƒ½åˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€ï¼š</p><ul><li><p><code>cost_name</code></p><p>è¡¨ç¤ºæˆæœ¬å¸¸æ•°çš„åç§°ã€‚</p></li><li><p><code>cost_value</code></p><p>è¡¨ç¤ºæˆæœ¬å¸¸æ•°å¯¹åº”çš„å€¼ã€‚å¦‚æœè¯¥åˆ—çš„å€¼ä¸º<code>NULL</code>çš„è¯ï¼Œæ„å‘³ç€å¯¹åº”çš„æˆæœ¬å¸¸æ•°ä¼šé‡‡ç”¨é»˜è®¤å€¼ã€‚</p></li><li><p><code>last_update</code></p><p>è¡¨ç¤ºæœ€åæ›´æ–°è®°å½•çš„æ—¶é—´ã€‚</p></li><li><p><code>comment</code></p><p>æ³¨é‡Šã€‚</p></li></ul><p>ä»<code>server_cost</code>ä¸­çš„å†…å®¹å¯ä»¥çœ‹å‡ºæ¥ï¼Œç›®å‰åœ¨<code>server</code>å±‚çš„ä¸€äº›æ“ä½œå¯¹åº”çš„<code>æˆæœ¬å¸¸æ•°</code>æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><table><thead><tr><th>æˆæœ¬å¸¸æ•°åç§°</th><th>é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>disk_temptable_create_cost</code></td><td><code>40.0</code></td><td>åˆ›å»ºåŸºäºç£ç›˜çš„ä¸´æ—¶è¡¨çš„æˆæœ¬ï¼Œå¦‚æœå¢å¤§è¿™ä¸ªå€¼çš„è¯ä¼šè®©ä¼˜åŒ–å™¨å°½é‡å°‘çš„åˆ›å»ºåŸºäºç£ç›˜çš„ä¸´æ—¶è¡¨ã€‚</td></tr><tr><td><code>disk_temptable_row_cost</code></td><td><code>1.0</code></td><td>å‘åŸºäºç£ç›˜çš„ä¸´æ—¶è¡¨å†™å…¥æˆ–è¯»å–ä¸€æ¡è®°å½•çš„æˆæœ¬ï¼Œå¦‚æœå¢å¤§è¿™ä¸ªå€¼çš„è¯ä¼šè®©ä¼˜åŒ–å™¨å°½é‡å°‘çš„åˆ›å»ºåŸºäºç£ç›˜çš„ä¸´æ—¶è¡¨ã€‚</td></tr><tr><td><code>key_compare_cost</code></td><td><code>0.1</code></td><td>ä¸¤æ¡è®°å½•åšæ¯”è¾ƒæ“ä½œçš„æˆæœ¬ï¼Œå¤šç”¨åœ¨æ’åºæ“ä½œä¸Šï¼Œå¦‚æœå¢å¤§è¿™ä¸ªå€¼çš„è¯ä¼šæå‡<code>filesort</code>çš„æˆæœ¬ï¼Œè®©ä¼˜åŒ–å™¨å¯èƒ½æ›´å€¾å‘äºä½¿ç”¨ç´¢å¼•å®Œæˆæ’åºè€Œä¸æ˜¯<code>filesort</code>ã€‚</td></tr><tr><td><code>memory_temptable_create_cost</code></td><td><code>2.0</code></td><td>åˆ›å»ºåŸºäºå†…å­˜çš„ä¸´æ—¶è¡¨çš„æˆæœ¬ï¼Œå¦‚æœå¢å¤§è¿™ä¸ªå€¼çš„è¯ä¼šè®©ä¼˜åŒ–å™¨å°½é‡å°‘çš„åˆ›å»ºåŸºäºå†…å­˜çš„ä¸´æ—¶è¡¨ã€‚</td></tr><tr><td><code>memory_temptable_row_cost</code></td><td><code>0.2</code></td><td>å‘åŸºäºå†…å­˜çš„ä¸´æ—¶è¡¨å†™å…¥æˆ–è¯»å–ä¸€æ¡è®°å½•çš„æˆæœ¬ï¼Œå¦‚æœå¢å¤§è¿™ä¸ªå€¼çš„è¯ä¼šè®©ä¼˜åŒ–å™¨å°½é‡å°‘çš„åˆ›å»ºåŸºäºå†…å­˜çš„ä¸´æ—¶è¡¨ã€‚</td></tr><tr><td><code>row_evaluate_cost</code></td><td><code>0.2</code></td><td>è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä¸€ç›´ä½¿ç”¨çš„æ£€æµ‹ä¸€æ¡è®°å½•æ˜¯å¦ç¬¦åˆæœç´¢æ¡ä»¶çš„æˆæœ¬ï¼Œå¢å¤§è¿™ä¸ªå€¼å¯èƒ½è®©ä¼˜åŒ–å™¨æ›´å€¾å‘äºä½¿ç”¨ç´¢å¼•è€Œä¸æ˜¯ç›´æ¥å…¨è¡¨æ‰«æã€‚</td></tr></tbody></table><blockquote><p>å°è´´å£«ï¼š MySQLåœ¨æ‰§è¡Œè¯¸å¦‚DISTINCTæŸ¥è¯¢ã€åˆ†ç»„æŸ¥è¯¢ã€UnionæŸ¥è¯¢ä»¥åŠæŸäº›ç‰¹æ®Šæ¡ä»¶ä¸‹çš„æ’åºæŸ¥è¯¢éƒ½å¯èƒ½åœ¨å†…éƒ¨å…ˆåˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œä½¿ç”¨è¿™ä¸ªä¸´æ—¶è¡¨æ¥è¾…åŠ©å®ŒæˆæŸ¥è¯¢ï¼ˆæ¯”å¦‚å¯¹äºDISTINCTæŸ¥è¯¢å¯ä»¥å»ºä¸€ä¸ªå¸¦æœ‰UNIQUEç´¢å¼•çš„ä¸´æ—¶è¡¨ï¼Œç›´æ¥æŠŠéœ€è¦å»é‡çš„è®°å½•æ’å…¥åˆ°è¿™ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œæ’å…¥å®Œæˆä¹‹åçš„è®°å½•å°±æ˜¯ç»“æœé›†äº†ï¼‰ã€‚åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹å¯èƒ½åˆ›å»ºåŸºäºç£ç›˜çš„ä¸´æ—¶è¡¨ï¼Œä¹Ÿå°±æ˜¯ä¸ºè¯¥ä¸´æ—¶è¡¨ä½¿ç”¨MyISAMã€InnoDBç­‰å­˜å‚¨å¼•æ“ï¼Œåœ¨æ•°æ®é‡ä¸å¤§æ—¶å¯èƒ½åˆ›å»ºåŸºäºå†…å­˜çš„ä¸´æ—¶è¡¨ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨Memoryå­˜å‚¨å¼•æ“ã€‚å…³äºæ›´å¤šä¸´æ—¶è¡¨çš„ç»†èŠ‚æˆ‘ä»¬å¹¶ä¸æ‰“ç®—å±•å¼€å” å¨ï¼Œå› ä¸ºå±•å¼€å¯èƒ½åˆéœ€è¦å¥½å‡ ä¸‡å­—äº†ï¼Œå¤§å®¶çŸ¥é“åˆ›å»ºä¸´æ—¶è¡¨å’Œå¯¹è¿™ä¸ªä¸´æ—¶è¡¨è¿›è¡Œå†™å…¥å’Œè¯»å–çš„æ“ä½œä»£ä»·è¿˜æ˜¯å¾ˆé«˜çš„å°±è¡Œäº†ã€‚</p></blockquote><p>è¿™äº›æˆæœ¬å¸¸æ•°åœ¨<code>server_cost</code>ä¸­çš„åˆå§‹å€¼éƒ½æ˜¯<code>NULL</code>ï¼Œæ„å‘³ç€ä¼˜åŒ–å™¨ä¼šä½¿ç”¨å®ƒä»¬çš„é»˜è®¤å€¼æ¥è®¡ç®—æŸä¸ªæ“ä½œçš„æˆæœ¬ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä¿®æ”¹æŸä¸ªæˆæœ¬å¸¸æ•°çš„å€¼çš„è¯ï¼Œéœ€è¦åšä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li><p>å¯¹æˆ‘ä»¬æ„Ÿå…´è¶£çš„æˆæœ¬å¸¸æ•°åšæ›´æ–°æ“ä½œ</p><p>æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³æŠŠæ£€æµ‹ä¸€æ¡è®°å½•æ˜¯å¦ç¬¦åˆæœç´¢æ¡ä»¶çš„æˆæœ¬å¢å¤§åˆ°<code>0.4</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿™æ ·å†™æ›´æ–°è¯­å¥ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gams">UPDATE mysql.server_cost <br>    <span class="hljs-keyword">SET</span> cost_value <span class="hljs-comment">= 0.4</span><br>    WHERE <span class="hljs-comment">cost_name =</span> <span class="hljs-comment">&#x27;row_evaluate_cost&#x27;</span>;<br></code></pre></td></tr></table></figure></li><li><p>è®©ç³»ç»Ÿé‡æ–°åŠ è½½è¿™ä¸ªè¡¨çš„å€¼ã€‚</p><p>ä½¿ç”¨ä¸‹è¾¹è¯­å¥å³å¯ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">FLUSH OPTIMIZER_COSTS<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></li></ul><p>å½“ç„¶ï¼Œåœ¨ä½ ä¿®æ”¹å®ŒæŸä¸ªæˆæœ¬å¸¸æ•°åæƒ³æŠŠå®ƒä»¬å†æ”¹å›é»˜è®¤å€¼çš„è¯ï¼Œå¯ä»¥ç›´æ¥æŠŠ<code>cost_value</code>çš„å€¼è®¾ç½®ä¸º<code>NULL</code>ï¼Œå†ä½¿ç”¨<code>FLUSH OPTIMIZER_COSTS</code>è¯­å¥è®©ç³»ç»Ÿé‡æ–°åŠ è½½å®ƒå°±å¥½äº†ã€‚</p><h3 id="mysql-engine-costè¡¨">mysql.engine_costè¡¨</h3><p><code>engine_costè¡¨</code>è¡¨ä¸­åœ¨å­˜å‚¨å¼•æ“å±‚è¿›è¡Œçš„ä¸€äº›æ“ä½œå¯¹åº”çš„<code>æˆæœ¬å¸¸æ•°</code>ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SELECT * FROM mysql.engine_cost;</span><br><span class="hljs-section">+-------------+-------------+------------------------+------------+---------------------+---------+</span><br><span class="hljs-section">| engine_name | device_type | cost_name              | cost_value | last_update         | comment |</span><br><span class="hljs-section">+-------------+-------------+------------------------+------------+---------------------+---------+</span><br>| default     |           0 | io<span class="hljs-emphasis">_block_read_cost     |       NULL | 2018-01-20 12:03:21 | NULL    |</span><br><span class="hljs-emphasis">| default     |           0 | memory_block_read_</span>cost |       NULL | 2018-01-20 12:03:21 | NULL    |<br><span class="hljs-code">+-------------+</span>-------------<span class="hljs-code">+------------------------+</span>------------<span class="hljs-code">+---------------------+</span>---------+<br>2 rows in set (0.05 sec)<br></code></pre></td></tr></table></figure><p>ä¸<code>server_cost</code>ç›¸æ¯”ï¼Œ<code>engine_cost</code>å¤šäº†ä¸¤ä¸ªåˆ—ï¼š</p><ul><li><p><code>engine_name</code>åˆ—</p><p>æŒ‡æˆæœ¬å¸¸æ•°é€‚ç”¨çš„å­˜å‚¨å¼•æ“åç§°ã€‚å¦‚æœè¯¥å€¼ä¸º<code>default</code>ï¼Œæ„å‘³ç€å¯¹åº”çš„æˆæœ¬å¸¸æ•°é€‚ç”¨äºæ‰€æœ‰çš„å­˜å‚¨å¼•æ“ã€‚</p></li><li><p><code>device_type</code>åˆ—</p><p>æŒ‡å­˜å‚¨å¼•æ“ä½¿ç”¨çš„è®¾å¤‡ç±»å‹ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†åŒºåˆ†å¸¸è§„çš„æœºæ¢°ç¡¬ç›˜å’Œå›ºæ€ç¡¬ç›˜ï¼Œä¸è¿‡åœ¨<code>MySQL 5.7.21</code>è¿™ä¸ªç‰ˆæœ¬ä¸­å¹¶æ²¡æœ‰å¯¹æœºæ¢°ç¡¬ç›˜çš„æˆæœ¬å’Œå›ºæ€ç¡¬ç›˜çš„æˆæœ¬ä½œåŒºåˆ†ï¼Œæ‰€ä»¥è¯¥å€¼é»˜è®¤æ˜¯<code>0</code>ã€‚</p></li></ul><p>æˆ‘ä»¬ä»<code>engine_cost</code>è¡¨ä¸­çš„å†…å®¹å¯ä»¥çœ‹å‡ºæ¥ï¼Œç›®å‰æ”¯æŒçš„å­˜å‚¨å¼•æ“æˆæœ¬å¸¸æ•°åªæœ‰ä¸¤ä¸ªï¼š</p><table><thead><tr><th>æˆæœ¬å¸¸æ•°åç§°</th><th>é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>io_block_read_cost</code></td><td><code>1.0</code></td><td>ä»ç£ç›˜ä¸Šè¯»å–ä¸€ä¸ªå—å¯¹åº”çš„æˆæœ¬ã€‚è¯·æ³¨æ„æˆ‘ä½¿ç”¨çš„æ˜¯<code>å—</code>ï¼Œè€Œä¸æ˜¯<code>é¡µ</code>è¿™ä¸ªè¯å„¿ã€‚å¯¹äº<code>InnoDB</code>å­˜å‚¨å¼•æ“æ¥è¯´ï¼Œä¸€ä¸ª<code>é¡µ</code>å°±æ˜¯ä¸€ä¸ªå—ï¼Œä¸è¿‡å¯¹äº<code>MyISAM</code>å­˜å‚¨å¼•æ“æ¥è¯´ï¼Œé»˜è®¤æ˜¯ä»¥<code>4096</code>å­—èŠ‚ä½œä¸ºä¸€ä¸ªå—çš„ã€‚å¢å¤§è¿™ä¸ªå€¼ä¼šåŠ é‡<code>I/O</code>æˆæœ¬ï¼Œå¯èƒ½è®©ä¼˜åŒ–å™¨æ›´å€¾å‘äºé€‰æ‹©ä½¿ç”¨ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢è€Œä¸æ˜¯æ‰§è¡Œå…¨è¡¨æ‰«æã€‚</td></tr><tr><td><code>memory_block_read_cost</code></td><td><code>1.0</code></td><td>ä¸ä¸Šä¸€ä¸ªå‚æ•°ç±»ä¼¼ï¼Œåªä¸è¿‡è¡¡é‡çš„æ˜¯ä»å†…å­˜ä¸­è¯»å–ä¸€ä¸ªå—å¯¹åº”çš„æˆæœ¬ã€‚</td></tr></tbody></table><p>å¤§å®¶çœ‹å®Œè¿™ä¸¤ä¸ªæˆæœ¬å¸¸æ•°çš„é»˜è®¤å€¼æ˜¯ä¸æ˜¯æœ‰äº›ç–‘æƒ‘ï¼Œæ€ä¹ˆä»å†…å­˜ä¸­å’Œä»ç£ç›˜ä¸Šè¯»å–ä¸€ä¸ªå—çš„é»˜è®¤æˆæœ¬æ˜¯ä¸€æ ·çš„ï¼Œè„‘å­ç“¦ç‰¹äº†ï¼Ÿè¿™ä¸»è¦æ˜¯å› ä¸ºåœ¨<code>MySQL</code>ç›®å‰çš„å®ç°ä¸­ï¼Œå¹¶ä¸èƒ½å‡†ç¡®é¢„æµ‹æŸä¸ªæŸ¥è¯¢éœ€è¦è®¿é—®çš„å—ä¸­æœ‰å“ªäº›å—å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæœ‰å“ªäº›å—è¿˜åœç•™åœ¨ç£ç›˜ä¸Šï¼Œæ‰€ä»¥è®¾è®¡<code>MySQL</code>çš„å¤§å”ä»¬å¾ˆç²—æš´çš„è®¤ä¸ºä¸ç®¡è¿™ä¸ªå—æœ‰æ²¡æœ‰åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½¿ç”¨çš„æˆæœ¬éƒ½æ˜¯<code>1.0</code>ï¼Œä¸è¿‡éšç€<code>MySQL</code>çš„å‘å±•ï¼Œç­‰åˆ°å¯ä»¥å‡†ç¡®é¢„æµ‹å“ªäº›å—åœ¨ç£ç›˜ä¸Šï¼Œé‚£äº›å—åœ¨å†…å­˜ä¸­çš„é‚£ä¸€å¤©ï¼Œè¿™ä¸¤ä¸ªæˆæœ¬å¸¸æ•°çš„é»˜è®¤å€¼å¯èƒ½ä¼šæ”¹ä¸€æ”¹å§ã€‚</p><blockquote><p>åœ¨MySQL8.0+ç‰ˆæœ¬ä¸­ï¼Œ<code>io_block_read_cost</code>çš„é»˜è®¤å€¼ä»ä¸º1ï¼Œ<code>memory_block_read_cost</code>é»˜è®¤å€¼ä¸º0.25</p></blockquote><p>ä¸æ›´æ–°<code>server_cost</code>è¡¨ä¸­çš„è®°å½•ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ›´æ–°<code>engine_cost</code>è¡¨ä¸­çš„è®°å½•æ¥æ›´æ”¹å…³äºå­˜å‚¨å¼•æ“çš„æˆæœ¬å¸¸æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸º<code>engine_cost</code>è¡¨æ’å…¥æ–°è®°å½•çš„æ–¹å¼æ¥æ·»åŠ åªé’ˆå¯¹æŸç§å­˜å‚¨å¼•æ“çš„æˆæœ¬å¸¸æ•°ï¼š</p><ul><li><p>æ’å…¥é’ˆå¯¹æŸä¸ªå­˜å‚¨å¼•æ“çš„æˆæœ¬å¸¸æ•°</p><p>æ¯”å¦‚æˆ‘ä»¬æƒ³å¢å¤§<code>InnoDB</code>å­˜å‚¨å¼•æ“é¡µé¢<code>I/O</code>çš„æˆæœ¬ï¼Œä¹¦å†™æ­£å¸¸çš„æ’å…¥è¯­å¥å³å¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> mysql.engine_cost<br>    <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;InnoDB&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;io_block_read_cost&#x27;</span>, <span class="hljs-number">2.0</span>,<br>    <span class="hljs-built_in">CURRENT_TIMESTAMP</span>, <span class="hljs-string">&#x27;increase Innodb I/O cost&#x27;</span>);<br></code></pre></td></tr></table></figure></li><li><p>è®©ç³»ç»Ÿé‡æ–°åŠ è½½è¿™ä¸ªè¡¨çš„å€¼ã€‚</p><p>ä½¿ç”¨ä¸‹è¾¹è¯­å¥å³å¯ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">FLUSH OPTIMIZER_COSTS<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></li></ul><h1>13.InnoDB ç»Ÿè®¡æ•°æ®æ˜¯å¦‚ä½•æ”¶é›†çš„</h1><p>æˆ‘ä»¬å‰è¾¹å” å¨æŸ¥è¯¢æˆæœ¬çš„æ—¶å€™ç»å¸¸ç”¨åˆ°ä¸€äº›ç»Ÿè®¡æ•°æ®ï¼Œæ¯”å¦‚é€šè¿‡<code>SHOW TABLE STATUS</code>å¯ä»¥çœ‹åˆ°å…³äºè¡¨çš„ç»Ÿè®¡æ•°æ®ï¼Œé€šè¿‡<code>SHOW INDEX</code>å¯ä»¥çœ‹åˆ°å…³äºç´¢å¼•çš„ç»Ÿè®¡æ•°æ®ï¼Œé‚£ä¹ˆè¿™äº›ç»Ÿè®¡æ•°æ®æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿå®ƒä»¬æ˜¯ä»¥ä»€ä¹ˆæ–¹å¼æ”¶é›†çš„å‘¢ï¼Ÿæœ¬ç« å°†èšç„¦äº<code>InnoDB</code>å­˜å‚¨å¼•æ“çš„ç»Ÿè®¡æ•°æ®æ”¶é›†ç­–ç•¥ï¼Œçœ‹å®Œæœ¬ç« å¤§å®¶å°±ä¼šæ˜ç™½ä¸ºå•¥å‰è¾¹è€è¯´<code>InnoDB</code>çš„ç»Ÿè®¡ä¿¡æ¯æ˜¯ä¸ç²¾ç¡®çš„ä¼°è®¡å€¼äº†ï¼ˆè¨€ä¸‹ä¹‹æ„å°±æ˜¯æˆ‘ä»¬ä¸æ‰“ç®—ä»‹ç»<code>MyISAM</code>å­˜å‚¨å¼•æ“ç»Ÿè®¡æ•°æ®çš„æ”¶é›†å’Œå­˜å‚¨æ–¹å¼ï¼Œæœ‰æƒ³äº†è§£çš„åŒå­¦è‡ªå·±ä¸ªå„¿çœ‹çœ‹æ–‡æ¡£å“ˆï¼‰ã€‚</p><h2 id="ä¸¤ç§ä¸åŒçš„ç»Ÿè®¡æ•°æ®å­˜å‚¨æ–¹å¼">ä¸¤ç§ä¸åŒçš„ç»Ÿè®¡æ•°æ®å­˜å‚¨æ–¹å¼</h2><p><code>InnoDB</code>æä¾›äº†ä¸¤ç§å­˜å‚¨ç»Ÿè®¡æ•°æ®çš„æ–¹å¼ï¼š</p><ul><li><p>æ°¸ä¹…æ€§çš„ç»Ÿè®¡æ•°æ®</p><p>è¿™ç§ç»Ÿè®¡æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å™¨é‡å¯ä¹‹åè¿™äº›ç»Ÿè®¡æ•°æ®è¿˜åœ¨ã€‚</p></li><li><p>éæ°¸ä¹…æ€§çš„ç»Ÿè®¡æ•°æ®</p><p>è¿™ç§ç»Ÿè®¡æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå½“æœåŠ¡å™¨å…³é—­æ—¶è¿™äº›è¿™äº›ç»Ÿè®¡æ•°æ®å°±éƒ½è¢«æ¸…é™¤æ‰äº†ï¼Œç­‰åˆ°æœåŠ¡å™¨é‡å¯ä¹‹åï¼Œåœ¨æŸäº›é€‚å½“çš„åœºæ™¯ä¸‹æ‰ä¼šé‡æ–°æ”¶é›†è¿™äº›ç»Ÿè®¡æ•°æ®ã€‚</p></li></ul><p>è®¾è®¡<code>MySQL</code>çš„å¤§å”ä»¬ç»™æˆ‘ä»¬æä¾›äº†ç³»ç»Ÿå˜é‡<code>innodb_stats_persistent</code>æ¥æ§åˆ¶åˆ°åº•é‡‡ç”¨å“ªç§æ–¹å¼å»å­˜å‚¨ç»Ÿè®¡æ•°æ®ã€‚åœ¨<code>MySQL 5.6.6</code>ä¹‹å‰ï¼Œ<code>innodb_stats_persistent</code>çš„å€¼é»˜è®¤æ˜¯<code>OFF</code>ï¼Œä¹Ÿå°±æ˜¯è¯´<code>InnoDB</code>çš„ç»Ÿè®¡æ•°æ®é»˜è®¤æ˜¯å­˜å‚¨åˆ°å†…å­˜çš„ï¼Œä¹‹åçš„ç‰ˆæœ¬ä¸­<code>innodb_stats_persistent</code>çš„å€¼é»˜è®¤æ˜¯<code>ON</code>ï¼Œä¹Ÿå°±æ˜¯ç»Ÿè®¡æ•°æ®é»˜è®¤è¢«å­˜å‚¨åˆ°ç£ç›˜ä¸­ã€‚</p><p>ä¸è¿‡<code>InnoDB</code>é»˜è®¤æ˜¯ä»¥è¡¨ä¸ºå•ä½æ¥æ”¶é›†å’Œå­˜å‚¨ç»Ÿè®¡æ•°æ®çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æŠŠæŸäº›è¡¨çš„ç»Ÿè®¡æ•°æ®ï¼ˆä»¥åŠè¯¥è¡¨çš„ç´¢å¼•ç»Ÿè®¡æ•°æ®ï¼‰å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼ŒæŠŠå¦ä¸€äº›è¡¨çš„ç»Ÿè®¡æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºå’Œä¿®æ”¹è¡¨çš„æ—¶å€™é€šè¿‡æŒ‡å®š<code>STATS_PERSISTENT</code>å±æ€§æ¥æŒ‡æ˜è¯¥è¡¨çš„ç»Ÿè®¡æ•°æ®å­˜å‚¨æ–¹å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å (...) Engine<span class="hljs-operator">=</span>InnoDB, STATS_PERSISTENT <span class="hljs-operator">=</span> (<span class="hljs-number">1</span><span class="hljs-operator">|</span><span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å Engine<span class="hljs-operator">=</span>InnoDB, STATS_PERSISTENT <span class="hljs-operator">=</span> (<span class="hljs-number">1</span><span class="hljs-operator">|</span><span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>å½“<code>STATS_PERSISTENT=1</code>æ—¶ï¼Œè¡¨æ˜æˆ‘ä»¬æƒ³æŠŠè¯¥è¡¨çš„ç»Ÿè®¡æ•°æ®æ°¸ä¹…çš„å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼Œå½“<code>STATS_PERSISTENT=0</code>æ—¶ï¼Œè¡¨æ˜æˆ‘ä»¬æƒ³æŠŠè¯¥è¡¨çš„ç»Ÿè®¡æ•°æ®ä¸´æ—¶çš„å­˜å‚¨åˆ°å†…å­˜ä¸­ã€‚å¦‚æœæˆ‘ä»¬åœ¨åˆ›å»ºè¡¨æ—¶æœªæŒ‡å®š<code>STATS_PERSISTENT</code>å±æ€§ï¼Œé‚£é»˜è®¤é‡‡ç”¨ç³»ç»Ÿå˜é‡<code>innodb_stats_persistent</code>çš„å€¼ä½œä¸ºè¯¥å±æ€§çš„å€¼ã€‚</p><h2 id="åŸºäºç£ç›˜çš„æ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®">åŸºäºç£ç›˜çš„æ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®</h2><p>å½“æˆ‘ä»¬é€‰æ‹©æŠŠæŸä¸ªè¡¨ä»¥åŠè¯¥è¡¨ç´¢å¼•çš„ç»Ÿè®¡æ•°æ®å­˜æ”¾åˆ°ç£ç›˜ä¸Šæ—¶ï¼Œå®é™…ä¸Šæ˜¯æŠŠè¿™äº›ç»Ÿè®¡æ•°æ®å­˜å‚¨åˆ°äº†ä¸¤ä¸ªè¡¨é‡Œï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SHOW TABLES FROM mysql LIKE &#x27;innodb%&#x27;;</span><br><span class="hljs-section">+---------------------------+</span><br><span class="hljs-section">| Tables_in_mysql (innodb%) |</span><br><span class="hljs-section">+---------------------------+</span><br>| innodb<span class="hljs-emphasis">_index_stats        |</span><br><span class="hljs-emphasis">| innodb_table_</span>stats        |<br><span class="hljs-code">+---------------------------+</span><br>2 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªè¡¨éƒ½ä½äº<code>mysql</code>ç³»ç»Ÿæ•°æ®åº“ä¸‹è¾¹ï¼Œå…¶ä¸­ï¼š</p><ul><li><code>innodb_table_stats</code>å­˜å‚¨äº†å…³äºè¡¨çš„ç»Ÿè®¡æ•°æ®ï¼Œæ¯ä¸€æ¡è®°å½•å¯¹åº”ç€ä¸€ä¸ªè¡¨çš„ç»Ÿè®¡æ•°æ®ã€‚</li><li><code>innodb_index_stats</code>å­˜å‚¨äº†å…³äºç´¢å¼•çš„ç»Ÿè®¡æ•°æ®ï¼Œæ¯ä¸€æ¡è®°å½•å¯¹åº”ç€ä¸€ä¸ªç´¢å¼•çš„ä¸€ä¸ªç»Ÿè®¡é¡¹çš„ç»Ÿè®¡æ•°æ®ã€‚</li></ul><p>æˆ‘ä»¬ä¸‹è¾¹çš„ä»»åŠ¡å°±æ˜¯çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªè¡¨é‡Œè¾¹éƒ½æœ‰ä»€ä¹ˆä»¥åŠè¡¨é‡Œçš„æ•°æ®æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚</p><h3 id="innodb-table-stats">innodb_table_stats</h3><p>ç›´æ¥çœ‹ä¸€ä¸‹è¿™ä¸ª<code>innodb_table_stats</code>è¡¨ä¸­çš„å„ä¸ªåˆ—éƒ½æ˜¯å¹²å˜›çš„ï¼š</p><table><thead><tr><th>å­—æ®µå</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>database_name</code></td><td>æ•°æ®åº“å</td></tr><tr><td><code>table_name</code></td><td>è¡¨å</td></tr><tr><td><code>last_update</code></td><td>æœ¬æ¡è®°å½•æœ€åæ›´æ–°æ—¶é—´</td></tr><tr><td><code>n_rows</code></td><td>è¡¨ä¸­è®°å½•çš„æ¡æ•°</td></tr><tr><td><code>clustered_index_size</code></td><td>è¡¨çš„èšç°‡ç´¢å¼•å ç”¨çš„é¡µé¢æ•°é‡</td></tr><tr><td><code>sum_of_other_index_sizes</code></td><td>è¡¨çš„å…¶ä»–ç´¢å¼•å ç”¨çš„é¡µé¢æ•°é‡</td></tr></tbody></table><p>æ³¨æ„è¿™ä¸ªè¡¨çš„ä¸»é”®æ˜¯<code>(database_name,table_name)</code>ï¼Œä¹Ÿå°±æ˜¯innodb_table_statsè¡¨çš„æ¯æ¡è®°å½•ä»£è¡¨ç€ä¸€ä¸ªè¡¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚æˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªè¡¨é‡Œçš„å†…å®¹ï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; SELECT <span class="hljs-symbol">*</span> FROM mysql.innodb_table_stats;<br>+---------------+---------------+---------------------+--------+----------------------+--------------------------+<br>|<span class="hljs-string"> database_name </span>|<span class="hljs-string"> table_name    </span>|<span class="hljs-string"> last_update         </span>|<span class="hljs-string"> n_rows </span>|<span class="hljs-string"> clustered_index_size </span>|<span class="hljs-string"> sum_of_other_index_sizes </span>|<br>+---------------+---------------+---------------------+--------+----------------------+--------------------------+<br>|<span class="hljs-string"> mysql         </span>|<span class="hljs-string"> gtid_executed </span>|<span class="hljs-string"> 2018-07-10 23:51:36 </span>|<span class="hljs-string">      0 </span>|<span class="hljs-string">                    1 </span>|<span class="hljs-string">                        0 </span>|<br>|<span class="hljs-string"> sys           </span>|<span class="hljs-string"> sys_config    </span>|<span class="hljs-string"> 2018-07-10 23:51:38 </span>|<span class="hljs-string">      5 </span>|<span class="hljs-string">                    1 </span>|<span class="hljs-string">                        0 </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table  </span>|<span class="hljs-string"> 2018-12-10 17:03:13 </span>|<span class="hljs-string">   9693 </span>|<span class="hljs-string">                   97 </span>|<span class="hljs-string">                      175 </span>|<br>+---------------+---------------+---------------------+--------+----------------------+--------------------------+<br>3 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç†Ÿæ‚‰çš„<code>single_table</code>è¡¨çš„ç»Ÿè®¡ä¿¡æ¯å°±å¯¹åº”ç€<code>mysql.innodb_table_stats</code>çš„ç¬¬ä¸‰æ¡è®°å½•ã€‚å‡ ä¸ªé‡è¦ç»Ÿè®¡ä¿¡æ¯é¡¹çš„å€¼å¦‚ä¸‹ï¼š</p><ul><li><code>n_rows</code>çš„å€¼æ˜¯<code>9693</code>ï¼Œè¡¨æ˜<code>single_table</code>è¡¨ä¸­å¤§çº¦æœ‰<code>9693</code>æ¡è®°å½•ï¼Œæ³¨æ„è¿™ä¸ªæ•°æ®æ˜¯ä¼°è®¡å€¼ã€‚</li><li><code>clustered_index_size</code>çš„å€¼æ˜¯<code>97</code>ï¼Œè¡¨æ˜<code>single_table</code>è¡¨çš„èšç°‡ç´¢å¼•å ç”¨97ä¸ªé¡µé¢ï¼Œè¿™ä¸ªå€¼æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ã€‚</li><li><code>sum_of_other_index_sizes</code>çš„å€¼æ˜¯<code>175</code>ï¼Œè¡¨æ˜<code>single_table</code>è¡¨çš„å…¶ä»–ç´¢å¼•ä¸€å…±å ç”¨175ä¸ªé¡µé¢ï¼Œè¿™ä¸ªå€¼æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ã€‚</li></ul><h4 id="n-rowsç»Ÿè®¡é¡¹çš„æ”¶é›†">n_rowsç»Ÿè®¡é¡¹çš„æ”¶é›†</h4><p>ä¸ºå•¥è€å¼ºè°ƒ<code>n_rows</code>è¿™ä¸ªç»Ÿè®¡é¡¹çš„å€¼æ˜¯ä¼°è®¡å€¼å‘¢ï¼Ÿç°åœ¨å°±æ¥æ­æ™“ç­”æ¡ˆã€‚<code>InnoDB</code>ç»Ÿè®¡ä¸€ä¸ªè¡¨ä¸­æœ‰å¤šå°‘è¡Œè®°å½•çš„å¥—è·¯æ˜¯è¿™æ ·çš„ï¼š</p><ul><li><p>æŒ‰ç…§ä¸€å®šç®—æ³•ï¼ˆå¹¶ä¸æ˜¯çº¯ç²¹éšæœºçš„ï¼‰é€‰å–å‡ ä¸ªå¶å­èŠ‚ç‚¹é¡µé¢ï¼Œè®¡ç®—æ¯ä¸ªé¡µé¢ä¸­ä¸»é”®å€¼è®°å½•æ•°é‡ï¼Œç„¶åè®¡ç®—å¹³å‡ä¸€ä¸ªé¡µé¢ä¸­ä¸»é”®å€¼çš„è®°å½•æ•°é‡ä¹˜ä»¥å…¨éƒ¨å¶å­èŠ‚ç‚¹çš„æ•°é‡å°±ç®—æ˜¯è¯¥è¡¨çš„<code>n_rows</code>å€¼ã€‚</p><blockquote><p>å°è´´å£«ï¼š çœŸå®çš„è®¡ç®—è¿‡ç¨‹æ¯”è¿™ä¸ªç¨å¾®å¤æ‚ä¸€äº›ï¼Œä¸è¿‡å¤§è‡´ä¸Šå°±æ˜¯è¿™æ ·çš„å•¦ï½</p></blockquote><p>å¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ª<code>n_rows</code>å€¼ç²¾ç¡®ä¸å¦å–å†³äºç»Ÿè®¡æ—¶é‡‡æ ·çš„é¡µé¢æ•°é‡ï¼Œè®¾è®¡<code>MySQL</code>çš„å¤§å”å¾ˆè´´å¿ƒçš„ä¸ºæˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªåä¸º<code>innodb_stats_persistent_sample_pages</code>çš„ç³»ç»Ÿå˜é‡æ¥æ§åˆ¶ä½¿ç”¨æ°¸ä¹…æ€§çš„ç»Ÿè®¡æ•°æ®æ—¶ï¼Œè®¡ç®—ç»Ÿè®¡æ•°æ®æ—¶é‡‡æ ·çš„é¡µé¢æ•°é‡ã€‚è¯¥å€¼è®¾ç½®çš„è¶Šå¤§ï¼Œç»Ÿè®¡å‡ºçš„<code>n_rows</code>å€¼è¶Šç²¾ç¡®ï¼Œä½†æ˜¯ç»Ÿè®¡è€—æ—¶ä¹Ÿå°±æœ€ä¹…ï¼›è¯¥å€¼è®¾ç½®çš„è¶Šå°ï¼Œç»Ÿè®¡å‡ºçš„<code>n_rows</code>å€¼è¶Šä¸ç²¾ç¡®ï¼Œä½†æ˜¯ç»Ÿè®¡è€—æ—¶ç‰¹åˆ«å°‘ã€‚æ‰€ä»¥åœ¨å®é™…ä½¿ç”¨æ˜¯éœ€è¦æˆ‘ä»¬å»æƒè¡¡åˆ©å¼Šï¼Œè¯¥ç³»ç»Ÿå˜é‡çš„é»˜è®¤å€¼æ˜¯<code>20</code>ã€‚</p><p>æˆ‘ä»¬å‰è¾¹è¯´è¿‡ï¼Œä¸è¿‡<code>InnoDB</code>é»˜è®¤æ˜¯ä»¥è¡¨ä¸ºå•ä½æ¥æ”¶é›†å’Œå­˜å‚¨ç»Ÿè®¡æ•°æ®çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬è®¾ç½®æŸä¸ªè¡¨çš„é‡‡æ ·é¡µé¢çš„æ•°é‡ï¼Œè®¾ç½®æ–¹å¼å°±æ˜¯åœ¨åˆ›å»ºæˆ–ä¿®æ”¹è¡¨çš„æ—¶å€™é€šè¿‡æŒ‡å®š<code>STATS_SAMPLE_PAGES</code>å±æ€§æ¥æŒ‡æ˜è¯¥è¡¨çš„ç»Ÿè®¡æ•°æ®å­˜å‚¨æ–¹å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å (...) Engine<span class="hljs-operator">=</span>InnoDB, STATS_SAMPLE_PAGES <span class="hljs-operator">=</span> å…·ä½“çš„é‡‡æ ·é¡µé¢æ•°é‡;<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å Engine<span class="hljs-operator">=</span>InnoDB, STATS_SAMPLE_PAGES <span class="hljs-operator">=</span> å…·ä½“çš„é‡‡æ ·é¡µé¢æ•°é‡;<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬åœ¨åˆ›å»ºè¡¨çš„è¯­å¥ä¸­å¹¶æ²¡æœ‰æŒ‡å®š<code>STATS_SAMPLE_PAGES</code>å±æ€§çš„è¯ï¼Œå°†é»˜è®¤ä½¿ç”¨ç³»ç»Ÿå˜é‡<code>innodb_stats_persistent_sample_pages</code>çš„å€¼ä½œä¸ºè¯¥å±æ€§çš„å€¼ã€‚</p></li></ul><h4 id="clustered-index-sizeå’Œsum-of-other-index-sizesç»Ÿè®¡é¡¹çš„æ”¶é›†">clustered_index_sizeå’Œsum_of_other_index_sizesç»Ÿè®¡é¡¹çš„æ”¶é›†</h4><p>ç»Ÿè®¡è¿™ä¸¤ä¸ªæ•°æ®éœ€è¦å¤§é‡ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰å” å¨çš„<code>InnoDB</code>è¡¨ç©ºé—´çš„çŸ¥è¯†ï¼Œå¦‚æœå¤§å®¶å‹æ ¹å„¿æ²¡æœ‰çœ‹é‚£ä¸€ç« ï¼Œé‚£ä¸‹è¾¹çš„è®¡ç®—è¿‡ç¨‹å¤§å®¶è¿˜æ˜¯ä¸è¦çœ‹äº†ï¼ˆçœ‹ä¹Ÿçœ‹ä¸æ‡‚ï¼‰ï¼›å¦‚æœçœ‹è¿‡äº†ï¼Œé‚£å¤§å®¶å°±ä¼šå‘ç°<code>InnoDB</code>è¡¨ç©ºé—´çš„çŸ¥è¯†çœŸæ˜¯æœ‰ç”¨å•Šå•Šå•Šï¼ï¼ï¼</p><p>è¿™ä¸¤ä¸ªç»Ÿè®¡é¡¹çš„æ”¶é›†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>ä»æ•°æ®å­—å…¸é‡Œæ‰¾åˆ°è¡¨çš„å„ä¸ªç´¢å¼•å¯¹åº”çš„æ ¹é¡µé¢ä½ç½®ã€‚</p><p>ç³»ç»Ÿè¡¨<code>SYS_INDEXES</code>é‡Œå­˜å‚¨äº†å„ä¸ªç´¢å¼•å¯¹åº”çš„æ ¹é¡µé¢ä¿¡æ¯ã€‚</p></li><li><p>ä»æ ¹é¡µé¢çš„<code>Page Header</code>é‡Œæ‰¾åˆ°å¶å­èŠ‚ç‚¹æ®µå’Œéå¶å­èŠ‚ç‚¹æ®µå¯¹åº”çš„<code>Segment Header</code>ã€‚</p><p>åœ¨æ¯ä¸ªç´¢å¼•çš„æ ¹é¡µé¢çš„<code>Page Header</code>éƒ¨åˆ†éƒ½æœ‰ä¸¤ä¸ªå­—æ®µï¼š</p><ul><li><code>PAGE_BTR_SEG_LEAF</code>ï¼šè¡¨ç¤ºB+æ ‘å¶å­æ®µçš„<code>Segment Header</code>ä¿¡æ¯ã€‚</li><li><code>PAGE_BTR_SEG_TOP</code>ï¼šè¡¨ç¤ºB+æ ‘éå¶å­æ®µçš„<code>Segment Header</code>ä¿¡æ¯ã€‚</li></ul></li><li><p>ä»å¶å­èŠ‚ç‚¹æ®µå’Œéå¶å­èŠ‚ç‚¹æ®µçš„<code>Segment Header</code>ä¸­æ‰¾åˆ°è¿™ä¸¤ä¸ªæ®µå¯¹åº”çš„<code>INODE Entry</code>ç»“æ„ã€‚</p><p>è¿™ä¸ªæ˜¯<code>Segment Header</code>ç»“æ„ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/167e94d5b165a91f~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cum7dbc812843ac192pfik1raep.png-107.3kB"></li><li><p>ä»å¯¹åº”çš„<code>INODE Entry</code>ç»“æ„ä¸­å¯ä»¥æ‰¾åˆ°è¯¥æ®µå¯¹åº”æ‰€æœ‰é›¶æ•£çš„é¡µé¢åœ°å€ä»¥åŠ<code>FREE</code>ã€<code>NOT_FULL</code>ã€<code>FULL</code>é“¾è¡¨çš„åŸºèŠ‚ç‚¹ã€‚</p><p>è¿™ä¸ªæ˜¯<code>INODE Entry</code>ç»“æ„ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/167e94d5b1e44524~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cum7f49h1beg5uccbq197n1g1b16.png-173.9kB"></li><li><p>ç›´æ¥ç»Ÿè®¡é›¶æ•£çš„é¡µé¢æœ‰å¤šå°‘ä¸ªï¼Œç„¶åä»é‚£ä¸‰ä¸ªé“¾è¡¨çš„<code>List Length</code>å­—æ®µä¸­è¯»å‡ºè¯¥æ®µå ç”¨çš„åŒºçš„å¤§å°ï¼Œæ¯ä¸ªåŒºå ç”¨<code>64</code>ä¸ªé¡µï¼Œæ‰€ä»¥å°±å¯ä»¥ç»Ÿè®¡å‡ºæ•´ä¸ªæ®µå ç”¨çš„é¡µé¢ã€‚</p><p>è¿™ä¸ªæ˜¯é“¾è¡¨åŸºèŠ‚ç‚¹çš„ç¤ºæ„å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/11/29/MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/167e94d5b17c24e3~tplv-t2oaga2asx-watermark.awebp" class="" title="image_1cum7hkiihikm4b88j10461plc1j.png-129.9kB"></li><li><p>åˆ†åˆ«è®¡ç®—èšç°‡ç´¢å¼•çš„å¶å­ç»“ç‚¹æ®µå’Œéå¶å­èŠ‚ç‚¹æ®µå ç”¨çš„é¡µé¢æ•°ï¼Œå®ƒä»¬çš„å’Œå°±æ˜¯<code>clustered_index_size</code>çš„å€¼ï¼ŒæŒ‰ç…§åŒæ ·çš„å¥—è·¯æŠŠå…¶ä½™ç´¢å¼•å ç”¨çš„é¡µé¢æ•°éƒ½ç®—å‡ºæ¥ï¼ŒåŠ èµ·æ¥ä¹‹åå°±æ˜¯<code>sum_of_other_index_sizes</code>çš„å€¼ã€‚</p></li></ul><p>è¿™é‡Œéœ€è¦å¤§å®¶æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¯´ä¸€ä¸ªæ®µçš„æ•°æ®åœ¨éå¸¸å¤šæ—¶ï¼ˆè¶…è¿‡32ä¸ªé¡µé¢ï¼‰ï¼Œä¼šä»¥<code>åŒº</code>ä¸ºå•ä½æ¥ç”³è¯·ç©ºé—´ï¼Œè¿™é‡Œå¤´çš„é—®é¢˜æ˜¯ä»¥åŒºä¸ºå•ä½ç”³è¯·ç©ºé—´ä¸­æœ‰ä¸€äº›é¡µå¯èƒ½å¹¶æ²¡æœ‰ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨ç»Ÿè®¡<code>clustered_index_size</code>å’Œ<code>sum_of_other_index_sizes</code>æ—¶éƒ½æŠŠå®ƒä»¬ç®—è¿›å»äº†ï¼Œæ‰€ä»¥è¯´èšç°‡ç´¢å¼•å’Œå…¶ä»–çš„ç´¢å¼•å ç”¨çš„é¡µé¢æ•°å¯èƒ½æ¯”è¿™ä¸¤ä¸ªå€¼è¦å°ä¸€äº›ã€‚</p><h3 id="innodb-index-stats">innodb_index_stats</h3><p>ç›´æ¥çœ‹ä¸€ä¸‹è¿™ä¸ª<code>innodb_index_stats</code>è¡¨ä¸­çš„å„ä¸ªåˆ—éƒ½æ˜¯å¹²å˜›çš„ï¼š</p><table><thead><tr><th>å­—æ®µå</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>database_name</code></td><td>æ•°æ®åº“å</td></tr><tr><td><code>table_name</code></td><td>è¡¨å</td></tr><tr><td><code>index_name</code></td><td>ç´¢å¼•å</td></tr><tr><td><code>last_update</code></td><td>æœ¬æ¡è®°å½•æœ€åæ›´æ–°æ—¶é—´</td></tr><tr><td><code>stat_name</code></td><td>ç»Ÿè®¡é¡¹çš„åç§°</td></tr><tr><td><code>stat_value</code></td><td>å¯¹åº”çš„ç»Ÿè®¡é¡¹çš„å€¼</td></tr><tr><td><code>sample_size</code></td><td>ä¸ºç”Ÿæˆç»Ÿè®¡æ•°æ®è€Œé‡‡æ ·çš„é¡µé¢æ•°é‡</td></tr><tr><td><code>stat_description</code></td><td>å¯¹åº”çš„ç»Ÿè®¡é¡¹çš„æè¿°</td></tr></tbody></table><p>æ³¨æ„è¿™ä¸ªè¡¨çš„ä¸»é”®æ˜¯<code>(database_name,table_name,index_name,stat_name)</code>ï¼Œå…¶ä¸­çš„<code>stat_name</code>æ˜¯æŒ‡ç»Ÿè®¡é¡¹çš„åç§°ï¼Œä¹Ÿå°±æ˜¯è¯´innodb_index_statsè¡¨çš„æ¯æ¡è®°å½•ä»£è¡¨ç€ä¸€ä¸ªç´¢å¼•çš„ä¸€ä¸ªç»Ÿè®¡é¡¹ã€‚å¯èƒ½è¿™ä¼šå¤§å®¶æœ‰äº›æ‡µé€¼è¿™ä¸ªç»Ÿè®¡é¡¹åˆ°åº•æŒ‡ä»€ä¹ˆï¼Œåˆ«ç€æ€¥ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸‹å…³äº<code>single_table</code>è¡¨çš„ç´¢å¼•ç»Ÿè®¡æ•°æ®éƒ½æœ‰äº›ä»€ä¹ˆï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; SELECT <span class="hljs-symbol">*</span> FROM mysql.innodb_index_stats WHERE table_name = &#x27;single_table&#x27;;<br>+---------------+--------------+--------------+---------------------+--------------+------------+-------------+-----------------------------------+<br>|<span class="hljs-string"> database_name </span>|<span class="hljs-string"> table_name   </span>|<span class="hljs-string"> index_name   </span>|<span class="hljs-string"> last_update         </span>|<span class="hljs-string"> stat_name    </span>|<span class="hljs-string"> stat_value </span>|<span class="hljs-string"> sample_size </span>|<span class="hljs-string"> stat_description                  </span>|<br>+---------------+--------------+--------------+---------------------+--------------+------------+-------------+-----------------------------------+<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> PRIMARY      </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_diff_pfx01 </span>|<span class="hljs-string">       9693 </span>|<span class="hljs-string">          20 </span>|<span class="hljs-string"> id                                </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> PRIMARY      </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_leaf_pages </span>|<span class="hljs-string">         91 </span>|<span class="hljs-string">        NULL </span>|<span class="hljs-string"> Number of leaf pages in the index </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> PRIMARY      </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> size         </span>|<span class="hljs-string">         97 </span>|<span class="hljs-string">        NULL </span>|<span class="hljs-string"> Number of pages in the index      </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key1     </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_diff_pfx01 </span>|<span class="hljs-string">        968 </span>|<span class="hljs-string">          28 </span>|<span class="hljs-string"> key1                              </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key1     </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_diff_pfx02 </span>|<span class="hljs-string">      10000 </span>|<span class="hljs-string">          28 </span>|<span class="hljs-string"> key1,id                           </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key1     </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_leaf_pages </span>|<span class="hljs-string">         28 </span>|<span class="hljs-string">        NULL </span>|<span class="hljs-string"> Number of leaf pages in the index </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key1     </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> size         </span>|<span class="hljs-string">         29 </span>|<span class="hljs-string">        NULL </span>|<span class="hljs-string"> Number of pages in the index      </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key2     </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_diff_pfx01 </span>|<span class="hljs-string">      10000 </span>|<span class="hljs-string">          16 </span>|<span class="hljs-string"> key2                              </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key2     </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_leaf_pages </span>|<span class="hljs-string">         16 </span>|<span class="hljs-string">        NULL </span>|<span class="hljs-string"> Number of leaf pages in the index </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key2     </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> size         </span>|<span class="hljs-string">         17 </span>|<span class="hljs-string">        NULL </span>|<span class="hljs-string"> Number of pages in the index      </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key3     </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_diff_pfx01 </span>|<span class="hljs-string">        799 </span>|<span class="hljs-string">          31 </span>|<span class="hljs-string"> key3                              </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key3     </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_diff_pfx02 </span>|<span class="hljs-string">      10000 </span>|<span class="hljs-string">          31 </span>|<span class="hljs-string"> key3,id                           </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key3     </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_leaf_pages </span>|<span class="hljs-string">         31 </span>|<span class="hljs-string">        NULL </span>|<span class="hljs-string"> Number of leaf pages in the index </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key3     </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> size         </span>|<span class="hljs-string">         32 </span>|<span class="hljs-string">        NULL </span>|<span class="hljs-string"> Number of pages in the index      </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key_part </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_diff_pfx01 </span>|<span class="hljs-string">       9673 </span>|<span class="hljs-string">          64 </span>|<span class="hljs-string"> key_part1                         </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key_part </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_diff_pfx02 </span>|<span class="hljs-string">       9999 </span>|<span class="hljs-string">          64 </span>|<span class="hljs-string"> key_part1,key_part2               </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key_part </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_diff_pfx03 </span>|<span class="hljs-string">      10000 </span>|<span class="hljs-string">          64 </span>|<span class="hljs-string"> key_part1,key_part2,key_part3     </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key_part </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_diff_pfx04 </span>|<span class="hljs-string">      10000 </span>|<span class="hljs-string">          64 </span>|<span class="hljs-string"> key_part1,key_part2,key_part3,id  </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key_part </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> n_leaf_pages </span>|<span class="hljs-string">         64 </span>|<span class="hljs-string">        NULL </span>|<span class="hljs-string"> Number of leaf pages in the index </span>|<br>|<span class="hljs-string"> xiaohaizi     </span>|<span class="hljs-string"> single_table </span>|<span class="hljs-string"> idx_key_part </span>|<span class="hljs-string"> 2018-12-14 14:24:46 </span>|<span class="hljs-string"> size         </span>|<span class="hljs-string">         97 </span>|<span class="hljs-string">        NULL </span>|<span class="hljs-string"> Number of pages in the index      </span>|<br>+---------------+--------------+--------------+---------------------+--------------+------------+-------------+-----------------------------------+<br>20 rows in set (0.03 sec)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç»“æœæœ‰ç‚¹å„¿å¤šï¼Œæ­£ç¡®æŸ¥çœ‹è¿™ä¸ªç»“æœçš„æ–¹å¼æ˜¯è¿™æ ·çš„ï¼š</p><ul><li><p>å…ˆæŸ¥çœ‹<code>index_name</code>åˆ—ï¼Œè¿™ä¸ªåˆ—è¯´æ˜è¯¥è®°å½•æ˜¯å“ªä¸ªç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä»ç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>PRIMARY</code>ç´¢å¼•ï¼ˆä¹Ÿå°±æ˜¯ä¸»é”®ï¼‰å äº†3æ¡è®°å½•ï¼Œ<code>idx_key_part</code>ç´¢å¼•å äº†6æ¡è®°å½•ã€‚</p></li><li><p>é’ˆå¯¹<code>index_name</code>åˆ—ç›¸åŒçš„è®°å½•ï¼Œ<code>stat_name</code>è¡¨ç¤ºé’ˆå¯¹è¯¥ç´¢å¼•çš„ç»Ÿè®¡é¡¹åç§°ï¼Œ<code>stat_value</code>å±•ç¤ºçš„æ˜¯è¯¥ç´¢å¼•åœ¨è¯¥ç»Ÿè®¡é¡¹ä¸Šçš„å€¼ï¼Œ<code>stat_description</code>æŒ‡çš„æ˜¯æ¥æè¿°è¯¥ç»Ÿè®¡é¡¹çš„å«ä¹‰çš„ã€‚æˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸€ä¸‹ä¸€ä¸ªç´¢å¼•éƒ½æœ‰å“ªäº›ç»Ÿè®¡é¡¹ï¼š</p><ul><li><p><code>n_leaf_pages</code>ï¼šè¡¨ç¤ºè¯¥ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å ç”¨å¤šå°‘é¡µé¢ã€‚</p></li><li><p><code>size</code>ï¼šè¡¨ç¤ºè¯¥ç´¢å¼•å…±å ç”¨å¤šå°‘é¡µé¢ã€‚</p></li><li><p><code>n_diff_pfx**NN**</code>ï¼šè¡¨ç¤ºå¯¹åº”çš„ç´¢å¼•åˆ—ä¸é‡å¤çš„å€¼æœ‰å¤šå°‘ã€‚å…¶ä¸­çš„<code>NN</code>é•¿å¾—æœ‰ç‚¹å„¿æ€ªå‘€ï¼Œå•¥æ„æ€å‘¢ï¼Ÿ</p><p>å…¶å®<code>NN</code>å¯ä»¥è¢«æ›¿æ¢ä¸º<code>01</code>ã€<code>02</code>ã€<code>03</code>â€¦ è¿™æ ·çš„æ•°å­—ã€‚æ¯”å¦‚å¯¹äº<code>idx_key_part</code>æ¥è¯´ï¼š</p><ul><li><code>n_diff_pfx01</code>è¡¨ç¤ºçš„æ˜¯ç»Ÿè®¡<code>key_part1</code>è¿™å•å•ä¸€ä¸ªåˆ—ä¸é‡å¤çš„å€¼æœ‰å¤šå°‘ã€‚</li><li><code>n_diff_pfx02</code>è¡¨ç¤ºçš„æ˜¯ç»Ÿè®¡<code>key_part1ã€key_part2</code>è¿™ä¸¤ä¸ªåˆ—ç»„åˆèµ·æ¥ä¸é‡å¤çš„å€¼æœ‰å¤šå°‘ã€‚</li><li><code>n_diff_pfx03</code>è¡¨ç¤ºçš„æ˜¯ç»Ÿè®¡<code>key_part1ã€key_part2ã€key_part3</code>è¿™ä¸‰ä¸ªåˆ—ç»„åˆèµ·æ¥ä¸é‡å¤çš„å€¼æœ‰å¤šå°‘ã€‚</li><li><code>n_diff_pfx04</code>è¡¨ç¤ºçš„æ˜¯ç»Ÿè®¡<code>key_part1ã€key_part2ã€key_part3ã€id</code>è¿™å››ä¸ªåˆ—ç»„åˆèµ·æ¥ä¸é‡å¤çš„å€¼æœ‰å¤šå°‘ã€‚</li></ul><blockquote><p>å°è´´å£«ï¼š è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºæ™®é€šçš„äºŒçº§ç´¢å¼•ï¼Œå¹¶ä¸èƒ½ä¿è¯å®ƒçš„ç´¢å¼•åˆ—å€¼æ˜¯å”¯ä¸€çš„ï¼Œæ¯”å¦‚å¯¹äºidx_key1æ¥è¯´ï¼Œkey1åˆ—å°±å¯èƒ½æœ‰å¾ˆå¤šå€¼é‡å¤çš„è®°å½•ã€‚æ­¤æ—¶åªæœ‰åœ¨ç´¢å¼•åˆ—ä¸ŠåŠ ä¸Šä¸»é”®å€¼æ‰å¯ä»¥åŒºåˆ†ä¸¤æ¡ç´¢å¼•åˆ—å€¼éƒ½ä¸€æ ·çš„äºŒçº§ç´¢å¼•è®°å½•ã€‚å¯¹äºä¸»é”®å’Œå”¯ä¸€äºŒçº§ç´¢å¼•åˆ™æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå®ƒä»¬æœ¬èº«å°±å¯ä»¥ä¿è¯ç´¢å¼•åˆ—å€¼çš„ä¸é‡å¤ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦å†ç»Ÿè®¡ä¸€éåœ¨ç´¢å¼•åˆ—ååŠ ä¸Šä¸»é”®å€¼çš„ä¸é‡å¤å€¼æœ‰å¤šå°‘ã€‚æ¯”å¦‚ä¸Šè¾¹çš„idx_key1æœ‰n_diff_pfx01ã€n_diff_pfx02ä¸¤ä¸ªç»Ÿè®¡é¡¹ï¼Œè€Œidx_key2å´åªæœ‰n_diff_pfx01ä¸€ä¸ªç»Ÿè®¡é¡¹ã€‚</p></blockquote></li></ul></li><li><p>åœ¨è®¡ç®—æŸäº›ç´¢å¼•åˆ—ä¸­åŒ…å«å¤šå°‘ä¸é‡å¤å€¼æ—¶ï¼Œéœ€è¦å¯¹ä¸€äº›å¶å­èŠ‚ç‚¹é¡µé¢è¿›è¡Œé‡‡æ ·ï¼Œ<code>sample_size</code>åˆ—å°±è¡¨æ˜äº†é‡‡æ ·çš„é¡µé¢æ•°é‡æ˜¯å¤šå°‘ã€‚</p><blockquote><p>å°è´´å£«ï¼š å¯¹äºæœ‰å¤šä¸ªåˆ—çš„è”åˆç´¢å¼•æ¥è¯´ï¼Œé‡‡æ ·çš„é¡µé¢æ•°é‡æ˜¯ï¼šinnodb_stats_persistent_sample_pages Ã— ç´¢å¼•åˆ—çš„ä¸ªæ•°ã€‚å½“éœ€è¦é‡‡æ ·çš„é¡µé¢æ•°é‡å¤§äºè¯¥ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ•°é‡çš„è¯ï¼Œå°±ç›´æ¥é‡‡ç”¨å…¨è¡¨æ‰«ææ¥ç»Ÿè®¡ç´¢å¼•åˆ—çš„ä¸é‡å¤å€¼æ•°é‡äº†ã€‚æ‰€ä»¥å¤§å®¶å¯ä»¥åœ¨æŸ¥è¯¢ç»“æœä¸­çœ‹åˆ°ä¸åŒç´¢å¼•å¯¹åº”çš„sizeåˆ—çš„å€¼å¯èƒ½æ˜¯ä¸åŒçš„ã€‚</p></blockquote></li></ul><h3 id="å®šæœŸæ›´æ–°ç»Ÿè®¡æ•°æ®">å®šæœŸæ›´æ–°ç»Ÿè®¡æ•°æ®</h3><p>éšç€æˆ‘ä»¬ä¸æ–­çš„å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æ“ä½œï¼Œè¡¨ä¸­çš„æ•°æ®ä¹Ÿä¸€ç›´åœ¨å˜åŒ–ï¼Œ<code>innodb_table_stats</code>å’Œ<code>innodb_index_stats</code>è¡¨é‡Œçš„ç»Ÿè®¡æ•°æ®æ˜¯ä¸æ˜¯ä¹Ÿåº”è¯¥è·Ÿç€å˜ä¸€å˜äº†ï¼Ÿå½“ç„¶è¦å˜äº†ï¼Œä¸å˜çš„è¯<code>MySQL</code>æŸ¥è¯¢ä¼˜åŒ–å™¨è®¡ç®—çš„æˆæœ¬å¯å°±å·®è€é¼»å­è¿œäº†ã€‚è®¾è®¡<code>MySQL</code>çš„å¤§å”æä¾›äº†å¦‚ä¸‹ä¸¤ç§æ›´æ–°ç»Ÿè®¡æ•°æ®çš„æ–¹å¼ï¼š</p><ul><li><p>å¼€å¯<code>innodb_stats_auto_recalc</code>ã€‚</p><p>ç³»ç»Ÿå˜é‡<code>innodb_stats_auto_recalc</code>å†³å®šç€æœåŠ¡å™¨æ˜¯å¦è‡ªåŠ¨é‡æ–°è®¡ç®—ç»Ÿè®¡æ•°æ®ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯<code>ON</code>ï¼Œä¹Ÿå°±æ˜¯è¯¥åŠŸèƒ½é»˜è®¤æ˜¯å¼€å¯çš„ã€‚æ¯ä¸ªè¡¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡è®°å½•ç€å¯¹è¯¥è¡¨è¿›è¡Œå¢åˆ æ”¹çš„è®°å½•æ¡æ•°ï¼Œå¦‚æœå‘ç”Ÿå˜åŠ¨çš„è®°å½•æ•°é‡è¶…è¿‡äº†è¡¨å¤§å°çš„<code>10%</code>ï¼Œå¹¶ä¸”è‡ªåŠ¨é‡æ–°è®¡ç®—ç»Ÿè®¡æ•°æ®çš„åŠŸèƒ½æ˜¯æ‰“å¼€çš„ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šé‡æ–°è¿›è¡Œä¸€æ¬¡ç»Ÿè®¡æ•°æ®çš„è®¡ç®—ï¼Œå¹¶ä¸”æ›´æ–°<code>innodb_table_stats</code>å’Œ<code>innodb_index_stats</code>è¡¨ã€‚ä¸è¿‡è‡ªåŠ¨é‡æ–°è®¡ç®—ç»Ÿè®¡æ•°æ®çš„è¿‡ç¨‹æ˜¯å¼‚æ­¥å‘ç”Ÿçš„ï¼Œä¹Ÿå°±æ˜¯å³ä½¿è¡¨ä¸­å˜åŠ¨çš„è®°å½•æ•°è¶…è¿‡äº†<code>10%</code>ï¼Œè‡ªåŠ¨é‡æ–°è®¡ç®—ç»Ÿè®¡æ•°æ®ä¹Ÿä¸ä¼šç«‹å³å‘ç”Ÿï¼Œå¯èƒ½ä¼šå»¶è¿Ÿå‡ ç§’æ‰ä¼šè¿›è¡Œè®¡ç®—ã€‚</p><p>å†ä¸€æ¬¡å¼ºè°ƒï¼Œ<code>InnoDB</code>é»˜è®¤æ˜¯ä»¥è¡¨ä¸ºå•ä½æ¥æ”¶é›†å’Œå­˜å‚¨ç»Ÿè®¡æ•°æ®çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬ä¸ºæŸä¸ªè¡¨è®¾ç½®æ˜¯å¦è‡ªåŠ¨é‡æ–°è®¡ç®—ç»Ÿè®¡æ•°çš„å±æ€§ï¼Œè®¾ç½®æ–¹å¼å°±æ˜¯åœ¨åˆ›å»ºæˆ–ä¿®æ”¹è¡¨çš„æ—¶å€™é€šè¿‡æŒ‡å®š<code>STATS_AUTO_RECALC</code>å±æ€§æ¥æŒ‡æ˜è¯¥è¡¨çš„ç»Ÿè®¡æ•°æ®å­˜å‚¨æ–¹å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å (...) Engine<span class="hljs-operator">=</span>InnoDB, STATS_AUTO_RECALC <span class="hljs-operator">=</span> (<span class="hljs-number">1</span><span class="hljs-operator">|</span><span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å Engine<span class="hljs-operator">=</span>InnoDB, STATS_AUTO_RECALC <span class="hljs-operator">=</span> (<span class="hljs-number">1</span><span class="hljs-operator">|</span><span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>å½“<code>STATS_AUTO_RECALC=1</code>æ—¶ï¼Œè¡¨æ˜æˆ‘ä»¬æƒ³è®©è¯¥è¡¨è‡ªåŠ¨é‡æ–°è®¡ç®—ç»Ÿè®¡æ•°æ®ï¼Œå½“<code>STATS_AUTO_RECALC=0</code>æ—¶ï¼Œè¡¨æ˜ä¸æƒ³è®©è¯¥è¡¨è‡ªåŠ¨é‡æ–°è®¡ç®—ç»Ÿè®¡æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬åœ¨åˆ›å»ºè¡¨æ—¶æœªæŒ‡å®š<code>STATS_AUTO_RECALC</code>å±æ€§ï¼Œé‚£é»˜è®¤é‡‡ç”¨ç³»ç»Ÿå˜é‡<code>innodb_stats_auto_recalc</code>çš„å€¼ä½œä¸ºè¯¥å±æ€§çš„å€¼ã€‚</p></li><li><p>æ‰‹åŠ¨è°ƒç”¨<code>ANALYZE TABLE</code>è¯­å¥æ¥æ›´æ–°ç»Ÿè®¡ä¿¡æ¯</p><p>å¦‚æœ<code>innodb_stats_auto_recalc</code>ç³»ç»Ÿå˜é‡çš„å€¼ä¸º<code>OFF</code>çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨è°ƒç”¨<code>ANALYZE TABLE</code>è¯­å¥æ¥é‡æ–°è®¡ç®—ç»Ÿè®¡æ•°æ®ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·æ›´æ–°å…³äº<code>single_table</code>è¡¨çš„ç»Ÿè®¡æ•°æ®ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; ANALYZE TABLE single_table;</span><br><span class="hljs-section">+------------------------+---------+----------+----------+</span><br><span class="hljs-section">| Table                  | Op      | Msg_type | Msg_text |</span><br><span class="hljs-section">+------------------------+---------+----------+----------+</span><br><span class="hljs-section">| xiaohaizi.single_table | analyze | status   | OK       |</span><br><span class="hljs-section">+------------------------+---------+----------+----------+</span><br>1 row in set (0.08 sec)<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒANALYZE TABLEè¯­å¥ä¼šç«‹å³é‡æ–°è®¡ç®—ç»Ÿè®¡æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œåœ¨è¡¨ä¸­ç´¢å¼•å¤šæˆ–è€…é‡‡æ ·é¡µé¢ç‰¹åˆ«å¤šæ—¶è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šç‰¹åˆ«æ…¢ï¼Œè¯·ä¸è¦æ²¡äº‹å„¿å°±è¿è¡Œä¸€ä¸‹<code>ANALYZE TABLE</code>è¯­å¥ï¼Œæœ€å¥½åœ¨ä¸šåŠ¡ä¸æ˜¯å¾ˆç¹å¿™çš„æ—¶å€™å†è¿è¡Œã€‚</p></li></ul><h3 id="æ‰‹åŠ¨æ›´æ–°innodb-table-statså’Œinnodb-index-statsè¡¨">æ‰‹åŠ¨æ›´æ–°innodb_table_statså’Œinnodb_index_statsè¡¨</h3><p>å…¶å®<code>innodb_table_stats</code>å’Œ<code>innodb_index_stats</code>è¡¨å°±ç›¸å½“äºä¸€ä¸ªæ™®é€šçš„è¡¨ä¸€æ ·ï¼Œæˆ‘ä»¬èƒ½å¯¹å®ƒä»¬åšå¢åˆ æ”¹æŸ¥æ“ä½œã€‚è¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ›´æ–°æŸä¸ªè¡¨æˆ–è€…ç´¢å¼•çš„ç»Ÿè®¡æ•°æ®ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬æƒ³æŠŠ<code>single_table</code>è¡¨å…³äºè¡Œæ•°çš„ç»Ÿè®¡æ•°æ®æ›´æ”¹ä¸€ä¸‹å¯ä»¥è¿™ä¹ˆåšï¼š</p><ul><li><p>æ­¥éª¤ä¸€ï¼šæ›´æ–°<code>innodb_table_stats</code>è¡¨ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">UPDATE</span> innodb_table_stats <br>    <span class="hljs-keyword">SET</span> n_rows = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">table_name</span> = <span class="hljs-string">&#x27;single_table&#x27;</span>;<br></code></pre></td></tr></table></figure></li><li><p>æ­¥éª¤äºŒï¼šè®©<code>MySQL</code>æŸ¥è¯¢ä¼˜åŒ–å™¨é‡æ–°åŠ è½½æˆ‘ä»¬æ›´æ”¹è¿‡çš„æ•°æ®ã€‚</p><p>æ›´æ–°å®Œ<code>innodb_table_stats</code>åªæ˜¯å•çº¯çš„ä¿®æ”¹äº†ä¸€ä¸ªè¡¨çš„æ•°æ®ï¼Œéœ€è¦è®©<code>MySQL</code>æŸ¥è¯¢ä¼˜åŒ–å™¨é‡æ–°åŠ è½½æˆ‘ä»¬æ›´æ”¹è¿‡çš„æ•°æ®ï¼Œè¿è¡Œä¸‹è¾¹çš„å‘½ä»¤å°±å¯ä»¥äº†ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">FLUSH TABLE single_table<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></li></ul><p>ä¹‹åæˆ‘ä»¬ä½¿ç”¨<code>SHOW TABLE STATUS</code>è¯­å¥æŸ¥çœ‹è¡¨çš„ç»Ÿè®¡æ•°æ®æ—¶å°±çœ‹åˆ°<code>Rows</code>è¡Œå˜ä¸ºäº†<code>1</code>ã€‚</p><h2 id="åŸºäºå†…å­˜çš„éæ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®">åŸºäºå†…å­˜çš„éæ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®</h2><p>å½“æˆ‘ä»¬æŠŠç³»ç»Ÿå˜é‡<code>innodb_stats_persistent</code>çš„å€¼è®¾ç½®ä¸º<code>OFF</code>æ—¶ï¼Œä¹‹ååˆ›å»ºçš„è¡¨çš„ç»Ÿè®¡æ•°æ®é»˜è®¤å°±éƒ½æ˜¯éæ°¸ä¹…æ€§çš„äº†ï¼Œæˆ–è€…æˆ‘ä»¬ç›´æ¥åœ¨åˆ›å»ºè¡¨æˆ–ä¿®æ”¹è¡¨æ—¶è®¾ç½®<code>STATS_PERSISTENT</code>å±æ€§çš„å€¼ä¸º<code>0</code>ï¼Œé‚£ä¹ˆè¯¥è¡¨çš„ç»Ÿè®¡æ•°æ®å°±æ˜¯éæ°¸ä¹…æ€§çš„äº†ã€‚</p><p>ä¸æ°¸ä¹…æ€§çš„ç»Ÿè®¡æ•°æ®ä¸åŒï¼Œéæ°¸ä¹…æ€§çš„ç»Ÿè®¡æ•°æ®é‡‡æ ·çš„é¡µé¢æ•°é‡æ˜¯ç”±<code>innodb_stats_transient_sample_pages</code>æ§åˆ¶çš„ï¼Œè¿™ä¸ªç³»ç»Ÿå˜é‡çš„é»˜è®¤å€¼æ˜¯<code>8</code>ã€‚</p><p>å¦å¤–ï¼Œç”±äºéæ°¸ä¹…æ€§çš„ç»Ÿè®¡æ•°æ®ç»å¸¸æ›´æ–°ï¼Œæ‰€ä»¥å¯¼è‡´<code>MySQL</code>æŸ¥è¯¢ä¼˜åŒ–å™¨è®¡ç®—æŸ¥è¯¢æˆæœ¬çš„æ—¶å€™ä¾èµ–çš„æ˜¯ç»å¸¸å˜åŒ–çš„ç»Ÿè®¡æ•°æ®ï¼Œä¹Ÿå°±ä¼šç”Ÿæˆç»å¸¸å˜åŒ–çš„æ‰§è¡Œè®¡åˆ’ï¼Œè¿™ä¸ªå¯èƒ½è®©å¤§å®¶æœ‰äº›æ‡µé€¼ã€‚ä¸è¿‡æœ€è¿‘çš„<code>MySQL</code>ç‰ˆæœ¬éƒ½ä¸å’‹ç”¨è¿™ç§åŸºäºå†…å­˜çš„éæ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå°±ä¸æ·±å…¥å” å¨å®ƒäº†ã€‚</p><h2 id="innodb-stats-methodçš„ä½¿ç”¨">innodb_stats_methodçš„ä½¿ç”¨</h2><p>æˆ‘ä»¬çŸ¥é“<code>ç´¢å¼•åˆ—ä¸é‡å¤çš„å€¼çš„æ•°é‡</code>è¿™ä¸ªç»Ÿè®¡æ•°æ®å¯¹äº<code>MySQL</code>æŸ¥è¯¢ä¼˜åŒ–å™¨ååˆ†é‡è¦ï¼Œå› ä¸ºé€šè¿‡å®ƒå¯ä»¥è®¡ç®—å‡ºåœ¨ç´¢å¼•åˆ—ä¸­å¹³å‡ä¸€ä¸ªå€¼é‡å¤å¤šå°‘è¡Œï¼Œå®ƒçš„åº”ç”¨åœºæ™¯ä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><ul><li><p>å•è¡¨æŸ¥è¯¢ä¸­å•ç‚¹åŒºé—´å¤ªå¤šï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> tbl_name <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">key</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;xx1&#x27;</span>, <span class="hljs-string">&#x27;xx2&#x27;</span>, ..., <span class="hljs-string">&#x27;xxn&#x27;</span>);<br></code></pre></td></tr></table></figure><p>å½“<code>IN</code>é‡Œçš„å‚æ•°æ•°é‡è¿‡å¤šæ—¶ï¼Œé‡‡ç”¨<code>index dive</code>çš„æ–¹å¼ç›´æ¥è®¿é—®<code>B+</code>æ ‘ç´¢å¼•å»ç»Ÿè®¡æ¯ä¸ªå•ç‚¹åŒºé—´å¯¹åº”çš„è®°å½•çš„æ•°é‡å°±å¤ªè€—è´¹æ€§èƒ½äº†ï¼Œæ‰€ä»¥ç›´æ¥ä¾èµ–ç»Ÿè®¡æ•°æ®ä¸­çš„å¹³å‡ä¸€ä¸ªå€¼é‡å¤å¤šå°‘è¡Œæ¥è®¡ç®—å•ç‚¹åŒºé—´å¯¹åº”çš„è®°å½•æ•°é‡ã€‚</p></li><li><p>è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¦‚æœæœ‰æ¶‰åŠä¸¤ä¸ªè¡¨çš„ç­‰å€¼åŒ¹é…è¿æ¥æ¡ä»¶ï¼Œè¯¥è¿æ¥æ¡ä»¶å¯¹åº”çš„è¢«é©±åŠ¨è¡¨ä¸­çš„åˆ—åˆæ‹¥æœ‰ç´¢å¼•æ—¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>ref</code>è®¿é—®æ–¹æ³•æ¥å¯¹è¢«é©±åŠ¨è¡¨è¿›è¡ŒæŸ¥è¯¢ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> t1 <span class="hljs-keyword">JOIN</span> t2 <span class="hljs-keyword">ON</span> t1.column = t2.<span class="hljs-keyword">key</span> <span class="hljs-keyword">WHERE</span> ...;<br></code></pre></td></tr></table></figure><p>åœ¨çœŸæ­£æ‰§è¡Œå¯¹<code>t2</code>è¡¨çš„æŸ¥è¯¢å‰ï¼Œ<code>t1.comumn</code>çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¸èƒ½é€šè¿‡<code>index dive</code>çš„æ–¹å¼ç›´æ¥è®¿é—®<code>B+</code>æ ‘ç´¢å¼•å»ç»Ÿè®¡æ¯ä¸ªå•ç‚¹åŒºé—´å¯¹åº”çš„è®°å½•çš„æ•°é‡ï¼Œæ‰€ä»¥ä¹Ÿåªèƒ½ä¾èµ–ç»Ÿè®¡æ•°æ®ä¸­çš„å¹³å‡ä¸€ä¸ªå€¼é‡å¤å¤šå°‘è¡Œæ¥è®¡ç®—å•ç‚¹åŒºé—´å¯¹åº”çš„è®°å½•æ•°é‡ã€‚</p></li></ul><p>åœ¨ç»Ÿè®¡ç´¢å¼•åˆ—ä¸é‡å¤çš„å€¼çš„æ•°é‡æ—¶ï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒçƒ¦çš„é—®é¢˜å°±æ˜¯ç´¢å¼•åˆ—ä¸­å‡ºç°<code>NULL</code>å€¼æ€ä¹ˆåŠï¼Œæ¯”æ–¹è¯´æŸä¸ªç´¢å¼•åˆ—çš„å†…å®¹æ˜¯è¿™æ ·ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+------+</span><br><span class="hljs-section">| col  |</span><br><span class="hljs-section">+------+</span><br>|    1 |<br>|    2 |<br>| NULL |<br><span class="hljs-section">| NULL |</span><br><span class="hljs-section">+------+</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶è®¡ç®—è¿™ä¸ª<code>col</code>åˆ—ä¸­ä¸é‡å¤çš„å€¼çš„æ•°é‡å°±æœ‰ä¸‹è¾¹çš„åˆ†æ­§ï¼š</p><ul><li><p>æœ‰çš„äººè®¤ä¸º<code>NULL</code>å€¼ä»£è¡¨ä¸€ä¸ªæœªç¡®å®šçš„å€¼ï¼Œæ‰€ä»¥è®¾è®¡<code>MySQL</code>çš„å¤§å”æ‰è®¤ä¸ºä»»ä½•å’Œ<code>NULL</code>å€¼åšæ¯”è¾ƒçš„è¡¨è¾¾å¼çš„å€¼éƒ½ä¸º<code>NULL</code>ï¼Œå°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; SELECT 1 = NULL;</span><br><span class="hljs-section">+----------+</span><br><span class="hljs-section">| 1 = NULL |</span><br><span class="hljs-section">+----------+</span><br><span class="hljs-section">|     NULL |</span><br><span class="hljs-section">+----------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SELECT 1 != NULL;</span><br><span class="hljs-section">+-----------+</span><br><span class="hljs-section">| 1 != NULL |</span><br><span class="hljs-section">+-----------+</span><br><span class="hljs-section">|      NULL |</span><br><span class="hljs-section">+-----------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SELECT NULL = NULL;</span><br><span class="hljs-section">+-------------+</span><br><span class="hljs-section">| NULL = NULL |</span><br><span class="hljs-section">+-------------+</span><br><span class="hljs-section">|        NULL |</span><br><span class="hljs-section">+-------------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; SELECT NULL != NULL;</span><br><span class="hljs-section">+--------------+</span><br><span class="hljs-section">| NULL != NULL |</span><br><span class="hljs-section">+--------------+</span><br><span class="hljs-section">|         NULL |</span><br><span class="hljs-section">+--------------+</span><br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥æ¯ä¸€ä¸ª<code>NULL</code>å€¼éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç»Ÿè®¡ç´¢å¼•åˆ—ä¸é‡å¤çš„å€¼çš„æ•°é‡æ—¶ï¼Œåº”è¯¥æŠŠ<code>NULL</code>å€¼å½“ä½œä¸€ä¸ªç‹¬ç«‹çš„å€¼ï¼Œæ‰€ä»¥<code>col</code>åˆ—çš„ä¸é‡å¤çš„å€¼çš„æ•°é‡å°±æ˜¯ï¼š<code>4</code>ï¼ˆåˆ†åˆ«æ˜¯1ã€2ã€NULLã€NULLè¿™å››ä¸ªå€¼ï¼‰ã€‚</p></li><li><p>æœ‰çš„äººè®¤ä¸ºå…¶å®<code>NULL</code>å€¼åœ¨ä¸šåŠ¡ä¸Šå°±æ˜¯ä»£è¡¨æ²¡æœ‰ï¼Œæ‰€æœ‰çš„<code>NULL</code>å€¼ä»£è¡¨çš„æ„ä¹‰æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥<code>col</code>åˆ—ä¸é‡å¤çš„å€¼çš„æ•°é‡å°±æ˜¯ï¼š<code>3</code>ï¼ˆåˆ†åˆ«æ˜¯1ã€2ã€NULLè¿™ä¸‰ä¸ªå€¼ï¼‰ã€‚</p></li><li><p>æœ‰çš„äººè®¤ä¸ºè¿™<code>NULL</code>å®Œå…¨æ²¡æœ‰æ„ä¹‰å˜›ï¼Œæ‰€ä»¥åœ¨ç»Ÿè®¡ç´¢å¼•åˆ—ä¸é‡å¤çš„å€¼çš„æ•°é‡æ—¶å‹æ ¹å„¿ä¸èƒ½æŠŠå®ƒä»¬ç®—è¿›æ¥ï¼Œæ‰€ä»¥<code>col</code>åˆ—ä¸é‡å¤çš„å€¼çš„æ•°é‡å°±æ˜¯ï¼š<code>2</code>ï¼ˆåˆ†åˆ«æ˜¯1ã€2è¿™ä¸¤ä¸ªå€¼ï¼‰ã€‚</p></li></ul><p>è®¾è®¡<code>MySQL</code>çš„å¤§å”è›®è´´å¿ƒçš„ï¼Œä»–ä»¬æä¾›äº†ä¸€ä¸ªåä¸º<code>innodb_stats_method</code>çš„ç³»ç»Ÿå˜é‡ï¼Œç›¸å½“äºåœ¨è®¡ç®—æŸä¸ªç´¢å¼•åˆ—ä¸é‡å¤å€¼çš„æ•°é‡æ—¶å¦‚ä½•å¯¹å¾…<code>NULL</code>å€¼è¿™ä¸ªé”…ç”©ç»™äº†ç”¨æˆ·ï¼Œè¿™ä¸ªç³»ç»Ÿå˜é‡æœ‰ä¸‰ä¸ªå€™é€‰å€¼ï¼š</p><ul><li><p><code>nulls_equal</code>ï¼šè®¤ä¸ºæ‰€æœ‰<code>NULL</code>å€¼éƒ½æ˜¯ç›¸ç­‰çš„ã€‚è¿™ä¸ªå€¼ä¹Ÿæ˜¯<code>innodb_stats_method</code>çš„é»˜è®¤å€¼ã€‚</p><p>å¦‚æœæŸä¸ªç´¢å¼•åˆ—ä¸­<code>NULL</code>å€¼ç‰¹åˆ«å¤šçš„è¯ï¼Œè¿™ç§ç»Ÿè®¡æ–¹å¼ä¼šè®©ä¼˜åŒ–å™¨è®¤ä¸ºæŸä¸ªåˆ—ä¸­å¹³å‡ä¸€ä¸ªå€¼é‡å¤æ¬¡æ•°ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥å€¾å‘äºä¸ä½¿ç”¨ç´¢å¼•è¿›è¡Œè®¿é—®ã€‚</p></li><li><p><code>nulls_unequal</code>ï¼šè®¤ä¸ºæ‰€æœ‰<code>NULL</code>å€¼éƒ½æ˜¯ä¸ç›¸ç­‰çš„ã€‚</p><p>å¦‚æœæŸä¸ªç´¢å¼•åˆ—ä¸­<code>NULL</code>å€¼ç‰¹åˆ«å¤šçš„è¯ï¼Œè¿™ç§ç»Ÿè®¡æ–¹å¼ä¼šè®©ä¼˜åŒ–å™¨è®¤ä¸ºæŸä¸ªåˆ—ä¸­å¹³å‡ä¸€ä¸ªå€¼é‡å¤æ¬¡æ•°ç‰¹åˆ«å°‘ï¼Œæ‰€ä»¥å€¾å‘äºä½¿ç”¨ç´¢å¼•è¿›è¡Œè®¿é—®ã€‚</p></li><li><p><code>nulls_ignored</code>ï¼šç›´æ¥æŠŠ<code>NULL</code>å€¼å¿½ç•¥æ‰ã€‚</p></li></ul><p>åæ­£è¿™ä¸ªé”…æ˜¯ç”©ç»™ç”¨æˆ·äº†ï¼Œå½“ä½ é€‰å®šäº†<code>innodb_stats_method</code>å€¼ä¹‹åï¼Œä¼˜åŒ–å™¨å³ä½¿é€‰æ‹©äº†ä¸æ˜¯æœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ï¼Œé‚£ä¹Ÿè·Ÿè®¾è®¡<code>MySQL</code>çš„å¤§å”ä»¬æ²¡å…³ç³»äº†å“ˆï½ å½“ç„¶å¯¹äºç”¨æˆ·çš„æˆ‘ä»¬æ¥è¯´ï¼Œæœ€å¥½ä¸åœ¨ç´¢å¼•åˆ—ä¸­å­˜æ”¾NULLå€¼æ‰æ˜¯æ­£è§£ã€‚</p><h2 id="æ€»ç»“-5">æ€»ç»“</h2><ul><li><code>InnoDB</code>ä»¥è¡¨ä¸ºå•ä½æ¥æ”¶é›†ç»Ÿè®¡æ•°æ®ï¼Œè¿™äº›ç»Ÿè®¡æ•°æ®å¯ä»¥æ˜¯åŸºäºç£ç›˜çš„æ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºå†…å­˜çš„éæ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®ã€‚</li><li><code>innodb_stats_persistent</code>æ§åˆ¶ç€ä½¿ç”¨æ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®è¿˜æ˜¯éæ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®ï¼›<code>innodb_stats_persistent_sample_pages</code>æ§åˆ¶ç€æ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®çš„é‡‡æ ·é¡µé¢æ•°é‡ï¼›<code>innodb_stats_transient_sample_pages</code>æ§åˆ¶ç€éæ°¸ä¹…æ€§ç»Ÿè®¡æ•°æ®çš„é‡‡æ ·é¡µé¢æ•°é‡ï¼›<code>innodb_stats_auto_recalc</code>æ§åˆ¶ç€æ˜¯å¦è‡ªåŠ¨é‡æ–°è®¡ç®—ç»Ÿè®¡æ•°æ®ã€‚</li><li>æˆ‘ä»¬å¯ä»¥é’ˆå¯¹æŸä¸ªå…·ä½“çš„è¡¨ï¼Œåœ¨åˆ›å»ºå’Œä¿®æ”¹è¡¨æ—¶é€šè¿‡æŒ‡å®š<code>STATS_PERSISTENT</code>ã€<code>STATS_AUTO_RECALC</code>ã€<code>STATS_SAMPLE_PAGES</code>çš„å€¼æ¥æ§åˆ¶ç›¸å…³ç»Ÿè®¡æ•°æ®å±æ€§ã€‚</li><li><code>innodb_stats_method</code>å†³å®šç€åœ¨ç»Ÿè®¡æŸä¸ªç´¢å¼•åˆ—ä¸é‡å¤å€¼çš„æ•°é‡æ—¶å¦‚ä½•å¯¹å¾…<code>NULL</code>å€¼ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>God ghost ghosts</title>
    <link href="/dajiangdahe/2021/11/20/%E3%80%90%E6%95%A3%E6%96%87%E3%80%91God%20ghost%20ghosts/"/>
    <url>/dajiangdahe/2021/11/20/%E3%80%90%E6%95%A3%E6%96%87%E3%80%91God%20ghost%20ghosts/</url>
    
    <content type="html"><![CDATA[<h1>God ghost ghostsï¼ˆé™ˆå¹³åŸï¼‰</h1><img src="/dajiangdahe.github.io/2021/11/20/%E3%80%90%E6%95%A3%E6%96%87%E3%80%91God%20ghost%20ghosts/image-20211120111354124.png" class="" title="image-20211120111354124"><img src="/dajiangdahe.github.io/2021/11/20/%E3%80%90%E6%95%A3%E6%96%87%E3%80%91God%20ghost%20ghosts/image-20211120111402751.png" class="" title="image-20211120111402751">]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•£æ–‡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å•å…ƒæµ‹è¯•ä¹‹å¸¸ç”¨æ¡†æ¶</title>
    <link href="/dajiangdahe/2021/11/09/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B9%8B%E5%B8%B8%E7%94%A8%E6%A1%86%E6%9E%B6/"/>
    <url>/dajiangdahe/2021/11/09/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B9%8B%E5%B8%B8%E7%94%A8%E6%A1%86%E6%9E%B6/</url>
    
    <content type="html"><![CDATA[<h1>å•å…ƒæµ‹è¯•ä¹‹å¸¸ç”¨æ¡†æ¶</h1><p>æ–­è¨€æœºåˆ¶ï¼šå°†å’Œæˆ‘ä»¬çš„é¢„æœŸçš„ç»“æœå’Œå®é™…ç»“æœè¿›è¡Œå¯¹æ¯”ï¼Œåˆ¤æ–­ç»“æœæ˜¯å¦æ»¡è¶³æˆ‘ä»¬çš„æœŸæœ›</p><hr><p>å¸¸ç”¨æ¡†æ¶ï¼šJUnit &amp; Spock</p><p>é—®é¢˜ï¼š**JUnitå•çº¯ç”¨äºæµ‹è¯•ï¼Œä¸æä¾›mockåŠŸèƒ½ï¼›**JMockæˆ–è€…Mockitoæä¾›äº†mockåŠŸèƒ½ï¼Œå¯ä»¥æŠŠå€Ÿå£ç­‰ä¾èµ–å±è”½æ‰ï¼Œä½†ä¸æä¾›é™æ€ç±»é™æ€æ–¹æ³•çš„mockï¼›PowerMockæˆ–Jmockitè™½ç„¶æä¾›é™æ€ç±»å’Œæ–¹æ³•çš„mockï¼Œä½†æ˜¯ä»–ä»¬ä¹‹é—´éœ€è¦æ•´åˆï¼ˆjunit+mockito+powermockï¼‰ï¼›å·¥å…·ä¸€å¤šï¼Œå°±å¯¼è‡´å†™å‡ºçš„å•å…ƒæµ‹è¯•ä»£ç é£æ ¼è¿¥å¼‚ï¼›</p><h1>1. JUnit</h1><h2 id="1-å¯¼å…¥ä¾èµ–">1.å¯¼å…¥ä¾èµ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!--å¯¼å…¥ä¾èµ–--&gt;  <br>&lt;dependency&gt;<br>            &lt;groupId&gt;junit&lt;/groupId&gt;<br>            &lt;artifactId&gt;junit&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-number">4.12</span>&lt;/version&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="2-æ¡ˆä¾‹DEMO">2.æ¡ˆä¾‹DEMO</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Calculate</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> a + b;<br>    &#125;<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">delete</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> a - b;<br>    &#125;<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">multiply</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> a * b;<br>    &#125;<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">divide</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> a / b;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="3-ç”Ÿæˆå•å…ƒæµ‹è¯•ç±»">3.ç”Ÿæˆå•å…ƒæµ‹è¯•ç±»</h2><p>å•å…ƒæµ‹è¯•ç±»å¯ä»¥é€šè¿‡ideaçš„æ’ä»¶<code>TestMe</code>ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥é¦–å…ˆå®‰è£…<code>TestMe</code>,ç„¶ååœ¨æƒ³è¦è¿›è¡Œå•å…ƒæµ‹è¯•çš„ç±»ä½¿ç”¨ç”Ÿæˆã€‚</p><img src="/dajiangdahe.github.io/2021/11/09/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B9%8B%E5%B8%B8%E7%94%A8%E6%A1%86%E6%9E%B6/image-20211109163720421.png" class="" title="image-20211109163720421"><p>ç‚¹å‡»TestMeï¼Œé€‰æ‹©æƒ³è¦ç”Ÿæˆçš„ç±»å‹ã€‚</p><img src="/dajiangdahe.github.io/2021/11/09/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B9%8B%E5%B8%B8%E7%94%A8%E6%A1%86%E6%9E%B6/image-20211109163812587.png" class="" title="image-20211109163812587"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjut.junitandspockdemo;<br><br><span class="hljs-keyword">import</span> org.junit.Assert;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CalculateTest</span> </span>&#123;<br>    Calculate calculate = <span class="hljs-keyword">new</span> Calculate();<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAdd</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">int</span> result = calculate.add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>);<br>        Assert.assertEquals(<span class="hljs-number">8</span>, result);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDelete</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">int</span> result = calculate.delete(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>);<br>        Assert.assertEquals(<span class="hljs-number">2</span>, result);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testMultiply</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">int</span> result = calculate.multiply(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>        Assert.assertEquals(<span class="hljs-number">1</span>, result);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDivide</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">int</span> result = calculate.divide(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>        Assert.assertEquals(<span class="hljs-number">1</span>, result);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//Generated with love by TestMe :) Please report issues and submit feature requests at: http://weirddev.com/forum#!/testme</span><br></code></pre></td></tr></table></figure><h2 id="4-å•å…ƒæµ‹è¯•è§„åˆ™">4.å•å…ƒæµ‹è¯•è§„åˆ™</h2><blockquote><p>1.<code>@Test</code>ä¿®é¥°</p><p>2.æµ‹è¯•æ–¹æ³•å¿…é¡»ä½¿ç”¨<code>public void</code></p><p>3.æµ‹è¯•æ–¹æ³•ä¸èƒ½å¸¦å‚æ•°</p><p>4.æµ‹è¯•ä»£ç å’Œæºä»£ç åœ¨ä¸åŒè·¯å¾„ä¸‹</p><p>5.æµ‹è¯•ç±»çš„åŒ…åº”è¯¥å’Œè¢«æµ‹è¯•ç±»ä¿æŒä¸€è‡´</p><p>6.æµ‹è¯•å•å…ƒä¸­çš„æ¯ä¸ªæ–¹æ³•å¯ä»¥ç‹¬ç«‹æµ‹è¯•</p></blockquote><p><code>assertEquals</code>æ˜¯ä¸€ä¸ªæ–­è¨€ï¼›</p><h2 id="5-å¸¸ç”¨æ³¨è§£">5.å¸¸ç”¨æ³¨è§£</h2><blockquote><p><code>@Test(expected=XX.class)</code>------æœŸæœ›å‡ºç°çš„å¼‚å¸¸</p><p><code>@Test(timeout=æ¯«ç§’)</code></p><p><code>@RunWith</code>æ›´æ”¹æµ‹è¯•è¿è¡Œå™¨</p></blockquote><h2 id="6-æµ‹è¯•å¥—ä»¶">6.æµ‹è¯•å¥—ä»¶</h2><p>å¦‚æœæˆ‘ä»¬çš„é¡¹ç›®æœ‰æˆåƒä¸Šä¸‡ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæµ‹è¯•ç±»çš„å°è£…ï¼Œä¹Ÿå°±æ˜¯æŠŠæµ‹è¯•ç±»åµŒå¥—èµ·æ¥ï¼Œåªéœ€è¦è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼Œå°±èƒ½è¿è¡Œæ‰€æœ‰æµ‹è¯•ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test1</span> </span>&#123;<br><br>    Calculate calculate = <span class="hljs-keyword">new</span> Calculate();<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAdd</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">int</span> result = calculate.add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>);<br>        Assert.assertEquals(<span class="hljs-number">8</span>, result);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test2</span> </span>&#123;<br><br>    Calculate calculate = <span class="hljs-keyword">new</span> Calculate();<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAdd</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">int</span> result = calculate.add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>);<br>        Assert.assertEquals(<span class="hljs-number">8</span>, result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡<code>@Suite</code>è¿›è¡Œå°è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">import</span> org.junit.runner.RunWith;<br><span class="hljs-keyword">import</span> org.junit.runners.Suite;<br><br><span class="hljs-meta">@RunWith(Suite.class)</span><br><span class="hljs-meta">@Suite</span>.SuiteClasses(&#123;Test1.class,CalculateTest.class&#125;)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SuiteTest</span> </span>&#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    * å†™ä¸€ä¸ªç©ºç±»ï¼Œä¸åŒ…å«ä»»ä½•æ–¹æ³•</span><br><span class="hljs-comment">    * æ›´æ”¹æµ‹è¯•è¿è¡Œå®¹å™¨ä¸ºSuite.class</span><br><span class="hljs-comment">    * å°†æµ‹è¯•ç±»ä½œä¸ºæ•°ç»„ä¼ å…¥åˆ°Suite.SuiteClasses(&#123;&#125;)</span><br><span class="hljs-comment">    * */</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>å‚æ•°åŒ–é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjut.junitandspockdemo;<br><br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> org.junit.runner.RunWith;<br><span class="hljs-keyword">import</span> org.junit.runners.Parameterized;<br><br><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.Collection;<br><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.Assert.assertEquals;<br><br><span class="hljs-meta">@RunWith(Parameterized.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParameterTest</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> expected = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> input1 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> input2 = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-meta">@Parameterized</span>.Parameters<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Collection&lt;Object[]&gt; t() &#123;<br>        <span class="hljs-keyword">return</span> Arrays.asList(<span class="hljs-keyword">new</span> Object[][]&#123;<br>                &#123;<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;,<br>                &#123;<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>&#125;<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ParameterTest</span><span class="hljs-params">(<span class="hljs-keyword">int</span> expected, <span class="hljs-keyword">int</span> input1, <span class="hljs-keyword">int</span> input2)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.expected = expected;<br>        <span class="hljs-keyword">this</span>.input1 = input1;<br>        <span class="hljs-keyword">this</span>.input2 = input2;<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAdd</span><span class="hljs-params">()</span></span>&#123;<br>        assertEquals(expected,<span class="hljs-keyword">new</span> Calculate().add(input1,input2));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1>2.Spock</h1><p>ä»è¡Œä¸ºä¸Šè§„èŒƒå•æµ‹ä»£ç ï¼Œæ¯ä¸€ç§æ ‡ç­¾å¯¹åº”ä¸€ç§è¯­ä¹‰ï¼Œè®©ä»£ç è·Ÿå…·æœ‰å±‚æ¬¡æ„Ÿ</p><ul><li>setupï¼šç”¨äºå®šä¹‰å˜é‡ï¼Œå‡†å¤‡æµ‹è¯•æ•°æ®ï¼Œæ„å»ºmockå¯¹è±¡ç­‰ã€‚</li><li>givenï¼šè¾“å…¥æ¡ä»¶</li><li>whenï¼šåœ¨è¿™ä¸ªå¿«ä¸­è°ƒç”¨æµ‹è¯•ç­‰æ–¹æ³•ï¼ˆmockæ¥å£ï¼ŒçœŸå®è°ƒç”¨ï¼‰</li><li>thenï¼šä¸€èˆ¬è·Ÿåœ¨whenåé¢ä½¿ç”¨ï¼Œå°½å¯ä»¥åŒ…å«æ–­è¨€è¯­å¥ã€å¼‚å¸¸æ£€æŸ¥è¯­å¥ã€ç”¨äºæ£€æŸ¥è¦æµ‹è¯•çš„æ–¹æ³•æ‰§è¡Œåçš„ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</li><li>expect</li><li>where</li><li>with</li><li>andï¼šè¡”æ¥ä¸Šæ ‡ç­¾ï¼Œè¡¥å……ä½œç”¨</li><li>cleanupï¼šç”¨æˆ·æ¸…æ¥šsetupå—ä¸­å¯¹ç¯å¢ƒä½œå‡ºçš„ä¿®æ”¹ï¼Œå³å½“å‰æµ‹è¯•ç”¨ä¾‹ä¸­çš„ä¿®æ”¹å›æ»š</li></ul><ol><li>å•å…ƒæµ‹è¯•ä»£ç å¼€å‘çš„æˆæœ¬å’Œæ•ˆç‡</li><li>å•å…ƒæµ‹è¯•ä»£ç çš„å¯è¯»æ€§å’ŒåæœŸç»´æŠ¤æ€§</li><li>spockè‡ªå¸¦mockåŠŸèƒ½</li><li>springç»§æ‰¿spockæ¡†æ¶</li></ol><h2 id="1-å¯¼å…¥ä¾èµ–-2">1.å¯¼å…¥ä¾èµ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!--å¯¼å…¥ä¾èµ–--&gt; <br>&lt;!-- https:<span class="hljs-comment">//mvnrepository.com/artifact/org.spockframework/spock-core --&gt;</span><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.spockframework&lt;/groupId&gt;<br>            &lt;artifactId&gt;spock-core&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-number">2.0</span>-groovy-<span class="hljs-number">3.0</span>&lt;/version&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="2-ç”Ÿæˆå•å…ƒæµ‹è¯•ç±»">2.ç”Ÿæˆå•å…ƒæµ‹è¯•ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.bjut.junitandspockdemo<br><br><span class="hljs-keyword">import</span> spock.lang.*<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CalculateTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Specification</span> </span>&#123;<br>    Calculate calculate = <span class="hljs-keyword">new</span> Calculate()<br><br>    def <span class="hljs-string">&quot;test add&quot;</span>() &#123;<br>        when:<br>        <span class="hljs-keyword">int</span> result = calculate.add(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br><br>        then:<br>        result == <span class="hljs-number">0</span><br>    &#125;<br><br>    def <span class="hljs-string">&quot;test delete&quot;</span>() &#123;<br>        when:<br>        <span class="hljs-keyword">int</span> result = calculate.delete(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br><br>        then:<br>        result == <span class="hljs-number">0</span><br>    &#125;<br><br>    def <span class="hljs-string">&quot;test multiply&quot;</span>() &#123;<br>        when:<br>        <span class="hljs-keyword">int</span> result = calculate.multiply(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br><br>        then:<br>        result == <span class="hljs-number">0</span><br>    &#125;<br><br>    def <span class="hljs-string">&quot;test divide&quot;</span>() &#123;<br>        when:<br>        <span class="hljs-keyword">int</span> result = calculate.divide(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br><br>        then:<br>        result == <span class="hljs-number">0</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//Generated with love by TestMe :) Please report issues and submit feature requests at: http://weirddev.com/forum#!/testme</span><br></code></pre></td></tr></table></figure><h2 id="3-æµ‹è¯•ç»“æœ">3.æµ‹è¯•ç»“æœ</h2><img src="/dajiangdahe.github.io/2021/11/09/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B9%8B%E5%B8%B8%E7%94%A8%E6%A1%86%E6%9E%B6/image-20211109171707741.png" class="" title="image-20211109171707741">]]></content>
    
    
    <categories>
      
      <category>æ’ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JUnit &amp; Spock</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œåŸºç¡€</title>
    <link href="/dajiangdahe/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/"/>
    <url>/dajiangdahe/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1>ä¸€ã€ç½‘ç»œå±‚æ¬¡åˆ’åˆ†</h1><p>è®¡ç®—æœºç½‘ç»œå­¦ä¹ çš„æ ¸å¿ƒå†…å®¹å°±æ˜¯ç½‘ç»œåè®®çš„å­¦ä¹ ã€‚ç½‘ç»œåè®®æ˜¯ä¸ºè®¡ç®—æœºç½‘ç»œä¸­è¿›è¡Œæ•°æ®äº¤æ¢è€Œå»ºç«‹çš„è§„åˆ™ã€æ ‡å‡†æˆ–è€…è¯´æ˜¯çº¦å®šçš„é›†åˆã€‚å› ä¸ºä¸åŒç”¨æˆ·çš„æ•°æ®ç»ˆç«¯å¯èƒ½é‡‡å–çš„å­—ç¬¦é›†æ˜¯ä¸åŒçš„ï¼Œä¸¤è€…éœ€è¦è¿›è¡Œé€šä¿¡ï¼Œå¿…é¡»è¦åœ¨ä¸€å®šçš„æ ‡å‡†ä¸Šè¿›è¡Œã€‚</p><h2 id="1-1-OSIä¸ƒå±‚ç½‘ç»œæ¨¡å‹">1.1 OSIä¸ƒå±‚ç½‘ç»œæ¨¡å‹</h2><p>ä¸ºäº†ä½¿ä¸åŒè®¡ç®—æœºå‚å®¶ç”Ÿäº§çš„è®¡ç®—æœºèƒ½å¤Ÿç›¸äº’é€šä¿¡ï¼Œä»¥ä¾¿åœ¨æ›´å¤§çš„èŒƒå›´å†…å»ºç«‹è®¡ç®—æœºç½‘ç»œï¼Œå›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼ˆISOï¼‰åœ¨1978å¹´æå‡ºäº†â€å¼€æ”¾ç³»ç»Ÿäº’è”å‚è€ƒæ¨¡å‹â€ï¼Œå³è‘—åçš„<strong>OSI/RMæ¨¡å‹</strong>ï¼ˆOpen System Interconnection/Reference Modelï¼‰ã€‚å®ƒå°†è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„çš„é€šä¿¡åè®®åˆ’åˆ†ä¸ºä¸ƒå±‚ï¼Œè‡ªä¸‹è€Œä¸Šä¾æ¬¡ä¸ºï¼š<strong>ç‰©ç†å±‚</strong>ï¼ˆPhysics Layerï¼‰ã€<strong>æ•°æ®é“¾è·¯å±‚</strong>ï¼ˆData Link Layerï¼‰ã€<strong>ç½‘ç»œå±‚</strong>ï¼ˆNetwork Layerï¼‰ã€<strong>ä¼ è¾“å±‚</strong>ï¼ˆTransport Layerï¼‰ã€<strong>ä¼šè¯å±‚</strong>ï¼ˆSession Layerï¼‰ã€<strong>è¡¨ç¤ºå±‚</strong>ï¼ˆPresentation Layerï¼‰ã€<strong>åº”ç”¨å±‚</strong>ï¼ˆApplication Layerï¼‰ã€‚å…¶ä¸­ç¬¬å››å±‚å®Œæˆæ•°æ®ä¼ é€æœåŠ¡ï¼Œä¸Šé¢ä¸‰å±‚é¢å‘ç”¨æˆ·ã€‚</p><p>é™¤äº†æ ‡å‡†çš„OSIä¸ƒå±‚æ¨¡å‹ä»¥å¤–ï¼Œå¸¸è§çš„ç½‘ç»œå±‚æ¬¡åˆ’åˆ†è¿˜æœ‰TCP/IPå››å±‚åè®®ä»¥åŠTCP/IPäº”å±‚åè®®ï¼Œå®ƒä»¬ä¹‹é—´çš„å¯¹åº”å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20211103192227336.png" class="" title="image-20211103192227336"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20211103192238025.png" class="" title="image-20211103192238025"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20211103192253822.png" class="" title="image-20211103192253822"><hr><h1>äºŒã€ç‰©ç†å±‚</h1><h2 id="2-1-æ¦‚è¿°">2.1 æ¦‚è¿°</h2><p><strong>ç‰©ç†å±‚ï¼ˆPhysical Layerï¼‰</strong>ï¼šæ¿€æ´»ã€ç»´æŒã€å…³é—­é€šä¿¡ç«¯ç‚¹ä¹‹é—´çš„æœºæ¢°ç‰¹æ€§ã€ç”µæ°”ç‰¹æ€§ã€åŠŸèƒ½ç‰¹æ€§ä»¥åŠè¿‡ç¨‹ç‰¹æ€§ã€‚<strong>è¯¥å±‚ä¸ºä¸Šå±‚åè®®æä¾›äº†ä¸€ä¸ªä¼ è¾“æ•°æ®çš„å¯é çš„ç‰©ç†åª’ä½“ã€‚ç®€å•çš„è¯´ï¼Œç‰©ç†å±‚ç¡®ä¿åŸå§‹çš„æ•°æ®å¯åœ¨å„ç§ç‰©ç†åª’ä½“ä¸Šä¼ è¾“ã€‚</strong></p><ul><li>ç‰©ç†å±‚çš„ä»»åŠ¡ï¼š<strong>é€æ˜åœ°ä¼ è¾“æ¯”ç‰¹æµ</strong>ã€‚</li><li>ç‰©ç†å±‚çš„åŠŸèƒ½ï¼š<strong>ä¸ºæ•°æ®æ®µè®¾å¤‡æä¾›ä¼ é€æ•°æ®é€šè·¯</strong></li><li>ç‰©ç†å±‚ä¼ è¾“å•ä½ï¼š<strong>æ¯”ç‰¹</strong></li><li>ç‰©ç†å±‚å®ç°çš„ç¡¬ä»¶ï¼š<strong>é›†çº¿å™¨</strong>ï¼Œ<strong>ä¸­ç»§å™¨</strong>ï¼ˆRepeaterï¼Œä¹Ÿå«æ”¾å¤§å™¨ï¼‰</li></ul><hr><h1>ä¸‰ã€æ•°æ®é“¾è·¯å±‚</h1><h2 id="3-1-æ¦‚è¿°">3.1 æ¦‚è¿°</h2><p><strong>æ•°æ®é“¾è·¯å±‚ï¼ˆData Link Layerï¼‰</strong>ï¼šåœ¨ç‰©ç†å±‚æä¾›çš„æœåŠ¡çš„åŸºç¡€ä¸Šå‘ç½‘ç»œå±‚æä¾›æœåŠ¡ï¼Œå…¶æœ€åŸºæœ¬çš„æœåŠ¡æ˜¯å°†æºè‡ªç½‘ç»œå±‚æ¥çš„æ•°æ®å¯é åœ°ä¼ è¾“åˆ°<strong>ç›¸é‚»èŠ‚ç‚¹çš„ç›®æ ‡æœºç½‘ç»œå±‚</strong>ã€‚ä¸ºè¾¾åˆ°è¿™ä¸€ç›®çš„ï¼Œæ•°æ®é“¾è·¯å¿…é¡»å…·å¤‡ä¸€ç³»åˆ—ç›¸åº”çš„åŠŸèƒ½ï¼Œä¸»è¦æœ‰ï¼šå¦‚ä½•å°†æ•°æ®ç»„åˆæˆæ•°æ®å—ï¼Œåœ¨æ•°æ®é“¾è·¯å±‚ä¸­ç§°è¿™ç§æ•°æ®å—ä¸ºå¸§ï¼ˆframeï¼‰ï¼Œ<strong>å¸§æ˜¯æ•°æ®é“¾è·¯å±‚çš„ä¼ é€å•ä½</strong>ï¼›å¦‚ä½•æ§åˆ¶å¸§åœ¨ç‰©ç†ä¿¡é“ä¸Šçš„ä¼ è¾“ï¼ŒåŒ…æ‹¬å¦‚ä½•å¤„ç†ä¼ è¾“å·®é”™ï¼Œå¦‚ä½•è°ƒèŠ‚å‘é€é€Ÿç‡ä»¥ä½¿ä¸æ¥æ”¶æ–¹ç›¸åŒ¹é…ï¼›ä»¥åŠåœ¨ä¸¤ä¸ªç½‘ç»œå®ä½“ä¹‹é—´æä¾›æ•°æ®é“¾è·¯é€šè·¯çš„å»ºç«‹ã€ç»´æŒå’Œé‡Šæ”¾çš„ç®¡ç†ã€‚æ•°æ®é“¾è·¯å±‚åœ¨ä¸å¯é çš„ç‰©ç†ä»‹è´¨ä¸Šæä¾›å¯é çš„ä¼ è¾“ã€‚</p><ul><li>æ•°æ®é“¾è·¯å±‚çš„ä»»åŠ¡ï¼š<strong>å°†ç½‘ç»œå±‚ä¼ è¾“ä¸‹æ¥çš„IPæ•°æ®æŠ¥ç»„è£…æˆå¸§</strong>ã€<strong>ç‰©ç†åœ°å€å¯»å€ã€æµé‡æ§åˆ¶ã€æ•°æ®çš„æ£€é”™ã€é‡å‘</strong>ç­‰</li><li>æ•°æ®é“¾è·¯å±‚çš„åŠŸèƒ½ï¼š<ul><li><strong>é“¾è·¯è¿æ¥çš„å»ºç«‹ã€æ‹†é™¤å’Œåˆ†ç¦»</strong></li><li><strong>å¸§å®šç•Œå’Œå¸§åŒæ­¥</strong></li><li><strong>å·®é”™æ£€æµ‹</strong></li></ul></li><li>ç‰©ç†å±‚ä¼ è¾“å•ä½ï¼š<strong>å¸§</strong></li><li>æ•°æ®é“¾è·¯å±‚å®ç°çš„ç¡¬ä»¶ï¼š<strong>äº¤æ¢æœº</strong>ã€<strong>ç½‘æ¡¥</strong></li><li>åè®®ï¼šPPP,HDLCã€SDLCã€STPã€ARQ</li></ul><hr><h1>å››ã€ç½‘ç»œå±‚</h1><h2 id="4-1-æ¦‚è¿°">4.1 æ¦‚è¿°</h2><p><strong>ç½‘ç»œå±‚ï¼ˆNetwork Layerï¼‰</strong>ï¼šç›®çš„æ˜¯å®ç°ä¸¤ä¸ªç«¯ç³»ç»Ÿä¹‹é—´çš„æ•°æ®é€æ˜ä¼ é€ï¼Œå…·ä½“åŠŸèƒ½åŒ…æ‹¬å¯»å€å’Œè·¯ç”±é€‰æ‹©ã€è¿æ¥çš„å»ºç«‹ã€ä¿æŒå’Œç»ˆæ­¢ç­‰ã€‚å®ƒæä¾›çš„æœåŠ¡ä½¿ä¼ è¾“å±‚ä¸éœ€è¦äº†è§£ç½‘ç»œä¸­çš„æ•°æ®ä¼ è¾“å’Œäº¤æ¢æŠ€æœ¯ã€‚å¦‚æœæƒ³ç”¨å°½é‡å°‘çš„è¯æ¥è®°ä½ç½‘ç»œå±‚ï¼Œé‚£å°±æ˜¯**â€è·¯å¾„é€‰æ‹©ã€è·¯ç”±åŠé€»è¾‘å¯»å€â€**ã€‚</p><p>ç½‘ç»œå±‚ä¸­æ¶‰åŠä¼—å¤šçš„åè®®ï¼Œå…¶ä¸­åŒ…æ‹¬æœ€é‡è¦çš„åè®®ï¼Œä¹Ÿæ˜¯TCP/IPçš„æ ¸å¿ƒåè®®â€”â€”IPåè®®ã€‚IPåè®®éå¸¸ç®€å•ï¼Œä»…ä»…æä¾›ä¸å¯é ã€æ— è¿æ¥çš„ä¼ é€æœåŠ¡ã€‚IPåè®®çš„ä¸»è¦åŠŸèƒ½æœ‰ï¼šæ— è¿æ¥æ•°æ®æŠ¥ä¼ è¾“ã€æ•°æ®æŠ¥è·¯ç”±é€‰æ‹©å’Œå·®é”™æ§åˆ¶ã€‚ä¸IPåè®®é…å¥—ä½¿ç”¨å®ç°å…¶åŠŸèƒ½çš„è¿˜æœ‰åœ°å€è§£æåè®®ARPã€é€†åœ°å€è§£æåè®®RARPã€å› ç‰¹ç½‘æŠ¥æ–‡åè®®ICMPã€å› ç‰¹ç½‘ç»„ç®¡ç†åè®®IGMPã€‚</p><ul><li>ç½‘ç»œå±‚çš„ä»»åŠ¡ï¼š<ul><li>å°†ä¼ è¾“å±‚ä¼ ä¸‹æ¥çš„æŠ¥æ–‡æ®µ<strong>å°è£…æˆåˆ†ç»„</strong></li><li><strong>é€‰æ‹©åˆé€‚çš„è·¯ç”±</strong>ï¼Œä½¿å¾—ä¼ è¾“å±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„èƒ½å¤Ÿäº¤ä»˜åˆ°ç›®çš„ä¸»æœº</li></ul></li><li>ç½‘ç»œå±‚çš„åŠŸèƒ½ï¼š<ul><li>ä¸ºä¼ è¾“å±‚æä¾›æœåŠ¡</li><li>ç»„åŒ…å’Œæ‹†åŒ…</li><li>è·¯ç”±é€‰æ‹©</li><li>æ‹¥å¡æ§åˆ¶</li></ul></li><li>ç½‘ç»œå±‚ä¼ è¾“å•ä½ï¼š<strong>æ•°æ®æ®µ</strong></li><li>ç½‘ç»œå±‚å®ç°çš„ç¡¬ä»¶ï¼š<strong>è·¯ç”±å™¨</strong></li><li>åè®®ï¼šICMPã€ARPã€RARPã€IPã€IGMPã€OSPF</li></ul><h2 id="4-2-IPåè®®">4.2 IPåè®®</h2><h3 id="IPåœ°å€">IPåœ°å€</h3><h4 id="æ¦‚è¿°">æ¦‚è¿°</h4><p>IPåœ°å€æ˜¯IPåè®®æä¾›çš„ä¸€ç§ç»Ÿä¸€çš„åœ°å€æ ¼å¼ï¼Œå®ƒä¸ºäº’è”ç½‘ä¸Šçš„æ¯ä¸€ä¸ªç½‘ç»œå’Œæ¯ä¸€å°ä¸»æœºåˆ†é…ä¸€ä¸ªé€»è¾‘åœ°å€ï¼Œä»¥æ­¤æ¥å±è”½ç‰©ç†åœ°å€çš„å·®å¼‚ã€‚</p><p>æ¯ä¸ªIPåœ°å€éƒ½åŒ…å«ä¸¤éƒ¨åˆ†ï¼š<strong>ç½‘ç»œID</strong>å’Œ<strong>ä¸»æœºID</strong>ï¼Œç½‘ç»œIDæ ‡è¯†åœ¨åŒä¸€ä¸ªç‰©ç†ç½‘ç»œä¸Šçš„æ‰€æœ‰å®¿ä¸»æœºï¼Œä¸»æœºIDæ ‡è¯†ç½‘ç»œä¸Šçš„æ¯ä¸€ä¸ªå®¿ä¸»æœºï¼Œè¿è¡ŒTCP/IPçš„æ¯ä¸ªè®¡ç®—æœºéƒ½éœ€è¦å”¯ä¸€çš„IPåœ°å€ã€‚</p><p><strong>IPV4</strong></p><p>IPV4æœ‰ä¸€ä¸ª<strong>32</strong>ä½çš„è¿æ¥åœ°å€ï¼Œç”±4ä¸ª8ä½å­—æ®µç»„æˆï¼Œ8ä½å­—æ®µç§°ä¸º8ä½ä½ç»„ï¼Œæ¯ä¸ª8ä½ä½ç»„ä¹‹é—´ç”¨ç‚¹å·éš”å¼€ï¼Œç”¨äºæ ‡è¯†TCP/IPå®¿ä¸»æœºã€‚</p><p><strong>IPV6</strong></p><p>IPv6çš„åœ°å€é•¿åº¦ä¸º<strong>128ä½</strong>ï¼Œæ˜¯IPv4åœ°å€é•¿åº¦çš„4å€ï¼Œé‡‡ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºã€‚IPv6æœ‰3ç§è¡¨ç¤ºæ–¹æ³•ã€‚</p><p>ä¸»è¦ä½¿ç”¨<strong>å†’åˆ†åå…­è¿›åˆ¶</strong>è¡¨ç¤ºæ³•</p><p>æ ¼å¼ä¸ºX:X:X:X:X:X:X:Xï¼Œå…¶ä¸­æ¯ä¸ªXè¡¨ç¤ºåœ°å€ä¸­çš„16bï¼Œä»¥åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼š</p><p>ABCD:EF01:2345:6789:ABCD:EF01:2345:6789</p><h4 id="IPV4å’ŒIPV6çš„åŒºåˆ«">IPV4å’ŒIPV6çš„åŒºåˆ«</h4><p>IPv4å’ŒIPv6æ˜¯æ˜¯ç›®å‰ä½¿ç”¨çš„ä¸¤ç§Internetåè®®ç‰ˆæœ¬ï¼ŒIPv4å’ŒIPv6åè®®ä¹‹é—´å­˜åœ¨å„ç§å·®å¼‚ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„åŠŸèƒ½ï¼Œä½†å…³é”®çš„ä¸€ç‚¹æ˜¯å®ƒç”Ÿæˆçš„åœ°å€ï¼ˆåœ°å€ç©ºé—´ï¼‰çš„æ•°é‡çš„åŒºåˆ«ã€‚</p><ol><li><p>åè®®åœ°å€çš„åŒºåˆ«</p><p>ï¼ˆ1ï¼‰åœ°å€é•¿åº¦</p><p>IPv4åè®®å…·æœ‰32ä½ï¼ˆ4å­—èŠ‚ï¼‰åœ°å€é•¿åº¦ï¼›IPv6åè®®å…·æœ‰128ä½ï¼ˆ16å­—èŠ‚ï¼‰åœ°å€é•¿åº¦ã€‚</p><p>ï¼ˆ2ï¼‰åœ°å€çš„è¡¨ç¤ºæ–¹æ³•</p><p>IPv4åœ°å€æ˜¯ä»¥å°æ•°è¡¨ç¤ºçš„äºŒè¿›åˆ¶æ•°ã€‚ IPv6åœ°å€æ˜¯ä»¥åå…­è¿›åˆ¶è¡¨ç¤ºçš„äºŒè¿›åˆ¶æ•°ã€‚</p><p>ï¼ˆ3ï¼‰åœ°å€é…ç½®</p><p>IPv4åè®®çš„åœ°å€å¯ä»¥é€šè¿‡æ‰‹åŠ¨æˆ–DHCPé…ç½®çš„ã€‚</p><p>IPv4åè®®éœ€è¦ä½¿ç”¨Internetæ§åˆ¶æ¶ˆæ¯åè®®ç‰ˆæœ¬6ï¼ˆICMPv6ï¼‰æˆ–DHCPv6çš„æ— çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½®ï¼ˆSLAACï¼‰ã€‚</p></li><li><p>æ•°æ®åŒ…çš„åŒºåˆ«</p><p>ï¼ˆ1ï¼‰åŒ…çš„å¤§å°</p><p>IPv4åè®®çš„æ•°æ®åŒ…éœ€è¦576ä¸ªå­—èŠ‚ï¼Œç¢ç‰‡å¯é€‰ ï¼›IPv6åè®®çš„æ•°æ®åŒ…éœ€è¦1280ä¸ªå­—èŠ‚ï¼Œä¸ä¼šç¢ç‰‡ã€‚</p><p>ï¼ˆ2ï¼‰åŒ…å¤´</p><p>IPv4åè®®çš„åŒ…å¤´çš„é•¿åº¦ä¸º20ä¸ªå­—èŠ‚ï¼Œä¸è¯†åˆ«ç”¨äºQoSå¤„ç†çš„æ•°æ®åŒ…æµï¼ŒåŒ…å«checksumï¼ŒåŒ…å«æœ€å¤š40ä¸ªå­—èŠ‚çš„é€‰é¡¹å­—æ®µã€‚</p><p>IPv6åè®®çš„åŒ…å¤´çš„é•¿åº¦ä¸º40ä¸ªå­—èŠ‚ï¼ŒåŒ…å«æŒ‡å®šQoSå¤„ç†çš„æ•°æ®åŒ…æµçš„Flow Labelå­—æ®µï¼Œä¸åŒ…å«checksumï¼›IPv6åè®®æ²¡æœ‰å­—æ®µï¼Œä½†IPv6æ‰©å±•æ ‡å¤´å¯ç”¨ã€‚</p><p>ï¼ˆ3ï¼‰æ•°æ®åŒ…ç¢ç‰‡</p><p>IPv4åè®®çš„æ•°æ®åŒ…ç¢ç‰‡ä¼šç”±è½¬å‘è·¯ç”±å™¨å’Œå‘é€ä¸»æœºå®Œæˆã€‚IPv6åè®®çš„æ•°æ®åŒ…ç¢ç‰‡ä»…ç”±å‘é€ä¸»æœºå®Œæˆã€‚</p></li><li><p>DNSè®°å½•</p><p>IPv4åè®®çš„åœ°å€ï¼ˆAï¼‰è®°å½•ï¼Œæ˜ å°„ä¸»æœºåï¼›æŒ‡é’ˆï¼ˆPTRï¼‰è®°å½•ï¼ŒIN-ADDR.ARPA DNSåŸŸã€‚</p><p>IPv6åè®®çš„åœ°å€ï¼ˆAAAAï¼‰è®°å½•ï¼Œæ˜ å°„ä¸»æœºåï¼›æŒ‡é’ˆï¼ˆPTRï¼‰è®°å½•ï¼ŒIP6.ARPA DNSåŸŸ</p></li><li><p>IPSecæ”¯æŒ</p><p>IPv4åè®®çš„IPSecæ”¯æŒåªæ˜¯å¯é€‰çš„ï¼›IPv6åè®®æœ‰å†…ç½®çš„IPSecæ”¯æŒã€‚</p></li><li><p>åœ°å€è§£æåè®®</p><p>IPv4åè®®ï¼šåœ°å€è§£æåè®®ï¼ˆARPï¼‰å¯ç”¨äºå°†IPv4åœ°å€æ˜ å°„åˆ°MACåœ°å€ã€‚</p><p>IPv6åè®®ï¼šåœ°å€è§£æåè®®ï¼ˆARPï¼‰è¢«é‚»å±…å‘ç°åè®®ï¼ˆNDPï¼‰çš„åŠŸèƒ½æ‰€å–ä»£ã€‚</p></li><li><p>èº«ä»½éªŒè¯å’ŒåŠ å¯†</p><p>Pv6æä¾›èº«ä»½éªŒè¯å’ŒåŠ å¯†ï¼›ä½†IPv4ä¸æä¾›ã€‚</p></li></ol><h4 id="IPåˆ†ç±»">IPåˆ†ç±»</h4><p>Intenetå§”å‘˜ä¼šå®šä¹‰äº†äº”ç§åœ°å€ç±»å‹ä»¥é€‚åº”ä¸åŒå°ºå¯¸çš„ç½‘ç»œã€‚åœ°å€ç±»å‹å®šä¹‰ç½‘ç»œIDä½¿ç”¨å“ªäº›ä½,å®ƒä¹Ÿå®šä¹‰äº†ç½‘ç»œçš„å¯èƒ½æ•°ç›®å’Œæ¯ä¸ªç½‘ç»œå¯èƒ½çš„å®¿ä¸»æœºæ•°ç›®ï¼</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210906221555685.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210906221555685.png" class="" title="image-20210906221555685"></a></p><p>IPåœ°å€æ ¹æ®ç½‘ç»œå·å’Œä¸»æœºå·æ¥åˆ†ï¼Œåˆ†ä¸ºAã€Bã€Cä¸‰ç±»åŠç‰¹æ®Šåœ°å€Dã€Eã€‚ å…¨0å’Œå…¨1çš„éƒ½ä¿ç•™ä¸ç”¨ã€‚</p><ul><li>Aç±»ï¼š(0.0.0.0-127.255.255.255)ï¼ˆé»˜è®¤å­ç½‘æ©ç ï¼š255.0.0.0æˆ– 0xFF000000ï¼‰ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸ºç½‘ç»œå·ï¼Œåä¸‰ä¸ªå­—èŠ‚ä¸ºä¸»æœºå·ã€‚è¯¥ç±»IPåœ°å€çš„æœ€å‰é¢ä¸ºâ€œ0â€ï¼Œæ‰€ä»¥åœ°å€çš„ç½‘ç»œå·å–å€¼äº1~126ä¹‹é—´ã€‚ä¸€èˆ¬ç”¨äºå¤§å‹ç½‘ç»œã€‚</li><li>Bç±»ï¼š(128.0.0.0-191.255.255.255)ï¼ˆé»˜è®¤å­ç½‘æ©ç ï¼š255.255.0.0æˆ–0xFFFF0000ï¼‰å‰ä¸¤ä¸ªå­—èŠ‚ä¸ºç½‘ç»œå·ï¼Œåä¸¤ä¸ªå­—èŠ‚ä¸ºä¸»æœºå·ã€‚è¯¥ç±»IPåœ°å€çš„æœ€å‰é¢ä¸ºâ€œ10â€ï¼Œæ‰€ä»¥åœ°å€çš„ç½‘ç»œå·å–å€¼äº128~191ä¹‹é—´ã€‚ä¸€èˆ¬ç”¨äºä¸­ç­‰è§„æ¨¡ç½‘ç»œã€‚</li><li>Cç±»ï¼š(192.0.0.0-223.255.255.255)ï¼ˆå­ç½‘æ©ç ï¼š255.255.255.0æˆ– 0xFFFFFF00ï¼‰å‰ä¸‰ä¸ªå­—èŠ‚ä¸ºç½‘ç»œå·ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚ä¸ºä¸»æœºå·ã€‚è¯¥ç±»IPåœ°å€çš„æœ€å‰é¢ä¸ºâ€œ110â€ï¼Œæ‰€ä»¥åœ°å€çš„ç½‘ç»œå·å–å€¼äº192~223ä¹‹é—´ã€‚ä¸€èˆ¬ç”¨äºå°å‹ç½‘ç»œã€‚</li><li>Dç±»ï¼šæ˜¯å¤šæ’­åœ°å€ã€‚è¯¥ç±»IPåœ°å€çš„æœ€å‰é¢ä¸ºâ€œ1110â€ï¼Œæ‰€ä»¥åœ°å€çš„ç½‘ç»œå·å–å€¼äº224~239ä¹‹é—´ã€‚ä¸€èˆ¬ç”¨äºå¤šè·¯å¹¿æ’­ç”¨æˆ· ã€‚</li><li>Eç±»ï¼šæ˜¯ä¿ç•™åœ°å€ã€‚è¯¥ç±»IPåœ°å€çš„æœ€å‰é¢ä¸ºâ€œ1111â€ï¼Œæ‰€ä»¥åœ°å€çš„ç½‘ç»œå·å–å€¼äº240~255ä¹‹é—´ã€‚</li></ul><p>æ³¨ï¼šåªæœ‰A,B,Cæœ‰ç½‘ç»œå·å’Œä¸»æœºå·ä¹‹åˆ†ï¼ŒDç±»åœ°å€å’ŒEç±»åœ°å€æ²¡æœ‰åˆ’åˆ†ç½‘ç»œå·å’Œä¸»æœºå·ã€‚</p><blockquote><p>255.255.255.255</p><p>è¯¥IPåœ°å€æŒ‡çš„æ˜¯å—é™çš„å¹¿æ’­åœ°å€ã€‚å—é™å¹¿æ’­åœ°å€ä¸ä¸€èˆ¬å¹¿æ’­åœ°å€ï¼ˆç›´æ¥å¹¿æ’­åœ°å€ï¼‰çš„åŒºåˆ«åœ¨äºï¼Œå—é™å¹¿æ’­åœ°å€åªèƒ½ç”¨äºæœ¬åœ°ç½‘ç»œï¼Œè·¯ç”±å™¨ä¸ä¼šè½¬å‘ä»¥å—é™å¹¿æ’­åœ°å€ä¸ºç›®çš„åœ°å€çš„åˆ†ç»„ï¼›ä¸€èˆ¬å¹¿æ’­åœ°å€æ—¢å¯åœ¨æœ¬åœ°å¹¿æ’­ï¼Œä¹Ÿå¯è·¨ç½‘æ®µå¹¿æ’­ã€‚ä¾‹å¦‚ï¼šä¸»æœº192.168.1.1/30ä¸Šçš„ç›´æ¥å¹¿æ’­æ•°æ®åŒ…åï¼Œå¦å¤–ä¸€ä¸ªç½‘æ®µ192.168.1.5/30ä¹Ÿèƒ½æ”¶åˆ°è¯¥æ•°æ®æŠ¥ï¼›è‹¥å‘é€å—é™å¹¿æ’­æ•°æ®æŠ¥ï¼Œåˆ™ä¸èƒ½æ”¶åˆ°ã€‚</p><p>æ³¨ï¼šä¸€èˆ¬çš„å¹¿æ’­åœ°å€ï¼ˆç›´æ¥å¹¿æ’­åœ°å€ï¼‰èƒ½å¤Ÿé€šè¿‡æŸäº›è·¯ç”±å™¨ï¼ˆå½“ç„¶ä¸æ˜¯æ‰€æœ‰çš„è·¯ç”±å™¨ï¼‰ï¼Œè€Œå—é™çš„å¹¿æ’­åœ°å€ä¸èƒ½é€šè¿‡è·¯ç”±å™¨ã€‚</p></blockquote><blockquote><p>0.0.0.0</p><p>å¸¸ç”¨äºå¯»æ‰¾è‡ªå·±çš„IPåœ°å€ï¼Œä¾‹å¦‚åœ¨RARPï¼ŒBOOTPå’ŒDHCPåè®®ä¸­ï¼Œè‹¥æŸä¸ªæœªçŸ¥IPåœ°å€çš„æ— ç›˜æœºæƒ³è¦çŸ¥é“è‡ªå·±çš„IPåœ°å€ï¼Œå®ƒå°±ä»¥255.255.255.255ä¸ºç›®çš„åœ°å€ï¼Œå‘æœ¬åœ°èŒƒå›´ï¼ˆå…·ä½“è€Œè¨€æ˜¯è¢«å„ä¸ªè·¯ç”±å™¨å±è”½çš„èŒƒå›´å†…ï¼‰çš„æœåŠ¡å™¨å‘é€IPè¯·æ±‚åˆ†ç»„ã€‚</p></blockquote><blockquote><p>å›ç¯åœ°å€</p><p>127.0.0.0/8è¢«ç”¨ä½œå›ç¯åœ°å€ï¼Œå›ç¯åœ°å€è¡¨ç¤ºæœ¬æœºçš„åœ°å€ï¼Œå¸¸ç”¨äºå¯¹æœ¬æœºçš„æµ‹è¯•ï¼Œç”¨çš„æœ€å¤šçš„æ˜¯127.0.0.1ã€‚</p></blockquote><blockquote><p>Aã€Bã€Cç±»ç§æœ‰åœ°å€</p><p>ç§æœ‰åœ°å€(private address)ä¹Ÿå«ä¸“ç”¨åœ°å€ï¼Œå®ƒä»¬ä¸ä¼šåœ¨å…¨çƒä½¿ç”¨ï¼Œåªå…·æœ‰æœ¬åœ°æ„ä¹‰ã€‚</p><p>Aç±»ç§æœ‰åœ°å€ï¼š10.0.0.0/8ï¼ŒèŒƒå›´æ˜¯ï¼š10.0.0.0~10.255.255.255</p><p>Bç±»ç§æœ‰åœ°å€ï¼š172.16.0.0/12ï¼ŒèŒƒå›´æ˜¯ï¼š172.16.0.0~172.31.255.255</p><p>Cç±»ç§æœ‰åœ°å€ï¼š192.168.0.0/16ï¼ŒèŒƒå›´æ˜¯ï¼š192.168.0.0~192.168.255.255</p></blockquote><h4 id="IPä¸ºä»€ä¹ˆè¦åˆ†ç±»">IPä¸ºä»€ä¹ˆè¦åˆ†ç±»</h4><p>æ ¹æ®IPåœ°å€è®¿é—®ç»ˆç«¯æ˜¯é€šè¿‡è·¯ç”±å™¨ï¼Œè·¯ç”±è®¾å¤‡å½“ä¸­æœ‰ä¸€å¼ è·¯ç”±è¡¨ï¼Œè¯¥è·¯ç”±è¡¨è®°å½•äº†æ‰€æœ‰IPåœ°å€çš„ä½ç½®ï¼Œè¿™æ ·å°±å¯ä»¥è¿›è¡ŒåŒ…çš„è½¬å‘äº†ï¼Œå¦‚æœæˆ‘ä»¬ä¸åŒºåˆ†ç½‘ç»œåœ°å€ï¼Œé‚£ä¹ˆè¿™å¼ è·¯ç”±è¡¨å½“ä¸­å°±è¦ä¿å­˜æœ‰æ‰€æœ‰IPåœ°å€çš„æ–¹å‘ï¼Œè¿™å¼ è·¯ç”±è¡¨å°±ä¼šå¾ˆå¤§ï¼Œå°±åƒä¸‹é¢è¯´çš„é‚£æ ·ï¼šå¦‚æœä¸åˆ†ç½‘ç»œä½å’Œä¸»æœºä½ï¼Œè·¯ç”±å™¨çš„è·¯ç”±è¡¨å°±æ˜¯éƒ½æ˜¯32ä½çš„åœ°å€ï¼Œé‚£æ‰€æœ‰çš„è·¯ç”±å™¨ç»´æŠ¤çš„è·¯ç”±è¡¨ä¼šå¾ˆå¤§ï¼Œè½¬å‘é€Ÿåº¦ä¼šå˜æ…¢ï¼ˆå› ä¸ºæŸ¥è¯¢å˜æ…¢ï¼‰ã€‚è€Œä¸”æ‰€æœ‰çš„è·¯ç”±å™¨éƒ½è¦æœ‰å…¨Internetçš„åœ°å€ï¼Œæ‰€æœ‰äººçš„è·¯ç”±å™¨éƒ½è¦æœ‰è¶³å¤Ÿçš„æ€§èƒ½æ¥å­˜ä¸‹å…¨ç½‘åœ°å€ã€‚ä¼°è®¡å»ºé€ è¿™æ ·çš„Internetæˆæœ¬æ˜¯ç°åœ¨çš„å‡ ä¸‡å€ï¼Œç”šè‡³æ›´é«˜ã€‚</p><p><strong>æœ‰äº†ç½‘ç»œåœ°å€ï¼Œå°±å¯ä»¥é™å®šæ‹¥æœ‰ç›¸åŒç½‘ç»œåœ°å€çš„ç»ˆç«¯éƒ½åœ¨åŒä¸€ä¸ªèŒƒå›´å†…ï¼Œé‚£ä¹ˆè·¯ç”±è¡¨åªéœ€è¦ç»´æŠ¤è¿™ä¸ªç½‘ç»œåœ°å€çš„æ–¹å‘ï¼Œå°±å¯ä»¥æ‰¾åˆ°ç›¸åº”çš„ç»ˆç«¯äº†ã€‚</strong></p><h3 id="å­ç½‘æ©ç ">å­ç½‘æ©ç </h3><p>éšç€äº’è¿ç½‘åº”ç”¨çš„ä¸æ–­æ‰©å¤§ï¼ŒåŸå…ˆçš„IPv4çš„å¼Šç«¯ä¹Ÿé€æ¸æš´éœ²å‡ºæ¥ï¼Œå³ç½‘ç»œå·å ä½å¤ªå¤šï¼Œè€Œä¸»æœºå·ä½å¤ªå°‘ï¼Œæ‰€ä»¥å…¶èƒ½æä¾›çš„ä¸»æœºåœ°å€ä¹Ÿè¶Šæ¥è¶Šç¨€ç¼ºï¼Œç›®å‰é™¤äº†ä½¿ç”¨NATåœ¨ä¼ä¸šå†…éƒ¨åˆ©ç”¨ä¿ç•™åœ°å€è‡ªè¡Œåˆ†é…ä»¥å¤–ï¼Œé€šå¸¸éƒ½å¯¹ä¸€ä¸ªé«˜ç±»åˆ«çš„IPåœ°å€è¿›è¡Œå†åˆ’åˆ†ï¼Œä»¥å½¢æˆå¤šä¸ªå­ç½‘ï¼Œæä¾›ç»™ä¸åŒè§„æ¨¡çš„ç”¨æˆ·ç¾¤ä½¿ç”¨ã€‚</p><p>è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåˆ†æ®µæƒ…å†µä¸‹æœ‰æ•ˆåœ°åˆ©ç”¨IPåœ°å€ï¼Œé€šè¿‡å¯¹ä¸»æœºå·çš„é«˜ä½éƒ¨åˆ†å–ä½œä¸ºå­ç½‘å·ï¼Œä»é€šå¸¸çš„ç½‘ç»œä½ç•Œé™ä¸­æ‰©å±•æˆ–å‹ç¼©å­ç½‘æ©ç ï¼Œç”¨æ¥åˆ›å»ºæŸç±»åœ°å€çš„æ›´å¤šå­ç½‘ã€‚ä½†åˆ›å»ºæ›´å¤šçš„å­ç½‘æ—¶ï¼Œåœ¨æ¯ä¸ªå­ç½‘ä¸Šçš„å¯ç”¨ä¸»æœºåœ°å€æ•°ç›®ä¼šæ¯”åŸå…ˆå‡å°‘ã€‚</p><p>ä½¿ç”¨å­ç½‘å¯ä»¥æŠŠå•ä¸ªå¤§ç½‘åˆ†æˆå¤šä¸ªç‰©ç†ç½‘ç»œï¼Œå¹¶ç”¨è·¯ç”±å™¨æŠŠå®ƒä»¬è¿æ¥èµ·æ¥ã€‚</p><p>å­ç½‘æ©ç (Subnet Mask)ç”¨äº<strong>å±è”½IPåœ°å€çš„ä¸€éƒ¨åˆ†ï¼Œä½¿å¾—TCP/IPèƒ½å¤ŸåŒºåˆ«ç½‘ç»œIDå’Œå®¿ä¸»æœºID</strong>ã€‚å½“TCP/IPå®¿ä¸»æœºè¦é€šä¿¡æ—¶,å­ç½‘æ©ç ç”¨äºåˆ¤æ–­ä¸€ä¸ªå®¿ä¸»æœºæ˜¯åœ¨æœ¬åœ°ç½‘ç»œè¿˜æ˜¯åœ¨è¿œç¨‹ç½‘ç»œã€‚</p><p>ç¼ºçœçš„å­ç½‘æ©ç ç”¨äºä¸åˆ†æˆå­ç½‘çš„TCP/IPç½‘ç»œï¼Œå¯¹åº”äºç½‘ç»œIDçš„æ‰€æœ‰ä½éƒ½ç½®ä¸º1ï¼Œæ¯ä¸ª8ä½ä½ç»„çš„åè¿›åˆ¶æ•°æ˜¯255ï¼Œå¯¹åº”äºå®¿ä¸»æœºIDçš„æ‰€æœ‰ä½éƒ½ç½®ä¸º0ã€‚</p><p>ç”¨äºå­ç½‘æ©ç çš„ä½æ•°å†³å®šå¯èƒ½çš„å­ç½‘æ•°ç›®å’Œæ¯ä¸ªå­ç½‘çš„å®¿ä¸»æœºæ•°ç›®ï¼Œå­ç½‘æ©ç çš„ä½æ•°è¶Šå¤šï¼Œåˆ™å­ç½‘è¶Šå¤šï¼Œä½†æ˜¯å®¿ä¸»æœºä¹Ÿè¾ƒå°‘ã€‚</p><p>ä¾‹ï¼šå‡è®¾Aç±»åœ°å€å­ç½‘æ•°æ˜¯14ï¼Œåˆ™æ‰€éœ€ä½æ•°è‡³å°‘ä¸º4ï¼Œç”¨äºå­ç½‘çš„ä½ä¸ºï¼š11111111, 11110000, 00000000, 00000000, å­ç½‘æ©ç ä¸º255.240.0.0,æ¯ä¸ªå­ç½‘çš„å®¿ä¸»æœºæ•°ç›®ä¸º2^20-2=1,048, 574ä¸ªã€‚</p><h4 id="æœ‰å…³å­ç½‘æ©ç å’Œç½‘ç»œåˆ’åˆ†å¸¸è§çš„é¢è¯•è€ƒé¢˜">æœ‰å…³å­ç½‘æ©ç å’Œç½‘ç»œåˆ’åˆ†å¸¸è§çš„é¢è¯•è€ƒé¢˜</h4><h5 id="åˆ©ç”¨å­ç½‘æ•°æ¥è®¡ç®—">åˆ©ç”¨å­ç½‘æ•°æ¥è®¡ç®—</h5><p>åœ¨æ±‚å­ç½‘æ©ç ä¹‹å‰å¿…é¡»å…ˆææ¸…æ¥šè¦åˆ’åˆ†çš„å­ç½‘æ•°ç›®ï¼Œä»¥åŠæ¯ä¸ªå­ç½‘å†…çš„æ‰€éœ€ä¸»æœºæ•°ç›®ã€‚</p><p>(1) å°†å­ç½‘æ•°ç›®è½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ¥è¡¨ç¤º;</p><p>å¦‚æ¬²å°†Bç±»IPåœ°å€168.195.0.0åˆ’åˆ†æˆ27ä¸ªå­ç½‘ï¼š27=11011ï¼›</p><p>(2) å–å¾—è¯¥äºŒè¿›åˆ¶çš„ä½æ•°ï¼Œä¸ºNï¼›</p><p>è¯¥äºŒè¿›åˆ¶ä¸ºäº”ä½æ•°ï¼ŒN = 5</p><p>(3) å–å¾—è¯¥IPåœ°å€çš„ç±»å­ç½‘æ©ç ï¼Œå°†å…¶ä¸»æœºåœ°å€éƒ¨åˆ†çš„çš„å‰Nä½ç½®1å³å¾—å‡ºè¯¥IPåœ°å€åˆ’åˆ†å­ç½‘çš„å­ç½‘æ©ç ã€‚</p><p>å°†Bç±»åœ°å€çš„å­ç½‘æ©ç 255.255.0.0çš„ä¸»æœºåœ°å€å‰5ä½ç½® 1ï¼Œå¾—åˆ° 255.255.248.0</p><h5 id="åˆ©ç”¨ä¸»æœºæ•°æ¥è®¡ç®—">åˆ©ç”¨ä¸»æœºæ•°æ¥è®¡ç®—</h5><p>å¦‚æ¬²å°†Bç±»IPåœ°å€168.195.0.0åˆ’åˆ†æˆè‹¥å¹²å­ç½‘ï¼Œæ¯ä¸ªå­ç½‘å†…æœ‰ä¸»æœº700å°ï¼š</p><p>(1) å°†ä¸»æœºæ•°ç›®è½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ¥è¡¨ç¤º<code>700=1010111100</code>ï¼›</p><p>(2) å¦‚æœä¸»æœºæ•°å°äºæˆ–ç­‰äº254ï¼ˆæ³¨æ„å»æ‰ä¿ç•™çš„ä¸¤ä¸ªIPåœ°å€ï¼‰ï¼Œåˆ™å–å¾—è¯¥ä¸»æœºçš„äºŒè¿›åˆ¶ä½æ•°ï¼Œä¸ºNï¼Œè¿™é‡Œè‚¯å®š N&lt;8ã€‚å¦‚æœå¤§äº254ï¼Œåˆ™ N&gt;8ï¼Œè¿™å°±æ˜¯è¯´ä¸»æœºåœ°å€å°†å æ®ä¸æ­¢8ä½ï¼›è¯¥äºŒè¿›åˆ¶ä¸ºåä½æ•°ï¼ŒN=10ï¼›</p><p>(3) ä½¿ç”¨255.255.255.255æ¥å°†è¯¥ç±»IPåœ°å€çš„ä¸»æœºåœ°å€ä½æ•°å…¨éƒ¨ç½®1ï¼Œç„¶åä»åå‘å‰çš„å°†Nä½å…¨éƒ¨ç½®ä¸º 0ï¼Œå³ä¸ºå­ç½‘æ©ç å€¼ã€‚</p><p>å°†è¯¥Bç±»åœ°å€çš„å­ç½‘æ©ç 255.255.0.0çš„ä¸»æœºåœ°å€å…¨éƒ¨ç½®1ï¼Œå¾—åˆ°255.255.255.255ï¼Œç„¶åå†ä»åå‘å‰å°†å 10ä½ç½®0,å³ä¸ºï¼š11111111.11111111.11111100.00000000ï¼Œå³255.255.252.0ã€‚è¿™å°±æ˜¯è¯¥æ¬²åˆ’åˆ†æˆä¸»æœºä¸º700å°çš„Bç±»IPåœ°å€ 168.195.0.0çš„å­ç½‘æ©ç ã€‚</p><h5 id="æ ¹æ®æ¯ä¸ªç½‘ç»œçš„ä¸»æœºæ•°é‡è¿›è¡Œå­ç½‘åœ°å€çš„è§„åˆ’è®¡ç®—å­ç½‘æ©ç ">æ ¹æ®æ¯ä¸ªç½‘ç»œçš„ä¸»æœºæ•°é‡è¿›è¡Œå­ç½‘åœ°å€çš„è§„åˆ’è®¡ç®—å­ç½‘æ©ç </h5><p>æ¯”å¦‚ä¸€ä¸ªå­ç½‘æœ‰10å°ä¸»æœºï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªå­ç½‘éœ€è¦çš„IPåœ°å€æ˜¯ï¼š<code>10ï¼‹1ï¼‹1ï¼‹1ï¼13</code></p><p><strong>æ³¨æ„ï¼šåŠ çš„ç¬¬ä¸€ä¸ª1æ˜¯æŒ‡è¿™ä¸ªç½‘ç»œè¿æ¥æ—¶æ‰€éœ€çš„ç½‘å…³åœ°å€ï¼Œæ¥ç€çš„ä¸¤ä¸ª1åˆ†åˆ«æ˜¯æŒ‡ç½‘ç»œåœ°å€å’Œå¹¿æ’­åœ°å€ã€‚</strong></p><p>å› ä¸º13å°äº16ï¼ˆ16ç­‰äº2çš„4æ¬¡æ–¹ï¼‰ï¼Œæ‰€ä»¥ä¸»æœºä½ä¸º4ä½ã€‚è€Œ256ï¼16ï¼240ï¼Œæ‰€ä»¥è¯¥å­ç½‘æ©ç ä¸º255.255.255.240ã€‚</p><p>å¦‚æœä¸€ä¸ªå­ç½‘æœ‰14å°ä¸»æœºï¼Œä¸å°‘äººå¸¸çŠ¯çš„é”™è¯¯æ˜¯ï¼šä¾ç„¶åˆ†é…å…·æœ‰16ä¸ªåœ°å€ç©ºé—´çš„å­ç½‘ï¼Œè€Œå¿˜è®°äº†ç»™ç½‘å…³åˆ†é…åœ°å€ã€‚è¿™æ ·å°±é”™è¯¯äº†ï¼Œå› ä¸º14ï¼‹1ï¼‹1ï¼‹1ï¼17ï¼Œ17å¤§äº16ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½åˆ†é…å…·æœ‰32ä¸ªåœ°å€ï¼ˆ32ç­‰äº2çš„5æ¬¡æ–¹ï¼‰ç©ºé—´çš„å­ç½‘ã€‚è¿™æ—¶å­ç½‘æ©ç ä¸ºï¼š255.255.255.224ã€‚</p><h2 id="4-3-ARP-RARPåè®®">4.3 ARP/RARPåè®®</h2><p>**åœ°å€è§£æåè®®ï¼Œå³ARPï¼ˆAddress Resolution Protocolï¼‰ï¼Œæ˜¯æ ¹æ®IPåœ°å€è·å–ç‰©ç†åœ°å€çš„ä¸€ä¸ªTCP/IPåè®®ã€‚**ä¸»æœºå‘é€ä¿¡æ¯æ—¶å°†åŒ…å«ç›®æ ‡IPåœ°å€çš„ARPè¯·æ±‚å¹¿æ’­åˆ°ç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºï¼Œå¹¶æ¥æ”¶è¿”å›æ¶ˆæ¯ï¼Œä»¥æ­¤ç¡®å®šç›®æ ‡çš„ç‰©ç†åœ°å€ï¼›æ”¶åˆ°è¿”å›æ¶ˆæ¯åå°†è¯¥IPåœ°å€å’Œç‰©ç†åœ°å€å­˜å…¥æœ¬æœºARPç¼“å­˜ä¸­å¹¶ä¿ç•™ä¸€å®šæ—¶é—´ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶ç›´æ¥æŸ¥è¯¢ARPç¼“å­˜ä»¥èŠ‚çº¦èµ„æºã€‚åœ°å€è§£æåè®®æ˜¯å»ºç«‹åœ¨ç½‘ç»œä¸­å„ä¸ªä¸»æœºäº’ç›¸ä¿¡ä»»çš„åŸºç¡€ä¸Šçš„ï¼Œç½‘ç»œä¸Šçš„ä¸»æœºå¯ä»¥è‡ªä¸»å‘é€ARPåº”ç­”æ¶ˆæ¯ï¼Œå…¶ä»–ä¸»æœºæ”¶åˆ°åº”ç­”æŠ¥æ–‡æ—¶ä¸ä¼šæ£€æµ‹è¯¥æŠ¥æ–‡çš„çœŸå®æ€§å°±ä¼šå°†å…¶è®°å…¥æœ¬æœºARPç¼“å­˜ï¼›ç”±æ­¤æ”»å‡»è€…å°±å¯ä»¥å‘æŸä¸€ä¸»æœºå‘é€ä¼ªARPåº”ç­”æŠ¥æ–‡ï¼Œä½¿å…¶å‘é€çš„ä¿¡æ¯æ— æ³•åˆ°è¾¾é¢„æœŸçš„ä¸»æœºæˆ–åˆ°è¾¾é”™è¯¯çš„ä¸»æœºï¼Œè¿™å°±æ„æˆäº†ä¸€ä¸ªARPæ¬ºéª—ã€‚<strong>ARPå‘½ä»¤å¯ç”¨äºæŸ¥è¯¢æœ¬æœºARPç¼“å­˜ä¸­IPåœ°å€å’ŒMACåœ°å€çš„å¯¹åº”å…³ç³»ã€æ·»åŠ æˆ–åˆ é™¤é™æ€å¯¹åº”å…³ç³»ç­‰ã€‚</strong></p><p>ARPå·¥ä½œæµç¨‹ä¸¾ä¾‹ï¼š</p><p>ä¸»æœºAçš„IPåœ°å€ä¸º192.168.1.1ï¼ŒMACåœ°å€ä¸º0A-11-22-33-44-01ï¼›</p><p>ä¸»æœºBçš„IPåœ°å€ä¸º192.168.1.2ï¼ŒMACåœ°å€ä¸º0A-11-22-33-44-02ï¼›</p><p>å½“ä¸»æœºAè¦ä¸ä¸»æœºBé€šä¿¡æ—¶ï¼Œåœ°å€è§£æåè®®å¯ä»¥å°†ä¸»æœºBçš„IPåœ°å€ï¼ˆ192.168.1.2ï¼‰è§£ææˆä¸»æœºBçš„MACåœ°å€ï¼Œä»¥ä¸‹ä¸ºå·¥ä½œæµç¨‹ï¼š</p><p>ï¼ˆ1ï¼‰æ ¹æ®ä¸»æœºAä¸Šçš„è·¯ç”±è¡¨å†…å®¹ï¼ŒIPç¡®å®šç”¨äºè®¿é—®ä¸»æœºBçš„è½¬å‘IPåœ°å€æ˜¯192.168.1.2ã€‚ç„¶åAä¸»æœºåœ¨è‡ªå·±çš„æœ¬åœ°ARPç¼“å­˜ä¸­æ£€æŸ¥ä¸»æœºBçš„åŒ¹é…MACåœ°å€ã€‚</p><p>ï¼ˆ2ï¼‰å¦‚æœä¸»æœºAåœ¨ARPç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°æ˜ å°„ï¼Œå®ƒå°†è¯¢é—®192.168.1.2çš„ç¡¬ä»¶åœ°å€ï¼Œä»è€Œå°†ARPè¯·æ±‚å¸§å¹¿æ’­åˆ°æœ¬åœ°ç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºã€‚æºä¸»æœºAçš„IPåœ°å€å’ŒMACåœ°å€éƒ½åŒ…æ‹¬åœ¨ARPè¯·æ±‚ä¸­ã€‚æœ¬åœ°ç½‘ç»œä¸Šçš„æ¯å°ä¸»æœºéƒ½æ¥æ”¶åˆ°ARPè¯·æ±‚å¹¶ä¸”æ£€æŸ¥æ˜¯å¦ä¸è‡ªå·±çš„IPåœ°å€åŒ¹é…ã€‚å¦‚æœä¸»æœºå‘ç°è¯·æ±‚çš„IPåœ°å€ä¸è‡ªå·±çš„IPåœ°å€ä¸åŒ¹é…ï¼Œå®ƒå°†ä¸¢å¼ƒARPè¯·æ±‚ã€‚</p><p>ï¼ˆ3ï¼‰ä¸»æœºBç¡®å®šARPè¯·æ±‚ä¸­çš„IPåœ°å€ä¸è‡ªå·±çš„IPåœ°å€åŒ¹é…ï¼Œåˆ™å°†ä¸»æœºAçš„IPåœ°å€å’ŒMACåœ°å€æ˜ å°„æ·»åŠ åˆ°æœ¬åœ°ARPç¼“å­˜ä¸­ã€‚</p><p>ï¼ˆ4ï¼‰ä¸»æœºBå°†åŒ…å«å…¶MACåœ°å€çš„ARPå›å¤æ¶ˆæ¯ç›´æ¥å‘é€å›ä¸»æœºAã€‚</p><p>ï¼ˆ5ï¼‰å½“ä¸»æœºAæ”¶åˆ°ä»ä¸»æœºBå‘æ¥çš„ARPå›å¤æ¶ˆæ¯æ—¶ï¼Œä¼šç”¨ä¸»æœºBçš„IPå’ŒMACåœ°å€æ˜ å°„æ›´æ–°ARPç¼“å­˜ã€‚æœ¬æœºç¼“å­˜æ˜¯æœ‰ç”Ÿå­˜æœŸçš„ï¼Œç”Ÿå­˜æœŸç»“æŸåï¼Œå°†å†æ¬¡é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ã€‚ä¸»æœºBçš„MACåœ°å€ä¸€æ—¦ç¡®å®šï¼Œä¸»æœºAå°±èƒ½å‘ä¸»æœºBå‘é€IPé€šä¿¡äº†ã€‚</p><p><strong>é€†åœ°å€è§£æåè®®ï¼Œå³RARPï¼ŒåŠŸèƒ½å’ŒARPåè®®ç›¸å¯¹ï¼Œå…¶å°†å±€åŸŸç½‘ä¸­æŸä¸ªä¸»æœºçš„ç‰©ç†åœ°å€è½¬æ¢ä¸ºIPåœ°å€</strong></p><p>æ¯”å¦‚å±€åŸŸç½‘ä¸­æœ‰ä¸€å°ä¸»æœºåªçŸ¥é“ç‰©ç†åœ°å€è€Œä¸çŸ¥é“IPåœ°å€ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡RARPåè®®å‘å‡ºå¾æ±‚è‡ªèº«IPåœ°å€çš„å¹¿æ’­è¯·æ±‚ï¼Œç„¶åç”±RARPæœåŠ¡å™¨è´Ÿè´£å›ç­”ã€‚</p><p>RARPåè®®å·¥ä½œæµç¨‹ï¼š</p><p>ï¼ˆ1ï¼‰ç»™ä¸»æœºå‘é€ä¸€ä¸ªæœ¬åœ°çš„RARPå¹¿æ’­ï¼Œåœ¨æ­¤å¹¿æ’­åŒ…ä¸­ï¼Œå£°æ˜è‡ªå·±çš„MACåœ°å€å¹¶ä¸”è¯·æ±‚ä»»ä½•æ”¶åˆ°æ­¤è¯·æ±‚çš„RARPæœåŠ¡å™¨åˆ†é…ä¸€ä¸ªIPåœ°å€ï¼›</p><p>ï¼ˆ2ï¼‰æœ¬åœ°ç½‘æ®µä¸Šçš„RARPæœåŠ¡å™¨æ”¶åˆ°æ­¤è¯·æ±‚åï¼Œæ£€æŸ¥å…¶RARPåˆ—è¡¨ï¼ŒæŸ¥æ‰¾è¯¥MACåœ°å€å¯¹åº”çš„IPåœ°å€ï¼›</p><p>ï¼ˆ3ï¼‰å¦‚æœå­˜åœ¨ï¼ŒRARPæœåŠ¡å™¨å°±ç»™æºä¸»æœºå‘é€ä¸€ä¸ªå“åº”æ•°æ®åŒ…å¹¶å°†æ­¤IPåœ°å€æä¾›ç»™å¯¹æ–¹ä¸»æœºä½¿ç”¨ï¼›</p><p>ï¼ˆ4ï¼‰å¦‚æœä¸å­˜åœ¨ï¼ŒRARPæœåŠ¡å™¨å¯¹æ­¤ä¸åšä»»ä½•çš„å“åº”ï¼›</p><h2 id="4-4-è·¯ç”±é€‰æ‹©åè®®">4.4 è·¯ç”±é€‰æ‹©åè®®</h2><p>å¸¸è§çš„è·¯ç”±é€‰æ‹©åè®®æœ‰ï¼šRIPåè®®ã€OSPFåè®®ã€‚</p><p><strong>RIPåè®®</strong> ï¼šåº•å±‚æ˜¯è´å°”æ›¼ç¦ç‰¹ç®—æ³•ï¼Œå®ƒé€‰æ‹©è·¯ç”±çš„åº¦é‡æ ‡å‡†ï¼ˆmetric)æ˜¯è·³æ•°ï¼Œæœ€å¤§è·³æ•°æ˜¯15è·³ï¼Œå¦‚æœå¤§äº15è·³ï¼Œå®ƒå°±ä¼šä¸¢å¼ƒæ•°æ®åŒ…ã€‚</p><p><strong>OSPFåè®®</strong> ï¼šOpen Shortest Path Firstå¼€æ”¾å¼æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼Œåº•å±‚æ˜¯è¿ªæ°æ–¯ç‰¹æ‹‰ç®—æ³•ï¼Œæ˜¯é“¾è·¯çŠ¶æ€è·¯ç”±é€‰æ‹©åè®®ï¼Œå®ƒé€‰æ‹©è·¯ç”±çš„åº¦é‡æ ‡å‡†æ˜¯å¸¦å®½ï¼Œå»¶è¿Ÿã€‚</p><hr><h1>äº”ã€ä¼ è¾“å±‚</h1><h2 id="5-1-æ¦‚è¿°">5.1 æ¦‚è¿°</h2><p><strong>ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰</strong>ï¼šè´Ÿè´£å°†ä¸Šå±‚æ•°æ®åˆ†æ®µå¹¶æä¾›<strong>ç«¯åˆ°ç«¯</strong>çš„ã€å¯é çš„æˆ–ä¸å¯é çš„ä¼ è¾“ã€‚æ­¤å¤–ï¼Œä¼ è¾“å±‚è¿˜è¦å¤„ç†ç«¯åˆ°ç«¯çš„å·®é”™æ§åˆ¶å’Œæµé‡æ§åˆ¶é—®é¢˜ã€‚ ä¼ è¾“å±‚çš„ä»»åŠ¡æ˜¯æ ¹æ®é€šä¿¡å­ç½‘çš„ç‰¹æ€§ï¼Œæœ€ä½³çš„åˆ©ç”¨ç½‘ç»œèµ„æºï¼Œä¸ºä¸¤ä¸ªç«¯ç³»ç»Ÿçš„ä¼šè¯å±‚ä¹‹é—´ï¼Œæä¾›å»ºç«‹ã€ç»´æŠ¤å’Œå–æ¶ˆä¼ è¾“è¿æ¥çš„åŠŸèƒ½ï¼Œè´Ÿè´£ç«¯åˆ°ç«¯çš„å¯é æ•°æ®ä¼ è¾“ã€‚åœ¨è¿™ä¸€å±‚ï¼Œä¿¡æ¯ä¼ é€çš„åè®®æ•°æ®å•å…ƒç§°ä¸ºæ®µæˆ–<strong>æŠ¥æ–‡</strong>ã€‚ <strong>ç½‘ç»œå±‚åªæ˜¯æ ¹æ®ç½‘ç»œåœ°å€å°†æºç»“ç‚¹å‘å‡ºçš„æ•°æ®åŒ…ä¼ é€åˆ°ç›®çš„ç»“ç‚¹ï¼Œè€Œä¼ è¾“å±‚åˆ™è´Ÿè´£å°†æ•°æ®å¯é åœ°ä¼ é€åˆ°ç›¸åº”çš„ç«¯å£ã€‚</strong></p><p>ä¼ è¾“å±‚çš„ä½œç”¨åŒ…æ‹¬ï¼š<strong>å°†ä¸Šå±‚æ•°æ®åˆ†æ®µå¹¶æä¾›ç«¯åˆ°ç«¯çš„ã€å¯é çš„æˆ–ä¸å¯é çš„ä¼ è¾“ä»¥åŠç«¯åˆ°ç«¯çš„å·®é”™æ§åˆ¶å’Œæµé‡æ§åˆ¶é—®é¢˜</strong>ç­‰ã€‚</p><p>ä¼ è¾“å±‚é‡è¦çš„è®¾å¤‡åç§°ï¼š<strong>ç½‘å…³</strong></p><ul><li>ä¼ è¾“å±‚çš„ä»»åŠ¡ï¼š<strong>è´Ÿè´£ä¸»æœºä¸­ä¸¤ä¸ªè¿›ç¨‹ï¼ˆç«¯åˆ°ç«¯ï¼‰ä¹‹é—´çš„é€šä¿¡</strong></li><li>ä¼ è¾“å±‚çš„åŠŸèƒ½ï¼š<ul><li>ä¸ºç«¯åˆ°ç«¯è¿æ¥æä¾›å¯é çš„æœåŠ¡</li><li>ä¸ºç«¯åˆ°ç«¯è¿æ¥æä¾›æµé‡æ§åˆ¶ã€å·®é”™æ§åˆ¶ã€æœåŠ¡è´¨é‡ç­‰ç®¡ç†æœåŠ¡</li></ul></li><li>ä¼ è¾“å±‚ä¼ è¾“å•ä½ï¼š<strong>æŠ¥æ–‡æ®µ</strong>ï¼ˆTCPï¼‰æˆ–<strong>ç”¨æˆ·æ•°æ®æŠ¥</strong>ï¼ˆUDPï¼‰</li><li>ä¼ è¾“å±‚å®ç°çš„ç¡¬ä»¶ï¼š<strong>ç½‘å…³</strong></li><li>åè®®ï¼šTCPã€UDP</li></ul><h2 id="5-2-TCPåè®®">5.2 TCPåè®®</h2><h3 id="æ¦‚è¿°-2">æ¦‚è¿°</h3><p>TCPåè®®å…¨ç§°: <strong>ä¼ è¾“æ§åˆ¶åè®®</strong></p><p>TCPæ˜¯é¢å‘è¿æ¥çš„é€šä¿¡åè®®ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œé€šè®¯å®Œæˆæ—¶è¦æ‹†é™¤è¿æ¥ï¼Œç”±äºTCPæ˜¯é¢å‘è¿æ¥çš„æ‰€ä»¥åªèƒ½ç”¨äº<strong>ç«¯åˆ°ç«¯</strong>çš„é€šè®¯ã€‚TCPæä¾›çš„æ˜¯ä¸€ç§å¯é çš„æ•°æ®æµæœåŠ¡ï¼Œé‡‡ç”¨â€å¸¦é‡ä¼ çš„è‚¯å®šç¡®è®¤â€æŠ€æœ¯æ¥å®ç°ä¼ è¾“çš„å¯é æ€§ã€‚TCPè¿˜é‡‡ç”¨ä¸€ç§ç§°ä¸ºâ€æ»‘åŠ¨çª—å£â€çš„æ–¹å¼è¿›è¡Œæµé‡æ§åˆ¶ï¼Œæ‰€è°“çª—å£å®é™…è¡¨ç¤ºæ¥æ”¶èƒ½åŠ›ï¼Œç”¨ä»¥é™åˆ¶å‘é€æ–¹çš„å‘é€é€Ÿåº¦ã€‚</p><p>æŠ¥å¤´å¦‚ä¸‹ï¼Œé¦–éƒ¨å¤§å°å›ºå®š20å­—èŠ‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210907161940230.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210907161940230.png" class="" title="image-20210907161940230"></a></p><ul><li>æºç«¯å£å·/ç›®çš„ç«¯å£å·: è¡¨ç¤ºæ•°æ®ä»å“ªä¸ªè¿›ç¨‹æ¥, åˆ°å“ªä¸ªè¿›ç¨‹å».</li><li>32ä½åºå·:</li><li>4ä½é¦–éƒ¨é•¿åº¦: æ ‡è¯†è¯¥TCPå¤´éƒ¨æœ‰å¤šå°‘ä¸ª32bitå­—ï¼ˆ4å­—èŠ‚ï¼‰ã€‚å› ä¸º4ä½æœ€å¤§èƒ½æ ‡è¯†15ï¼Œæ‰€ä»¥TCPå¤´éƒ¨æœ€é•¿æ˜¯60å­—èŠ‚ã€‚</li><li>6ä½ä¿ç•™: é¡¾åæ€ä¹‰, å…ˆä¿ç•™ç€, ä»¥é˜²ä¸‡ä¸€</li><li>6ä½æ ‡å¿—ä½</li><li>URG: æ ‡è¯†ç´§æ€¥æŒ‡é’ˆæ˜¯å¦æœ‰æ•ˆ<ul><li>ACK: æ ‡è¯†ç¡®è®¤åºå·æ˜¯å¦æœ‰æ•ˆï¼Œæˆ‘ä»¬ç§°æºå¸¦ACKæ ‡è¯†çš„TCPæŠ¥æ–‡æ®µä¸º<strong>ç¡®è®¤æŠ¥æ–‡</strong>æ®µã€‚</li><li>PSH: ç”¨æ¥æç¤ºæ¥æ”¶ç«¯åº”ç”¨ç¨‹åºç«‹åˆ»å°†æ•°æ®ä»tcpç¼“å†²åŒºè¯»èµ°ï¼Œä¸ºæ¥æ”¶åç»­æ•°æ®è…¾å‡ºç©ºé—´ï¼ˆå¦‚æœåº”ç”¨ç¨‹åºä¸å°†æ¥æ”¶åˆ°çš„æ•°æ®è¯»èµ°ï¼Œå®ƒä»¬å°±ä¼šä¸€ç›´åœç•™åœ¨TCPæ¥æ”¶ç¼“å†²åŒºä¸­</li><li>RST: è¦æ±‚é‡æ–°å»ºç«‹è¿æ¥ã€‚æˆ‘ä»¬æŠŠå«æœ‰RSTæ ‡è¯†çš„æŠ¥æ–‡ç§°ä¸º<strong>å¤ä½æŠ¥æ–‡</strong>æ®µ</li><li>SYN: è¯·æ±‚å»ºç«‹è¿æ¥ã€‚æˆ‘ä»¬æŠŠå«æœ‰SYNæ ‡è¯†çš„æŠ¥æ–‡ç§°ä¸º<strong>åŒæ­¥æŠ¥æ–‡</strong>æ®µ</li><li>FIN: é€šçŸ¥å¯¹ç«¯ï¼Œæœ¬ç«¯å³å°†å…³é—­.ã€‚æˆ‘ä»¬æŠŠå«æœ‰FINæ ‡è¯†çš„æŠ¥æ–‡ç§°ä¸º<strong>ç»“æŸæŠ¥æ–‡</strong>æ®µ</li></ul></li><li>16ä½çª—å£å¤§å°ï¼šæ˜¯TCP<strong>æµé‡æ§åˆ¶</strong>çš„ä¸€ä¸ªæ‰‹æ®µã€‚è¿™é‡Œè¯´çš„çª—å£ï¼ŒæŒ‡çš„æ˜¯<strong>æ¥æ”¶é€šé“çª—å£</strong>ï¼ˆReceiver Windowï¼ŒRWNDï¼‰ã€‚å®ƒå‘Šè¯‰å¯¹æ–¹æœ¬ç«¯çš„TCPæ¥æ”¶ç¼“å†²åŒºè¿˜èƒ½å®¹çº³å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œè¿™æ ·å¯¹æ–¹å°±å¯ä»¥æ§åˆ¶å‘é€æ•°æ®çš„é€Ÿåº¦ã€‚</li><li>16ä½æ£€éªŒå’Œ: ç”±å‘é€ç«¯å¡«å……ï¼Œæ¥æ”¶ç«¯å¯¹TCPæŠ¥æ–‡æ®µæ‰§è¡ŒCRCç®—æ³•ä»¥æ£€éªŒTCPæŠ¥æ–‡æ®µåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸåã€‚æ³¨æ„ï¼Œè¿™ä¸ªæ ¡éªŒä¸ä»…åŒ…æ‹¬TCPå¤´éƒ¨ï¼Œä¹ŸåŒ…æ‹¬æ•°æ®éƒ¨åˆ†ã€‚è¿™ä¹Ÿæ˜¯TCPå¯é ä¼ è¾“çš„ä¸€ä¸ªé‡è¦ä¿éšœã€‚</li><li>16ä½ç´§æ€¥æŒ‡é’ˆ:æ˜¯ä¸€ä¸ªæ­£çš„åç§»é‡ã€‚å®ƒå’Œåºå·å­—æ®µçš„å€¼ç›¸åŠ è¡¨ç¤ºæœ€åä¸€ä¸ªç´§æ€¥æ•°æ®çš„ä¸‹ä¸€å­—èŠ‚çš„åºå·ã€‚å› æ­¤ï¼Œç¡®åˆ‡åœ°è¯´ï¼Œè¿™ä¸ªå­—æ®µæ˜¯ç´§æ€¥æŒ‡é’ˆç›¸å¯¹å½“å‰åºå·çš„åç§»ã€‚TCPçš„ç´§æ€¥æŒ‡é’ˆæ˜¯å‘é€ç«¯å‘æ¥æ”¶ç«¯å‘é€ç´§æ€¥æ•°æ®çš„æ–¹æ³•ã€‚</li><li>é€‰é¡¹å’Œæ•°æ®æš‚æ—¶å¿½ç•¥</li></ul><h3 id="TCPå¦‚ä½•ä¿è¯ä¼ è¾“å¯é æ€§">TCPå¦‚ä½•ä¿è¯ä¼ è¾“å¯é æ€§</h3><h4 id="æ ¡éªŒå’Œ">æ ¡éªŒå’Œ</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">å‘é€çš„æ•°æ®åŒ…çš„äºŒè¿›åˆ¶ç›¸åŠ ç„¶åå–åï¼Œç›®çš„æ˜¯æ£€æµ‹æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•å˜åŒ–ã€‚å¦‚æœæ”¶åˆ°æ®µçš„æ£€éªŒå’Œæœ‰å·®é”™ï¼ŒTCPå°†ä¸¢å¼ƒè¿™ä¸ªæŠ¥æ–‡æ®µå’Œä¸ç¡®è®¤æ”¶åˆ°æ­¤æŠ¥æ–‡æ®µã€‚ <br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>è®¡ç®—æ–¹å¼ï¼šåœ¨æ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œå°†å‘é€çš„æ•°æ®æ®µéƒ½å½“åšä¸€ä¸ª16ä½çš„æ•´æ•°ã€‚å°†è¿™äº›æ•´æ•°åŠ èµ·æ¥ã€‚å¹¶ä¸”å‰é¢çš„è¿›ä½ä¸èƒ½ä¸¢å¼ƒï¼Œè¡¥åœ¨åé¢ï¼Œæœ€åå–åï¼Œå¾—åˆ°æ ¡éªŒå’Œã€‚</p><ul><li>å‘é€æ–¹ï¼šåœ¨å‘é€æ•°æ®ä¹‹å‰è®¡ç®—æ£€éªŒå’Œï¼Œå¹¶è¿›è¡Œæ ¡éªŒå’Œçš„å¡«å……ã€‚</li><li>æ¥æ”¶æ–¹ï¼šæ”¶åˆ°æ•°æ®åï¼Œå¯¹æ•°æ®ä»¥åŒæ ·çš„æ–¹å¼è¿›è¡Œè®¡ç®—ï¼Œæ±‚å‡ºæ ¡éªŒå’Œï¼Œä¸å‘é€æ–¹çš„è¿›è¡Œæ¯”å¯¹ã€‚</li></ul><p>æ³¨æ„ï¼šå¦‚æœæ¥æ”¶æ–¹æ¯”å¯¹æ ¡éªŒå’Œä¸å‘é€æ–¹ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆæ•°æ®ä¸€å®šä¼ è¾“æœ‰è¯¯ã€‚ä½†æ˜¯å¦‚æœæ¥æ”¶æ–¹æ¯”å¯¹æ ¡éªŒå’Œä¸å‘é€æ–¹ä¸€è‡´ï¼Œæ•°æ®ä¸ä¸€å®šä¼ è¾“æˆåŠŸã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210907162918376.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210907162918376.png" class="" title="image-20210907162918376"></a></p><h4 id="ç¡®è®¤åº”ç­”-åºåˆ—å·">ç¡®è®¤åº”ç­”+åºåˆ—å·</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">åº”ç”¨æ•°æ®è¢«åˆ†å‰²æˆ TCP è®¤ä¸ºæœ€é€‚åˆå‘é€çš„æ•°æ®å—ã€‚<br>TCP ç»™å‘é€çš„æ¯ä¸€ä¸ªåŒ…è¿›è¡Œç¼–å·ï¼Œæ¥æ”¶æ–¹å¯¹æ•°æ®åŒ…è¿›è¡Œæ’åºï¼ŒæŠŠæœ‰åºæ•°æ®ä¼ é€ç»™åº”ç”¨å±‚ã€‚<br>TCP çš„æ¥æ”¶ç«¯ä¼šä¸¢å¼ƒé‡å¤çš„æ•°æ®ã€‚<br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><ul><li>åºåˆ—å·ï¼šTCPä¼ è¾“æ—¶å°†æ¯ä¸ªå­—èŠ‚çš„æ•°æ®éƒ½è¿›è¡Œäº†ç¼–å·ï¼Œè¿™å°±æ˜¯åºåˆ—å·ã€‚</li><li>ç¡®è®¤åº”ç­”ï¼šTCPä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡æ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åï¼Œéƒ½ä¼šå¯¹ä¼ è¾“æ–¹è¿›è¡Œç¡®è®¤åº”ç­”ã€‚ä¹Ÿå°±æ˜¯å‘é€ACKæŠ¥æ–‡ã€‚è¿™ä¸ªACKæŠ¥æ–‡å½“ä¸­å¸¦æœ‰å¯¹åº”çš„ç¡®è®¤åºåˆ—å·ï¼Œå‘Šè¯‰å‘é€æ–¹ï¼Œæ¥æ”¶åˆ°äº†å“ªäº›æ•°æ®ï¼Œä¸‹ä¸€æ¬¡çš„æ•°æ®ä»å“ªé‡Œå‘ã€‚</li></ul><p>åºåˆ—å·çš„ä½œç”¨ä¸ä»…ä»…æ˜¯åº”ç­”çš„ä½œç”¨ï¼Œæœ‰äº†åºåˆ—å·èƒ½å¤Ÿå°†æ¥æ”¶åˆ°çš„æ•°æ®æ ¹æ®åºåˆ—å·æ’åºï¼Œå¹¶ä¸”å»æ‰é‡å¤åºåˆ—å·çš„æ•°æ®ã€‚è¿™ä¹Ÿæ˜¯TCPä¼ è¾“å¯é æ€§çš„ä¿è¯ä¹‹ä¸€ã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210907165231469.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210907165231469.png" class="" title="image-20210907165231469"></a></p><h4 id="è¶…æ—¶é‡ä¼ ">è¶…æ—¶é‡ä¼ </h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">å½“TCPå‘å‡ºä¸€ä¸ªæ®µåï¼Œå®ƒå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç­‰å¾…ç›®çš„ç«¯ç¡®è®¤æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡æ®µã€‚å¦‚æœä¸èƒ½åŠæ—¶æ”¶åˆ°ä¸€ä¸ªç¡®è®¤ï¼Œå°†é‡å‘è¿™ä¸ªæŠ¥æ–‡æ®µã€‚ <br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿›è¡ŒTCPä¼ è¾“æ—¶ï¼Œç”±äºç¡®è®¤åº”ç­”ä¸åºåˆ—å·æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´å‘é€æ–¹å‘é€ä¸€éƒ¨åˆ†æ•°æ®åï¼Œéƒ½ä¼šç­‰å¾…æ¥æ”¶æ–¹å‘é€çš„ACKæŠ¥æ–‡ï¼Œå¹¶è§£æACKæŠ¥æ–‡ï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦ä¼ è¾“æˆåŠŸã€‚å¦‚æœå‘é€æ–¹å‘é€å®Œæ•°æ®åï¼Œè¿Ÿè¿Ÿæ²¡æœ‰ç­‰åˆ°æ¥æ”¶æ–¹çš„ACKæŠ¥æ–‡ï¼Œè¿™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè€Œæ²¡æœ‰æ”¶åˆ°ACKæŠ¥æ–‡çš„åŸå› å¯èƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œå‘é€æ–¹æ²¡æœ‰æ¥æ”¶åˆ°å“åº”çš„ACKæŠ¥æ–‡åŸå› å¯èƒ½æœ‰ä¸¤ç‚¹ï¼š</p><ul><li>æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ç”±äºç½‘ç»œåŸå› ç­‰ç›´æ¥å…¨ä½“ä¸¢åŒ…ï¼Œæ¥æ”¶æ–¹æ²¡æœ‰æ¥æ”¶åˆ°ã€‚</li><li>æ¥æ”¶æ–¹æ¥æ”¶åˆ°äº†å“åº”çš„æ•°æ®ï¼Œä½†æ˜¯å‘é€çš„ACKæŠ¥æ–‡å“åº”å´ç”±äºç½‘ç»œåŸå› ä¸¢åŒ…äº†ã€‚</li></ul><p>TCPåœ¨è§£å†³è¿™ä¸ªé—®é¢˜çš„æ—¶å€™å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æœºåˆ¶ï¼Œå«åš<strong>è¶…æ—¶é‡ä¼ æœºåˆ¶</strong>ã€‚ç®€å•ç†è§£å°±æ˜¯å‘é€æ–¹åœ¨å‘é€å®Œæ•°æ®åç­‰å¾…ä¸€ä¸ªæ—¶é—´ï¼ˆé‡Œé¢æœ‰ä¸€ä¸ªè¶…æ—¶è®¡æ•°å™¨ï¼‰ï¼Œæ—¶é—´åˆ°è¾¾æ²¡æœ‰æ¥æ”¶åˆ°ACKæŠ¥æ–‡ï¼Œé‚£ä¹ˆå¯¹åˆšæ‰å‘é€çš„æ•°æ®è¿›è¡Œé‡æ–°å‘é€ã€‚å¦‚æœæ˜¯åˆšæ‰ç¬¬ä¸€ä¸ªåŸå› ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°äºŒæ¬¡é‡å‘çš„æ•°æ®åï¼Œä¾¿è¿›è¡ŒACKåº”ç­”ã€‚å¦‚æœæ˜¯ç¬¬äºŒä¸ªåŸå› ï¼Œæ¥æ”¶æ–¹å‘ç°æ¥æ”¶çš„æ•°æ®å·²å­˜åœ¨ï¼ˆåˆ¤æ–­å­˜åœ¨çš„æ ¹æ®å°±æ˜¯åºåˆ—å·ï¼Œæ‰€ä»¥ä¸Šé¢è¯´åºåˆ—å·è¿˜æœ‰å»é™¤é‡å¤æ•°æ®çš„ä½œç”¨ï¼‰ï¼Œé‚£ä¹ˆç›´æ¥ä¸¢å¼ƒï¼Œä»æ—§å‘é€ACKåº”ç­”ã€‚</p><h5 id="ä¸€èˆ¬æŠ¥æ–‡è¶…æ—¶æ˜¯æ€ä¹ˆç¡®å®šçš„ï¼Ÿ">ä¸€èˆ¬æŠ¥æ–‡è¶…æ—¶æ˜¯æ€ä¹ˆç¡®å®šçš„ï¼Ÿ</h5><p>ä¸€åˆ€åˆ‡çš„åŠæ³•å°±æ˜¯ï¼Œæˆ‘<strong>ç›´æ¥æŠŠè¶…æ—¶æ—¶é—´è®¾æˆä¸€ä¸ªå›ºå®šå€¼</strong>ï¼Œæ¯”å¦‚è¯´ 200msï¼Œä½†è¿™æ ·è‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ï¼Œæˆ‘ä»¬çš„ç”µè„‘å’Œå¾ˆå¤šæœåŠ¡å™¨éƒ½æœ‰äº¤äº’ï¼Œè¿™äº›æœåŠ¡å™¨ä½äºå¤©å—æµ·åŒ—ï¼Œå›½å†…å›½å¤–ï¼Œå»¶è¿Ÿå·®å¼‚å·¨å¤§ï¼Œæ‰€ä»¥è®¾ç½®å›ºå®šå€¼æ˜¯å¾ˆä¸å¯é çš„ï¼Œ<strong>æˆ‘ä»¬è¦æ ¹æ®ç½‘ç»œå»¶è¿Ÿï¼ŒåŠ¨æ€è°ƒæ•´è¶…æ—¶æ—¶é—´</strong>ï¼Œå»¶è¿Ÿè¶Šå¤§ï¼Œè¶…æ—¶æ—¶é—´è¶Šé•¿ã€‚</p><p>åœ¨è¿™é‡Œå…ˆå¼•å…¥ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ul><li>RTTï¼ˆRound Trip Timeï¼‰ï¼šå¾€è¿”æ—¶å»¶ï¼Œä¹Ÿå°±æ˜¯**æ•°æ®åŒ…ä»å‘å‡ºå»åˆ°æ”¶åˆ°å¯¹åº” ACK çš„æ—¶é—´ã€‚**RTT æ˜¯é’ˆå¯¹è¿æ¥çš„ï¼Œæ¯ä¸€ä¸ªè¿æ¥éƒ½æœ‰å„è‡ªç‹¬ç«‹çš„ RTTã€‚</li><li>RTOï¼ˆRetransmission Time Outï¼‰ï¼šé‡ä¼ è¶…æ—¶ï¼Œä¹Ÿå°±æ˜¯å‰é¢è¯´çš„è¶…æ—¶æ—¶é—´ã€‚</li></ul><p>jacobsonç®—æ³•ï¼š</p><p>å·¥ä½œåŸç†æ˜¯ï¼š</p><ol><li>å°†æ¯æ¡è¿æ¥TCPéƒ½ä¿æŒä¸€ä¸ªå˜é‡RTTã€‚</li><li>å½“å‘é€ä¸€ä¸ªæ•°æ®æ®µæ—¶ï¼ŒåŒæ—¶å¯åŠ¨è¿æ¥çš„å®šæ—¶å™¨ã€‚</li><li>å¦‚æœå®šæ—¶å™¨è¶…æ—¶å‰ç¡®è®¤åˆ°è¾¾ï¼Œåˆ™è®°å½•æ‰€éœ€çš„æ—¶é—´ã€‚</li><li>ä¿®æ­£RTTçš„å€¼ã€‚</li><li>å¦‚æœå®šæ—¶å™¨è¶…æ—¶å‰æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œåˆ™å°†RTTçš„å€¼å¢åŠ ä¸€å€ã€‚</li></ol><p>[<img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210410175136539.png" class="" title="image-20210410175136539"></p><p>å‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œè®¾å®šçš„é‡ä¼ æ—¶é—´åˆ°äº†ï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ã€‚äºæ˜¯é‡ä¼ æŠ¥æ–‡æ®µï¼Œç»è¿‡ä¸€æ®µæ—¶é—´åï¼šæ”¶åˆ°äº†ç¡®è®¤æŠ¥æ–‡æ®µã€‚</p><p>ç°åœ¨çš„é—®é¢˜æ˜¯ï¼šå¦‚ä½•åˆ¤å®šæ­¤æŠ¥æ–‡æ®µæ˜¯å¯¹å…ˆå‘é€çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼Œè¿˜æ˜¯å¯¹åæ¥é‡ä¼ çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼Ÿç”±äºé‡ä¼ çš„æŠ¥æ–‡æ®µå’ŒåŸæ¥çš„æŠ¥æ–‡æ®µå®Œå…¨ä¸€æ ·ï¼Œæ‰€ä»¥æºä¸»æœºåœ¨æ¥å—åˆ°ç¡®è®¤åï¼Œæ— æ³•åšå‡ºæ­£ç¡®çš„åˆ¤æ–­ï¼Œè€Œæ­£ç¡®çš„åˆ¤æ–­å¯¹ç¡®å®šåŠ æƒå¹³å‡RTTsçš„å€¼å…³ç³»å¾ˆå¤§ã€‚å› æ­¤äº§ç”Ÿäº†Karnç®—æ³•ï¼Œåªè¦æŠ¥æ–‡æ®µé‡ä¼ äº†ï¼Œå°±ä¸é‡‡ç”¨å…¶å¾€è¿”æ—¶é—´æ ·æœ¬</p><p>Karnç®—æ³•ï¼š</p><ol><li>æŠ¥æ–‡æ®µæ¯é‡ä¼ ä¸€æ¬¡ï¼Œå°±å°†é‡ä¼ æ—¶é—´å¢å¤§ä¸€äº›ï¼š</li><li>æ–°çš„é‡ä¼ æ—¶é—´ = Î³Ã—(æ—§çš„é‡ä¼ æ—¶é—´)</li><li>ç³»æ•° Î³ çš„å…¸å‹å€¼æ˜¯2 ã€‚</li><li>å½“ä¸å†å‘ç”ŸæŠ¥æ–‡æ®µçš„é‡ä¼ æ—¶ï¼Œæ‰æ ¹æ®æŠ¥æ–‡æ®µçš„å¾€è¿”æ—¶å»¶æ›´æ–°å¹³å‡å¾€è¿”æ—¶å»¶ RTT å’Œé‡ä¼ æ—¶é—´çš„æ•°å€¼ã€‚</li></ol><p>å®è·µè¯æ˜ï¼Œè¿™ç§ç­–ç•¥è¾ƒä¸ºåˆç†ã€‚</p><h5 id="SYNæŠ¥æ–‡é‡ä¼ é—´éš”æ—¶é—´">SYNæŠ¥æ–‡é‡ä¼ é—´éš”æ—¶é—´</h5><p>åœ¨å®é™…æƒ…å†µä¸‹ï¼Œç”±äºSYNæŠ¥æ–‡æ˜¯TCPè¿æ¥çš„ç¬¬ä¸€ä¸ªæŠ¥æ–‡ï¼Œå¦‚æœè¯¥æŠ¥æ–‡åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­ä¸¢å¼ƒäº†ï¼Œé‚£ä¹ˆå‘é€æ–¹åˆ™æ— æ³•æµ‹é‡RTTï¼Œä¹Ÿå°±æ— æ³•æ ¹æ®RTTæ¥è®¡ç®—RTOã€‚å› æ­¤ï¼ŒSYNé‡ä¼ çš„ç®—æ³•å°±è¦ç®€å•ä¸€äº›ï¼ŒSYNé‡ä¼ æ—¶é—´é—´éš”ä¸€èˆ¬æ ¹æ®ç³»ç»Ÿå®ç°çš„ä¸åŒç¨æœ‰å·®åˆ«ï¼Œwindowsç³»ç»Ÿä¸€èˆ¬å°†ç¬¬ä¸€æ¬¡é‡ä¼ è¶…æ—¶è®¾ä¸º3ç§’ï¼Œä»¥åæ¯æ¬¡è¶…æ—¶é‡ä¼ æ—¶é—´ä¸ºä¸Šä¸€æ¬¡çš„2å€</p><h5 id="é‡ä¼ æ¬¡æ•°">é‡ä¼ æ¬¡æ•°</h5><p>åœ¨ä¸‰æ¬¡æ¡æ‰‹æ—¶ï¼Œé‡ä¼ æ¬¡æ•°æ—¶å¯ä»¥ç¡®å®šçš„ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">net<span class="hljs-selector-class">.ipv4</span><span class="hljs-selector-class">.tcp_syn_retries</span> = <span class="hljs-number">6</span>        <span class="hljs-comment">//for client, ç”¨äºåœ¨synå‘é€é˜¶æ®µ</span><br>net<span class="hljs-selector-class">.ipv4</span><span class="hljs-selector-class">.tcp_synack_retries</span> = <span class="hljs-number">5</span>     <span class="hljs-comment">//for server, ç”¨äºåœ¨yn-ackå‘é€é˜¶æ®µ</span><br>Copy<br></code></pre></td></tr></table></figure><h5 id="ARQåè®®">ARQåè®®</h5><p>å½“ TCP å‘å‡ºä¸€ä¸ªæ®µåï¼Œå®ƒå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç­‰å¾…ç›®çš„ç«¯ç¡®è®¤æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡æ®µã€‚å¦‚æœä¸èƒ½åŠæ—¶æ”¶åˆ°ä¸€ä¸ªç¡®è®¤ï¼Œå°†é‡å‘è¿™ä¸ªæŠ¥æ–‡æ®µã€‚</p><p>è‡ªåŠ¨é‡ä¼ è¯·æ±‚ï¼ˆAutomatic Repeat-reQuestï¼ŒARQï¼‰æ˜¯OSIæ¨¡å‹ä¸­æ•°æ®é“¾è·¯å±‚çš„é”™è¯¯çº æ­£åè®®ä¹‹ä¸€ã€‚å®ƒåŒ…æ‹¬åœæ­¢ç­‰å¾…ARQåè®®å’Œè¿ç»­ARQåè®®ï¼Œé”™è¯¯ä¾¦æµ‹ï¼ˆError Detectionï¼‰ã€æ­£é¢ç¡®è®¤ï¼ˆPositive Acknowledgmentï¼‰ã€é€¾æ—¶é‡ä¼ ï¼ˆRetransmission after Timeoutï¼‰ä¸è´Ÿé¢ç¡®è®¤ç»§ä»¥é‡ä¼ ï¼ˆNegative Acknowledgment and Retransmissionï¼‰ç­‰æœºåˆ¶ã€‚</p><h4 id="æµé‡æ§åˆ¶">æµé‡æ§åˆ¶</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">TCP è¿æ¥çš„æ¯ä¸€æ–¹éƒ½æœ‰å›ºå®šå¤§å°çš„ç¼“å†²ç©ºé—´ï¼ŒTCPçš„æ¥æ”¶ç«¯åªå…è®¸å‘é€ç«¯å‘é€æ¥æ”¶ç«¯ç¼“å†²åŒºèƒ½æ¥çº³çš„æ•°æ®ã€‚å½“æ¥æ”¶æ–¹æ¥ä¸åŠå¤„ç†å‘é€æ–¹çš„æ•°æ®ï¼Œèƒ½æç¤ºå‘é€æ–¹é™ä½å‘é€çš„é€Ÿç‡ï¼Œé˜²æ­¢åŒ…ä¸¢å¤±ã€‚TCP ä½¿ç”¨çš„æµé‡æ§åˆ¶åè®®æ˜¯å¯å˜å¤§å°çš„æ»‘åŠ¨çª—å£åè®®ã€‚ ï¼ˆTCPåˆ©ç”¨æ»‘åŠ¨çª—å£å®ç°æµé‡æ§åˆ¶ï¼‰<br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>æ¥æ”¶ç«¯åœ¨æ¥æ”¶åˆ°æ•°æ®åï¼Œå¯¹å…¶è¿›è¡Œå¤„ç†ã€‚å¦‚æœå‘é€ç«¯çš„å‘é€é€Ÿåº¦å¤ªå¿«ï¼Œå¯¼è‡´æ¥æ”¶ç«¯çš„ç»“æŸç¼“å†²åŒºå¾ˆå¿«çš„å¡«å……æ»¡äº†ã€‚æ­¤æ—¶å¦‚æœå‘é€ç«¯ä»æ—§å‘é€æ•°æ®ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å‘é€çš„æ•°æ®éƒ½ä¼šä¸¢åŒ…ï¼Œç»§è€Œå¯¼è‡´ä¸¢åŒ…çš„ä¸€ç³»åˆ—è¿é”ååº”ï¼Œè¶…æ—¶é‡ä¼ ä»€ä¹ˆçš„ã€‚è€ŒTCPæ ¹æ®æ¥æ”¶ç«¯å¯¹æ•°æ®çš„å¤„ç†èƒ½åŠ›ï¼Œå†³å®šå‘é€ç«¯çš„å‘é€é€Ÿåº¦ï¼Œè¿™ä¸ªæœºåˆ¶å°±æ˜¯æµé‡æ§åˆ¶ã€‚</p><p>åœ¨TCPåè®®çš„æŠ¥å¤´ä¿¡æ¯å½“ä¸­ï¼Œæœ‰ä¸€ä¸ª16ä½å­—æ®µçš„çª—å£å¤§å°ã€‚åœ¨ä»‹ç»è¿™ä¸ªçª—å£å¤§å°æ—¶æˆ‘ä»¬çŸ¥é“ï¼Œ<strong>çª—å£å¤§å°çš„å†…å®¹å®é™…ä¸Šæ˜¯æ¥æ”¶ç«¯æ¥æ”¶æ•°æ®ç¼“å†²åŒºçš„å‰©ä½™å¤§å°</strong>ã€‚è¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œè¯æ˜æ¥æ”¶ç«¯æ¥æ”¶ç¼“å†²åŒºçš„å‰©ä½™ç©ºé—´è¶Šå¤§ï¼Œç½‘ç»œçš„ååé‡è¶Šå¤§ã€‚æ¥æ”¶ç«¯ä¼šåœ¨ç¡®è®¤åº”ç­”å‘é€ACKæŠ¥æ–‡æ—¶ï¼Œå°†è‡ªå·±çš„å³æ—¶çª—å£å¤§å°å¡«å…¥ï¼Œå¹¶è·ŸéšACKæŠ¥æ–‡ä¸€èµ·å‘é€è¿‡å»ã€‚è€Œå‘é€æ–¹æ ¹æ®ACKæŠ¥æ–‡é‡Œçš„çª—å£å¤§å°çš„å€¼çš„æ”¹å˜è¿›è€Œæ”¹å˜è‡ªå·±çš„å‘é€é€Ÿåº¦ã€‚å¦‚æœæ¥æ”¶åˆ°çª—å£å¤§å°çš„å€¼ä¸º0ï¼Œé‚£ä¹ˆå‘é€æ–¹å°†åœæ­¢å‘é€æ•°æ®ã€‚å¹¶å®šæœŸçš„å‘æ¥æ”¶ç«¯å‘é€çª—å£æ¢æµ‹æ•°æ®æ®µï¼Œè®©æ¥æ”¶ç«¯æŠŠçª—å£å¤§å°å‘Šè¯‰å‘é€ç«¯ã€‚</p><p>æ³¨ï¼š16ä½çš„çª—å£å¤§å°æœ€å¤§èƒ½è¡¨ç¤º65535ä¸ªå­—èŠ‚ï¼ˆ64Kï¼‰ï¼Œä½†æ˜¯TCPçš„çª—å£å¤§å°æœ€å¤§å¹¶ä¸æ˜¯64Kã€‚åœ¨TCPé¦–éƒ¨ä¸­40ä¸ªå­—èŠ‚çš„é€‰é¡¹ä¸­è¿˜åŒ…å«äº†ä¸€ä¸ªçª—å£æ‰©å¤§å› å­Mï¼Œå®é™…çš„çª—å£å¤§å°å°±æ˜¯16ä¸ºçª—å£å­—æ®µçš„å€¼å·¦ç§»Mä½ã€‚æ¯ç§»ä¸€ä½ï¼Œæ‰©å¤§ä¸¤å€ã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210406215601482.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210406215601482.png" class="" title="image-20210406215601482"></a></p><h5 id="å¯å˜æ»‘åŠ¨çª—å£">å¯å˜æ»‘åŠ¨çª—å£</h5><p><a href="https://blog.csdn.net/yao5hed/article/details/81046945">https://blog.csdn.net/yao5hed/article/details/81046945</a></p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210410181120147.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210410181120147.png" class="" title="image-20210410181120147"></a></p><h5 id="æµé‡æ§åˆ¶å¼•å‘çš„æ­»é”ï¼Ÿæ€ä¹ˆé¿å…æ­»é”çš„å‘ç”Ÿï¼Ÿ">æµé‡æ§åˆ¶å¼•å‘çš„æ­»é”ï¼Ÿæ€ä¹ˆé¿å…æ­»é”çš„å‘ç”Ÿï¼Ÿ</h5><p>å½“å‘é€è€…æ”¶åˆ°äº†ä¸€ä¸ªçª—å£ä¸º0çš„åº”ç­”ï¼Œå‘é€è€…ä¾¿åœæ­¢å‘é€ï¼Œç­‰å¾…æ¥æ”¶è€…çš„ä¸‹ä¸€ä¸ªåº”ç­”ã€‚ä½†æ˜¯å¦‚æœè¿™ä¸ªçª—å£ä¸ä¸º0çš„åº”ç­”åœ¨ä¼ è¾“è¿‡ç¨‹ä¸¢å¤±ï¼Œå‘é€è€…ä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œè€Œæ¥æ”¶è€…ä»¥ä¸ºå‘é€è€…å·²ç»æ”¶åˆ°è¯¥åº”ç­”ï¼Œç­‰å¾…æ¥æ”¶æ–°æ•°æ®ï¼Œè¿™æ ·åŒæ–¹å°±ç›¸äº’ç­‰å¾…ï¼Œä»è€Œäº§ç”Ÿæ­»é”ã€‚</p><p>ä¸ºäº†é¿å…æµé‡æ§åˆ¶å¼•å‘çš„æ­»é”ï¼ŒTCPä½¿ç”¨äº†æŒç»­è®¡æ—¶å™¨ã€‚æ¯å½“å‘é€è€…æ”¶åˆ°ä¸€ä¸ªé›¶çª—å£çš„åº”ç­”åå°±å¯åŠ¨è¯¥è®¡æ—¶å™¨ã€‚æ—¶é—´ä¸€åˆ°ä¾¿ä¸»åŠ¨å‘é€æŠ¥æ–‡è¯¢é—®æ¥æ”¶è€…çš„çª—å£å¤§å°ã€‚è‹¥æ¥æ”¶è€…ä»ç„¶è¿”å›é›¶çª—å£ï¼Œåˆ™é‡ç½®è¯¥è®¡æ—¶å™¨ç»§ç»­ç­‰å¾…ï¼›è‹¥çª—å£ä¸ä¸º0ï¼Œåˆ™è¡¨ç¤ºåº”ç­”æŠ¥æ–‡ä¸¢å¤±äº†ï¼Œæ­¤æ—¶é‡ç½®å‘é€çª—å£åå¼€å§‹å‘é€ï¼Œè¿™æ ·å°±é¿å…äº†æ­»é”çš„äº§ç”Ÿã€‚</p><h4 id="æ‹¥å¡æ§åˆ¶">æ‹¥å¡æ§åˆ¶</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">å½“ç½‘ç»œæ‹¥å¡æ—¶ï¼Œå‡å°‘æ•°æ®çš„å‘é€ã€‚<br><br>å‘é€æ–¹æœ‰æ‹¥å¡çª—å£ï¼Œå‘é€æ•°æ®å‰æ¯”å¯¹æ¥æ”¶æ–¹å‘è¿‡æ¥çš„æ¥æ”¶çª—å£ï¼Œå–å°<br><br>æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€æ‹¥å¡å‘é€ã€å¿«é€Ÿæ¢å¤<br>åº”ç”¨æ•°æ®è¢«åˆ†å‰²æˆTCPè®¤ä¸ºæœ€é€‚åˆå‘é€çš„æ•°æ®å—ã€‚TCPçš„æ¥æ”¶ç«¯ä¼šä¸¢å¼ƒé‡å¤çš„æ•°æ®ã€‚ <br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>TCPä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œå‘é€ç«¯å¼€å§‹å‘é€æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœåˆšå¼€å§‹å°±å‘é€å¤§é‡çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±å¯èƒ½é€ æˆä¸€äº›é—®é¢˜ã€‚ç½‘ç»œå¯èƒ½åœ¨å¼€å§‹çš„æ—¶å€™å°±å¾ˆæ‹¥å µï¼Œå¦‚æœç»™ç½‘ç»œä¸­åœ¨æ‰”å‡ºå¤§é‡æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ‹¥å µå°±ä¼šåŠ å‰§ã€‚æ‹¥å µçš„åŠ å‰§å°±ä¼šäº§ç”Ÿå¤§é‡çš„ä¸¢åŒ…ï¼Œå°±å¯¹å¤§é‡çš„è¶…æ—¶é‡ä¼ ï¼Œä¸¥é‡å½±å“ä¼ è¾“ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">å‘é€æ–¹ç»´æŒä¸€ä¸ªæ‹¥å¡çª—å£ cwnd ( congestion <span class="hljs-keyword">window</span> )çš„çŠ¶æ€å˜é‡ã€‚æ‹¥å¡çª—å£çš„å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€åœ°åœ¨å˜åŒ–ã€‚å‘é€æ–¹è®©è‡ªå·±çš„å‘é€çª—å£ç­‰äºæ‹¥å¡ã€‚<br><br>å‘é€æ–¹æ§åˆ¶æ‹¥å¡çª—å£çš„åŸåˆ™æ˜¯ï¼šåªè¦ç½‘ç»œæ²¡æœ‰å‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å°±å†å¢å¤§ä¸€äº›ï¼Œä»¥ä¾¿æŠŠæ›´å¤šçš„åˆ†ç»„å‘é€å‡ºå»ã€‚ä½†åªè¦ç½‘ç»œå‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å°±å‡å°ä¸€äº›ï¼Œä»¥å‡å°‘æ³¨å…¥åˆ°ç½‘ç»œä¸­çš„åˆ†ç»„æ•°ã€‚<br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><h5 id="æ…¢å¯åŠ¨">æ…¢å¯åŠ¨</h5><p>æ‰€ä»¥TCPå¼•å…¥äº†<strong>æ…¢å¯åŠ¨</strong>çš„æœºåˆ¶ï¼Œåœ¨å¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå…ˆå‘é€å°‘é‡çš„æ•°æ®æ¢è·¯ã€‚æ¢æ¸…å½“å‰çš„ç½‘ç»œçŠ¶æ€å¦‚ä½•ï¼Œå†å†³å®šå¤šå¤§çš„é€Ÿåº¦è¿›è¡Œä¼ è¾“ã€‚å‘é€åˆšå¼€å§‹å®šä¹‰æ‹¥å¡çª—å£ä¸º 1ï¼Œæ¯æ¬¡æ”¶åˆ°ACKåº”ç­”ï¼Œæ‹¥å¡çª—å£åŠ  1ã€‚åœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œ<strong>é¦–å…ˆå°†æ‹¥å¡çª—å£ä¸æ¥æ”¶ç«¯åé¦ˆçš„çª—å£å¤§å°æ¯”å¯¹ï¼Œå–è¾ƒå°çš„å€¼ä½œä¸ºå®é™…å‘é€çš„çª—å£ã€‚</strong></p><ul><li>ç®—æ³•æµç¨‹<ul><li>è¿æ¥å»ºå¥½çš„å¼€å§‹å…ˆåˆå§‹åŒ–cwnd = 1(çª—å£)ï¼Œè¡¨æ˜å¯ä»¥ä¼ ä¸€ä¸ª<strong>MSS</strong>ï¼ˆæœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ï¼‰å¤§å°çš„æ•°æ®</li><li>æ¯å½“æ”¶åˆ°ä¸€ä¸ª<strong>ACK</strong>ï¼Œcwnd++ï¼Œçº¿æ€§ä¸Šå‡</li><li>æ¯å½“è¿‡äº†ä¸€ä¸ª<strong>RTT</strong>ï¼Œcwnd = cwnd*2ï¼Œ å‘ˆæŒ‡æ•°ä¸Šå‡ã€‚</li><li>ssthreshï¼ˆslow start thresholdï¼‰ï¼Œæ˜¯ä¸€ä¸ªä¸Šé™ï¼Œå½“cwnd &gt;= ssthreshæ—¶ï¼Œå°±ä¼šè¿›å…¥â€œæ‹¥å¡é¿å…ç®—æ³•â€</li></ul></li></ul><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210410194920966.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210410194920966.png" class="" title="image-20210410194920966"></a></p><h5 id="æ‹¥å¡é¿å…">æ‹¥å¡é¿å…</h5><p>æ‹¥å¡çª—å£çš„å¢é•¿æ˜¯æŒ‡æ•°çº§åˆ«çš„ã€‚æ…¢å¯åŠ¨çš„æœºåˆ¶åªæ˜¯è¯´æ˜åœ¨å¼€å§‹çš„æ—¶å€™å‘é€çš„å°‘ï¼Œå‘é€çš„æ…¢ï¼Œä½†æ˜¯å¢é•¿çš„é€Ÿåº¦æ˜¯éå¸¸å¿«çš„ã€‚ä¸ºäº†æ§åˆ¶æ‹¥å¡çª—å£çš„å¢é•¿ï¼Œä¸èƒ½ä½¿æ‹¥å¡çª—å£å•çº¯çš„åŠ å€ï¼Œè®¾<strong>ç½®ä¸€ä¸ªæ‹¥å¡çª—å£çš„é˜ˆå€¼ï¼Œå½“æ‹¥å¡çª—å£å¤§å°è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¸èƒ½å†æŒ‰ç…§æŒ‡æ•°æ¥å¢é•¿ï¼Œè€Œæ˜¯çº¿æ€§çš„å¢é•¿</strong>ã€‚</p><ul><li>ä¸€èˆ¬æ¥è¯´ssthreshçš„å€¼æ˜¯65535å­—èŠ‚(2çš„16æ¬¡æ–¹)ï¼Œå½“cwndè¾¾åˆ°è¿™ä¸ªå€¼æ—¶å</li><li>ç®—æ³•æµç¨‹<ul><li>æ”¶åˆ°ä¸€ä¸ªACKæ—¶ï¼Œcwnd = cwnd + 1/cwnd</li><li>æ¯è¿‡ä¸€ä¸ªRTTæ—¶ï¼Œcwnd = cwnd + 1</li></ul></li></ul><h5 id="é˜»å¡å‘ç”Ÿ">é˜»å¡å‘ç”Ÿ</h5><p>ä¸€æ—¦å‡ºç°ç½‘ç»œæ‹¥å¡ï¼Œå‘ç”Ÿè¶…æ—¶é‡ä¼ æ—¶ï¼Œæ…¢å¯åŠ¨çš„é˜ˆå€¼ä¼šä¸ºåŸæ¥çš„ä¸€åŠï¼ˆè¿™é‡Œçš„åŸæ¥æŒ‡çš„æ˜¯å‘ç”Ÿç½‘ç»œæ‹¥å¡æ—¶æ‹¥å¡çª—å£çš„å¤§å°ï¼‰ï¼ŒåŒæ—¶æ‹¥å¡çª—å£é‡ç½®ä¸º 1ã€‚</p><p>å½“ä¸¢åŒ…çš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§æƒ…å†µ</p><ul><li>ç­‰åˆ°RTOè¶…æ—¶ï¼Œé‡ä¼ æ•°æ®åŒ…ï¼ŒTCPè®¤ä¸ºè¯¥æƒ…å†µå¤ªç³Ÿç³•äº†<ul><li>sshthreash = swnd / 2</li><li>cwnd é‡ç½®ä¸º1</li><li>è¿›å…¥<strong>æ…¢å¯åŠ¨ç®—æ³•</strong></li></ul></li></ul><p>[<img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210406221637813.png" class="" title="image-20210406221637813"></p><ul><li>å¿«é€Ÿé‡ä¼ ç®—æ³•ï¼Œå³æ”¶åˆ°3ä¸ªé‡å¤çš„ACKå°±å¼€å§‹é‡ä¼ ï¼Œæ— éœ€ç­‰å¾…RTOè¶…æ—¶<ul><li>TCP Tahoeï¼ˆä»£è¡¨ç‰ˆæœ¬ï¼‰çš„å®ç°å’ŒRTOè¶…æ—¶ä¸€æ ·ã€‚</li><li>TCP Renoçš„å®ç°ï¼š<ul><li>cwnd = cwnd / 2</li><li>sshthresh = cwnd</li><li>è¿›å…¥<strong>å¿«é€Ÿæ¢å¤ç®—æ³•</strong>â€”â€”Fast Recovery</li></ul></li></ul></li></ul><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210410200127345.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210410200127345.png" class="" title="image-20210410200127345"></a></p><p>æ‹¥å¡æ§åˆ¶æ˜¯TCPåœ¨ä¼ è¾“æ—¶å°½å¯èƒ½å¿«çš„å°†æ•°æ®ä¼ è¾“ï¼Œå¹¶ä¸”é¿å…æ‹¥å¡é€ æˆçš„ä¸€ç³»åˆ—é—®é¢˜ã€‚æ˜¯å¯é æ€§çš„ä¿è¯ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ç»´æŠ¤äº†ä¼ è¾“çš„é«˜æ•ˆæ€§ã€‚</p><h5 id="å¿«é‡ä¼ å’Œå¿«æ¢å¤">å¿«é‡ä¼ å’Œå¿«æ¢å¤</h5><p><strong>å¿«é‡ä¼ ç®—æ³•è¦æ±‚é¦–å…ˆæ¥æ”¶æ–¹æ”¶åˆ°ä¸€ä¸ªå¤±åºçš„æŠ¥æ–‡æ®µåå°±ç«‹åˆ»å‘å‡ºé‡å¤ç¡®è®¤ï¼Œè€Œä¸è¦ç­‰å¾…è‡ªå·±å‘é€æ•°æ®æ—¶æ‰è¿›è¡Œæå¸¦ç¡®è®¤</strong>ã€‚</p><p>æ¥æ”¶æ–¹æˆåŠŸçš„æ¥å—äº†å‘é€æ–¹å‘é€æ¥çš„M1ã€M2å¹¶ä¸”åˆ†åˆ«ç»™å‘é€äº†ACKï¼Œç°åœ¨æ¥æ”¶æ–¹æ²¡æœ‰æ”¶åˆ°M3ï¼Œè€Œæ¥æ”¶åˆ°äº†M4ï¼Œæ˜¾ç„¶æ¥æ”¶æ–¹ä¸èƒ½ç¡®è®¤M4ï¼Œå› ä¸ºM4æ˜¯å¤±åºçš„æŠ¥æ–‡æ®µã€‚å¦‚æœæ ¹æ®å¯é æ€§ä¼ è¾“åŸç†æ¥æ”¶æ–¹ä»€ä¹ˆéƒ½ä¸åšï¼Œä½†æ˜¯æŒ‰ç…§å¿«é€Ÿé‡ä¼ ç®—æ³•ï¼Œåœ¨æ”¶åˆ°M4ã€M5ç­‰æŠ¥æ–‡æ®µçš„æ—¶å€™ï¼Œä¸æ–­é‡å¤çš„å‘å‘é€æ–¹å‘é€M2çš„ACKï¼Œå¦‚æœæ¥æ”¶æ–¹ä¸€è¿æ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ACKï¼Œé‚£ä¹ˆå‘é€æ–¹ä¸å¿…ç­‰å¾…é‡ä¼ è®¡æ—¶å™¨åˆ°æœŸï¼Œç”±å‘é€æ–¹å°½æ—©é‡ä¼ æœªè¢«ç¡®è®¤çš„æŠ¥æ–‡æ®µã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210410201904592.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210410201904592.png" class="" title="image-20210410201904592"></a></p><p>ä¸å¿«é‡ä¼ é…åˆä½¿ç”¨çš„è¿˜æœ‰<strong>å¿«æ¢å¤</strong>ç®—æ³•ï¼Œå…¶è¿‡ç¨‹æœ‰ä»¥ä¸‹ä¸¤ä¸ªè¦ç‚¹ï¼š</p><ul><li>å½“å‘é€æ–¹è¿ç»­æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤ï¼Œå°±æ‰§è¡Œâ€œä¹˜æ³•å‡å°â€ç®—æ³•ï¼ŒæŠŠæ…¢å¼€å§‹é—¨é™ssthreshå‡åŠã€‚è¿™æ˜¯ä¸ºäº†é¢„é˜²ç½‘ç»œå‘ç”Ÿæ‹¥å¡ã€‚è¯·æ³¨æ„ï¼šæ¥ä¸‹å»ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ã€‚</li><li>ç”±äºå‘é€æ–¹ç°åœ¨è®¤ä¸ºç½‘ç»œå¾ˆå¯èƒ½æ²¡æœ‰å‘ç”Ÿæ‹¥å¡ï¼Œå› æ­¤ä¸æ…¢å¼€å§‹ä¸åŒä¹‹å¤„æ˜¯ç°åœ¨ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼ˆå³æ‹¥å¡çª—å£cwndç°åœ¨ä¸è®¾ç½®ä¸º1ï¼‰ï¼Œè€Œæ˜¯æŠŠcwndå€¼è®¾ç½®ä¸º æ…¢å¼€å§‹é—¨é™ssthreshå‡åŠåçš„æ•°å€¼ï¼Œç„¶åå¼€å§‹æ‰§è¡Œæ‹¥å¡é¿å…ç®—æ³•ï¼ˆâ€œåŠ æ³•å¢å¤§â€ï¼‰ï¼Œä½¿æ‹¥å¡çª—å£ç¼“æ…¢åœ°çº¿æ€§å¢å¤§ã€‚</li></ul><blockquote><p>ä¹Ÿæœ‰çš„å¿«é‡ä¼ å®ç°æ˜¯æŠŠå¼€å§‹æ—¶çš„æ‹¥å¡çª—å£cwndå€¼å†å¢å¤§ä¸€ç‚¹ï¼Œå³ç­‰äº ssthresh + 3 X MSS ã€‚è¿™æ ·åšçš„ç†ç”±æ˜¯ï¼šæ—¢ç„¶å‘é€æ–¹æ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ç¡®è®¤ï¼Œå°±è¡¨æ˜æœ‰ä¸‰ä¸ªåˆ†ç»„å·²ç»ç¦»å¼€äº†ç½‘ç»œã€‚è¿™ä¸‰ä¸ªåˆ†ç»„ä¸å†æ¶ˆè€—ç½‘ç»œ çš„èµ„æºè€Œæ˜¯åœç•™åœ¨æ¥æ”¶æ–¹çš„ç¼“å­˜ä¸­ã€‚å¯è§ç°åœ¨ç½‘ç»œä¸­å¹¶ä¸æ˜¯å †ç§¯äº†åˆ†ç»„è€Œæ˜¯å‡å°‘äº†ä¸‰ä¸ªåˆ†ç»„ã€‚å› æ­¤å¯ä»¥é€‚å½“æŠŠæ‹¥å¡çª—å£æ‰©å¤§äº†äº›ã€‚</p></blockquote><blockquote><h2 id="æµé‡æ§åˆ¶å’Œé˜»å¡æ§åˆ¶çš„åŒºåˆ«">æµé‡æ§åˆ¶å’Œé˜»å¡æ§åˆ¶çš„åŒºåˆ«</h2><ul><li>æµé‡æ§åˆ¶ï¼šæµé‡æ§åˆ¶æ˜¯æ§åˆ¶<strong>ç«¯åˆ°ç«¯çš„é€Ÿç‡</strong>ï¼Œä½œç”¨äºæ¥æ”¶è€…çš„ï¼Œå®ƒæ˜¯æ§åˆ¶å‘é€è€…çš„å‘é€é€Ÿåº¦ä»è€Œä½¿æ¥æ”¶è€…æ¥å¾—åŠæ¥æ”¶ï¼Œé˜²æ­¢åˆ†ç»„ä¸¢å¤±çš„ã€‚</li><li>æ‹¥å¡æ§åˆ¶ï¼šæ‹¥å¡æ§åˆ¶æ˜¯æ§åˆ¶<strong>å…¨å±€ç½‘ç»œçš„é€Ÿç‡</strong>ï¼Œä½œç”¨äºç½‘ç»œçš„ï¼Œå®ƒæ˜¯é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œé¿å…å‡ºç°ç½‘ç»œè´Ÿè½½è¿‡å¤§çš„æƒ…å†µï¼›å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ï¼šï¼ˆ 1 ï¼‰æ…¢å¼€å§‹ã€æ‹¥å¡é¿å…ï¼ˆ 2 ï¼‰å¿«é‡ä¼ ã€å¿«æ¢å¤ã€‚</li></ul><p>æµé‡ï¼Œè€Œæ‹¥å¡æ§åˆ¶ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œ<br>1.å®½å¸¦é€Ÿç‡1Gb/sï¼Œç½‘ç»œåªæœ‰ä¸¤å°æœºå™¨ï¼Œä»ä¸€å°ä¸»æœºä¼ é€æ•°æ®åˆ°å¦ä¸€å°ï¼Œè¿™éœ€è¦æµé‡æ§åˆ¶ï¼Œä»¥ä¿è¯æ¥æ”¶æ–¹èƒ½æ­£å¸¸æ¥æ”¶æ•°æ®ã€‚<br>2.å®½å¸¦é€Ÿç‡1Gb/sï¼Œç½‘ç»œä¸­æœ‰æˆåƒä¸Šä¸‡å°æœºå™¨ï¼Œå‡ ä¸‡å°ä¸»æœºå‘é€åˆ°å¦å¤–å‡ ä¸‡å°ï¼Œè¿™éœ€è¦æ‹¥å¡æ§åˆ¶ï¼Œä¸ç„¶ç½‘ç»œä¼šç˜«ç—ªã€‚<br>æ‰€ä»¥æŠ˜ä¸­ä¸€ä¸‹ï¼Œåœ¨è¿æ¥æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹å¯èƒ½éœ€è¦æµé‡æ§åˆ¶ï¼Œé…åˆæ‹¥å¡æ§åˆ¶ã€‚</p><h2 id="é˜»å¡æ§åˆ¶é¢˜ç›®">é˜»å¡æ§åˆ¶é¢˜ç›®</h2><p>è®¾ TCP çš„ ssthresh ï¼ˆæ…¢å¼€å§‹é—¨é™ï¼‰çš„åˆå§‹å€¼ä¸º 8 ï¼ˆå•ä½ä¸ºæŠ¥æ–‡æ®µï¼‰ã€‚å½“æ‹¥å¡çª—å£ä¸Šå‡åˆ° 12 æ—¶ç½‘ç»œå‘ç”Ÿäº†è¶…æ—¶ï¼Œ TCP ä½¿ç”¨æ…¢å¼€å§‹å’Œæ‹¥å¡é¿å…ã€‚è¯•åˆ†åˆ«æ±‚å‡ºç¬¬ 1 æ¬¡åˆ°ç¬¬ 15 æ¬¡ä¼ è¾“çš„å„æ‹¥å¡çª—å£å¤§å°ã€‚</p><table><thead><tr><th>æ¬¡æ•°</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th></tr></thead><tbody><tr><td>æ‹¥å¡çª—å£å¤§å°</td><td>1</td><td>2</td><td>4</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td><td>1</td><td>2</td><td>4</td><td>6</td><td>7</td><td>8</td><td>9</td></tr></tbody></table></blockquote><h4 id="è¿æ¥ç®¡ç†">è¿æ¥ç®¡ç†</h4><h5 id="ä¸‰æ¬¡æ¡æ‰‹">ä¸‰æ¬¡æ¡æ‰‹</h5><ul><li><p>TCPæœåŠ¡å™¨è¿›ç¨‹å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶å—TCBï¼Œæ—¶åˆ»å‡†å¤‡æ¥å—å®¢æˆ·è¿›ç¨‹çš„è¿æ¥è¯·æ±‚ï¼Œæ­¤æ—¶æœåŠ¡å™¨å°±è¿›å…¥äº†LISTENï¼ˆç›‘å¬ï¼‰çŠ¶æ€ï¼›</p></li><li><p>TCPå®¢æˆ·è¿›ç¨‹ä¹Ÿæ˜¯å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶å—TCBï¼Œç„¶åå‘æœåŠ¡å™¨å‘å‡ºè¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œè¿™æ˜¯æŠ¥æ–‡é¦–éƒ¨ä¸­çš„åŒéƒ¨ä½SYN=1ï¼ŒåŒæ—¶é€‰æ‹©ä¸€ä¸ªåˆå§‹åºåˆ—å· seq=x ï¼Œæ­¤æ—¶ï¼ŒTCPå®¢æˆ·ç«¯è¿›ç¨‹è¿›å…¥äº† SYN-SENTï¼ˆåŒæ­¥å·²å‘é€çŠ¶æ€ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒSYNæŠ¥æ–‡æ®µï¼ˆSYN=1çš„æŠ¥æ–‡æ®µï¼‰ä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†éœ€è¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·ã€‚</p></li><li><p>TCPæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æŠ¥æ–‡åï¼Œå¦‚æœåŒæ„è¿æ¥ï¼Œåˆ™å‘å‡ºç¡®è®¤æŠ¥æ–‡ã€‚ç¡®è®¤æŠ¥æ–‡ä¸­åº”è¯¥ ACK=1ï¼ŒSYN=1ï¼Œç¡®è®¤å·æ˜¯ack=x+1ï¼ŒåŒæ—¶ä¹Ÿè¦ä¸ºè‡ªå·±åˆå§‹åŒ–ä¸€ä¸ªåºåˆ—å· seq=yï¼Œæ­¤æ—¶ï¼ŒTCPæœåŠ¡å™¨è¿›ç¨‹è¿›å…¥äº†SYN-RCVDï¼ˆåŒæ­¥æ”¶åˆ°ï¼‰çŠ¶æ€ã€‚è¿™ä¸ªæŠ¥æ–‡ä¹Ÿä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†æ˜¯åŒæ ·è¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚</p></li><li><p>TCPå®¢æˆ·è¿›ç¨‹æ”¶åˆ°ç¡®è®¤åï¼Œè¿˜è¦å‘æœåŠ¡å™¨ç»™å‡ºç¡®è®¤ã€‚ç¡®è®¤æŠ¥æ–‡çš„ACK=1ï¼Œack=y+1ï¼Œè‡ªå·±çš„åºåˆ—å·seq=x+1ï¼Œæ­¤æ—¶ï¼ŒTCPè¿æ¥å»ºç«‹ï¼Œå®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDï¼ˆå·²å»ºç«‹è¿æ¥ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒACKæŠ¥æ–‡æ®µå¯ä»¥æºå¸¦æ•°æ®ï¼Œä½†æ˜¯å¦‚æœä¸æºå¸¦æ•°æ®åˆ™ä¸æ¶ˆè€—åºå·ã€‚</p></li><li><p>å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¡®è®¤åä¹Ÿè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œæ­¤ååŒæ–¹å°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚</p><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210330145507987.png" class="" title="image-20210330145507987"></li></ul><h5 id="ä¸ºä»€ä¹ˆä¸èƒ½ä¸¤æ¬¡æ¡æ‰‹">ä¸ºä»€ä¹ˆä¸èƒ½ä¸¤æ¬¡æ¡æ‰‹</h5><p>ä¸»è¦æ˜¯<strong>ä¸ºäº†é˜²æ­¢å·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡çªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡å™¨</strong>ï¼Œä»è€Œäº§ç”Ÿé”™è¯¯ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯ä¸¤æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œå‡è®¾æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼Œå®¢æˆ·ç«¯å‘é€çš„ç¬¬ä¸€ä¸ªè¯·æ±‚è¿æ¥å¹¶ä¸”æ²¡æœ‰ä¸¢å¤±ï¼Œåªæ˜¯å› ä¸ºåœ¨ç½‘ç»œä¸­æ»ç•™çš„æ—¶é—´å¤ªé•¿äº†ï¼Œç”±äºTCPçš„å®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ï¼Œä»¥ä¸ºæœåŠ¡å™¨æ²¡æœ‰æ”¶åˆ°ï¼Œæ­¤æ—¶é‡æ–°å‘æœåŠ¡å™¨å‘é€è¿™æ¡æŠ¥æ–‡ï¼Œæ­¤åå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»è¿‡ä¸¤æ¬¡æ¡æ‰‹å®Œæˆè¿æ¥ï¼Œä¼ è¾“æ•°æ®ï¼Œç„¶åå…³é—­è¿æ¥ã€‚æ­¤æ—¶ä¹‹å‰æ»ç•™çš„é‚£ä¸€æ¬¡è¯·æ±‚è¿æ¥ï¼Œå› ä¸ºç½‘ç»œé€šç•…äº†, åˆ°è¾¾äº†æœåŠ¡å™¨ï¼Œè¿™ä¸ªæŠ¥æ–‡æœ¬è¯¥æ˜¯å¤±æ•ˆçš„ï¼Œä½†æ˜¯ï¼Œä¸¤æ¬¡æ¡æ‰‹çš„æœºåˆ¶å°†ä¼šè®©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å†æ¬¡å»ºç«‹è¿æ¥ï¼Œè¿™å°†å¯¼è‡´ä¸å¿…è¦çš„é”™è¯¯å’Œèµ„æºçš„è´¹ã€‚<br>å¦‚æœé‡‡ç”¨çš„æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå°±ç®—æ˜¯é‚£ä¸€æ¬¡å¤±æ•ˆçš„æŠ¥æ–‡ä¼ é€è¿‡æ¥äº†ï¼ŒæœåŠ¡ç«¯æ¥å—åˆ°äº†é‚£æ¡å¤±æ•ˆæŠ¥æ–‡å¹¶ä¸”å›å¤äº†ç¡®è®¤æŠ¥æ–‡ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸ä¼šå†æ¬¡å‘å‡ºç¡®è®¤ã€‚ç”±äºæœåŠ¡å™¨æ”¶ä¸åˆ°ç¡®è®¤ï¼Œå°±çŸ¥é“å®¢æˆ·ç«¯å¹¶æ²¡æœ‰è¯·æ±‚è¿æ¥ã€‚</p><h5 id="å››æ¬¡æŒ¥æ‰‹">å››æ¬¡æŒ¥æ‰‹</h5><ul><li><p>å®¢æˆ·ç«¯è¿›ç¨‹å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚é‡Šæ”¾æ•°æ®æŠ¥æ–‡é¦–éƒ¨ï¼ŒFIN=1ï¼Œå…¶åºåˆ—å·ä¸ºseq=uï¼ˆç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ã€‚ <strong>TCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·</strong>ã€‚</p></li><li><p>æœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK=1ï¼Œack=u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq=vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCPæœåŠ¡å™¨é€šçŸ¥é«˜å±‚çš„åº”ç”¨è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„æ–¹å‘å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªCLOSE-WAITçŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚</p></li><li><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚</p></li><li><p>æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ï¼Œack=u+1ï¼Œç”±äºåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸ºseq=wï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡å™¨å°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚</p></li><li><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œå¿…é¡»å‘å‡ºç¡®è®¤ï¼ŒACK=1ï¼Œack=w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq=u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ³¨æ„æ­¤æ—¶TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2âˆ—MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚</p></li><li><p><strong>æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€</strong>ã€‚åŒæ ·ï¼Œæ’¤é”€TCBåï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸTCPè¿æ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚</p><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210330145711359.png" class="" title="image-20210330145711359"></li></ul><h5 id="ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯æœ€åè¿˜è¦ç­‰å¾…2MSLï¼Ÿ">ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯æœ€åè¿˜è¦ç­‰å¾…2MSLï¼Ÿ</h5><p>MSLï¼ˆMaximum Segment Lifetimeï¼‰ï¼ŒTCPå…è®¸ä¸åŒçš„å®ç°å¯ä»¥è®¾ç½®ä¸åŒçš„MSLå€¼ã€‚</p><p>ç¬¬ä¸€ï¼Œä¿è¯å®¢æˆ·ç«¯å‘é€çš„æœ€åä¸€ä¸ªACKæŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾æœåŠ¡å™¨ï¼Œå› ä¸ºè¿™ä¸ªACKæŠ¥æ–‡å¯èƒ½ä¸¢å¤±ï¼Œç«™åœ¨æœåŠ¡å™¨çš„è§’åº¦çœ‹æ¥ï¼Œæˆ‘å·²ç»å‘é€äº†FIN+ACKæŠ¥æ–‡è¯·æ±‚æ–­å¼€äº†ï¼Œå®¢æˆ·ç«¯è¿˜æ²¡æœ‰ç»™æˆ‘å›åº”ï¼Œåº”è¯¥æ˜¯æˆ‘å‘é€çš„è¯·æ±‚æ–­å¼€æŠ¥æ–‡å®ƒæ²¡æœ‰æ”¶åˆ°ï¼Œäºæ˜¯æœåŠ¡å™¨åˆä¼šé‡æ–°å‘é€ä¸€æ¬¡ï¼Œè€Œå®¢æˆ·ç«¯å°±èƒ½åœ¨è¿™ä¸ª2MSLæ—¶é—´æ®µå†…æ”¶åˆ°è¿™ä¸ªé‡ä¼ çš„æŠ¥æ–‡ï¼Œæ¥ç€ç»™å‡ºå›åº”æŠ¥æ–‡ï¼Œå¹¶ä¸”ä¼šé‡å¯2MSLè®¡æ—¶å™¨ã€‚</p><p>ç¬¬äºŒï¼Œé˜²æ­¢ç±»ä¼¼ä¸â€œä¸‰æ¬¡æ¡æ‰‹â€ä¸­æåˆ°äº†çš„â€œå·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µâ€å‡ºç°åœ¨æœ¬è¿æ¥ä¸­ã€‚å®¢æˆ·ç«¯å‘é€å®Œæœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡åï¼Œåœ¨è¿™ä¸ª2MSLæ—¶é—´ä¸­ï¼Œå°±å¯ä»¥ä½¿æœ¬è¿æ¥æŒç»­çš„æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ã€‚è¿™æ ·æ–°çš„è¿æ¥ä¸­ä¸ä¼šå‡ºç°æ—§è¿æ¥çš„è¯·æ±‚æŠ¥æ–‡ã€‚</p><h3 id="TCPæé«˜æ€§èƒ½çš„æœºåˆ¶">TCPæé«˜æ€§èƒ½çš„æœºåˆ¶</h3><ul><li><p>æ»‘åŠ¨çª—å£ï¼ˆä¸Šé¢å†™äº†ï¼‰</p></li><li><p>å¿«é€Ÿé‡ä¼ ï¼ˆä¸Šé¢å†™äº†ï¼‰</p></li><li><p>å»¶è¿Ÿåº”ç­”</p><ul><li><p>å¦‚æœæ¥æ”¶æ•°æ®çš„ä¸»æœºç«‹åˆ»è¿”å›ACKåº”ç­”, è¿™æ—¶å€™è¿”å›çš„çª—å£å¯èƒ½æ¯”è¾ƒå°ã€‚<br>å‡è®¾æ¥æ”¶ç«¯ç¼“å†²åŒºä¸º1M. ä¸€æ¬¡æ”¶åˆ°äº†500Kçš„æ•°æ®ï¼Œå¦‚æœç«‹åˆ»åº”ç­”, è¿”å›çš„çª—å£å¤§å°å°±æ˜¯500Kã€‚ä½†å®é™…ä¸Šå¯èƒ½å¤„ç†ç«¯å¤„ç†çš„é€Ÿåº¦å¾ˆå¿«, 10msä¹‹å†…å°±æŠŠ500Kæ•°æ®ä»ç¼“å†²åŒºæ¶ˆè´¹æ‰äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, æ¥æ”¶ç«¯å¤„ç†è¿˜è¿œæ²¡æœ‰è¾¾åˆ°è‡ªå·±çš„æé™, å³ä½¿çª—å£å†æ”¾å¤§ä¸€äº›, ä¹Ÿèƒ½å¤„ç†è¿‡æ¥ï¼Œå¦‚æœæ¥æ”¶ç«¯ç¨å¾®ç­‰ä¸€ä¼šå„¿å†åº”ç­”ï¼Œæ¯”å¦‚ç­‰å¾…200mså†åº”ç­”, é‚£ä¹ˆè¿™ä¸ªæ—¶å€™è¿”å›çš„çª—å£å¤§å°å°±æ˜¯1Mã€‚</p></li><li><p>ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®åŒ…éƒ½å¯ä»¥å»¶è¿Ÿåº”ç­”ï¼Œæœ‰ä¸¤ä¸ªé™åˆ¶</p><ul><li>æ•°é‡é™åˆ¶: æ¯éš”Nä¸ªåŒ…å°±åº”ç­”ä¸€æ¬¡</li><li>æ—¶é—´é™åˆ¶: è¶…è¿‡æœ€å¤§å»¶è¿Ÿæ—¶é—´å°±åº”ç­”ä¸€æ¬¡</li></ul><blockquote><p>ä¸€èˆ¬ N å–2, æœ€å¤§å»¶è¿Ÿæ—¶é—´å–200ms</p></blockquote></li></ul></li><li><p>æå¸¦åº”ç­”</p><ul><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨åº”ç”¨å±‚ä¹Ÿæ˜¯ â€œä¸€å‘ä¸€æ”¶â€ çš„ï¼Œæ„å‘³ç€å®¢æˆ·ç«¯ç»™æœåŠ¡å™¨è¯´äº† â€œHow are youâ€ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šç»™å®¢æˆ·ç«¯å›ä¸€ä¸ª â€œFine, thank youâ€ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ACKå°±å¯ä»¥æ­é¡ºé£è½¦, å’ŒæœåŠ¡å™¨å›åº”çš„ â€œFine, thank youâ€ ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯</li></ul></li></ul><h3 id="TCP-ç²˜åŒ…-æ‹†åŒ…çš„åŸå› åŠè§£å†³æ–¹æ³•">TCP ç²˜åŒ…/æ‹†åŒ…çš„åŸå› åŠè§£å†³æ–¹æ³•</h3><p>TCPæ˜¯ä»¥æµçš„æ–¹å¼æ¥å¤„ç†æ•°æ®ï¼Œä¸€ä¸ªå®Œæ•´çš„åŒ…å¯èƒ½ä¼šè¢«TCPæ‹†åˆ†æˆå¤šä¸ªåŒ…è¿›è¡Œå‘é€ï¼Œä¹Ÿå¯èƒ½æŠŠå°çš„å°è£…æˆä¸€ä¸ªå¤§çš„æ•°æ®åŒ…å‘é€ã€‚</p><p>é¦–å…ˆè¦æ˜ç¡®ï¼Œç²˜åŒ…é—®é¢˜ä¸­çš„ â€œåŒ…â€ï¼Œæ˜¯æŒ‡åº”ç”¨å±‚çš„æ•°æ®åŒ…ã€‚åœ¨TCPçš„åè®®å¤´ä¸­,ï¼Œæ²¡æœ‰å¦‚åŒUDPä¸€æ ·çš„ â€œæŠ¥æ–‡é•¿åº¦â€ å­—æ®µï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªåºå·å­—æ®µã€‚<br>ç«™åœ¨ä¼ è¾“å±‚çš„è§’åº¦ï¼ŒTCPæ˜¯ä¸€ä¸ªä¸€ä¸ªæŠ¥æ–‡ä¼ è¿‡æ¥çš„ï¼ŒæŒ‰ç…§åºå·æ’å¥½åºæ”¾åœ¨ç¼“å†²åŒºä¸­ã€‚<br>ç«™åœ¨åº”ç”¨å±‚çš„è§’åº¦ï¼Œçœ‹åˆ°çš„åªæ˜¯ä¸€ä¸²è¿ç»­çš„å­—èŠ‚æ•°æ®ã€‚<br>é‚£ä¹ˆåº”ç”¨ç¨‹åºçœ‹åˆ°äº†è¿™ä¸€è¿ä¸²çš„å­—èŠ‚æ•°æ®ï¼Œå°±ä¸çŸ¥é“ä»å“ªä¸ªéƒ¨åˆ†å¼€å§‹åˆ°å“ªä¸ªéƒ¨åˆ†æ˜¯ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨å±‚æ•°æ®åŒ…ã€‚æ­¤æ—¶æ•°æ®ä¹‹é—´å°±æ²¡æœ‰äº†è¾¹ç•Œ, å°±äº§ç”Ÿäº†ç²˜åŒ…é—®é¢˜</p><p>TCPç²˜åŒ…/åˆ†åŒ…çš„åŸå› ï¼š</p><p>åº”ç”¨ç¨‹åºå†™å…¥çš„å­—èŠ‚å¤§å°å¤§äºå¥—æ¥å­—å‘é€ç¼“å†²åŒºçš„å¤§å°ï¼Œä¼šå‘ç”Ÿæ‹†åŒ…ç°è±¡ï¼Œè€Œåº”ç”¨ç¨‹åºå†™å…¥æ•°æ®å°äºå¥—æ¥å­—ç¼“å†²åŒºå¤§å°ï¼Œç½‘å¡å°†åº”ç”¨å¤šæ¬¡å†™å…¥çš„æ•°æ®å‘é€åˆ°ç½‘ç»œä¸Šï¼Œè¿™å°†ä¼šå‘ç”Ÿç²˜åŒ…ç°è±¡ï¼›</p><p>è¿›è¡ŒMSSå¤§å°çš„TCPåˆ†æ®µï¼Œå½“TCPæŠ¥æ–‡é•¿åº¦-TCPå¤´éƒ¨é•¿åº¦&gt;MSSçš„æ—¶å€™å°†å‘ç”Ÿæ‹†åŒ…</p><p>ä»¥å¤ªç½‘å¸§çš„payloadï¼ˆå‡€è·ï¼‰å¤§äºMTUï¼ˆ1500å­—èŠ‚ï¼‰è¿›è¡Œipåˆ†ç‰‡ã€‚</p><p>è§£å†³æ–¹æ³•</p><p><strong>æ¶ˆæ¯å®šé•¿</strong>ï¼šFixedLengthFrameDecoderç±»</p><p>åŒ…å°¾å¢åŠ ç‰¹æ®Šå­—ç¬¦åˆ†å‰²ï¼šè¡Œåˆ†éš”ç¬¦ç±»ï¼šLineBasedFrameDecoderæˆ–è‡ªå®šä¹‰åˆ†éš”ç¬¦ç±» ï¼šDelimiterBasedFrameDecoder</p><p>å°†æ¶ˆæ¯åˆ†ä¸ºæ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ï¼šLengthFieldBasedFrameDecoderç±»ã€‚åˆ†ä¸ºæœ‰å¤´éƒ¨çš„æ‹†åŒ…ä¸ç²˜åŒ…ã€é•¿åº¦å­—æ®µåœ¨å‰ä¸”æœ‰å¤´éƒ¨çš„æ‹†åŒ…ä¸ç²˜åŒ…ã€å¤šæ‰©å±•å¤´éƒ¨çš„æ‹†åŒ…ä¸ç²˜åŒ…ã€‚</p><p>**å¯¹äºUDPåè®®æ¥è¯´, æ˜¯å¦ä¹Ÿå­˜åœ¨ â€œç²˜åŒ…é—®é¢˜â€ **</p><p>å¯¹äºUDP, å¦‚æœè¿˜æ²¡æœ‰å‘ä¸Šå±‚äº¤ä»˜æ•°æ®, UDPçš„æŠ¥æ–‡é•¿åº¦ä»ç„¶å­˜åœ¨.åŒæ—¶, UDPæ˜¯ä¸€ä¸ªä¸€ä¸ªæŠŠæ•°æ®äº¤ä»˜ç»™åº”ç”¨å±‚çš„, å°±æœ‰å¾ˆæ˜ç¡®çš„æ•°æ®è¾¹ç•Œ.<br>ç«™åœ¨åº”ç”¨å±‚çš„è§’åº¦, ä½¿ç”¨UDPçš„æ—¶å€™, è¦ä¹ˆæ”¶åˆ°å®Œæ•´çš„UDPæŠ¥æ–‡, è¦ä¹ˆä¸æ”¶.ä¸ä¼šå‡ºç°æ”¶åˆ° â€œåŠä¸ªâ€ çš„æƒ…å†µ.</p><h3 id="åŠè¿æ¥æ”»å‡»å’Œå…¨è¿æ¥æ”»å‡»">åŠè¿æ¥æ”»å‡»å’Œå…¨è¿æ¥æ”»å‡»</h3><p>tcpé€šä¿¡æ˜¯ä¸€ä¸ªé¢å‘è¿æ¥çš„è¿‡ç¨‹ï¼Œå®¢æˆ·ç«¯è¦å’ŒæœåŠ¡ç«¯è¿æ¥ï¼Œå¿…é¡»è¿›è¡Œè¿æ¥æ‰èƒ½è¿›è¡Œé€šä¿¡ã€‚åœ¨tcpè¿æ¥ä¸­ï¼Œæœ‰ä¸¤ç§è¿æ¥æ”»å‡»æ–¹å¼ï¼Œæ˜¯åŠè¿æ¥æ”»å‡»æœºå’Œå…¨è¿æ¥æ”»å‡»ã€‚</p><h4 id="åŠè¿æ¥æ”»å‡»ï¼ˆsynæ³›æ´ªï¼‰">åŠè¿æ¥æ”»å‡»ï¼ˆsynæ³›æ´ªï¼‰</h4><p>åŠè¿æ¥æ”»å‡»æ˜¯ä¸€ç§æ”»å‡»åè®®æ ˆçš„æ”»å‡»æ–¹å¼ï¼Œå¦ç™½è¯´å°±æ˜¯æ”»å‡»ä¸»æœºçš„ä¸€ç§æ”»å‡»æ–¹å¼ã€‚é€šè¿‡å°†ä¸»æœºçš„èµ„æºæ¶ˆè€—æ®†å°½ï¼Œä»è€Œå¯¼è‡´åº”ç”¨å±‚çš„ç¨‹åºæ— èµ„æºå¯ç”¨ï¼Œå¯¼è‡´æ— æ³•è¿è¡Œã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯éœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œé¦–å…ˆå®¢æˆ·ç«¯æ„é€ ä¸€ä¸ªSYNè¿æ¥æ•°æ®åŒ…å‘é€è‡³æœåŠ¡ç«¯ï¼Œè‡ªèº«è¿›å…¥SYN_SENDçŠ¶æ€ï¼Œå½“æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„SYNåŒ…ä¹‹åï¼Œä¸ºå…¶åˆ†é…å†…å­˜æ ¸å¿ƒå†…å­˜ï¼Œå¹¶å°†å…¶æ”¾ç½®åœ¨åŠè¿æ¥é˜Ÿåˆ—ä¸­ï¼ŒæœåŠ¡ç«¯æ¥æ”¶å®¢æˆ·SYNåŒ…å¹¶ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªSYNåŒ…å’ŒACKåŒ…ï¼Œæ­¤åˆ»æœåŠ¡ç«¯è¿›å…¥SYN_RECVæ€ã€‚å®¢æˆ·ç«¯æ”¶åˆ°åŒ…ä¹‹åï¼Œå†æ¬¡å‘æœåŠ¡ç«¯å‘é€ACKç¡®è®¤åŒ…ã€‚è‡³æ­¤è¿æ¥å»ºç«‹å®Œæˆï¼ŒåŒæ–¹éƒ½è¿›å…¥ESTABLSHEDZçŠ¶æ€ã€‚åŠè¿æ¥å°±æ˜¯é€šè¿‡ä¸æ–­åœ°æ„é€ å®¢æˆ·ç«¯çš„SYNè¿æ¥æ•°æ®åŒ…å‘å‘æœåŠ¡ç«¯ï¼Œç­‰åˆ°æœåŠ¡ç«¯çš„åŠè¿æ¥é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œåç»­çš„æ­£å¸¸ç”¨æˆ·çš„è¿æ¥è¯·æ±‚å°†ä¼šè¢«ä¸¢å¼ƒï¼Œä»è€Œæ— æ³•è¿æ¥åˆ°æœåŠ¡ç«¯ã€‚æ­¤ä¸ºåŠè¿æ¥æ”»å‡»æ–¹å¼ã€‚æ ¹æ®æœåŠ¡ç«¯çš„åŠè¿æ¥é˜Ÿåˆ—çš„å¤§å°ï¼Œä¸åŒä¸»æœºçš„æŠµæŠ—è¿™ç§SYNæ”»å‡»çš„èƒ½åŠ›ä¹Ÿæ˜¯ä¸ä¸€æ ·ã€‚</p><p>å¦‚ä½•æ¥è§£å†³åŠè¿æ¥æ”»å‡»ï¼Ÿ</p><p>å¯ä»¥é€šè¿‡æ‹“å±•åŠè¿æ¥é˜Ÿåˆ—çš„å¤§å°ï¼Œæ¥è¿›è¡Œè¡¥æ•‘ï¼Œä½†ç¼ºç‚¹æ˜¯ï¼Œä¸èƒ½æ— é™åˆ¶çš„å¢åŠ ï¼Œè¿™æ ·ä¼šè€—è´¹è¿‡å¤šçš„æœåŠ¡ç«¯èµ„æºï¼Œå¯¼è‡´æœåŠ¡ç«¯æ€§èƒ½åœ°ä¸‹ã€‚è¿™ç§æ–¹å¼å‡ ä¹ä¸å¯å–ã€‚ç°ä¸»è¦é€šsyn cookieæˆ–è€…synä¸­ç»§æœºåˆ¶æ¥é˜²èŒƒåŠè¿æ¥æ”»ï¼Œéƒ¨ä½åŠè¿æ¥åˆ†é…æ ¸å¿ƒå†…å­˜çš„æ–¹å¼æ¥é˜²èŒƒã€‚</p><h4 id="å…¨è¿æ¥æ”»å‡»">å…¨è¿æ¥æ”»å‡»</h4><p>å…¨è¿æ¥æ”»å‡»æ˜¯é€šè¿‡æ¶ˆè´¹æœåŠ¡ç«¯è¿›ç¨‹æ•°å’Œè¿æ¥æ•°ï¼Œåªè¿æ¥è€Œä¸è¿›è¡Œå‘é€æ•°æ®çš„ä¸€ç§æ”»å‡»æ–¹å¼ã€‚å½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡ç«¯ï¼Œä»…ä»…åªæ˜¯è¿æ¥ï¼Œæ­¤æ—¶æœåŠ¡ç«¯ä¼šä¸ºæ¯ä¸€ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æ¥å¤„ç†å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ã€‚ä½†æ˜¯å®¢æˆ·ç«¯åªæ˜¯è¿æ¥è€Œä¸å‘é€æ•°æ®ï¼Œæ­¤æ—¶æœåŠ¡ç«¯ä¼šä¸€ç›´é˜»å¡åœ¨recvæˆ–è€…readçš„çŠ¶æ€ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œå¤šä¸ªè¿æ¥ï¼ŒæœåŠ¡ç«¯çš„æ¯ä¸ªè¿æ¥éƒ½æ˜¯å‡ºäºé˜»å¡çŠ¶æ€ä»è€Œå¯¼è‡´æœåŠ¡ç«¯çš„å´©æºƒã€‚</p><p>å¦‚ä½•æ¥è§£å†³å…¨è¿æ¥æ”»å‡»ï¼Ÿ</p><p>å¯ä»¥é€šè¿‡ä¸ä¸ºå…¨è¿æ¥åˆ†é…è¿›ç¨‹å¤„ç†çš„æ–¹å¼æ¥é˜²èŒƒå…¨è¿æ¥æ”»å‡»ï¼Œå…·ä½“çš„æƒ…å†µæ˜¯å½“æ”¶åˆ°æ•°æ®ä¹‹åï¼Œåœ¨ä¸ºå…¶åˆ†é…ä¸€ä¸ªå¤„ç†çº¿ç¨‹ã€‚å…·ä½“çš„å¤„ç†æ–¹å¼åœ¨acceptè¿”å›ä¹‹å‰æ˜¯ä¸åˆ†é…å¤„ç†çº¿ç¨‹çš„ã€‚ç›´åˆ°æ¥æ”¶ç›¸å…³çš„æ•°æ®ä¹‹åæ‰ä¸ºä¹‹æä¾›ä¸€ä¸ªå¤„ç†è¿‡ç¨‹ã€‚ä¾‹å¦‚åœ¨apacheæœåŠ¡ä¸­ï¼Œæ˜¯é€šè¿‡é¢„åˆ›å»ºä¸€å®šé‡çš„å­è¿›ç¨‹ä½œä¸ºå¤„ç†è¿æ¥ç»§æ‰¿ã€‚æ‰€æœ‰çš„è‡ªå·±è¿›ç¨‹éƒ½ç»§æ‰¿çˆ¶è¿›ç¨‹çš„sockfdï¼Œæ¯å½“æœ‰ä¸€ä¸ªè¿æ¥è¿‡æ¥æ—¶ï¼Œåªæœ‰å½“acceptè¿”å›æ˜¯ï¼Œæ‰ä¼šä¸ºè¯¥é“¾æ¥åˆ†é…ä¸€ä¸ªè¿›ç¨‹æ¥å¤„ç†è¿æ¥è¯·æ±‚ã€‚è´Ÿè´£ï¼Œå­è¿›ç¨‹ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚å¦‚æœå‡ºç°å€¼æ˜¯è¿æ¥å­˜åœ¨ï¼Œè€Œå§‹ç»ˆä¸æ”¾æ•°æ®ï¼Œè¯¥é“¾æ¥çš„çŠ¶æ€æ˜¯SYN_RECVï¼Œåœ¨åè®®æ ˆä¸­ï¼Œæä¾›ä¸€ä¸ªä¿æ´»æœŸç»™è¯¥é“¾æ¥ï¼Œå¦‚æœè¶…è¿‡ä¿æ´»æœŸè¿˜æ²¡æœ‰æ•°æ®åˆ°æ¥ï¼ŒæœåŠ¡ç«¯åè®®æ ˆå°†ä¼šæ–­å¼€è¯¥é“¾æ¥ã€‚å¦‚æœæ²¡æœ‰è¯¥ä¿æ´»æœŸï¼Œè™½ç„¶é¿å…äº†ESTABLESHEDçŠ¶æ€çš„æ•°é‡ï¼Œä½†æ˜¯SYN_RECVçš„æ•°æ®é‡çš„å¢é•¿ä»æ—§æ˜¯ä¸å¯ä¼°ç®—çš„ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨ä¿æ´»æœŸæ¥ç›‘æ§è¯¥é“¾æ¥æ˜¯éœ€è¦æ¸…é™¤æ–­å¼€ã€‚</p><h2 id="5-3-Socket">5.3 Socket</h2><h3 id="å¦‚ä½•ä½¿ç”¨socketå®ç°å¯é è¿æ¥">å¦‚ä½•ä½¿ç”¨socketå®ç°å¯é è¿æ¥</h3><p>socketsï¼ˆå¥—æ¥å­—ï¼‰ç¼–ç¨‹æœ‰ä¸‰ç§ï¼šæµå¼å¥—æ¥å­—ï¼ˆSOCK_STREAMï¼‰ï¼Œæ•°æ®æŠ¥å¥—æ¥å­—ï¼ˆSOCK_DGRAMï¼‰ï¼ŒåŸå§‹å¥—æ¥å­—ï¼ˆSOCK_RAWï¼‰ï¼›åŸºäºTCPçš„socketç¼–ç¨‹æ˜¯é‡‡ç”¨çš„æµå¼å¥—æ¥å­—ã€‚</p><ul><li>æœåŠ¡å™¨ç«¯ç¼–ç¨‹çš„æ­¥éª¤</li></ul><p>ï¼ˆ1ï¼‰åŠ è½½å¥—æ¥å­—åº“ï¼Œåˆ›å»ºå¥—æ¥å­—(WSAStartup()/socket())ï¼›</p><p>ï¼ˆ2ï¼‰ç»‘å®šå¥—æ¥å­—åˆ°ä¸€ä¸ªIPåœ°å€å’Œä¸€ä¸ªç«¯å£ä¸Š(bind())ï¼›</p><p>ï¼ˆ3ï¼‰å°†å¥—æ¥å­—è®¾ç½®ä¸ºç›‘å¬æ¨¡å¼ç­‰å¾…è¿æ¥è¯·æ±‚(listen())ï¼›</p><p>ï¼ˆ4ï¼‰è¯·æ±‚åˆ°æ¥åï¼Œæ¥å—è¿æ¥è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å¯¹åº”äºæ­¤æ¬¡è¿æ¥çš„å¥—æ¥å­—(accept())ï¼›</p><p>ï¼ˆ5ï¼‰ç”¨è¿”å›çš„å¥—æ¥å­—å’Œå®¢æˆ·ç«¯]è¿›è¡Œé€šä¿¡(send()/recv())ï¼›</p><p>ï¼ˆ6ï¼‰è¿”å›ï¼Œç­‰å¾…å¦ä¸€è¿æ¥è¯·æ±‚ï¼›</p><p>ï¼ˆ7ï¼‰å…³é—­å¥—æ¥å­—ï¼Œå…³é—­åŠ è½½çš„å¥—æ¥å­—åº“(closesocket()/WSACleanup())ã€‚</p><ul><li>å®¢æˆ·ç«¯ç¼–ç¨‹çš„æ­¥éª¤ï¼š</li></ul><p>ï¼ˆ1ï¼‰åŠ è½½å¥—æ¥å­—åº“ï¼Œåˆ›å»ºå¥—æ¥å­—(WSAStartup()/socket())ï¼›</p><p>ï¼ˆ2ï¼‰å‘æœåŠ¡å™¨å‘å‡ºè¿æ¥è¯·æ±‚(connect())ï¼›</p><p>ï¼ˆ3ï¼‰å’ŒæœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡(send()/recv())ï¼›</p><p>ï¼ˆ4ï¼‰å…³é—­å¥—æ¥å­—ï¼Œå…³é—­åŠ è½½çš„å¥—æ¥å­—åº“(closesocket()/WSACleanup())ã€‚</p><hr><h1>å…­ã€ä¼šè¯å±‚</h1><h2 id="6-1-æ¦‚è¿°">6.1 æ¦‚è¿°</h2><p><strong>ä¼šè¯å±‚</strong>ï¼šä¼šè¯å±‚ç®¡ç†ä¸»æœºä¹‹é—´çš„ä¼šè¯è¿›ç¨‹ï¼Œå³è´Ÿè´£å»ºç«‹ã€ç®¡ç†ã€ç»ˆæ­¢è¿›ç¨‹ä¹‹é—´çš„ä¼šè¯ã€‚ä¼šè¯å±‚è¿˜åˆ©ç”¨åœ¨æ•°æ®ä¸­æ’å…¥æ ¡éªŒç‚¹æ¥å®ç°æ•°æ®çš„åŒæ­¥ã€‚</p><ul><li>ä¼šè¯å±‚çš„ä»»åŠ¡ï¼šä¸åŒä¸»æœºä¸Šå„è¿›ç¨‹é—´çš„å¯¹è¯</li><li>ä¼šè¯å±‚çš„åŠŸèƒ½ï¼šç®¡ç†ä¸»æœºé—´çš„ä¼šè¯è¿›ç¨‹ï¼ŒåŒ…æ‹¬å»ºç«‹ã€ç®¡ç†ä»¥åŠç»ˆæ­¢è¿›ç¨‹é—´çš„ä¼šè¯ã€‚æ˜¯ä¸€ç§<strong>ç«¯åˆ°ç«¯</strong>çš„æœåŠ¡</li></ul><hr><h1>ä¸ƒã€è¡¨ç¤ºå±‚</h1><h2 id="7-1-æ¦‚è¿°">7.1 æ¦‚è¿°</h2><p><strong>è¡¨ç¤ºå±‚</strong>ï¼šè¡¨ç¤ºå±‚å¯¹ä¸Šå±‚æ•°æ®æˆ–ä¿¡æ¯è¿›è¡Œå˜æ¢ä»¥ä¿è¯ä¸€ä¸ªä¸»æœºåº”ç”¨å±‚ä¿¡æ¯å¯ä»¥è¢«å¦ä¸€ä¸ªä¸»æœºçš„åº”ç”¨ç¨‹åºç†è§£ã€‚è¡¨ç¤ºå±‚çš„æ•°æ®è½¬æ¢åŒ…æ‹¬æ•°æ®çš„åŠ å¯†ã€å‹ç¼©ã€æ ¼å¼è½¬æ¢ç­‰ã€‚</p><p>è´Ÿè´£å¤„ç†åœ¨ä¸¤ä¸ªå†…éƒ¨æ•°æ®è¡¨ç¤ºç»“æ„ä¸åŒçš„é€šä¿¡ç³»ç»Ÿä¹‹é—´äº¤æ¢ä¿¡æ¯çš„è¡¨ç¤ºæ ¼å¼ï¼Œä¸ºæ•°æ®åŠ å¯†å’Œè§£å¯†ä»¥åŠä¸ºæé«˜ä¼ è¾“æ•ˆç‡æä¾›å¿…éœ€çš„æ•°æ®å‹ç¼©ä»¥åŠè§£å‹ç­‰åŠŸèƒ½ã€‚</p><hr><h1>å…«ã€åº”ç”¨å±‚</h1><h2 id="8-1-æ¦‚è¿°">8.1 æ¦‚è¿°</h2><p><strong>åº”ç”¨å±‚</strong>ï¼šä¸ºæ“ä½œç³»ç»Ÿæˆ–ç½‘ç»œåº”ç”¨ç¨‹åºæä¾›è®¿é—®ç½‘ç»œæœåŠ¡çš„æ¥å£ã€‚</p><ul><li>åº”ç”¨å±‚çš„ä»»åŠ¡ï¼šæä¾›ç³»ç»Ÿä¸ç”¨æˆ·çš„æ¥å£</li><li>åº”ç”¨å±‚çš„åŠŸèƒ½ï¼š<ul><li>æ–‡ä»¶ä¼ è¾“</li><li>è®¿é—®å’Œç®¡ç†</li><li>ç”µå­é‚®ä»¶æœåŠ¡</li></ul></li><li>åè®®ï¼šFTPã€SMTPã€POP3ã€HTTPã€DNSã€TELnet</li></ul><h2 id="8-2-ä»è¾“å…¥URLåˆ°æµè§ˆå™¨æ˜¾ç¤ºé¡µé¢çš„æµç¨‹">8.2 ä»è¾“å…¥URLåˆ°æµè§ˆå™¨æ˜¾ç¤ºé¡µé¢çš„æµç¨‹</h2><h3 id="URLè§£æ">URLè§£æ</h3><h4 id="1ã€åœ°å€è§£æ">1ã€åœ°å€è§£æ</h4><p>æµè§ˆå™¨ä¼šæ ¹æ®ä½ çš„è¾“å…¥æ¥åˆ¤æ–­è¯¥è¾“å…¥æ˜¯ä¸€æ¡åˆæ³•çš„URLï¼Œè¿˜æ˜¯éœ€è¦è¢«æœç´¢çš„å…³é”®è¯ã€‚å¹¶ä¸”æ ¹æ®ä½ è¾“å…¥çš„å†…å®¹è¿›è¡Œè‡ªåŠ¨å®Œæˆã€å­—ç¬¦ç¼–ç ç­‰æ“ä½œã€‚</p><h4 id="2ã€å…¶ä»–æ“ä½œ">2ã€å…¶ä»–æ“ä½œ</h4><p>ç›®å‰å¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½ä¼š<strong>å¼ºåˆ¶å®¢æˆ·ç«¯ä½¿ç”¨HTTPSåè®®</strong>ä»¥ä¿è¯ä¿¡æ¯ä¼ è¾“çš„å®‰å…¨æ€§ã€‚åŒæ—¶è¿˜ä¼šè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œæ¯”å¦‚å®‰å…¨æ£€æŸ¥ã€è®¿é—®é™åˆ¶ç­‰ã€‚</p><h4 id="3ã€ç¼“å­˜æ£€æŸ¥">3ã€ç¼“å­˜æ£€æŸ¥</h4><p>æœ‰æ—¶å€™åšå®¢åœ¨giteeä¸Šè¿›è¡Œäº†æ›´æ–°ï¼Œä½†æ˜¯é€šè¿‡è°·æ­Œæµè§ˆå™¨æŸ¥çœ‹åšå®¢æ—¶ï¼Œä»æ˜¯æ›´æ–°å‰çš„åšå®¢ï¼Œè¿™æ˜¯å› ä¸ºæµè§ˆå™¨ä¸­ç¼“å­˜äº†ä¹‹å‰çš„åšå®¢ç•Œé¢ã€‚</p><p>æµè§ˆå™¨ä¼šå…ˆæ£€æµ‹æ˜¯å¦ç¼“å­˜äº†ç›®æ ‡URLçš„é¡µé¢ï¼Œå¦‚æœæœ‰ä¸”ç¼“å­˜æœªè¿‡æœŸï¼Œåˆ™ç›´æ¥å±•ç¤ºç¼“å­˜é¡µé¢ï¼Œæ— éœ€å†å‘æœåŠ¡å™¨è¿›è¡Œè¯·æ±‚</p><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210415185211636.png" class="" title="image-20210415185211636"><h3 id="DNSè§£æ">DNSè§£æ</h3><p><strong>DNSè§£ææ˜¯å¯»æ‰¾æ‰€éœ€è¦çš„èµ„æºçš„IPåœ°å€çš„è¿‡ç¨‹</strong>ã€‚å› ä¸ºäº’è”ç½‘ä¸­æ¯ä¸€å°è¿ç½‘çš„æœºå™¨éƒ½æœ‰<strong>å”¯ä¸€IPä½œä¸ºæ ‡è¯†</strong>ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ä¸²æ•°å­—ï¼Œè®°å¿†å¤ªè¿‡å›°éš¾ã€‚æ‰€ä»¥å°±éœ€è¦å°†ç½‘å€å’ŒIPåœ°å€è¿›è¡Œè½¬æ¢ï¼Œä¹Ÿå°±æ˜¯DNSè§£æã€‚å…¶å…·ä½“æ­¥éª¤å¦‚ä¸‹ã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210415185234770.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210415185234770.png" class="" title="image-20210415185234770"></a></p><h4 id="ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æµè§ˆå™¨ç¼“å­˜ä¸­æ˜¯å¦ç¼“å­˜è¿‡è¯¥åŸŸåå¯¹åº”çš„IPåœ°å€">ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æµè§ˆå™¨ç¼“å­˜ä¸­æ˜¯å¦ç¼“å­˜è¿‡è¯¥åŸŸåå¯¹åº”çš„IPåœ°å€</h4><p>ç”¨æˆ·é€šè¿‡æµè§ˆå™¨æµè§ˆè¿‡æŸç½‘ç«™ä¹‹åï¼Œæµè§ˆå™¨å°±ä¼šè‡ªåŠ¨ç¼“å­˜è¯¥ç½‘ç«™åŸŸåå¯¹åº”çš„åœ°å€ï¼Œå½“ç”¨æˆ·å†æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°±ä¼šä»ç¼“å­˜ä¸­æŸ¥æ‰¾è¯¥åŸŸåå¯¹åº”çš„IPåœ°å€ï¼Œå› ä¸ºç¼“å­˜ä¸ä»…æ˜¯æœ‰å¤§å°é™åˆ¶ï¼Œè€Œä¸”è¿˜æœ‰æ—¶é—´é™åˆ¶ï¼ˆåŸŸåè¢«ç¼“å­˜çš„æ—¶é—´é€šè¿‡å±æ€§æ¥è®¾ç½®ï¼‰ï¼Œæ‰€ä»¥å­˜åœ¨åŸŸåå¯¹åº”çš„æ‰¾ä¸åˆ°çš„æƒ…å†µã€‚å½“æµè§ˆå™¨ä»ç¼“å­˜ä¸­æ‰¾åˆ°äº†è¯¥ç½‘ç«™åŸŸåå¯¹åº”çš„åœ°å€ï¼Œé‚£ä¹ˆæ•´ä¸ªè§£æè¿‡ç¨‹ç»“æŸï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°†è¿›è¡Œä¸‹ä¸€æ­¥éª¤ã€‚å¯¹äºçš„ç¼“å­˜æ—¶é—´é—®é¢˜ï¼Œä¸å®œè®¾ç½®å¤ªé•¿çš„ç¼“å­˜æ—¶é—´ï¼Œæ—¶é—´å¤ªé•¿ï¼Œå¦‚æœåŸŸåå¯¹åº”çš„å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç”¨æˆ·å°†åœ¨ä¸€æ®µæ—¶é—´å†…æ— æ³•æ­£å¸¸è®¿é—®åˆ°ç½‘ç«™ï¼Œå¦‚æœå¤ªçŸ­ï¼Œé‚£ä¹ˆåˆé€ æˆé¢‘ç¹è§£æåŸŸåã€‚</p><h4 id="ç¬¬äºŒæ­¥ï¼šå¦‚æœåœ¨æµè§ˆå™¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°IPï¼Œé‚£ä¹ˆå°†ç»§ç»­æŸ¥æ‰¾æœ¬æœºç³»ç»Ÿæ˜¯å¦ç¼“å­˜è¿‡IP">ç¬¬äºŒæ­¥ï¼šå¦‚æœåœ¨æµè§ˆå™¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°IPï¼Œé‚£ä¹ˆå°†ç»§ç»­æŸ¥æ‰¾æœ¬æœºç³»ç»Ÿæ˜¯å¦ç¼“å­˜è¿‡IP</h4><p>å¦‚æœç¬¬ä¸€ä¸ªæ­¥éª¤æ²¡æœ‰å®Œæˆå¯¹åŸŸåçš„è§£æè¿‡ç¨‹ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šå»ç³»ç»Ÿç¼“å­˜ä¸­æŸ¥æ‰¾ç³»ç»Ÿæ˜¯å¦ç¼“å­˜è¿‡è¿™ä¸ªåŸŸåå¯¹åº”çš„åœ°å€ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºç³»ç»Ÿè‡ªå·±ä¹Ÿå…·å¤‡åŸŸåè§£æçš„åŸºæœ¬èƒ½åŠ›ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æ–‡ä»¶æ¥å°†åŸŸåæ‰‹åŠ¨ç»‘å®šåˆ°æŸä¸Šï¼Œæ–‡ä»¶ä½ç½®åœ¨ã€‚å¯¹äºæ™®é€šç”¨æˆ·ï¼Œå¹¶ä¸æ¨èè‡ªå·±æ‰‹åŠ¨ç»‘å®šåŸŸåå’Œï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œé€šè¿‡ç»‘å®šåŸŸåå’Œï¼Œå¯ä»¥è½»æ¾åˆ‡æ¢ç¯å¢ƒï¼Œå¯ä»¥ä»æµ‹è¯•ç¯å¢ƒåˆ‡æ¢åˆ°å¼€å‘ç¯å¢ƒï¼Œæ–¹ä¾¿å¼€å‘å’Œæµ‹è¯•ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œé»‘å®¢å¸¸å¸¸ä¿®æ”¹ä»–çš„ç”µè„‘çš„æ–‡ä»¶ï¼Œå°†ç”¨æˆ·å¸¸å¸¸è®¿é—®çš„åŸŸåç»‘å®šåˆ°ä»–æŒ‡å®šçš„ä¸Šï¼Œä»è€Œå®ç°äº†æœ¬åœ°è§£æï¼Œå¯¼è‡´è¿™äº›åŸŸåè¢«åŠ«æŒã€‚åœ¨æˆ–è€…ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶åœ¨ï¼Œä¿®æ”¹è¯¥æ–‡ä»¶ä¹Ÿå¯ä»¥å®ç°åŒæ ·çš„ç›®çš„ã€‚</p><ul><li>æŸ¥æ‰¾<strong>è·¯ç”±å™¨ç¼“å­˜</strong>ï¼Œé€šè¿‡è·¯ç”±å™¨çœ‹çœ‹æœ‰æ²¡æœ‰DNSç¼“å­˜</li></ul><p>å‰ä¸¤æ­¥éƒ½æ˜¯åœ¨æœ¬æœºä¸Šå®Œæˆçš„ï¼Œæ‰€ä»¥æ²¡æœ‰åœ¨ä¸Šé¢ç¤ºä¾‹å›¾ä¸Šå±•ç¤ºå‡ºæ¥ï¼Œä»ç¬¬ä¸‰æ­¥å¼€å§‹ï¼Œæ‰æ­£åœ¨åœ°å‘è¿œç¨‹DNSæœåŠ¡å™¨å‘èµ·è§£æåŸŸåçš„è¯·æ±‚ã€‚</p><h4 id="ç¬¬ä¸‰æ­¥ï¼šå‘æœ¬åœ°åŸŸåè§£ææœåŠ¡ç³»ç»Ÿå‘èµ·åŸŸåè§£æçš„è¯·æ±‚">ç¬¬ä¸‰æ­¥ï¼šå‘æœ¬åœ°åŸŸåè§£ææœåŠ¡ç³»ç»Ÿå‘èµ·åŸŸåè§£æçš„è¯·æ±‚</h4><p>å¦‚æœåœ¨æœ¬æœºä¸Šæ— æ³•å®ŒæˆåŸŸåçš„è§£æï¼Œé‚£ä¹ˆç³»ç»Ÿåªèƒ½è¯·æ±‚æœ¬åœ°åŸŸåè§£ææœåŠ¡ç³»ç»Ÿè¿›è¡Œè§£æï¼Œæœ¬åœ°åŸŸåç³»ç»Ÿä¸€èˆ¬éƒ½æ˜¯æœ¬åœ°åŒºçš„åŸŸåæœåŠ¡å™¨ï¼Œæ¯”å¦‚ä½ è¿æ¥çš„æ ¡å›­ç½‘ï¼Œé‚£ä¹ˆåŸŸåè§£æç³»ç»Ÿå°±åœ¨ä½ çš„æ ¡å›­æœºæˆ¿é‡Œï¼Œå¦‚æœä½ è¿æ¥çš„æ˜¯ç”µä¿¡ã€ç§»åŠ¨æˆ–è€…è”é€šçš„ç½‘ç»œï¼Œé‚£ä¹ˆæœ¬åœ°åŸŸåè§£ææœåŠ¡å™¨å°±åœ¨æœ¬åœ°åŒºï¼Œç”±å„è‡ªçš„è¿è¥å•†æ¥æä¾›æœåŠ¡ã€‚å¯¹äºæœ¬åœ°æœåŠ¡å™¨åœ°å€ï¼Œç³»ç»Ÿä½¿ç”¨å‘½ä»¤å°±å¯ä»¥æŸ¥çœ‹ï¼Œåœ¨å’Œç³»ç»Ÿä¸‹ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤æ¥æŸ¥çœ‹æœåŠ¡åœ°å€ã€‚ä¸€èˆ¬éƒ½ç¼“å­˜äº†å¤§éƒ¨åˆ†çš„åŸŸåè§£æçš„ç»“æœï¼Œå½“ç„¶ç¼“å­˜æ—¶é—´ä¹Ÿå—åŸŸåå¤±æ•ˆæ—¶é—´æ§åˆ¶ï¼Œå¤§éƒ¨åˆ†çš„è§£æå·¥ä½œåˆ°è¿™é‡Œå°±å·®ä¸å¤šå·²ç»ç»“æŸäº†ï¼Œè´Ÿè´£äº†å¤§éƒ¨åˆ†çš„è§£æå·¥ä½œã€‚</p><h4 id="ç¬¬å››æ­¥ï¼šå‘æ ¹åŸŸåè§£ææœåŠ¡å™¨å‘èµ·åŸŸåè§£æè¯·æ±‚">ç¬¬å››æ­¥ï¼šå‘æ ¹åŸŸåè§£ææœåŠ¡å™¨å‘èµ·åŸŸåè§£æè¯·æ±‚</h4><p>æœ¬åœ°åŸŸåè§£æå™¨è¿˜æ²¡æœ‰å®Œæˆè§£æçš„è¯ï¼Œé‚£ä¹ˆæœ¬åœ°åŸŸåè§£ææœåŠ¡å™¨å°†å‘æ ¹åŸŸåæœåŠ¡å™¨å‘èµ·è§£æè¯·æ±‚ã€‚</p><h4 id="ç¬¬äº”æ­¥ï¼šæ ¹åŸŸåæœåŠ¡å™¨è¿”å›gTLDï¼ˆé€šç”¨é¡¶çº§åŸŸåï¼‰åŸŸåè§£ææœåŠ¡å™¨åœ°å€">ç¬¬äº”æ­¥ï¼šæ ¹åŸŸåæœåŠ¡å™¨è¿”å›gTLDï¼ˆé€šç”¨é¡¶çº§åŸŸåï¼‰åŸŸåè§£ææœåŠ¡å™¨åœ°å€</h4><p>æœ¬åœ°åŸŸåè§£æå‘æ ¹åŸŸåæœåŠ¡å™¨å‘èµ·è§£æè¯·æ±‚ï¼Œæ ¹åŸŸåæœåŠ¡å™¨è¿”å›çš„æ˜¯æ‰€æŸ¥åŸŸçš„é€šç”¨é¡¶çº§åŸŸï¼ˆï¼‰åœ°å€ï¼Œå¸¸è§çš„é€šç”¨é¡¶çº§åŸŸæœ‰cnã€comã€eduç­‰ã€‚</p><h4 id="ç¬¬å…­æ­¥ï¼šå‘gTLDæœåŠ¡å™¨å‘èµ·è§£æè¯·æ±‚">ç¬¬å…­æ­¥ï¼šå‘gTLDæœåŠ¡å™¨å‘èµ·è§£æè¯·æ±‚</h4><p>æœ¬åœ°åŸŸåè§£ææœåŠ¡å™¨å‘gTLDæœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚</p><h4 id="ç¬¬ä¸ƒæ­¥ï¼šgTLDæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å¹¶è¿”å›Name-ServeræœåŠ¡å™¨">ç¬¬ä¸ƒæ­¥ï¼šgTLDæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å¹¶è¿”å›Name ServeræœåŠ¡å™¨</h4><p>æœåŠ¡å™¨æ¥æ”¶æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘èµ·çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®éœ€è¦è§£æçš„åŸŸåï¼Œæ‰¾åˆ°è¯¥åŸŸåå¯¹åº”çš„åŸŸåæœåŠ¡å™¨ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæœåŠ¡å™¨å°±æ˜¯ä½ æ³¨å†Œçš„åŸŸåæœåŠ¡å™¨ï¼Œé‚£ä¹ˆä½ æ³¨å†Œçš„åŸŸåçš„æœåŠ¡å•†çš„æœåŠ¡å™¨å°†æ‰¿æ‹…èµ·åŸŸåè§£æçš„ä»»åŠ¡ã€‚</p><h4 id="ç¬¬å…«æ­¥ï¼šName-ServeræœåŠ¡å™¨è¿”å›IPåœ°å€ç»™æœ¬åœ°æœåŠ¡å™¨">ç¬¬å…«æ­¥ï¼šName ServeræœåŠ¡å™¨è¿”å›IPåœ°å€ç»™æœ¬åœ°æœåŠ¡å™¨</h4><p>æœåŠ¡å™¨æŸ¥æ‰¾åŸŸåå¯¹åº”çš„åœ°å€ï¼Œå°†åœ°å€è¿åŒå€¼è¿”å›ç»™æœ¬åœ°åŸŸåæœåŠ¡å™¨ã€‚</p><h4 id="ç¬¬ä¹æ­¥ï¼šæœ¬åœ°åŸŸåæœåŠ¡å™¨ç¼“å­˜è§£æç»“æœ">ç¬¬ä¹æ­¥ï¼šæœ¬åœ°åŸŸåæœåŠ¡å™¨ç¼“å­˜è§£æç»“æœ</h4><p>æœ¬åœ°åŸŸåæœåŠ¡å™¨ç¼“å­˜è§£æåçš„ç»“æœï¼Œç¼“å­˜æ—¶é—´ç”±æ—¶é—´æ¥æ§åˆ¶ã€‚</p><blockquote><p>æ¦‚è¿°ç‰ˆï¼š</p><ul><li>æŸ¥è¯¢ç¼“å­˜</li></ul><p>æˆ‘ä»¬çš„æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿã€è·¯ç”±å™¨éƒ½ä¼šç¼“å­˜ä¸€äº›URLå¯¹åº”çš„IPåœ°å€ï¼Œç»Ÿç§°ä¸º<strong>DNSé«˜é€Ÿç¼“å­˜</strong>ã€‚è¿™æ˜¯ä¸ºäº†åŠ å¿«DNSè§£æé€Ÿåº¦ï¼Œä½¿å¾—ä¸å¿…æ¯æ¬¡éƒ½åˆ°æ ¹åŸŸåæœåŠ¡å™¨ä¸­å»æŸ¥è¯¢ã€‚</p><ul><li>é€’å½’è§£æ</li></ul><p>è¾“å…¥<code>www.baidu.com</code>ç½‘å€åï¼Œé¦–å…ˆåœ¨é«˜é€Ÿç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œæ²¡æ‰¾åˆ°å»æ ¹åŸŸåæœåŠ¡å™¨æŸ¥æ‰¾ï¼Œæ²¡æœ‰å†å»<code>com</code>é¡¶çº§åŸŸåæœåŠ¡å™¨æŸ¥æ‰¾ï¼Œä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æ‰¾åˆ°IPåœ°å€ï¼Œç„¶åæŠŠå®ƒè®°å½•åœ¨æœ¬åœ°å‘Šè¯‰ç¼“å­˜ä¸­ï¼Œä¾›ä¸‹æ¬¡ä½¿ç”¨ã€‚</p><p>å¤§è‡´è¿‡ç¨‹å°±æ˜¯<code>.</code>-&gt; <code>.com</code> -&gt;<code>baidu.com.</code> -&gt; <code>www.baidu.com.</code></p><p>å…¶ä¸­<code>.</code>ä»£è¡¨æ ¹åŸŸåæœåŠ¡å™¨ã€‚</p><ul><li>DNSè´Ÿè½½å‡è¡¡</li></ul><p>è®¿é—®<code>baidu.com</code>çš„æ—¶å€™ï¼Œæ¯æ¬¡å“åº”çš„å¯èƒ½å¹¶éæ˜¯åŒä¸€ä¸ªæœåŠ¡å™¨ï¼ˆIPåœ°å€ä¸åŒï¼‰ï¼Œä¸€èˆ¬å¤§å…¬å¸éƒ½æœ‰æˆç™¾ä¸Šåƒå°æœåŠ¡å™¨æ¥æ”¯æ’‘è®¿é—®ï¼ŒDNSå¯ä»¥è¿”å›ä¸€ä¸ª<strong>åˆé€‚çš„æœºå™¨çš„IP</strong>ç»™ç”¨æˆ·ï¼Œä¾‹å¦‚å¯ä»¥<strong>æ ¹æ®æ¯å°æœºå™¨çš„è´Ÿè½½é‡ï¼Œè¯¥æœºå™¨ç¦»ç”¨æˆ·åœ°ç†ä½ç½®çš„è·ç¦»</strong>ç­‰ç­‰ï¼Œè¿™ç§è¿‡ç¨‹å°±æ˜¯DNSè´Ÿè½½å‡è¡¡ã€‚</p></blockquote><h3 id="å»ºç«‹TCPè¿æ¥">å»ºç«‹TCPè¿æ¥</h3><p>TCP/IP åˆ†ä¸ºå››å±‚ï¼Œåœ¨å‘é€æ•°æ®æ—¶ï¼Œ<strong>æ¯å±‚éƒ½è¦å¯¹æ•°æ®è¿›è¡Œå°è£…</strong></p><p>[<img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/20201209141851.png" class="" title="img"></p><h3 id="å‘é€HTTPSè¯·æ±‚">å‘é€HTTPSè¯·æ±‚</h3><p><strong>å¤§è‡´è¿‡ç¨‹å¦‚ä¸‹</strong></p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921110642708.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921110642708.png" class="" title="image-20210921110642708"></a></p><h3 id="æŸ¥è¯¢MACåœ°å€">æŸ¥è¯¢MACåœ°å€</h3><p>è¿™ä¸€æ­¥ä¸»è¦è´Ÿè´£ä¸ºæ‰“åŒ…å¥½çš„<code>æ•°æ®+TCPé¦–éƒ¨+IPé¦–éƒ¨</code>å¯»æ‰¾ä¼ è¾“è·¯çº¿ï¼Œ<strong>æ‰¾åˆ°IPå¯¹åº”çš„ç‰©ç†æœº</strong>ï¼Œè¿™é‡Œä¼šç”¨åˆ°ARPåè®®ã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/#arp">ARPåè®®</a></p><h3 id="è¯·æ±‚åœ¨Tomcatä¸­çš„å¤„ç†æµç¨‹">è¯·æ±‚åœ¨Tomcatä¸­çš„å¤„ç†æµç¨‹</h3><p>Web å®¹å™¨ä»¥<strong>è¿›ç¨‹</strong>çš„æ–¹å¼åœ¨è®¡ç®—æœºä¸Šè¿è¡Œï¼Œ<strong>å®ƒä¸»è¦è´Ÿè´£æ¥æ”¶è¯·æ±‚ï¼Œå¹¶å°†å…¶æŠ•é€è‡³ç‰¹å®šçš„åº”ç”¨</strong>ï¼Œä½†Webå®¹å™¨å¹¶ä¸å±äºè®¡ç®—æœºç½‘ç»œçš„ç»„æˆéƒ¨åˆ†ã€‚æ¥ä¸‹æ¥å°†ä»¥Tomcatä¸ºä¾‹ä»‹ç»Webå®¹å™¨çš„æ ¸å¿ƒç»„ä»¶ã€‚</p><h4 id="Tomcatçš„æ ¸å¿ƒç»„ä»¶">Tomcatçš„æ ¸å¿ƒç»„ä»¶</h4><p>Tomcatçš„æ ¸å¿ƒç»„ä»¶ä¸»è¦æœ‰ï¼š<strong>Serverã€Serviceã€Connectorã€Engineã€Hostå’ŒContext</strong>ã€‚</p><p><strong>ä¸€ä¸ªServerå¯ä»¥åŒ…å«å¤šä¸ªServiceï¼Œä¸€ä¸ªServiceå¯ä»¥åŒ…å«å¤šä¸ªConnectorï¼Œä½†åªèƒ½åŒ…å«ä¸€ä¸ªEngineï¼Œä¸€ä¸ªEngineå¯ä»¥åŒ…å«å¤šä¸ªHostï¼Œä¸€ä¸ªHostå¯ä»¥åŒ…å«å¤šä¸ªContext</strong>ã€‚</p><p><strong>å®ƒä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º</strong></p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921111523133.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921111523133.png" class="" title="image-20210921111523133"></a></p><p><strong>é…ç½®æ–‡ä»¶çš„ç»“æ„å¦‚ä¸‹</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-section">&lt;Server&gt;</span>                              <br>    <span class="hljs-section">&lt;Service&gt;</span><br>        <span class="hljs-section">&lt;Engine&gt;</span><br>            <span class="hljs-section">&lt;Host&gt;</span><br>                <span class="hljs-section">&lt;Context /&gt;</span><br>            <span class="hljs-section">&lt;/Host&gt;</span><br>            <span class="hljs-section">&lt;Host&gt;</span><br>                <span class="hljs-section">&lt;Context /&gt;</span><br>            <span class="hljs-section">&lt;/Host&gt;</span><br>        <span class="hljs-section">&lt;/Engine&gt;</span>  <br>        <span class="hljs-section">&lt;Connector /&gt;</span><br>        <span class="hljs-section">&lt;Connector /&gt;</span><br>    <span class="hljs-section">&lt;/Service&gt;</span><br><span class="hljs-section">&lt;/Server&gt;</span><br><span class="hljs-attribute">Copy</span><br></code></pre></td></tr></table></figure><h5 id="Server">Server</h5><p>Server æ˜¯æ•´ä¸ªé…ç½®æ–‡ä»¶çš„<strong>å”¯ä¸€æ ¹å…ƒç´ </strong>ï¼Œä»£è¡¨æ•´ä¸ª Tomcat å®¹å™¨ã€‚Server å†…éƒ¨å¯ä»¥åŒ…å«å¤šä¸ª Serviceï¼Œå…¶ä¸»è¦èŒè´£å°±æ˜¯ç®¡ç†å¤šä¸ª Serviceï¼Œå¯¹å¤–æä¾›ç»™å®¢æˆ·ç«¯è®¿é—®ï¼ŒåŒæ—¶ç»´æŠ¤æ‰€æœ‰ Service çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬åˆå§‹åŒ–æœåŠ¡ã€ç»“æŸæœåŠ¡ã€å®šä½å®¢æˆ·ç«¯è¦è®¿é—®çš„ Service ç­‰ç­‰ã€‚</p><h5 id="Service">Service</h5><p>Service çš„ä¸»è¦èŒè´£å°±æ˜¯å°† Engine ä¸ Connector è£…é…åœ¨ä¸€èµ·å¯¹å¤–æä¾›æœåŠ¡ã€‚ä¸€ä¸ª Service å¯ä»¥åŒ…å«å¤šä¸ª Connectorï¼Œä½†åªèƒ½åŒ…å«ä¸€ä¸ª Engineï¼Œ<strong>å…¶ä¸­ Connector è´Ÿè´£ä»å®¢æˆ·ç«¯æ¥æ”¶è¯·æ±‚ï¼ŒEngine è´Ÿè´£å¤„ç† Connector æ¥æ”¶è¿›æ¥çš„è¯·æ±‚ã€‚</strong></p><h5 id="Connector">Connector</h5><p><strong>Connectoræ˜¯ä¸»è¦è´Ÿè´£æ¥æ”¶è¯·æ±‚çš„ç»„ä»¶</strong>ã€‚</p><p><strong>Tomcatæœ‰ä»¥ä¸‹ä¸¤ç§å·¥ä½œæ¨¡å¼</strong></p><ul><li>ä½œä¸ºWebæœåŠ¡å™¨ï¼Œç›´æ¥æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚</li><li>ä½œä¸ºJava WebæœåŠ¡å™¨ï¼Œæ¥æ”¶å‰ç½®WebæœåŠ¡å™¨çš„è¯·æ±‚</li></ul><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921111734338.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921111734338.png" class="" title="image-20210921111734338"></a></p><p>æ¯ä¸ª Service å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª Connectorï¼Œä¸åŒå·¥ä½œæ¨¡å¼ä¸‹ï¼ŒTomcat éœ€è¦ä¸ºå„ç§ç±»å‹çš„è¯·æ±‚åˆ†åˆ«å®šä¹‰ç›¸åº”çš„ Connectorï¼Œè¿™æ ·æ‰èƒ½æ­£ç¡®æ¥æ”¶å®¢æˆ·ç«¯å¯¹åº”åè®®çš„è¯·æ±‚ã€‚å®šä¹‰ Connector å¯ä»¥ä½¿ç”¨å¤šç§å±æ€§ï¼ŒæŸäº›å±æ€§åªé€‚ç”¨äºæŸç§ç‰¹å®šçš„ Connector ç±»å‹ã€‚</p><p>ä¸€èˆ¬è¯´æ¥ï¼Œå¸¸è§çš„ Connector æœ‰ 4 ç§ç±»å‹</p><ul><li><strong>HTTP</strong></li><li><strong>HTTPS</strong></li><li><strong>AJP</strong></li><li><strong>Proxy</strong></li></ul><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921111805468.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921111805468.png" class="" title="image-20210921111805468"></a></p><p>Connectorä½œä¸ºé€šä¿¡æ¥å£ï¼Œ<strong>å®ƒä¸ºå…¶æ‰€å±ç‰¹å®šçš„ Service æ¥æ”¶å¤–éƒ¨å®¢æˆ·ç«¯è¯·æ±‚ï¼Œä»¥åŠå›é€åº”ç­”è‡³å¤–éƒ¨å®¢æˆ·ç«¯</strong>ã€‚å…·ä½“èŒè´£åŒ…æ‹¬åˆ›å»º Requestã€Response å¯¹è±¡ç”¨äºè·Ÿå¤–éƒ¨å®¢æˆ·ç«¯äº¤æ¢æ•°æ®ï¼Œå¹¶<strong>å°† Request äº¤ç»™é…å¥—çš„ Engine æ¥å¤„ç†</strong>ã€‚</p><h5 id="Engine">Engine</h5><p>Engine æ˜¯ Service ç»„ä»¶ä¸­<strong>è´Ÿè´£è¯·æ±‚å¤„ç†çš„ç»„ä»¶</strong>ï¼Œå…¶å†…éƒ¨å¯ä»¥åŒ…å«å¤šä¸ª Hostã€‚Engine ä»ä¸€ä¸ªæˆ–å¤šä¸ª Connector ä¸­æ¥æ”¶è¯·æ±‚å¹¶å¤„ç†ï¼Œå¹¶å°†å¤„ç†ç»“æœå°è£…æˆåº”ç­”äº¤ç»™ Connectorï¼Œæœ€ç»ˆå›ä¼ ç»™å¤–éƒ¨å®¢æˆ·ç«¯ã€‚</p><h5 id="Host">Host</h5><p><strong>Host ä»£è¡¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå®ƒå¯¹åº”è®¡ç®—æœºç½‘ç»œä¸Šçš„ä¸€ä¸ªå®ä½“</strong>ã€‚å³æŸä¸ªåœ¨ DNS æœåŠ¡å™¨ä¸Šæ³¨å†Œè¿‡çš„åŸŸåæˆ–è€… IP åœ°å€ï¼Œä¾‹å¦‚ï¼š<code>www.baidu.com</code>æˆ– 201.187.10.21ã€‚Host å†…éƒ¨å¯ä»¥åŒ…å«å¤šä¸ª Contextï¼Œ<strong>æ¯ä¸ª Context è¡¨ç¤ºä¸€ä¸ª Web åº”ç”¨</strong>ã€‚Host è´Ÿè´£å®‰è£…ã€å±•å¼€ã€å¯åŠ¨å’Œç»“æŸæ¯ä¸ª Web åº”ç”¨ã€‚</p><p>å®¢æˆ·ç«¯åœ¨å¡«å†™ç›®æ ‡åœ°å€æ—¶ä¼šé€šè¿‡ä¸»æœºåæ¥æ ‡è¯†å®ƒå¸Œæœ›è®¿é—®çš„æœåŠ¡å™¨ï¼ŒTomcat å°†ä» HTTP è¯·æ±‚å¤´çš„ Host å­—æ®µæå–ä¸»æœºåï¼Œç„¶åå†åŒ¹é…å¯¹åº”çš„è™šæ‹Ÿä¸»æœºã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ï¼ŒHTTP è¯·æ±‚å°†è¢«å‘é€è‡³é»˜è®¤ä¸»æœº defaultHostã€‚</p><h5 id="Context">Context</h5><p>Context ä»£è¡¨åœ¨ç‰¹å®šè™šæ‹Ÿä¸»æœºä¸Šè¿è¡Œçš„ä¸€ä¸ª Web åº”ç”¨ï¼Œ<strong>è´Ÿè´£å¤„ç†æŸä¸ªç‰¹å®š Web åº”ç”¨çš„æ‰€æœ‰è¯·æ±‚</strong>ã€‚</p><h4 id="Tomcatå¤„ç†HTTPè¯·æ±‚">Tomcatå¤„ç†HTTPè¯·æ±‚</h4><p>å½“ä»¥ HTTP è¯·æ±‚åˆ°è¾¾TomcatæœåŠ¡å™¨ï¼ˆServerï¼‰ä»¥åï¼ŒTomcatä¼šè¿›è¡Œä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼Œå°†è¯·æ±‚äº¤ç»™å¯¹åº”çš„Webåº”ç”¨è¿›è¡Œå¤„ç†</p><ul><li>æ ¹æ®åè®®ç±»å‹å’Œç«¯å£å·é€‰å®š Service å’Œ Engine<ul><li>Connector ä¸»è¦è´Ÿè´£æ¥æ”¶è¯·æ±‚ã€‚å½“ Connector æ¥æ”¶åˆ°ç‰¹å®šåè®®å’Œç‰¹å®šç«¯å£çš„è¯·æ±‚åï¼Œ<strong>å…¶æ‰€å±çš„ Service å’Œ Service ä¸‹çš„ Engine ä¹Ÿå°±ç¡®å®šäº†</strong></li></ul></li><li>æ ¹æ®åŸŸåæˆ– IP åœ°å€é€‰å®š Host<ul><li>Engineä¸€æ—¦ç¡®å®šäº†ï¼Œå°±ä¼šæ ¹æ® IP æ¥é€‰æ‹©å¯¹åº”çš„è™šæ‹Ÿä¸»æœºHostæ¥å¤„ç†è¯·æ±‚ã€‚å¦‚æœåŒ¹é…å¤±è´¥äº†ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤è™šæ‹Ÿä¸»æœºæ¥å¤„ç†è¯·æ±‚</li></ul></li><li>æ ¹æ® URI é€‰å®š Context<ul><li>URI ä¸­çš„ context-path æŒ‡å®šäº† HTTPS è¯·æ±‚å°†è¦è®¿é—®çš„ Web åº”ç”¨</li><li>å½“è¯·æ±‚æŠµè¾¾æ—¶ï¼ŒTomcat å°†æ ¹æ® Context çš„å±æ€§ path å–å€¼ä¸ URI ä¸­çš„ context-path çš„åŒ¹é…ç¨‹åº¦æ¥é€‰æ‹© Web åº”ç”¨å¤„ç†ç›¸åº”è¯·æ±‚</li></ul></li></ul><hr><h3 id="è¯·æ±‚åœ¨Webåº”ç”¨ä¸­çš„å¤„ç†æµç¨‹">è¯·æ±‚åœ¨Webåº”ç”¨ä¸­çš„å¤„ç†æµç¨‹</h3><p>è¯·æ±‚è¢« Web å®¹å™¨ä¸­çš„ Connector æ•è·ï¼Œé€‰å–å¯¹åº”çš„ Server ä¸­çš„ Engine ï¼ŒEngine å†æ ¹æ®IPé€‰æ‹©å¯¹åº”çš„è™šæ‹Ÿä¸»æœºï¼Œè™šæ‹Ÿä¸»æœºæ ¹æ®URIå°†è¯·æ±‚äº¤ç»™å¯¹åº”çš„Webåº”ç”¨è¿›è¡Œå¤„ç†ã€‚æ¥ä¸‹æ¥å°†ä»‹ç»è¯·æ±‚åœ¨Webè¯·æ±‚ä¸­çš„å¤„ç†è¿‡ç¨‹ã€‚</p><p>ä»‹ç»å¤„ç†è¿‡ç¨‹å‰ï¼Œå…ˆå¯¹Webåº”ç”¨çš„åŸºæœ¬ç»„ä»¶è¿›è¡Œç®€å•ä»‹ç»ã€‚</p><h4 id="Webåº”ç”¨æ ¸å¿ƒç»„ä»¶">Webåº”ç”¨æ ¸å¿ƒç»„ä»¶</h4><h5 id="Listener">Listener</h5><p>ç›‘å¬å™¨ Listener ä¸»è¦ç”¨äºç›‘å¬ Applicationã€Sessionã€Request ç­‰å¯¹è±¡çš„å˜åŒ–ï¼Œæ¯å½“è¿™äº›å¯¹è±¡å‘ç”Ÿå˜åŒ–å°±ä¼šå›è°ƒç”¨å¯¹åº”çš„ç›‘å¬æ–¹æ³•ã€‚</p><h5 id="Filter">Filter</h5><p>è¿‡æ»¤å™¨ Filter è´Ÿè´£å¯¹è¯·æ±‚åš<strong>é¢„å¤„ç†</strong>ï¼Œæ¥ç€å°†è¯·æ±‚äº¤ç»™ Servlet è¿›è¡Œå¤„ç†å¹¶ç”Ÿæˆå“åº”ï¼Œæœ€å Filter å†å¯¹å“åº”è¿›è¡Œåå¤„ç†ã€‚</p><p>ä»è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹æ¥çœ‹ï¼ŒFilter ä¸»è¦å‚ä¸ä»¥ä¸‹å‡ ä¸ªç¯èŠ‚</p><ul><li>åœ¨ HttpServletRequest <strong>åˆ°è¾¾ Servlet ä¹‹å‰ï¼Œæ‹¦æˆªå®¢æˆ·çš„ HttpServletRequest</strong></li><li>æ ¹æ®éœ€è¦æ£€æŸ¥ HttpServletRequestï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ HttpServletRequest æŠ¥æ–‡å¤´å’Œæ•°æ®</li><li>åœ¨ Servlet ç”Ÿæˆçš„ HttpServletResponse <strong>æŠµè¾¾å®¢æˆ·ç«¯ä¹‹å‰ï¼Œæ‹¦æˆª HttpServletResponse</strong></li><li>æ ¹æ®éœ€è¦æ£€æŸ¥ HttpServletResponseï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ HttpServletResponse æŠ¥æ–‡å¤´å’Œæ•°æ®</li></ul><p><strong>ç®€å•æ¥è¯´å°±æ˜¯åœ¨çœŸæ­£å¤„ç†è¯·æ±‚ä»¥åŠè¿”å›å“åº”ä¹‹å‰ï¼Œé€šè¿‡è¿‡æ»¤å™¨å¯¹å†…å®¹å†è¿›è¡Œä¸€äº›ä¿®æ”¹</strong></p><h5 id="Servlet">Servlet</h5><p><strong>Servlet è´Ÿè´£å¤„ç†å®¢æˆ·ç«¯è®¿é—®åŠ¨æ€èµ„æºçš„ HTTP è¯·æ±‚</strong>ï¼Œæ¥å£ javax.servlet.Servlet å®šä¹‰äº†æ‰€æœ‰ Servlet å¿…é¡»è¦å®ç°çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Servlet</span> </span>&#123;<br>    <span class="hljs-comment">// ç”± Servlet å®¹å™¨è°ƒç”¨ï¼Œå®Œæˆ Servlet åˆå§‹åŒ–ï¼Œå¯åŠ¨å¯¹å¤–æœåŠ¡</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(ServletConfig var1)</span> <span class="hljs-keyword">throws</span> ServletException</span>;<br><br>    <span class="hljs-comment">// è·å– Servlet åˆå§‹åŒ–å’Œå¯åŠ¨æ—¶å‚æ•°çš„é…ç½®ä¿¡æ¯å¯¹è±¡ ServletConfig</span><br>    <span class="hljs-function">ServletConfig <span class="hljs-title">getServletConfig</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-comment">// ç”± Servlet å®¹å™¨è°ƒç”¨ï¼Œè®© Servlet å¤„ç†æŸä¸ª HTTP è¯·æ±‚</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">(ServletRequest var1, ServletResponse var2)</span> <span class="hljs-keyword">throws</span> ServletException, IOException</span>;<br><br>    <span class="hljs-comment">// è·å– Servlet çš„è¯´æ˜ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šä½œè€…ã€ç‰ˆæœ¬å’Œç‰ˆæƒç­‰ç­‰</span><br>    <span class="hljs-function">String <span class="hljs-title">getServletInfo</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-comment">// ç”± Servlet å®¹å™¨è°ƒç”¨ï¼Œç”¨äºå…³é—­åœæ­¢ Servlet æä¾›çš„æœåŠ¡</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span></span>;<br>&#125;<br>Copy<br></code></pre></td></tr></table></figure><p>ä» HTTP è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹æ¥çœ‹ï¼ŒServlet ä¸»è¦å‚ä¸ä»¥ä¸‹å‡ ä¸ªç¯èŠ‚</p><ul><li>æ¥æ”¶è¯·æ±‚<ul><li>å®¢æˆ·ç«¯è¯·æ±‚ä¼šè¢«å°è£…æˆ HttpServletRequest å¯¹è±¡ï¼ŒåŒ…å«æŠ¥æ–‡å¤´å‚æ•°å’ŒæŠ¥æ–‡ä½“ç­‰ä¿¡æ¯</li></ul></li><li>å¤„ç†è¯·æ±‚<ul><li>é€šå¸¸è°ƒç”¨ Servlet çš„æ–¹æ³• serviceã€doPost æˆ– doGet ç­‰æ–¹æ³•å¤„ç†è¯·æ±‚ï¼Œå¹¶<strong>è¿›ä¸€æ­¥è°ƒç”¨ä¸šåŠ¡å±‚ç›¸åº”é€»è¾‘å¯¹å…¶è¿›è¡Œå¤„ç†ç­‰</strong></li></ul></li><li>åå›å“åº”<ul><li>å¤„ç†å®Œè¯·æ±‚åï¼Œå¯ä»¥è½¬å‘ï¼ˆforwardï¼‰ã€é‡å®šå‘ï¼ˆredirectï¼‰åˆ°æŸä¸ªè§†å›¾é¡µé¢æˆ–è€…ç›´æ¥è¿”å›ç»“æœæ•°æ®</li></ul></li></ul><h4 id="Webåº”ç”¨å¤„ç†HTTPè¯·æ±‚æµç¨‹">Webåº”ç”¨å¤„ç†HTTPè¯·æ±‚æµç¨‹</h4><p>Web åº”ç”¨å¤„ç† HTTP è¯·æ±‚çš„æµç¨‹ä¸»è¦æ˜¯<strong>ç©¿è¶Š Listener å’Œå¤šä¸ª Filtersï¼Œæœ€ç»ˆæŠµè¾¾ Servlet çš„è¿‡ç¨‹</strong>ï¼ŒServletå†è¿›è¡Œä¸‹ä¸€æ­¥çš„å¤„ç†ã€‚</p><p><strong>å…·ä½“æµç¨‹å¦‚ä¸‹å›¾</strong></p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921112418359.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921112418359.png" class="" title="image-20210921112418359"></a></p><hr><h3 id="è¯·æ±‚åœ¨Spring-Webåº”ç”¨ä¸­çš„å¤„ç†æµç¨‹">è¯·æ±‚åœ¨Spring Webåº”ç”¨ä¸­çš„å¤„ç†æµç¨‹</h3><p>å› ä¸ºä½¿ç”¨ SSM æ¡†æ¶ï¼Œæ‰€ä»¥ Spring MVC ä¸­çš„ DispatcherServlet å……å½“äº† Web åº”ç”¨ä¸­çš„ Serlvetï¼Œè´Ÿè´£å°†ä»»åŠ¡åˆ†é…ç»™å¯¹åº”çš„Controllerï¼Œå¹¶å°†æœ€ç»ˆè§†å›¾è¿”å›ç»™ Web å®¹å™¨ã€‚</p><h4 id="Spring-MVCçš„æ ¸å¿ƒç»„ä»¶">Spring MVCçš„æ ¸å¿ƒç»„ä»¶</h4><h5 id="DispatcherServlet">DispatcherServlet</h5><p>DispatcherServlet æ˜¯æ•´ä¸ªæµç¨‹<strong>æ§åˆ¶çš„ä¸­å¿ƒ</strong>ï¼Œç”±å®ƒæ¥<strong>æ¥æ”¶è¯·æ±‚å¹¶è°ƒç”¨å…¶å®ƒç»„ä»¶å¤„ç†ç”¨æˆ·çš„è¯·æ±‚</strong>ï¼ŒåŒæ—¶è¿˜è´Ÿè´£å“åº”ç»“æœã€‚DispatcherServletçš„å­˜åœ¨é™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ã€‚</p><h5 id="HandlerMapping">HandlerMapping</h5><p>HandlerMapping è´Ÿè´£<strong>æ ¹æ®ç”¨æˆ·è¯·æ±‚æ˜ å°„è·å¾—å¯¹åº”çš„ Handlerå’Œ HandlerInterceptor</strong>ã€‚å¤„ç†æ–¹æ³•ä¸ºä» URL è·å¾— URIï¼Œåœ¨é€šè¿‡ URI ä» HandlerMapping ä¸­æ‰¾åˆ°å¯¹åº”çš„ Handler å’Œ HandlerInterceptorï¼Œå³å¤„ç†å™¨å’Œæ‹¦æˆªå™¨ã€‚</p><h5 id="HandlerAdapter">HandlerAdapter</h5><p>HandlerAdapter è´Ÿè´£æŒ‰ç…§ç‰¹å®šè§„åˆ™å»æ‰§è¡Œ Handlerã€‚</p><p>å¦‚æœ Handler æœ‰å¯¹åº”çš„ HandlerAdapaterï¼Œ<strong>HandlerAdapater åˆ™ä¼šåœ¨è°ƒç”¨ Handler ä¹‹å‰æ‰§è¡Œ HandlerInterceptor çš„ preHandler() æ–¹æ³•å¯¹ Handler è¿›è¡Œæ‹¦æˆª</strong>ã€‚</p><h5 id="HandlerInterceptor">HandlerInterceptor</h5><p>HandlerInterceptor ä¸»è¦è´Ÿè´£åœ¨æ‰§è¡Œ Handler å‰å¯¹å…¶è¿›è¡Œæ‹¦æˆªã€‚HandlerInterceptor ä¸­çš„ preHandler() æ–¹æ³•å°†ä¼šæå– HTTP è¯·æ±‚ä¸­çš„æ•°æ®å¡«å……åˆ°å¤„ç†å™¨ Handler çš„ä¸­ã€‚</p><h5 id="Handler">Handler</h5><p>Handler <strong>å³Controller ï¼Œæ˜¯å¤„ç†ä¸šåŠ¡ä»£ç çš„æ ¸å¿ƒå™¨ä»¶</strong>ã€‚è¿™éƒ¨åˆ†ç”±ç¨‹åºå‘˜è‡ªè¡Œç¼–å†™ï¼Œä¸€èˆ¬çš„SSMæ¡†æ¶ä¸­ï¼Œå…¶ä¸‹å±‚è¿˜æœ‰Serviceå’ŒDaoã€‚</p><h4 id="Spring-MVCå¤„ç†è¯·æ±‚æµç¨‹">Spring MVCå¤„ç†è¯·æ±‚æµç¨‹</h4><p>å½“ Web å®¹å™¨ä¸­çš„ Host ä¼šé€‰æ‹©å¯¹åº”çš„ Webåº”ç”¨æ¥å¤„ç†è¯·æ±‚ï¼Œè¿™é‡Œå°†è¯·æ±‚äº¤ç»™äº† Spring MVC ä¸­çš„ DispatcherServlet æ¥è¿›ä¸€æ­¥å¤„ç†è¯·æ±‚ã€‚</p><ul><li>DispatcherServlet é€šè¿‡è§£æ HTTP è¯·æ±‚çš„ URL è·å¾— URIï¼Œå†æ ¹æ®è¯¥ URI <strong>ä» HandlerMapping å½“ä¸­è·å¾—è¯¥è¯·æ±‚å¯¹åº”çš„ Handler å’Œ HandlerInterceptor</strong></li><li>DispatcherServlet æ ¹æ®è·å¾—çš„ Handler é€‰æ‹©åˆé€‚çš„ HandlerAdapterã€‚å¦‚æœæˆåŠŸè·å¾— HandlerAdapterï¼Œ<strong>HandlerAdapater åˆ™ä¼šåœ¨è°ƒç”¨ Handler ä¹‹å‰æ‰§è¡Œ HandlerInterceptor çš„ preHandler() æ–¹æ³•å¯¹ Handler è¿›è¡Œæ‹¦æˆª</strong></li><li>Handler å³ Controller ä¼šè¿›è¡Œè¯·æ±‚çš„å¤„ç†ï¼Œå¹¶å‘ä¸‹è°ƒç”¨ Service å’Œ Dao æ¥å¤„ç†è¯·æ±‚</li><li>Hander å¤„ç†å®Œæˆè¯·æ±‚åä¼šè¿”å›æ¨¡å‹æ•°æ®ï¼Œæ¨¡å‹æ•°æ®ç”± DispatcherServlet å°è£…åè¿”å›ç»™Web å®¹å™¨</li></ul><p><strong>å¤„ç†çš„æµç¨‹å›¾å¦‚ä¸‹</strong></p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921112655885.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921112655885.png" class="" title="image-20210921112655885"></a></p><hr><h3 id="è¿”å›è¿‡ç¨‹">è¿”å›è¿‡ç¨‹</h3><p>Web åº”ç”¨å¤„ç†å®Œè¯·æ±‚å¹¶å°†ç»“æœè¿”å›ç»™ Web å®¹å™¨åï¼Œå®¹å™¨ä¼šå°†å“åº”ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ˜¯ä¸Šé¢æµç¨‹çš„é€†è¿‡ç¨‹ã€‚æµè§ˆå™¨æ”¶åˆ°å“åº”ç»“æœåï¼Œä¼šå¯¹ç»“æœè¿›è¡Œè§£æå’Œæ¸²æŸ“ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½çœ‹åˆ°æµè§ˆå™¨ç»™æˆ‘ä»¬æ˜¾ç¤ºçš„ç½‘é¡µäº†ã€‚</p><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921113017358.png" class="" title="image-20210921113017358"><hr><h2 id="8-3-HTTPåè®®">8.3 HTTPåè®®</h2><h3 id="æ¦‚è¿°-3">æ¦‚è¿°</h3><p>HTTPï¼ˆHyperText Transfer Protocolï¼‰ï¼š<strong>è¶…æ–‡æœ¬ä¼ è¾“åè®®</strong>ï¼ŒHTTPæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ç»ˆç«¯ï¼ˆç”¨æˆ·ï¼‰å’ŒæœåŠ¡å™¨ç«¯ï¼ˆç½‘ç«™ï¼‰è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼ˆTCPï¼‰ã€‚é€šè¿‡ä½¿ç”¨ç½‘é¡µæµè§ˆå™¨ã€ç½‘ç»œçˆ¬è™«æˆ–è€…å…¶å®ƒçš„å·¥å…·ï¼Œå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚åˆ°æœåŠ¡å™¨ä¸ŠæŒ‡å®šç«¯å£ï¼ˆé»˜è®¤ç«¯å£ä¸º80ï¼‰ã€‚ä¸€æ—¦æ”¶åˆ°è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªçŠ¶æ€ï¼Œæ¯”å¦‚â€HTTP/1.1 200 OKâ€ï¼Œä»¥åŠè¿”å›çš„å†…å®¹ï¼Œå¦‚è¯·æ±‚çš„æ–‡ä»¶ã€é”™è¯¯æ¶ˆæ¯ã€æˆ–è€…å…¶å®ƒä¿¡æ¯ã€‚</p><p>å°½ç®¡TCP/IPåè®®æ˜¯äº’è”ç½‘ä¸Šæœ€æµè¡Œçš„åº”ç”¨ï¼ŒHTTPåè®®ä¸­ï¼Œå¹¶æ²¡æœ‰è§„å®šå¿…é¡»ä½¿ç”¨å®ƒæˆ–å®ƒæ”¯æŒçš„å±‚ã€‚äº‹å®ä¸Šï¼ŒHTTPå¯ä»¥åœ¨ä»»ä½•äº’è”ç½‘åè®®ä¸Šï¼Œæˆ–å…¶ä»–ç½‘ç»œä¸Šå®ç°ã€‚HTTPå‡å®šå…¶ä¸‹å±‚åè®®æä¾›å¯é çš„ä¼ è¾“ã€‚å› æ­¤ï¼Œä»»ä½•èƒ½å¤Ÿæä¾›è¿™ç§ä¿è¯çš„åè®®éƒ½å¯ä»¥è¢«å…¶ä½¿ç”¨ã€‚å› æ­¤ä¹Ÿå°±æ˜¯å…¶åœ¨TCP/IPåè®®æ—ä½¿ç”¨TCPä½œä¸ºå…¶ä¼ è¾“å±‚ã€‚</p><ul><li>è¶…æ–‡æœ¬ï¼šè¶…æ–‡æœ¬æŒ‡çš„æ˜¯HTMLï¼Œcssï¼ŒJavaScriptå’Œå›¾ç‰‡ç­‰ï¼ŒHTTPçš„å‡ºç°æ˜¯ä¸ºäº†æ¥æ”¶å’Œå‘å¸ƒHTMLé¡µé¢ï¼Œç»è¿‡ä¸æ–­çš„å‘å±•ä¹Ÿå¯ä»¥ç”¨äºæ¥æ”¶ä¸€äº›éŸ³é¢‘ï¼Œè§†é¢‘ï¼Œæ–‡ä»¶ç­‰å†…å®¹ã€‚</li></ul><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210910145213312.png" class="" title="image-20210910145213312"><hr><h3 id="æŠ¥æ–‡ç»“æ„">æŠ¥æ–‡ç»“æ„</h3><p>æŠ¥æ–‡ç»“æ„ï¼š<strong>èµ·å§‹è¡Œ + å¤´éƒ¨ + ç©ºè¡Œ + å®ä½“</strong></p><blockquote><p>http <code>è¯·æ±‚æŠ¥æ–‡</code>å’Œ<code>å“åº”æŠ¥æ–‡</code>æ˜¯æœ‰ä¸€å®šåŒºåˆ«</p></blockquote><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210915150323696.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210915150323696.png" class="" title="image-20210915150323696"></a></p><h4 id="èµ·å§‹è¡Œ">èµ·å§‹è¡Œ</h4><h5 id="è¯·æ±‚è¡Œ">è¯·æ±‚è¡Œ</h5><ul><li>è¯·æ±‚æŠ¥æ–‡ GET /home HTTP/1.1ï¼Œä¹Ÿå°±æ˜¯<strong>æ–¹æ³• + è·¯å¾„ + httpç‰ˆæœ¬</strong></li></ul><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/#http%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95">HTTPè¯·æ±‚æ–¹æ³•</a></p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/#uri%E4%B8%8Eurl">URIä¸URL</a></p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/#http%E7%89%88%E6%9C%AC">HTTPç‰ˆæœ¬</a></p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/1625556960701-67d07a26-61ea-4708-b378-a33ce98e5907.webp"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/1625556960701-67d07a26-61ea-4708-b378-a33ce98e5907.webp" class="" title="img"></a></p><h5 id="çŠ¶æ€è¡Œ">çŠ¶æ€è¡Œ</h5><ul><li>å“åº”æŠ¥æ–‡ HTTP/1.1 200 OK ï¼Œç”±<strong>httpç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒåŸå› </strong>ä¸‰éƒ¨åˆ†ç»„æˆ</li></ul><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/#http%E7%89%88%E6%9C%AC">HTTPç‰ˆæœ¬</a></p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/#http%E7%8A%B6%E6%80%81%E7%A0%81">HTTPçŠ¶æ€ç </a></p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/1625556999909-c5905faf-64de-41a8-a43b-780207247fa8.webp"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/1625556999909-c5905faf-64de-41a8-a43b-780207247fa8.webp" class="" title="img"></a></p><blockquote><p>åœ¨èµ·å§‹è¡Œä¸­ï¼Œæ¯ä¸¤ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨<strong>ç©ºæ ¼</strong>éš”å¼€ï¼Œæœ€åä¸€ä¸ªéƒ¨åˆ†åé¢åº”è¯¥æ¥ä¸€ä¸ª<strong>æ¢è¡Œ</strong>ï¼Œä¸¥æ ¼éµå¾ª<code>ABNF</code>è¯­æ³•è§„èŒƒã€‚</p></blockquote><h4 id="å¤´éƒ¨">å¤´éƒ¨</h4><h5 id="è¯·æ±‚å¤´">è¯·æ±‚å¤´</h5><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210915151245871.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210915151245871.png" class="" title="image-20210915151245871"></a></p><p>Cache-Controlï¼š</p><ul><li><strong>privateï¼š</strong> ä»…æµè§ˆå™¨å¯ä»¥ç¼“å­˜</li><li><strong>publicï¼š</strong> æµè§ˆå™¨å’Œä»£ç†æœåŠ¡å™¨éƒ½å¯ä»¥ç¼“å­˜ï¼ˆå¯¹äºprivateå’Œpublicï¼Œå‰ç«¯å¯ä»¥è®¤ä¸ºä¸€æ ·ï¼Œä¸ç”¨æ·±ç©¶</li><li><strong>max-age=xxx</strong> è¿‡æœŸæ—¶é—´ï¼ˆé‡è¦ï¼‰</li><li><strong>no-cache</strong> ä¸è¿›è¡Œå¼ºç¼“å­˜ï¼ˆé‡è¦ï¼‰,ä½¿ç”¨ä»»ä½•ç¼“å­˜å‰éƒ½è¦å‘æœåŠ¡å™¨éªŒè¯</li><li><strong>no-store</strong> çœŸæ­£çš„ä¸ç¼“å­˜</li></ul><h5 id="å“åº”å¤´">å“åº”å¤´</h5><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210915151401084.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210915151401084.png" class="" title="image-20210915151401084"></a></p><p>Content-Typeï¼š</p><p>å¸¸è§çš„åª’ä½“æ ¼å¼ï¼štext/html,text/plain,image/gif</p><p>applicationå¼€å¤´çš„åª’ä½“æ ¼å¼ç±»å‹ï¼šapplication/xml, appliation/json</p><p>multipart/form-data</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210915151540851.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210915151540851.png" class="" title="image-20210915151540851"></a></p><h4 id="å®ä½“">å®ä½“</h4><h5 id="è¯·æ±‚ä½“">è¯·æ±‚ä½“</h5><h5 id="å“åº”ä½“">å“åº”ä½“</h5><hr><h3 id="HTTP-è¯·æ±‚æ–¹æ³•">HTTP è¯·æ±‚æ–¹æ³•</h3><p><code>http/1.1</code>è§„å®šäº†ä»¥ä¸‹è¯·æ±‚æ–¹æ³•(æ³¨æ„ï¼Œéƒ½æ˜¯å¤§å†™):</p><ul><li>GET: é€šå¸¸ç”¨æ¥è·å–èµ„æº</li><li>HEAD: è·å–èµ„æºçš„å…ƒä¿¡æ¯</li><li>POST: æäº¤æ•°æ®ï¼Œå³ä¸Šä¼ æ•°æ®</li><li>PUT: ä¿®æ”¹æ•°æ®</li><li>DELETE: åˆ é™¤èµ„æº(å‡ ä¹ç”¨ä¸åˆ°)</li><li>CONNECT: å»ºç«‹è¿æ¥éš§é“ï¼Œç”¨äºä»£ç†æœåŠ¡å™¨</li><li>OPTIONS: åˆ—å‡ºå¯å¯¹èµ„æºå®è¡Œçš„è¯·æ±‚æ–¹æ³•ï¼Œç”¨æ¥è·¨åŸŸè¯·æ±‚</li><li>TRACE: è¿½è¸ªè¯·æ±‚-å“åº”çš„ä¼ è¾“è·¯å¾„</li></ul><h4 id="getè¯·æ±‚ä¸postè¯·æ±‚çš„åŒºåˆ«">getè¯·æ±‚ä¸postè¯·æ±‚çš„åŒºåˆ«</h4><ul><li>GETåœ¨æµè§ˆå™¨å›é€€æ—¶æ˜¯æ— å®³çš„ï¼Œè€ŒPOSTä¼šå†æ¬¡æäº¤è¯·æ±‚ã€‚</li><li>GETäº§ç”Ÿçš„URLåœ°å€å¯ä»¥è¢«Bookmarkï¼Œè€ŒPOSTä¸å¯ä»¥ã€‚</li><li>GETè¯·æ±‚ä¼šè¢«æµè§ˆå™¨ä¸»åŠ¨ç¼“å­˜ï¼Œè€ŒPOSTä¸ä¼šï¼Œé™¤éæ‰‹åŠ¨è®¾ç½®ã€‚</li><li><strong>GETè¯·æ±‚åªèƒ½è¿›è¡Œurlç¼–ç ï¼Œè€ŒPOSTæ”¯æŒå¤šç§ç¼–ç æ–¹å¼</strong>ã€‚</li><li>GETè¯·æ±‚å‚æ•°ä¼šè¢«å®Œæ•´ä¿ç•™åœ¨æµè§ˆå™¨å†å²è®°å½•é‡Œï¼Œè€ŒPOSTä¸­çš„å‚æ•°ä¸ä¼šè¢«ä¿ç•™ã€‚</li><li>GETè¯·æ±‚åœ¨URLä¸­ä¼ é€çš„å‚æ•°æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼Œè€ŒPOSTæ²¡æœ‰ã€‚</li><li><strong>å¯¹å‚æ•°çš„æ•°æ®ç±»å‹ï¼ŒGETåªæ¥å—ASCIIå­—ç¬¦ï¼Œè€ŒPOSTæ²¡æœ‰é™åˆ¶</strong>ã€‚</li><li>GETæ¯”POSTæ›´ä¸å®‰å…¨ï¼Œå› ä¸ºå‚æ•°ç›´æ¥æš´éœ²åœ¨URLä¸Šï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æ¥ä¼ é€’æ•æ„Ÿä¿¡æ¯ã€‚</li><li>GETå‚æ•°é€šè¿‡URLä¼ é€’ï¼ŒPOSTæ”¾åœ¨Request bodyä¸­ã€‚</li><li>ä»<strong>å¹‚ç­‰æ€§</strong>çš„è§’åº¦ï¼Œ<code>GET</code>æ˜¯<strong>å¹‚ç­‰</strong>çš„ï¼Œè€Œ<code>POST</code>ä¸æ˜¯ã€‚(<code>å¹‚ç­‰</code>è¡¨ç¤ºæ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œç»“æœä¹Ÿæ˜¯ç›¸åŒçš„)</li></ul><hr><h3 id="HTTP-ç‰ˆæœ¬">HTTP ç‰ˆæœ¬</h3><h4 id="HTTP1-0">HTTP1.0</h4><ul><li>HTTP 1.0 æµè§ˆå™¨ä¸æœåŠ¡å™¨åªä¿æŒçŸ­æš‚çš„è¿æ¥ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿æ¥</li></ul><h4 id="HTTP1-1">HTTP1.1</h4><ul><li>æ–°å¢Connectionå­—æ®µï¼Œç”¨äº<strong>æ”¯æŒæä¾›TCPæŒä¹…è¿æ¥</strong> Connection: keep-alive<ul><li>å³TCPè¿æ¥é»˜è®¤ä¸å…³é—­ï¼Œå¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨</li><li>è™½ç„¶å…è®¸å¤ç”¨TCPè¿æ¥ï¼Œä½†æ˜¯åŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œæ‰€æœ‰çš„æ•°æ®é€šä¿¡æ˜¯æŒ‰æ¬¡åºè¿›è¡Œçš„ï¼ŒæœåŠ¡å™¨åªæœ‰å¤„ç†å®Œä¸€ä¸ªè¯·æ±‚ï¼Œæ‰ä¼šæ¥ç€å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚å¦‚æœå‰é¢çš„å¤„ç†ç‰¹åˆ«æ…¢ï¼Œåé¢å°±ä¼šæœ‰è®¸å¤šè¯·æ±‚æ’é˜Ÿç­‰ç€ã€‚ï¼ˆ<strong>HTTPé˜Ÿå¤´é˜»å¡</strong>ï¼‰</li></ul></li><li>å¢åŠ æ›´å¤šè¯·æ±‚å¤´å’Œå“åº”å¤´æ¥å®Œå–„åŠŸèƒ½</li><li>æ–°å¢ Host å­—æ®µï¼Œç”¨äºæ”¯æŒè™šæ‹Ÿä¸»æœº</li><li>ç¼“å­˜ç­–ç•¥ï¼šIf-Matchï¼ŒIf-None-Match</li><li>æ·»åŠ äº†æ–°çš„è¯·æ±‚æ–¹æ³• put, delete, options</li></ul><blockquote><p>é˜Ÿå¤´é˜»å¡</p><p>â€é˜Ÿå¤´é˜»å¡â€œä¸çŸ­è¿æ¥å’Œé•¿è¿æ¥æ— å…³ï¼Œè€Œæ˜¯ç”± HTTP åŸºæœ¬çš„â€œè¯·æ±‚ - åº”ç­”â€æ¨¡å‹æ‰€å¯¼è‡´çš„ã€‚</p><p>å› ä¸º HTTP è§„å®šæŠ¥æ–‡å¿…é¡»æ˜¯â€œä¸€å‘ä¸€æ”¶â€ï¼Œè¿™å°±å½¢æˆäº†ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„â€œä¸²è¡Œâ€é˜Ÿåˆ—ã€‚</p><p>é˜Ÿåˆ—é‡Œçš„è¯·æ±‚æ²¡æœ‰è½»é‡ç¼“æ€¥çš„ä¼˜å…ˆçº§ï¼Œåªæœ‰å…¥é˜Ÿçš„å…ˆåé¡ºåºï¼Œæ’åœ¨æœ€å‰é¢çš„è¯·æ±‚è¢«æœ€ä¼˜å…ˆå¤„ç†ã€‚</p><p>å¦‚æœé˜Ÿé¦–çš„è¯·æ±‚å› ä¸ºå¤„ç†çš„å¤ªæ…¢è€½è¯¯äº†æ—¶é—´ï¼Œé‚£ä¹ˆé˜Ÿåˆ—é‡Œåé¢çš„æ‰€æœ‰è¯·æ±‚ä¹Ÿä¸å¾—ä¸è·Ÿç€ä¸€èµ·ç­‰å¾…ï¼Œç»“æœå°±æ˜¯å…¶ä»–çš„è¯·æ±‚æ‰¿æ‹…äº†ä¸åº”æœ‰çš„æ—¶é—´æˆæœ¬ã€‚</p></blockquote><p>å› ä¸ºâ€œè¯·æ±‚ - åº”ç­”â€æ¨¡å‹ä¸èƒ½å˜ï¼Œæ‰€ä»¥â€œé˜Ÿå¤´é˜»å¡â€é—®é¢˜åœ¨ HTTP/1.1 é‡Œæ— æ³•è§£å†³ï¼Œåªèƒ½ç¼“è§£</p><ul><li>è¿™åœ¨ HTTP é‡Œå°±æ˜¯â€œå¹¶å‘è¿æ¥â€ï¼ˆconcurrent connectionsï¼‰ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶å¯¹ä¸€ä¸ªåŸŸåå‘èµ·å¤šä¸ªé•¿è¿æ¥ï¼Œç”¨æ•°é‡æ¥è§£å†³è´¨é‡çš„é—®é¢˜ã€‚ä½†è¿™ç§æ–¹å¼ä¹Ÿå­˜åœ¨ç¼ºé™·ã€‚å¦‚æœæ¯ä¸ªå®¢æˆ·ç«¯éƒ½æƒ³è‡ªå·±å¿«ï¼Œå»ºç«‹å¾ˆå¤šä¸ªè¿æ¥ï¼Œç”¨æˆ·æ•°Ã—å¹¶å‘æ•°å°±ä¼šæ˜¯ä¸ªå¤©æ–‡æ•°å­—ã€‚æœåŠ¡å™¨çš„èµ„æºæ ¹æœ¬å°±æ‰›ä¸ä½ï¼Œæˆ–è€…è¢«æœåŠ¡å™¨è®¤ä¸ºæ˜¯æ¶æ„æ”»å‡»ï¼Œåè€Œä¼šé€ æˆâ€œæ‹’ç»æœåŠ¡â€ã€‚æ‰€ä»¥ï¼ŒHTTP åè®®å»ºè®®å®¢æˆ·ç«¯ä½¿ç”¨å¹¶å‘ï¼Œä½†ä¸èƒ½â€œæ»¥ç”¨â€å¹¶å‘ã€‚RFC2616 é‡Œæ˜ç¡®é™åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯æœ€å¤šå¹¶å‘ 2 ä¸ªè¿æ¥ã€‚ä¸è¿‡å®è·µè¯æ˜è¿™ä¸ªæ•°å­—å®åœ¨æ˜¯å¤ªå°äº†ï¼Œä¼—å¤šæµè§ˆå™¨éƒ½â€œæ— è§†â€æ ‡å‡†ï¼ŒæŠŠè¿™ä¸ªä¸Šé™æé«˜åˆ°äº† 6~8ã€‚åæ¥ä¿®è®¢çš„ RFC7230 ä¹Ÿå°±â€œé¡ºæ°´æ¨èˆŸâ€ï¼Œå–æ¶ˆäº†è¿™ä¸ªâ€œ2â€çš„é™åˆ¶ã€‚</li><li>â€œåŸŸååˆ†ç‰‡â€ï¼ˆdomain shardingï¼‰æŠ€æœ¯ï¼Œè¿˜æ˜¯ç”¨æ•°é‡æ¥è§£å†³è´¨é‡çš„æ€è·¯ã€‚HTTP åè®®å’Œæµè§ˆå™¨ä¸æ˜¯é™åˆ¶å¹¶å‘è¿æ¥æ•°é‡å—ï¼Ÿå¥½ï¼Œé‚£æˆ‘å°±å¤šå¼€å‡ ä¸ªåŸŸåï¼Œæ¯”å¦‚ <a href="http://shard1.chrono.com">shard1.chrono.com</a>ã€<a href="http://shard2.chrono.com">shard2.chrono.com</a>ï¼Œè€Œè¿™äº›åŸŸåéƒ½æŒ‡å‘åŒä¸€å°æœåŠ¡å™¨ <a href="http://www.chrono.xn--com%2C-gp7i66a065axd527gosbxw3cvxfw3lxu1d087ewca058bk9s1zd/">www.chrono.comï¼Œè¿™æ ·å®é™…é•¿è¿æ¥çš„æ•°é‡å°±åˆä¸Šå»äº†</a></li></ul><h4 id="HTTP2-0">HTTP2.0</h4><ul><li><p><strong>æ”¯æŒæœåŠ¡ç«¯æ¨é€</strong></p><ul><li>å…è®¸æœåŠ¡ç«¯æ¨é€èµ„æºç»™å®¢æˆ·ç«¯ï¼Œåœ¨å“åº”ä¸€ä¸ªé¡µé¢è¯·æ±‚ä¸­ï¼Œå¯ä»¥æŠŠéœ€è¦çš„å…¶ä»–èµ„æºä¸€èµ·å‘ç»™å®¢æˆ·ç«¯ï¼Œå…å¾—éœ€è¦å†æ¬¡å‘é€è¯·æ±‚ï¼Œé€‚åˆåŠ è½½é™æ€èµ„æºï¼Œæ¯”å¦‚è¯·æ±‚htmlæ—¶ï¼ŒæŠŠcssä¹Ÿä¼ è¿‡å»</li></ul></li><li><p><strong>æ”¯æŒTCPè¿æ¥IOå¤šè·¯å¤ç”¨</strong></p><ul><li>åœ¨ä¸€ä¸ªè¿æ¥é‡Œï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚æˆ–å›åº”ï¼Œé¿å…é˜Ÿå¤´é˜»å¡</li></ul></li><li><p><strong>äºŒè¿›åˆ¶åˆ†å¸§ï¼ˆè€Œéæ–‡æœ¬æ ¼å¼ï¼‰</strong></p><ul><li>æ”¯æŒå¤šä¸ªè¿æ¥ç©¿æ’æ‰§è¡Œï¼Œé¿å…é˜Ÿå¤´é˜»å¡</li></ul></li><li><p>é¦–éƒ¨å‹ç¼©ï¼šHPACKç®—æ³•</p><ul><li><p>é¦–å…ˆæ˜¯åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹å“ˆå¸Œè¡¨ï¼Œå°†ç”¨åˆ°çš„å­—æ®µå­˜æ”¾åœ¨è¿™å¼ è¡¨ä¸­ï¼Œé‚£ä¹ˆåœ¨ä¼ è¾“çš„æ—¶å€™å¯¹äºä¹‹å‰å‡ºç°è¿‡çš„å€¼ï¼Œåªéœ€è¦æŠŠ</p><p>ç´¢å¼•</p><p>(æ¯”å¦‚0ï¼Œ1ï¼Œ2ï¼Œâ€¦)ä¼ ç»™å¯¹æ–¹å³å¯ï¼Œå¯¹æ–¹æ‹¿åˆ°ç´¢å¼•æŸ¥è¡¨å°±è¡Œäº†ã€‚è¿™ç§</p><p>ä¼ ç´¢å¼•</p><p>çš„æ–¹å¼ï¼Œå¯ä»¥è¯´è®©è¯·æ±‚å¤´å­—æ®µå¾—åˆ°æå¤§ç¨‹åº¦çš„ç²¾ç®€å’Œå¤ç”¨ã€‚åºŸé™¤äº†èµ·å§‹è¡Œçš„æ¦‚å¿µã€‚</p><ul><li>HTTP2.0å½“ä¸­åºŸé™¤äº†èµ·å§‹è¡Œçš„æ¦‚å¿µï¼Œå°†èµ·å§‹è¡Œä¸­çš„è¯·æ±‚æ–¹æ³•ã€URIã€çŠ¶æ€ç è½¬æ¢æˆäº†å¤´å­—æ®µï¼Œä¸è¿‡è¿™äº›å­—æ®µéƒ½æœ‰ä¸€ä¸ªâ€:â€å‰ç¼€ï¼Œç”¨æ¥å’Œå…¶å®ƒè¯·æ±‚å¤´åŒºåˆ†å¼€ã€‚</li><li>å…¶æ¬¡æ˜¯å¯¹äºæ•´æ•°å’Œå­—ç¬¦ä¸²è¿›è¡Œ<strong>å“ˆå¤«æ›¼ç¼–ç </strong>ï¼Œå“ˆå¤«æ›¼ç¼–ç çš„åŸç†å°±æ˜¯å…ˆå°†æ‰€æœ‰å‡ºç°çš„å­—ç¬¦å»ºç«‹ä¸€å¼ ç´¢å¼•è¡¨ï¼Œç„¶åè®©å‡ºç°æ¬¡æ•°å¤šçš„å­—ç¬¦å¯¹åº”çš„ç´¢å¼•å°½å¯èƒ½çŸ­ï¼Œä¼ è¾“çš„æ—¶å€™ä¹Ÿæ˜¯ä¼ è¾“è¿™æ ·çš„<strong>ç´¢å¼•åºåˆ—</strong>ï¼Œå¯ä»¥è¾¾åˆ°éå¸¸é«˜çš„å‹ç¼©ç‡ã€‚</li></ul></li></ul></li></ul><hr><h3 id="HTTP-çŠ¶æ€ç ">HTTP çŠ¶æ€ç </h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status</a></p><p>RFC è§„å®š HTTP çš„çŠ¶æ€ç ä¸º<strong>ä¸‰ä½æ•°</strong>ï¼Œè¢«åˆ†ä¸ºäº”ç±»:</p><ul><li><p><strong>1xx</strong>: è¡¨ç¤ºç›®å‰æ˜¯åè®®å¤„ç†çš„ä¸­é—´çŠ¶æ€ï¼Œè¿˜éœ€è¦åç»­æ“ä½œã€‚</p><ul><li><strong>100 Continue</strong>ï¼šè¿„ä»Šä¸ºæ­¢çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯å¯è¡Œçš„ï¼Œå®¢æˆ·ç«¯åº”è¯¥ç»§ç»­è¯·æ±‚ï¼Œå¦‚æœå·²ç»å®Œæˆï¼Œåˆ™å¿½ç•¥å®ƒã€‚</li><li><strong>101 Switching Protocols</strong>ï¼šåœ¨<code>HTTP</code>å‡çº§ä¸º<code>WebSocket</code>çš„æ—¶å€™ï¼Œå¦‚æœæœåŠ¡å™¨åŒæ„å˜æ›´ï¼ˆåˆ‡æ¢åè®®ï¼‰ï¼Œå°±ä¼šå‘é€çŠ¶æ€ç  101ã€‚</li><li><strong>102 Processing</strong>ï¼šæœåŠ¡å™¨å·²æ”¶åˆ°å¹¶æ­£åœ¨å¤„ç†è¯¥è¯·æ±‚ï¼Œä½†æ²¡æœ‰å“åº”å¯ç”¨</li></ul></li><li><p><strong>2xx</strong>: è¡¨ç¤ºæˆåŠŸçŠ¶æ€ã€‚</p><ul><li><strong>200 OK</strong>ï¼šè¯·æ±‚æˆåŠŸã€‚</li><li><strong>201 Created</strong>ï¼šè¯¥è¯·æ±‚å·²æˆåŠŸï¼Œå¹¶å› æ­¤åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„èµ„æºã€‚è¿™é€šå¸¸æ˜¯åœ¨POSTè¯·æ±‚ï¼Œæˆ–æ˜¯æŸäº›PUTè¯·æ±‚ä¹‹åè¿”å›çš„å“åº”ã€‚</li><li><strong>202 Accepted</strong>ï¼šè¯·æ±‚å·²ç»æ¥æ”¶åˆ°ï¼Œä½†è¿˜æœªå“åº”ï¼Œæ²¡æœ‰ç»“æœã€‚æ„å‘³ç€ä¸ä¼šæœ‰ä¸€ä¸ªå¼‚æ­¥çš„å“åº”å»è¡¨æ˜å½“å‰è¯·æ±‚çš„ç»“æœï¼Œé¢„æœŸå¦å¤–çš„è¿›ç¨‹å’ŒæœåŠ¡å»å¤„ç†è¯·æ±‚ï¼Œæˆ–è€…æ‰¹å¤„ç†ã€‚</li><li><strong>204 No Content</strong>ï¼šå«ä¹‰ä¸ 200 ç›¸åŒï¼Œä½†å“åº”å¤´åæ²¡æœ‰ body æ•°æ®ã€‚</li><li><strong>206 Partial Content</strong>ï¼šè¡¨ç¤ºéƒ¨åˆ†å†…å®¹ï¼Œå®ƒçš„ä½¿ç”¨åœºæ™¯ä¸º HTTP åˆ†å—ä¸‹è½½å’Œæ–­ç‚¹ç»­ä¼ ï¼Œå½“ç„¶ä¹Ÿä¼šå¸¦ä¸Šç›¸åº”çš„å“åº”å¤´å­—æ®µ<code>Content-Range</code>ã€‚</li></ul></li><li><p><strong>3xx</strong>: é‡å®šå‘çŠ¶æ€ï¼Œèµ„æºä½ç½®å‘ç”Ÿå˜åŠ¨ï¼Œéœ€è¦é‡æ–°è¯·æ±‚ã€‚</p><ul><li><p><strong>301 Moved Permanently</strong>ï¼šæ°¸ä¹…é‡å®šå‘ï¼Œæ±‚çš„URLå·²è¢«ç§»é™¤æ—¶ä½¿ç”¨</p><p>æ¯”å¦‚ç½‘ç«™ä» HTTP å‡çº§åˆ°äº† HTTPS äº†ï¼Œä»¥å‰çš„ç«™ç‚¹å†ä¹Ÿä¸ç”¨äº†ï¼Œåº”å½“è¿”å›<code>301</code>ï¼Œè¿™ä¸ªæ—¶å€™æµè§ˆå™¨é»˜è®¤ä¼šåšç¼“å­˜ä¼˜åŒ–ï¼Œåœ¨ç¬¬äºŒæ¬¡è®¿é—®çš„æ—¶å€™è‡ªåŠ¨è®¿é—®é‡å®šå‘çš„é‚£ä¸ªåœ°å€ã€‚</p></li><li><p><strong>302 Found</strong>ï¼šä¸´æ—¶é‡å®šå‘ï¼Œè¯·æ±‚çš„èµ„æºç°åœ¨ä¸´æ—¶ä»ä¸åŒçš„ URI å“åº”è¯·æ±‚ã€‚ç”±äºè¿™æ ·çš„é‡å®šå‘æ˜¯ä¸´æ—¶çš„ï¼Œå®¢æˆ·ç«¯åº”å½“ç»§ç»­å‘åŸæœ‰åœ°å€å‘é€ä»¥åçš„è¯·æ±‚ã€‚åªæœ‰åœ¨Cache-Controlæˆ–Expiresä¸­è¿›è¡Œäº†æŒ‡å®šçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå“åº”æ‰æ˜¯å¯ç¼“å­˜çš„ã€‚</p></li><li><p><strong>304 Not Modified</strong>: å½“åå•†ç¼“å­˜å‘½ä¸­æ—¶ä¼šè¿”å›è¿™ä¸ªçŠ¶æ€ç ã€‚å¦‚æœå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªå¸¦æ¡ä»¶çš„ GET è¯·æ±‚ä¸”è¯¥è¯·æ±‚å·²è¢«å…è®¸ï¼Œè€Œæ–‡æ¡£çš„å†…å®¹ï¼ˆè‡ªä¸Šæ¬¡è®¿é—®ä»¥æ¥æˆ–è€…æ ¹æ®è¯·æ±‚çš„æ¡ä»¶ï¼‰å¹¶æ²¡æœ‰æ”¹å˜ï¼Œåˆ™æœåŠ¡å™¨åº”å½“è¿”å›è¿™ä¸ªçŠ¶æ€ç ã€‚304 å“åº”ç¦æ­¢åŒ…å«æ¶ˆæ¯ä½“ï¼Œå› æ­¤å§‹ç»ˆä»¥æ¶ˆæ¯å¤´åçš„ç¬¬ä¸€ä¸ªç©ºè¡Œç»“å°¾ã€‚</p></li></ul></li><li><p><strong>4xx</strong>: è¯·æ±‚æŠ¥æ–‡æœ‰è¯¯ã€‚</p><ul><li><strong>400 Bad Request</strong>:<ul><li>1ã€è¯­ä¹‰æœ‰è¯¯ï¼Œå½“å‰è¯·æ±‚æ— æ³•è¢«æœåŠ¡å™¨ç†è§£ã€‚é™¤éè¿›è¡Œä¿®æ”¹ï¼Œå¦åˆ™å®¢æˆ·ç«¯ä¸åº”è¯¥é‡å¤æäº¤è¿™ä¸ªè¯·æ±‚ã€‚</li><li>2ã€è¯·æ±‚å‚æ•°æœ‰è¯¯ã€‚</li></ul></li><li><strong>401 Unauthorized</strong>ï¼šæœªæˆæƒï¼Œå½“å‰è¯·æ±‚éœ€è¦ç”¨æˆ·éªŒè¯ã€‚è¯¥å“åº”å¿…é¡»åŒ…å«ä¸€ä¸ªé€‚ç”¨äºè¢«è¯·æ±‚èµ„æºçš„ WWW-Authenticate ä¿¡æ¯å¤´ç”¨ä»¥è¯¢é—®ç”¨æˆ·ä¿¡æ¯ã€‚</li><li><strong>403 Forbidden</strong>ï¼šæœåŠ¡å™¨å·²ç»ç†è§£è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œå®ƒã€‚è¿™å¹¶ä¸æ˜¯è¯·æ±‚æŠ¥æ–‡å‡ºé”™ï¼Œè€Œæ˜¯æœåŠ¡å™¨ç¦æ­¢è®¿é—®ï¼ŒåŸå› æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æ³•å¾‹ç¦æ­¢ã€ä¿¡æ¯æ•æ„Ÿã€‚</li><li><strong>404 Not Found</strong>ï¼šèµ„æºæœªæ‰¾åˆ°ï¼Œè¡¨ç¤ºæ²¡åœ¨æœåŠ¡å™¨ä¸Šæ‰¾åˆ°ç›¸åº”çš„èµ„æºã€‚</li><li><strong>405 Method Not Allowed</strong>ï¼šè¯·æ±‚æ–¹æ³•ä¸è¢«æœåŠ¡å™¨ç«¯å…è®¸ã€‚è¯¥å“åº”å¿…é¡»è¿”å›ä¸€ä¸ªAllow å¤´ä¿¡æ¯ç”¨ä»¥è¡¨ç¤ºå‡ºå½“å‰èµ„æºèƒ½å¤Ÿæ¥å—çš„è¯·æ±‚æ–¹æ³•çš„åˆ—è¡¨ã€‚</li><li><strong>406 Not Acceptable</strong>: èµ„æºæ— æ³•æ»¡è¶³å®¢æˆ·ç«¯çš„æ¡ä»¶ã€‚è¯·æ±‚çš„èµ„æºçš„å†…å®¹ç‰¹æ€§æ— æ³•æ»¡è¶³è¯·æ±‚å¤´ä¸­çš„æ¡ä»¶ï¼Œå› è€Œæ— æ³•ç”Ÿæˆå“åº”å®ä½“ã€‚</li><li><strong>408 Request Timeout</strong>ï¼šæœåŠ¡å™¨ç­‰å¾…äº†å¤ªé•¿æ—¶é—´ã€‚è¯·æ±‚è¶…æ—¶ã€‚å®¢æˆ·ç«¯æ²¡æœ‰åœ¨æœåŠ¡å™¨é¢„å¤‡ç­‰å¾…çš„æ—¶é—´å†…å®Œæˆä¸€ä¸ªè¯·æ±‚çš„å‘é€ã€‚å®¢æˆ·ç«¯å¯ä»¥éšæ—¶å†æ¬¡æäº¤è¿™ä¸€è¯·æ±‚è€Œæ— éœ€è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚</li><li><strong>409 Conflict</strong>ï¼šå¤šä¸ªè¯·æ±‚å‘ç”Ÿäº†å†²çªã€‚</li><li><strong>413 Request Entity Too Large</strong>ï¼šè¯·æ±‚ä½“çš„æ•°æ®è¿‡å¤§ã€‚</li><li><strong>414 Request-URI Too Long</strong>ï¼šè¯·æ±‚è¡Œé‡Œçš„ URI å¤ªå¤§ã€‚</li><li><strong>429 Too Many Request</strong>ï¼šå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚è¿‡å¤šã€‚</li><li><strong>431 Request Header Fields Too Large</strong>ï¼šè¯·æ±‚å¤´çš„å­—æ®µå†…å®¹å¤ªå¤§ã€‚</li></ul></li><li><p><strong>5xx</strong>: æœåŠ¡å™¨ç«¯å‘ç”Ÿé”™è¯¯ã€‚</p><ul><li><strong>500 Internal Server Error</strong>ï¼šæœåŠ¡å™¨é‡åˆ°äº†ä¸çŸ¥é“å¦‚ä½•å¤„ç†çš„æƒ…å†µã€‚</li><li><strong>501 Not Implemented</strong>ï¼šå®¢æˆ·ç«¯è¯·æ±‚çš„åŠŸèƒ½è¿˜ä¸æ”¯æŒã€‚æ­¤è¯·æ±‚æ–¹æ³•ä¸è¢«æœåŠ¡å™¨æ”¯æŒä¸”æ— æ³•è¢«å¤„ç†ã€‚åªæœ‰<code>GET</code>å’Œ<code>HEAD</code>æ˜¯è¦æ±‚æœåŠ¡å™¨æ”¯æŒçš„ï¼Œå®ƒä»¬å¿…å®šä¸ä¼šè¿”å›æ­¤é”™è¯¯ä»£ç ã€‚</li><li><strong>502 Bad Gateway</strong>ï¼šæ­¤é”™è¯¯å“åº”è¡¨æ˜æœåŠ¡å™¨ä½œä¸ºç½‘å…³éœ€è¦å¾—åˆ°ä¸€ä¸ªå¤„ç†è¿™ä¸ªè¯·æ±‚çš„å“åº”ï¼Œä½†æ˜¯å¾—åˆ°ä¸€ä¸ªé”™è¯¯çš„å“åº”ã€‚æœåŠ¡å™¨è‡ªèº«æ˜¯æ­£å¸¸çš„ï¼Œä½†è®¿é—®çš„æ—¶å€™å‡ºé”™äº†ã€‚</li><li><strong>503 Service Unavailable</strong>ï¼šæœåŠ¡å™¨æ²¡æœ‰å‡†å¤‡å¥½å¤„ç†è¯·æ±‚ã€‚ å¸¸è§åŸå› æ˜¯æœåŠ¡å™¨å› ç»´æŠ¤æˆ–é‡è½½è€Œåœæœºã€‚ è¯·æ³¨æ„ï¼Œä¸æ­¤å“åº”ä¸€èµ·ï¼Œåº”å‘é€è§£é‡Šé—®é¢˜çš„ç”¨æˆ·å‹å¥½é¡µé¢ã€‚</li><li><strong>504 Gateway Timeout</strong>ï¼šå½“æœåŠ¡å™¨ä½œä¸ºç½‘å…³ï¼Œä¸èƒ½åŠæ—¶å¾—åˆ°å“åº”æ—¶è¿”å›æ­¤é”™è¯¯ä»£ç ã€‚</li><li><strong>505 HTTP Version Not Supported</strong>ï¼šæœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚ä¸­æ‰€ä½¿ç”¨çš„HTTPåè®®ç‰ˆæœ¬ã€‚</li></ul></li></ul><hr><h3 id="URIä¸URL">URIä¸URL</h3><ul><li><strong>URI</strong>ï¼šUniform Resource Identifierï¼Œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦</li><li><strong>URL</strong>ï¼šUniform Resource Locatorï¼Œç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œä¸ä»…æ ‡è¯†äº†èµ„æºï¼Œè¿˜æŒ‡å®šäº†æ“ä½œæˆ–è€…è·å–æ–¹å¼ï¼ŒåŒæ—¶æŒ‡å‡ºäº†ä¸»è¦è®¿é—®æœºåˆ¶å’Œç½‘ç»œä½ç½®ï¼›</li><li><strong>URN</strong>ï¼šUniform Resource Nameï¼Œç»Ÿä¸€èµ„æºåç§°ï¼Œç”¨ç‰¹å®šå‘½åç©ºé—´çš„åå­—æ ‡è¯†èµ„æºï¼Œä½¿ç”¨URNå¯ä»¥åœ¨ä¸çŸ¥é“å…¶ç½‘ç»œä½ç½®åŠè®¿é—®æ–¹å¼çš„æƒ…å†µä¸‹è®¨è®ºèµ„æºã€‚</li></ul><h4 id="URIç»“æ„">URIç»“æ„</h4><p>URI çœŸæ­£æœ€å®Œæ•´çš„ç»“æ„æ˜¯è¿™æ ·çš„ã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210915233628185.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210915233628185.png" class="" title="image-20210915233628185"></a></p><ul><li><strong>scheme</strong> è¡¨ç¤ºåè®®åï¼Œæ¯”å¦‚<code>http</code>, <code>https</code>, <code>file</code>ç­‰ç­‰ã€‚åé¢å¿…é¡»å’Œ<code>://</code>è¿åœ¨ä¸€èµ·ã€‚</li><li><strong>user:passwd</strong>@ è¡¨ç¤ºç™»å½•ä¸»æœºæ—¶çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä¸è¿‡å¾ˆä¸å®‰å…¨ï¼Œä¸æ¨èä½¿ç”¨ï¼Œä¹Ÿä¸å¸¸ç”¨ã€‚</li><li><strong>host:port</strong>è¡¨ç¤ºä¸»æœºåå’Œç«¯å£ã€‚</li><li><strong>path</strong>è¡¨ç¤ºè¯·æ±‚è·¯å¾„ï¼Œæ ‡è®°èµ„æºæ‰€åœ¨ä½ç½®ã€‚</li><li><strong>query</strong>è¡¨ç¤ºæŸ¥è¯¢å‚æ•°ï¼Œä¸º<code>key=val</code>è¿™ç§å½¢å¼ï¼Œå¤šä¸ªé”®å€¼å¯¹ä¹‹é—´ç”¨<code>&amp;</code>éš”å¼€ã€‚</li><li><strong>fragment</strong>è¡¨ç¤º URI æ‰€å®šä½çš„èµ„æºå†…çš„ä¸€ä¸ª<strong>é”šç‚¹</strong>ï¼Œæµè§ˆå™¨å¯ä»¥æ ¹æ®è¿™ä¸ªé”šç‚¹è·³è½¬åˆ°å¯¹åº”çš„ä½ç½®ã€‚</li></ul><p>URI åªèƒ½ä½¿ç”¨<code>ASCII</code>, ASCII ä¹‹å¤–çš„å­—ç¬¦æ˜¯ä¸æ”¯æŒæ˜¾ç¤ºçš„ï¼Œè€Œä¸”è¿˜æœ‰ä¸€éƒ¨åˆ†ç¬¦å·æ˜¯ç•Œå®šç¬¦ï¼Œå¦‚æœä¸åŠ ä»¥å¤„ç†å°±ä¼šå¯¼è‡´è§£æå‡ºé”™ã€‚</p><p>å› æ­¤ï¼ŒURI å¼•å…¥äº†<code>ç¼–ç </code>æœºåˆ¶ï¼Œå°†æ‰€æœ‰<strong>é ASCII ç å­—ç¬¦</strong>å’Œ<strong>ç•Œå®šç¬¦</strong>è½¬ä¸ºåå…­è¿›åˆ¶å­—èŠ‚å€¼ï¼Œç„¶ååœ¨å‰é¢åŠ ä¸ª<code>%</code>ã€‚</p><p>å¦‚ï¼Œç©ºæ ¼è¢«è½¬ä¹‰æˆäº†<code>%20</code>ã€‚</p><p>URIå…è®¸ç»Ÿä¸€è¯†åˆ«èµ„æºã€‚URIå¦å¤–è¢«åˆ†ç»„ä¸ºå®šä½ç¬¦ï¼Œåç§°æˆ–ä¸¤è€…ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥æè¿°URLï¼ŒURNæˆ–ä¸¤è€…ã€‚</p><blockquote><p><strong>URLå’ŒURNéƒ½æ˜¯URIçš„å­é›†</strong>ã€‚æ¢è€Œè¨€ä¹‹ï¼ŒURLå’ŒURNéƒ½æ˜¯URIï¼Œä½†æ˜¯URIä¸ä¸€å®šæ˜¯URLæˆ–è€…URNã€‚</p></blockquote><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/640"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/640" class="" title="å›¾ç‰‡"></a></p><p>ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk">æ„é€ ä¸€ä¸ªURI<br>http:*<span class="hljs-regexp">//</span>bitpoetry.io<span class="hljs-regexp">/posts/</span>hello.html<span class="hljs-comment">#intro</span><br><br>å…¶ä¸­<br>   http:<span class="hljs-regexp">//</span>  <span class="hljs-regexp">//</span> æ˜¯å®šä¹‰å¦‚ä½•è®¿é—®èµ„æºçš„æ–¹å¼<br>   bitpoetry.io<span class="hljs-regexp">/posts/</span>hello.html  <span class="hljs-regexp">//</span> æ˜¯èµ„æºå­˜æ”¾çš„ä½ç½®<br>   <span class="hljs-comment">#intro  // æ˜¯èµ„æº</span><br>   <br>URLæ˜¯URIçš„ä¸€ä¸ªå­é›†ï¼Œå‘Šè¯‰æˆ‘ä»¬è®¿é—®èµ„æºä½ç½®çš„æ–¹å¼ã€‚åœ¨ä¾‹å­ä¸­ï¼ŒURLåº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š   <br>    http:<span class="hljs-regexp">//</span>bitpoetry.io<span class="hljs-regexp">/posts/</span>hello.html<br>    <br>URNæ˜¯URIçš„å­é›†ï¼ŒåŒ…æ‹¬åå­—ï¼ˆç»™å®šçš„å‘½åç©ºé—´å†…ï¼‰ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬è®¿é—®æ–¹å¼ã€‚åœ¨ä¾‹å­ä¸­ï¼ŒURNå¦‚ä¸‹æ‰€ç¤ºï¼š  <br> bitpoetry.io<span class="hljs-regexp">/posts/</span>hello.html<span class="hljs-comment">#intro</span><br>Copy<br></code></pre></td></tr></table></figure><hr><h3 id="HTTP-ä¼ è¾“å®šé•¿å’Œä¸å®šé•¿çš„æ•°æ®">HTTP ä¼ è¾“å®šé•¿å’Œä¸å®šé•¿çš„æ•°æ®</h3><h4 id="å®šé•¿æ•°æ®">å®šé•¿æ•°æ®</h4><ul><li><p>å¯¹äºå®šé•¿åŒ…ä½“è€Œè¨€ï¼Œå‘é€ç«¯åœ¨ä¼ è¾“çš„æ—¶å€™ä¸€èˆ¬ä¼šå¸¦ä¸Š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">Content-<span class="hljs-built_in">Length</span><br></code></pre></td></tr></table></figure><p>, æ¥æŒ‡æ˜åŒ…ä½“çš„é•¿åº¦</p><ul><li>ç”¨ä¸€ä¸ª<code>nodejs</code>æœåŠ¡å™¨æ¥æ¨¡æ‹Ÿä¸€ä¸‹:</li></ul></li></ul><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">const http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><br>const server = http.createServer();<br><br>server.<span class="hljs-literal">on</span>(<span class="hljs-string">&#x27;request&#x27;</span>, <span class="hljs-function"><span class="hljs-params">(req, res)</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span>(req.url === <span class="hljs-string">&#x27;/&#x27;</span>) &#123;<br>    res.setHeader(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;text/plain&#x27;</span>);<br>    res.setHeader(<span class="hljs-string">&#x27;Content-Length&#x27;</span>, <span class="hljs-number">10</span>);<br>    res.write(<span class="hljs-string">&quot;helloworld&quot;</span>);<br>  &#125;<br>&#125;)<br><br>server.listen(<span class="hljs-number">8081</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;æˆåŠŸå¯åŠ¨&quot;</span>);<br>&#125;)<br>Copy<br></code></pre></td></tr></table></figure><p>å¯åŠ¨åè®¿é—®: <strong>localhost:8081</strong>ã€‚</p><p>æµè§ˆå™¨ä¸­æ˜¾ç¤ºå¦‚ä¸‹:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">helloworld<br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>è¿™æ˜¯é•¿åº¦æ­£ç¡®çš„æƒ…å†µï¼Œé‚£ä¸æ­£ç¡®çš„æƒ…å†µæ˜¯å¦‚ä½•å¤„ç†çš„å‘¢</p><p>æˆ‘ä»¬è¯•ç€æŠŠè¿™ä¸ªé•¿åº¦è®¾ç½®çš„å°ä¸€äº›:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">res.setHeader(<span class="hljs-string">&#x27;Content-Length&#x27;</span>, <span class="hljs-number">8</span>);<br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼Œå†æ¬¡è®¿é—®ï¼Œç°åœ¨æµè§ˆå™¨ä¸­å†…å®¹å¦‚ä¸‹:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">hellowor<br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>é‚£åé¢çš„<code>ld</code>å“ªé‡Œå»äº†å‘¢ï¼Ÿå®é™…ä¸Šåœ¨ http çš„å“åº”ä½“ä¸­ç›´æ¥è¢«æˆªå»äº†ã€‚</p><p>ç„¶åæˆ‘ä»¬è¯•ç€å°†è¿™ä¸ªé•¿åº¦è®¾ç½®å¾—å¤§ä¸€äº›:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">res.setHeader(<span class="hljs-string">&#x27;Content-Length&#x27;</span>, <span class="hljs-number">12</span>);<br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶æµè§ˆå™¨æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210916161841752.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210916161841752.png" class="" title="image-20210916161841752"></a></p><p>ç›´æ¥æ— æ³•æ˜¾ç¤ºäº†ã€‚å¯ä»¥çœ‹åˆ°<code>Content-Length</code>å¯¹äº http ä¼ è¾“è¿‡ç¨‹èµ·åˆ°äº†ååˆ†å…³é”®çš„ä½œç”¨ï¼Œå¦‚æœè®¾ç½®ä¸å½“å¯ä»¥ç›´æ¥å¯¼è‡´ä¼ è¾“å¤±è´¥ã€‚</p><h4 id="ä¸å®šé•¿åŒ…ä½“">ä¸å®šé•¿åŒ…ä½“</h4><p>ä¸Šè¿°æ˜¯é’ˆå¯¹äº<code>å®šé•¿åŒ…ä½“</code>ï¼Œé‚£ä¹ˆå¯¹äº<code>ä¸å®šé•¿åŒ…ä½“</code>è€Œè¨€æ˜¯å¦‚ä½•ä¼ è¾“çš„å‘¢ï¼Ÿ</p><p>è¿™é‡Œå°±å¿…é¡»ä»‹ç»å¦å¤–ä¸€ä¸ª http å¤´éƒ¨å­—æ®µäº†:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Transfer-<span class="hljs-keyword">Encoding</span>: chunked<br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>è¡¨ç¤ºåˆ†å—ä¼ è¾“æ•°æ®ï¼Œè®¾ç½®è¿™ä¸ªå­—æ®µåä¼šè‡ªåŠ¨äº§ç”Ÿä¸¤ä¸ªæ•ˆæœ:</p><ul><li>Content-Length å­—æ®µä¼šè¢«å¿½ç•¥</li><li>åŸºäºé•¿è¿æ¥æŒç»­æ¨é€åŠ¨æ€å†…å®¹</li></ul><p>æˆ‘ä»¬ä¾ç„¶ä»¥ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥æ¨¡æ‹Ÿåˆ†å—ä¼ è¾“ï¼Œnodejs ç¨‹åºå¦‚ä¸‹:</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">const http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><br>const server = http.createServer();<br><br>server.<span class="hljs-literal">on</span>(<span class="hljs-string">&#x27;request&#x27;</span>, <span class="hljs-function"><span class="hljs-params">(req, res)</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span>(req.url === <span class="hljs-string">&#x27;/&#x27;</span>) &#123;<br>    res.setHeader(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;text/html; charset=utf8&#x27;</span>);<br>    res.setHeader(<span class="hljs-string">&#x27;Content-Length&#x27;</span>, <span class="hljs-number">10</span>);<br>    res.setHeader(<span class="hljs-string">&#x27;Transfer-Encoding&#x27;</span>, <span class="hljs-string">&#x27;chunked&#x27;</span>);<br>    res.write(<span class="hljs-string">&quot;&lt;p&gt;æ¥å•¦&lt;/p&gt;&quot;</span>);<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>      res.write(<span class="hljs-string">&quot;ç¬¬ä¸€æ¬¡ä¼ è¾“&lt;br/&gt;&quot;</span>);<br>    &#125;, <span class="hljs-number">1000</span>);<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>      res.write(<span class="hljs-string">&quot;ç¬¬äºŒæ¬¡ä¼ è¾“&quot;</span>);<br>      res.end()<br>    &#125;, <span class="hljs-number">2000</span>);<br>  &#125;<br>&#125;)<br><br>server.listen(<span class="hljs-number">8009</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;æˆåŠŸå¯åŠ¨&quot;</span>);<br>&#125;)<br>Copy<br></code></pre></td></tr></table></figure><p>è®¿é—®æ•ˆæœå…¥ä¸‹:</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210917105352387.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210917105352387.png" class="" title="image-20210917105352387"></a></p><hr><h3 id="ä¼ è¾“è¿‡ç¨‹">ä¼ è¾“è¿‡ç¨‹</h3><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921105357172.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921105357172.png" class="" title="image-20210921105357172"></a></p><hr><h2 id="8-4-HTTPSåè®®">8.4 HTTPSåè®®</h2><p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„åŸºç¡€ä¸Šå†åŠ ä¸€å±‚TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼‰æˆ–è€…SSLï¼ˆå®‰å…¨å¥—æ¥å±‚ï¼‰ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸ºäº†åº”ä»˜HTTPæ˜¯æ˜æ–‡ä¼ è¾“çš„ç¼ºç‚¹ï¼Œå®¹æ˜“è¢«ä¸­é—´äººçªƒå¬æˆ–è€…ç¯¡æ”¹ï¼Œå¯¼è‡´éšç§å’Œä¿¡æ¯å®‰å…¨å‡ºç°é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918144054923.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918144054923.png" class="" title="image-20210918144054923"></a></p><h3 id="é€šä¿¡è¿‡ç¨‹">é€šä¿¡è¿‡ç¨‹</h3><h4 id="Client-Hello">Client Hello</h4><p>æ¡æ‰‹ç¬¬ä¸€æ­¥æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ Client Hello æ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯é‡ŒåŒ…å«äº†ä¸€ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºæ•° <strong>Random1</strong>ã€å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†å¥—ä»¶ï¼ˆSupport Ciphersï¼‰å’Œ SSL Version ç­‰ä¿¡æ¯ã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918151748632.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918151748632.png" class="" title="image-20210918151748632"></a></p><h4 id="Server-Hello">Server Hello</h4><p>ç¬¬äºŒæ­¥æ˜¯æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€ Server Hello æ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯ä¼šä» Client Hello ä¼ è¿‡æ¥çš„ Support Ciphers é‡Œç¡®å®šä¸€ä»½åŠ å¯†å¥—ä»¶ï¼Œè¿™ä¸ªå¥—ä»¶å†³å®šäº†åç»­åŠ å¯†å’Œç”Ÿæˆæ‘˜è¦æ—¶å…·ä½“ä½¿ç”¨å“ªäº›ç®—æ³•ï¼Œå¦å¤–è¿˜ä¼šç”Ÿæˆä¸€ä»½éšæœºæ•° <strong>Random2</strong>ã€‚æ³¨æ„ï¼Œè‡³æ­¤å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ‹¥æœ‰äº†ä¸¤ä¸ªéšæœºæ•°ï¼ˆRandom1+ Random2ï¼‰ï¼Œè¿™ä¸¤ä¸ªéšæœºæ•°ä¼šåœ¨åç»­ç”Ÿæˆå¯¹ç§°ç§˜é’¥æ—¶ç”¨åˆ°ã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918151908297.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918151908297.png" class="" title="image-20210918151908297"></a></p><h4 id="Certificate">Certificate</h4><p>è¿™ä¸€æ­¥æ˜¯æœåŠ¡ç«¯å°†è‡ªå·±çš„è¯ä¹¦ä¸‹å‘ç»™å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯éªŒè¯è‡ªå·±çš„èº«ä»½ï¼Œå®¢æˆ·ç«¯éªŒè¯é€šè¿‡åå–å‡ºè¯ä¹¦ä¸­çš„å…¬é’¥ã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918152228237.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918152228237.png" class="" title="image-20210918152228237"></a></p><h4 id="Certificate-Verify">Certificate Verify</h4><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯ä¼ æ¥çš„è¯ä¹¦åï¼Œå…ˆä» CA éªŒè¯è¯¥è¯ä¹¦çš„åˆæ³•æ€§ï¼ŒéªŒè¯é€šè¿‡åå–å‡ºè¯ä¹¦ä¸­çš„æœåŠ¡ç«¯å…¬é’¥ï¼Œå†ç”Ÿæˆä¸€ä¸ªéšæœºæ•° <strong>Random3</strong>ï¼Œå†ç”¨æœåŠ¡ç«¯å…¬é’¥éå¯¹ç§°åŠ å¯† <strong>Random3</strong> ç”Ÿæˆ <strong>PreMaster Key</strong>ã€‚</p><h4 id="Client-Key-Exchange">Client Key Exchange</h4><p>ä¸Šé¢å®¢æˆ·ç«¯æ ¹æ®æœåŠ¡å™¨ä¼ æ¥çš„å…¬é’¥ç”Ÿæˆäº† <strong>PreMaster Key</strong>ï¼ŒClient Key Exchange å°±æ˜¯å°†è¿™ä¸ª key ä¼ ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å†ç”¨è‡ªå·±çš„ç§é’¥è§£å‡ºè¿™ä¸ª <strong>PreMaster Key</strong> å¾—åˆ°å®¢æˆ·ç«¯ç”Ÿæˆçš„ <strong>Random3</strong>ã€‚è‡³æ­¤ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ‹¥æœ‰ <strong>Random1</strong> + <strong>Random2</strong> + <strong>Random3</strong>ï¼Œä¸¤è¾¹å†æ ¹æ®åŒæ ·çš„ç®—æ³•å°±å¯ä»¥ç”Ÿæˆä¸€ä»½ç§˜é’¥ï¼Œæ¡æ‰‹ç»“æŸåçš„åº”ç”¨å±‚æ•°æ®éƒ½æ˜¯ä½¿ç”¨è¿™ä¸ªç§˜é’¥è¿›è¡Œå¯¹ç§°åŠ å¯†ã€‚ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸‰ä¸ªéšæœºæ•°å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º SSL/TLS æ¡æ‰‹è¿‡ç¨‹çš„æ•°æ®éƒ½æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œå¹¶ä¸”å¤šä¸ªéšæœºæ•°ç§å­æ¥ç”Ÿæˆç§˜é’¥ä¸å®¹æ˜“è¢«æš´åŠ›ç ´è§£å‡ºæ¥ã€‚å®¢æˆ·ç«¯å°† <strong>PreMaster Key</strong> ä¼ ç»™æœåŠ¡ç«¯çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918152355695.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918152355695.png" class="" title="image-20210918152355695"></a></p><h4 id="Encrypted-Handshake-Message-Client">Encrypted Handshake Message(Client)</h4><p>è¿™ä¸€æ­¥å¯¹åº”çš„æ˜¯ Client Finish æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å°†å‰é¢çš„æ¡æ‰‹æ¶ˆæ¯ç”Ÿæˆæ‘˜è¦å†ç”¨åå•†å¥½çš„ç§˜é’¥åŠ å¯†ï¼Œè¿™æ˜¯å®¢æˆ·ç«¯å‘å‡ºçš„ç¬¬ä¸€æ¡åŠ å¯†æ¶ˆæ¯ã€‚æœåŠ¡ç«¯æ¥æ”¶åä¼šç”¨ç§˜é’¥è§£å¯†ï¼Œèƒ½è§£å‡ºæ¥è¯´æ˜å‰é¢åå•†å‡ºæ¥çš„ç§˜é’¥æ˜¯ä¸€è‡´çš„ã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918152438216.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918152438216.png" class="" title="image-20210918152438216"></a></p><h4 id="Change-Cipher-Spec-Server">Change Cipher Spec(Server)</h4><p>è¿™ä¸€æ­¥æ˜¯æœåŠ¡ç«¯é€šçŸ¥å®¢æˆ·ç«¯åé¢å†å‘é€çš„æ¶ˆæ¯éƒ½ä¼šä½¿ç”¨åŠ å¯†ï¼Œä¹Ÿæ˜¯ä¸€æ¡äº‹ä»¶æ¶ˆæ¯ã€‚</p><h4 id="Encrypted-Handshake-Message-Server">Encrypted Handshake Message(Server)</h4><p>è¿™ä¸€æ­¥å¯¹åº”çš„æ˜¯ Server Finish æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šå°†æ¡æ‰‹è¿‡ç¨‹çš„æ¶ˆæ¯ç”Ÿæˆæ‘˜è¦å†ç”¨ç§˜é’¥åŠ å¯†ï¼Œè¿™æ˜¯æœåŠ¡ç«¯å‘å‡ºçš„ç¬¬ä¸€æ¡åŠ å¯†æ¶ˆæ¯ã€‚å®¢æˆ·ç«¯æ¥æ”¶åä¼šç”¨ç§˜é’¥è§£å¯†ï¼Œèƒ½è§£å‡ºæ¥è¯´æ˜åå•†çš„ç§˜é’¥æ˜¯ä¸€è‡´çš„ã€‚</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918152522642.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918152522642.png" class="" title="image-20210918152522642"></a></p><h4 id="Application-Data">Application Data</h4><p>åˆ°è¿™é‡Œï¼ŒåŒæ–¹å·²å®‰å…¨åœ°åå•†å‡ºäº†åŒä¸€ä»½ç§˜é’¥ï¼Œæ‰€æœ‰çš„åº”ç”¨å±‚æ•°æ®éƒ½ä¼šç”¨è¿™ä¸ªç§˜é’¥åŠ å¯†åå†é€šè¿‡ TCP è¿›è¡Œå¯é ä¼ è¾“ã€‚</p><hr><h3 id="ä¼ è¾“è¿‡ç¨‹-2">ä¼ è¾“è¿‡ç¨‹</h3><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921105440452.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921105440452.png" class="" title="image-20210921105440452"></a></p><ul><li><strong>HTTPSä¼ è¾“è¿‡ç¨‹æœ€å¤šä¼šæ¯”HTTPå¤š7ä¸ªRTT</strong></li></ul><p>step1ï¼šæ­£å¸¸çš„TCPè¿æ¥ä¸‰æ¬¡æ¡æ‰‹ï¼Œè¿™ä¸å¿…è¯´</p><p>step2ï¼šç„¶åé“¾æ¥ä¼šè·³è½¬åˆ°HTTPSçš„ç½‘ç«™ï¼Œæ¯•ç«Ÿåè®®éƒ½ä¸åŒï¼Œè€ƒè™‘åˆ°ä¸å¯èƒ½äººä¼šæŠŠç½‘å€æ‰“å…¨ï¼Œæ‰€ä»¥è¿˜éœ€è¦è·³è½¬ä¸€æ­¥ã€‚</p><p>step3ï¼šåˆæ˜¯TCPè¿æ¥ï¼Œè¿™é‡Œéœ€è¦åˆä¸€æ­¥TCPè¿æ¥æ˜¯å› ä¸ºHTTPSçš„ä¼ è¾“ç«¯å£ä¸åŒï¼ˆè¿™ä¸ªæ˜¯ä¼ è¾“å±‚çš„ï¼Œhttpæ˜¯80ï¼Œhttpsæ˜¯443ï¼‰ã€‚</p><p>step4ï¼šå®ŒæˆåŠ å¯†å¥—ä»¶çš„åå•†å’Œè¯ä¹¦çš„èº«ä»½ç¡®è®¤ï¼Œè¿™æ¬¡äº¤äº’å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¼šåå•†å‡ºç›¸åŒçš„å¯†é’¥äº¤æ¢ç®—æ³•ã€å¯¹ç§°åŠ å¯†ç®—æ³•ã€å†…å®¹ä¸€è‡´æ€§æ ¡éªŒç®—æ³•ã€è¯ä¹¦ç­¾åç®—æ³•ç­‰ç­‰ã€‚æµè§ˆå™¨è·å–åˆ°è¯ä¹¦ä¹‹åï¼Œä¹Ÿè¦éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼Œæ˜¯å¦è¿‡æœŸæ˜¯å¦æ’¤é”€ã€‚</p><p>step5ï¼šæµè§ˆå™¨è·å–CAåŸŸåï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­CAåŸŸåçš„ç¼“å­˜ï¼Œè¿˜éœ€è¦è¿›è¡ŒDNSè§£æï¼Œåˆéœ€è¦å¤šä¸€æ¬¡äº¤äº’ã€‚</p><p>step6ï¼šè§£ææˆåŠŸè§£æipä¹‹åï¼Œéœ€è¦å’ŒCAç½‘ç«™è¿›è¡Œtcpä¸‰æ¬¡æ¡æ‰‹ã€‚</p><p>step7ï¼šè¿™é‡ŒOCSPè¯·æ±‚ï¼Œå…¨ç§°æ˜¯Online Certificate Status Protocolï¼Œåœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼Œé¡¾åæ€ä¹‰ç”¨æ¥è·å–è¯ä¹¦çŠ¶æ€çš„è¯·æ±‚ï¼Œè¿™é‡Œçš„çŠ¶æ€åŒ…æ‹¬æœ‰æ•ˆã€è¿‡æœŸã€æœªçŸ¥ã€‚å¹¶ä¸”å¯ä»¥å®½é™ä¸€æ®µå®¢æˆ·ç«¯è®¿é—®è¯ä¹¦çš„æ—¶é—´ã€‚</p><p>step8ï¼šä¸»è¦è¿›è¡Œå¯†é’¥åå•†ã€‚</p><hr><h3 id="CAè¯ä¹¦">CAè¯ä¹¦</h3><ul><li>CAæ˜¯Certificate Authorityçš„ç¼©å†™ï¼Œä¹Ÿå«â€œè¯ä¹¦æˆæƒä¸­å¿ƒâ€ã€‚å®ƒæ˜¯è´Ÿè´£ç®¡ç†å’Œç­¾å‘è¯ä¹¦çš„ç¬¬ä¸‰æ–¹æœºæ„ï¼Œä½œç”¨æ˜¯æ£€æŸ¥è¯ä¹¦æŒæœ‰è€…èº«ä»½çš„åˆæ³•æ€§ï¼Œå¹¶ç­¾å‘è¯ä¹¦ï¼Œä»¥é˜²è¯ä¹¦è¢«ä¼ªé€ æˆ–ç¯¡æ”¹ã€‚</li><li>CA è¯ä¹¦å°±æ˜¯CAé¢å‘çš„è¯ä¹¦ã€‚ CAè¯ä¹¦ä¹Ÿå°±æˆ‘ä»¬å¸¸è¯´çš„æ•°å­—è¯ä¹¦ï¼ŒåŒ…å«è¯ä¹¦æ‹¥æœ‰è€…çš„èº«ä»½ä¿¡æ¯ï¼ŒCAæœºæ„çš„ç­¾åï¼Œå…¬é’¥å’Œç§é’¥ã€‚èº«ä»½ä¿¡æ¯ç”¨äºè¯æ˜è¯ä¹¦æŒæœ‰è€…çš„èº«ä»½ï¼›CAç­¾åç”¨äºä¿è¯èº«ä»½çš„çœŸå®æ€§ï¼›å…¬é’¥å’Œç§é’¥ç”¨äºé€šä¿¡è¿‡ç¨‹ä¸­åŠ è§£å¯†ï¼Œä»è€Œä¿è¯é€šè®¯ä¿¡æ¯çš„å®‰å…¨æ€§ã€‚</li></ul><h4 id="CAè¯ä¹¦å†…å®¹">CAè¯ä¹¦å†…å®¹</h4><ul><li>é¢å‘è€…</li><li>ä½¿ç”¨è€…</li><li>ç‰ˆæœ¬</li><li>ç­¾åç®—æ³•</li><li>ç­¾åå“ˆå¸Œç®—æ³•</li><li>ä½¿ç”¨è€…</li><li>å…¬é’¥</li><li>æŒ‡çº¹</li><li>æŒ‡çº¹ç®—æ³•</li></ul><hr><h1>ä¹ã€å…¶å®ƒ</h1><h2 id="9-1-Cookieä¸Session">9.1 Cookieä¸Session</h2><h3 id="åŒºåˆ«">åŒºåˆ«</h3><ol><li>å­˜å‚¨ä½ç½®ä¸åŒï¼š<strong>cookieå­˜æ”¾äºå®¢æˆ·ç«¯ï¼›sessionå­˜æ”¾äºæœåŠ¡ç«¯</strong>ã€‚</li><li>å­˜å‚¨å®¹é‡ä¸åŒï¼šå•ä¸ªcookieä¿å­˜çš„æ•°æ®&lt;=4KBï¼Œä¸€ä¸ªç«™ç‚¹æœ€å¤šä¿å­˜20ä¸ªcookieï¼›è€Œsessionå¹¶æ²¡æœ‰ä¸Šé™ã€‚</li><li>å­˜å‚¨æ–¹å¼ä¸åŒï¼šcookieåªèƒ½ä¿å­˜ASCIIå­—ç¬¦ä¸²ï¼Œå¹¶éœ€è¦é€šè¿‡ç¼–ç å½“æ—¶å­˜å‚¨ä¸ºUnicodeå­—ç¬¦æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ï¼›sessionä¸­èƒ½å¤Ÿå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•´æ•°ã€é›†åˆç­‰ã€‚</li><li>éšç§ç­–ç•¥ä¸åŒï¼šcookieå¯¹å®¢æˆ·ç«¯æ˜¯å¯è§çš„ï¼Œåˆ«æœ‰ç”¨å¿ƒçš„äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„cookieå¹¶è¿›è¡Œcookieæ¬ºéª—ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸å®‰å…¨çš„ï¼›sessionå­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¯¹å®¢æˆ·ç«¯æ˜¯é€æ˜çš„ï¼Œä¸å­˜åœ¨æ•æ„Ÿä¿¡æ¯æ³„éœ²çš„é£é™©ã€‚</li><li>ç”Ÿå‘½å‘¨æœŸä¸åŒï¼šå¯ä»¥é€šè¿‡è®¾ç½®cookieçš„å±æ€§ï¼Œè¾¾åˆ°cookieé•¿æœŸæœ‰æ•ˆçš„æ•ˆæœï¼›sessionä¾èµ–äºåä¸ºJSESSIONIDçš„cookieï¼Œè€Œè¯¥cookieçš„é»˜è®¤è¿‡æœŸæ—¶é—´ä¸º-1ï¼Œåªéœ€å…³é—­çª—å£è¯¥sessionå°±ä¼šå¤±æ•ˆï¼Œå› æ­¤sessionä¸èƒ½é•¿æœŸæœ‰æ•ˆã€‚</li><li>æœåŠ¡å™¨å‹åŠ›ä¸åŒï¼šcookieä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œä¸å ç”¨æœåŠ¡å™¨èµ„æºï¼›sessionä¿ç®¡åœ¨æœåŠ¡å™¨ä¸Šï¼Œæ¯ä¸ªç”¨æˆ·éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªsessionï¼Œå¦‚æœå¹¶å‘é‡å¤§çš„è¯ï¼Œåˆ™ä¼šæ¶ˆè€—å¤§é‡çš„æœåŠ¡å™¨å†…å­˜ã€‚</li><li>æµè§ˆå™¨æ”¯æŒä¸åŒï¼šcookieæ˜¯éœ€è¦æµè§ˆå™¨æ”¯æŒçš„ï¼Œå¦‚æœå®¢æˆ·ç«¯ç¦ç”¨äº†cookieï¼Œåˆ™ä¼šè¯è·Ÿè¸ªå°±ä¼šå¤±æ•ˆï¼›è¿ç”¨sessionå°±éœ€è¦ä½¿ç”¨URLé‡å†™çš„æ–¹å¼ï¼Œæ‰€æœ‰ç”¨åˆ°sessionçš„URLéƒ½è¦è¿›è¡Œé‡å†™ï¼Œå¦åˆ™sessionä¼šè¯è·Ÿè¸ªä¹Ÿä¼šå¤±æ•ˆã€‚</li><li>è·¨åŸŸæ”¯æŒä¸åŒï¼šcookieæ”¯æŒè·¨åŸŸè®¿é—®ï¼Œsessionä¸æ”¯æŒè·¨åŸŸè®¿é—®ã€‚</li></ol><h3 id="Cookie">Cookie</h3><h4 id="Cookie-å±æ€§">Cookie å±æ€§</h4><h5 id="ç”Ÿå­˜å‘¨æœŸ">ç”Ÿå­˜å‘¨æœŸ</h5><p>Cookie çš„æœ‰æ•ˆæœŸå¯ä»¥é€šè¿‡<strong>Expires</strong>å’Œ<strong>Max-Age</strong>ä¸¤ä¸ªå±æ€§æ¥è®¾ç½®ã€‚</p><ul><li><strong>Expires</strong>å³<code>è¿‡æœŸæ—¶é—´</code></li><li><strong>Max-Age</strong>ç”¨çš„æ˜¯ä¸€æ®µæ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯ç§’ï¼Œä»æµè§ˆå™¨æ”¶åˆ°æŠ¥æ–‡å¼€å§‹è®¡ç®—ã€‚</li></ul><p>è‹¥ Cookie è¿‡æœŸï¼Œåˆ™è¿™ä¸ª Cookie ä¼šè¢«åˆ é™¤ï¼Œå¹¶ä¸ä¼šå‘é€ç»™æœåŠ¡ç«¯ã€‚</p><h5 id="ä½œç”¨åŸŸ">ä½œç”¨åŸŸ</h5><p>å…³äºä½œç”¨åŸŸä¹Ÿæœ‰ä¸¤ä¸ªå±æ€§: <strong>Domain</strong>å’Œ<strong>path</strong>, ç»™ <strong>Cookie</strong> ç»‘å®šäº†åŸŸåå’Œè·¯å¾„ï¼Œåœ¨å‘é€è¯·æ±‚ä¹‹å‰ï¼Œå‘ç°åŸŸåæˆ–è€…è·¯å¾„å’Œè¿™ä¸¤ä¸ªå±æ€§ä¸åŒ¹é…ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå¸¦ä¸Š Cookieã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºè·¯å¾„æ¥è¯´ï¼Œ<code>/</code>è¡¨ç¤ºåŸŸåä¸‹çš„ä»»æ„è·¯å¾„éƒ½å…è®¸ä½¿ç”¨ Cookieã€‚</p><h5 id="å®‰å…¨ç›¸å…³">å®‰å…¨ç›¸å…³</h5><p>å¦‚æœå¸¦ä¸Š<code>Secure</code>ï¼Œè¯´æ˜åªèƒ½é€šè¿‡ HTTPS ä¼ è¾“ cookieã€‚</p><p>å¦‚æœ cookie å­—æ®µå¸¦ä¸Š<code>HttpOnly</code>ï¼Œé‚£ä¹ˆè¯´æ˜åªèƒ½é€šè¿‡ HTTP åè®®ä¼ è¾“ï¼Œä¸èƒ½é€šè¿‡ JS è®¿é—®ï¼Œè¿™ä¹Ÿæ˜¯é¢„é˜² XSS æ”»å‡»çš„é‡è¦æ‰‹æ®µã€‚</p><p>ç›¸åº”çš„ï¼Œå¯¹äº CSRF æ”»å‡»çš„é¢„é˜²ï¼Œä¹Ÿæœ‰<code>SameSite</code>å±æ€§ã€‚</p><p><code>SameSite</code>å¯ä»¥è®¾ç½®ä¸ºä¸‰ä¸ªå€¼ï¼Œ<code>Strict</code>ã€<code>Lax</code>å’Œ<code>None</code>ã€‚</p><p><strong>a.</strong> åœ¨<code>Strict</code>æ¨¡å¼ä¸‹ï¼Œæµè§ˆå™¨å®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹è¯·æ±‚æºå¸¦Cookieã€‚æ¯”å¦‚è¯·æ±‚<code>sanyuan.com</code>ç½‘ç«™åªèƒ½åœ¨<code>sanyuan.com</code>åŸŸåå½“ä¸­è¯·æ±‚æ‰èƒ½æºå¸¦ Cookieï¼Œåœ¨å…¶ä»–ç½‘ç«™è¯·æ±‚éƒ½ä¸èƒ½ã€‚</p><p><strong>b.</strong> åœ¨<code>Lax</code>æ¨¡å¼ï¼Œå°±å®½æ¾ä¸€ç‚¹äº†ï¼Œä½†æ˜¯åªèƒ½åœ¨ <code>get æ–¹æ³•æäº¤è¡¨å•</code>å†µæˆ–è€…<code>a æ ‡ç­¾å‘é€ get è¯·æ±‚</code>çš„æƒ…å†µä¸‹å¯ä»¥æºå¸¦ Cookieï¼Œå…¶ä»–æƒ…å†µå‡ä¸èƒ½ã€‚</p><p><strong>c.</strong> åœ¨<code>None</code>æ¨¡å¼ä¸‹ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤æ¨¡å¼ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦ä¸Š Cookieã€‚</p><h4 id="Cookie-çš„ç¼ºç‚¹">Cookie çš„ç¼ºç‚¹</h4><ol><li>å®¹é‡ç¼ºé™·ã€‚Cookie çš„ä½“ç§¯ä¸Šé™åªæœ‰<code>4KB</code>ï¼Œåªèƒ½ç”¨æ¥å­˜å‚¨å°‘é‡çš„ä¿¡æ¯ã€‚</li><li>æ€§èƒ½ç¼ºé™·ã€‚Cookie ç´§è·ŸåŸŸåï¼Œä¸ç®¡åŸŸåä¸‹é¢çš„æŸä¸€ä¸ªåœ°å€éœ€ä¸éœ€è¦è¿™ä¸ª Cookie ï¼Œè¯·æ±‚éƒ½ä¼šæºå¸¦ä¸Šå®Œæ•´çš„ Cookieï¼Œè¿™æ ·éšç€è¯·æ±‚æ•°çš„å¢å¤šï¼Œå…¶å®ä¼šé€ æˆå·¨å¤§çš„æ€§èƒ½æµªè´¹çš„ï¼Œå› ä¸ºè¯·æ±‚æºå¸¦äº†å¾ˆå¤šä¸å¿…è¦çš„å†…å®¹ã€‚ä½†å¯ä»¥é€šè¿‡<code>Domain</code>å’Œ<code>Path</code>æŒ‡å®š<strong>ä½œç”¨åŸŸ</strong>æ¥è§£å†³ã€‚</li><li>å®‰å…¨ç¼ºé™·ã€‚ç”±äº Cookie ä»¥çº¯æ–‡æœ¬çš„å½¢å¼åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¸­ä¼ é€’ï¼Œå¾ˆå®¹æ˜“è¢«éæ³•ç”¨æˆ·æˆªè·ï¼Œç„¶åè¿›è¡Œä¸€ç³»åˆ—çš„ç¯¡æ”¹ï¼Œåœ¨ Cookie çš„æœ‰æ•ˆæœŸå†…é‡æ–°å‘é€ç»™æœåŠ¡å™¨ï¼Œè¿™æ˜¯ç›¸å½“å±é™©çš„ã€‚å¦å¤–ï¼Œåœ¨<code>HttpOnly</code>ä¸º false çš„æƒ…å†µä¸‹ï¼ŒCookie ä¿¡æ¯èƒ½ç›´æ¥é€šè¿‡ JS è„šæœ¬æ¥è¯»å–ã€‚</li></ol><hr><h2 id="9-2-è·¨åŸŸ">9.2 è·¨åŸŸ</h2><p>å½“ä¸€ä¸ªè¯·æ±‚urlçš„åè®®ã€åŸŸåã€ç«¯å£ä¸‰è€…ä¹‹é—´ä»»æ„ä¸€ä¸ªä¸å½“å‰é¡µé¢urlä¸åŒå³ä¸ºè·¨åŸŸ</p><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918143407829.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210918143407829.png" class="" title="image-20210918143407829"></a></p><h3 id="è·¨åŸŸé—®é¢˜å‡ºç°åŸå› ">è·¨åŸŸé—®é¢˜å‡ºç°åŸå› </h3><p>å‡ºäºæµè§ˆå™¨çš„åŒæºç­–ç•¥é™åˆ¶ã€‚åŒæºç­–ç•¥ï¼ˆSameoriginpolicyï¼‰æ˜¯ä¸€ç§çº¦å®šï¼Œå®ƒæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚æœç¼ºå°‘äº†åŒæºç­–ç•¥ï¼Œåˆ™æµè§ˆå™¨çš„æ­£å¸¸åŠŸèƒ½å¯èƒ½éƒ½ä¼šå—åˆ°å½±å“ã€‚å¯ä»¥è¯´Webæ˜¯æ„å»ºåœ¨åŒæºç­–ç•¥åŸºç¡€ä¹‹ä¸Šçš„ï¼Œæµè§ˆå™¨åªæ˜¯é’ˆå¯¹åŒæºç­–ç•¥çš„ä¸€ç§å®ç°ã€‚</p><p><strong>åŒæºç­–ç•¥ä¼šé˜»æ­¢ä¸€ä¸ªåŸŸçš„javascriptè„šæœ¬å’Œå¦å¤–ä¸€ä¸ªåŸŸçš„å†…å®¹è¿›è¡Œäº¤äº’</strong>ã€‚æ‰€è°“åŒæºï¼ˆå³æŒ‡åœ¨åŒä¸€ä¸ªåŸŸï¼‰å°±æ˜¯ä¸¤ä¸ªé¡µé¢å…·æœ‰ç›¸åŒçš„åè®®ï¼ˆprotocolï¼‰ï¼Œä¸»æœºï¼ˆhostï¼‰å’Œç«¯å£å·ï¼ˆportï¼‰</p><h3 id="éåŒæºé™åˆ¶">éåŒæºé™åˆ¶</h3><ul><li>æ— æ³•è¯»å–éåŒæºç½‘é¡µçš„ Cookieã€LocalStorage å’Œ IndexedDB</li><li>æ— æ³•æ¥è§¦éåŒæºç½‘é¡µçš„ DOM</li><li>æ— æ³•å‘éåŒæºåœ°å€å‘é€ AJAX è¯·æ±‚</li></ul><h3 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h3><p><a href="https://igotcha.gitee.io/2021/06/03/JavaWeb/SpringBoot%E4%B8%AD%E5%AE%9E%E7%8E%B0%E8%B7%A8%E5%9F%9F%E7%9A%845%E7%A7%8D%E6%96%B9%E5%BC%8F/">åç«¯è§£å†³æ–¹å¼</a></p><hr><h2 id="9-3-XSSã€CSRF">9.3 XSSã€CSRF</h2><h3 id="XSS">XSS</h3><h4 id="æ¦‚è¿°-4">æ¦‚è¿°</h4><p>XSSï¼šè·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross Site Scriptingï¼‰ï¼Œæ”»å‡»è€…é€šè¿‡åœ¨ç›®æ ‡ç½‘ç«™ä¸Šæ³¨å…¥æ¶æ„è„šæœ¬ï¼Œä½¿ä¹‹åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè¿è¡Œã€‚åˆ©ç”¨è¿™äº›æ¶æ„è„šæœ¬ï¼Œæ”»å‡»è€…å¯è·å–ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯å¦‚ Cookieã€SessionIDç­‰ï¼Œè¿›è€Œå±å®³æ•°æ®å®‰å…¨ã€‚</p><p>XSSåˆ†ä¸ºå­˜å‚¨å‹XSSã€åå°„å‹XSSã€DOMå‹XSS</p><ul><li>å­˜å‚¨å‹XSSçš„æ¶æ„ä»£ç å­˜åœ¨æ•°æ®åº“é‡Œ</li><li>åå°„å‹XSSçš„æ¶æ„ä»£ç å­˜åœ¨URLé‡Œã€‚</li><li>DOMå‹XSSå±äºå‰ç«¯JavaScriptè‡ªèº«çš„å®‰å…¨æ¼æ´ï¼Œ</li></ul><h4 id="å±å®³">å±å®³</h4><ul><li>çªƒå–cookies</li><li>é…åˆå…¶ä»–æ¼æ´ï¼Œå¦‚CSRF</li><li>æ’å…¥å¹¿å‘Š</li></ul><h4 id="é˜²èŒƒ">é˜²èŒƒ</h4><p>é˜²æ­¢ HTML ä¸­å‡ºç°æ³¨å…¥ï¼Œé˜²æ­¢ JavaScript æ‰§è¡Œæ—¶ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚</p><p>å­˜å‚¨å‹XSSã€åå°„å‹XSS</p><ul><li>çº¯å‰ç«¯æ¸²æŸ“ï¼Œä½†æ˜¯è¿˜æ˜¯è¦æ³¨æ„é¿å…DOMå‹XSSæ¼æ´ï¼ˆonloadäº‹ä»¶å’Œhrefä¸­çš„javascript:xxxï¼‰</li><li>è½¬ä¹‰HTML</li><li>ç™½åå•è¿‡æ»¤</li></ul><p>DOMå‹XSS</p><ul><li>å¦‚æœä¸ä½¿ç”¨æ¡†æ¶ï¼Œé¿å…ç›´æ¥ä½¿ç”¨innerHTMLï¼Œå°½é‡ä½¿ç”¨.textContentã€.setAttribute</li><li>é¿å…å†…è”äº‹ä»¶ï¼ˆonClick,onLoadï¼‰ç­‰</li><li>set-cookiesè®¾ç½®Http-Only</li></ul><h3 id="CSRF">CSRF</h3><h4 id="æ¦‚è¿°-5">æ¦‚è¿°</h4><p>CSRFï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCross-site request forgeryï¼‰ï¼ŒæŒŸåˆ¶ç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„Webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•ã€‚</p><h4 id="å±å®³-2">å±å®³</h4><p>æ”»å‡»è€…ç›—ç”¨äº†ä½ çš„èº«ä»½ï¼Œä»¥ä½ çš„åä¹‰å‘é€æ¶æ„è¯·æ±‚ã€‚CSRFèƒ½å¤Ÿåšçš„äº‹æƒ…åŒ…æ‹¬ï¼šä»¥ä½ åä¹‰å‘é€é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç›—å–ä½ çš„è´¦å·ï¼Œç”šè‡³äºè´­ä¹°å•†å“ï¼Œè™šæ‹Ÿè´§å¸è½¬è´¦â€¦â€¦é€ æˆçš„é—®é¢˜åŒ…æ‹¬ï¼š<strong>ä¸ªäººéšç§æ³„éœ²ä»¥åŠè´¢äº§å®‰å…¨</strong>ã€‚</p><h4 id="åŸç†">åŸç†</h4><p><a href="https://igotcha.gitee.io/2021/09/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921115900826.png"><img src="/dajiangdahe.github.io/2021/11/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20210921115900826.png" class="" title="image-20210921115900826"></a></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œè¦å®Œæˆä¸€æ¬¡CSRFæ”»å‡»ï¼Œå—å®³è€…å¿…é¡»ä¾æ¬¡å®Œæˆä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li>ç™»å½•å—ä¿¡ä»»ç½‘ç«™Aï¼Œå¹¶åœ¨æœ¬åœ°ç”ŸæˆCookieã€‚</li><li>åœ¨ä¸ç™»å‡ºAçš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™Bã€‚</li></ul><h4 id="é¿å…">é¿å…</h4><ul><li>cookiesä¸éšç€è·¨åŸŸè¯·æ±‚å‘é€</li><li>è¯·æ±‚å¤´ä¸­çš„Refererè¯·æ±‚å¤´æ¥åˆ¤æ–­è¯·æ±‚æ¥æº</li><li>ä½¿ç”¨Token</li></ul>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºç½‘ç»œåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éœ€è¦åœ¨@Transactionalæ³¨è§£æŒ‡å®šrollbackForæˆ–è€…åœ¨æ–¹æ³•ä¸­æ˜¾ç¤ºçš„rollback</title>
    <link href="/dajiangdahe/2021/11/03/@Transactional%E4%B8%AD%E7%9A%84rollback%E6%83%85%E5%86%B5/"/>
    <url>/dajiangdahe/2021/11/03/@Transactional%E4%B8%AD%E7%9A%84rollback%E6%83%85%E5%86%B5/</url>
    
    <content type="html"><![CDATA[<h1>éœ€è¦åœ¨@Transactionalæ³¨è§£æŒ‡å®šrollbackForæˆ–è€…åœ¨æ–¹æ³•ä¸­æ˜¾ç¤ºçš„rollback</h1><p>æ¯æ¬¡å†™ä»£ç çš„æ—¶å€™ï¼Œåªè¦ä¸æ˜¾ç¤ºçš„å†™å‡ºrollbackï¼Œé˜¿é‡Œå·´å·´å¼€å‘è§„èŒƒå°±ä¼šæç¤ºä½ è¿™ä¸ªåœ°æ–¹æ˜¯éœ€è¦æ˜¾ç¤ºçš„å†™å‡ºrollbackçš„ã€‚</p><h2 id="swigï¿¼1"><img src="/dajiangdahe.github.io/2021/11/03/@Transactional%E4%B8%AD%E7%9A%84rollback%E6%83%85%E5%86%B5/image-20211103143731171.png" class="" title="image-20211103143731171"></h2><ul><li>å¯æŸ¥çš„å¼‚å¸¸ï¼ˆchecked exceptionsï¼‰:Exceptionä¸‹é™¤äº†RuntimeExceptionå¤–çš„å¼‚å¸¸</li><li>ä¸å¯æŸ¥çš„å¼‚å¸¸ï¼ˆunchecked exceptionsï¼‰:RuntimeExceptionåŠå…¶å­ç±»å’Œé”™è¯¯ï¼ˆErrorï¼‰</li></ul><p>å¦‚æœä¸å¯¹è¿è¡Œæ—¶å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå‡ºç°è¿è¡Œæ—¶å¼‚å¸¸ä¹‹åï¼Œè¦ä¹ˆæ˜¯çº¿ç¨‹ä¸­æ­¢ï¼Œè¦ä¹ˆæ˜¯ä¸»ç¨‹åºç»ˆæ­¢ã€‚<br>å¦‚æœä¸æƒ³ç»ˆæ­¢ï¼Œåˆ™å¿…é¡»æ•è·æ‰€æœ‰çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼Œå†³ä¸è®©è¿™ä¸ªå¤„ç†çº¿ç¨‹é€€å‡ºã€‚é˜Ÿåˆ—é‡Œé¢å‡ºç°å¼‚å¸¸æ•°æ®äº†ï¼Œæ­£å¸¸çš„å¤„ç†åº”è¯¥æ˜¯æŠŠå¼‚å¸¸æ•°æ®èˆå¼ƒï¼Œç„¶åè®°å½•æ—¥å¿—ã€‚ä¸åº”è¯¥ç”±äºå¼‚å¸¸æ•°æ®è€Œå½±å“ä¸‹é¢å¯¹æ­£å¸¸æ•°æ®çš„å¤„ç†ã€‚</p><p><strong>éè¿è¡Œæ—¶å¼‚å¸¸</strong>æ˜¯RuntimeExceptionä»¥å¤–çš„å¼‚å¸¸ï¼Œç±»å‹ä¸Šéƒ½å±äºExceptionç±»åŠå…¶å­ç±»ã€‚å¦‚IOExceptionã€SQLExceptionç­‰ä»¥åŠ<strong>ç”¨æˆ·è‡ªå®šä¹‰çš„Exceptionå¼‚å¸¸</strong>ã€‚å¯¹äºè¿™ç§å¼‚å¸¸ï¼ŒJAVAç¼–è¯‘å™¨å¼ºåˆ¶è¦æ±‚æˆ‘ä»¬å¿…éœ€å¯¹å‡ºç°çš„è¿™äº›å¼‚å¸¸è¿›è¡Œcatchå¹¶å¤„ç†ï¼Œå¦åˆ™ç¨‹åºå°±ä¸èƒ½ç¼–è¯‘é€šè¿‡ã€‚<strong>æ‰€ä»¥ï¼Œé¢å¯¹è¿™ç§å¼‚å¸¸ä¸ç®¡æˆ‘ä»¬æ˜¯å¦æ„¿æ„ï¼Œåªèƒ½è‡ªå·±å»å†™ä¸€å¤§å †catchå—å»å¤„ç†å¯èƒ½çš„å¼‚å¸¸.</strong></p><p>**Springæ¡†æ¶çš„äº‹åŠ¡åŸºç¡€æ¶æ„ä»£ç å°†é»˜è®¤åœ°åªåœ¨æŠ›å‡º<code>RuntimeException</code> å’Œ<code>unchecked exceptions</code>æ—¶æ‰æ ‡è¯†äº‹åŠ¡å›æ»šã€‚**ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŠ›å‡ºä¸ª<code>RuntimeException</code>æˆ–å…¶å­ç±»ä¾‹çš„å®ä¾‹æ—¶ã€‚ï¼ˆ<code>Errors</code> ä¹Ÿä¸€æ · - é»˜è®¤åœ° - æ ‡è¯†äº‹åŠ¡å›æ»šã€‚ï¼‰ä»äº‹åŠ¡æ–¹æ³•ä¸­æŠ›å‡ºçš„Checked exceptionså°† ä¸ è¢«æ ‡è¯†è¿›è¡Œäº‹åŠ¡å›æ»šã€‚</p><p>1 è®©checkedä¾‹å¤–ä¹Ÿå›æ»šï¼šåœ¨æ•´ä¸ªæ–¹æ³•å‰åŠ ä¸Š @Transactional(rollbackFor=Exception.class)</p><p>2 è®©uncheckedä¾‹å¤–ä¸å›æ»šï¼š @Transactional(notRollbackFor=RunTimeException.class)</p><p>3 ä¸éœ€è¦äº‹åŠ¡ç®¡ç†çš„(åªæŸ¥è¯¢çš„)æ–¹æ³•ï¼š@Transactional(propagation=Propagation.NOT_SUPPORTED)</p><p><strong>æ³¨æ„ï¼š å¦‚æœå¼‚å¸¸è¢«tryï½›ï½catchï½›ï½äº†ï¼Œäº‹åŠ¡å°±ä¸å›æ»šäº†ï¼Œå¦‚æœæƒ³è®©äº‹åŠ¡å›æ»šå¿…é¡»å†å¾€å¤–æŠ›tryï½›ï½catchï½›throw Exceptionï½ã€‚</strong></p><p><strong>æ³¨æ„ï¼š</strong></p><ul><li><p>Springå›¢é˜Ÿçš„å»ºè®®æ˜¯ä½ åœ¨å…·ä½“çš„ç±»ï¼ˆæˆ–ç±»çš„æ–¹æ³•ï¼‰ä¸Šä½¿ç”¨ @Transactional æ³¨è§£ï¼Œè€Œä¸è¦ä½¿ç”¨åœ¨ç±»æ‰€è¦å®ç°çš„ä»»ä½•æ¥å£ä¸Šã€‚ä½ å½“ç„¶å¯ä»¥åœ¨æ¥å£ä¸Šä½¿ç”¨ @Transactional æ³¨è§£ï¼Œä½†æ˜¯è¿™å°†åªèƒ½å½“ä½ è®¾ç½®äº†åŸºäºæ¥å£çš„ä»£ç†æ—¶å®ƒæ‰ç”Ÿæ•ˆã€‚å› ä¸ºæ³¨è§£æ˜¯ä¸èƒ½ç»§æ‰¿çš„ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœä½ æ­£åœ¨ä½¿ç”¨åŸºäºç±»çš„ä»£ç†æ—¶ï¼Œé‚£ä¹ˆäº‹åŠ¡çš„è®¾ç½®å°†ä¸èƒ½è¢«åŸºäºç±»çš„ä»£ç†æ‰€è¯†åˆ«ï¼Œè€Œä¸”å¯¹è±¡ä¹Ÿå°†ä¸ä¼šè¢«äº‹åŠ¡ä»£ç†æ‰€åŒ…è£…ï¼ˆå°†è¢«ç¡®è®¤ä¸ºä¸¥é‡çš„ï¼‰ã€‚å› æ­¤ï¼Œè¯·æ¥å—Springå›¢é˜Ÿçš„å»ºè®®å¹¶ä¸”åœ¨å…·ä½“çš„ç±»ä¸Šä½¿ç”¨ @Transactional æ³¨è§£ã€‚</p></li><li><p>@Transactional æ³¨è§£æ ‡è¯†çš„æ–¹æ³•ï¼Œå¤„ç†è¿‡ç¨‹å°½é‡çš„ç®€å•ã€‚å°¤å…¶æ˜¯å¸¦é”çš„äº‹åŠ¡æ–¹æ³•ï¼Œèƒ½ä¸æ”¾åœ¨äº‹åŠ¡é‡Œé¢çš„æœ€å¥½ä¸è¦æ”¾åœ¨äº‹åŠ¡é‡Œé¢ã€‚å¯ä»¥å°†å¸¸è§„çš„æ•°æ®åº“æŸ¥è¯¢æ“ä½œæ”¾åœ¨äº‹åŠ¡å‰é¢è¿›è¡Œï¼Œè€Œäº‹åŠ¡å†…è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€åŠ é”æŸ¥è¯¢ç­‰æ“ä½œã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * å•†æˆ·èµ„è´¨ç”³è¯·</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> merchantId  å•†äººid</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> merchantDTO å•†äººdto</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> BusinessException ä¸šåŠ¡å¼‚å¸¸</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-meta">@Transactional(rollbackFor = BusinessException.class)</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">applyMerchant</span><span class="hljs-params">(Long merchantId, MerchantDTO merchantDTO)</span> <span class="hljs-keyword">throws</span> BusinessException </span>&#123;<br><br>       <span class="hljs-comment">//æ¥æ”¶å•†æˆ·èµ„è´¨ï¼Œæ³¨å†Œåˆ°å•†æˆ·è¡¨ä¸­</span><br>       <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == merchantId || <span class="hljs-keyword">null</span> == merchantDTO) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BusinessException(CommonErrorCode.E_200201);<br>       &#125;<br>       <span class="hljs-comment">//æ ¹æ®å•†æˆ·IDæŸ¥è¯¢å•†æˆ·</span><br>       Merchant merchant = <span class="hljs-keyword">null</span>;<br>       <span class="hljs-keyword">try</span> &#123;<br>           merchant = merchantMapper.selectById(merchantId);<br>       &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BusinessException(CommonErrorCode.E_200227);<br>       &#125;<br>       <span class="hljs-comment">//æ•°æ®æµè½¬æ¢</span><br>       Merchant merchantNew = MerchantCovert.instance.dtoToEntity(merchantDTO);<br>       <span class="hljs-comment">//æ­£åœ¨å®¡æ ¸ä¸­</span><br>       merchantNew.setAuditStatus(<span class="hljs-string">&quot;1&quot;</span>);<br>       merchantNew.setTenantId(merchant.getTenantId());<br><br>       <span class="hljs-keyword">try</span> &#123;<br>           merchantMapper.updateById(merchantNew);<br>       &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;æ›´æ–°å•†æˆ·å‡ºé”™&quot;</span>);<br>       &#125;<br><br>   &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½ å½“åƒé¸Ÿé£å¾€ä½ çš„å±±</title>
    <link href="/dajiangdahe/2021/11/02/%E3%80%90%E5%B0%8F%E8%AF%B4%E3%80%91%E4%BD%A0%E5%BD%93%E5%83%8F%E9%B8%9F%E9%A3%9E%E5%BE%80%E4%BD%A0%E7%9A%84%E5%B1%B1/"/>
    <url>/dajiangdahe/2021/11/02/%E3%80%90%E5%B0%8F%E8%AF%B4%E3%80%91%E4%BD%A0%E5%BD%93%E5%83%8F%E9%B8%9F%E9%A3%9E%E5%BE%80%E4%BD%A0%E7%9A%84%E5%B1%B1/</url>
    
    <content type="html"><![CDATA[<h1>ä½ å½“åƒé¸Ÿé£å¾€ä½ çš„å±±ï¼ˆå¡”æ‹‰Â·éŸ¦æ–¯ç‰¹å¼—ï¼‰</h1><hr><h2 id="â—†-åº">â—† åº</h2><blockquote><p>æˆ‘åªæœ‰ä¸ƒå²ï¼Œä½†æˆ‘æ‡‚å¾—ç›¸æ¯”å…¶ä»–ä»»ä½•äº‹ï¼Œæœ€ä»¤æˆ‘ä»¬å®¶ä¸ä¼—ä¸åŒçš„æ˜¯è¿™ä¸ªäº‹å®ï¼šæˆ‘ä»¬ä¸å»ä¸Šå­¦ã€‚<br>çˆ¸çˆ¸æ‹…å¿ƒæ”¿åºœä¼šå¼ºåˆ¶æˆ‘ä»¬å»ä¸Šå­¦ï¼Œä½†å¹¶æ²¡æœ‰ï¼Œå› ä¸ºæ”¿åºœå‹æ ¹å„¿ä¸çŸ¥é“æˆ‘ä»¬çš„å­˜åœ¨ã€‚æˆ‘ä»¬å®¶æœ‰ä¸ƒä¸ªå­©å­ï¼Œå…¶ä¸­å››ä¸ªæ²¡æœ‰å‡ºç”Ÿè¯æ˜ã€‚æˆ‘ä»¬æ²¡æœ‰åŒ»ç–—è®°å½•ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½æ˜¯åœ¨å®¶é‡Œå‡ºç”Ÿçš„ï¼Œä»æœªå»åŒ»é™¢çœ‹è¿‡åŒ»ç”Ÿæˆ–æŠ¤å£«ã€‚ï¿¼æˆ‘ä»¬æ²¡æœ‰å…¥å­¦è®°å½•ï¼Œå› ä¸ºæˆ‘ä»¬ä»æœªè¸è¿›æ•™å®¤ä¸€æ­¥ã€‚æˆ‘ä¹å²æ—¶æ‰ä¼šæœ‰ä¸€å¼ å»¶æœŸå‡ºç”Ÿè¯æ˜ï¼Œä½†åœ¨è¿™ä¸€åˆ»ï¼Œå¯¹çˆ±è¾¾è·å·å’Œè”é‚¦æ”¿åºœè€Œè¨€ï¼Œæˆ‘ä¸å­˜åœ¨ã€‚</p></blockquote><p>å¡”æ‹‰ç»™æˆ‘ä¸€ç§éå¸¸æ·¡ç„¶ï¼Œå¹³é™çš„å™è¿°ã€‚</p><h2 id="â—†-é˜¿å¸•å¥‡å¥³äºº">â—† é˜¿å¸•å¥‡å¥³äºº</h2><blockquote><p>åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸ªå¾®ç¬‘æ—¢å¸¦ç€å›°æƒ‘ï¼Œåˆé¥¶æœ‰å…´è‡´ï¼Œä¼¼ä¹åœ¨è¯´ï¼šæˆ‘è¯´å¾—å¯¹å§ï¼Œæ²¡æœ‰æ¯”ç°å®ç”Ÿæ´»æ›´æœ‰æ„æ€çš„äº†ã€‚</p></blockquote><h2 id="â—†-è¯šå®çš„æ±¡å¢">â—† è¯šå®çš„æ±¡å¢</h2><blockquote><p>ä»ä¸€ä¹ä¹ä¸€å¹´ç§‹åˆ°ä¸€ä¹ä¹äºŒå¹´æ˜¥æœ«ï¼Œæ³°å‹’ä¸€æ•´å¹´éƒ½åœ¨ä¸Šå­¦ã€‚ä»–å­¦äº†ä»£æ•°ï¼Œä»£æ•°ä¹‹äºä»–çš„å¤§è„‘å°±å¦‚ç©ºæ°”ä¹‹äºä»–çš„è‚ºä¸€æ ·è‡ªç„¶ã€‚</p></blockquote><blockquote><p>å½“æ ‘å¶å¼€å§‹å˜è‰²ï¼Œä»å¤å¤©çš„æœæ¾ç»¿å˜æˆç§‹å¤©çš„çŸ³æ¦´çº¢å’Œå¤é“œé‡‘ï¼Œæˆ‘ç”¨æ‰‹æŒ‡æ— æ•°æ¬¡æ‘©æŒ²é‚£æšé“¶å¸ï¼Œå³ä½¿åœ¨æœ€æš—çš„å…‰çº¿ä¸‹ï¼Œå®ƒä»å¹½å¹½åœ°é—ªç€å¾®å…‰ã€‚è¿™ç§åŸå§‹çš„èº«ä½“æ´»åŠ¨ç»™æˆ‘å®‰æ…°ï¼Œè®©æˆ‘ç¡®ä¿¡å¦‚æœé“¶å¸æ˜¯çœŸçš„ï¼Œæ³°å‹’å°±ä¸ä¼šç¦»å¼€ã€‚</p></blockquote><p>å‰é¢ï¼Œå½“â€œæˆ‘â€æ‘©æŒ²ç€ç¡¬å¸çš„æ—¶å€™ï¼Œâ€œæˆ‘â€è®¤ä¸ºæ³°å‹’ä¼šæ°¸è¿œç«™åœ¨æˆ‘è¿™è¾¹ï¼Œå½“â€œæˆ‘â€çªç„¶æ„è¯†åˆ°ä»–æƒ³è¦ä»€ä¹ˆçš„æ—¶å€™ï¼Œâ€œæˆ‘â€è§‰å¾—ä»–èƒŒå›äº†â€œæˆ‘â€ã€‚</p><blockquote><p>æœ‰é‚£ä¹ˆä¸€åˆ»ï¼Œæˆ‘åœ¨æƒ³éš¾é“è¿™å°±æ˜¯æ³°å‹’æƒ³è¦çš„ï¼šæ¼‚äº®çš„æˆ¿å­ï¼Œæ¼‚äº®çš„å«ç”Ÿé—´ï¼Œæ¼‚äº®çš„å¦¹å¦¹ã€‚ä¹Ÿè®¸ä»–ç¦»å¼€å°±æ˜¯ä¸ºäº†è¿™ä¸ªã€‚æƒ³åˆ°è¿™é‡Œæˆ‘å°±å¯¹ä»–å¿ƒç”Ÿæ€¨æ¨ã€‚</p></blockquote><h2 id="â—†-å¤§å°ç›¾ç‰Œ">â—† å¤§å°ç›¾ç‰Œ</h2><blockquote><p>äººæ€»æ˜¯å¸Œæœ›å¥‡è¿¹å‘ç”Ÿã€‚â€å¥¹å¯¹æˆ‘è¯´ï¼Œâ€œå¦‚æœèƒ½ç»™ä»–ä»¬å¸¦æ¥å¸Œæœ›ï¼Œè®©ä»–ä»¬ç›¸ä¿¡è‡ªå·±æ­£åœ¨å¥½è½¬ï¼Œä»–ä»¬å°±ä»€ä¹ˆéƒ½ä¿¡ï¼Œä»€ä¹ˆéƒ½åƒã€‚ä½†æ˜¯ä¸–ç•Œä¸Šæ ¹æœ¬æ²¡æœ‰é­”æ³•è¿™ç§ä¸œè¥¿ã€‚è¥å…»ã€é”»ç‚¼å’Œé’»ç ”è‰è¯ç‰¹æ€§ï¼Œè¿™æ‰æ˜¯å…¨éƒ¨ã€‚ä½†äººä»¬ç”Ÿç—…å—ç½ªæ—¶ï¼Œä½ è¯´è¿™ä¸ªä»–ä»¬ä¸æ¥å—ã€‚â€</p></blockquote><p>å¸Œæœ›æ˜¯æœ€åä¸€é¢—ç¨»è‰ï¼Œè¿™ä¹Ÿæ­£æ˜¯å¥‡è¿¹çš„å«ä¹‰</p><blockquote><p>ç†æŸ¥å¾·å°±ä¼šæŠŠä¹¦å‡‘åˆ°é¼»å­è¾¹ï¼Œåœ¨é»‘æš—ä¸­çœ‹ä¹¦ã€‚ä»–å°±æ˜¯å¦‚æ­¤ç—´è¿·ï¼Œå¦‚æ­¤æƒ³çœ‹é‚£æœ¬ç™¾ç§‘å…¨ä¹¦ã€‚</p></blockquote><p>è¿™æ˜¯ä¸€ç§åæŠ—ï¼Œä¸€ç§è®¤çŸ¥ä½“ç³»æ„å»ºè¿‡ç¨‹ä¸­ä¹¦ç±ä¼ é€’å‡ºçš„ä¿¡æ¯ä¸çˆ¶äº²ä¿¡æ¯ç›¸æ‚–çš„ç»“æœã€‚</p><h2 id="â—†-è€¶å’Œåå¿…é¢„å¤‡">â—† è€¶å’Œåå¿…é¢„å¤‡</h2><blockquote><p>æˆ‘æƒ³è±¡çˆ¸çˆ¸ä»°æœ›è‹ç©¹ï¼Œé«˜å£°ç¥ˆç¥·ï¼Œç„¶åæŠŠå„¿å­æŠ±ä¸Šå¡è½¦ï¼Œè®©ä»–ååœ¨é©¾é©¶åº§ä¸Šã€‚çˆ¸çˆ¸æŒ‚ä¸ŠæŒ¡ï¼Œå¡è½¦å¼€åŠ¨ã€‚è½¦å­å¼€å¾—å¤Ÿå¿«äº†ï¼Œå¢å…‹ç´§æ¡æ–¹å‘ç›˜ã€‚çˆ¸çˆ¸ä»è¡Œé©¶çš„å¡è½¦ä¸Šè·³äº†ä¸‹æ¥ï¼Œé‡é‡æ‘”åœ¨åœ°ä¸Šï¼Œæ»šäº†ä¸€åœˆï¼Œç„¶åè·‘å›ç«è¾¹ã€‚ç«åŠ¿è¶Šçƒ§è¶Šæ—ºï¼Œç«è‹—è¶Šè¹¿è¶Šé«˜ã€‚ä»–é«˜å‘¼ç€â€œè€¶å’Œåå¿…é¢„å¤‡â€ï¼Œè„±ä¸‹è¡¬è¡«ï¼Œå¼€å§‹ä¸ç«ç„°æˆ˜æ–—ã€‚</p></blockquote><p>ä»–é«˜å‘¼ç€â€œè€¶å’Œåå¿…é¢„å¤‡â€ï¼Œå‡†å¤‡ä¸è‡ªå·±çš„ä¿¡ä»°å»æˆ˜æ–—ï¼Œæ‰€å¹¸å¢å…‹èº«ä¸Šçš„ç«è¢«æ‰‘ç­ï¼Œæ‰€å¹¸å¢å…‹çš„æ€§å‘½å¾—ä»¥ä¿å­˜ï¼Œæ‰€å¹¸ä»–çš„ä¿¡ä»°ä¸ç­ï¼Œå¦åˆ™æˆ‘çœŸçš„éš¾ä»¥æƒ³è±¡åé¢çš„æƒ…èŠ‚å’Œä»–æ¥ä¸‹æ¥çš„å˜åŒ–ã€‚</p><h2 id="â—†-ç¾½æ¯›ç›¾ç‰Œ">â—† ç¾½æ¯›ç›¾ç‰Œ</h2><blockquote><p>èº«æ—çš„é‚£ä¸ªäººå°±æ˜¯è‚–æ©ï¼Œæˆ‘çœ‹ç€ä»–ï¼Œä½†çœ‹ä¸é€ä»–ã€‚æˆ‘ä¸çŸ¥é“æˆ‘çœ‹åˆ°äº†ä»€ä¹ˆâ€”â€”åœ¨é‚£æå…¶æš´åŠ›åˆå¯Œæœ‰åŒæƒ…å¿ƒçš„è¡Œä¸ºèƒŒåï¼Œæˆ‘åˆ°åº•å¬å”¤å‡ºäº†ä»€ä¹ˆç”Ÿç‰©â€”â€”ä½†æˆ‘æƒ³æˆ‘çœ‹åˆ°äº†çˆ¶äº²ï¼Œæˆ–è€…æˆ‘æ‰€å¸Œæœ›çš„çˆ¶äº²çš„æ ·å­ï¼Œä¸€ä½æˆ‘æ¸´æœ›å·²ä¹…çš„å®ˆæŠ¤è€…ï¼Œä¸€åæƒ³è±¡å‡ºæ¥çš„æ–—å£«ï¼Œä¸€ä¸ªä¸ä¼šæŠŠæˆ‘æ‰”è¿›æš´é£é›ªä¸­çš„äººï¼Œä¸€ä¸ªå½“æˆ‘å—äº†ä¼¤ï¼Œèƒ½è®©æˆ‘é‡æ–°å˜å¾—å®Œæ•´çš„äººã€‚</p></blockquote><h2 id="â—†-ç›´è§‰">â—† ç›´è§‰</h2><blockquote><p>å®ƒä»¬æ˜¯æ¥è‡ªå¦ä¸€ä¸ªä¸–ç•Œçš„æ— æƒ…åˆå¼ºå¤§çš„åŒ–èº«ã€‚éª‘ä¸Šå®ƒä»¬å°±æ˜¯æ”¾å¼ƒè‡ªå·±çš„ç«‹è¶³ç‚¹ï¼Œè¿›å…¥å®ƒä»¬çš„é¢†åœ°ï¼Œå†’ç€ä¸€å»ä¸å›çš„å±é™©ã€‚</p></blockquote><h2 id="â—†-é±¼çœ¼ç›">â—† é±¼çœ¼ç›</h2><blockquote><p>è¿™ä¸€åˆ»å®šä¹‰äº†æˆ‘å¯¹é‚£ä¸€æ™šçš„è®°å¿†ï¼Œä»¥åŠä¹‹åé•¿è¾¾åå¹´ä¹‹ä¹…å¾ˆå¤šç±»ä¼¼çš„å¤œæ™šçš„è®°å¿†ã€‚åœ¨è¿™æ ·çš„è®°å¿†ä¸­ï¼Œæˆ‘çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªåšä¸å¯æ‘§ã€åƒçŸ³å¤´ä¸€æ ·éš¾ä»¥å¯¹ä»˜çš„è‡ªå·±ã€‚èµ·åˆæˆ‘ä»…ä»…æ˜¯è®©è‡ªå·±ç›¸ä¿¡è¿™ä¸€ç‚¹ï¼Œç›´åˆ°æœ‰ä¸€å¤©å®ƒå˜æˆäº†ç°å®ã€‚ç„¶åæˆ‘æ‰èƒ½å¦è¯šåœ°å‘Šè¯‰è‡ªå·±ï¼Œè¿™å¯¹æˆ‘æ²¡æœ‰å½±å“ï¼Œä»–æ²¡æœ‰å½±å“åˆ°æˆ‘ï¼Œå› ä¸ºæ²¡æœ‰ä»€ä¹ˆå¯ä»¥å½±å“æˆ‘ã€‚æˆ‘ä¸æ˜ç™½æˆ‘çš„è¿™ç§æ­£ç¡®æ˜¯å¤šä¹ˆç—…æ€ï¼Œä¸æ˜ç™½è‡ªå·±æ˜¯å¦‚ä½•æç©ºäº†è‡ªå·±ã€‚å°½ç®¡æˆ‘ä¸€ç›´è¢«é‚£æ™šçš„åæœæ‰€å›°æ‰°ï¼Œä½†æˆ‘è¯¯è§£äº†æœ€é‡è¦çš„äº‹å®ï¼šå®ƒæ²¡æœ‰å½±å“æˆ‘ï¼Œè¿™æœ¬èº«å°±æ˜¯å®ƒçš„å½±å“ã€‚</p></blockquote><p>å¤©å°†é™å¤§ä»»äºæ–¯äººä¹Ÿï¼Œå¿…å…ˆè‹¦å…¶å¿ƒå¿—ï¼ŒåŠ³å…¶ç­‹éª¨ï¼Œé¥¿å…¶ä½“è‚¤ï¼Œç©ºä¹å…¶èº«ï¼Œè¡Œæ‹‚ä¹±å…¶æ‰€ä¸ºï¼Œæ‰€ä»¥åŠ¨å¿ƒå¿æ€§ï¼Œæ›¾ç›Šå…¶æ‰€ä¸èƒ½ã€‚</p><p>è½¬ï¼šâ€œæš´é£é›¨ç»“æŸåï¼Œä½ ä¸ä¼šè®°å¾—è‡ªå·±æ˜¯æ€æ ·æ´»ä¸‹æ¥çš„ã€‚ä½ ç”šè‡³ä¸ç¡®å®šæš´é£é›¨çœŸçš„ç»“æŸäº†ã€‚ä½†æœ‰ä¸€ä»¶äº‹æ˜¯ç¡®å®šçš„:å½“ä½ ç©¿è¿‡äº†æš´é£é›¨ï¼Œä½ å°±ä¸å†æ˜¯åŸæ¥é‚£ä¸ªäººã€‚è¿™å°±æ˜¯å…³äºæš´é£é›¨çš„ä¸€åˆ‡ã€‚â€<br>â€”â€”ã€Šæµ·è¾¹çš„å¡å¤«å¡ã€‹</p><h2 id="â—†-æ²‰é»˜çš„æ•™å ‚">â—† æ²‰é»˜çš„æ•™å ‚</h2><blockquote><p>æ³°å‹’èµ·èº«è¦èµ°ã€‚â€œå¤–é¢æœ‰ä¸€ä¸ªä¸–ç•Œï¼Œå¡”æ‹‰ï¼Œâ€ä»–è¯´ï¼Œâ€œä¸€æ—¦çˆ¸çˆ¸ä¸å†åœ¨ä½ è€³è¾¹çŒè¾“ä»–çš„è§‚ç‚¹ï¼Œä¸–ç•Œå°±ä¼šçœ‹èµ·æ¥å¤§ä¸ä¸€æ ·ã€‚â€</p></blockquote><p>æ‰“ç ´ä½ è®¤çŸ¥ä½“ç³»çš„å”¯ä¸€åŠæ³•å°±æ˜¯å¤–ç•Œä¸»åŠ¨æ³¨å…¥ã€‚</p><h2 id="â—†-ä¸å†æ˜¯å­©å­">â—† ä¸å†æ˜¯å­©å­</h2><blockquote><p>å¥¹æŠŠç›®å…‰è½¬å‘æˆ‘ã€‚æˆ‘å·²å¤šå¹´æœªæ„Ÿå—åˆ°å¥¹ç›®å…‰çš„åŠ›é‡äº†ï¼Œä¸ºæ­¤æˆ‘æƒŠå‘†äº†ã€‚â€œåœ¨æˆ‘æ‰€æœ‰çš„å­©å­ä¸­ï¼Œâ€å¥¹è¯´ï¼Œâ€œæˆ‘åŸä»¥ä¸ºä½ æ‰æ˜¯é‚£ä¸ªç©¿è¶Šç†Šç†Šå¤§ç«å†²å‡ºè¿™é‡Œçš„äººã€‚æˆ‘ä»æ²¡æ–™åˆ°ä¼šæ˜¯æ³°å‹’â€”â€”é‚£ä»¤äººæ„å¤–â€”â€”è€Œä¸æ˜¯ä½ ã€‚ä½ ä¸è¦ç•™ä¸‹ã€‚èµ°å§ã€‚ä¸è¦è®©ä»»ä½•äº‹é˜»æ­¢ä½ èµ°ã€‚â€</p></blockquote><p>ï¼ˆè½¬ï¼‰å¦‚æœæœ‰ä¸€å¤©ï¼šä½ ä¸å†å¯»æ‰¾çˆ±æƒ…ï¼Œåªæ˜¯å»çˆ±ï¼›ä¸å†æ¸´æœ›æˆåŠŸï¼Œåªæ˜¯å»åšï¼›ä½ ä¸å†è¿½æ±‚ç©ºæ³›çš„æˆé•¿ï¼Œåªæ˜¯å¼€å§‹ä¿®å…»è‡ªå·±çš„æ€§æƒ…ï¼›ä½ çš„äººç”Ÿï¼Œæ‰çœŸæ­£å¼€å§‹ã€‚</p><p>â€‹ â€” çºªä¼¯ä¼¦</p><blockquote><p>æˆ‘ä»¬ä¿©éƒ½æ˜¯é±¼çœ¼ç›ã€‚</p></blockquote><p>éƒ½æ˜¯å¯æ€œäººå„¿</p><h2 id="â—†-ä¸å¿ çš„äººï¼Œè¿é€†çš„å¤©å ‚">â—† ä¸å¿ çš„äººï¼Œè¿é€†çš„å¤©å ‚</h2><p>æ­å–œä½ ï¼Œå¡”æ‹‰ï¼Œå‹‡æ•¢çš„è¿ˆå‡ºè¿™ä¸€æ­¥ï¼Œå°½ç®¡è¿™ä¸€æ­¥ä»£è¡¨äº†ææƒ§ã€æœŸå¾…ã€å†³è£‚ å®ƒä»æ˜¯ä½ æœ€å‹‡æ•¢çš„ä¸€æ­¥ã€‚</p><h2 id="â—†-çˆ¶è¾ˆçš„åŸè¯µ">â—† çˆ¶è¾ˆçš„åŸè¯µ</h2><blockquote><p>â€œåƒè…çƒ‚çš„æ¤ç‰©ã€‚â€<br>æˆ‘è€¸äº†è€¸è‚©ã€‚</p></blockquote><p>ä¹ æƒ¯äº†</p><blockquote><p>æœ‰çš„äººåå¯¹å¹³ç­‰çš„å¤§æ½®ï¼›æœ‰çš„äººå¿…é¡»ä»æŸäº›äººé‚£é‡Œå¤ºå–è‡ªç”±ã€‚</p></blockquote><h2 id="â—†-æˆ‘ä»¬çš„ä½è¯­ï¼Œæˆ‘ä»¬çš„å°–å«">â—† æˆ‘ä»¬çš„ä½è¯­ï¼Œæˆ‘ä»¬çš„å°–å«</h2><blockquote><p>å¯¹æˆ‘æ¥è¯´é‡è¦çš„ä¸æ˜¯çˆ±æƒ…æˆ–å‹æƒ…ï¼Œè€Œæ˜¯æˆ‘è‡ªæ¬ºæ¬ºäººçš„èƒ½åŠ›ï¼šç›¸ä¿¡è‡ªå·±å¾ˆåšå¼ºã€‚æŸ¥å°”æ–¯çŸ¥é“æˆ‘å¹¶éå¦‚æ­¤ï¼Œå› æ­¤æˆ‘æ°¸è¿œä¸ä¼šåŸè°…ä»–ã€‚</p></blockquote><h2 id="â—†-æ¯•ä¸š">â—† æ¯•ä¸š</h2><blockquote><p>â€œå¦‚æœä½ åœ¨ç¾å›½ï¼Œâ€ä»–ä½å£°è¯´ï¼Œâ€œæ— è®ºä½ åœ¨å“ªä¸ªè§’è½ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å»æ‰¾ä½ ã€‚æˆ‘åœ¨åœ°ä¸‹åŸ‹äº†ä¸€åƒåŠ ä»‘æ±½æ²¹ã€‚ä¸–ç•Œæœ«æ—¥æ¥ä¸´æ—¶æˆ‘å¯ä»¥å»æ¥ä½ ï¼Œå¸¦ä½ å›å®¶ï¼Œè®©ä½ å¹³å¹³å®‰å®‰çš„ã€‚ä½†è¦æ˜¯ä½ å»äº†å¤§æ´‹å½¼å²¸â€¦â€¦â€</p></blockquote><h2 id="â—†-æ‚²å‰§ä¹‹åçš„é—¹å‰§">â—† æ‚²å‰§ä¹‹åçš„é—¹å‰§</h2><blockquote><p>é¢å¯¹ç°å®æ˜¯ç—›è‹¦çš„ï¼Œå¥¹å†™é“ï¼Œæ„è¯†åˆ°æœ‰ä¸‘æ¶çš„ä¸œè¥¿å­˜åœ¨ï¼Œè€Œæˆ‘å¯¹æ­¤è§†è€Œä¸è§ã€‚</p></blockquote><h2 id="â—†-äº‹ç‰©çš„æœ¬è´¨">â—† äº‹ç‰©çš„æœ¬è´¨</h2><blockquote><p>ä½ ä¼šé€‰æ‹©è¿™æ ·çš„åˆ€è¿›è¡Œä¸€åœºæ€æˆ®ï¼Œåœ¨çŒç‰©çš„å¿ƒè„åœæ­¢è·³åŠ¨çš„é‚£ä¸€åˆ»ï¼Œæ„Ÿå—é²œè¡€ä»æŒå¿ƒæµè¿‡ï¼šé‚£ä¸æ˜¯å†œå¤«çš„åˆ€ï¼Œç”šè‡³ä¸æ˜¯å± å¤«çš„åˆ€ã€‚å®ƒæ˜¯ä¸€æŠŠæ„¤æ€’çš„åˆ€ã€‚</p></blockquote><h2 id="â—†-ä¸¤åŒæŒ¥èˆçš„æ‰‹è‡‚">â—† ä¸¤åŒæŒ¥èˆçš„æ‰‹è‡‚</h2><blockquote><p>æˆ‘åœ¨ä¹çš„æ˜¯ä»–çš„æƒ³æ³•ï¼›ä»–æ‰æ˜¯æˆ‘è¦å¤±å»çš„äººã€‚</p></blockquote><h2 id="â—†-å®ˆæœ›é‡ç‰›">â—† å®ˆæœ›é‡ç‰›</h2><blockquote><p>ä½†æˆ‘çŸ¥é“ï¼Œä¸€æ—¦èµ°è¿›é‚£æ‰‡é—¨ï¼Œå°†æœ‰ä»€ä¹ˆå¿ƒç…§ä¸å®£çš„åå®šç­‰ç€æˆ‘ã€‚æˆ‘å¯ä»¥å¾—åˆ°æ¯çˆ±ï¼Œä½†æœ‰ä¸€äº›æ¡ä»¶ï¼Œå’Œä¸‰å¹´å‰ä»–ä»¬ç»™æˆ‘å¼€å‡ºçš„æ¡ä»¶ä¸€æ ·ï¼šç”¨æˆ‘çš„ç°å®æ¥äº¤æ¢ä»–ä»¬çš„ç°å®ï¼Œå°†è‡ªå·±çš„è§è§£åŸ‹è‘¬ï¼Œè®©å®ƒåœ¨å¤§åœ°ä¸­è…çƒ‚ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å°è¯´</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MacOSç³»ç»Ÿæ¯æ¬¡æ›´æ–°ç³»ç»Ÿåmissing xcrun</title>
    <link href="/dajiangdahe/2021/10/30/xcrun/"/>
    <url>/dajiangdahe/2021/10/30/xcrun/</url>
    
    <content type="html"><![CDATA[<h1>macç³»ç»Ÿæ¯æ¬¡æ›´æ–°ç³»ç»Ÿåmissing xcrun at:/Library/Developer/CommandLineTools/usr/bin/xcrun</h1><hr><p>æ˜¨æ—¥Macç”± big sur å‡çº§åˆ° Monterey åï¼Œéƒ¨ç½²blogï¼Œå‡ºç°fatal errorã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">(base) guolonghang@guolonghangdeMacBook-Pro blog % hexo d<br>INFO  Validating config<br>INFO  Deploying: git<br>INFO  Clearing .deploy_git folder...<br>INFO  Copying files from public folder...<br>INFO  Copying files from extend dirs...<br>xcrun: error: invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun<br>FATAL &#123;<br>  err: Error: Spawn failed<br>      at ChildProcess.&lt;anonymous&gt; (/Users/guolonghang/Documents/blog/node_modules/hexo-util/lib/spawn.js:51:21)<br>      at ChildProcess.emit (node:events:390:28)<br>      at Process.ChildProcess._handle.onexit (node:internal/child_process:290:12) &#123;<br>    code: 1<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ã€åŸå› ã€‘</strong></p><p>ç³»ç»Ÿå‡çº§åï¼Œé»˜è®¤æ˜¯ä¸ä¼šå®‰è£…Command Line Toolsçš„ï¼Œè€Œåœ¨å¾ˆå¤šæ—¶å€™éƒ½ä¼šä½¿ç”¨åˆ°Command Line Toolsã€‚å®é™…åŸå› å¾ˆç®€å•æ˜¯ç¼ºå°‘ç›¸å…³çš„å¯æ‰§è¡Œæ–‡ä»¶å¯¼è‡´çš„ï¼Œæ­¤å¤„è™½ç„¶hexoæ‰§è¡Œå¤±è´¥ï¼Œä½†æ˜¯æ ¸å¿ƒæ˜¯gitæ‰§è¡Œå¤±è´¥ã€‚</p><p><strong>ã€è§£å†³ã€‘</strong></p><blockquote><p>xcode-select --install</p></blockquote><p>è¿™ä¸ªä¼šè§¦å‘softwareupdateï¼Œç­‰å¾…å®‰è£…å®Œå°±OKäº†ã€‚å¦‚æœæœ‰äº›å·¥å…·åœ¨å®‰è£…å®Œä¾ç„¶æŠ¥é”™ï¼Œå¯ä»¥å°è¯•é‡å¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MacOSç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MacOSæ—¥å¸¸</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zookeeperä»å…¥é—¨åˆ°æ”¾å¼ƒ</title>
    <link href="/dajiangdahe/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/"/>
    <url>/dajiangdahe/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/</url>
    
    <content type="html"><![CDATA[<hr><h1>1. zookeeperå…¥é—¨</h1><h2 id="1-1-æ¦‚è¿°">1.1 æ¦‚è¿°</h2><p>zookeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼çš„ï¼Œä¸ºåˆ†å¸ƒå¼æ¡†æ¶æ<strong>ä¾›åè°ƒæœåŠ¡</strong>çš„Apacheé¡¹ç›®</p><h2 id="1-2-å·¥ä½œæœºåˆ¶">1.2 å·¥ä½œæœºåˆ¶</h2><p>Zookeeperä»è®¾è®¡æ¨¡å¼è§’åº¦æ¥ç†è§£ï¼šæ˜¯ä¸€ä¸ª<strong>åŸºäºè§‚å¯Ÿè€…æ¨¡å¼</strong>è®¾è®¡çš„åˆ†å¸ƒå¼æœåŠ¡ç®¡ç†æ¡†æ¶ï¼Œå®ƒ<strong>è´Ÿè´£å­˜å‚¨å’Œç®¡ç†</strong>å¤§å®¶éƒ½å…³å¿ƒçš„æ•°æ®ï¼Œç„¶å<strong>æ¥å—è§‚å¯Ÿè€…çš„æ³¨å†Œ</strong>ï¼Œ ä¸€æ—¦è¿™äº›æ•°æ®çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ŒZookeeper å°±å°†<strong>è´Ÿè´£é€šçŸ¥å·²ç»åœ¨Zookeeperä¸Šæ³¨å†Œçš„é‚£äº›è§‚å¯Ÿè€…</strong>åšå‡ºç›¸åº”çš„ååº”ã€‚</p><ol><li>åŸºäºè§‚å¯Ÿè€…æ¨¡å¼è®¾è®¡çš„æ¡†æ¶</li><li>è´Ÿè´£å­˜å‚¨å’Œç®¡ç†çš„æ•°æ®</li><li>æ¥å—è§‚å¯Ÿè€…ï¼ˆæœåŠ¡ï¼‰çš„æ³¨å†Œ</li><li>è´Ÿè´£é€šçŸ¥å·²ç»åœ¨zookeeperä¸Šæ³¨å†Œçš„è§‚å¯Ÿè€…ï¼ˆæœåŠ¡ï¼‰</li></ol><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023222918327.png" class="" title="image-20211023222918327"><ol><li>æœåŠ¡ç«¯å¯åŠ¨æ—¶å»æ³¨å†Œä¿¡æ¯ï¼ˆåˆ›å»ºéƒ½æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼‰</li><li>å®¢æˆ·ç«¯ä»zookeeperè·å–å½“å‰åœ¨çº¿æœåŠ¡å™¨åˆ—è¡¨ï¼Œå¹¶ä¸”æ³¨å†Œç›‘å¬</li><li>if æœåŠ¡å™¨èŠ‚ç‚¹ä¸‹çº¿</li><li>zookeeperé€šçŸ¥å®¢æˆ·ç«¯æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šä¸‹çº¿</li><li>å®¢æˆ·ç«¯å†æ¬¡è·å–åœ¨çº¿æœåŠ¡å™¨åˆ—è¡¨ï¼Œå¹¶æ³¨å†Œç›‘å¬</li></ol><h2 id="1-3-zookeeperç‰¹ç‚¹">1.3 zookeeperç‰¹ç‚¹</h2><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023223955588.png" class="" title="image-20211023223955588"><ol><li>Zookeeperï¼š<strong>ä¸€ä¸ªé¢†å¯¼è€…</strong>ï¼ˆLeaderï¼‰ï¼Œ<strong>å¤šä¸ªè·Ÿéšè€…</strong>ï¼ˆFollowerï¼‰ç»„æˆçš„é›†ç¾¤ã€‚</li><li>é›†ç¾¤ä¸­åªè¦æœ‰<strong>åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»</strong>ï¼ŒZookeeperé›†ç¾¤å°±èƒ½æ­£å¸¸æœåŠ¡ã€‚æ‰€ä»¥Zookeeperé€‚åˆ<strong>å®‰è£…å¥‡æ•°å°æœåŠ¡å™¨</strong>ã€‚</li><li>å…¨å±€æ•°æ®ä¸€è‡´ï¼šæ¯ä¸ª<strong>Serverä¿å­˜ä¸€ä»½ç›¸åŒçš„æ•°æ®å‰¯æœ¬</strong>ï¼ŒClientæ— è®ºè¿æ¥åˆ°å“ªä¸ªServerï¼Œæ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚</li><li><strong>æ›´æ–°è¯·æ±‚é¡ºåºæ‰§è¡Œ</strong>ï¼Œæ¥è‡ªåŒä¸€ä¸ªClientçš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</li><li>å•ä¸€Client æ•°<strong>æ®æ›´æ–°åŸå­æ€§</strong>ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚</li><li><strong>å®æ—¶æ€§</strong>ï¼Œåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼ŒClientèƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚</li></ol><h2 id="1-4-æ•°æ®ç»“æ„">1.4 æ•°æ®ç»“æ„</h2><p>ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯<strong>ä¸€æ£µæ ‘</strong>ï¼Œæ¯ä¸ª èŠ‚ç‚¹ç§°åšä¸€ä¸ª <strong>ZNode</strong>ã€‚æ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿ<strong>å­˜å‚¨ 1MB</strong> çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€š<strong>è¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†</strong>ã€‚</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023224426987.png" class="" title="image-20211023224426987"><h2 id="1-5-åº”ç”¨åœºæ™¯">1.5 åº”ç”¨åœºæ™¯</h2><ol><li><p><strong>ç»Ÿä¸€å‘½åæœåŠ¡</strong></p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023224814675.png" class="" title="image-20211023224814675"></li><li><p><strong>ç»Ÿä¸€é…ç½®ç®¡ç†</strong></p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023225045932.png" class="" title="image-20211023225045932"></li><li><p><strong>ç»Ÿä¸€é›†ç¾¤ç®¡ç†</strong></p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023225313620.png" class="" title="image-20211023225313620"></li><li><p><strong>æœåŠ¡å™¨èŠ‚ç‚¹åŠ¨æ€ä¸Šä¸‹çº¿</strong></p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023225524570.png" class="" title="image-20211023225524570"></li><li><p><strong>è½¯è´Ÿè½½å‡è¡¡</strong></p></li></ol><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023225737241.png" class="" title="image-20211023225737241"><h1>2. zookeeperå®‰è£…</h1><h2 id="2-1-æœ¬åœ°å®‰è£…ä»¥åŠç›®å½•è§£è¯»">2.1 æœ¬åœ°å®‰è£…ä»¥åŠç›®å½•è§£è¯»</h2><p><strong>zookeeperç›®å½•</strong></p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023232208355.png" class="" title="image-20211023232208355"><p><strong>zookeeper/bin ç›®å½•ç»“æ„</strong></p><p>å…¶ä¸­<strong><a href="http://zkCli.sh">zkCli.sh</a></strong> æ˜¯ä½œä¸ºå®¢æˆ·ç«¯å¯åŠ¨</p><p>å…¶ä¸­<strong><a href="http://zkServer.sh">zkServer.sh</a></strong> æ˜¯ä½œä¸ºæœåŠ¡ç«¯å¯åŠ¨</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023232835716.png" class="" title="image-20211023232835716"><p><strong>zookeeper/conf ç›®å½•ç»“æ„</strong></p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023233200810.png" class="" title="image-20211023233200810"><p>å…¶ä¸­ <strong>zoo_sample.cfg</strong> æ˜¯zookeeperé…ç½®æ–‡ä»¶ï¼Œæ˜¯ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œæœ¬å¥—è¯¾ç¨‹ä¸­ä¿®æ”¹ä¸ºzoo.cfgã€‚</p><p>ç”±äº/tmpä¸ºLinuxä¸´æ—¶å‚¨å­˜åœ°å€ï¼ˆä¼šè¢«æ¸…ç†æ¸…ç†ï¼‰ï¼Œæ‰€ä»¥å°†å…¶é»˜è®¤dataDiråœ°å€æ”¹æˆè‡ªå·±æ–°å»ºçš„zkDataæ–‡ä»¶å¤¹ä¸‹ã€‚</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211025095457555.png" class="" title="image-20211025095457555"><p>ä¸€èˆ¬æˆ‘ä»¬å°†zookeeperçš„æ•°æ®æ–‡ä»¶æ”¾åˆ°<strong>zookeeper/zkData</strong>ä¸‹</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211025095409917.png" class="" title="image-20211025095409917"><p>å¯åŠ¨æ—¶</p><ul><li>å…ˆå¯åŠ¨zkServer</li><li>åœ¨å¯åŠ¨zkclient</li></ul><h2 id="2-2-å‚æ•°é…ç½®è§£æ">2.2 å‚æ•°é…ç½®è§£æ</h2><p>1ï¼‰<strong>tickTime = 2000</strong>ï¼šé€šä¿¡å¿ƒè·³æ—¶é—´ï¼ŒZookeeperæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å¿ƒè·³æ—¶é—´ï¼Œå•ä½æ¯«ç§’</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023235631976.png" class="" title="image-20211023235631976"><p>2ï¼‰<strong>initLimit = 10</strong>ï¼šLFåˆå§‹é€šä¿¡æ—¶é™</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023235701539.png" class="" title="image-20211023235701539"><p>3ï¼‰<strong>syncLimit = 5</strong>ï¼šLFåŒæ­¥é€šä¿¡æ—¶é™</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211023235734230.png" class="" title="image-20211023235734230"><p>4ï¼‰<strong>dataDir</strong>ï¼šä¿å­˜Zookeeperä¸­çš„æ•°æ® æ³¨æ„ï¼š<strong>é»˜è®¤çš„tmpç›®å½•ï¼Œå®¹æ˜“è¢«Linuxç³»ç»Ÿå®šæœŸåˆ é™¤</strong>ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ç”¨é»˜è®¤çš„tmpç›®å½•ã€‚</p><p>5ï¼‰<strong>clientPort = 2181</strong>ï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£ï¼Œé€šå¸¸ä¸åšä¿®æ”¹ã€‚</p><h1>3. zookeeperé›†ç¾¤æ“ä½œ</h1><h2 id="3-1-æœåŠ¡å™¨é›†ç¾¤é…ç½®">3.1 æœåŠ¡å™¨é›†ç¾¤é…ç½®</h2><ol><li><p>åœ¨/opt/module/zookeeper-3.5.7/zkData ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª myid çš„æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi myid<br></code></pre></td></tr></table></figure></li><li><p>åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸ server å¯¹åº”çš„ç¼–å·ï¼ˆæ³¨æ„ï¼šä¸Šä¸‹ä¸è¦æœ‰ç©ºè¡Œï¼Œå·¦å³ä¸è¦æœ‰ç©ºæ ¼ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">2<br></code></pre></td></tr></table></figure></li><li><p>æ‹·è´é…ç½®å¥½çš„ zookeeper åˆ°å…¶ä»–æœºå™¨ä¸Š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">xsync zookeeper-3.5.7<br></code></pre></td></tr></table></figure><p>åˆ†åˆ«åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šï¼Œè¿›è¡Œserverç¼–å·æ›´æ”¹ï¼ˆ3ï¼Œ4ï¼‰</p></li><li><p>åœ¨zoo.cfgé…ç½®æ–‡ä»¶ä¸‹è¿›è¡Œé›†ç¾¤é…ç½®</p><figure class="highlight plaintext"><figcaption><span>l</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs she">#######################cluster##########################<br>server.2=hadoop102:2888:3888<br>server.3=hadoop103:2888:3888<br>server.4=hadoop104:2888:3888<br></code></pre></td></tr></table></figure><p>é…ç½®è§£è¯» <strong>server.A=B:C:D</strong></p><ul><li>å…¶ä¸­Aæ•°å­—è¡¨ç¤ºç¬¬å‡ å°æœåŠ¡å™¨ã€‚<strong>é›†ç¾¤æ¨¡å¼ä¸‹é…ç½®ä¸€ä¸ªæ–‡ä»¶ myidï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨ dataDirç›®å½•ä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢æœ‰ä¸€ä¸ªæ•°æ®å°±æ˜¯ A çš„å€¼ï¼ŒZookeeper å¯åŠ¨æ—¶è¯»å–æ­¤æ–‡ä»¶ï¼Œæ‹¿åˆ°é‡Œé¢çš„æ•°æ®ä¸ zoo.cfg é‡Œé¢çš„é…ç½®ä¿¡æ¯æ¯”è¾ƒä»è€Œåˆ¤æ–­åˆ°åº•æ˜¯å“ªä¸ª serverã€‚</strong></li><li>Bæ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„åœ°å€</li><li>Cæ˜¯è¿™ä¸ªæœåŠ¡å™¨Followerä¸é›†ç¾¤ä¸­Leader æœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£</li><li>Dæ˜¯ä¸‡ä¸€è¿™ä¸ªé›†ç¾¤ä¸­çš„LeaderæŒ‚äº†ï¼Œéœ€è¦ä¸€ä¸ªç«¯å£è¿›è¡Œé‡æ–°é€‰ä¸¾ï¼Œè¿™ä¸ªç«¯å£å°±æ˜¯ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ—¶ï¼Œå®ç°æœåŠ¡å™¨ä¹‹é—´æ¶ˆæ¯äº’é€šçš„ç«¯å£</li></ul></li><li><p>åˆ†å‘é…ç½®å®Œæˆåï¼ˆxsyncå‘½ä»¤ï¼‰ï¼Œå¯åŠ¨æœåŠ¡å™¨ï¼Œ<strong>bin/zkServer.sh start</strong></p><ul><li><p><strong>æ³¨æ„1ï¼šå®¢æˆ·ç«¯å‘½ä»¤è¡Œæœ«å°¾æ²¡æœ‰start</strong></p></li><li><p><strong>æ³¨æ„2ï¼šå¦‚æœåœ¨å¯åŠ¨æœåŠ¡å™¨é›†ç¾¤æ—¶ï¼Œå¹¶æ²¡æœ‰startæ•°é‡è¶…è¿‡åŠæ•°ï¼Œåˆ™ä¼šæŠ¥erroré”™è¯¯ï¼Œä¸ç¬¦åˆé›†ç¾¤å·¥ä½œçš„åŸç†ï¼ˆæœ‰åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å¯åŠ¨ ï¼Œé›†ç¾¤æ‰å¼€å§‹å·¥ä½œï¼‰</strong></p></li></ul></li></ol><h2 id="3-2-é€‰ä¸¾æœºåˆ¶">3.2 é€‰ä¸¾æœºåˆ¶</h2><h3 id="3-2-1-zookeeperé›†ç¾¤ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶">3.2.1 zookeeperé›†ç¾¤ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211025102232854.png" class="" title="image-20211025102232854"><ul><li>æ€»ç»“ï¼šä¸€èˆ¬æ¥è¯´ï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œleaderä¸ºserverç¼–å·ï¼ˆstart+endï¼‰/2ã€‚</li></ul><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211025103218805.png" class="" title="image-20211025103218805"><ul><li>å®¢æˆ·ç«¯å¯¹äºé›†ç¾¤çš„å†™æ“ä½œï¼Œä¸»è¦é€šè¿‡æ˜¯ä¸‰ä¸ªIDå·æ¥æ ‡å¿—è®¿é—®çš„èŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯SIDã€ZXIDã€Epochã€‚</li></ul><h3 id="3-2-2-zookeeperé›†ç¾¤éç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶">3.2.2 zookeeperé›†ç¾¤éç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211025104410548.png" class="" title="image-20211025104410548"><h2 id="3-3-å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ">3.3 å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ</h2><h3 id="3-3-1-å¯åŠ¨å®¢æˆ·ç«¯å’Œznodeå‚æ•°ä¿¡æ¯">3.3.1 å¯åŠ¨å®¢æˆ·ç«¯å’Œznodeå‚æ•°ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bin/zkCli.sh --server name:xxxx //æ­¤æ–¹å¼å¯ä»¥æŒ‡å®šæœåŠ¡å™¨ç­‰åå­—<br></code></pre></td></tr></table></figure><ol><li>czxidï¼š**åˆ›å»ºèŠ‚ç‚¹çš„äº‹åŠ¡  zxidæ¯æ¬¡ä¿®æ”¹ ZooKeeper çŠ¶æ€éƒ½ä¼šäº§ç”Ÿä¸€ä¸ª ZooKeeper äº‹åŠ¡ IDã€‚**äº‹åŠ¡ ID æ˜¯ ZooKeeper ä¸­æ‰€ æœ‰ä¿®æ”¹æ€»çš„æ¬¡åºã€‚æ¯æ¬¡ä¿®æ”¹éƒ½æœ‰å”¯ä¸€çš„ zxidï¼Œå¦‚æœ zxid1 å°äº zxid2ï¼Œé‚£ä¹ˆ zxid1 åœ¨ zxid2 ä¹‹ å‰å‘ç”Ÿã€‚</li><li>ctimeï¼šznode è¢«<strong>åˆ›å»º</strong>çš„æ¯«ç§’æ•°ï¼ˆä» 1970 å¹´å¼€å§‹ï¼‰</li><li>mzxidï¼šznode æœ€å<strong>æ›´æ–°</strong>çš„äº‹åŠ¡ zxid</li><li>mtimeï¼šznode æœ€å<strong>ä¿®æ”¹</strong>çš„æ¯«ç§’æ•°ï¼ˆä» 1970 å¹´å¼€å§‹ï¼‰</li><li>pZxidï¼šznode æœ€å<strong>æ›´æ–°çš„å­èŠ‚ç‚¹</strong> zxid</li><li>cversionï¼šznode å­èŠ‚ç‚¹å˜åŒ–å·ï¼Œznode å­èŠ‚ç‚¹<strong>ä¿®æ”¹æ¬¡æ•°</strong></li><li>dataversionï¼šznode <strong>æ•°æ®å˜åŒ–å·</strong></li><li>aclVersionï¼šznode è®¿é—®<strong>æ§åˆ¶åˆ—è¡¨çš„å˜åŒ–å·</strong></li><li>ephemeralOwnerï¼šå¦‚æœæ˜¯<strong>ä¸´æ—¶èŠ‚ç‚¹</strong>ï¼Œè¿™ä¸ªæ˜¯  znode æ‹¥æœ‰è€…çš„ session idã€‚å¦‚æœä¸æ˜¯ä¸´æ—¶èŠ‚ç‚¹åˆ™æ˜¯ 0ã€‚</li><li>dataLengthï¼šznode çš„<strong>æ•°æ®é•¿åº¦</strong></li><li>numChildrenï¼šznode <strong>å­èŠ‚ç‚¹æ•°é‡</strong></li></ol><h3 id="3-3-2-znodeèŠ‚ç‚¹ç±»å‹">3.3.2 znodeèŠ‚ç‚¹ç±»å‹</h3><ol><li><p>æŒä¹…èŠ‚ç‚¹ï¼šå½“å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ–­å¼€é“¾æ¥æ—¶ï¼Œåˆ›å»ºçš„èŠ‚ç‚¹ä¸ä¼šè¢«åˆ é™¤</p><ol><li>æŒä¹…èŠ‚ç‚¹ä¸å¸¦é¡ºåºç¼–å·</li><li>æŒä¹…èŠ‚ç‚¹å¸¦é¡ºåºç¼–å·ï¼Œåªæ˜¯zookeeperä¼šç»™è¯¥èŠ‚ç‚¹è¿›è¡Œç¼–å·è€Œå·²ï¼Œé¡ºåºå·ç”±çˆ¶èŠ‚ç‚¹ç»´æŠ¤</li></ol><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026214405461.png" class="" title="image-20211026214405461"></li><li><p>çŸ­æš‚èŠ‚ç‚¹ï¼šå½“å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥æ—¶ï¼Œåˆ›å»ºçš„èŠ‚ç‚¹ä¼šè‡ªå·±åˆ é™¤</p><ol><li>ä¸´æ—¶èŠ‚ç‚¹ä¸å¸¦é¡ºåºç¼–å·</li><li>ä¸´æ—¶èŠ‚ç‚¹å¸¦é¡ºåºç¼–å·ï¼Œåªæ˜¯zookeeperä¼šç»™è¯¥èŠ‚ç‚¹è¿›è¡Œç¼–å·è€Œå·²</li></ol></li><li><p>å¸¦åºå·èŠ‚ç‚¹ vs ä¸å¸¦åºå·èŠ‚ç‚¹</p><ol><li>ä¸å¸¦åºå·èŠ‚ç‚¹åªå¯ä»¥åˆ›å»ºä¸€ä¸ªï¼Œå¸¦åºå·èŠ‚ç‚¹å¯ä»¥åˆ›å»ºå¤šä¸ª+åºåˆ—å·</li></ol></li></ol><h4 id="3-3-2-1-åˆ›å»ºæ°¸ä¹…èŠ‚ç‚¹">3.3.2.1 åˆ›å»ºæ°¸ä¹…èŠ‚ç‚¹</h4><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026214711434.png" class="" title="image-20211026214711434"><h4 id="3-3-2-2-è·å–èŠ‚ç‚¹å€¼ä¸å…¶å±æ€§">3.3.2.2 è·å–èŠ‚ç‚¹å€¼ä¸å…¶å±æ€§</h4><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026214817531.png" class="" title="image-20211026214817531"><h4 id="3-3-2-3-åˆ›å»ºæŒä¹…å¸¦åºå·çš„èŠ‚ç‚¹">3.3.2.3 åˆ›å»ºæŒä¹…å¸¦åºå·çš„èŠ‚ç‚¹</h4><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026215051736.png" class="" title="image-20211026215051736"><h4 id="3-3-2-4-åˆ›å»ºçŸ­æš‚èŠ‚ç‚¹">3.3.2.4 åˆ›å»ºçŸ­æš‚èŠ‚ç‚¹</h4><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026215720659.png" class="" title="image-20211026215720659"><h4 id="3-3-2-5-åˆ›å»ºçŸ­æš‚å¸¦åºå·èŠ‚ç‚¹">3.3.2.5 åˆ›å»ºçŸ­æš‚å¸¦åºå·èŠ‚ç‚¹</h4><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026215806271.png" class="" title="image-20211026215806271"><h4 id="3-3-2-6-ä¿®æ”¹èŠ‚ç‚¹">3.3.2.6 ä¿®æ”¹èŠ‚ç‚¹</h4><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026215848192.png" class="" title="image-20211026215848192"><h3 id="3-3-4-ç›‘å¬å™¨åŸç†">3.3.4 ç›‘å¬å™¨åŸç†</h3><p>å®¢æˆ·ç«¯æ³¨å†Œç›‘å¬å®ƒå…³å¿ƒçš„ç›®å½•èŠ‚ç‚¹ï¼Œå½“ç›®å½•èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼ˆæ•°æ®æ”¹å˜ã€èŠ‚ç‚¹åˆ é™¤ã€å­ç›® å½•èŠ‚ç‚¹å¢åŠ åˆ é™¤ï¼‰æ—¶ï¼ŒZooKeeper ä¼šé€šçŸ¥å®¢æˆ·ç«¯ã€‚ç›‘å¬æœºåˆ¶ä¿è¯ ZooKeeper ä¿å­˜çš„ä»»ä½•çš„æ•° æ®çš„ä»»ä½•æ”¹å˜éƒ½èƒ½å¿«é€Ÿçš„å“åº”åˆ°ç›‘å¬äº†è¯¥èŠ‚ç‚¹çš„åº”ç”¨ç¨‹åºã€‚</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026220152902.png" class="" title="image-20211026220152902"><h4 id="3-3-4-1-èŠ‚ç‚¹çš„å€¼å˜åŒ–ç›‘å¬">3.3.4.1 èŠ‚ç‚¹çš„å€¼å˜åŒ–ç›‘å¬</h4><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026220610359.png" class="" title="image-20211026220610359"><h4 id="3-3-4-2-èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–ç›‘å¬">3.3.4.2 èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–ç›‘å¬</h4><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026220849104.png" class="" title="image-20211026220849104"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026220910133.png" class="" title="image-20211026220910133"><h4 id="3-3-4-3-èŠ‚ç‚¹çš„åˆ é™¤ä¸æŸ¥çœ‹">3.3.4.3 èŠ‚ç‚¹çš„åˆ é™¤ä¸æŸ¥çœ‹</h4><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026221008642.png" class="" title="image-20211026221008642"><h3 id="3-3-5-å®¢æˆ·ç«¯APIæ“ä½œ">3.3.5 å®¢æˆ·ç«¯APIæ“ä½œ</h3><h4 id="3-3-5-1-åˆå§‹åŒ–zookeeper">3.3.5.1 åˆå§‹åŒ–zookeeper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * åˆå§‹åŒ–</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> IOException ioexception</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Before</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>       <span class="hljs-comment">//stringå¤šå°æœåŠ¡å™¨åœ°å€ä¹‹é—´ä¸å…è®¸æœ‰ç©ºæ ¼</span><br>       String coonectString = <span class="hljs-string">&quot;hadoop102:2181,hadoop103:2181,hadoop104:2181&quot;</span>;<br>       <span class="hljs-keyword">int</span> sessionTimeout = <span class="hljs-number">2000</span>;<br>       zkClient = <span class="hljs-keyword">new</span> ZooKeeper(coonectString, sessionTimeout, <span class="hljs-keyword">new</span> Watcher() &#123;<br>           <span class="hljs-comment">/**</span><br><span class="hljs-comment">            * è¿™æ˜¯ç›‘å¬çº¿ç¨‹ï¼Œè§‚å¯ŸæœåŠ¡å™¨é›†ç¾¤ä¸­æ˜¯å¦æœ‰æ–°çš„èŠ‚ç‚¹å˜åŒ–</span><br><span class="hljs-comment">            *</span><br><span class="hljs-comment">            * <span class="hljs-doctag">@param</span> watchedEvent å…³æ³¨çš„äº‹ä»¶</span><br><span class="hljs-comment">            */</span><br>           <span class="hljs-meta">@Override</span><br>           <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> </span>&#123;<br>               List&lt;String&gt; children = <span class="hljs-keyword">null</span>;<br>               <span class="hljs-keyword">try</span> &#123;<br>                   children = zkClient.getChildren(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-keyword">true</span>);<br>               &#125; <span class="hljs-keyword">catch</span> (KeeperException e) &#123;<br>                   e.printStackTrace();<br>               &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                   e.printStackTrace();<br>               &#125;<br>               <span class="hljs-keyword">for</span> (String child : children) &#123;<br>                   System.out.println(<span class="hljs-string">&quot;å­èŠ‚ç‚¹ï¼š&quot;</span> + child);<br>               &#125;<br>           &#125;<br>       &#125;);<br>   &#125;<br></code></pre></td></tr></table></figure><h4 id="3-3-5-2-åˆ›å»ºèŠ‚ç‚¹">3.3.5.2 åˆ›å»ºèŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºèŠ‚ç‚¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">create</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, KeeperException </span>&#123;<br>        String nodeCreated = zkClient.create(<span class="hljs-string">&quot;/atguigu&quot;</span>, <span class="hljs-string">&quot;ss.avi&quot;</span>.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);<br>    &#125;<br></code></pre></td></tr></table></figure><h4 id="3-3-5-3-æŸ¥è¯¢å­èŠ‚ç‚¹">3.3.5.3 æŸ¥è¯¢å­èŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ç›‘å¬å­èŠ‚ç‚¹</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Test</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getChildNode</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, KeeperException </span>&#123;<br>       List&lt;String&gt; children = zkClient.getChildren(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-keyword">true</span>);<br>       <span class="hljs-keyword">for</span> (String child : children) &#123;<br>           System.out.println(<span class="hljs-string">&quot;å­èŠ‚ç‚¹ï¼š&quot;</span> + child);<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><h4 id="3-3-5-4-åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨">3.3.5.4 åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Test</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">exist</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, KeeperException </span>&#123;<br>       Stat stat = zkClient.exists(<span class="hljs-string">&quot;/atguigu&quot;</span>, <span class="hljs-keyword">false</span>);<br>       System.out.println(stat == <span class="hljs-keyword">null</span> ? <span class="hljs-string">&quot;not exist&quot;</span> : <span class="hljs-string">&quot;exist&quot;</span>);<br>   &#125;<br></code></pre></td></tr></table></figure><h2 id="3-4-å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å†™æ•°æ®æµç¨‹">3.4 å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å†™æ•°æ®æµç¨‹</h2><ol><li><p><strong>å‘leaderèŠ‚ç‚¹å†™æ•°æ®æµç¨‹</strong></p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026225528071.png" class="" title="image-20211026225528071"><p>å®é™…ä¸Šå½“æœåŠ¡å™¨é›†ç¾¤ä¸­<strong>è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹</strong>å®Œæˆwriteæ“ä½œï¼Œå°±ç”±leaderè¿”å›acké€šçŸ¥</p></li><li><p><strong>å‘followerèŠ‚ç‚¹å†™æ•°æ®æµç¨‹</strong></p></li></ol><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211026225541675.png" class="" title="image-20211026225541675"><p>â€‹å½“æ•°æ®æµå‘followeræ—¶ï¼Œ<strong>followerä¸ä¼šå…ˆè¿›è¡Œwriteæ“ä½œï¼Œè€Œæ˜¯å…ˆè¿›è¡Œwriteè¯·æ±‚è½¬å‘åˆ°leader</strong>ï¼Œå†ç”±leaderè¿›è¡Œwriteè¯·æ±‚åˆ†å‘ï¼Œå¯è°“ç­‰çº§æ£®ä¸¥ã€‚<strong>å½“æµå‘followerå®Œæˆwriteæ“ä½œæ—¶ï¼Œè¿”å›ackç»™clientï¼Œè€Œä¸æ˜¯ç”±leaderè¿”å›ã€‚</strong></p><h1>4. æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ç›‘å¬æ¡ˆä¾‹</h1><h2 id="4-1-éœ€æ±‚">4.1 éœ€æ±‚</h2><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸»èŠ‚ç‚¹å¯ä»¥ç”¨å¤šå°ï¼Œå¯ä»¥åŠ¨æ€ä¸Šä¸‹çº¿ï¼Œä»»æ„ä¸€å°å®¢æˆ·ç«¯éƒ½èƒ½å®æ—¶æ„Ÿå—åˆ°ä¸»èŠ‚ç‚¹æœåŠ¡å™¨çš„ä¸Šä¸‹çº¿</p><h2 id="4-2-éœ€æ±‚åˆ†æ">4.2 éœ€æ±‚åˆ†æ</h2><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211027094852005.png" class="" title="image-20211027094852005"><p>zookeeperé›†ç¾¤ä¸­ ä¸»è¦åˆ†ä¸¤å¤§ç±»ï¼Œä¸€ç±»æ˜¯æœåŠ¡å™¨ï¼Œä¸€ç±»æ˜¯å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ä¸»è¦ç”¨ä½œcreateèŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯ä¸»è¦ç”¨ä½œgetèŠ‚ç‚¹ã€‚</p><h2 id="4-3-å…·ä½“ä»£ç ">4.3 å…·ä½“ä»£ç </h2><ol><li><p>åœ¨æœåŠ¡å™¨é›†ç¾¤ä¸­ create /server â€œserversâ€</p></li><li><p>æœåŠ¡å™¨ç«¯å‘zookeeperæ³¨å†Œä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> bjut.kengkeng.test;<br><br><span class="hljs-keyword">import</span> org.apache.zookeeper.*;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ†å‘æœåŠ¡å™¨</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> guolonghang</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2021-10-27</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DistributeServer</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * zkæœåŠ¡å™¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> ZooKeeper zkServer;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¼šè¯è¶…æ—¶</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> sessionTimeout;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿æ¥åœ°å€</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String connString;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¸»æ–¹æ³•</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> args argæ¸¸æˆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException          ioexception</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException ä¸­æ–­å¼‚å¸¸</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> KeeperException      é—¨å°†ä¾‹å¤–</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException, KeeperException </span>&#123;<br><br>        DistributeServer server = <span class="hljs-keyword">new</span> DistributeServer();<br>        <span class="hljs-comment">//1.è·å–zké›†ç¾¤</span><br>        server.getConnect();<br>        <span class="hljs-comment">//2.æ³¨å†ŒæœåŠ¡å™¨åˆ°é›†ç¾¤ä¸­</span><br>        server.registry(args[<span class="hljs-number">0</span>]);<br>        <span class="hljs-comment">//3.å¯åŠ¨ä¸šåŠ¡</span><br>        server.business();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¸šåŠ¡</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException ä¸­æ–­å¼‚å¸¸</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">business</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ³¨å†Œ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> hostname ä¸»æœºå</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException ä¸­æ–­å¼‚å¸¸</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> KeeperException      é—¨å°†ä¾‹å¤–</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registry</span><span class="hljs-params">(String hostname)</span> <span class="hljs-keyword">throws</span> InterruptedException, KeeperException </span>&#123;<br>String path = <span class="hljs-string">&quot;/servers/&quot;</span>+hostname;<br>      String status = zkServer.create(path, hostname.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);<br>        System.out.println(status);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å¾—è¿æ¥</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException ioexception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getConnect</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        connString = <span class="hljs-string">&quot;&quot;</span>;<br>        sessionTimeout = <span class="hljs-number">0</span>;<br>        zkServer = <span class="hljs-keyword">new</span> ZooKeeper(connString, sessionTimeout, <span class="hljs-keyword">new</span> Watcher() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> </span>&#123;<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>å®¢æˆ·ç«¯ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> bjut.kengkeng.test;<br><br><span class="hljs-keyword">import</span> org.apache.zookeeper.KeeperException;<br><span class="hljs-keyword">import</span> org.apache.zookeeper.WatchedEvent;<br><span class="hljs-keyword">import</span> org.apache.zookeeper.Watcher;<br><span class="hljs-keyword">import</span> org.apache.zookeeper.ZooKeeper;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ†é…å®¢æˆ·</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> guolonghang</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2021-10-27</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DistributeClient</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åº·æ¶…ç‹„æ ¼å·çš„å­—ç¬¦ä¸²</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String connString;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¼šè¯è¶…æ—¶</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> sessionTimeout;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * zkçš„å®¢æˆ·</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> ZooKeeper zkClient;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¸»è¦</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> args argæ¸¸æˆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException          ioexception</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException ä¸­æ–­å¼‚å¸¸</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> KeeperException      é—¨å°†ä¾‹å¤–</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException, KeeperException </span>&#123;<br><br>        DistributeClient client = <span class="hljs-keyword">new</span> DistributeClient();<br>        <span class="hljs-comment">//1.è·å–zkè¿æ¥</span><br>        client.getConnect();<br>        <span class="hljs-comment">//2.ç›‘å¬/serversèŠ‚ç‚¹è·¯å¾„çš„å˜åŒ–(ç›‘å¬å™¨çš„ç¼–å†™)</span><br>        client.getServerList(args[<span class="hljs-number">0</span>]);<br>        <span class="hljs-comment">//3.ä¸šåŠ¡é€»è¾‘</span><br>        client.business();<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¸šåŠ¡</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException ä¸­æ–­å¼‚å¸¸</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">business</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–æœåŠ¡å™¨åˆ—è¡¨</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> path è·¯å¾„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException ä¸­æ–­å¼‚å¸¸</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> KeeperException      é—¨å°†ä¾‹å¤–</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getServerList</span><span class="hljs-params">(String path)</span> <span class="hljs-keyword">throws</span> InterruptedException, KeeperException </span>&#123;<br>        List&lt;String&gt; children = zkClient.getChildren(path, <span class="hljs-keyword">true</span>);<br>        ArrayList&lt;String&gt; serverChildren = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (String child : children) &#123;<br>            <span class="hljs-keyword">byte</span>[] data = zkClient.getData(path + child, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);<br>            serverChildren.add(data.toString());<br>        &#125;<br>        System.out.println(serverChildren);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å¾—è¿æ¥</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException ioexception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getConnect</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        connString = <span class="hljs-string">&quot;hadoop102:2181,hadoop103:2181,hadoop104:2181&quot;</span>;<br>        sessionTimeout = <span class="hljs-number">0</span>;<br>        zkClient = <span class="hljs-keyword">new</span> ZooKeeper(connString, sessionTimeout, <span class="hljs-keyword">new</span> Watcher() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> </span>&#123;<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ol><h2 id="4-4-æµ‹è¯•">4.4 æµ‹è¯•</h2><p>//todo</p><h1>5. zookeeperåˆ†å¸ƒå¼é”æ¡ˆä¾‹</h1><p><strong>ä»€ä¹ˆå«åšåˆ†å¸ƒå¼é”å‘¢ï¼Ÿ</strong><br>æ¯”å¦‚è¯´&quot;è¿›ç¨‹   1&quot;åœ¨ä½¿ç”¨è¯¥èµ„æºçš„æ—¶å€™ï¼Œä¼šå…ˆå»è·å¾—é”ï¼Œ&quot;è¿›ç¨‹   1&quot;è·å¾—é”ä»¥åä¼šå¯¹è¯¥èµ„æºä¿æŒç‹¬å ï¼Œè¿™æ ·å…¶ä»–è¿›ç¨‹å°±æ— æ³•è®¿é—®èµ„æºï¼Œ&quot;è¿›ç¨‹ 1&quot;ç”¨å®Œè¯¥èµ„æºä»¥åå°±å°†é”é‡Šæ”¾æ‰ï¼Œè®©å…¶ä»–è¿›ç¨‹æ¥è·å¾—é”ï¼Œé‚£ä¹ˆé€šè¿‡è¿™ä¸ªé”æœºåˆ¶ï¼Œæˆ‘ä»¬å°±èƒ½ä¿è¯äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤šä¸ªè¿›ç¨‹èƒ½å¤Ÿæœ‰åºçš„è®¿é—®è¯¥ä¸´ç•Œèµ„æºã€‚é‚£ä¹ˆæˆ‘ä»¬æŠŠè¿™ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„è¿™ä¸ªé”å«ä½œåˆ†å¸ƒå¼é”ã€‚</p><h2 id="5-1-åŸç”Ÿzookeeperåˆ†å¸ƒå¼é”æ¡ˆä¾‹">5.1 åŸç”Ÿzookeeperåˆ†å¸ƒå¼é”æ¡ˆä¾‹</h2><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211027104946833.png" class="" title="image-20211027104946833"><ol><li>å½“å¤šå°å®¢æˆ·ç«¯åŒæ—¶è®¿é—®zookeeperé›†ç¾¤æ—¶ï¼Œzookeeperé›†ç¾¤ä¼šå°†æ‰€æœ‰çš„clientéƒ½åˆ›å»ºä¸€ä¸ªä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œå…¶ç›®å½•ä¸º/locks</li><li>åœ¨locksä¸­çš„èŠ‚ç‚¹æŒ‰ç…§å…¶ç¼–å·é¡ºåºè¿›è¡Œå–é”è®¿é—®ï¼Œå¤„ç†ä¸šåŠ¡ã€‚</li><li>å¤„ç†å®Œæ¯•åï¼Œdeleteé‡Šæ”¾é”ï¼Œè¿›è¡Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸šåŠ¡å¤„ç†ã€‚</li><li>æœ‰ç‚¹åƒAQSä¸­æ‚²è§‚é”çš„æ€æƒ³ï¼Œå…ˆè¿›å…ˆå‡ºã€‚</li></ol><h3 id="5-1-1-zookeeperåˆ†å¸ƒå¼é”å®ç°">5.1.1 zookeeperåˆ†å¸ƒå¼é”å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å…¨å±€å˜é‡</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * zookeeperé›†ç¾¤è¿æ¥åœ°å€</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String connString;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¼šè¯è¶…æ—¶</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> sessionTimeout;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * zkæœåŠ¡å™¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ZooKeeper zkServer;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * çœ‹è·¯</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String watchPath;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å€’è®¡æ—¶é—¨é—©</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> CountDownLatch countDownLatch = <span class="hljs-keyword">new</span> CountDownLatch(<span class="hljs-number">1</span>);<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è§‚å¯Ÿç­‰å¾…</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> CountDownLatch watchAwait = <span class="hljs-keyword">new</span> CountDownLatch(<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ„é€ å™¨</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ†å¸ƒå¼é” æ„é€ å™¨</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException          ioexception</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException ä¸­æ–­å¼‚å¸¸</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> KeeperException      é—¨å°†ä¾‹å¤–</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DistributeLock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException, KeeperException </span>&#123;<br>        <span class="hljs-comment">//1.è·å–è¿æ¥</span><br>        zkServer = <span class="hljs-keyword">new</span> ZooKeeper(connString, sessionTimeout, <span class="hljs-keyword">new</span> Watcher() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">(WatchedEvent watchedEvent)</span> </span>&#123;<br>                <span class="hljs-comment">//å¦‚æœè¿æ¥ä¸Šzookeeperéœ€è¦é‡Šæ”¾countDownLatch</span><br>                <span class="hljs-keyword">if</span> (watchedEvent.getState()== Event.KeeperState.SyncConnected)&#123;<br>                    countDownLatch.countDown();<br>                &#125;<br>                <span class="hljs-comment">//èŠ‚ç‚¹è·¯å¾„å˜åŒ–éœ€è¦é‡Šæ”¾watchAwait</span><br>                <span class="hljs-keyword">if</span> (watchedEvent.getType()==Event.EventType.NodeDeleted&amp;&amp;watchedEvent.getPath().equals(watchAwait))&#123;<br>                    watchAwait.countDown();<br>                &#125;<br>            &#125;<br>        &#125;);<br>        <span class="hljs-comment">//ç­‰å¾…zkåˆ›å»ºæˆåŠŸ</span><br>        countDownLatch.await();<br>        <span class="hljs-comment">//2.åˆ¤æ–­æ ¹èŠ‚ç‚¹/locksæ˜¯å¦å­˜åœ¨</span><br>        Stat stat = zkServer.exists(<span class="hljs-string">&quot;/locks&quot;</span>, <span class="hljs-keyword">true</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == stat) &#123;<br>            <span class="hljs-comment">//æœåŠ¡å™¨åˆ›å»ºå¸¦åºåˆ—å·å¸¦ä¸´æ—¶èŠ‚ç‚¹</span><br>            zkServer.create(<span class="hljs-string">&quot;/locks&quot;</span>, <span class="hljs-string">&quot;locks&quot;</span>.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŠ é”</span><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * zké”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">zkLock</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//å®¢æˆ·ç«¯åˆ›å»ºä¸´æ—¶å¸¦åºå·èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            String currNode = zkServer.create(<span class="hljs-string">&quot;/locks/&quot;</span> + <span class="hljs-string">&quot;seq-&quot;</span>, <span class="hljs-keyword">null</span>, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);<br><br>            <span class="hljs-comment">//æŸ¥çœ‹/locksç›®å½•ä¸‹çš„èŠ‚ç‚¹</span><br>            List&lt;String&gt; children = zkServer.getChildren(<span class="hljs-string">&quot;/locks&quot;</span>, <span class="hljs-keyword">false</span>);<br>            <span class="hljs-comment">//åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰ç›®å½•ä¸‹æœ€å°åºå·èŠ‚ç‚¹ï¼Œæ˜¯ï¼šè·å–åˆ°é”ï¼Œå¦ï¼šç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹</span><br>            <span class="hljs-keyword">if</span> (children.size() == <span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">//æ’åº</span><br>                Collections.sort(children);<br>                <span class="hljs-comment">//è·å–å½“å‰èŠ‚ç‚¹å</span><br>                String currNodeName = currNode.substring(<span class="hljs-string">&quot;/locks/&quot;</span>.length());<br>                <span class="hljs-comment">//æ‰¾åˆ°å½“å‰é›†åˆä½ç½®</span><br>                <span class="hljs-keyword">int</span> currNodeIndex = children.indexOf(currNodeName);<br>                <span class="hljs-keyword">if</span> (-<span class="hljs-number">1</span> == currNodeIndex) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;æ•°æ®å¼‚å¸¸&quot;</span>);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> == currNodeIndex) &#123;<br>                    <span class="hljs-comment">//åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±ç›´æ¥è·å–é”</span><br>                    <span class="hljs-keyword">return</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">//ç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹</span><br>                    watchPath = <span class="hljs-string">&quot;/locks/&quot;</span> + children.get(currNodeIndex - <span class="hljs-number">1</span>);<br>                    zkServer.getData(watchPath, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">null</span>);<br>                    <span class="hljs-comment">//ç¡®ä¿ç›‘å¬</span><br>                    watchAwait.await();<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>            &#125;<br><br>        &#125; <span class="hljs-keyword">catch</span> (KeeperException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>        &#125;<br><br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è§£é”</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * zkè§£é”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">zkUnlock</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//åˆ é™¤èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            zkServer.delete(<span class="hljs-string">&quot;/locks/&quot;</span>,-<span class="hljs-number">1</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (KeeperException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ€»ç»“ï¼šzookeeperåŸç”Ÿåˆ†å¸ƒå¼é”å®ç°ä¸»è¦æ˜¯ä¾æ‰˜<strong>åˆ›å»ºä¸€ä¸ªå­èŠ‚ç‚¹ç›®å½•ç¾¤</strong>å®ç°</p><ol><li>å½“å¤šä¸ªclientè®¿é—®zookeeperé›†ç¾¤æ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¼šåœ¨/locks/æ–‡ä»¶ä¸‹ä¸ºæ¯ä¸ªclientåˆ›å»ºä¸€ä¸ªå¸¦åºå·çš„ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯zkLockåŠ é”</li><li>æ¯ä¸ªclientæŒ‰ç…§èŠ‚ç‚¹é¡ºåºå»æ‰§è¡Œã€‚å½“ä¸šåŠ¡é€»è¾‘æ‰§è¡Œå®Œæˆåï¼Œåˆ é™¤è‡ªå·±çš„ä¸´æ—¶èŠ‚ç‚¹ã€‚</li><li>å…¶ä¸­<strong>countDownLatch</strong>çš„ä½œç”¨æ˜¯ä¸ºäº†ä¿è¯ä»£ç çš„å¥å£®æ€§ï¼Œæ—¢ç¡®ä¿å¯ä»¥è¿æ¥åˆ°zookeeperé›†ç¾¤ä»¥åŠå¯ä»¥ç›‘å¬åˆ°â€œå½“å‰èŠ‚ç‚¹â€</li></ol><h3 id="5-1-2-zookeeperåˆ†å¸ƒå¼é”æµ‹è¯•">5.1.2 zookeeperåˆ†å¸ƒå¼é”æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> bjut.kengkeng.test;<br><br><span class="hljs-keyword">import</span> org.apache.zookeeper.KeeperException;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DistributedLockTest</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, IOException, KeeperException </span>&#123;<br>        <span class="hljs-keyword">final</span> DistributeLock lock1 = <span class="hljs-keyword">new</span> DistributeLock();<br>        <span class="hljs-keyword">final</span> DistributeLock lock2 = <span class="hljs-keyword">new</span> DistributeLock();<br>        <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">// è·å–é”å¯¹è±¡ </span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    lock1.zkLock();<br>                    System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹ 1è·å–é”&quot;</span>);<br>                    Thread.sleep(<span class="hljs-number">5</span> * <span class="hljs-number">1000</span>);<br>                    lock1.zkUnlock();<br>                    System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹ 1é‡Šæ”¾é”&quot;</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br><br><br>            &#125;<br>        &#125;).start();<br><br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                lock2.zkLock();<br>                System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹ 1è·å–é”&quot;</span>);<br>                Thread.sleep(<span class="hljs-number">5</span> * <span class="hljs-number">1000</span>);<br>                lock2.zkUnlock();<br>                System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹ 1é‡Šæ”¾é”&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br><br><br>        &#125;).start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5-2-Curator-æ¡†æ¶å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹">5.2 Curator æ¡†æ¶å®ç°åˆ†å¸ƒå¼é”æ¡ˆä¾‹</h2><h3 id="5-2-1-åŸç”ŸAPIå­˜åœ¨çš„é—®é¢˜">5.2.1 åŸç”ŸAPIå­˜åœ¨çš„é—®é¢˜</h3><ol><li>ä¼šè¯è¿æ¥æ˜¯å¼‚æ­¥çš„ï¼Œéœ€è¦è‡ªå·±å»å¤„ç†ã€‚æ¯”å¦‚ä½¿ç”¨  CountDownLatch</li><li>Watch éœ€è¦é‡å¤æ³¨å†Œï¼Œä¸ç„¶å°±ä¸èƒ½ç”Ÿæ•ˆ</li><li>å¼€å‘çš„å¤æ‚æ€§è¿˜æ˜¯æ¯”è¾ƒé«˜çš„</li><li>ä¸æ”¯æŒå¤šèŠ‚ç‚¹åˆ é™¤å’Œåˆ›å»ºã€‚éœ€è¦è‡ªå·±å»é€’å½’</li></ol><h3 id="5-2-2-ä»£ç ç¤ºä¾‹">5.2.2 ä»£ç ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> bjut.kengkeng.test;<br><br><span class="hljs-keyword">import</span> org.apache.curator.framework.CuratorFramework;<br><span class="hljs-keyword">import</span> org.apache.curator.framework.CuratorFrameworkFactory;<br><span class="hljs-keyword">import</span> org.apache.curator.framework.recipes.locks.InterProcessMutex;<br><span class="hljs-keyword">import</span> org.apache.curator.retry.ExponentialBackoffRetry;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é¦†é•¿é”</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> guolonghang</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2021-10-27</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CuratorLock</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¸»è¦</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> args argæ¸¸æˆ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//åˆ›å»ºåˆ†å¸ƒå¼é”1</span><br>        InterProcessMutex lock1 = <span class="hljs-keyword">new</span> InterProcessMutex(getCuratorFramework(), <span class="hljs-string">&quot;/locks&quot;</span>);<br>        <span class="hljs-comment">//åˆ›å»ºåˆ†å¸ƒå¼é”2</span><br>        InterProcessMutex lock2 = <span class="hljs-keyword">new</span> InterProcessMutex(getCuratorFramework(), <span class="hljs-string">&quot;/locks&quot;</span>);<br><br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                lock1.acquire();<br>                System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹1è·å–é”&quot;</span>);<br>                lock1.release();<br>                System.out.println(<span class="hljs-string">&quot;é‡Šæ”¾é”&quot;</span>);<br>                lock1.acquire();<br>                System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹1å†æ¬¡è·å–é”&quot;</span>);<br>                lock1.release();<br>                System.out.println(<span class="hljs-string">&quot;å†æ¬¡é‡Šæ”¾é”&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>            &#125;<br>        &#125;).start();<br><br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                lock2.acquire();<br>                System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹2è·å–é”&quot;</span>);<br>                lock2.release();<br>                System.out.println(<span class="hljs-string">&quot;é‡Šæ”¾é”&quot;</span>);<br>                lock2.acquire();<br>                System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹2å†æ¬¡è·å–é”&quot;</span>);<br>                lock2.release();<br>                System.out.println(<span class="hljs-string">&quot;å†æ¬¡é‡Šæ”¾é”&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>            &#125;<br>        &#125;).start();<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¾—åˆ°é¦†é•¿æ¡†æ¶</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-doctag">@code</span> CuratorFramework&#125;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> CuratorFramework <span class="hljs-title">getCuratorFramework</span><span class="hljs-params">()</span> </span>&#123;<br>        ExponentialBackoffRetry retry = <span class="hljs-keyword">new</span> ExponentialBackoffRetry(<span class="hljs-number">3000</span>, <span class="hljs-number">3</span>);<br>        CuratorFramework curatorFramework = CuratorFrameworkFactory.builder().connectString(<span class="hljs-string">&quot;hadoop102:2181&quot;</span>)<br>                .sessionTimeoutMs(<span class="hljs-number">2000</span>)<br>                .connectionTimeoutMs(<span class="hljs-number">2000</span>)<br>                .retryPolicy(retry).build();<br><br>        <span class="hljs-comment">//å¯åŠ¨å®¢æˆ·ç«¯</span><br>        curatorFramework.start();<br>        <span class="hljs-keyword">return</span> curatorFramework;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1>6. ä¼ä¸šé¢è¯•çœŸé¢˜</h1><h2 id="6-1-é€‰ä¸¾æœºåˆ¶">6.1 é€‰ä¸¾æœºåˆ¶</h2><p>åŠæ•°æœºåˆ¶ï¼Œè¶…è¿‡åŠæ•°çš„æŠ•ç¥¨é€šè¿‡ï¼Œå³é€šè¿‡ã€‚</p><ol><li><p>ç¬¬ä¸€æ¬¡å¯åŠ¨é€‰ä¸¾è§„åˆ™ï¼š<br>æŠ•ç¥¨è¿‡åŠæ•°æ—¶ï¼ŒæœåŠ¡å™¨  id å¤§çš„èƒœå‡º</p></li><li><p>ç¬¬äºŒæ¬¡å¯åŠ¨é€‰ä¸¾è§„åˆ™ï¼š<br>â‘ EPOCH å¤§çš„ç›´æ¥èƒœå‡º<br>â‘¡EPOCH ç›¸åŒï¼Œäº‹åŠ¡ id å¤§çš„èƒœå‡º â‘¢äº‹åŠ¡ id ç›¸åŒï¼ŒæœåŠ¡å™¨ id å¤§çš„èƒœå‡º</p></li></ol><h2 id="6-2-ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘zkåˆé€‚">6.2 ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘zkåˆé€‚</h2><p>å®‰è£…å¥‡æ•°å°ã€‚<br>ç”Ÿäº§ç»éªŒï¼š<br>âš«         10 å°æœåŠ¡å™¨ï¼š3 å° zkï¼›<br>âš«         20 å°æœåŠ¡å™¨ï¼š5 å° zkï¼›<br>âš«         100 å°æœåŠ¡å™¨ï¼š11 å° zkï¼›<br>âš«         200 å°æœåŠ¡å™¨ï¼š11 å° zk<br>æœåŠ¡å™¨å°æ•°å¤šï¼šå¥½å¤„ï¼Œæé«˜å¯é æ€§ï¼›åå¤„ï¼šæé«˜é€šä¿¡å»¶æ—¶</p><h2 id="6-3-å¸¸ç”¨å‘½ä»¤">6.3 å¸¸ç”¨å‘½ä»¤</h2><p>lsã€getã€createã€delete</p><h1>7.ç®—æ³•åŸºç¡€</h1><h2 id="7-1-æ‹œå åº­å°†å†›é—®é¢˜">7.1 æ‹œå åº­å°†å†›é—®é¢˜</h2><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211027162834105.png" class="" title="image-20211027162834105"><h2 id="7-2-Paxosç®—æ³•">7.2 Paxosç®—æ³•</h2><p><strong>Paxosç®—æ³•</strong>ï¼šä¸€ç§åŸºäºæ¶ˆæ¯ä¼ é€’ä¸”å…·æœ‰é«˜åº¦å®¹é”™ç‰¹æ€§çš„ä¸€è‡´æ€§ç®—æ³•ã€‚</p><p><strong>Paxosç®—æ³•è§£å†³çš„é—®é¢˜</strong>ï¼šå¦‚ä½•å¿«é€Ÿæ­£ç¡®çš„åœ¨ä¸€ä¸ªåˆ†å¸ƒ<code>å¼ç³»ç»Ÿä¸­å®ç°æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¹¶ä¸”ä¿è¯</code>ä¸è®ºå‘ç”Ÿä»€ä¹ˆå¼‚å¸¸ï¼Œéƒ½ä¸ä¼šç ´åæ•´ä¸ªç³»ç»Ÿçš„ä¸€è‡´æ€§</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211028100509787.png" class=""><h3 id="7-2-1-ç®—æ³•æè¿°">7.2.1 ç®—æ³•æè¿°</h3><p>åœ¨ä¸€ä¸ªPaxosç³»ç»Ÿä¸­ï¼Œå°†æ‰€æœ‰çš„èŠ‚ç‚¹åˆ’åˆ†æˆäº†Proposerï¼ˆæè®®è€…ï¼‰ã€Acceptorï¼ˆæ¥å—è€…ï¼‰ã€learnerï¼ˆå­¦ä¹ è€…ï¼‰ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥èº«å…¼æ•°èŒã€‚</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211028102420149.png" class="" title="image-20211028102420149"><p>ä¸€ä¸ªå®Œæ•´çš„Paxosç®—æ³•æµç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ol><li>prepareå‡†å¤‡é˜¶æ®µ<ol><li>Proposerå‘å¤šä¸ªAcceptorå‘å‡ºproposeè¯·æ±‚promiseï¼ˆæ‰¿è¯ºï¼‰ã€‚</li><li>Acceptorå¯¹æ”¶åˆ°çš„proposeè¿›è¡Œpromiseï¼ˆæ‰¿è¯ºï¼‰</li></ol></li><li>Acceptæ¥æ”¶é˜¶æ®µ<ol><li>Proposeræ”¶åˆ°å¤šæ•°Acceptorçš„promiseåï¼Œå‘Acceptorå‘å‡ºproposeè¯·æ±‚</li><li>Acceptoré’ˆå¯¹æ”¶åˆ°çš„promiseè¿›è¡Œacceptå¤„ç†</li></ol></li><li>Learnå­¦ä¹ é˜¶æ®µï¼šProposerå°†å½¢æˆçš„å†³è®®å‘ç»™å…¨éƒ¨Learner</li></ol><h3 id="7-2-2-ç®—æ³•æµç¨‹">7.2.2 ç®—æ³•æµç¨‹</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211028104555482.png" class="" title="image-20211028104555482"><ol><li><strong>Prepare</strong>: Proposerç”Ÿæˆå…¨å±€å”¯ä¸€æ—¦é€’å¢çš„Proposal 1Dï¼Œå‘æ‰€æœ‰Acceptorå‘é€Proposeè¯·æ±‚ï¼Œè¿™é‡Œæ— éœ€æºå¸¦ææ¡ˆå†…å®¹ï¼Œåªæº<br>å¸¦Proposal IDå³å¯</li><li><strong>Promise</strong>: Acceptoræ”¶åˆ°Proposeè¯·æ±‚åï¼Œåšå‡ºâ€œä¸¤ä¸ªæ‰¿è¯ºï¼Œä¸€ä¸ªåº”ç­”â€<ol><li>ä¸å†æ¥æ”¶Proposal IDå°äºç­‰äºï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ˜¯ï¼œäºŒï¼‰å½“å‰è¯·æ±‚çš„Proposeè¯·æ±‚ã€‚</li><li>ä¸å†æ¥æ”¶Proposal IDå°äºï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ˜¯ï¼œï¼‰å½“å‰è¯·æ±‚çš„Acceptè¯·æ±‚ã€‚</li><li>ä¸è¿èƒŒä»¥å‰åšå‡ºçš„æ‰¿è¯ºä¸‹ï¼Œå›å¤å·±ç»Acceptè¿‡çš„ææ¡ˆä¸­Proposal IDæœ€å¤§çš„é‚£ä¸ªææ¡ˆçš„Value å’ŒProposal DDï¼Œæ²¡æœ‰åˆ™<br>è¿”å›ç©ºå€¼</li></ol></li><li><strong>Propose</strong>ï¼šProposeræ”¶åˆ°å¤šæ•°Acceptorçš„Promniseåº”ç­”åï¼Œä»åº”ç­”ä¸­é€‰æ‹©Proposal IDæœ€å¤§çš„ææ¡ˆçš„Valueï¼Œä½œä¸ºæœ¬æ¬¡è¦å‘èµ·çš„<br>ææ¡ˆã€‚å¦‚æœæ‰€æœ‰åº”ç­”çš„ææ¡ˆValueå‡ä¸ºç©ºå€¼ï¼Œåˆ™å¯ä»¥è‡ªå·±éšæ„å†³å®šææ¡ˆValueã€‚ç„¶åæºå¸¦å½“å‰Proposal IDï¼Œå‘æ‰€æœ‰Acceptorå‘é€<br>Proposeè¯·æ±‚ã€‚</li><li><strong>Accept</strong>: Acceptoræ”¶åˆ°Proposeè¯·æ±‚åï¼Œåœ¨ä¸è¿èƒŒè‡ªå·±ä¹‹å‰åšå‡ºçš„æ‰¿è¯ºä¸‹ï¼Œæ¥å—å¹¶æŒä¹…åŒ–å½“ å‰ProposalIDå’Œæå®¶Valueã€‚</li><li><strong>Learn</strong>: Proposeræ”¶åˆ°å¤šæ•°Acceptorçš„Acceptåï¼Œå†³è®®å½¢æˆï¼Œå°†å½¢æˆçš„å†³è®®å‘é€ç»™æ‰€æœ‰Learnerã€‚</li></ol><h3 id="7-2-3-ä¸¾ä¾‹">7.2.3 ä¸¾ä¾‹</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211028105528384.png" class="" title="image-20211028105528384"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211028105601544.png" class="" title="image-20211028105601544"><p>Paxos ç®—æ³•ç¼ºé™·ï¼šåœ¨ç½‘ç»œå¤æ‚çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåº”ç”¨  Paxos ç®—æ³•çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¯èƒ½å¾ˆä¹… æ— æ³•æ”¶æ•›ï¼Œç”šè‡³é™·å…¥æ´»é”çš„æƒ…å†µã€‚</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211028145240380.png" class="" title="image-20211028145240380"><p>é€ æˆè¿™ç§æƒ…å†µçš„åŸå› æ˜¯ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªä»¥ä¸Šçš„ Proposerï¼Œå¤š ä¸ª Proposers ç›¸äº’äº‰å¤º Acceptorï¼Œ é€ æˆè¿Ÿè¿Ÿæ— æ³•è¾¾æˆä¸€è‡´çš„æƒ…å†µã€‚**é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œä¸€ç§æ”¹è¿›çš„ Paxos ç®—æ³•è¢«æå‡ºï¼šä»ç³»ç»Ÿä¸­é€‰ å‡ºä¸€ä¸ªèŠ‚ç‚¹ä½œä¸º Leaderï¼Œåªæœ‰ Leader èƒ½å¤Ÿå‘èµ·ææ¡ˆã€‚**è¿™æ ·ï¼Œä¸€æ¬¡ Paxos æµç¨‹ä¸­åªæœ‰ä¸€ä¸ª Proposerï¼Œä¸ä¼šå‡ºç°æ´»é”çš„æƒ…å†µï¼Œæ­¤æ—¶åªä¼šå‡ºç°ä¾‹å­ä¸­ç¬¬ä¸€ç§æƒ…å†µã€‚</p><h2 id="7-3-ZABç®—æ³•">7.3 ZABç®—æ³•</h2><h3 id="7-3-1-ä»€ä¹ˆæ˜¯ZABç®—æ³•">7.3.1 ä»€ä¹ˆæ˜¯ZABç®—æ³•</h3><p>Zab å€Ÿé‰´äº† Paxos ç®—æ³•ï¼Œæ˜¯ç‰¹åˆ«ä¸º Zookeeper è®¾è®¡çš„<strong>æ”¯æŒå´©æºƒæ¢å¤çš„åŸå­å¹¿æ’­åè®®</strong>ã€‚åŸº äºè¯¥åè®®ï¼ŒZookeeper è®¾è®¡ä¸º**åªæœ‰ä¸€å°å®¢æˆ·ç«¯ï¼ˆLeaderï¼‰**è´Ÿè´£å¤„ç†å¤–éƒ¨çš„å†™äº‹åŠ¡è¯·æ±‚ï¼Œç„¶å Leader å®¢æˆ·ç«¯å°†æ•°æ®åŒæ­¥åˆ°å…¶ä»– Follower èŠ‚ç‚¹ã€‚<strong>å³ Zookeeper åªæœ‰ä¸€ä¸ª Leader å¯ä»¥å‘èµ·æ æ¡ˆã€‚</strong></p><h3 id="7-3-2-ZABåè®®å†…å®¹">7.3.2 ZABåè®®å†…å®¹</h3><p>Zab åè®®åŒ…æ‹¬ä¸¤ç§åŸºæœ¬çš„æ¨¡å¼ï¼šæ¶ˆæ¯å¹¿æ’­ã€å´©æºƒæ¢å¤ã€‚</p><h4 id="7-3-2-1-æ¶ˆæ¯å¹¿æ’­æ¨¡å¼">7.3.2.1 æ¶ˆæ¯å¹¿æ’­æ¨¡å¼</h4><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211028151529925.png" class="" title="image-20211028151529925"><ol><li>å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªå†™æ“ä½œè¯·æ±‚ã€‚</li><li>LeaderæœåŠ¡å™¨<strong>å°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬åŒ–ä¸ºäº‹åŠ¡Proposal ææ¡ˆ</strong>ï¼ŒåŒæ—¶<strong>ä¸ºæ¯ä¸ªProposal åˆ†é…ä¸€ä¸ªå…¨å±€çš„1Dï¼Œå³zxid.</strong></li><li>LeaderæœåŠ¡å™¨<strong>ä¸ºæ¯ä¸ªFolloweræœåŠ¡å™¨åˆ†é…ä¸€ä¸ªå•ç‹¬çš„é˜Ÿåˆ—</strong>ï¼Œç„¶åå°†éœ€è¦å¹¿æ’­çš„ Proposalä¾æ¬¡æ”¾åˆ°é˜Ÿåˆ—ä¸­å»ï¼Œ<strong>å¹¶ä¸”æ ¹æ®FIFOç­–ç•¥è¿›è¡Œæ¶ˆæ¯å‘é€ã€‚</strong></li><li>Followeræ¥æ”¶åˆ°Proposalåï¼Œä¼šé¦–å…ˆ<strong>å°†å…¶ä»¥äº‹åŠ¡æ—¥å¿—çš„æ–¹å¼å†™å…¥æœ¬åœ°ç£ç›˜</strong>ä¸­ï¼Œå†™å…¥æˆåŠŸå<strong>å‘Leaderåé¦ˆä¸€ä¸ªAckå“åº”æ¶ˆæ¯</strong></li><li>Ieaderæ¥æ”¶åˆ°<strong>è¶…è¿‡åŠæ•°ä»¥ä¸ŠFollowerçš„Ackå“åº”æ¶ˆæ¯</strong>åï¼Œå³è®¤ä¸ºæ¶ˆæ¯å‘é€æˆåŠŸï¼Œå¯ä»¥å‘é€commitæ¶ˆæ¯ã€‚</li><li>Leaderå‘æ‰€æœ‰Followerå¹¿æ’­commitæ¶ˆæ¯ï¼ŒåŒæ—¶è‡ªèº«ä¹Ÿä¼šå®Œæˆäº‹åŠ¡æäº¤ã€‚Follower æ¥æ”¶åˆ°commitæ¶ˆæ¯åï¼Œä¼šå°†ä¸Šä¸€æ¡äº‹åŠ¡æäº¤ã€‚</li><li>zookeeperé‡‡ç”¨Zabåè®®çš„æ ¸å¿ƒï¼Œå°±æ˜¯åªè¦æœ‰ä¸€å°æœåŠ¡å™¨æäº¤äº†Proposalï¼Œå°±è¦ç¡®ä¿æ‰€æœ‰çš„æœåŠ¡å™¨æœ€ç»ˆéƒ½èƒ½æ­£ç¡®æäº¤Proposalã€‚</li></ol><p><strong>ã€é—®é¢˜ã€‘</strong></p><p>ZABåè®®é’ˆå¯¹äºäº‹åŠ¡è¯·æ±‚çš„æ“ä½œç±»ä¼¼äºä¸€ä¸ªä¸¤æ®µå¼æäº¤æ“ä½œã€‚</p><p>ï¼ˆ1ï¼‰å¹¿æ’­äº‹åŠ¡é˜¶æ®µ</p><p>ï¼ˆ2ï¼‰å¹¿æ’­æäº¤é˜¶æ®µ</p><p>ï¼ˆ1ï¼‰ä½†æ˜¯å½“Leaderæäº¤ä¸€ä¸ªproposalåï¼Œå°±æ¥ç€å®•æœºäº†ï¼ŒFolloweréƒ½æ²¡æœ‰åŠæ³•å®Œæˆproposal</p><p>ï¼ˆ2ï¼‰Leaderæ”¶åˆ°åŠæ•°çš„ACKåï¼Œè¿˜æ²¡æœ‰æ¥çš„åŠcommitï¼Œå°±å®•æœºäº†ï¼ŒFollowerä¹Ÿæ²¡æœ‰åŠæ³•å®Œæˆproposal</p><h4 id="7-3-2-2-å´©æºƒæ¢å¤">7.3.2.2 å´©æºƒæ¢å¤</h4><p>ä¸€æ—¦Leaderå‡ºç°äº†å´©æºƒç°è±¡æˆ–è€…å› ä¸ºç½‘ç»œé—®é¢˜ä¸è¿‡åŠçš„followerå¤±å»äº†è¿æ¥ï¼ŒLeaderå°±ä¼šè¿›å…¥å´©æºƒæ¢å¤æ¨¡å¼ã€‚</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211028152824245.png" class="" title="image-20211028152824245"><ol><li>å‡è®¾ä¸¤ç§æœåŠ¡å™¨å¼‚å¸¸æƒ…å†µï¼š<ol><li>å‡è®¾ä¸€ä¸ªäº‹åŠ¡ åœ¨Ieaderæå‡ºä¹‹åï¼ŒLeaderæŒ‚äº†ã€‚</li><li>ä¸€ä¸ªäº‹åŠ¡åœ¨Ieaderä¸Šæäº¤äº†ï¼Œå¹¶ä¸”è¿‡åŠçš„Followeréƒ½å“åº”Ackäº†ï¼Œä½†æ˜¯Leaderåœ¨Commitæ¶ˆæ¯å‘å‡ºä¹‹å‰æŒ‚äº†ã€‚</li></ol></li><li>zabåè®®å´©æºƒæ¢å¤è¦æ±‚æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªè¦æ±‚ï¼š<ol><li>ç¡®ä¿å·²ç»è¢«Ieaderæäº¤çš„ææ¡ˆProposalï¼Œå¿…é¡»æœ€ç»ˆè¢«æ‰€æœ‰çš„FolloweræœåŠ¡å™¨æäº¤ã€‚</li><li>ç¡®ä¿ä¸¢å¼ƒå·²ç»è¢«Icaderæå‡ºçš„ï¼Œä½†æ˜¯æ²¡æœ‰è¢«æäº¤çš„Proposalã€‚ï¼ˆä¸¢å¼ƒèƒæ­»è…¹ä¸­çš„ææ¡ˆï¼‰<br>ï¼ˆå·±ç»äº§ç”Ÿçš„ææ¡ˆï¼ŒFollowerå¿…é¡»æ‰§è¡Œ)</li></ol></li></ol><p>å´©æºƒæ¢å¤ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µå³ï¼š<strong>ã€Leaderé€‰ä¸¾ã€‘å’Œã€æ•°æ®æ¢å¤ã€‘</strong></p><p><strong>ã€Leaderé€‰ä¸¾ã€‘</strong></p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211028153512643.png" class="" title="image-20211028153512643"><p>Leaderé€‰ä¸¾:æ ¹æ®ä¸Šè¿°è¦æ±‚ï¼ŒZabåè®®éœ€è¦ä¿è¯é€‰ä¸¾å‡ºæ¥çš„Leaderéœ€è¦è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶:</p><p>(1)æ–°é€‰ä¸¾å‡ºæ¥çš„Leaderä¸èƒ½åŒ…å«æœªæäº¤çš„Proposalã€‚<strong>å³æ–°Leaderå¿…é¡»éƒ½æ˜¯å·²ç»æäº¤äº†Proposalçš„FolloweræœåŠ¡å™¨èŠ‚ç‚¹ã€‚</strong></p><p>(2)æ–°é€‰ä¸¾çš„LeaderèŠ‚ç‚¹ä¸­å«æœ‰æœ€å¤§çš„zxidã€‚<strong>è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥è¿‘é¿å…LeaderæœåŠ¡å™¨æ£€æŸ¥Proposalçš„æäº¤å’Œä¸¢å¼ƒå·¥ä½œã€‚</strong></p><p><strong>ã€æ•°æ®æ¢å¤ã€‘</strong></p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211028153957554.png" class="" title="image-20211028153957554"><p>Zabå¦‚ä½•æ•°æ®åŒæ­¥:</p><p>(1)å®ŒæˆLeaderé€‰ä¸¾åï¼Œåœ¨æ­£å¼å¼€å§‹å·¥ä½œä¹‹å‰(æ¥æ”¶äº‹åŠ¡è¯·æ±‚ï¼Œç„¶åæå‡ºæ–°çš„Proposal)ï¼ŒLeaderæœåŠ¡å™¨ä¼š<strong>é¦–å…ˆç¡®è®¤äº‹åŠ¡æ—¥å¿—ä¸­çš„æ‰€æœ‰çš„Proposal æ˜¯å¦å·²ç»è¢«é›†ç¾¤ä¸­è¿‡åŠçš„æœåŠ¡å™¨Commitã€‚</strong></p><p>(2)**LeaderæœåŠ¡å™¨éœ€è¦ç¡®ä¿æ‰€æœ‰çš„FolloweræœåŠ¡å™¨èƒ½å¤Ÿæ¥æ”¶åˆ°æ¯æ¡äº‹åŠ¡çš„Proposalï¼Œå¹¶ä¸”èƒ½å°†æ‰€æœ‰å·²ç»æäº¤çš„äº‹åŠ¡Proposalï¼Œåº”ç”¨åˆ°å†…å­˜æ•°æ®ä¸­ã€‚**ç­‰åˆ°Followerå°†æ‰€æœ‰å°šæœªåŒæ­¥çš„äº‹åŠ¡Proposaléƒ½åœ¨LeaderæœåŠ¡å™¨ä¸ŠåŒæ­¥è¿‡ï¼Œå¹¶ä¸”åº”ç”¨åˆ°å†…å­˜æ•°æ®ä¸­ä»¥åï¼ŒLeaderæ‰ä¼šæŠŠè¯¥FolloweråŠ å…¥åˆ°çœŸæ­£å¯ç”¨çš„Followeråˆ—è¡¨ä¸­ã€‚</p><h2 id="7-4-CAPç†è®º">7.4 CAPç†è®º</h2><p>CAPç†è®ºå‘Šè¯‰æˆ‘ä»¬ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ç§</p><ul><li><strong>ä¸€è‡´æ€§(C:Consistency)</strong></li><li><strong>å¯ç”¨æ€§(A:Available)</strong></li><li><strong>åˆ†åŒºå®¹é”™æ€§(P:Partition Tolerance)</strong></li></ul><p>è¿™ä¸‰ä¸ªåŸºæœ¬éœ€æ±‚ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­çš„ä¸¤é¡¹ï¼Œ<strong>å› ä¸ºPæ˜¯å¿…é¡»çš„ï¼Œå› æ­¤å¾€å¾€é€‰æ‹©å°±åœ¨CPæˆ–è€…APä¸­ã€‚</strong></p><ol><li>ä¸€è‡´æ€§(C:Consistency)ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œ<strong>ä¸€è‡´æ€§æ˜¯æŒ‡æ•°æ®åœ¨å¤šä¸ªå‰¯æœ¬ä¹‹é—´æ˜¯å¦èƒ½å¤Ÿä¿æŒæ•°æ®ä¸€è‡´çš„ç‰¹æ€§</strong>ã€‚åœ¨ä¸€è‡´æ€§çš„éœ€æ±‚ä¸‹ï¼Œ<strong>å½“ä¸€ä¸ªç³»ç»Ÿåœ¨æ•°æ®ä¸€è‡´çš„çŠ¶æ€ä¸‹æ‰§è¡Œæ›´æ–°æ“ä½œåï¼Œåº”è¯¥ä¿è¯ç³»ç»Ÿçš„æ•°æ®ä»ç„¶å¤„äºä¸€è‡´çš„çŠ¶æ€ã€‚</strong></li><li>å¯ç”¨æ€§(A:Available)ï¼š<strong>å¯ç”¨æ€§æ˜¯æŒ‡ç³»ç»Ÿæä¾›çš„æœåŠ¡å¿…é¡»ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€</strong>ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚</li><li>åˆ†åŒºå®¹é”™æ€§(P:Partition Tolerance)ï¼š<strong>åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¤Ÿä¿è¯å¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡</strong>ï¼Œé™¤éæ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚</li><li><strong>ZooKeeperä¿è¯çš„æ˜¯CP</strong></li><li>ZooKeeperä¸èƒ½ä¿è¯æ¯æ¬¡æœåŠ¡è¯·æ±‚çš„å¯ç”¨æ€§ã€‚(æ³¨:åœ¨æç«¯ç¯å¢ƒä¸‹ï¼ŒZooKeeperå¯èƒ½ä¼šä¸¢å¼ƒä¸€äº›è¯·æ±‚ï¼Œæ¶ˆè´¹è€…ç¨‹åºéœ€è¦<br>é‡æ–°è¯·æ±‚æ‰èƒ½è·å¾—ç»“æœ)ã€‚æ‰€ä»¥è¯´ï¼ŒZooKeeperä¸èƒ½ä¿è¯æœåŠ¡å¯ç”¨æ€§ã€‚</li><li>è¿›è¡ŒLeaderé€‰ä¸¾æ—¶é›†ç¾¤éƒ½æ˜¯ä¸å¯ç”¨ã€‚</li></ol><h1>8. æºç è¯¦è§£</h1><h2 id="8-1-è¾…åŠ©æºç ">8.1 è¾…åŠ©æºç </h2><h3 id="8-1-1-æŒä¹…åŒ–æºç ">8.1.1 æŒä¹…åŒ–æºç </h3><p>Leaderå’Œfollowerçš„æ•°æ®ä¼šåœ¨å†…å­˜å’Œç£ç›˜å„ä¿å­˜ä¸€ä»½ï¼Œæ‰€ä»¥éœ€è¦å°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜é‡Œ</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029094728816.png" class="" title="image-20211029094728816"><p>ï¼ˆ1ï¼‰ï¼šSnapShotæºç ï¼šå¿«ç…§çš„æºç ä¸€èˆ¬å°±æ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SnapShot</span> </span>&#123;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * deserialize a data tree from the last valid snapshot and </span><br><span class="hljs-comment">     * return the last zxid that was deserialized</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dt the datatree to be deserialized into</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sessions the sessions to be deserialized into</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> the last zxid that was deserialized from the snapshot</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     * ååºåˆ—åŒ–</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">deserialize</span><span class="hljs-params">(DataTree dt, Map&lt;Long, Integer&gt; sessions)</span> </span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> IOException</span>;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * persist the datatree and the sessions into a persistence storage</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dt the datatree to be serialized</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sessions </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     * åºåˆ—åŒ–</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">serialize</span><span class="hljs-params">(DataTree dt, Map&lt;Long, Integer&gt; sessions, </span></span><br><span class="hljs-params"><span class="hljs-function">            File name)</span> </span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> IOException</span>;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * find the most recent snapshot file</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> the most recent snapshot file</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     * æ‰¾åˆ°æœ€è¿‘çš„å¿«ç…§</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">File <span class="hljs-title">findMostRecentSnapshot</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * free resources from this snapshot immediately</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     * å…³é—­</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>&#125; <br><br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰TxnLog æ—¥å¿—æºç ï¼šä¸€èˆ¬å°±æ˜¯å¯¹æ—¥å¿—çš„å¢åˆ æ”¹æŸ¥æˆ–è€…ä¸€äº›å®šåˆ¶åŒ–çš„åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TxnLog</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Setter for ServerStats to monitor fsync threshold exceed</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> serverStats used to update fsyncThresholdExceedCount</span><br><span class="hljs-comment">     * è®¾ç½®æœåŠ¡å™¨çš„çŠ¶æ€</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setServerStats</span><span class="hljs-params">(ServerStats serverStats)</span></span>;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * roll the current</span><br><span class="hljs-comment">     * log being appended to</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException </span><br><span class="hljs-comment">     * å›æ»šæ—¥å¿—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rollLog</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Append a request to the transaction log</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> hdr the transaction header</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> r the transaction itself</span><br><span class="hljs-comment">     * returns true iff something appended, otw false </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     * è¿½åŠ æ—¥å¿—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">append</span><span class="hljs-params">(TxnHeader hdr, Record r)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Start reading the transaction logs</span><br><span class="hljs-comment">     * from a given zxid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> zxid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> returns an iterator to read the </span><br><span class="hljs-comment">     * next transaction in the logs.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     * æ ¹æ®å¯¹åº”çš„äº‹åŠ¡IDè¯»å–æ—¥å¿—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">TxnIterator <span class="hljs-title">read</span><span class="hljs-params">(<span class="hljs-keyword">long</span> zxid)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * the last zxid of the logged transactions.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> the last zxid of the logged transactions.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     * å¾—åˆ°æœ€åä¸€ä¸ªæ—¥å¿—äº‹åŠ¡ID</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">getLastLoggedZxid</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * truncate the log to get in sync with the </span><br><span class="hljs-comment">     * leader.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> zxid the zxid to truncate at.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException </span><br><span class="hljs-comment">     * åˆ é™¤</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">truncate</span><span class="hljs-params">(<span class="hljs-keyword">long</span> zxid)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * the dbid for this transaction log. </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> the dbid for this transaction log.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     * è·å–BDID</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">getDbId</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * commit the transaction and make sure</span><br><span class="hljs-comment">     * they are persisted</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     * æäº¤</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">commit</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> transaction log&#x27;s elapsed sync time in milliseconds</span><br><span class="hljs-comment">     * è·å–åŒæ­¥æ—¶é—´</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">getTxnLogSyncElapsedTime</span><span class="hljs-params">()</span></span>;<br>   <br>    <span class="hljs-comment">/** </span><br><span class="hljs-comment">     * close the transactions logs</span><br><span class="hljs-comment">     * å…³é—­</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * an iterating interface for reading </span><br><span class="hljs-comment">     * transaction logs. </span><br><span class="hljs-comment">     * è¯»å–æ—¥å¿—çš„æ¥å£</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TxnIterator</span> </span>&#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * return the transaction header.</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@return</span> return the transaction header.</span><br><span class="hljs-comment">         * è·å–å¤´ä¿¡æ¯</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-function">TxnHeader <span class="hljs-title">getHeader</span><span class="hljs-params">()</span></span>;<br>        <br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * return the transaction record.</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@return</span> return the transaction record.</span><br><span class="hljs-comment">         * è·å–ä¼ è¾“çš„å†…å®¹</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-function">Record <span class="hljs-title">getTxn</span><span class="hljs-params">()</span></span>;<br>     <br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * go to the next transaction record.</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">         * ä¸‹ä¸€æ¡èµ„æº</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">next</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>        <br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * close files and release the </span><br><span class="hljs-comment">         * resources</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">         * å…³é—­</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>        <br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * Get an estimated storage space used to store transaction records</span><br><span class="hljs-comment">         * that will return by this iterator</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">         * è·å–å­˜å‚¨çš„å¤§å°</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">getStorageSize</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰å¤„ç†æŒä¹…åŒ–çš„æ ¸å¿ƒç±»</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029100817877.png" class="" title="image-20211029100817877"><h3 id="8-1-2-åºåˆ—åŒ–æºç ">8.1.2 åºåˆ—åŒ–æºç </h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029100855921.png" class="" title="image-20211029100855921"><p>ï¼ˆ1ï¼‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Interface that is implemented by generated classes.</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@InterfaceAudience</span>.Public<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Record</span> </span>&#123;<br>  <span class="hljs-comment">// åºåˆ—åŒ–</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">serialize</span><span class="hljs-params">(OutputArchive archive, String tag)</span></span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> IOException</span>;<br>  <span class="hljs-comment">// ååºåˆ—åŒ–</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deserialize</span><span class="hljs-params">(InputArchive archive, String tag)</span></span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> IOException</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰è¿­ä»£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Interface that acts as an iterator for deserializing maps.</span><br><span class="hljs-comment"> * The deserializer returns an instance that the record uses to</span><br><span class="hljs-comment"> * read vectors and maps. An example of usage is as follows:</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;code&gt;</span><br><span class="hljs-comment"> * Index idx = startVector(...);</span><br><span class="hljs-comment"> * while (!idx.done()) &#123;</span><br><span class="hljs-comment"> *   .... // read element of a vector</span><br><span class="hljs-comment"> *   idx.incr();</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> * &lt;/code&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Index</span> </span>&#123;<br>    <span class="hljs-comment">// ç»“æŸ</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">done</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-comment">// ä¸‹ä¸€ä¸ª</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">incr</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>(3) åºåˆ—åŒ–æ”¯æŒçš„æ•°æ®ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Interface that alll the serializers have to implement.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">OutputArchive</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeByte</span><span class="hljs-params">(<span class="hljs-keyword">byte</span> b, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeBool</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> b, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeInt</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeLong</span><span class="hljs-params">(<span class="hljs-keyword">long</span> l, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeFloat</span><span class="hljs-params">(<span class="hljs-keyword">float</span> f, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeDouble</span><span class="hljs-params">(<span class="hljs-keyword">double</span> d, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeString</span><span class="hljs-params">(String s, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeBuffer</span><span class="hljs-params">(<span class="hljs-keyword">byte</span> buf[], String tag)</span></span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeRecord</span><span class="hljs-params">(Record r, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startRecord</span><span class="hljs-params">(Record r, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">endRecord</span><span class="hljs-params">(Record r, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startVector</span><span class="hljs-params">(List&lt;?&gt; v, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">endVector</span><span class="hljs-params">(List&lt;?&gt; v, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startMap</span><span class="hljs-params">(TreeMap&lt;?,?&gt; v, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">endMap</span><span class="hljs-params">(TreeMap&lt;?,?&gt; v, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>(4) ååºåˆ—åŒ–æ”¯æŒçš„æ•°æ®ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Interface that all the Deserializers have to implement.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">InputArchive</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">byte</span> <span class="hljs-title">readByte</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">readBool</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">readInt</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">readLong</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> <span class="hljs-title">readFloat</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">readDouble</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">readString</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">byte</span>[] readBuffer(String tag) <span class="hljs-keyword">throws</span> IOException;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">readRecord</span><span class="hljs-params">(Record r, String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startRecord</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">endRecord</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Index <span class="hljs-title">startVector</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">endVector</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Index <span class="hljs-title">startMap</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">endMap</span><span class="hljs-params">(String tag)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="8-2-ZK-æœåŠ¡ç«¯åˆå§‹åŒ–æºç è§£æ">8.2 ZK æœåŠ¡ç«¯åˆå§‹åŒ–æºç è§£æ</h2><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029101916331.png" class="" title="image-20211029101916331"><h3 id="8-2-1-ZK-æœåŠ¡ç«¯å¯åŠ¨è„šæœ¬åˆ†æ">8.2.1 ZK æœåŠ¡ç«¯å¯åŠ¨è„šæœ¬åˆ†æ</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029102200208.png" class="" title="image-20211029102200208"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029102302273.png" class="" title="image-20211029102302273"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029102414373.png" class="" title="image-20211029102414373"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029102508800.png" class="" title="image-20211029102508800"><h3 id="8-2-2-ZK-æœåŠ¡ç«¯å¯åŠ¨å…¥å£">8.2.2 ZK æœåŠ¡ç«¯å¯åŠ¨å…¥å£</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029103021012.png" class="" title="image-20211029103021012"><ol><li>é¦–å…ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ªQuorumPeerMainå®ä¾‹å¯¹è±¡ï¼Œç„¶åæ‰§è¡ŒQuorumPeerMain.initializeAndRun()æ–¹æ³•</li></ol><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029103145824.png" class="" title="image-20211029103145824"><ol start="2"><li>å…¶ä¸­initializeAndRunæ–¹æ³•ç”¨æ¥ç®¡ç†zkçš„é…ç½®ä¿¡æ¯</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initializeAndRun</span><span class="hljs-params">(String[] args)</span></span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> ConfigException, IOException, AdminServerException</span><br><span class="hljs-function">    </span>&#123;<br>  <span class="hljs-comment">// 1. æ–°å»ºä¸€ä¸ªé…ç½®å¯¹è±¡</span><br>        QuorumPeerConfig config = <span class="hljs-keyword">new</span> QuorumPeerConfig();<br>        <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">1</span>) &#123;<br>          <span class="hljs-comment">// è§£æå‚æ•°ï¼Œè·å–zoo.cfg myid</span><br>            config.parse(args[<span class="hljs-number">0</span>]);<br>        &#125;<br><br>        <span class="hljs-comment">//  2. å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œå¯¹è¿‡æœŸçš„å¿«ç…§ï¼Œæ‰§è¡Œåˆ é™¤ï¼ˆé»˜è®¤è¯¥åŠŸèƒ½å…³é—­ï¼‰</span><br>        DatadirCleanupManager purgeMgr = <span class="hljs-keyword">new</span> DatadirCleanupManager(config<br>                .getDataDir(), config.getDataLogDir(), config<br>                .getSnapRetainCount(), config.getPurgeInterval());<br>        purgeMgr.start();<br><span class="hljs-comment">// 3  å¯åŠ¨é›†ç¾¤</span><br>        <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">1</span> &amp;&amp; config.isDistributed()) &#123;<br>            runFromConfig(config);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            LOG.warn(<span class="hljs-string">&quot;Either no config or no quorum defined in config, running &quot;</span><br>                    + <span class="hljs-string">&quot; in standalone mode&quot;</span>);<br>            <span class="hljs-comment">// there is only server in the quorum -- run as standalone</span><br>            ZooKeeperServerMain.main(args);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="8-2-3-è§£æå‚æ•°-zoo-cfg-å’Œ-myid">8.2.3 è§£æå‚æ•° zoo.cfg å’Œ myid</h3><ol><li>è§£æzoo.cfg å’Œ myid</li></ol><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029103735304.png" class="" title="image-20211029103735304"><ol start="4"><li>æ ¹æ®è·¯å¾„è§£æzoo.cfg ç„¶åå°†å…¶è½¬æ¢ä¸ºpropertiesæ–‡ä»¶</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">parse</span><span class="hljs-params">(String path)</span> <span class="hljs-keyword">throws</span> ConfigException </span>&#123;<br>       LOG.info(<span class="hljs-string">&quot;Reading configuration from: &quot;</span> + path);<br>      <br>       <span class="hljs-keyword">try</span> &#123;<br>           File configFile = (<span class="hljs-keyword">new</span> VerifyingFileFactory.Builder(LOG)<br>               .warnForRelativePath()<br>               .failForNonExistingPath()<br>               .build()).create(path);<br>               <br>           Properties cfg = <span class="hljs-keyword">new</span> Properties();<br>           FileInputStream in = <span class="hljs-keyword">new</span> FileInputStream(configFile);<br>           <span class="hljs-keyword">try</span> &#123;<br>               cfg.load(in);<br>               configFileStr = path;<br>           &#125; <span class="hljs-keyword">finally</span> &#123;<br>               in.close();<br>           &#125;<br>           <span class="hljs-comment">// æ„é€ æˆpropertiesç±»å‹æ–‡ä»¶</span><br>           parseProperties(cfg);<br>       &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConfigException(<span class="hljs-string">&quot;Error processing &quot;</span> + path, e);<br>       &#125; <span class="hljs-keyword">catch</span> (IllegalArgumentException e) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConfigException(<span class="hljs-string">&quot;Error processing &quot;</span> + path, e);<br>       &#125;   <br></code></pre></td></tr></table></figure><ol start="5"><li>è§£æpropertiesæ–‡ä»¶ã€‚<strong>zoo.cfgé…ç½®æ–‡ä»¶â€“&gt;propertiesæ–‡ä»¶â€“&gt;mapé›†åˆ</strong> æ ¹æ®zoo.cfgé…ç½®æ–‡ä»¶å¯¹å®ä¾‹å¯¹è±¡è¿›è¡Œsetterè®¾ç½®ã€‚å®Œæˆåˆå§‹åŒ–ã€‚</li></ol><ol start="6"><li>è®¾ç½®myidå’ŒQuorumPeerConfig</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setupMyId</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        File myIdFile = <span class="hljs-keyword">new</span> File(dataDir, <span class="hljs-string">&quot;myid&quot;</span>);<br>        <span class="hljs-comment">// standalone server doesn&#x27;t need myid file.</span><br>        <span class="hljs-keyword">if</span> (!myIdFile.isFile()) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        BufferedReader br = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> FileReader(myIdFile));<br>        String myIdString;<br>        <span class="hljs-keyword">try</span> &#123;<br>            myIdString = br.readLine();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            br.close();<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            serverId = Long.parseLong(myIdString);<br>            MDC.put(<span class="hljs-string">&quot;myid&quot;</span>, myIdString);<br>        &#125; <span class="hljs-keyword">catch</span> (NumberFormatException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;serverid &quot;</span> + myIdString<br>                    + <span class="hljs-string">&quot; is not a number&quot;</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setupQuorumPeerConfig</span><span class="hljs-params">(Properties prop, <span class="hljs-keyword">boolean</span> configBackwardCompatibilityMode)</span></span><br><span class="hljs-function">            <span class="hljs-keyword">throws</span> IOException, ConfigException </span>&#123;<br>        quorumVerifier = parseDynamicConfig(prop, electionAlg, <span class="hljs-keyword">true</span>, configBackwardCompatibilityMode);<br>        setupMyId();<br>        setupClientPort();<br>        setupPeerType();<br>        checkValidity();<br>    &#125;<br></code></pre></td></tr></table></figure><ol start="7"><li>å°ç»“<ol><li>é¦–å…ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ª<strong>QuorumPeerMain</strong>å®ä¾‹å¯¹è±¡ï¼Œç„¶åæ‰§è¡ŒQuorumPeerMain.i**nitializeAndRun()**æ–¹æ³•</li><li>å…¶ä¸­initializeAndRunæ–¹æ³•ç”¨æ¥ç®¡ç†zkçš„é…ç½®ä¿¡æ¯</li><li>è§£æ<strong>zoo.cfg</strong> å’Œ <strong>myid</strong></li><li>æ ¹æ®è·¯å¾„è§£æzoo.cfg ç„¶åå°†å…¶è½¬æ¢ä¸ºpropertiesæ–‡ä»¶</li><li>è§£æpropertiesæ–‡ä»¶ã€‚<strong>zoo.cfgé…ç½®æ–‡ä»¶â€“&gt;propertiesæ–‡ä»¶â€“&gt;mapé›†åˆ</strong> æ ¹æ®zoo.cfgé…ç½®æ–‡ä»¶å¯¹å®ä¾‹å¯¹è±¡è¿›è¡Œsetterè®¾ç½®ã€‚å®Œæˆåˆå§‹åŒ–ã€‚</li><li>è®¾ç½®myidå’ŒQuorumPeerConfig</li></ol></li></ol><h3 id="8-2-4-è¿‡æœŸå¿«ç…§åˆ é™¤">8.2.4  è¿‡æœŸå¿«ç…§åˆ é™¤</h3><p>å¯ä»¥å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œå¯¹è¿‡æœŸçš„å¿«ç…§ï¼Œæ‰§è¡Œåˆ é™¤ã€‚é»˜è®¤è¯¥åŠŸèƒ½æ—¶å…³é—­çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initializeAndRun</span><span class="hljs-params">(String[] args)</span></span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> ConfigException, IOException, AdminServerException</span><br><span class="hljs-function">    </span>&#123;<br>        QuorumPeerConfig config = <span class="hljs-keyword">new</span> QuorumPeerConfig();<br>        <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">1</span>) &#123;<br>            config.parse(args[<span class="hljs-number">0</span>]);<br>        &#125;<br><br>        <span class="hljs-comment">// å¯åŠ¨å®šæ—¶ä»»åŠ¡</span><br>        DatadirCleanupManager purgeMgr = <span class="hljs-keyword">new</span> DatadirCleanupManager(config<br>                .getDataDir(), config.getDataLogDir(), config<br>                .getSnapRetainCount(), config.getPurgeInterval());<br>        purgeMgr.start();<br><br>        <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">1</span> &amp;&amp; config.isDistributed()) &#123;<br>            runFromConfig(config);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            LOG.warn(<span class="hljs-string">&quot;Either no config or no quorum defined in config, running &quot;</span><br>                    + <span class="hljs-string">&quot; in standalone mode&quot;</span>);<br>            <span class="hljs-comment">// there is only server in the quorum -- run as standalone</span><br>            ZooKeeperServerMain.main(args);<br>        &#125;<br>    &#125;<br><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">int</span> snapRetainCount = <span class="hljs-number">3</span>; <br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">int</span> purgeInterval = <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029105415327.png" class="" title="image-20211029105415327"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (PurgeTaskStatus.STARTED == purgeTaskStatus) &#123;<br>            LOG.warn(<span class="hljs-string">&quot;Purge task is already running.&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>   <span class="hljs-comment">// //  é»˜è®¤æƒ…å†µ  purgeInterval=0ï¼Œè¯¥ä»»åŠ¡å…³é—­ï¼Œç›´æ¥è¿”å›</span><br>        <span class="hljs-comment">// Don&#x27;t schedule the purge task with zero or negative purge interval.</span><br>        <span class="hljs-keyword">if</span> (purgeInterval &lt;= <span class="hljs-number">0</span>) &#123;<br>            LOG.info(<span class="hljs-string">&quot;Purge task is not scheduled.&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><span class="hljs-comment">//  åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨</span><br>        timer = <span class="hljs-keyword">new</span> Timer(<span class="hljs-string">&quot;PurgeTask&quot;</span>, <span class="hljs-keyword">true</span>);<br>   <span class="hljs-comment">//  åˆ›å»ºä¸€ä¸ªæ¸…ç†å¿«ç…§ä»»åŠ¡</span><br>        TimerTask task = <span class="hljs-keyword">new</span> PurgeTask(dataLogDir, snapDir, snapRetainCount);<br>   <span class="hljs-comment">//  å¦‚æœ  purgeInterval è®¾ç½®çš„å€¼æ˜¯ 1ï¼Œè¡¨ç¤º  1 å°æ—¶æ£€æŸ¥ä¸€æ¬¡ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è¿‡æœŸå¿«ç…§ï¼Œ æœ‰åˆ™åˆ é™¤</span><br>        timer.scheduleAtFixedRate(task, <span class="hljs-number">0</span>, TimeUnit.HOURS.toMillis(purgeInterval));<br><br>        purgeTaskStatus = PurgeTaskStatus.STARTED;<br>    &#125;<br><br> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PurgeTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TimerTask</span> </span>&#123;<br>        <span class="hljs-keyword">private</span> File logsDir;<br>        <span class="hljs-keyword">private</span> File snapsDir;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> snapRetainCount;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PurgeTask</span><span class="hljs-params">(File dataDir, File snapDir, <span class="hljs-keyword">int</span> count)</span> </span>&#123;<br>            logsDir = dataDir;<br>            snapsDir = snapDir;<br>            snapRetainCount = count;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>          <span class="hljs-comment">//  æ¸…ç†è¿‡æœŸçš„æ•°æ®</span><br>            LOG.info(<span class="hljs-string">&quot;Purge task started.&quot;</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                PurgeTxnLog.purge(logsDir, snapsDir, snapRetainCount);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                LOG.error(<span class="hljs-string">&quot;Error occurred while purging.&quot;</span>, e);<br>            &#125;<br>            LOG.info(<span class="hljs-string">&quot;Purge task completed.&quot;</span>);<br>        &#125;<br>    &#125;<br><br><span class="hljs-comment">//PurgeTxnLogç±»ä¸­çš„æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">purge</span><span class="hljs-params">(File dataDir, File snapDir, <span class="hljs-keyword">int</span> num)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-keyword">if</span> (num &lt; <span class="hljs-number">3</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(COUNT_ERR_MSG);<br>        &#125;<br><br>        FileTxnSnapLog txnLog = <span class="hljs-keyword">new</span> FileTxnSnapLog(dataDir, snapDir);<br><br>        List&lt;File&gt; snaps = txnLog.findNRecentSnapshots(num);<br>        <span class="hljs-keyword">int</span> numSnaps = snaps.size();<br>        <span class="hljs-keyword">if</span> (numSnaps &gt; <span class="hljs-number">0</span>) &#123;<br>            purgeOlderSnapshots(txnLog, snaps.get(numSnaps - <span class="hljs-number">1</span>));<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="8-2-5-åˆå§‹åŒ–é€šä¿¡ç»„ä»¶">8.2.5  åˆå§‹åŒ–é€šä¿¡ç»„ä»¶</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029105918689.png" class="" title="image-20211029105918689"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029105934464.png" class="" title="image-20211029105934464"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029105954513.png" class="" title="image-20211029105954513"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029110018034.png" class="" title="image-20211029110018034"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211029110033262.png" class="" title="image-20211029110033262"><h2 id="8-3-ZK-æœåŠ¡ç«¯åŠ è½½æ•°æ®æºç è§£æ">8.3 ZK æœåŠ¡ç«¯åŠ è½½æ•°æ®æºç è§£æ</h2><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030212621640.png" class="" title="image-20211030212621640"><ol><li>zk ä¸­çš„æ•°æ®æ¨¡å‹ï¼Œæ˜¯ä¸€æ£µæ ‘ï¼ŒDataTreeï¼Œæ¯ä¸ªèŠ‚ç‚¹ï¼Œå«åš DataNode</li><li>zk é›†ç¾¤ä¸­çš„ DataTree æ—¶åˆ»ä¿æŒçŠ¶æ€åŒæ­¥</li><li>Zookeeper é›†ç¾¤ä¸­æ¯ä¸ª zk èŠ‚ç‚¹ä¸­ï¼Œæ•°æ®åœ¨å†…å­˜å’Œç£ç›˜ä¸­éƒ½æœ‰ä¸€ä»½å®Œæ•´çš„æ•°æ®ã€‚<ol><li>å†…å­˜æ•°æ®ï¼šDataTree</li><li>ç£ç›˜æ•°æ®ï¼šå¿«ç…§æ–‡ä»¶   + ç¼–è¾‘æ—¥å¿—</li></ol></li></ol><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030212738023.png" class="" title="image-20211030212738023"><h3 id="8-3-1-å†·å¯åŠ¨æ•°æ®æ¢å¤å¿«ç…§æ•°æ®">8.3.1 å†·å¯åŠ¨æ•°æ®æ¢å¤å¿«ç…§æ•°æ®</h3><p>ï¼ˆ1ï¼‰ å¯åŠ¨é›†ç¾¤</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030212915995.png" class="" title="image-20211030212915995"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030212935913.png" class="" title="image-20211030212935913"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030212958876.png" class="" title="image-20211030212958876"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213013216.png" class="" title="image-20211030213013216"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213026552.png" class="" title="image-20211030213026552"><h3 id="8-3-2-å†·å¯åŠ¨æ¢å¤æ•°æ®">8.3.2 å†·å¯åŠ¨æ¢å¤æ•°æ®</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213100808.png" class="" title="image-20211030213100808"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213138996.png" class="" title="image-20211030213138996"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213227375.png" class="" title="image-20211030213227375"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213244097.png" class="" title="image-20211030213244097"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213258817.png" class="" title="image-20211030213258817"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213342877.png" class="" title="image-20211030213342877"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213357497.png" class="" title="image-20211030213357497"><h3 id="8-3-3-å†·å¯åŠ¨æ•°æ®æ¢å¤ç¼–è¾‘æ—¥å¿—">8.3.3  å†·å¯åŠ¨æ•°æ®æ¢å¤ç¼–è¾‘æ—¥å¿—</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213731826.png" class="" title="image-20211030213731826"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213748259.png" class="" title="image-20211030213748259"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213803310.png" class="" title="image-20211030213803310"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213907481.png" class="" title="image-20211030213907481"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030213920741.png" class="" title="image-20211030213920741"><h2 id="8-4-ZKé€‰ä¸¾æœºåˆ¶æºç è§£æ">8.4 ZKé€‰ä¸¾æœºåˆ¶æºç è§£æ</h2><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030214158626.png" class="" title="image-20211030214158626"><p>QuorumPeerç±»åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š1.å¿«é€Ÿé€‰ä¸¾é€‰æ‹©éƒ¨åˆ†ã€‚2.é€šä¿¡éƒ¨åˆ†</p><ol><li>é¦–å…ˆç”Ÿæˆé€‰ä¸¾ç®—æ³•ï¼ˆç”Ÿæˆ é€‰ç¥¨ï¼‰</li><li>å°†é€‰ç¥¨æ”¾å…¥åˆ°sendqueueä¸­ï¼ˆå‘é€é€‰ç¥¨ç¼“å†²æ± ï¼‰</li><li>é€šè¿‡WorkerSenderå¤„ç†é€‰ç¥¨ï¼Œå°†å…¶å‘é€ç»™é€šä¿¡éƒ¨åˆ†çš„recvQueue</li><li>å½“ZK2çš„sidæ¯”è‡ªå·±çš„sidå¤§çš„æ—¶å€™<ol><li>é€šè¿‡å¿«é€Ÿé€‰ä¸¾éƒ¨åˆ†çš„WorkerReceiverå°†é€‰ç¥¨æ”¾å…¥åˆ°recequeueä¸­ï¼ˆå¤„ç†æŠ•ç¥¨ç¼“å†²æ± ï¼‰</li><li>è¿›è¡Œé€‰ç¥¨ç”Ÿæˆå¹¶é€šè¿‡é€šä¿¡éƒ¨åˆ†çš„Listenerï¼ˆç›‘å¬å™¨ï¼‰çš„handleConnectionä¸­çš„queueSendMapä¸­é€‰æ‹©å‘é€ç»™çš„å¯¹åº”sidçš„æœåŠ¡å™¨ã€‚ç„¶åé€šè¿‡handleConnectionä¸­çš„SendWorkerMapè¿›è¡Œé€‰ç¥¨çš„æ¥æ”¶ä¸å‘é€ã€‚å®ç°ä¸å…¶ä»–èŠ‚ç‚¹è¿›è¡Œé€šä¿¡ã€‚</li></ol></li></ol><h3 id="8-4-1-é€‰ä¸¾å‡†å¤‡">8.4.1 é€‰ä¸¾å‡†å¤‡</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030214859394.png" class="" title="image-20211030214859394"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030214912240.png" class="" title="image-20211030214912240"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030214939573.png" class="" title="image-20211030214939573"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215014397.png" class="" title="image-20211030215014397"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215034395.png" class="" title="image-20211030215034395"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215046337.png" class="" title="image-20211030215046337"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215056946.png" class="" title="image-20211030215056946"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215107302.png" class="" title="image-20211030215107302"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215118265.png" class="" title="image-20211030215118265"><h3 id="8-4-2-é€‰ä¸¾æ‰§è¡Œ">8.4.2 é€‰ä¸¾æ‰§è¡Œ</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215249974.png" class="" title="image-20211030215249974"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215348106.png" class="" title="image-20211030215348106"><p>1ï¼‰æ‰§è¡Œ super.start();å°±ç›¸å½“äºæ‰§è¡Œ QuorumPeer.java ç±»ä¸­çš„  run()æ–¹æ³•</p><p>2ï¼‰å½“ Zookeeper å¯åŠ¨åï¼Œé¦–å…ˆéƒ½æ˜¯ Looking çŠ¶æ€ï¼Œé€šè¿‡é€‰ä¸¾ï¼Œè®©å…¶ä¸­ä¸€å°æœåŠ¡å™¨æˆä¸º Leaderï¼Œ å…¶ä»–çš„æœåŠ¡å™¨æˆä¸º Followerã€‚</p><p>QuorumPeer.javaç±»</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215429881.png" class="" title="image-20211030215429881"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215444136.png" class="" title="image-20211030215444136"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215459890.png" class="" title="image-20211030215459890"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215511802.png" class="" title="image-20211030215511802"><p>2ï¼‰ctrl+alt+b ç‚¹å‡» lookForLeader()çš„å®ç°ç±» FastLeaderElection.java</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215529162.png" class="" title="image-20211030215529162"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215542587.png" class="" title="image-20211030215542587"><p>3ï¼‰ç‚¹å‡» sendNotificationsï¼Œå¹¿æ’­é€‰ç¥¨ï¼ŒæŠŠè‡ªå·±çš„é€‰ç¥¨å‘ç»™å…¶ä»–æœåŠ¡å™¨</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215600689.png" class="" title="image-20211030215600689"><p>4ï¼‰åœ¨ FastLeaderElection.java ç±»ä¸­æŸ¥æ‰¾ WorkerSender çº¿ç¨‹ã€‚</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215625746.png" class="" title="image-20211030215625746"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215638853.png" class="" title="image-20211030215638853"><p>5ï¼‰å¦‚æœæ•°æ®æ˜¯å‘é€ç»™è‡ªå·±çš„ï¼Œæ·»åŠ åˆ°è‡ªå·±çš„æ¥æ”¶é˜Ÿåˆ—</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215654633.png" class="" title="image-20211030215654633"><p>6ï¼‰æ•°æ®æ·»åŠ åˆ°å‘é€é˜Ÿåˆ—</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215710145.png" class="" title="image-20211030215710145"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215722219.png" class="" title="image-20211030215722219"><p>7ï¼‰ä¸è¦å‘é€çš„æœåŠ¡å™¨èŠ‚ç‚¹å»ºç«‹é€šä¿¡è¿æ¥</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215741633.png" class="" title="image-20211030215741633"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215802592.png" class="" title="image-20211030215802592"><p>8ï¼‰åˆ›å»ºå¹¶å¯åŠ¨å‘é€å™¨çº¿ç¨‹å’Œæ¥æ”¶å™¨çº¿ç¨‹</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215821268.png" class="" title="image-20211030215821268"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215833919.png" class="" title="image-20211030215833919"><p>9ï¼‰ç‚¹å‡» SendWorkerï¼Œå¹¶æŸ¥æ‰¾è¯¥ç±»ä¸‹çš„ run æ–¹æ³•</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215852138.png" class="" title="image-20211030215852138"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215902615.png" class="" title="image-20211030215902615"><p>10ï¼‰ç‚¹å‡» RecvWorkerï¼Œå¹¶æŸ¥æ‰¾è¯¥ç±»ä¸‹çš„ run æ–¹æ³•</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215920441.png" class="" title="image-20211030215920441"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215931808.png" class="" title="image-20211030215931808"><p>11ï¼‰åœ¨  FastLeaderElection.java ç±»ä¸­æŸ¥æ‰¾ WorkerReceiver çº¿ç¨‹ã€‚</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215947280.png" class="" title="image-20211030215947280"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030215957762.png" class="" title="image-20211030215957762"><h2 id="8-5-Follower-å’Œ-Leader-çŠ¶æ€åŒæ­¥æºç ">8.5 Follower å’Œ  Leader çŠ¶æ€åŒæ­¥æºç </h2><p>å½“é€‰ä¸¾ç»“æŸåï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æ ¹æ®è‡ªå·±çš„è§’è‰²æ›´æ–°è‡ªå·±çš„çŠ¶æ€ã€‚é€‰ä¸¾å‡ºçš„  Leader æ›´ æ–°è‡ªå·±çŠ¶æ€ä¸º Leaderï¼Œå…¶ä»–èŠ‚ç‚¹æ›´æ–°è‡ªå·±çŠ¶æ€ä¸º  Followerã€‚<br>Leader æ›´æ–°çŠ¶æ€å…¥å£ï¼šleader.lead()<br>Follower æ›´æ–°çŠ¶æ€å…¥å£ï¼šfollower.followerLeader()</p><p>æ³¨æ„ï¼š</p><p>ï¼ˆ1ï¼‰follower å¿…é¡»è¦è®©  leader çŸ¥é“è‡ªå·±çš„çŠ¶æ€ï¼šepochã€zxidã€sid å¿…é¡»è¦æ‰¾å‡ºè°æ˜¯ leaderï¼›<br>å‘èµ·è¯·æ±‚è¿æ¥ leaderï¼› å‘é€è‡ªå·±çš„ä¿¡æ¯ç»™ leaderï¼›<br>leader æ¥æ”¶åˆ°ä¿¡æ¯ï¼Œå¿…é¡»è¦è¿”å›å¯¹åº”çš„ä¿¡æ¯ç»™ followerã€‚<br>ï¼ˆ2ï¼‰å½“ leaderå¾—çŸ¥ followerçš„çŠ¶æ€äº†ï¼Œå°±ç¡®å®šéœ€è¦åšä½•ç§æ–¹å¼çš„æ•°æ®åŒæ­¥ DIFFã€TRUNCã€SNAP<br>ï¼ˆ3ï¼‰æ‰§è¡Œæ•°æ®åŒæ­¥<br>ï¼ˆ4ï¼‰å½“  leader æ¥æ”¶åˆ°è¶…è¿‡åŠæ•°  follower çš„  ack ä¹‹åï¼Œè¿›å…¥æ­£å¸¸å·¥ä½œçŠ¶æ€ï¼Œé›†ç¾¤å¯åŠ¨å®Œæˆäº†ã€‚</p><p>æœ€ç»ˆæ€»ç»“åŒæ­¥çš„æ–¹å¼ï¼š<br>ï¼ˆ1ï¼‰DIFF å’±ä¸¤ä¸€æ ·ï¼Œä¸éœ€è¦åšä»€ä¹ˆ<br>ï¼ˆ2ï¼‰TRUNC follower çš„ zxid æ¯”  leader çš„  zxid å¤§ï¼Œæ‰€ä»¥  Follower è¦å›æ»š<br>ï¼ˆ3ï¼‰COMMIT leader çš„ zxid æ¯”  follower çš„  zxid å¤§ï¼Œå‘é€  Proposal ç»™ foloower æäº¤æ‰§è¡Œ<br>ï¼ˆ4ï¼‰å¦‚æœ  follower å¹¶æ²¡æœ‰ä»»ä½•æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨  SNAP çš„æ–¹å¼æ¥æ‰§è¡Œæ•°æ®åŒæ­¥ï¼ˆç›´æ¥æŠŠæ•°æ®å…¨éƒ¨åºåˆ—åˆ° followerï¼‰</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220245513.png" class="" title="image-20211030220245513"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220257505.png" class="" title="image-20211030220257505"><h3 id="8-5-1-Leader-lead-ç­‰å¾…æ¥æ”¶-follower-çš„çŠ¶æ€åŒæ­¥ç”³è¯·">8.5.1 Leader.lead()ç­‰å¾…æ¥æ”¶ follower çš„çŠ¶æ€åŒæ­¥ç”³è¯·</h3><p>1ï¼‰åœ¨ Leader.java ç§æŸ¥æ‰¾  lead()æ–¹æ³•</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220621010.png" class="" title="image-20211030220621010"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220645569.png" class="" title="image-20211030220645569"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220658893.png" class="" title="image-20211030220658893"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220709319.png" class="" title="image-20211030220709319"><p>å…¶ä¸­  ss çš„åˆå§‹åŒ–æ˜¯åœ¨åˆ›å»º Leader å¯¹è±¡æ—¶ï¼Œåˆ›å»ºçš„  socket</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220731560.png" class="" title="image-20211030220731560"><h3 id="8-5-2-Follower-lead-æŸ¥æ‰¾å¹¶è¿æ¥-Leader">8.5.2 Follower.lead()æŸ¥æ‰¾å¹¶è¿æ¥ Leader</h3><p>1ï¼‰åœ¨ Follower.java ç§æŸ¥æ‰¾  followLeader()æ–¹æ³•</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220802936.png" class="" title="image-20211030220802936"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220816526.png" class="" title="image-20211030220816526"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220828497.png" class="" title="image-20211030220828497"><h3 id="8-5-3-Leader-lead-åˆ›å»º-LearnerHandler">8.5.3 Leader.lead()åˆ›å»º LearnerHandler</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220853998.png" class="" title="image-20211030220853998"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220904550.png" class="" title="image-20211030220904550"><p>ç”±äº  public class LearnerHandler extends ZooKeeperThread{}ï¼Œè¯´æ˜ LearnerHandler æ˜¯ä¸€ ä¸ªçº¿ç¨‹ã€‚æ‰€ä»¥ fh.start()æ‰§è¡Œçš„æ˜¯  LearnerHandler ä¸­çš„  run()æ–¹æ³•ã€‚</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220921577.png" class="" title="image-20211030220921577"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220933993.png" class="" title="image-20211030220933993"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220945549.png" class="" title="image-20211030220945549"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030220956473.png" class="" title="image-20211030220956473"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221007757.png" class="" title="image-20211030221007757"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221018867.png" class="" title="image-20211030221018867"><h3 id="8-5-4-Follower-lead-åˆ›å»º-registerWithLeader">8.5.4 Follower.lead()åˆ›å»º registerWithLeader</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221045608.png" class="" title="image-20211030221045608"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221057508.png" class="" title="image-20211030221057508"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221109212.png" class="" title="image-20211030221109212"><h3 id="8-5-5-Leader-lead-æ¥æ”¶-Follwer-çŠ¶æ€ï¼Œæ ¹æ®åŒæ­¥æ–¹å¼å‘é€åŒæ­¥æ¶ˆæ¯">8.5.5 Leader.lead()æ¥æ”¶ Follwer çŠ¶æ€ï¼Œæ ¹æ®åŒæ­¥æ–¹å¼å‘é€åŒæ­¥æ¶ˆæ¯</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221133892.png" class="" title="image-20211030221133892"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221147124.png" class="" title="image-20211030221147124"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221200410.png" class="" title="image-20211030221200410"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221213079.png" class="" title="image-20211030221213079"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221224433.png" class="" title="image-20211030221224433"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221235376.png" class="" title="image-20211030221235376"><h3 id="8-5-6-Follower-lead-åº”ç­”-Leader-åŒæ­¥ç»“æœ">8.5.6 Follower.lead()åº”ç­” Leader åŒæ­¥ç»“æœ</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221302556.png" class="" title="image-20211030221302556"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221313344.png" class="" title="image-20211030221313344"><h3 id="8-5-7-Leader-lead-åº”ç­”-Follower">8.5.7 Leader.lead()åº”ç­” Follower</h3><p>ç”±äº  public class LearnerHandler extends ZooKeeperThread{}ï¼Œè¯´æ˜ LearnerHandler æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚æ‰€ä»¥ fh.start()æ‰§è¡Œçš„æ˜¯  LearnerHandler ä¸­çš„  run()æ–¹æ³•ã€‚</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221456812.png" class="" title="image-20211030221456812"><h2 id="8-6-æœåŠ¡ç«¯-Leader-å¯åŠ¨">8.6 æœåŠ¡ç«¯  Leader å¯åŠ¨</h2><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221600403.png" class="" title="image-20211030221600403"><p>Leader.java</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221630700.png" class="" title="image-20211030221630700"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221641139.png" class="" title="image-20211030221641139"><p>LeaderZooKeeperServer.java</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221716803.png" class="" title="image-20211030221716803"><p>ZookeeperServer.java</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221732734.png" class="" title="image-20211030221732734"><p>ç‚¹å‡»  PrepRequestProcessorï¼Œå¹¶æŸ¥æ‰¾å®ƒçš„  run æ–¹æ³•</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221755242.png" class="" title="image-20211030221755242"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221814625.png" class="" title="image-20211030221814625"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221826191.png" class="" title="image-20211030221826191"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221840829.png" class="" title="image-20211030221840829"><h2 id="8-7-æœåŠ¡ç«¯-Follower-å¯åŠ¨">8.7 æœåŠ¡ç«¯  Follower å¯åŠ¨</h2><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221913656.png" class="" title="image-20211030221913656"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221935387.png" class="" title="image-20211030221935387"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030221950327.png" class="" title="image-20211030221950327"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222000679.png" class="" title="image-20211030222000679"><h2 id="8-8-å®¢æˆ·ç«¯å¯åŠ¨">8.8 å®¢æˆ·ç«¯å¯åŠ¨</h2><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222020324.png" class="" title="image-20211030222020324"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222208842.png" class="" title="image-20211030222208842"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222224429.png" class="" title="image-20211030222224429"><p>åœ¨ <a href="http://ZkCli.sh">ZkCli.sh</a> å¯åŠ¨ Zookeeper æ—¶ï¼Œä¼šè°ƒç”¨ ZooKeeperMain.java Ctrl + n  æŸ¥æ‰¾ ZooKeeperMainï¼Œæ‰¾åˆ°ç¨‹åºçš„å…¥å£ main()æ–¹æ³•</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222247705.png" class="" title="image-20211030222247705"><h3 id="8-8-1-åˆ›å»º-ZookeeperMain">8.8.1  åˆ›å»º  ZookeeperMain</h3><p>è¿æ¥  zk</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222326239.png" class="" title="image-20211030222326239"><p>åˆ›å»º ZooKeeperAdmin å¯¹è±¡</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222349163.png" class="" title="image-20211030222349163"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222400599.png" class="" title="image-20211030222400599"><h3 id="8-8-2-åˆå§‹åŒ–ç›‘å¬å™¨">8.8.2  åˆå§‹åŒ–ç›‘å¬å™¨</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222428088.png" class="" title="image-20211030222428088"><h3 id="8-8-3-è§£æè¿æ¥åœ°å€">8.8.3  è§£æè¿æ¥åœ°å€</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222455728.png" class="" title="image-20211030222455728"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222514022.png" class="" title="image-20211030222514022"><h3 id="8-8-4-åˆ›å»ºé€šä¿¡">8.8.4  åˆ›å»ºé€šä¿¡</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222550649.png" class="" title="image-20211030222550649"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222608264.png" class="" title="image-20211030222608264"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222623896.png" class="" title="image-20211030222623896"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222641142.png" class="" title="image-20211030222641142"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222656757.png" class="" title="image-20211030222656757"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222708109.png" class="" title="image-20211030222708109"><p>ctrl + alt +B  æŸ¥æ‰¾  connect å®ç°ç±»ï¼ŒClientCnxnSocketNIO.java</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222833428.png" class="" title="image-20211030222833428"><p>ctrl + alt +B  æŸ¥æ‰¾  doTransport å®ç°ç±»ï¼ŒClientCnxnSocketNIO.java</p><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222854939.png" class="" title="image-20211030222854939"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222908968.png" class="" title="image-20211030222908968"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222922391.png" class="" title="image-20211030222922391"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030222932871.png" class="" title="image-20211030222932871"><h3 id="8-8-5-æ‰§è¡Œ-run">8.8.5  æ‰§è¡Œ  run()</h3><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030223009732.png" class="" title="image-20211030223009732"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030223023920.png" class="" title="image-20211030223023920"><img src="/dajiangdahe.github.io/2021/10/23/zookeeper%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/image-20211030223036400.png" class="" title="image-20211030223036400">]]></content>
    
    
    <categories>
      
      <category>Zookeeper</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zookeeper</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonæš´åŠ›ç ´è§£å‹ç¼©åŒ…</title>
    <link href="/dajiangdahe/2021/10/22/%E7%A0%B4%E8%A7%A3%E5%8E%8B%E7%BC%A9%E5%8C%85/"/>
    <url>/dajiangdahe/2021/10/22/%E7%A0%B4%E8%A7%A3%E5%8E%8B%E7%BC%A9%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h1>1.Macç ´è§£zipå‹ç¼©åŒ…</h1><h5 id="ä½¿ç”¨fcrackzipæ¥ç ´è§£zipç±»å‹å‹ç¼©æ–‡ä»¶">ä½¿ç”¨fcrackzipæ¥ç ´è§£zipç±»å‹å‹ç¼©æ–‡ä»¶</h5><p>fcrackzipæ˜¯ä¸€æ¬¾ä¸“é—¨ç ´è§£zipç±»å‹å‹ç¼©æ–‡ä»¶å¯†ç çš„å·¥å…·ï¼Œå·¥å…·ç ´è§£é€Ÿåº¦è¿˜æ˜¯å¯ä»¥çš„ï¼Œèƒ½ç”¨å­—å…¸å’ŒæŒ‡å®šå­—ç¬¦é›†ç ´è§£ï¼Œé€‚ç”¨äºLinuxã€Mac OS ç³»ç»Ÿã€‚</p><h6 id="å¦‚æœä½ çš„ç”µè„‘æ²¡æœ‰å®‰è£…brewï¼Œéœ€è¦æ‰§è¡Œä¸‹é¢å‘½ä»¤è¡Œ"><strong>å¦‚æœä½ çš„ç”µè„‘æ²¡æœ‰å®‰è£…brewï¼Œéœ€è¦æ‰§è¡Œä¸‹é¢å‘½ä»¤è¡Œ</strong></h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; <br></code></pre></td></tr></table></figure><h5 id="å®‰è£…fcrackzip">å®‰è£…fcrackzip</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">brew install fcrackzip<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨-fcrackzip-hæ¥æŸ¥çœ‹ç›¸å…³å‘½ä»¤å¸®åŠ©">ä½¿ç”¨ <code>fcrackzip -h</code>æ¥æŸ¥çœ‹ç›¸å…³å‘½ä»¤å¸®åŠ©</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell">fcrackzip version 1.0, a fast/free zip password cracker<br>written by Marc Lehmann &lt;pcg@goof.com&gt; You can find more info on<br>http://www.goof.com/pcg/marc/<br><br>USAGE: fcrackzip<br>          [-b|--brute-force]            use brute force algorithm<br>          [-D|--dictionary]             use a dictionary<br>          [-B|--benchmark]              execute a small benchmark<br>          [-c|--charset characterset]   use characters from charset<br>          [-h|--help]                   show this message<br>          [--version]                   show the version of this program<br>          [-V|--validate]               sanity-check the algortihm<br>          [-v|--verbose]                be more verbose<br>          [-p|--init-password string]   use string as initial password/file<br>          [-l|--length min-max]         check password with length min to max<br>          [-u|--use-unzip]              use unzip to weed out wrong passwords<br>          [-m|--method num]             use method number &quot;num&quot; (see below)<br>          [-2|--modulo r/m]             only calculcate 1/m of the password<br>          file...                    the zipfiles to crack<br><br>methods compiled in (* = default):<br><br> 0: cpmask<br> 1: zip1<br>*2: zip2, USE_MULT_TAB<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">c æŒ‡å®šå­—ç¬¦é›†ï¼Œå­—ç¬¦é›† æ ¼å¼æ˜¯ -c &#x27;aA1!:&#x27;<br>è¡¨ç¤ºå°å†™å­—æ¯ a-z<br>è¡¨ç¤ºå¤§å†™å­—æ¯ A-Z<br>è¡¨ç¤ºæ•°å­— 0-9<br>æ„Ÿå¹å·è¡¨ç¤ºç‰¹æ®Šå­—ç¬¦ !:$%&amp;/()=?&#123;&#125;[]+*~#<br>è¡¨ç¤ºåŒ…å«å†’å·ä¹‹åçš„å­—ç¬¦ï¼ˆä¸èƒ½ä¸ºäºŒè¿›åˆ¶çš„ç©ºå­—ç¬¦ï¼‰ä¾‹å¦‚  a1:$%  è¡¨ç¤º å­—ç¬¦é›†åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€$å­—ç¬¦å’Œ%ç™¾åˆ†å·<br></code></pre></td></tr></table></figure><h5 id="å°è¯•ç ´è§£">å°è¯•ç ´è§£</h5><p>æœ‰ä¸€ä¸ªæ–‡ä»¶åå«<code>doubi.zip</code>ï¼Œå¯†ç ä¸ºdoubiçš„å¼±å¯†ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">// å…ˆè¦cdåˆ°æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹ä½ç½®<br>fcrackzip -b -c &#x27;aA1!&#x27; -l 1-10 -u doubi.zip<br>PASSWORD FOUND!!!!: pw == doubi<br>// å‚æ•°<br>-b è¡¨ç¤ºä½¿ç”¨æš´åŠ›ç ´è§£çš„æ–¹å¼<br>-c &#x27;aA1!&#x27; è¡¨ç¤ºä½¿ç”¨å¤§å°å†™å­—æ¯åŠ æ•°å­—å’Œç¬¦å·çš„æ··åˆç ´è§£æ–¹å¼<br>-l 1-10 è¡¨ç¤ºéœ€è¦ç ´è§£çš„å¯†ç é•¿åº¦1åˆ°10ä½<br>-u è¡¨ç¤ºåªæ˜¾ç¤ºç ´è§£å‡ºæ¥çš„å¯†ç ï¼Œå…¶ä»–é”™è¯¯çš„å¯†ç ä¸æ˜¾ç¤º<br></code></pre></td></tr></table></figure><h5 id="å¯ä»¥ä½¿ç”¨å­—å…¸ç ´è§£">å¯ä»¥ä½¿ç”¨å­—å…¸ç ´è§£</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">fcrackzip -D -p pwd.txt -u doubi.zip<br>PASSWORD FOUND!!!!: pw == doubi<br>// å‚æ•°<br>-D è¡¨ç¤ºè¦ä½¿ç”¨å­—å…¸ç ´è§£<br>-p è¡¨ç¤ºè¦ä½¿ç”¨å“ªä¸ªå­—å…¸ç ´è§£<br></code></pre></td></tr></table></figure><h1>2.Macç ´è§£rarå‹ç¼©åŒ…</h1><p>æ‰¾äº†åŠå¤©æ²¡æœ‰æ‰¾åˆ°å¥½ç”¨çš„rarå‹ç¼©åŒ…çš„ç ´è§£è½¯ä»¶ä»¥åŠç ´è§£æ–¹æ³•ï¼Œæœ€åæ‰¾åˆ°äº†ä¸€ä¸ªäº²æµ‹å¯è¡Œçš„æš´åŠ›ç ´è§£ç¨‹åº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> rarfile<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> sys<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyIterator</span>():</span><br>    letters = <span class="hljs-string">&#x27;`1234567890-=/*-qwertyuiop[]\|asdfghjkl;zxcvbnm,.?&gt;&lt;&#123;&#125;:QERWTYUIOPLKJHGFDSAZXCVBNM!@#$%^&amp;*()+&#x27;</span>  <span class="hljs-comment"># é”®ç›˜ä¸Šæ‰€æœ‰å¯èƒ½è¾“å…¥çš„å­—ç¬¦</span><br>    min_digits = <span class="hljs-number">0</span><br>    max_digits = <span class="hljs-number">0</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, min_digits, max_digits</span>):</span><br>        <span class="hljs-keyword">if</span> min_digits &lt; max_digits:<br>            self.min_digits = min_digits<br>            self.max_digits = max_digits<br>        <span class="hljs-keyword">else</span>:<br>            self.min_digits = max_digits<br>            self.max_digits = min_digits<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__iter__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__next__</span>(<span class="hljs-params">self</span>):</span><br>        rst = <span class="hljs-built_in">str</span>()<br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, random.randrange(self.min_digits, self.max_digits + <span class="hljs-number">1</span>)):<br>            rst += random.choice(MyIterator.letters)<br>        <span class="hljs-keyword">return</span> rst<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract</span>(<span class="hljs-params">path</span>):</span><br>    start_time = time.time()<br>    zfile = rarfile.RarFile(path)<br>    <span class="hljs-comment"># è§£å‹æ–‡ä»¶åœ°å€</span><br><br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> MyIterator(<span class="hljs-number">4</span>, <span class="hljs-number">10</span>):  <span class="hljs-comment"># 4åˆ°10ä½å¯†ç </span><br>        <span class="hljs-keyword">try</span>:<br>            zfile.extractall(path=<span class="hljs-string">&quot;.&quot;</span>, pwd=<span class="hljs-built_in">str</span>(p).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>            <span class="hljs-comment"># æ–‡ä»¶åœ°å€è¿™é‡Œç”¨.ä»£è¡¨ä¸Šè¿°zfileåœ°å€</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;the password is &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(p))<br>            now_time = time.time()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;spend time is &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(now_time - start_time))<br>            sys.exit(<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;error&#x27;</span>, p)<br>            <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    extract(<span class="hljs-string">&quot;/Users/guolonghang/Documents/kafka/kafka/è½¯ä»¶æ–‡æ¡£/è¯¾ç¨‹èµ„æ–™ï¼ˆ1ï¼‰.rar&quot;</span>)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è„šæœ¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç ´è§£å‹ç¼©åŒ…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ ¡æ‹›é«˜é¢‘ç®—æ³•</title>
    <link href="/dajiangdahe/2021/10/22/%E6%A0%A1%E6%8B%9B%E9%AB%98%E9%A2%91%E7%AE%97%E6%B3%95/"/>
    <url>/dajiangdahe/2021/10/22/%E6%A0%A1%E6%8B%9B%E9%AB%98%E9%A2%91%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1>1.äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾</h1><p><a href="https://www.nowcoder.com/practice/abc3fe2ce8e146608e868a70efebf62e?tpId=13&amp;&amp;tqId=11154&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/abc3fe2ce8e146608e868a70efebf62e?tpId=13&amp;&amp;tqId=11154&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç±»ä¼¼äºäºŒå‰æ ‘çš„æ€æƒ³ï¼Œä»å³ä¸Šè§’å¼€å§‹è¿›è¡ŒæŸ¥æ‰¾,æ—¶é—´å¤æ‚åº¦ä¸ºo(n+n)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">Find</span><span class="hljs-params">(<span class="hljs-keyword">int</span> target, <span class="hljs-keyword">int</span> [][] array)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(array.length==<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">int</span> j=array[<span class="hljs-number">0</span>].length-<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span>(i&lt;array.length&amp;&amp;j&gt;=<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">if</span>(array[i][j]&gt;target)&#123;<br>                j--;<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(array[i][j]&lt;target)&#123;<br>                i++;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(i&gt;=array.length||j&lt;<span class="hljs-number">0</span>)&#123;<br>              <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;     <br>        <span class="hljs-keyword">if</span>(target==array[i][j])&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åœ¨æ¯ä¸€è½®éƒ½ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºo(nlgn * n)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">Find2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> target, <span class="hljs-keyword">int</span>[][] array)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (array.length==<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; array[<span class="hljs-number">0</span>].length; i++) &#123;<br>            <span class="hljs-keyword">if</span> (search(array[i],target,<span class="hljs-number">0</span>,array[<span class="hljs-number">0</span>].length-<span class="hljs-number">1</span>)==target)&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums,<span class="hljs-keyword">int</span> target,<span class="hljs-keyword">int</span> low,<span class="hljs-keyword">int</span> high)</span></span>&#123;<br>        <span class="hljs-keyword">int</span> left = low;<br>        <span class="hljs-keyword">int</span> right = high;<br>        <span class="hljs-keyword">while</span> (left&lt;=right)&#123;<br>            <span class="hljs-keyword">int</span> mid = (left+right);<br>            <span class="hljs-keyword">if</span> (nums[mid]&gt;target)&#123;<br>                right = mid-<span class="hljs-number">1</span>;<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nums[mid]&lt;target)&#123;<br>                left = mid+<span class="hljs-number">1</span>;<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> mid;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> right;<br>    &#125;<br></code></pre></td></tr></table></figure><h1>2.æ›¿æ¢ç©ºæ ¼</h1><p><a href="https://www.nowcoder.com/practice/4060ac7e3e404ad1a894ef3e17650423?tpId=13&amp;&amp;tqId=11155&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/4060ac7e3e404ad1a894ef3e17650423?tpId=13&amp;&amp;tqId=11155&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">replaceSpace</span><span class="hljs-params">(StringBuffer str)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> str.toString().replace(<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;%20&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1>3.ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨</h1><p><a href="https://www.nowcoder.com/practice/d0267f7f55b3412ba93bd35cfa8e8035?tpId=13&amp;&amp;tqId=11156&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/d0267f7f55b3412ba93bd35cfa8e8035?tpId=13&amp;&amp;tqId=11156&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> ArrayList&lt;Integer&gt; <span class="hljs-title">printListFromTailToHead</span><span class="hljs-params">(ListNode listNode)</span> </span>&#123;<br>       ArrayList&lt;Integer&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;Integer&gt;();<br>       ListNode temp = listNode;<br>       <span class="hljs-keyword">while</span> (temp != <span class="hljs-keyword">null</span>) &#123;<br>           res.add(temp.val);<br>           temp = temp.next;<br>       &#125;<br><br>       Collections.reverse(res);<br>       <span class="hljs-keyword">return</span> res;<br>   &#125;<br></code></pre></td></tr></table></figure><h1>4.æ ¹æ®å‰åºéå†å’Œä¸­åºéå†é‡å»ºäºŒå‰æ ‘</h1><p><a href="https://www.nowcoder.com/practice/8a19cbe657394eeaac2f6ea9b0f6fcf6?tpId=13&amp;&amp;tqId=11157&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/8a19cbe657394eeaac2f6ea9b0f6fcf6?tpId=13&amp;&amp;tqId=11157&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><p>1ã€å…ˆåºéå†çš„ç»“æœä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä¸€å®šæ˜¯æ ¹èŠ‚ç‚¹<br>2ã€å…ˆåºéå†ç»“æœ= æ ¹èŠ‚ç‚¹+å·¦å­æ ‘å…ˆåºç»“æ„+å³å­æ ‘å…ˆåºç»“æœ<br>3ã€ä¸­åºéå†ç»“æœ= å·¦å­æ ‘çš„ä¸­åºç»“æœ+æ ¹èŠ‚ç‚¹+å³å­æ ‘çš„ä¸­åºç»“æœ</p><img src="/dajiangdahe.github.io/2021/10/22/%E6%A0%A1%E6%8B%9B%E9%AB%98%E9%A2%91%E7%AE%97%E6%B3%95/20200427152711770.png" class="" title="é‡å»ºäºŒå‰æ ‘"><p><strong>æ ¹æ®ä¸Šå›¾ï¼Œ3ä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ ¹æ®ä¸­åºéå†9æ˜¯3çš„å·¦å­æ ‘è€Œä¸”åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…ˆåºä¸­9åé¢çš„20å°±æ˜¯3çš„å³å­æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œç„¶åå†çœ‹ä¸­åºéå†ï¼Œ15åœ¨20çš„å·¦ä¾§7åœ¨20å³ä¾§ï¼Œå¾—15æ˜¯20çš„å·¦å­æ ‘7æ˜¯20çš„å³å­æ ‘ã€‚æœ€åæ„å»ºå‡ºçš„æ ‘å¦‚ä¸‹å›¾ï¼š</strong></p><img src="/dajiangdahe.github.io/2021/10/22/%E6%A0%A1%E6%8B%9B%E9%AB%98%E9%A2%91%E7%AE%97%E6%B3%95/20200427153240659.png" class=""><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> TreeNode <span class="hljs-title">myBuildTree</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] preorder, <span class="hljs-keyword">int</span>[] inorder, <span class="hljs-keyword">int</span> preorder_left, <span class="hljs-keyword">int</span> preorder_right, <span class="hljs-keyword">int</span> inorder_left, <span class="hljs-keyword">int</span> inorder_right)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (preorder_left &gt; preorder_right) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>        <span class="hljs-comment">//å‰åºéå†ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯æ ¹èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">int</span> preorder_root = preorder_left;<br>        <span class="hljs-comment">//åœ¨ä¸­åºéå†é‡Œå®šä½æ ¹èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">int</span> inorder_root = indexMap.get(preorder[preorder_root]);<br>        <span class="hljs-comment">//åˆ›å»ºæ ¹èŠ‚ç‚¹</span><br>        TreeNode root = <span class="hljs-keyword">new</span> TreeNode(preorder[preorder_root]);<br>        <span class="hljs-comment">//å¾—åˆ°å·¦å­æ ‘çš„ç»“ç‚¹ä¸ªæ•°</span><br>        <span class="hljs-keyword">int</span> size_left_subTree = inorder_root - inorder_left;<br>        <span class="hljs-comment">// é€’å½’åœ°æ„é€ å·¦å­æ ‘ï¼Œå¹¶è¿æ¥åˆ°æ ¹èŠ‚ç‚¹</span><br>        <span class="hljs-comment">// å…ˆåºéå†ä¸­ã€Œä» å·¦è¾¹ç•Œ+1 å¼€å§‹çš„ size_left_subtreeã€ä¸ªå…ƒç´ å°±å¯¹åº”äº†ä¸­åºéå†ä¸­ã€Œä» å·¦è¾¹ç•Œ å¼€å§‹åˆ° æ ¹èŠ‚ç‚¹å®šä½-1ã€çš„å…ƒç´ </span><br>        root.left = myBuildTree(preorder,inorder,preorder_left+<span class="hljs-number">1</span>,preorder_left+size_left_subTree,inorder_left,inorder_root-<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// é€’å½’åœ°æ„é€ å³å­æ ‘ï¼Œå¹¶è¿æ¥åˆ°æ ¹èŠ‚ç‚¹</span><br>        <span class="hljs-comment">// å…ˆåºéå†ä¸­ã€Œä» å·¦è¾¹ç•Œ+1+å·¦å­æ ‘èŠ‚ç‚¹æ•°ç›® å¼€å§‹åˆ° å³è¾¹ç•Œã€çš„å…ƒç´ å°±å¯¹åº”äº†ä¸­åºéå†ä¸­ã€Œä» æ ¹èŠ‚ç‚¹å®šä½+1 åˆ° å³è¾¹ç•Œã€çš„å…ƒç´ </span><br>        root.right = myBuildTree(preorder,inorder,preorder_left+size_left_subTree+<span class="hljs-number">1</span>,preorder_right,inorder_root+<span class="hljs-number">1</span>,inorder_right);<br>        <span class="hljs-keyword">return</span> root;<br>    &#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> TreeNode <span class="hljs-title">buildTree</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] preorder, <span class="hljs-keyword">int</span>[] inorder)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> n = preorder.length;<br>        <span class="hljs-comment">// æ„é€ å“ˆå¸Œæ˜ å°„ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½æ ¹èŠ‚ç‚¹</span><br>        indexMap = <span class="hljs-keyword">new</span> HashMap&lt;Integer, Integer&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;<br>            indexMap.put(inorder[i], i);<br>        &#125;<br>        <span class="hljs-keyword">return</span> myBuildTree(preorder, inorder, <span class="hljs-number">0</span>, n - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, n - <span class="hljs-number">1</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><h1>5.ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—</h1><p><a href="https://www.nowcoder.com/practice/54275ddae22f475981afa2244dd448c6?tpId=13&amp;&amp;tqId=11158&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/54275ddae22f475981afa2244dd448c6?tpId=13&amp;&amp;tqId=11158&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    Stack&lt;Integer&gt; stack1 = <span class="hljs-keyword">new</span> Stack&lt;Integer&gt;();<br>    Stack&lt;Integer&gt; stack2 = <span class="hljs-keyword">new</span> Stack&lt;Integer&gt;();<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">push</span><span class="hljs-params">(<span class="hljs-keyword">int</span> node)</span> </span>&#123;<br>       stack1.push(node);<br>       <br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">pop</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(stack1.empty()&amp;&amp;stack2.empty())&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(stack2.empty())&#123;<br>            <span class="hljs-keyword">while</span>(!stack1.empty())&#123;<br>               stack2.push(stack1.pop()); <br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> stack2.pop();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1>6.æ—‹è½¬æ•°ç»„çš„æœ€å°å€¼</h1><p><a href="https://www.nowcoder.com/practice/9f3231a991af4f55b95579b44b7a01ba?tpId=13&amp;&amp;tqId=11159&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/9f3231a991af4f55b95579b44b7a01ba?tpId=13&amp;&amp;tqId=11159&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æµå¼è¿ç®—</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">minNumberInRotateArray</span><span class="hljs-params">(<span class="hljs-keyword">int</span> [] array)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> Arrays.stream(array).min().getAsInt();<br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//äºŒåˆ†å˜ç§æ€æƒ³ï¼Œç”±äºæ—‹è½¬åï¼Œå¿…ç„¶åœ¨æ—‹è½¬ç‚¹çœ‹æ¥ï¼Œå‰é¢æœ‰åºï¼Œåé¢ä¹Ÿæœ‰åºï¼Œæ•…å¯ä»¥äºŒåˆ†ã€‚</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">minNumberInRotateArray</span><span class="hljs-params">(<span class="hljs-keyword">int</span> [] array)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(array.length==<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>        <br>        <span class="hljs-keyword">int</span> low = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">int</span> high = array.length-<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span>(low+<span class="hljs-number">1</span>&lt;high)&#123;<br>            <span class="hljs-keyword">int</span> mid = low + (high - low)/<span class="hljs-number">2</span>; <span class="hljs-comment">//midæ¡ä»¶å¯ä»¥å†™æˆå¾ªç¯ç±»å‹ï¼Œé˜²æ­¢å‡ºé”™ã€‚</span><br>            <span class="hljs-keyword">if</span>(array[mid]&lt;array[high])&#123;<br>                high = mid;<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(array[mid] == array[high])&#123;<br>                high = high-<span class="hljs-number">1</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                low = mid;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> Math.min(array[low],array[high]);<br>    &#125;<br></code></pre></td></tr></table></figure><h1>7.æ–æ³¢é‚£å¥‘æ•°åˆ—</h1><p><a href="https://www.nowcoder.com/practice/c6c7742f5ba7442aada113136ddea0c3?tpId=13&amp;&amp;tqId=11160&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/c6c7742f5ba7442aada113136ddea0c3?tpId=13&amp;&amp;tqId=11160&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ–¹æ³•ä¸€ï¼šé€’å½’æ€æƒ³</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">Fibonacci</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(n==<span class="hljs-number">0</span>||n==<span class="hljs-number">1</span>)<br>              <span class="hljs-keyword">return</span> n;<br>            <br>        <span class="hljs-keyword">return</span> Fibonacci(n-<span class="hljs-number">1</span>)+Fibonacci(n-<span class="hljs-number">2</span>);<br>        <br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">Fibonacci</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(n==<span class="hljs-number">0</span>||n==<span class="hljs-number">1</span>)<br>              <span class="hljs-keyword">return</span> n;<br>        <span class="hljs-keyword">if</span>(n==<span class="hljs-number">2</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<br>       <span class="hljs-keyword">int</span> p = <span class="hljs-number">1</span>,q=<span class="hljs-number">1</span>,sum = <span class="hljs-number">0</span>;<br>       <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>;i&lt;n;i++)&#123;<br>           sum = p + q;<br>           p = q;<br>           q = sum;<br>       &#125;<br>        <span class="hljs-keyword">return</span> sum;<br>        <br>    &#125;<br></code></pre></td></tr></table></figure><h1>8.è·³å°é˜¶</h1><p><a href="https://www.nowcoder.com/practice/8c82a5b80378478f9484d87d1c5f12a4?tpId=13&amp;&amp;tqId=11161&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/8c82a5b80378478f9484d87d1c5f12a4?tpId=13&amp;&amp;tqId=11161&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é€’å½’æ€æƒ³ </span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">jumpFloor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> target)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(target==<span class="hljs-number">1</span>||target==<span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;       <br>        <span class="hljs-keyword">return</span> jumpFloor(target-<span class="hljs-number">1</span>)+jumpFloor(target-<span class="hljs-number">2</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŠ¨æ€è§„åˆ’</span><br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">jumpFloor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> target)</span> </span>&#123;<br>       <span class="hljs-keyword">if</span>(target==<span class="hljs-number">0</span>)&#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>       &#125;<br>       <span class="hljs-keyword">int</span>[] dp = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[target+<span class="hljs-number">1</span>]; <br>       dp[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>       dp[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;<br>       <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i =<span class="hljs-number">2</span>;i&lt;dp.length;i++)&#123;<br>           dp[i] = dp[i-<span class="hljs-number">1</span>]+dp[i-<span class="hljs-number">2</span>];<br>       &#125;<br>        <span class="hljs-keyword">return</span> dp[target];<br>    &#125;<br></code></pre></td></tr></table></figure><h1>9.å˜æ€è·³å°é˜¶</h1><p><a href="https://www.nowcoder.com/practice/22243d016f6b47f2a6928b4313c85387?tpId=13&amp;&amp;tqId=11162&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/22243d016f6b47f2a6928b4313c85387?tpId=13&amp;&amp;tqId=11162&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŠ¨æ€è§„åˆ’ </span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">jumpFloorII</span><span class="hljs-params">(<span class="hljs-keyword">int</span> target)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(target==<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> target;<br>        &#125;<br>        <span class="hljs-keyword">int</span>[] dp = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[target+<span class="hljs-number">1</span>];<br>        dp[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>        dp[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i =<span class="hljs-number">2</span>;i&lt;dp.length;i++)&#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=i;j++)&#123;<br>                dp[i] += dp[i-j];<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> dp[target];<br>    &#125;<br></code></pre></td></tr></table></figure><h1>10.çŸ©å½¢è¦†ç›–</h1><p><a href="https://www.nowcoder.com/practice/72a5a919508a4251859fb2cfb987a0e6?tpId=13&amp;&amp;tqId=11163&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/72a5a919508a4251859fb2cfb987a0e6?tpId=13&amp;&amp;tqId=11163&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŠ¨æ€è§„åˆ’</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">rectCover</span><span class="hljs-params">(<span class="hljs-keyword">int</span> target)</span> </span>&#123;<br>        <br>        <span class="hljs-keyword">if</span>(target==<span class="hljs-number">0</span>||target==<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-keyword">return</span> target;<br>        &#125;<br>        <span class="hljs-keyword">int</span> p=<span class="hljs-number">1</span>,q=<span class="hljs-number">1</span>,sum=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">2</span>;i&lt;=target;i++)&#123;<br>            sum = p+q;<br>            p = q;<br>            q = sum;<br>        &#125;<br>       <span class="hljs-keyword">return</span> sum;<br>    &#125;<br></code></pre></td></tr></table></figure><h1>11.äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°</h1><p><a href="https://www.nowcoder.com/practice/8ee967e43c2c4ec193b040ea7fbb10b8?tpId=13&amp;&amp;tqId=11164&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/8ee967e43c2c4ec193b040ea7fbb10b8?tpId=13&amp;&amp;tqId=11164&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Inetgerç±»</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">NumberOf1</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>      <span class="hljs-keyword">return</span> Integer.bitCount(n);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä¸¾ä¸ªä¾‹å­</strong>ï¼šä¸€ä¸ªäºŒè¿›åˆ¶æ•°1100ï¼Œä»å³è¾¹æ•°èµ·ç¬¬ä¸‰ä½æ˜¯å¤„äºæœ€å³è¾¹çš„ä¸€ä¸ª1ã€‚å‡å»1åï¼Œç¬¬ä¸‰ä½å˜æˆ0ï¼Œå®ƒåé¢çš„ä¸¤ä½0å˜æˆäº†1ï¼Œè€Œå‰é¢çš„1ä¿æŒä¸å˜ï¼Œå› æ­¤å¾—åˆ°çš„ç»“æœæ˜¯1011.æˆ‘ä»¬å‘ç°å‡1çš„ç»“æœæ˜¯æŠŠæœ€å³è¾¹çš„ä¸€ä¸ª1å¼€å§‹çš„æ‰€æœ‰ä½éƒ½å–åäº†ã€‚</p><p>è¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬å†æŠŠåŸæ¥çš„æ•´æ•°å’Œå‡å»1ä¹‹åçš„ç»“æœåšä¸è¿ç®—ï¼Œä»åŸæ¥æ•´æ•°æœ€å³è¾¹ä¸€ä¸ª1é‚£ä¸€ä½å¼€å§‹æ‰€æœ‰ä½éƒ½ä¼šå˜æˆ0ã€‚å¦‚1100&amp;1011=1000.ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠä¸€ä¸ªæ•´æ•°å‡å»1ï¼Œå†å’ŒåŸæ•´æ•°åšä¸è¿ç®—ï¼Œä¼šæŠŠè¯¥æ•´æ•°æœ€å³è¾¹ä¸€ä¸ª1å˜æˆ0.é‚£ä¹ˆä¸€ä¸ªæ•´æ•°çš„äºŒè¿›åˆ¶æœ‰å¤šå°‘ä¸ª1ï¼Œå°±å¯ä»¥è¿›è¡Œå¤šå°‘æ¬¡è¿™æ ·çš„æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">NumberOf1</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>       <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span>(n != <span class="hljs-number">0</span>)&#123;<br>            count++;<br>            n = n &amp; (n-<span class="hljs-number">1</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br></code></pre></td></tr></table></figure><h1>12.æ•´æ•°çš„Næ¬¡æ–¹</h1><p><a href="https://www.nowcoder.com/practice/1a834e5e3e1a4b7ba251417554e07c00?tpId=13&amp;&amp;tqId=11165&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/1a834e5e3e1a4b7ba251417554e07c00?tpId=13&amp;&amp;tqId=11165&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">Power</span><span class="hljs-params">(<span class="hljs-keyword">double</span> base, <span class="hljs-keyword">int</span> exponent)</span> </span>&#123;<br>        <span class="hljs-keyword">double</span> res = base;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;Math.abs(exponent);i++)&#123;<br>            res = base*res;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(exponent&gt;<span class="hljs-number">0</span>)&#123;<br>           <span class="hljs-keyword">return</span> res;<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(exponent&lt;<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span>/res;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span>;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p><strong>å¿«é€Ÿå¹‚ï¼ˆäºŒè¿›åˆ¶è§’åº¦ï¼‰</strong>ï¼šå¯¹äºä»»ä½•åè¿›åˆ¶æ­£æ•´æ•°nï¼Œèˆå…¶äºŒè¿›åˆ¶ä½â€œbmâ€¦b3 b2 b1â€(biä¸ºä¸ºè¿›åˆ¶æŸä½ç½®)ï¼š</p><ul><li>äºŒè¿›åˆ¶è½¬åè¿›åˆ¶ï¼šn = 1*b1 + 2*b2 + 4*b3 + â€¦ + 2^m-1*bm</li><li>å¹‚çš„äºŒè¿›åˆ¶å±•å¼€ï¼šx^n = x ^  1*b1 + 2*b2 + 4*b3 + â€¦ + 2^m-1*bm</li><li>å½“bi=0æ—¶ï¼šx^bi*2^^^i-1^ = 1;</li><li>å½“bi =1æ—¶ï¼šx^bi*2^^^i-1^  = x^2^^^i-1^</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">myPow</span><span class="hljs-params">(<span class="hljs-keyword">double</span> x, <span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(x == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">long</span> b = n;<br>        <span class="hljs-keyword">double</span> res = <span class="hljs-number">1.0</span>;<br>        <span class="hljs-keyword">if</span>(b &lt; <span class="hljs-number">0</span>) &#123;<br>            x = <span class="hljs-number">1</span> / x;<br>            b = -b;<br>        &#125;<br>        <span class="hljs-keyword">while</span>(b &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span>((b &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">1</span>) res *= x;<br>            x *= x;<br>            b &gt;&gt;= <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br><br></code></pre></td></tr></table></figure><h1>13.è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½ä½äºå¶æ•°ä½å‰é¢</h1><p><a href="https://www.nowcoder.com/practice/beb5aa231adc45b2a5dcc5b62c93f593?tpId=13&amp;&amp;tqId=11166&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/beb5aa231adc45b2a5dcc5b62c93f593?tpId=13&amp;&amp;tqId=11166&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span>[] exchange(<span class="hljs-keyword">int</span>[] nums) &#123;<br>       <span class="hljs-keyword">if</span>(nums.length&lt;=<span class="hljs-number">1</span>)&#123;<br>           <span class="hljs-keyword">return</span> nums;<br>       &#125;<br>       <span class="hljs-keyword">int</span>[] res = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[nums.length];<br>       <span class="hljs-keyword">int</span> low = <span class="hljs-number">0</span>;<br>       <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i =<span class="hljs-number">0</span>;i&lt;nums.length;i++)&#123;<br>           <span class="hljs-keyword">if</span>(nums[i]%<span class="hljs-number">2</span>==<span class="hljs-number">1</span>)&#123;<br>               res[low++] = nums[i];<br>           &#125;<br>       &#125;<br>       <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i =<span class="hljs-number">0</span>;i&lt;nums.length;i++)&#123;<br>           <span class="hljs-keyword">if</span>(nums[i]%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>)&#123;<br>               res[low++] = nums[i];<br>           &#125;<br>       &#125;<br>       nums = res;<br>       <span class="hljs-keyword">return</span> nums;<br>   &#125;<br></code></pre></td></tr></table></figure><h1>14.é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªç»“ç‚¹</h1><p><a href="https://www.nowcoder.com/practice/529d3ae5a407492994ad2a246518148a?tpId=13&amp;&amp;tqId=11167&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/529d3ae5a407492994ad2a246518148a?tpId=13&amp;&amp;tqId=11167&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> ListNode <span class="hljs-title">FindKthToTail</span><span class="hljs-params">(ListNode head,<span class="hljs-keyword">int</span> k)</span> </span>&#123;<br>        ListNode temp = head;<br>        <span class="hljs-keyword">int</span> len = <span class="hljs-number">0</span>; <br>        <span class="hljs-keyword">while</span>(temp!=<span class="hljs-keyword">null</span>)&#123;<br>            len++;<br>            temp = temp.next;<br>        &#125;<br>        temp = head;<br>        <span class="hljs-keyword">if</span>(k&gt;len||k&lt;=<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i =<span class="hljs-number">0</span>;i&lt;len - k;i++)&#123;<br>            temp = temp.next;<br>        &#125; <br>        <span class="hljs-keyword">return</span> temp;<br>    &#125;<br></code></pre></td></tr></table></figure><h1>15.åè½¬é“¾è¡¨</h1><p><a href="https://www.nowcoder.com/practice/75e878df47f24fdc9dc3e400ec6058ca?tpId=13&amp;&amp;tqId=11168&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/75e878df47f24fdc9dc3e400ec6058ca?tpId=13&amp;&amp;tqId=11168&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> ListNode <span class="hljs-title">ReverseList</span><span class="hljs-params">(ListNode head)</span> </span>&#123;<br>        ListNode res = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);<br>        ListNode temp = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">while</span>(head!=<span class="hljs-keyword">null</span>)&#123;<br>            temp = head.next;<br>            head.next = res.next;<br>            res.next = head;<br>            head = temp;<br>        &#125;<br>        <span class="hljs-keyword">return</span> res.next;<br>    &#125;<br></code></pre></td></tr></table></figure><h1>16.åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</h1><p><a href="https://www.nowcoder.com/practice/d8b6b4358f774294a89de2a6ac4d9337?tpId=13&amp;&amp;tqId=11169&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/d8b6b4358f774294a89de2a6ac4d9337?tpId=13&amp;&amp;tqId=11169&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> ListNode <span class="hljs-title">Merge</span><span class="hljs-params">(ListNode list1,ListNode list2)</span> </span>&#123;<br>       <span class="hljs-keyword">if</span>(list1==<span class="hljs-keyword">null</span>)&#123;<br>           <span class="hljs-keyword">return</span> list2;<br>       &#125;<br>        <span class="hljs-keyword">if</span>(list2==<span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> list1;<br>        &#125;<br>        ListNode res = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);<br>        ListNode temp  = res;<br>        <span class="hljs-keyword">while</span>(list1!=<span class="hljs-keyword">null</span>&amp;&amp;list2!=<span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">if</span>(list1.val&lt;list2.val)&#123;<br>                temp.next = list1;<br>                list1 = list1.next;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                temp.next = list2;<br>                list2 = list2.next;<br>            &#125;<br>            temp = temp.next;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(list1!=<span class="hljs-keyword">null</span>)&#123;<br>            temp.next = list1;<br>        &#125;<br>        <br>        <span class="hljs-keyword">if</span>(list2!=<span class="hljs-keyword">null</span>)&#123;<br>            temp.next = list2;<br>        &#125;<br>        <span class="hljs-keyword">return</span> res.next; <br>    &#125;<br></code></pre></td></tr></table></figure><h1>17.æ ‘çš„ å­ç»“æ„</h1><p><a href="https://www.nowcoder.com/practice/6e196c44c7004d15b1610b9afca8bd88?tpId=13&amp;&amp;tqId=11170&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking">https://www.nowcoder.com/practice/6e196c44c7004d15b1610b9afca8bd88?tpId=13&amp;&amp;tqId=11170&amp;rp=1&amp;ru=/ta/coding-interviews&amp;qru=/ta/coding-interviews/question-ranking</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isSubStructure</span><span class="hljs-params">(TreeNode A, TreeNode B)</span> </span>&#123;<br>       <span class="hljs-keyword">return</span> (A != <span class="hljs-keyword">null</span> &amp;&amp; B != <span class="hljs-keyword">null</span>) &amp;&amp; (isSame(A, B) || isSubStructure(A.left, B) || isSubStructure(A.right, B));<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span>  <span class="hljs-title">isSame</span><span class="hljs-params">(TreeNode A, TreeNode B)</span></span>&#123;<br>       <span class="hljs-keyword">if</span>(B == <span class="hljs-keyword">null</span>) <br>           <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>       <span class="hljs-keyword">if</span>(A == <span class="hljs-keyword">null</span> || A.val != B.val) <br>           <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>       <span class="hljs-keyword">return</span> isSame(A.left,B.left)&amp;&amp;isSame(A.right,B.right);<br>   &#125;<br></code></pre></td></tr></table></figure><h1>18.äºŒå‰æ ‘çš„é•œåƒ</h1><p><a href="https://leetcode-cn.com/problems/er-cha-shu-de-jing-xiang-lcof/">https://leetcode-cn.com/problems/er-cha-shu-de-jing-xiang-lcof/</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> TreeNode <span class="hljs-title">mirrorTree</span><span class="hljs-params">(TreeNode root)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(root==<span class="hljs-keyword">null</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        TreeNode temp = root.left;<br>        root.left = root.right;<br>        root.right = temp;<br>        mirrorTree(root.left);<br>        mirrorTree(root.right);<br>        <span class="hljs-keyword">return</span> root;<br>    &#125;<br></code></pre></td></tr></table></figure><h1></h1>]]></content>
    
    
    <categories>
      
      <category>JavaInterview</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ ¡æ‹›</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®ä¸€è‡´æ€§</title>
    <link href="/dajiangdahe/2021/10/22/%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/"/>
    <url>/dajiangdahe/2021/10/22/%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h1>1.æ•°æ®ä¸€è‡´æ€§</h1><p>â€‹åœ¨æ•°æ®æœ‰å¤šåˆ†å‰¯æœ¬çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç½‘ç»œã€æœåŠ¡å™¨æˆ–è€…è½¯ä»¶å‡ºç°æ•…éšœï¼Œä¼šå¯¼è‡´éƒ¨åˆ†å‰¯æœ¬å†™å…¥æˆåŠŸï¼Œéƒ¨åˆ†å‰¯æœ¬å†™å…¥å¤±è´¥ã€‚è¿™å°±é€ æˆå„ä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸ä¸€è‡´ï¼Œæ•°æ®å†…å®¹å†²çªã€‚ å®è·µä¸­ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µæœ‰å¾ˆå¤šç§ï¼Œè¡¨ç°æ ·å¼ä¹Ÿå¤šç§å¤šæ ·ï¼Œæ¯”å¦‚æ•°æ®æ›´æ–°è¿”å›æ“ä½œå¤±è´¥ï¼Œäº‹å®ä¸Šæ•°æ®åœ¨å­˜å‚¨æœåŠ¡å™¨å·²ç»æ›´æ–°æˆåŠŸã€‚</p><h1>2.CAPç†è®º</h1><p>CAPå®šç†æ˜¯2000å¹´ï¼Œç”± Eric Brewer æå‡ºæ¥çš„ã€‚Brewerè®¤ä¸ºåœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸‹è®¾è®¡å’Œéƒ¨ç½²ç³»ç»Ÿæ—¶ï¼Œæœ‰3ä¸ªæ ¸å¿ƒçš„éœ€æ±‚ï¼Œä»¥ä¸€ç§ç‰¹æ®Šçš„å…³ç³»å­˜åœ¨ã€‚è¿™é‡Œçš„åˆ†å¸ƒå¼ç³»ç»Ÿè¯´çš„æ˜¯åœ¨ç‰©ç†ä¸Šåˆ†å¸ƒçš„ç³»ç»Ÿï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„webç³»ç»Ÿã€‚<br>â€ƒâ€ƒè¿™3ä¸ªæ ¸å¿ƒçš„éœ€æ±‚æ˜¯ï¼šConsistencyï¼ŒAvailabilityå’ŒPartition Toleranceï¼Œèµ‹äºˆäº†è¯¥ç†è®ºå¦å¤–ä¸€ä¸ªåå­— ï¼ CAPã€‚<br>â€ƒâ€ƒ<strong>Consistency</strong>ï¼šä¸€è‡´æ€§ï¼Œè¿™ä¸ªå’Œæ•°æ®åº“ACIDçš„ä¸€è‡´æ€§ç±»ä¼¼ï¼Œä½†è¿™é‡Œå…³æ³¨çš„æ‰€æœ‰æ•°æ®èŠ‚ç‚¹ä¸Šçš„æ•°æ®ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§ï¼Œè€Œæ•°æ®åº“çš„ACIDå…³æ³¨çš„æ˜¯åœ¨åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¯¹æ•°æ®çš„ä¸€äº›çº¦æŸã€‚ç³»ç»Ÿåœ¨æ‰§è¡Œè¿‡æŸé¡¹æ“ä½œåä»ç„¶å¤„äºä¸€è‡´çš„çŠ¶æ€ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ›´æ–°æ“ä½œæ‰§è¡ŒæˆåŠŸåæ‰€æœ‰çš„ç”¨æˆ·éƒ½åº”è¯¥è¯»å–åˆ°æœ€æ–°å€¼ã€‚<br>â€ƒâ€ƒ<strong>Availability</strong>ï¼šå¯ç”¨æ€§ï¼Œæ¯ä¸€ä¸ªæ“ä½œæ€»æ˜¯èƒ½å¤Ÿåœ¨ä¸€å®šæ—¶é—´å†…è¿”å›ç»“æœã€‚éœ€è¦æ³¨æ„â€œä¸€å®šæ—¶é—´â€å’Œâ€œè¿”å›ç»“æœâ€ã€‚â€œä¸€å®šæ—¶é—´â€æ˜¯æŒ‡ï¼Œç³»ç»Ÿç»“æœå¿…é¡»åœ¨ç»™å®šæ—¶é—´å†…è¿”å›ã€‚â€œè¿”å›ç»“æœâ€æ˜¯æŒ‡ç³»ç»Ÿè¿”å›æ“ä½œæˆåŠŸæˆ–å¤±è´¥çš„ç»“æœã€‚<br>â€ƒâ€ƒ<strong>Partition Tolerance</strong>ï¼šåˆ†åŒºå®¹å¿æ€§ï¼Œæ˜¯å¦å¯ä»¥å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºã€‚è¿™æ˜¯è€ƒè™‘åˆ°æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚<br>â€ƒâ€ƒCAPå®šç†è®¤ä¸ºï¼Œä¸€ä¸ªæä¾›æ•°æ®æœåŠ¡çš„å­˜å‚¨ç³»ç»Ÿæ— æ³•åŒäº‹æ»¡è¶³æ•°æ®ä¸€è‡´æ€§ã€æ•°æ®å¯ç”¨æ€§ã€åˆ†åŒºå®¹å¿æ€§ã€‚<br>â€ƒâ€ƒä¸ºä»€ä¹ˆä¸èƒ½å®Œå…¨ä¿è¯è¿™ä¸ªä¸‰ç‚¹äº†ï¼Œä¸ªäººè§‰å¾—ä¸»è¦æ˜¯å› ä¸ºä¸€æ—¦è¿›è¡Œåˆ†åŒºäº†ï¼Œå°±è¯´æ˜äº†å¿…é¡»èŠ‚ç‚¹ä¹‹é—´å¿…é¡»è¿›è¡Œé€šä¿¡ï¼Œæ¶‰åŠåˆ°é€šä¿¡ï¼Œå°±æ— æ³•ç¡®ä¿åœ¨æœ‰é™çš„æ—¶é—´å†…å®ŒæˆæŒ‡å®šçš„è¡Œæ–‡ï¼Œå¦‚æœè¦æ±‚ä¸¤ä¸ªæ“ä½œä¹‹é—´è¦å®Œæ•´çš„è¿›è¡Œï¼Œå› ä¸ºæ¶‰åŠåˆ°é€šä¿¡ï¼Œè‚¯å®šå­˜åœ¨æŸä¸€ä¸ªæ—¶åˆ»åªå®Œæˆä¸€éƒ¨åˆ†çš„ä¸šåŠ¡æ“ä½œï¼Œåœ¨é€šä¿¡å®Œæˆçš„è¿™ä¸€æ®µæ—¶é—´å†…ï¼Œæ•°æ®å°±æ˜¯ä¸ä¸€è‡´æ€§çš„ã€‚å¦‚æœè¦æ±‚ä¿è¯ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå°±å¿…é¡»åœ¨é€šä¿¡å®Œæˆè¿™ä¸€æ®µæ—¶é—´å†…ä¿æŠ¤æ•°æ®ï¼Œä½¿å¾—ä»»ä½•è®¿é—®è¿™äº›æ•°æ®çš„æ“ä½œä¸å¯ç”¨ã€‚<br>â€ƒâ€ƒå¦‚æœæƒ³ä¿è¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸èƒ½å¤Ÿåˆ†åŒºã€‚ä¸€ä¸ªç®€å•çš„ç†è§£å°±æ˜¯æ‰€æœ‰çš„æ•°æ®å°±å¿…é¡»å­˜æ”¾åœ¨ä¸€ä¸ªæ•°æ®åº“é‡Œé¢ï¼Œä¸èƒ½è¿›è¡Œæ•°æ®åº“æ‹†åˆ†ã€‚è¿™ä¸ªå¯¹äºå¤§æ•°æ®é‡ï¼Œé«˜å¹¶å‘çš„äº’è”ç½‘åº”ç”¨æ¥è¯´ï¼Œæ˜¯ä¸å¯æ¥å—çš„ã€‚<br>â€ƒâ€ƒåœ¨å¤§å‹ç½‘ç«™åº”ç”¨ä¸­ï¼Œæ•°æ®è§„æ¨¡æ€»æ˜¯å¿«é€Ÿæ‰©å¼ çš„ï¼Œå› æ­¤å¯ä¼¸ç¼©æ€§å³åˆ†åŒºå®¹å¿æ€§å¿…ä¸å¯å°‘ï¼Œè§„æ¨¡å˜å¤§ä»¥åï¼Œæœºå™¨æ•°é‡ä¹Ÿä¼šå˜å¾—åºå¤§ï¼Œè¿™æ˜¯ç½‘ç»œå’ŒæœåŠ¡å™¨æ•…éšœä¼šé¢‘ç¹å‡ºç°ï¼Œè¦æƒ³ä¿è¯åº”ç”¨å¯ç”¨ï¼Œå°±å¿…é¡»ä¿è¯åˆ†å¸ƒå¼å¤„ç†ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚æ‰€ä»¥åœ¨å¤§å‹ç½‘ç«™ä¸­ï¼Œé€šå¸¸ä¼šé€‰æ‹©å¼ºåŒ–åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿçš„å¯ç”¨æ€§(A)å’Œä¼¸ç¼©æ€§Â§ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šæ”¾å¼ƒä¸€è‡´æ€§Â©ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®ä¸ä¸€è‡´é€šå¸¸å‡ºç°åœ¨ç³»ç»Ÿé«˜å¹¶å‘å†™æ“ä½œæˆ–è€…é›†ç¾¤çŠ¶æ€ä¸ç¨³ï¼ˆæ•…éšœæ¢å¤ã€é›†ç¾¤æ‰©å®¹ç­‰ï¼‰çš„æƒ…å†µä¸‹ï¼Œåº”ç”¨ç³»ç»Ÿéœ€è¦å¯¹åˆ†å¸ƒå¼æ•°æ®å¤„ç†ç³»ç»Ÿçš„æ•°æ®ä¸ä¸€è‡´æ€§æœ‰æ‰€äº†è§£å¹¶è¿›è¡ŒæŸç§æ„ä¹‰ä¸Šçš„è¡¥å¿å’Œçº é”™ï¼Œä»¥é¿å…å‡ºç°åº”ç”¨ç³»ç»Ÿæ•°æ®ä¸æ­£ç¡®ã€‚</p><h1>3.æ•°æ®ä¸€è‡´æ€§æ¨¡å‹</h1><p>ä¸€äº›åˆ†å¸ƒå¼ç³»ç»Ÿé€šè¿‡å¤åˆ¶æ•°æ®æ¥æé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå®¹é”™æ€§ï¼Œå¹¶ä¸”å°†æ•°æ®çš„ä¸åŒçš„å‰¯æœ¬å­˜æ”¾åœ¨ä¸åŒçš„æœºå™¨ï¼Œç”±äºç»´æŠ¤æ•°æ®å‰¯æœ¬çš„ä¸€è‡´æ€§ä»£ä»·é«˜ï¼Œå› æ­¤è®¸å¤šç³»ç»Ÿé‡‡ç”¨å¼±ä¸€è‡´æ€§æ¥æé«˜æ€§èƒ½ï¼Œä¸€äº›ä¸åŒçš„ä¸€è‡´æ€§æ¨¡å‹ä¹Ÿç›¸ç»§è¢«æå‡ºã€‚</p><ul><li>å¼ºä¸€è‡´æ€§ï¼š è¦æ±‚æ— è®ºæ›´æ–°æ“ä½œå®åœ¨å“ªä¸€ä¸ªå‰¯æœ¬æ‰§è¡Œï¼Œä¹‹åæ‰€æœ‰çš„è¯»æ“ä½œéƒ½è¦èƒ½è·å¾—æœ€æ–°çš„æ•°æ®ã€‚</li><li>å¼±ä¸€è‡´æ€§ï¼šç”¨æˆ·è¯»åˆ°æŸä¸€æ“ä½œå¯¹ç³»ç»Ÿç‰¹å®šæ•°æ®çš„æ›´æ–°éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬ç§°è¿™æ®µæ—¶é—´ä¸ºâ€œä¸ä¸€è‡´æ€§çª—å£â€ã€‚</li><li>æœ€ç»ˆä¸€è‡´æ€§ï¼šæ˜¯å¼±ä¸€è‡´æ€§çš„ä¸€ç§ç‰¹ä¾‹ï¼Œä¿è¯ç”¨æˆ·æœ€ç»ˆèƒ½å¤Ÿè¯»å–åˆ°æŸæ“ä½œå¯¹ç³»ç»Ÿç‰¹å®šæ•°æ®çš„æ›´æ–°ã€‚</li></ul><h1>4.åˆ†å¸ƒå¼äº‹åŠ¡çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼ˆå¤šç”¨äºå•ä¸€æ•°æ®åº“é›†ç¾¤é—®é¢˜ï¼‰</h1><p>åˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯æŒ‡äº‹åŠ¡çš„å‚ä¸è€…ã€æ”¯æŒäº‹åŠ¡çš„æœåŠ¡å™¨ã€èµ„æºæœåŠ¡å™¨ä»¥åŠäº‹åŠ¡ç®¡ç†å™¨åˆ†åˆ«ä½äºä¸åŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸åŒèŠ‚ç‚¹ä¹‹ä¸Šã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ä¸€æ¬¡å¤§çš„æ“ä½œç”±ä¸åŒçš„å°æ“ä½œç»„æˆï¼Œè¿™äº›å°çš„æ“ä½œåˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä¸”å±äºä¸åŒçš„åº”ç”¨ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦ä¿è¯è¿™äº›å°æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯ä¸ºäº†ä¿è¯ä¸åŒæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><h2 id="1-TC"><a href="http://1.TC">1.TC</a></h2><img src="/dajiangdahe.github.io/2021/10/22/%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/dist-tx-1.png" class="" title="img"><img src="/dajiangdahe.github.io/2021/10/22/%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/dist-yzx-1.png" class="" title="img"><p>å¦‚ä¸Šå›¾ï¼Œåœ¨XAåè®®ä¸­åˆ†ä¸ºä¸¤é˜¶æ®µï¼š</p><p>ç¬¬ä¸€é˜¶æ®µï¼šäº‹åŠ¡ç®¡ç†å™¨è¦æ±‚æ¯ä¸ªæ¶‰åŠåˆ°äº‹åŠ¡çš„æ•°æ®åº“é¢„æäº¤(precommit)æ­¤æ“ä½œï¼Œå¹¶åæ˜ æ˜¯å¦å¯ä»¥æäº¤ã€‚</p><p>ç¬¬äºŒé˜¶æ®µï¼šäº‹åŠ¡åè°ƒå™¨è¦æ±‚æ¯ä¸ªæ•°æ®åº“æäº¤æ•°æ®ï¼Œæˆ–è€…å›æ»šæ•°æ®ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å°½é‡ä¿è¯äº†æ•°æ®çš„å¼ºä¸€è‡´ï¼Œå®ç°æˆæœ¬è¾ƒä½ï¼Œåœ¨å„å¤§ä¸»æµæ•°æ®åº“éƒ½æœ‰è‡ªå·±å®ç°ï¼Œå¯¹äºMySQLæ˜¯ä»5.5å¼€å§‹æ”¯æŒã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å•ç‚¹é—®é¢˜:äº‹åŠ¡ç®¡ç†å™¨åœ¨æ•´ä¸ªæµç¨‹ä¸­æ‰®æ¼”çš„è§’è‰²å¾ˆå…³é”®ï¼Œå¦‚æœå…¶å®•æœºï¼Œæ¯”å¦‚åœ¨ç¬¬ä¸€é˜¶æ®µå·²ç»å®Œæˆï¼Œåœ¨ç¬¬äºŒé˜¶æ®µæ­£å‡†å¤‡æäº¤çš„æ—¶å€™äº‹åŠ¡ç®¡ç†å™¨å®•æœºï¼Œèµ„æºç®¡ç†å™¨å°±ä¼šä¸€ç›´é˜»å¡ï¼Œå¯¼è‡´æ•°æ®åº“æ— æ³•ä½¿ç”¨ã€‚</li><li>åŒæ­¥é˜»å¡:åœ¨å‡†å¤‡å°±ç»ªä¹‹åï¼Œèµ„æºç®¡ç†å™¨ä¸­çš„èµ„æºä¸€ç›´å¤„äºé˜»å¡ï¼Œç›´åˆ°æäº¤å®Œæˆï¼Œé‡Šæ”¾èµ„æºã€‚</li><li>æ•°æ®ä¸ä¸€è‡´:ä¸¤é˜¶æ®µæäº¤åè®®è™½ç„¶ä¸ºåˆ†å¸ƒå¼æ•°æ®å¼ºä¸€è‡´æ€§æ‰€è®¾è®¡ï¼Œä½†ä»ç„¶å­˜åœ¨æ•°æ®ä¸ä¸€è‡´æ€§çš„å¯èƒ½ï¼Œæ¯”å¦‚åœ¨ç¬¬äºŒé˜¶æ®µä¸­ï¼Œå‡è®¾åè°ƒè€…å‘å‡ºäº†äº‹åŠ¡commitçš„é€šçŸ¥ï¼Œä½†æ˜¯å› ä¸ºç½‘ç»œé—®é¢˜è¯¥é€šçŸ¥ä»…è¢«ä¸€éƒ¨åˆ†å‚ä¸è€…æ‰€æ”¶åˆ°å¹¶æ‰§è¡Œäº†commitæ“ä½œï¼Œå…¶ä½™çš„å‚ä¸è€…åˆ™å› ä¸ºæ²¡æœ‰æ”¶åˆ°é€šçŸ¥ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œè¿™æ—¶å€™å°±äº§ç”Ÿäº†æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒXAåè®®æ¯”è¾ƒç®€å•ï¼Œæˆæœ¬è¾ƒä½ï¼Œä½†æ˜¯å…¶å•ç‚¹é—®é¢˜ï¼Œä»¥åŠä¸èƒ½æ”¯æŒé«˜å¹¶å‘ä¾ç„¶æ˜¯å…¶æœ€å¤§çš„å¼±ç‚¹ã€‚</p><h2 id="2-TCC">2.TCC</h2><p>å…³äºTCCï¼ˆTry-Confirm-Cancelï¼‰çš„æ¦‚å¿µï¼Œæœ€æ—©æ˜¯ç”±Pat Hellandäº2007å¹´å‘è¡¨çš„ä¸€ç¯‡åä¸ºã€ŠLife beyond Distributed Transactions:an Apostateâ€™s Opinionã€‹çš„è®ºæ–‡æå‡ºã€‚ TCCäº‹åŠ¡æœºåˆ¶ç›¸æ¯”äºä¸Šé¢ä»‹ç»çš„XAï¼Œè§£å†³äº†å…¶å‡ ä¸ªç¼ºç‚¹ï¼š</p><ol><li><p>è§£å†³äº†åè°ƒè€…å•ç‚¹ï¼Œç”±ä¸»ä¸šåŠ¡æ–¹å‘èµ·å¹¶å®Œæˆè¿™ä¸ªä¸šåŠ¡æ´»åŠ¨ã€‚ä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨ä¹Ÿå˜æˆå¤šç‚¹ï¼Œå¼•å…¥é›†ç¾¤ã€‚</p></li><li><p>åŒæ­¥é˜»å¡ï¼šå¼•å…¥è¶…æ—¶ï¼Œè¶…æ—¶åè¿›è¡Œè¡¥å¿ï¼Œå¹¶ä¸”ä¸ä¼šé”å®šæ•´ä¸ªèµ„æºï¼Œå°†èµ„æºè½¬æ¢ä¸ºä¸šåŠ¡é€»è¾‘å½¢å¼ï¼Œç²’åº¦å˜å°ã€‚</p></li><li><p>æ•°æ®ä¸€è‡´æ€§ï¼Œæœ‰äº†è¡¥å¿æœºåˆ¶ä¹‹åï¼Œç”±ä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨æ§åˆ¶ä¸€è‡´æ€§ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/dist-tx-2.png" class="" title="img"></li></ol><img src="/dajiangdahe.github.io/2021/10/22/%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/dist-yzx-2.png" class="" title="img"><p>å¦‚ä¸Šå›¾ï¼Œå¯¹äºTCCçš„è§£é‡Šï¼š</p><ul><li>Tryé˜¶æ®µï¼šå°è¯•æ‰§è¡Œ,å®Œæˆæ‰€æœ‰ä¸šåŠ¡æ£€æŸ¥ï¼ˆä¸€è‡´æ€§ï¼‰ï¼Œé¢„ç•™å¿…é¡»ä¸šåŠ¡èµ„æºï¼ˆå‡†éš”ç¦»æ€§ï¼‰ã€‚</li><li>Confirmé˜¶æ®µï¼šç¡®è®¤æ‰§è¡ŒçœŸæ­£æ‰§è¡Œä¸šåŠ¡ï¼Œä¸ä½œä»»ä½•ä¸šåŠ¡æ£€æŸ¥ï¼Œåªä½¿ç”¨Tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼ŒConfirmæ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ã€‚è¦æ±‚å…·å¤‡å¹‚ç­‰è®¾è®¡ï¼ŒConfirmå¤±è´¥åéœ€è¦è¿›è¡Œé‡è¯•ã€‚</li><li>Cancelé˜¶æ®µï¼šå–æ¶ˆæ‰§è¡Œï¼Œé‡Šæ”¾Tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æº Cancelæ“ä½œæ»¡è¶³å¹‚ç­‰æ€§Cancelé˜¶æ®µçš„å¼‚å¸¸å’ŒConfirmé˜¶æ®µå¼‚å¸¸å¤„ç†æ–¹æ¡ˆåŸºæœ¬ä¸Šä¸€è‡´ã€‚</li></ul><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­å¦‚æœä½ ç”¨100å…ƒä¹°äº†ä¸€ç“¶æ°´ï¼Œåœ¨Tryé˜¶æ®µä½ éœ€è¦å‘ä½ çš„é’±åŒ…æ£€æŸ¥æ˜¯å¦å¤Ÿ100å…ƒå¹¶é”ä½è¿™100å…ƒï¼Œæ°´ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªå¤±è´¥ï¼Œåˆ™è¿›è¡Œcancel(é‡Šæ”¾è¿™100å…ƒå’Œè¿™ä¸€ç“¶æ°´)ï¼Œå¦‚æœcancelå¤±è´¥ä¸è®ºä»€ä¹ˆå¤±è´¥éƒ½è¿›è¡Œé‡è¯•cancelï¼Œæ‰€ä»¥éœ€è¦ä¿æŒå¹‚ç­‰ã€‚å¦‚æœéƒ½æˆåŠŸï¼Œåˆ™è¿›è¡Œconfirm,ç¡®è®¤è¿™100å…ƒæ‰£ï¼Œå’Œè¿™ä¸€ç“¶æ°´è¢«å–ï¼Œå¦‚æœconfirmå¤±è´¥æ— è®ºä»€ä¹ˆå¤±è´¥åˆ™é‡è¯•(ä¼šä¾é æ´»åŠ¨æ—¥å¿—è¿›è¡Œé‡è¯•)ã€‚</p><p>å¯¹äºTCCæ¥è¯´é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š</p><ul><li>å¼ºéš”ç¦»æ€§ï¼Œä¸¥æ ¼ä¸€è‡´æ€§è¦æ±‚çš„æ´»åŠ¨ä¸šåŠ¡ã€‚</li><li>æ‰§è¡Œæ—¶é—´è¾ƒçŸ­çš„ä¸šåŠ¡ã€‚</li></ul><h1>5.Rediså’ŒMySQLçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜</h1><h2 id="1-ä¸€è‡´æ€§é—®é¢˜">1.ä¸€è‡´æ€§é—®é¢˜</h2><p>è¯»å–ç¼“å­˜æ­¥éª¤ä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦æ¶‰åŠåˆ°æ•°æ®æ›´æ–°ï¼šæ•°æ®åº“å’Œç¼“å­˜æ›´æ–°ï¼Œå°±å®¹æ˜“å‡ºç°ç¼“å­˜å’Œæ•°æ®åº“é—´çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ä¸ç®¡æ˜¯å…ˆå†™æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼›è¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†å†™åº“ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><p>1.å¦‚æœåˆ é™¤äº†ç¼“å­˜Redisï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠå†™åº“MySQLï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±æ¥è¯»å–ï¼Œå‘ç°ç¼“å­˜ä¸ºç©ºï¼Œåˆ™å»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶ç¼“å­˜ä¸­ä¸ºè„æ•°æ®ã€‚</p><p>2.å¦‚æœå…ˆå†™äº†åº“ï¼Œåœ¨åˆ é™¤ç¼“å­˜å‰ï¼Œå†™åº“çš„çº¿ç¨‹å®•æœºäº†ï¼Œæ²¡æœ‰åˆ é™¤æ‰ç¼“å­˜ï¼Œåˆ™ä¹Ÿä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æƒ…å†µã€‚</p><p>å› ä¸ºå†™å’Œè¯»æ˜¯å¹¶å‘çš„ï¼Œæ²¡æ³•ä¿è¯é¡ºåº,å°±ä¼šå‡ºç°ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å¦‚ä½•è§£å†³ï¼Ÿè¿™é‡Œç»™å‡ºä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå…ˆæ˜“åéš¾ï¼Œç»“åˆä¸šåŠ¡å’ŒæŠ€æœ¯ä»£ä»·é€‰æ‹©ä½¿ç”¨ã€‚</p><h2 id="2-è§£å†³æ–¹æ³•-å»¶è¿ŸåŒåˆ ">2.è§£å†³æ–¹æ³•----å»¶è¿ŸåŒåˆ </h2><p><strong>ä¸€ã€ åŒæ­¥å»¶æ—¶åŒåˆ ç­–ç•¥</strong></p><p>åœ¨å†™åº“å‰åéƒ½è¿›è¡Œredis.del(key)æ“ä½œï¼Œå¹¶ä¸”è®¾å®šåˆç†çš„è¶…æ—¶æ—¶é—´ã€‚å…·ä½“æ­¥éª¤æ˜¯ï¼š</p><p>1ï¼‰å…ˆåˆ é™¤ç¼“å­˜</p><p>2ï¼‰å†å†™æ•°æ®åº“</p><p>3ï¼‰ä¼‘çœ 500æ¯«ç§’ï¼ˆæ ¹æ®å…·ä½“çš„ä¸šåŠ¡æ—¶é—´æ¥å®šï¼‰</p><p>4ï¼‰å†æ¬¡åˆ é™¤ç¼“å­˜ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/1306964-20210526181836508-1439022605.png" class="" title="img"><p>ã€<strong>ä¼‘çœ æ—¶é—´ç¡®å®š</strong>ã€‘</p><p>éœ€è¦è¯„ä¼°è‡ªå·±çš„é¡¹ç›®çš„è¯»æ•°æ®<strong>ä¸šåŠ¡é€»è¾‘çš„è€—æ—¶</strong>ã€‚è¿™ä¹ˆåšçš„ç›®çš„ï¼Œå°±æ˜¯ç¡®ä¿è¯»è¯·æ±‚ç»“æŸï¼Œå†™è¯·æ±‚å¯ä»¥åˆ é™¤è¯»è¯·æ±‚é€ æˆçš„ç¼“å­˜è„æ•°æ®ã€‚</p><p>å½“ç„¶ï¼Œè¿™ç§ç­–ç•¥è¿˜è¦è€ƒè™‘ <strong>redis å’Œæ•°æ®åº“ä¸»ä»åŒæ­¥çš„è€—æ—¶</strong>ã€‚æœ€åçš„å†™æ•°æ®çš„ä¼‘çœ æ—¶é—´ï¼šåˆ™åœ¨è¯»æ•°æ®ä¸šåŠ¡é€»è¾‘çš„è€—æ—¶çš„åŸºç¡€ä¸Šï¼ŒåŠ ä¸Šå‡ ç™¾mså³å¯ã€‚æ¯”å¦‚ï¼šä¼‘çœ 1ç§’ã€‚</p><p><strong>äºŒã€è®¾ç½®ç¼“å­˜çš„è¿‡æœŸæ—¶é—´</strong></p><p>ä»ç†è®ºä¸Šæ¥è¯´ï¼Œç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ˜¯ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆã€‚æ‰€æœ‰çš„å†™æ“ä½œä»¥æ•°æ®åº“ä¸ºå‡†ï¼Œåªè¦åˆ°è¾¾ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œåˆ™åé¢çš„è¯»è¯·æ±‚è‡ªç„¶ä¼šä»æ•°æ®åº“ä¸­è¯»å–æ–°å€¼ç„¶åå›å¡«ç¼“å­˜</p><p>ç»“åˆåŒåˆ ç­–ç•¥+ç¼“å­˜è¶…æ—¶è®¾ç½®ï¼Œè¿™æ ·æœ€å·®çš„æƒ…å†µå°±æ˜¯åœ¨è¶…æ—¶æ—¶é—´å†…æ•°æ®å­˜åœ¨ä¸ä¸€è‡´ï¼Œè€Œä¸”åˆå¢åŠ äº†å†™è¯·æ±‚çš„è€—æ—¶ã€‚</p><p><strong>ä¸‰ã€å¼‚æ­¥å»¶è¿ŸåŒåˆ ç­–ç•¥ï¼Œå€Ÿç”¨MQ</strong></p><p>ä¸Šè¿°çš„æ–¹æ¡ˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œé‚£å°±æ˜¯æ“ä½œå®Œæ•°æ®åº“åï¼Œç”±äºç§ç§åŸå› åˆ é™¤ç¼“å­˜å¤±è´¥ï¼Œè¿™æ—¶ï¼Œå¯èƒ½å°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªä¿éšœé‡è¯•çš„æ–¹æ¡ˆã€‚</p><p><strong>1ã€æ–¹æ¡ˆä¸€å…·ä½“æµç¨‹</strong></p><p>ï¼ˆ1ï¼‰æ›´æ–°æ•°æ®åº“æ•°æ®ï¼›</p><p>ï¼ˆ2ï¼‰ç¼“å­˜å› ä¸ºç§ç§é—®é¢˜åˆ é™¤å¤±è´¥ï¼›</p><p>ï¼ˆ3ï¼‰å°†éœ€è¦åˆ é™¤çš„keyå‘é€è‡³<strong>æ¶ˆæ¯é˜Ÿåˆ—ï¼›</strong></p><p>ï¼ˆ4ï¼‰è‡ªå·±æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å¾—éœ€è¦åˆ é™¤çš„keyï¼›</p><p>ï¼ˆ5ï¼‰ç»§ç»­é‡è¯•åˆ é™¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸã€‚</p><p>ç„¶è€Œï¼Œè¯¥æ–¹æ¡ˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå¯¹ä¸šåŠ¡çº¿ä»£ç é€ æˆå¤§é‡çš„ä¾µå…¥ã€‚äºæ˜¯æœ‰äº†æ–¹æ¡ˆäºŒï¼Œåœ¨æ–¹æ¡ˆäºŒä¸­ï¼Œå¯åŠ¨ä¸€ä¸ªè®¢é˜…ç¨‹åºå»è®¢é˜…æ•°æ®åº“çš„binlogï¼Œè·å¾—éœ€è¦æ“ä½œçš„æ•°æ®ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¦èµ·ä¸€æ®µç¨‹åºï¼Œè·å¾—è¿™ä¸ªè®¢é˜…ç¨‹åºä¼ æ¥çš„ä¿¡æ¯ï¼Œè¿›è¡Œåˆ é™¤ç¼“å­˜æ“ä½œã€‚</p><p><strong>2ã€æ–¹æ¡ˆäºŒå…·ä½“æµç¨‹</strong></p><p>ï¼ˆ1ï¼‰æ›´æ–°æ•°æ®åº“æ•°æ®ï¼›</p><p>ï¼ˆ2ï¼‰æ•°æ®åº“ä¼šå°†æ“ä½œä¿¡æ¯å†™å…¥binlogæ—¥å¿—å½“ä¸­ï¼›</p><p>ï¼ˆ3ï¼‰è®¢é˜…ç¨‹åºæå–å‡ºæ‰€éœ€è¦çš„æ•°æ®ä»¥åŠkeyï¼›</p><p>ï¼ˆ4ï¼‰å¦èµ·ä¸€æ®µéä¸šåŠ¡ä»£ç ï¼Œè·å¾—è¯¥ä¿¡æ¯ï¼›</p><p>ï¼ˆ5ï¼‰å°è¯•åˆ é™¤ç¼“å­˜æ“ä½œï¼Œå‘ç°åˆ é™¤å¤±è´¥ï¼›</p><p>ï¼ˆ6ï¼‰å°†è¿™äº›ä¿¡æ¯å‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—ï¼›</p><p>ï¼ˆ7ï¼‰é‡æ–°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å¾—è¯¥æ•°æ®ï¼Œé‡è¯•æ“ä½œã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/1306964-20210526181839323-1134717675.png" class="" title="img">]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¸ƒéš†è¿‡æ»¤å™¨</title>
    <link href="/dajiangdahe/2021/10/22/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/"/>
    <url>/dajiangdahe/2021/10/22/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/</url>
    
    <content type="html"><![CDATA[<h1>1.å¸ƒéš†è¿‡æ»¤å™¨</h1><h2 id="åœºæ™¯">åœºæ™¯</h2><p>åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°å»é‡é—®é¢˜ï¼šåˆ¤æ–­ä¸€ä¸ªäººæœ‰æ²¡æœ‰æµè§ˆè¿‡ä¸€ç¯‡æ–‡ç« ï¼Œåˆ¤æ–­ä¸€ä¸ªipæ˜¯å¦å‘è¿‡ä¸€ä¸ªè¯·æ±‚ï¼Œåˆ¤æ–­ä¸€ä¸ªäººå½“å¤©æ˜¯å¦ç™»é™†è¿‡æŸä¸ªç³»ç»Ÿ</p><p>å¸¸è§çš„è§£å†³åŠæ³•ï¼š</p><p>â€‹ï¼ˆ1ï¼‰ï¼šsetã€‚ç¼ºç‚¹ï¼šå½“æ•°æ®é‡è¿‡å¤§æ—¶ï¼Œsetä¼šéå¸¸æ¶ˆè€—å†…å­˜ï¼Œæ€§èƒ½ä¹Ÿä¸é«˜ã€‚</p><p>â€‹ï¼ˆ2ï¼‰ï¼šbitmapã€‚ç¼ºç‚¹ï¼šBitmapå¯ä»¥æé«˜æ€§èƒ½ï¼Œä½†æ˜¯bitmapä»ç„¶æ¯”è¾ƒæ¶ˆè€—å†…å­˜ï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®æ¯”è¾ƒç¨€ç–çš„æƒ…å†µä¸‹ã€‚</p><p>â€‹ï¼ˆ3ï¼‰ï¼šå¸ƒéš†è¿‡æ»¤å™¨ã€‚</p><h2 id="åŸç†">åŸç†</h2><p>å¸ƒéš†è¿‡æ»¤å™¨ä¸BitMapç±»ä¼¼ï¼Œåº•å±‚ä¹Ÿæ˜¯ä¸€ä¸ªä½æ•°ç»„ã€‚1è¡¨ç¤ºæœ‰ï¼Œ0è¡¨ç¤ºæ— ã€‚ä½†å¸ƒéš†è¿‡æ»¤å™¨æ¯”BitMapéœ€è¦æ›´å°‘çš„å†…å­˜ï¼Œå®ƒæ˜¯æ€ä¹ˆåŠåˆ°çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¤šä¸ªhashã€‚</p><p>æˆ‘ä»¬çŸ¥é“hashç®—æ³•ï¼Œæ˜¯æŠŠä¸€ä¸ªæ•°ä»è¾ƒå¤§èŒƒå›´çš„å€¼ï¼Œæ˜ å°„åˆ°è¾ƒå°èŒƒå›´å€¼ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ª10ä½çš„æ•°ç»„ï¼Œä½¿ç”¨æŸä¸ªhashç®—æ³•åŠå…¶æ•°ç»„ä¸Šçš„è¡¨ç¤ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">hash</span>(â€œxyâ€) = <span class="hljs-number">3</span>;<br><br><span class="hljs-attribute">hash</span>(â€œaaâ€) = <span class="hljs-number">5</span>;<br><br><span class="hljs-attribute">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¿«é€Ÿçš„çŸ¥é“ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯å­˜åœ¨ä¸€ä¸ªé›†åˆé‡Œé¢ã€‚</p><p>ä½†æ˜¯ä¼šå‡ºç°hashå†²çª</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">hash(â€œxyâ€) = <span class="hljs-number">3</span><span class="hljs-comment">;</span><br><br>hash(â€œaaâ€) = <span class="hljs-number">3</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>è§£å†³åŠæ³•ï¼š1.å†hashæ³•</p><p>â€‹  2.é“¾åœ°å€æ³•</p><p>â€‹  3.å¼€æ”¾å®šå€æ³•</p><p>ä½†æ˜¯åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­é€‰æ‹©çš„æ˜¯ä½¿ç”¨ï¼ˆ1ï¼‰ï¼Œé‡‡ç”¨å¤šä¸ªhashç®—æ³•ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">h1</span>(â€œxyâ€) = <span class="hljs-number">3</span>, h<span class="hljs-number">2</span>(â€œxyâ€) = <span class="hljs-number">5</span>, h<span class="hljs-number">3</span>(â€œxyâ€) = <span class="hljs-number">7</span>;<br><br><span class="hljs-attribute">h1</span>(â€œaaâ€) = <span class="hljs-number">5</span>, h<span class="hljs-number">2</span>(â€œaaâ€) = <span class="hljs-number">6</span>, h<span class="hljs-number">3</span>(â€œaaâ€) = <span class="hljs-number">7</span>;<br><br><span class="hljs-attribute">h1</span>(â€œxyçš„aaâ€) = <span class="hljs-number">3</span>, h<span class="hljs-number">2</span>(â€œxyçš„aaâ€) = <span class="hljs-number">6</span>, h<span class="hljs-number">3</span>(â€œxyçš„aaâ€) = <span class="hljs-number">9</span>;<br></code></pre></td></tr></table></figure><p>æœ€å¼€å§‹çš„æ—¶å€™ ï¼Œé›†åˆé‡Œæ²¡æœ‰å…ƒç´ ï¼Œæ‰€æœ‰ä½éƒ½æ˜¯0ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæ’å…¥â€œxyâ€ï¼Œåˆ©ç”¨å¤šæ¬¡hashï¼ŒæŠŠæ¯æ¬¡hashçš„ç»“æœä¸‹æ ‡3, 5, 7éƒ½æ’å…¥åˆ°ç›¸åº”çš„åœ°æ–¹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæ’å…¥â€œaaâ€ï¼Œåˆ©ç”¨å¤šæ¬¡hashï¼ŒæŠŠæ¯æ¬¡hashçš„ç»“æœä¸‹æ ‡5, 6, 7éƒ½æ’å…¥åˆ°ç›¸åº”çš„åœ°æ–¹ï¼Œå·²ç»æ˜¯1çš„ä¸‹æ ‡ä¸å˜:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åˆ¤æ–­â€œxyâ€æ˜¯å¦åœ¨é›†åˆä¸­ï¼Œåªéœ€è¦ä½¿ç”¨åŒæ ·çš„ 3ä¸ªhashç®—æ³•ï¼Œæ¥è®¡ç®—å‡ºä¸‹æ ‡æ˜¯3,5,7çš„ä½ç½®ä¸Šæ˜¯å¦ä¸º1ï¼Œå¦‚æœä¸º1ï¼Œåˆ™è¯æ˜â€œxyâ€œåœ¨é›†åˆä¸­ã€‚å¦‚æœå‘ç°æœ‰ä¸‹æ ‡ä¸º0ï¼Œåˆ™è¯´æ˜stringä¸åœ¨é›†åˆä¸­ã€‚</p><h2 id="è¯¯å·®">è¯¯å·®</h2><p>ç”±äºæ˜¯å¤šä¸ªhashå‡½æ•°æ•£åˆ—è€Œæ¥ï¼Œå¿…ç„¶ä¼šå­˜åœ¨ä¸€äº›è¯¯å·®ã€‚æœ‰å¯èƒ½æŸä¸ªå…ƒç´ å¹¶æ²¡æœ‰åœ¨é›†åˆä¸­ï¼Œä½†æ˜¯å®ƒå¯¹åº”ä½æ•°ç»„ä¸º1.è¿™æ ·å°±äº§ç”Ÿäº†è¯¯å·®ã€‚</p><p>ä»¥å¸ƒéš†è¿‡æ»¤å™¨ä¸èƒ½åˆ é™¤ï¼Œå› ä¸ºä¸€æ—¦åˆ é™¤ï¼ˆå³å°†ç›¸åº”çš„ä½ç½®ä¸º0ï¼‰ï¼Œå°±å¾ˆå¤§å¯èƒ½ä¼šå½±å“å…¶ä»–å…ƒç´ ã€‚</p><p>å¦‚æœä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ä¸€ä¸ªå‡½æ•°æ˜¯å¦å­˜åœ¨äºä¸€ä¸ªé›†åˆï¼Œå¦‚æœå®ƒè¿”å›trueï¼Œåˆ™ä»£è¡¨å¯èƒ½å­˜åœ¨ã€‚å¦‚æœå®ƒè¿”å›falseï¼Œåˆ™ä»£è¡¨ä¸€å®šä¸å­˜åœ¨ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œå¸ƒéš†è¿‡æ»¤å™¨é€‚åˆäºä¸€äº›éœ€è¦å»é‡ï¼Œä½†ä¸ä¸€å®šè¦å®Œå…¨ç²¾ç¡®çš„åœºæ™¯ã€‚æ¯”å¦‚ï¼š</p><ul><li>åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·è®¿é—®äº†ä¸€ç¯‡æ–‡ç« </li><li>åˆ¤æ–­ä¸€ä¸ªipè®¿é—®äº†æœ¬ç½‘ç«™</li><li>åˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦è¢«è®¿é—®è¿‡</li></ul><p>ç›¸åº”çš„ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ä¸é€‚åˆä¸€äº›è¦æ±‚é›¶è¯¯å·®çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼š</p><ul><li>åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·æ˜¯å¦æ”¶è—äº†ä¸€ç¯‡æ–‡ç« </li><li>åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·æ˜¯å¦è®¢è´­äº†ä¸€ä¸ªè¯¾ç¨‹</li></ul><h2 id="ä½¿ç”¨æŠ€å·§">ä½¿ç”¨æŠ€å·§</h2><p>å¦‚æœç©ºé—´è¶Šå¤§ï¼Œhashå‡½æ•°è¶Šå¤šï¼Œç»“æœå°±è¶Šç²¾ç¡®ï¼Œä½†æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ•ˆç‡å°±ä¼šè¶Šä½ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9OTnNzMDMyRklTZzVvREY3eWtnVUxqSUhvZWQ5Vm1wZGlhbWtKVGdMTVhzTnRFTEhyVFF4MDYwc1k2bjdPN0NVaWNUd1VpYzlGMWdGRXQ1d2R4UUdpY05pYmd3LzY0MA" class="" title="img"><p>åé¢4åˆ—ä¸­çš„æ•°æ®å°±æ˜¯å‘ç”Ÿè¯¯å·®çš„æ•°é‡ã€‚å¯è§ï¼Œç©ºé—´å¤§å°å’Œé›†åˆå¤§å°ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå¢åŠ hashå‡½æ•°å¯ä»¥æ˜¾è‘—å‡å°è¯¯å·®ã€‚ä½†ä¸€æ—¦é›†åˆå¤§å°è¾¾åˆ°ç©ºé—´å¤§å°çš„25%å·¦å³åï¼Œå¢åŠ hashå‡½æ•°å¸¦æ¥çš„æç¥æ•ˆæœå¹¶ä¸æ˜æ˜¾ã€‚è¿™ä¸ªæ—¶å€™åº”è¯¥å¢åŠ ç©ºé—´å¤§å°ã€‚</p><h2 id="Redisä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨">Redisä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨</h2><p>Redisçš„å¸ƒéš†è¿‡æ»¤å™¨ä¸æ˜¯åŸç”Ÿè‡ªå¸¦çš„ï¼Œè€Œæ˜¯è¦é€šè¿‡moduleåŠ è½½è¿›å»ã€‚Redisåœ¨4.0çš„ç‰ˆæœ¬ä¸­åŠ å…¥äº†moduleåŠŸèƒ½ã€‚å…·ä½“ä½¿ç”¨å¯ä»¥ç›´æ¥çœ‹RedisBloom githubçš„READMEï¼š<a href="https://github.com/RedisBloom/RedisBloom%E3%80%82%E4%B8%8A%E9%9D%A2%E6%9C%89docker%E4%B8%80%E9%94%AE%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%BE%88%E6%96%B9%E4%BE%BF%E5%9C%B0%E5%AE%9E%E9%AA%8C%E3%80%82%E4%B9%9F%E6%9C%89%E5%87%A0%E7%A7%8D%E4%B8%BB%E6%B5%81%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BA%93%E7%9A%84%E9%93%BE%E6%8E%A5%EF%BC%8C%E6%AF%94%E5%A6%82Java%E8%AF%AD%E8%A8%80%E7%9A%84JReBloom%E3%80%82%E6%9C%89%E5%85%B4%E8%B6%A3%E7%9A%84%E6%9C%8B%E5%8F%8B%E5%8F%AF%E4%BB%A5%E8%87%AA%E8%A1%8C%E4%BA%86%E8%A7%A3%E3%80%82">https://github.com/RedisBloom/RedisBloomã€‚ä¸Šé¢æœ‰dockerä¸€é”®å¯åŠ¨å‘½ä»¤ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®éªŒã€‚ä¹Ÿæœ‰å‡ ç§ä¸»æµè¯­è¨€çš„å®¢æˆ·ç«¯åº“çš„é“¾æ¥ï¼Œæ¯”å¦‚Javaè¯­è¨€çš„JReBloomã€‚æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œäº†è§£ã€‚</a></p><p>Redisçš„å¸ƒéš†è¿‡æ»¤å™¨ä¸»è¦æœ‰ä¸¤ä¸ªå‘½ä»¤ï¼š</p><ul><li><code>bf.add</code> æ·»åŠ å…ƒç´ åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼š<code>bf.add strs xy</code></li><li><code>bf.exists</code> åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨è¿‡æ»¤å™¨ä¸­ï¼š<code>bf.exists strs xy</code></li></ul><p>Redisä¸­æœ‰ä¸€ä¸ªå‘½ä»¤å¯ä»¥æ¥è®¾ç½®å¸ƒéš†è¿‡æ»¤å™¨çš„å‡†ç¡®ç‡ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">bf</span>.reserve strs <span class="hljs-number">0</span>.<span class="hljs-number">01</span> <span class="hljs-number">100</span><br></code></pre></td></tr></table></figure><p>ä¸‰ä¸ªå‚æ•°çš„å«ä¹‰ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå€¼æ˜¯è¿‡æ»¤å™¨çš„åå­—ã€‚</li><li>ç¬¬äºŒä¸ªå€¼ä¸º<code>error_rate</code>çš„å€¼ï¼šå…è®¸å¸ƒéš†è¿‡æ»¤å™¨çš„é”™è¯¯ç‡ã€‚</li><li>ç¬¬ä¸‰ä¸ªå€¼ä¸º<code>initial_size</code>çš„å€¼ï¼šåˆå§‹åŒ–ä½æ•°ç»„çš„å¤§å°ã€‚</li></ul><h2 id="æ‰©å±•å­¦ä¹ ">æ‰©å±•å­¦ä¹ </h2><h3 id="Javaå®ç°çš„å¸ƒéš†è¿‡æ»¤å™¨">Javaå®ç°çš„å¸ƒéš†è¿‡æ»¤å™¨</h3><p>å¦‚æœä½ çš„é¡¹ç›®æ²¡æœ‰ä½¿ç”¨Redisï¼Œé‚£å¯ä»¥ä½¿ç”¨ä¸€äº›å¼€æºåº“ï¼ŒåŸºäºä»£ç å®ç°ï¼Œç›´æ¥å­˜æ”¾åœ¨å†…å­˜ã€‚æ¯”å¦‚Googleçš„guavaåŒ…ä¸­æä¾›äº†<code>BloomFilter</code>ç±»ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥å»äº†è§£ä¸€ä¸‹ï¼Œç ”ç©¶ç ”ç©¶æºç å’Œä½¿ç”¨ã€‚</p><h3 id="å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨">å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨</h3><p>RedisBloomæ¨¡å—è¿˜å®ç°äº†å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼Œå®ƒç®—æ˜¯å¯¹å¸ƒéš†è¿‡æ»¤å™¨çš„å¢å¼ºç‰ˆã€‚è§£å†³äº†å¸ƒéš†è¿‡æ»¤å™¨çš„ä¸€äº›æ¯”è¾ƒæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œæ¯”å¦‚ï¼šä¸èƒ½åˆ é™¤å…ƒç´ ï¼Œä¸èƒ½è®¡æ•°ç­‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ä¸ç”¨ä½¿ç”¨å¤šä¸ªhashå‡½æ•°ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½æ›´é«˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ç›¸åŒçš„è¯¯åˆ¤ç‡ä¸‹ï¼Œå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨çš„ç©ºé—´åˆ©ç”¨ç‡è¦æ˜æ˜¾é«˜äºå¸ƒéš†ï¼Œç©ºé—´ä¸Šå¤§æ¦‚èƒ½èŠ‚çœ40%å¤šã€‚</p><p>ç¬”è€…ä¸ªäººè§‰å¾—ï¼Œå¯¹äºå¤§å¤šæ•°åœºæ™¯æ¥è¯´ï¼Œå¸ƒéš†è¿‡æ»¤å™¨è¶³ä»¥è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚</p><p>æ˜é‡‘ä¸Šæœ‰ä¸€ç¯‡æ·±åº¦åˆ†æå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨çš„æ–‡ç« ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥å»äº†è§£ä¸€ä¸‹ï¼š<a href="https://juejin.im/post/5cfb9c74e51d455d6d5357db%E3%80%82">https://juejin.im/post/5cfb9c74e51d455d6d5357dbã€‚</a></p><h2 id="é¢è¯•é¢˜">é¢è¯•é¢˜</h2><h3 id="1-ç»™å®šaã€bä¸¤ä¸ªæ–‡ä»¶ï¼Œå„å­˜æ”¾50äº¿ä¸ªurlï¼Œæ¯ä¸ªurlå„å 64å­—èŠ‚ï¼Œå†…å­˜é™åˆ¶æ˜¯4Gï¼Œè®©ä½ æ‰¾å‡ºaã€bæ–‡ä»¶å…±åŒçš„url">1.ç»™å®šaã€bä¸¤ä¸ªæ–‡ä»¶ï¼Œå„å­˜æ”¾50äº¿ä¸ªurlï¼Œæ¯ä¸ªurlå„å 64å­—èŠ‚ï¼Œå†…å­˜é™åˆ¶æ˜¯4Gï¼Œè®©ä½ æ‰¾å‡ºaã€bæ–‡ä»¶å…±åŒçš„url?</h3><p>1.é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå‡è®¾å¸ƒéš†è¿‡æ»¤å™¨çš„é”™è¯¯ç‡ä¸º0.01ï¼Œåˆ™ä½æ•°ç»„å¤§å°mçº¦ä¸ºè¾“å…¥å…ƒç´ ä¸ªæ•°nçš„13å€ï¼Œæ­¤æ—¶éœ€è¦çš„å“ˆå¸Œå‡½æ•°kçº¦ä¸º8ä¸ªã€‚</p><p>å…ƒç´ ä¸ªæ•°ï¼š5G</p><p>ä½æ•°ç»„å¤§å°ï¼šm = 5g x 13 = 65G = 650äº¿bit</p><p>æˆ‘ä»¬çš„å†…å­˜æ˜¯ 4g x 8bit = 32G = 320äº¿bitã€‚æŒ‰æ­¤é”™è¯¯ç‡å¤§äº0.01</p><p>2.é‡‡ç”¨åˆ†æ²»çš„æ€æƒ³</p><img src="/dajiangdahe.github.io/2021/10/22/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/20191023182333584.jpg" class="" title="img"><p>Step1ï¼šéå†æ–‡ä»¶aï¼Œå¯¹æ¯ä¸ªurlæ±‚å–hash(url)%1000ï¼Œç„¶åæ ¹æ®æ‰€å–å¾—çš„å€¼å°†urlåˆ†åˆ«å­˜å‚¨åˆ°1000ä¸ªå°æ–‡ä»¶(è®°ä¸ºa0,a1,â€¦,a999ï¼Œæ¯ä¸ªå°æ–‡ä»¶çº¦300M);</p><p>Step2:éå†æ–‡ä»¶bï¼Œé‡‡å–å’Œaç›¸åŒçš„æ–¹å¼å°†urlåˆ†åˆ«å­˜å‚¨åˆ°1000ä¸ªå°æ–‡ä»¶(è®°ä¸ºb0,b1,â€¦,b999);</p><p>å·§å¦™ä¹‹å¤„ï¼šè¿™æ ·å¤„ç†åï¼Œæ‰€æœ‰å¯èƒ½ç›¸åŒçš„urléƒ½è¢«ä¿å­˜åœ¨å¯¹åº”çš„å°æ–‡ä»¶(a0vsb0,a1vsb1,â€¦,a999vsb999)ä¸­ï¼Œä¸å¯¹åº”çš„å°æ–‡ä»¶ä¸å¯èƒ½æœ‰ç›¸åŒçš„urlã€‚ç„¶åæˆ‘ä»¬åªè¦æ±‚å‡ºè¿™ä¸ª1000å¯¹å°æ–‡ä»¶ä¸­ç›¸åŒçš„urlå³å¯ã€‚</p><p>Step3ï¼šæ±‚æ¯å¯¹å°æ–‡ä»¶aiå’Œbiä¸­ç›¸åŒçš„urlæ—¶ï¼Œå¯ä»¥æŠŠaiçš„urlå­˜å‚¨åˆ°hash_set/hash_mapä¸­ã€‚ç„¶åéå†biçš„æ¯ä¸ªurlï¼Œçœ‹å…¶æ˜¯å¦åœ¨åˆšæ‰æ„å»ºçš„hash_setä¸­ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå°±æ˜¯å…±åŒçš„urlï¼Œå­˜åˆ°æ–‡ä»¶é‡Œé¢å°±å¯ä»¥äº†ã€‚</p><h2 id="ã€è¡¥å……ã€‘">ã€è¡¥å……ã€‘</h2><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨hashï¼Ÿ">ä¸ºä»€ä¹ˆä½¿ç”¨hashï¼Ÿ</h3><p>æ˜¯æŠŠä»»æ„é•¿åº¦çš„è¾“å…¥ï¼ˆåˆå«åšé¢„æ˜ å°„pre-imageï¼‰é€šè¿‡æ•£åˆ—ç®—æ³•å˜æ¢æˆå›ºå®šé•¿åº¦çš„è¾“å‡ºï¼Œè¯¥è¾“å‡ºå°±æ˜¯æ•£åˆ—å€¼ã€‚è¿™ç§è½¬æ¢æ˜¯ä¸€ç§å‹ç¼©æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯ï¼Œæ•£åˆ—å€¼çš„ç©ºé—´é€šå¸¸è¿œå°äºè¾“å…¥çš„ç©ºé—´ï¼Œä¸åŒçš„è¾“å…¥å¯èƒ½ä¼šæ•£åˆ—æˆç›¸åŒçš„è¾“å‡ºï¼Œæ‰€ä»¥ä¸å¯èƒ½ä»æ•£åˆ—å€¼æ¥ç¡®å®šå”¯ä¸€çš„è¾“å…¥å€¼ã€‚ç®€å•çš„è¯´å°±æ˜¯ä¸€ç§å°†ä»»æ„é•¿åº¦çš„æ¶ˆæ¯å‹ç¼©åˆ°æŸä¸€å›ºå®šé•¿åº¦çš„æ¶ˆæ¯æ‘˜è¦çš„å‡½æ•°ã€‚</p><h2 id="ã€æ³¨ã€‘">ã€æ³¨ã€‘</h2><p>1ã€Hashå–æ¨¡æ˜¯ä¸€ç§ç­‰ä»·æ˜ å°„ï¼Œä¸ä¼šå­˜åœ¨åŒä¸€ä¸ªå…ƒç´ åˆ†æ•£åˆ°ä¸åŒå°æ–‡ä»¶ä¸­çš„æƒ…å†µï¼Œå³è¿™é‡Œé‡‡ç”¨çš„æ˜¯mod1000ç®—æ³•ï¼Œé‚£ä¹ˆç›¸åŒçš„urlåœ¨hashå–æ¨¡åï¼Œåªå¯èƒ½è½åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸å¯èƒ½è¢«åˆ†æ•£çš„ã€‚å› ä¸ºå¦‚æœä¸¤ä¸ªurlç›¸ç­‰ï¼Œé‚£ä¹ˆç»è¿‡Hash(url)ä¹‹åçš„å“ˆå¸Œå€¼æ˜¯ç›¸åŒçš„ï¼Œå°†æ­¤å“ˆå¸Œå€¼å–æ¨¡ï¼ˆå¦‚æ¨¡1000ï¼‰ï¼Œå¿…å®šä»ç„¶ç›¸ç­‰ã€‚</p><p>2ã€é‚£åˆ°åº•ä»€ä¹ˆæ˜¯hashæ˜ å°„å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸ºäº†ä¾¿äºè®¡ç®—æœºåœ¨æœ‰é™çš„å†…å­˜ä¸­å¤„ç†bigæ•°æ®ï¼Œä»è€Œé€šè¿‡ä¸€ç§æ˜ å°„æ•£åˆ—çš„æ–¹å¼è®©æ•°æ®å‡åŒ€åˆ†å¸ƒåœ¨å¯¹åº”çš„å†…å­˜ä½ç½®(å¦‚å¤§æ•°æ®é€šè¿‡å–ä½™çš„æ–¹å¼æ˜ å°„æˆå°æ ‘å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œæˆ–å¤§æ–‡ä»¶æ˜ å°„æˆå¤šä¸ªå°æ–‡ä»¶)ï¼Œè€Œè¿™ä¸ªæ˜ å°„æ•£åˆ—æ–¹å¼ä¾¿æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„hashå‡½æ•°ï¼Œè®¾è®¡çš„å¥½çš„hashå‡½æ•°èƒ½è®©æ•°æ®å‡åŒ€åˆ†å¸ƒè€Œå‡å°‘å†²çªã€‚å°½ç®¡æ•°æ®æ˜ å°„åˆ°äº†å¦å¤–ä¸€äº›ä¸åŒçš„ä½ç½®ï¼Œä½†æ•°æ®è¿˜æ˜¯åŸæ¥çš„æ•°æ®ï¼Œåªæ˜¯ä»£æ›¿å’Œè¡¨ç¤ºè¿™äº›åŸå§‹æ•°æ®çš„å½¢å¼å‘ç”Ÿäº†å˜åŒ–è€Œå·²ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è§£è¯»åŸºé‡‘</title>
    <link href="/dajiangdahe/2021/10/22/%E3%80%90%E7%BB%8F%E6%B5%8E%E3%80%91%E8%A7%A3%E8%AF%BB%E5%9F%BA%E9%87%91/"/>
    <url>/dajiangdahe/2021/10/22/%E3%80%90%E7%BB%8F%E6%B5%8E%E3%80%91%E8%A7%A3%E8%AF%BB%E5%9F%BA%E9%87%91/</url>
    
    <content type="html"><![CDATA[<h1>è§£è¯»åŸºé‡‘ï¼ˆå­£å‡¯å¸†ï¼‰</h1><h2 id="1-æŠ•èµ„çš„å‡†å¤‡">1.æŠ•èµ„çš„å‡†å¤‡</h2><ol><li>æŠ•èµ„å‘¨æœŸçš„ç¡®å®šï¼šè¿™ç¬”æŠ•èµ„çš„ç›®çš„æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿé•¿æœŸæŠ•èµ„ï¼Ÿä¸­æœŸæŠ•èµ„ï¼ŸçŸ­æœŸæŠ•èµ„ï¼Ÿ</li><li>æŠ•èµ„æœ¬é’±ï¼šè¿™ç¬”é’±èƒ½å¤Ÿç¡®ä¿ä¸ä¼šå½±å“æˆ‘çš„æ—¥å¸¸ç”Ÿæ´»ä»¥åŠè½»å¾®äº‹æ•…å‘ç”Ÿã€‚</li><li>åŸºé‡‘å¦‚ä½•ç›ˆåˆ©çš„æ¨¡å¼ä»¥åŠéƒ¨åˆ†åŸºæœ¬æ¦‚å¿µç­‰ï¼Œå¦‚å¤æ™®æ¯”ï¼Œå›æ’¤ç‡ï¼Œæ³¢åŠ¨ç‡ç­‰ã€‚</li><li>å…³äºè‡ªå·±å¯¹äºé£é™©æ‰¿æ‹…èƒ½åŠ›çš„è¯„ä¼°</li></ol><h2 id="2-æŠ•èµ„ç›®æ ‡çš„ç¡®å®š">2.æŠ•èµ„ç›®æ ‡çš„ç¡®å®š</h2><ol><li>äº†è§£åŸºé‡‘çš„é£é™©å’Œç›ˆåˆ©èƒ½åŠ›</li><li>å¤åˆ©è®¡ç®—æ³•åˆ™ï¼š72æ³•åˆ™ï¼Œ115æ³•åˆ™ç­‰ç­‰<ol><li>æœ¬é‡‘ç•ªä¸€å€å’Œç¿»ä¸¤å€çš„è®¡ç®—å…¬å¼ï¼Œé™¤å¹´åŒ–ç‡å³å¯ï¼ˆåœ¨ä¸è®¡ç®—é€šè´§è†¨èƒ€çš„æƒ…å†µä¸‹ï¼‰</li></ol></li></ol><h2 id="3-åŸºé‡‘å“ç§çš„é€‰æ‹©">3.åŸºé‡‘å“ç§çš„é€‰æ‹©</h2><ol><li>åŸºé‡‘è¯„ä»·ç½‘ç«™ï¼šæ™¨æ˜Ÿã€‚<ol><li>é€šè¿‡é€‰æ‹©ä¸€å®¶å¥½çš„åŸºé‡‘å…¬å¸å’Œä¸€ä¸ªå¥½çš„åŸºé‡‘ç»ç†æ¯”é€‰æ‹©ä¸€åªå¥½çš„åŸºé‡‘æ›´é‡è¦</li><li>åœ¨è‚¡å¸‚æ‘¸çˆ¬æ»šæ‰“äº†å¥½å¤šå¹´çš„åŸºé‡‘ç»ç†è¿œæ¯”ä¸€ä¸ªåˆšæ¯•ä¸šçš„å­¦ç”Ÿæ›´ä¼šæ‰“ç†ä½ çš„é’±è´¢</li></ol></li><li>èµ„äº§é…ç½®æ¯”ç‡<ol><li>èµ„äº§é…ç½®ï¼šè‚¡ç¥¨å’Œå€ºåˆ¸çš„é…æ¯”ï¼Œè¿™æ˜¯ä¸ä½ çš„æŠ•èµ„å‘¨æœŸæ˜¯ç¡®å®šçš„ï¼ŒæŠ•èµ„å‘¨æœŸé•¿ï¼Œè‚¡ç¥¨æ¯”ä¾‹é«˜ï¼Œå½“æ¥è¿‘æŠ•èµ„å‘¨æœŸçš„æœ«æœŸæ—¶ï¼Œå€ºåˆ¸æ¯”ä¾‹æå‡ï¼Œè‚¡ç¥¨æ¯”ä¾‹ä¸‹é™ã€‚ï¼ˆåŸºé‡‘çš„æ¿€è¿›æ€§ï¼‰</li><li>èµ„äº§é…ç½®ï¼šæ ¸å¿ƒèµ„äº§å’Œéæ ¸å¿ƒèµ„äº§ä»¥åŠç˜Ÿé¸¡ï¼š1.æ ¸å¿ƒèµ„äº§è·ŸéšæŠ•èµ„å‘¨æœŸé€‰å®šï¼Œä¸€èˆ¬è®¾ç½®å€ºåˆ¸æˆ–è€…æ³¢åŠ¨è¾ƒå°çš„åŸºé‡‘ç»„åˆæˆ–è€…å¤§ç›˜ï¼Œä¸­ç›˜ï¼Œå°ç›˜ï¼Œé‡‡ç”¨æ ¸å¿ƒ+å«æ˜Ÿçš„æ–¹å¼2.å«æ˜Ÿä½œä¸ºéæ ¸å¿ƒèµ„äº§å¯ä»¥é€‰æ‹©å•ä¸€æŒ‡æ•°äº§å“ï¼Œéæ··åˆå‹ã€‚3.ç˜Ÿé¸¡åˆ™æ˜¯å…·æœ‰å‘å±•æ½œåŠ›ï¼Œä½†æ˜¯ç›®å‰ä»æœªæ˜¾ç°çš„ã€‚</li><li>èµ„äº§é…ç½®ï¼šä¿è¯æ¯åªåŸºé‡‘çš„ç‹¬ç«‹æ€§ã€‚è¿™æ ·èƒ½å¤Ÿé¿å…æ¿å—è®ºè°ƒçš„é£é™©ã€‚</li></ol></li><li>è°ƒæ§é«˜å‡€å€¼ä¸‹çš„æ‰‹æ®µï¼šé€šè¿‡åŸºé‡‘æ‹†å¼€å’Œåˆ†çº¢æ¥è§£å†³</li><li>æ–°åŸºé‡‘å’Œè€åŸºé‡‘çš„æŠ‰æ‹©ï¼šè€åŸºé‡‘</li><li>FOFå’Œâ€œç”Ÿå‘½å‘¨æœŸâ€åŸºé‡‘</li><li>åˆ†æ•£æŠ•èµ„å’Œå†å¹³è¡¡ã€‚</li></ol><h2 id="4-æ“ä½œæ–¹æ³•çš„å®æ–½">4.æ“ä½œæ–¹æ³•çš„å®æ–½</h2><ol><li>åˆ†çº¢æ–¹å¼çš„é€‰æ‹©ï¼šçº¢åˆ©å†æŠ•èµ„</li><li>åŸºé‡‘Aç±»å’ŒCç±»çš„åŒºåˆ«ï¼šå‰ç«¯æ”¶è´¹è¿˜æ˜¯åç«¯æ”¶è´¹ï¼Œå¤§äº3å¹´ï¼ŒAç±»ï¼Œå°äº3å¹´ï¼ŒCç±»</li><li>ä¸è¦è¿›è¡Œæ³¢æ®µæ“ä½œå’Œé¢„æµ‹å¸‚åœº</li><li>ä¸€æ¬¡æ€§æŠ•èµ„å’Œå®šæŠ•æŠ€æœ¯å’Œåˆ†æ­¥è¿›åœº<ol><li>ä¸€æ¬¡æ€§æŠ•èµ„å°±æ˜¯ä¸€æ¬¡æ€§åœ¨ä½ç‚¹å…¨éƒ¨æŠ•èµ„è¿›å»</li><li>å®šæŠ•å°±æ˜¯æ¯å‘¨æˆ–è€…æ¯æœˆå¯»æ±‚ä½ç‚¹æŠ•å…¥ï¼Œæˆ–é€‰æ‹©æ™ºèƒ½å®šæŠ•ï¼Œå¯ä»¥å¹³æ»‘æ‰å¸‚åœºçš„çŸ­æœŸæ³¢åŠ¨</li><li>åˆ†æ­¥è¿›åœºå°±æ˜¯æ ¹æ®æ€»é‡‘é¢ï¼Œè¿›è¡Œåˆ†å±‚æŠ•èµ„ã€‚ä¸€æ­¥æ­¥å…¥åœº</li></ol></li><li>æŒæœ‰åŸºé‡‘çš„æœ€ä¼˜ç­–ç•¥å°±æ˜¯é•¿æœŸæŒæœ‰</li><li>åŸºé‡‘èµå›<ol><li>è¾¾åˆ°æŠ•èµ„å‘¨æœŸç›®æ ‡</li><li>åŸºæœ¬é¢å—åˆ°æ”¹å˜ï¼Œå¦‚åŸºé‡‘çš„æŒä»“æƒ…å†µã€åŸºé‡‘ç»ç†äººçš„å˜åŒ–ç­‰</li><li>å½“å¸‚åœºéå¸¸ç‹‚çƒ­çš„æ—¶å€™</li></ol></li></ol><h2 id="5-æŠ•èµ„å®è·µ">5.æŠ•èµ„å®è·µ</h2><ol><li>ç»å¯¹ä¸èƒ½ä½¿ç”¨æ æ†æŠ•èµ„ï¼Œä¸€å®šæ˜¯é—²é’±</li><li>æˆ‘ä»¬çš„ç›®çš„æ˜¯é™ä½é£é™©ï¼Œè·å–å›æŠ¥ï¼Œè€Œä¸æ˜¯è¿½æ±‚æœ€å¤§åˆ©ç›Š<ol><li>æˆ‘ä»¬çš„ç›®çš„æ˜¯é™ä½é£é™©ï¼Œè·å–å›æŠ¥ï¼Œè€Œä¸æ˜¯è¿½æ±‚æœ€å¤§åˆ©ç›Š</li></ol></li><li>åšæŒé•¿æœŸæŒæœ‰</li><li>ç»å¯¹ä¸èƒ½è¿›è¡Œæ³¢æ®µæ“ä½œ</li><li>è‚¡å¸‚ä¸ä¼šåˆ›é€ æŠ•èµ„ï¼Œæˆ‘ä»¬èµšçš„é’±æ˜¯ä¼ä¸šå‘å±•çš„é’±ï¼Œæ˜¯æ—¶ä»£çš„é’±ã€‚</li><li>å¯¹çŸ­æœŸçš„éœ‡è¡ä¸è¦å¤ªè¿‡åœ¨æ„ï¼Œè®°ä½è¿™æ˜¯ä¸€ä»¶é•¿æœŸæŒæœ‰çš„äº‹æƒ…</li><li>ç§¯æè¿›æ”»å’Œè¢«åŠ¨é˜²å¾¡<ol><li>å¯¹ä¸€ç»„ç”±è‚¡ç¥¨ã€å€ºåˆ¸å’ŒåŸºé‡‘æ„æˆçš„åŠ¨æ€æŠ•èµ„ç»„åˆï¼Œè¿›è¡Œä¸æ–­çš„ç ”ç©¶ï¼Œç­›é€‰å’Œè°ƒæ§</li><li>ä»¥æŸç§è‡ªåŠ¨çš„æ–¹å¼ï¼Œåˆ›å»ºä¸€ä¸ªæ’ä¹…çš„æŠ•èµ„ç»„åˆï¼Œä¸å†ä»˜å‡ºæ›´å¤šçš„åŠªåŠ›</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç»æµ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æŒ‡æ•°åŸºé‡‘æŠ•èµ„æŒ‡å—</title>
    <link href="/dajiangdahe/2021/10/22/%E3%80%90%E7%BB%8F%E6%B5%8E%E3%80%91%E6%8C%87%E6%95%B0%E5%9F%BA%E9%87%91%E6%8A%95%E8%B5%84%E6%8C%87%E5%8D%97/"/>
    <url>/dajiangdahe/2021/10/22/%E3%80%90%E7%BB%8F%E6%B5%8E%E3%80%91%E6%8C%87%E6%95%B0%E5%9F%BA%E9%87%91%E6%8A%95%E8%B5%84%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<h1>æŒ‡æ•°åŸºé‡‘æŠ•èµ„æŒ‡å—ï¼ˆé›ªçƒï¼‰</h1><h2 id="1-åˆè¯†æŒ‡æ•°åŸºé‡‘">1.åˆè¯†æŒ‡æ•°åŸºé‡‘</h2><ol><li>æŒ‡æ•°åŸºé‡‘å®šä¹‰ï¼šæ ¹æ®æŒ‡æ•°ç¼–åˆ¶æ–¹æ¡ˆï¼Œé€‰æ‹©ç›¸åº”çš„æˆåˆ†è‚¡ã€‚æ˜¯ä¸€ç¯®å­è‚¡ç¥¨ã€‚</li><li>æŒ‡æ•°åŸºé‡‘åˆ†ç±»ï¼šï¼ˆ1ï¼‰åœºå†…å’Œåœºå¤–åŸºé‡‘ï¼šåŒºåˆ«ï¼šåœºå†…åŸºé‡‘å…·å¤‡è‚¡ç¥¨æ€§è´¨ï¼ŒT+0äº¤æ˜“ã€‚åœºå¤–åŸºé‡‘T+1äº¤æ˜“ã€‚ï¼ˆ2ï¼‰å¤§ä¸­å°ç›˜è‚¡ï¼šæŒ‰ç…§å¸‚å€¼åˆ’åˆ†ã€‚ï¼ˆ3ï¼‰å®½çª„åŸºï¼šè·Ÿè¸ªæ ‡çš„è¦†ç›–èŒƒå›´ã€‚ï¼ˆ4ï¼‰æŒ‡æ•°å¢å¼ºå‹ï¼šæŒ‰ç…§å¤åˆ¶ç¨‹åº¦ã€‚ï¼ˆ5ï¼‰Aå’ŒCç±»ï¼šæŒ‰ç…§æ”¶è´¹å½¢å¼ä¸åŒï¼Œåˆ†ä¸ºå‰ç«¯æ”¶è´¹å’Œåç«¯æ”¶è´¹ã€‚ï¼ˆ6ï¼‰åŠ æƒåŸºé‡‘ï¼šæŒ‰ä»¥æŸç§ç­–ç•¥å¯¹å…¶å¸‚å€¼å› å­è¿›è¡ŒåŠ æƒã€‚</li><li>æŒ‡æ•°åŸºé‡‘ä¼˜ç‚¹ï¼š1.å…·å¤‡ä¼˜èƒœåŠ£æ±°çš„åŠŸèƒ½ã€‚2.æ°¸ä¹…å­˜åœ¨ï¼Œæ— éœ€è€ƒè™‘å…¬å¸é€€å¸‚æˆ–å€’é—­çš„é£é™©ã€‚3.æŒä»“é€æ˜ï¼Œæ— æƒ§åŸºé‡‘ç»çºªäººçš„é“å¾·é£é™©ã€‚4.æ— éœ€æ‹…å¿ƒåŸºé‡‘ç»ç†çš„èƒ½åŠ›ä¸è¶³ã€‚5.æˆæœ¬å’Œè´¹ç‡ä¼˜åŠ¿ã€‚</li><li>æŒ‡æ•°åŸºé‡‘ç¼ºç‚¹ï¼š1.æ— æ³•è·å¾—è¶…é¢æ”¶ç›Šã€‚2.å¼±å¸‚è¡Œæƒ…çš„æŠ—é£é™©èƒ½åŠ›ä¸è¶³ã€‚</li><li>å†å²ï¼š2002å¹´ï¼Œåå®‰åŸºé‡‘å‘è¡Œä¸Šè¯180æŒ‡æ•°å¢å¼ºå‹åŸºé‡‘ã€‚</li></ol><h2 id="2-å¦‚ä½•æŒ‘é€‰æŒ‡æ•°åŸºé‡‘">2.å¦‚ä½•æŒ‘é€‰æŒ‡æ•°åŸºé‡‘</h2><ol><li>æŒ‡æ•°åˆ†ç±»<ol><li>ç»¼åˆæŒ‡æ•°ï¼šåæ˜ å‡ºæŸä¸ªå¸‚åœºçš„æƒ…å†µã€‚è¡¨å¾å¸‚åœºä½œç”¨ï¼ŒæŠ•èµ„åŠŸèƒ½è¾ƒå¼±ã€‚å¦‚ä¸Šè¯ç»¼æŒ‡ï¼Œæ²ªæ·±ç»¼æŒ‡</li><li>ç»¼åˆæŒ‡æ•°ï¼šåæ˜ å‡ºæŸä¸ªå¸‚åœºçš„æƒ…å†µã€‚è¡¨å¾å¸‚åœºä½œç”¨ï¼ŒæŠ•èµ„åŠŸèƒ½è¾ƒå¼±ã€‚å¦‚ä¸Šè¯ç»¼æŒ‡ï¼Œæ²ªæ·±ç»¼æŒ‡</li><li>è¡Œä¸šæŒ‡æ•°ï¼šæ ¹æ®ã€ŠXXXåˆ†ç±»æ ‡å‡†ã€‹è¿›è¡Œåˆ’åˆ†ï¼Œå°†è¥æ”¶&gt;50%çš„åˆ’å…¥å…¶ä¸­ã€‚åˆ†ä¸ºä¸€çº§äºŒçº§ä¸‰çº§å››çº§è¡Œä¸šã€‚éœ€è¦æœ‰éå¸¸ä¸“ä¸šçš„çŸ¥è¯†ã€‚å¦‚ä¸­è¯èƒ½æºï¼Œä¸­è¯ææ–™ã€‚</li><li>ä¸»é¢˜æŒ‡æ•°ï¼šè‡ªä¸Šè€Œä¸‹çš„æŠ•èµ„æ–¹å¼ï¼ˆä¸»åŠ¨æŠ•èµ„ï¼‰ã€‚é€šè¿‡è¯„ä¼°ç¤¾ä¼šçš„å½¢æ€ç»“æ„ï¼Œç¡®è®¤æŸäº›é¢†åŸŸçš„å˜é©è¶‹åŠ¿å’Œé©±åŠ¨å› ç´ ã€‚æŠ•èµ„æ—¶é—´é•¿æŠŠæ¡ä¸­é•¿æœŸè¶‹åŠ¿ã€‚æ˜¯è¡Œä¸šçš„é›†åˆä½“ã€‚å¦‚ï¼šæ–°èƒ½æºä¸»é¢˜ï¼Œå…ˆè¿›åˆ¶é€ ä¸»é¢˜ã€‚</li><li>é£æ ¼æŒ‡æ•°ï¼šæˆé•¿å‹å’Œä»·å€¼å‹é£æ ¼å’Œç¨³å®šæ€§ã€‚é€šè¿‡å¸‚å‡€ç‡ï¼Œå¸‚ç›ˆç‡åˆ’åˆ†ã€‚åˆ†ä¸ºå¤§ä¸­å°ç›˜è‚¡ã€‚ç¨³å®šæ€§ç”¨äºè¡¡é‡è‚¡ä»·å¯¹å¸‚åœºç¯å¢ƒå˜åŒ–çš„æ•æ„Ÿåº¦ã€‚å¦‚300æˆé•¿ï¼Œ300ä»·å€¼ã€‚æˆé•¿å‹æ›´æ¿€è¿›ï¼Œä»·å€¼å‹æ›´ç¨³å¥ã€‚</li><li>ç­–ç•¥æŒ‡æ•°ï¼šé€šè¿‡äººä¸ºçš„è°ƒæ•´è¿™ä¸ªéƒ¨åˆ†ç¬¦åˆç‰¹å¾æ¡ä»¶çš„é“¶å­ï¼Œç›®çš„æ˜¯è·å–è¶…é¢æ”¶ç›Šã€‚ç¼–åˆ¶æ–¹å¼é‡‡å–äº†éå¸‚å€¼åŠ æƒçš„æ–¹å¼ã€‚åŒ…æ‹¬åŸºæœ¬é¢åŠ æƒã€æ³¢åŠ¨ç‡åŠ æƒç­‰ã€‚å—ç›Šæ–¹å‘å¯ä»¥åšå¤šï¼Œä¹Ÿå¯ä»¥åšç©ºã€‚ä¸æ˜¯å•è¾¹çš„ã€‚</li></ol></li><li>æŒ‡æ•°é€‰æ‹©çºµå‘<ol><li>æŒ‡æ•°ç‚¹ä½æ³•ï¼šé€šè¿‡å¤§ç›˜çš„ä¼°å€¼è¿›è¡Œé€‰æ‹©ã€‚ï¼ˆå¦‚ä¸Šè¯ç»¼æŒ‡3500ä¸ºé«˜ï¼Œ2000ä¸ºä½ã€‚ï¼‰<ol><li>ä¼˜ç‚¹ï¼šç®€å•æ˜äº†ï¼Œé€‚åˆå°ç™½ã€‚æ­¤ç‚¹ä½ä»£è¡¨è‚¡ä»·ï¼Œä¹Ÿä»£è¡¨ä¼°å€¼ã€‚</li><li>ç¼ºç‚¹ï¼šæˆåˆ†è‚¡ä¸æ–­å˜åŒ–ï¼Œä¸šç»©ä¹Ÿä¸æ˜¯ä¸€æˆä¸å˜ã€‚å±€é™æ€§å¤§ï¼Œå¯ä½œä¸ºè§‚å¯ŸæŒ‡æ ‡</li></ol></li><li>å¸‚ç›ˆç‡æ³•ï¼šè‚¡ä»·/æ¯è‚¡æ”¶ç›Šã€‚æˆ–è€…å¸‚å€¼/å‡€åˆ©æ¶¦ï¼Œæœ¬ç›Šæ¯”ã€‚ä»£è¡¨è¿™ä¸€é˜¶æ®µçš„ç›ˆåˆ©æ°´å¹³ã€‚é€‚ç”¨äºè¾ƒä¸ºç¨³å¥çš„è¡Œä¸šï¼ŒçŸ­æœŸä¸šç»©æ³¢åŠ¨ä¸€èˆ¬ä¸å¤§çš„ã€‚å¦‚æ¶ˆè´¹è¡Œä¸šï¼Œå…¬ç”¨äº‹ä¸šã€‚å‘¨æœŸè¾ƒå¼ºçš„å®¹æ˜“å¤±çœŸï¼šæ±½è½¦è¡Œä¸šã€é’¢é“ç…¤ç‚­è¡Œä¸šã€‚<ol><li>ä¼˜ç‚¹ï¼šå•åªè‚¡ç¥¨çš„å¼‚å¸¸æ³¢åŠ¨å½±å“è¾ƒä½ã€‚å…·æœ‰è¾ƒå¥½çš„å‚è€ƒæ€§ã€‚</li><li>ç¼ºç‚¹ï¼šå¦‚æœå¤§æ‰¹é‡æˆåˆ†è‚¡å‡ºç°å¼‚å¸¸æ³¢åŠ¨ï¼Œå°±ä¼šå¤±çœŸã€‚</li></ol></li><li>å¸‚å‡€ç‡æ³•ï¼šæ‰€æœ‰æˆåˆ†è‚¡çš„å¸‚å€¼ä¹‹å’Œ/ä¸å‡€èµ„äº§ä¹‹å’Œï¼Œæ˜¯ä¸€ç§ç›¸å¯¹é™æ€çš„ä¼°å€¼æ–¹æ³•ã€‚é€‚ç”¨äºä¸€å®šèµ„äº§è§„æ¨¡çš„è¡Œä¸šã€‚ä¸é€‚åˆäº’è”ç½‘å¹¿å‘Šã€æ¸¸æˆã€å½±è§†è¡Œä¸šã€‚<ol><li>ä¼˜ç‚¹ï¼šæ›´åŠ ç¨³å®šï¼Œä¸å®¹æ˜“å¤±çœŸã€‚</li></ol></li><li>ç›¸å¯¹ä¼°å€¼ç™¾åˆ†ä½æ³•ï¼šè¯„ä¼°å½“å‰ä¼°å€¼åœ¨å†å²ä¸Šçš„æ°´å¹³ã€‚é«˜ä¼°ã€ä½ä¼°åŒºç­‰ã€‚<ol><li>ä¼˜ç‚¹ï¼šç®€å•æ˜“æ‡‚ï¼Œå®ç”¨æ€§å¼ºï¼Œç›´è§‚ã€‚</li><li>ç¼ºç‚¹ï¼šå¯¹äºæˆç«‹æ—¶é—´è¾ƒæ™šçš„æŒ‡æ•°ï¼Œç¼ºä¹æ•°æ®ï¼Œå®¹æ˜“å¤±çœŸã€‚</li></ol></li><li>ä»·æ ¼æŒ‡æ•°å’Œå…¨æ”¶ç›ŠæŒ‡æ•°ï¼šç°é‡‘åˆ†çº¢å’Œçº¢åˆ©å†æŠ•èµ„çš„åŒºåˆ«ã€‚é•¿æœŸæ¥çœ‹é€‰æ‹©çº¢åˆ©å†æŠ•èµ„è¾ƒå¥½ã€‚è®ºè¯è¿‡äºå¤æ‚ã€‚ç±»ä¼¼äºå¾®å®šæŠ•ã€‚ï¼ˆç°é‡‘åˆ†çº¢è°ƒæ•´ï¼Œå¸‚å€¼é™ä½ã€‚ï¼‰<ol><li>æˆ‘ä»¬å¯ä»¥å¾—å‡ºçš„ç»“è®ºæ˜¯ï¼ŒæŒ‡æ•°æˆä»½è‚¡è‚¡æœ¬é‡ã€è‚¡æ¯ç‡ä¸å…¨æ”¶ç›ŠæŒ‡æ•°è¶…é¢æ”¶ç›Šç‡å‘ˆæ­£ç›¸å…³å…³ç³»ï¼Œè‚¡æœ¬è¶Šå¤§ã€è‚¡æ¯ç‡è¶Šé«˜ï¼Œå…¨æ”¶ç›ŠæŒ‡æ•°ç›¸å¯¹ä»·æ ¼æŒ‡æ•°çš„è¶…é¢æ”¶ç›Šç‡è¶Šé«˜ã€‚å…¨æ”¶ç›ŠæŒ‡æ•°æ”¶ç›Šç‡ä¸æŒ‡æ•°æ³¢åŠ¨ç‡å‘ˆè´Ÿç›¸å…³å…³ç³»ï¼Œæ³¢åŠ¨ç‡è¶Šä½çš„æŒ‡æ•°ï¼Œå…¶å…¨æ”¶ç›ŠæŒ‡æ•°ç›¸å¯¹ä»·æ ¼æŒ‡æ•°çš„è¶…é¢æ”¶ç›Šç‡è¶Šé«˜ã€‚</li></ol></li></ol></li><li>æŒ‡æ•°é€‰æ‹©æ¨ªå‘<ol><li>åŸºé‡‘è§„æ¨¡ï¼šå°ä¼—åŸºé‡‘5~20äº¿ã€‚çƒ­é—¨åŸºé‡‘ç™¾äº¿è¾ƒå¥½ã€‚</li><li>ç»¼åˆè´¹ç‡ï¼šåˆ†ä¸ºå‰ç«¯æ”¶è´¹å’Œåç«¯æ”¶è´¹ï¼šå¤§äº3å¹´é€‰æ‹©Aç±»ï¼Œå°äº3å¹´é€‰æ‹©Cç±»ã€‚</li><li>è·Ÿè¸ªè¯¯å·®ï¼šæŒ‡æ•°åŸºé‡‘å‡€å€¼æ”¶ç›Šç‡ä¸æ ‡çš„ä¹‹é—´æ”¶ç›Šç‡ç›´æ¥çš„åå·®ã€‚æŒ‡æ ‡ï¼šæ—¥å‡è·Ÿè¸ªåç¦»åº¦ç»å¯¹å€¼ï¼Œå¹´åŒ–è·Ÿè¸ªè¯¯å·®ã€‚è¯¯å·®è¶Šå°è¶Šå¥½ã€‚</li><li>æµåŠ¨æ€§ï¼šå‡è´´æ°´ç‡å¾€å¾€æ˜¯æµåŠ¨æ€§çš„é‡è¦å‚è€ƒæŒ‡æ ‡ã€‚ä½³å“¥ä¾¿å®œå‡€å€¼å¹…åº¦è¶Šä½ï¼ŒæµåŠ¨æ€§è¶Šå¥½ã€‚ï¼ˆäº¤æ˜“ä»·æ ¼é«˜äºå‡€å€¼ï¼Œå‡æ°´ï¼Œåä¹‹è´´æ°´ã€‚ï¼‰</li></ol></li><li>èµ„é‡‘é…ç½®æ–¹æ¡ˆ<ol><li>æ—¶é—´ç­‰åˆ†æ³•ï¼šæŠ•èµ„é‡‘é¢/æŠ•èµ„æœˆæ•°ã€å¹´ã€å‘¨ç­‰ã€‚</li><li>äºŒå…«åˆ†å‰²æ³•ï¼šæŠ•èµ„é‡‘é¢/æŠ•èµ„æœˆæ•°=Aï¼ŒMä¸ºæ¯ä¸ªæœˆå®šæŠ•æ¯”ä¾‹ï¼Œ1-Mä¸ºå¤‡ç”¨é‡‘ã€‚ Yï¼ˆè®¡åˆ’ï¼‰=AxM+Ax(1-M),å¢å¼ºå‹å³ä¸ºå¤‡ç”¨é‡‘ç”¨ä¸ä¸Šï¼Œå°±æ”’åˆ°ä¸‹ä¸ªæœˆæŠ•ã€‚<ol><li>ä¼˜ç‚¹ï¼šåº”å¯¹çªå‘æƒ…å†µæ›´å¼º</li></ol></li></ol></li><li>å®šæŠ•ä¹°å…¥ç­–ç•¥<ol><li>åŸºé‡‘å®šæŠ•å–å¾—æˆåŠŸçš„å…³é”®åœ¨äºåˆ¶å®šåˆé€‚çš„å®šæŠ•ç­–ç•¥ä¸çºªå¾‹æ€§åœ°æ‰§è¡Œç­–ç•¥ã€‚</li><li>å®šæœŸå®šé¢æ³•<ol><li>ä¼˜ç‚¹ï¼šç®€å•çœå¿ƒï¼Œé‡‘é¢ã€æœŸé™å¯æ§ã€‚</li><li>ç¼ºç‚¹ï¼šå‡ºç°å¤§å¹…ä¸‹è·Œæ—¶ï¼Œä¸èƒ½æ›´å¥½çš„å¹³æ‘Šæˆæœ¬ã€‚å¤§å¹…ä¸Šæ¶¨æ—¶ï¼Œä¼šæ‹‰é«˜æˆæœ¬ã€‚</li></ol></li></ol></li></ol><h2 id="3-å®šæŠ•ä¹°å…¥ç­–ç•¥">3.å®šæŠ•ä¹°å…¥ç­–ç•¥</h2><ol><li><p>åŸºé‡‘å®šæŠ•å–å¾—æˆåŠŸçš„å…³é”®åœ¨äºåˆ¶å®šåˆé€‚çš„å®šæŠ•ç­–ç•¥ä¸çºªå¾‹æ€§åœ°æ‰§è¡Œ</p></li><li><p>æœ¬æ¬¡ç­–ç•¥ä¸Šåˆ†ä¸ºä¸Šæ¶¨å¸‚ã€ä¸‹è·Œå¸‚ã€å…ˆæ¶¨åè·Œå¸‚ã€å…ˆè·Œåæ¶¨å¸‚ã€‚å…¶ä¸­æ¯ä¸ªç­–ç•¥è¿›è¡Œè¿‡æ¨¡æ‹Ÿã€å’Œå·²å­˜åœ¨çš„åŸºé‡‘è¿›è¡Œå›æµ‹ã€‚</p></li><li><p>1.å®šæœŸå®šé¢æ³•</p><ol><li>æ ¹æ®èµ„é‡‘åˆ’åˆ†næœŸï¼Œå¹³å‡åˆ†åˆ°næœŸä¸Šã€‚<ol><li>ä¼˜ç‚¹ï¼šå®šæœŸå®šé¢æ³•çš„ä¼˜ç‚¹æ˜¯çœå¿ƒã€ç®€å•æ˜“æ‡‚ã€é‡‘é¢å¯æ§ã€æœŸé™å¯æ§ã€é£é™©å¹³æ»‘ã€‚åªè¦åœ¨ç³»ç»Ÿé‡Œè®¾ç½®å¥½å®šæŠ•å‘¨æœŸå’Œæ¯æœŸçš„å®šæŠ•é‡‘é¢ï¼Œå‰©ä¸‹çš„å°±äº¤ç»™æ—¶é—´ã€‚å¯¹å·¥è–ªé˜¶å±‚è€Œè¨€ï¼Œå®šæœŸå®šé¢çš„é‡‘é¢å¯æ§ï¼Œå¯ä»¥åˆç†åœ°å®‰æ’æ¯ä¸ªæœˆçš„å¼€æ”¯ã€‚</li><li>ç¼ºç‚¹ï¼šå½“ç„¶ï¼Œå®šæœŸå®šé¢æ³•ä¹Ÿå­˜åœ¨å¾ˆå¤§çš„ç¼ºé™·ã€‚ä¾‹å¦‚ï¼Œå½“å¸‚åœºå‡ºç°å¤§å¹…ä¸‹è·Œåï¼Œæœ‰è¾ƒå¤§çš„æŠŠæ¡å¯ä»¥åˆ¤æ–­å¸‚åœºå¤„äºåº•éƒ¨é˜¶æ®µï¼Œä½†å®šæœŸå®šé¢æ³•ä¾æ—§åªèƒ½ä¹°å…¥ç›¸åŒçš„é‡‘é¢ï¼Œæ­¤æ—¶æ‘Šä½æˆæœ¬çš„æ•ˆæœè¾ƒå·®ã€‚å½“å¸‚åœºå‡ºç°ä¸Šæ¶¨æ—¶ï¼Œä¹Ÿä¼šæ‹‰é«˜æŠ•èµ„è€…çš„æŒä»“æˆæœ¬ã€‚</li><li>é€‚ç”¨äººç¾¤ï¼šä»»æ„</li><li>é€‚ç”¨äººç¾¤ï¼šä»»æ„</li></ol></li><li>ç›®æ ‡ç‚¹ä½ç³»æ•°æ³•<ol><li>æ ¸å¿ƒé€»è¾‘ä¸ºï¼šä½ä½å¤šä¹°ã€é«˜ä½å°‘ä¹°ã€‚æŠ•èµ„è€…ä»¥æ ‡çš„æŒ‡æ•°çš„ç‚¹ä½ä½œä¸ºå‚ç…§ç‰©ï¼Œå¿ƒä¸­ç»™å®šä¸€ä¸ªç›®æ ‡ç‚¹ä½ï¼Œè¿™ä¸ªç›®æ ‡ç‚¹ä½æ˜¯æŠ•èµ„è€…è®¤ä¸ºå¸‚åœºè¿›å…¥é«˜ä½è¿˜æ˜¯ä½ä½çš„ä¸´ç•Œç‚¹ã€‚ä¾‹å¦‚ï¼šä¸Šè¯æŒ‡æ•°3400ä¸ºå‚ç…§ç‰©ï¼Œé«˜äº3400å³ä¸ºé«˜ä½å…¥å¸‚ï¼Œä½äºä¸ºä½ä½å…¥å¸‚ã€‚</li><li>ç”³è´­é‡‘é¢ï¼šï¼ˆç›®æ ‡æŒ‡æ•°ç‚¹/å½“å‰æŒ‡æ•°ç‚¹ä½ï¼‰^n x åŸºç¡€é‡‘é¢ã€‚nçš„é€‰æ‹©æ ¹æ®è‡ªå·±ï¼Œç”¨æ¥æ§åˆ¶æŒ‡æ•°æ¶¨è·Œçš„å¹…åº¦ã€‚ä¸€èˆ¬10å³å¯<ol><li>ä¼˜ç‚¹ï¼šï¼ˆ1ï¼‰å…·æœ‰å‡ºè‰²çš„æˆæœ¬æ§åˆ¶èƒ½åŠ›ï¼Œå›æœ¬å‘¨æœŸæçŸ­ã€‚ï¼ˆ2ï¼‰æ”¶ç›Šç‡å§‹ç»ˆè·‘èµ¢æ™®é€šå®šæŠ•ã€‚ï¼ˆ3ï¼‰éå¸¸é€‚åˆä¸‹è·Œå¸‚å’Œå…ˆè·Œåæ¶¨å¸‚ã€‚</li><li>ç¼ºç‚¹ï¼šï¼ˆ1ï¼‰éœ€è¦æŠ•èµ„è€…å¯¹ç›®æ ‡ç‚¹ä½ä½œå‡ºç›¸å¯¹å‡†ç¡®çš„è¯„ä¼°ï¼Œå¢åŠ äº†æŠ•èµ„éš¾åº¦ã€‚ï¼ˆ2ï¼‰æŒ‡æ•°çš„æˆä»½è‚¡æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œå•çº¯çœ‹æŒ‡æ•°ç‚¹ä½æœ‰åˆ»èˆŸæ±‚å‰‘ä¹‹æ„ã€‚ï¼ˆ3ï¼‰åœ¨å•è¾¹ä¸Šæ¶¨è¶‹åŠ¿ä¸­ï¼Œè¿‡äºè¿½æ±‚æ”¶ç›Šç‡ä¼šä½¿å¾—æ€»æŠ•å…¥çš„ç»å¯¹é‡‘é¢è¿‡ä½ï¼Œå¯¼è‡´æ€»ç›ˆåˆ©ç»å¯¹é‡‘é¢è¾ƒå°‘ã€‚ï¼ˆ4ï¼‰æ¯æœŸå®šæŠ•é‡‘é¢ä¸å¯æ§ï¼Œæ— æ³•æå‰é¢„çŸ¥ï¼Œå¯¹æŠ•èµ„è€…çš„èµ„é‡‘é‡è¦æ±‚æé«˜ã€‚ï¼ˆ5ï¼‰å¹‚æ¬¡æ–¹nçš„å–å€¼å†³å®šäº†æ”¶ç›Šç‡çš„å¼¹æ€§ï¼Œè™½ç„¶å–å€¼è¶Šé«˜ï¼Œæˆæœ¬æ§åˆ¶è¶Šå¥½ã€æ”¶ç›Šç‡è¶Šé«˜ï¼Œä½†æ¯æœŸå®šæŠ•é‡‘é¢ä¹Ÿä¼šç›¸åº”å˜å¤§ï¼ŒåæœŸå¸‚åœºä¸€æ—¦è¿›å…¥ä¸‹è·Œè¶‹åŠ¿ï¼Œå®šæŠ•é‡‘é¢ä¼šéå¸¸é«˜</li><li>é€‚ç”¨äººç¾¤ï¼šæœ‰å¤§é‡é—²æ•£èµ„é‡‘çš„æŠ•èµ„è€…ï¼Œæœ‰è¶³å¤Ÿæ„å¿—åŠ›å’Œå¿è€åŠ›çš„æŠ•èµ„è€…</li></ol></li></ol></li><li>é˜¶æ¢¯ç‚¹ä½ç³»æ•°æ³•<ol><li>æ ¸å¿ƒé€»è¾‘ï¼šé˜¶æ¢¯ç‚¹ä½ç³»æ•°æ³•æ˜¯ç›®æ ‡ç‚¹ä½ç³»æ•°æ³•çš„ç®€åŒ–ç‰ˆï¼Œå®ƒåŒæ ·ä»¥æ ‡çš„æŒ‡æ•°çš„ç‚¹ä½ä½œä¸ºå‚ç…§ç‰©ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œé˜¶æ¢¯ç‚¹ä½ç³»æ•°æ³•ä»¥æ ‡çš„æŒ‡æ•°çš„ç‚¹ä½åŒºé—´ä½œä¸ºå†³ç­–ä¾æ®ã€‚å½“æŒ‡æ•°ç‚¹ä½å¤„äºæŸä¸ªåŒºé—´å†…ï¼Œå…¶ç”³è´­é‡‘é¢æ˜¯å›ºå®šçš„ã€‚åªæœ‰å½“æ ‡çš„æŒ‡æ•°çš„ç‚¹ä½è„±ç¦»è¯¥åŒºé—´å¹¶è¿›å…¥å¦å¤–ä¸€ä¸ªåŒºé—´æ—¶ï¼Œç”³è´­é‡‘é¢æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚ä¾‹å¦‚3000ç‚¹ä¸ºå‚ç…§ç‰©ã€‚3000-3100ï¼šç³»æ•°ä¸º0.5ã€‚2900-3000ï¼šç³»æ•°ä¸º1.5</li><li>ç”³è´­é‡‘é¢ï¼šMxåŸºç¡€é‡‘é¢ã€‚Mä¸ºç³»æ•°<ol><li>ä¼˜ç‚¹ï¼šï¼ˆ1ï¼‰ä¸æ™®é€šå®šæŠ•æ³•ç›¸æ¯”ï¼Œé˜¶æ¢¯ç‚¹ä½ç³»æ•°æ³•å…·æœ‰å¼ºå¤§çš„æ”¶ç›Šç‡ä¼˜åŠ¿ï¼Œåœ¨ä»»ä½•æ—¶å€™æ”¶ç›Šå‡ä¸ä½äºæ™®é€šå®šæŠ•æ³•ï¼ŒäºæŸæ¯”ä¾‹æ¯”æ™®é€šå®šæŠ•æ³•å°‘ã€‚ï¼ˆ2ï¼‰ä¸ç›®æ ‡ç‚¹ä½ç³»æ•°æ³•ç›¸æ¯”ï¼Œé˜¶æ¢¯ç‚¹ä½ç³»æ•°æ³•çš„å®šæŠ•é‡‘é¢ç›¸å¯¹å¯æ§ã€‚åœ¨é˜¶æ¢¯ç‚¹ä½ç³»æ•°æ³•ä¸‹ï¼ŒæŠ•èµ„è€…å¯æ ¹æ®è‡ªå·±çš„é£é™©åå¥½å’Œèµ„é‡‘æƒ…å†µé€‚å½“è°ƒæ•´Mç³»æ•°æ¥è°ƒæ•´æ¯æœŸçš„ç”³è´­é‡‘é¢ï¼Œæ¯æœŸæœ€å¤§çš„æŠ•èµ„é‡‘é¢ä¸æœ€å°æŠ•èµ„é‡‘é¢äº‹å…ˆå·²ç»çŸ¥é“ï¼Œå¯åšåˆ°å¿ƒä¸­æœ‰åº•ã€‚</li><li>ç¼ºç‚¹ï¼šï¼ˆ1ï¼‰åœ¨ç†Šå¸‚é˜¶æ®µï¼Œéšç€æŒ‡æ•°ç‚¹ä½çš„èµ°ä½ï¼Œæ¯æœŸæŠ•å…¥çš„èµ„é‡‘ä¼šé€æ¸åŠ å¤§ï¼Œå¯¹æŠ•èµ„è€…çš„ç°é‡‘æµä¼šæ„æˆè¾ƒå¤§å‹åŠ›ã€‚ï¼ˆ2ï¼‰å¦‚æœåœ¨åˆšä¹°å…¥åŸºé‡‘åå‡ºç°æŒç»­æ€§ç‰›å¸‚ï¼Œé˜¶æ¢¯ç‚¹ä½ç³»æ•°æ³•Mç³»æ•°çš„å–å€¼ä¼šè‡ªåŠ¨ä¸‹é™ï¼Œå¯¼è‡´æ¯æœŸæŠ•å…¥é‡‘é¢å‡å°‘ï¼Œæœªæ¥ç›ˆåˆ©çš„ç»å¯¹é¢ä¹Ÿè¾ƒå°‘ã€‚ï¼ˆ3ï¼‰ç³»æ•°Mçš„å–å€¼å–å†³äºæ¯ä¸ªæŠ•èµ„è€…å¯¹æŒ‡æ•°ç‚¹ä½çš„æŠŠæ§ï¼Œéœ€è¦æŠ•èµ„è€…æœ‰è¾ƒå¼ºçš„å¸‚åœºæ•æ„Ÿåº¦ï¼Œå¯¹ä¸“ä¸šæ€§è¦æ±‚è¾ƒé«˜ï¼Œé€‚ç”¨äººç¾¤ç›¸åº”å˜çª„ã€‚ï¼ˆ4ï¼‰æŒ‡æ•°çš„æˆä»½è‚¡å®šæœŸè°ƒä»“ï¼ŒæŒ‡æ•°ç‚¹ä½ä¹Ÿä¼šä¸æ–­å˜åŒ–ï¼Œå•çº¯å‚è€ƒå†å²è¡Œæƒ…æ¥åˆ¤æ–­ç‚¹ä½çš„é«˜ä½æœ‰åˆ»èˆŸæ±‚å‰‘ä¹‹æ„ã€‚</li><li>é€‚ç”¨äººç¾¤ï¼šä¸€å®šèµ„é‡‘é‡ï¼Œé€‚å½“å˜åŒ–å®šæŠ•é‡‘é¢çš„æŠ•èµ„è€…ã€‚ è¾ƒé«˜é£é™©åå¥½å’Œå¿å—è¾ƒå¤§çš„äºæŸå’Œé•¿ä¹…çš„ç­‰å¾…ã€‚ ç©ºé—²æ—¶é—´å¤šçš„æŠ•èµ„è€…ã€‚</li></ol></li></ol></li><li>æˆæœ¬åç¦»æ³•<ol><li>æ ¸å¿ƒé€»è¾‘ï¼šåç¦»å®šæŠ•æ³•ï¼Œæ˜¯æŒ‡æŠ•èµ„è€…é¢„å…ˆé€‰å®šæŸä¸ªæŒ‡æ•°çš„å‡çº¿ï¼Œè¿™æ¡å‡çº¿å¯ä»¥æ˜¯çŸ­æœŸå‡çº¿oré•¿æœŸå‡çº¿ï¼Œä½œä¸ºå‚ç…§ç‰©ã€‚å½“æŒ‡æ•°ç‚¹ä½å‡ºç‹±è¯¥å‡çº¿ä¸‹æ–¹æ—¶ï¼ŒæŠ•èµ„è€…å¢åŠ å®šæŠ•é‡‘é¢ï¼Œä½äºä¸Šæ–¹ï¼Œåˆ™å‡å°‘å®šæŠ•é‡‘é¢ã€‚ä¾‹å¦‚ï¼šæ”¯ä»˜å®çš„æ™ºèƒ½å®šæŠ•ï¼Œé€‰ç”¨çš„æ˜¯ä¸­è¯500å‡çº¿ã€‚</li><li>ç”³è´­é‡‘é¢ï¼šæˆæœ¬åç¦»åº¦xåŸºç¡€é‡‘é¢ã€‚ï¼ˆä¸ŠæœŸæœ«æŒä»“å•ä½æˆæœ¬/æœ¬æœŸé¢„ä¼°å•ä½å‡€å€¼ï¼‰^n x åŸºç¡€é‡‘é¢ã€‚<ol><li>ä¼˜ç‚¹ï¼šï¼ˆ1ï¼‰æˆæœ¬åç¦»æ³•ä¸ç›®æ ‡ç‚¹ä½ç³»æ•°æ³•ã€é˜¶æ¢¯ç‚¹ä½ç³»æ•°æ³•ä¸€æ ·ï¼Œå¯¹æŒä»“æˆæœ¬çš„æ§åˆ¶èƒ½åŠ›ç›¸å½“å‡ºè‰²ï¼Œå¯ä»¥è·å¾—æ¯”æ™®é€šå®šæŠ•æ³•æ›´é«˜çš„æ”¶ç›Šç‡ã€‚ï¼ˆ2ï¼‰å…·æœ‰è¾ƒçŸ­çš„å›æœ¬å‘¨æœŸã€‚ï¼ˆ3ï¼‰ç‰¹åˆ«é€‚åˆä¸‹è·Œå¸‚å’Œå…ˆè·Œåæ¶¨å¸‚ï¼Œé€‚åˆâ€œç‰›çŸ­ç†Šé•¿â€çš„å¸‚åœºã€‚</li><li>ç¼ºç‚¹ï¼šï¼ˆ1ï¼‰ä¸ç›®æ ‡ç‚¹ä½ç³»æ•°æ³•ç›¸ä¼¼ï¼Œæˆæœ¬åç¦»æ³•æ— æ³•æå‰é¢„çŸ¥ä¸‹ä¸€æœŸçš„å®šæŠ•é‡‘é¢ã€‚ï¼ˆ2ï¼‰åœ¨å¸‚åœºå¤„äºä¸Šæ¶¨é˜¶æ®µï¼Œç‰¹åˆ«æ˜¯ç‰›å¸‚åˆæœŸæ—¶ï¼Œæˆæœ¬åç¦»æ³•ä¼šè‡ªåŠ¨é™ä½æˆæœ¬åç¦»åº¦ç³»æ•°ï¼Œæœ€ç»ˆä»¤æŠ•èµ„è€…æŠ•å…¥é‡‘é¢è¾ƒä½ï¼Œèµšåˆ°çš„ç»å¯¹é‡‘é¢è¾ƒå°‘ã€‚ï¼ˆ3ï¼‰åœ¨å¸‚åœºå¤„äºåº•éƒ¨æ¨ªç›˜éœ‡è¡é˜¶æ®µï¼Œå¸‚åœºå¾€å¾€è¾ƒä¸ºä½è¿·ï¼Œå®¹æ˜“å‡ºç°ä½æ³¢åŠ¨çš„è¡Œæƒ…ï¼Œæ­¤æ—¶æŒä»“æˆæœ¬ä¸åŸºé‡‘å‡€å€¼ä¹‹é—´çš„åç¦»å¹…åº¦è¾ƒå°ï¼Œä½¿å¾—æŠ•å…¥é‡‘é¢è¾ƒä½ï¼Œæœ€ç»ˆå¯èƒ½é”™è¿‡å¤§è¡Œæƒ…ã€‚ï¼ˆ4ï¼‰å¹‚æ¬¡æ–¹nçš„å–å€¼å†³å®šäº†æ”¶ç›Šç‡çš„å¼¹æ€§ï¼Œè™½ç„¶å–å€¼è¶Šé«˜ï¼Œæˆæœ¬æ§åˆ¶è¶Šå¥½ï¼Œæ”¶ç›Šç‡è¶Šé«˜ï¼Œä½†éœ€è¦æŠ•èµ„è€…ä¸æ–­æµ‹è¯•åˆé€‚çš„æ•°å€¼ï¼Œæ“ä½œè¾ƒä¸ºéº»çƒ¦ä¸”ä¸“ä¸šæ€§è¦æ±‚è¾ƒé«˜ã€‚ï¼ˆ5ï¼‰ä¸‹è·Œå¸‚åœºä¸­æŠ•å…¥é‡‘é¢ä¼šä¸æ–­å¢å¤§ï¼Œè€Œä¸”å‘ˆå‡ ä½•å¼å¢é•¿ï¼Œå½“ç”³è´­é‡‘é¢ä¸åŸºç¡€é‡‘é¢åç¦»è¿‡å¤§æ—¶ï¼Œå®¹æ˜“å¯¹æŠ•èµ„è€…æ„æˆç°é‡‘æµå‹åŠ›ï¼Œé€ æˆå®šæŠ•æ–­ä¾›çš„å±€é¢å‘ç”Ÿã€‚ï¼ˆ6ï¼‰æ²¡æœ‰è€ƒè™‘å¸‚åœºä¼°å€¼ï¼Œå¯èƒ½å­˜åœ¨ä¹°è´µçš„ç°è±¡ã€‚</li><li>é€‚ç”¨äººç¾¤ï¼šæœ‰å¤§é‡é—²é’±çš„æŠ•èµ„è€…ã€‚æ‰¿å—é£é™©èƒ½åŠ›è¾ƒé«˜çš„æŠ•èµ„è€…ã€‚ä¸“ä¸šèƒ½åŠ›è¾ƒå¼ºçš„æŠ•èµ„è€…ã€‚</li></ol></li></ol></li><li>ä¼°å€¼ç™¾åˆ†ä½æ³•<ol><li>æ ¸å¿ƒé€»è¾‘ï¼šåŸºäºä¼°å€¼è´µè´±ç¨‹åº¦ã€‚è¿™ç§æ–¹æ³•çš„æ ¸å¿ƒé€»è¾‘æ˜¯åœ¨å¸‚åœºä¼°å€¼ä½æ—¶å¤šä¹°ï¼Œä¼°å€¼é«˜æ—¶å°‘ä¹°ã€‚ä¼°å€¼ç™¾åˆ†ä½ï¼Œé¡¾åæ€ä¹‰ï¼Œå³å½“æœŸçš„ä¼°å€¼å æŸä¸ªæŒ‡æ ‡çš„åˆ†ä½æ•°ï¼Œé€šå¸¸æ˜¯ä»¥å½“æœŸçš„ä¼°å€¼å å†å²ä¼°å€¼æ•°æ®æ ·æœ¬çš„ç™¾åˆ†ä½ã€‚å¦‚æœä¼°å€¼ç™¾åˆ†ä½ä¸º10%ï¼Œå³ä»£è¡¨å½“æœŸçš„ä¼°å€¼åˆ†ä½æ•°åœ¨å†å²æ‰€æœ‰ä¼°å€¼æ•°æ®ä¸­å¤„äºå‰10%çš„ä½ç½®ï¼Œæˆ–è€…å¯ä»¥ç†è§£ä¸ºå½“å‰çš„ä¼°å€¼æ¯”å†å²ä¸Š90%çš„æ—¶å€™è¦é«˜æˆ–ä½ã€‚ä¼°å€¼æŒ‡æ ‡å¯ä»¥æ ¹æ®æŠ•èµ„è€…çš„å–œå¥½è‡ªè¡Œé€‰æ‹©ï¼Œå¦‚å¸‚ç›ˆç‡ã€å¸‚å‡€ç‡ã€å¸‚é”€ç‡ç­‰</li><li>ç”³è´­é‡‘é¢ï¼šï¼ˆ1/ï¼ˆ1-å¿ƒé‡Œä¸´ç•Œå€¼ï¼‰+ä¼°å€¼ç™¾åˆ†ä½ï¼‰^n x åŸºç¡€é‡‘é¢<ol><li>ä¼˜ç‚¹ï¼šï¼ˆ1ï¼‰ä¼°å€¼ç™¾åˆ†ä½æ³•åœ¨æ§åˆ¶æŒä»“æˆæœ¬æ–¹é¢æœ‰è¾ƒå¼ºçš„ä¼˜åŠ¿ã€‚ï¼ˆ2ï¼‰è€ƒè™‘äº†åŸºæœ¬é¢æƒ…å†µï¼Œå¯é¿å…åœ¨è¿‡äºæ˜‚è´µæ—¶ä¹°å…¥èµ„äº§ï¼Œä¸ºæŠ•èµ„è€…æä¾›ä¸€å®šçš„å®‰å…¨è¾¹é™…ã€‚ï¼ˆ3ï¼‰è¯¥æ–¹æ³•ä»¥ä¼°å€¼ä¸ºé”šï¼Œé¿å…ä»¥åˆ»æ¿çš„æŒ‡æ•°ç‚¹ä½ä½œä¸ºå‚ç…§ä¾æ®ï¼Œæ›´åŠ å®¢è§‚åˆç†ã€‚</li><li>ç¼ºç‚¹ï¼šï¼ˆ1ï¼‰ä¼°å€¼ç™¾åˆ†ä½æ³•å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰æŒ‡æ•°ã€‚æŒ‡æ•°æˆç«‹æ—¶é—´è¿‡çŸ­ã€æŒ‡æ•°åº•å±‚èµ„äº§çš„ä¼°å€¼é€»è¾‘è¿‡äºå¤æ‚ï¼Œéƒ½æœ‰å¯èƒ½å¯¼è‡´è¯¥æ–¹æ³•å¤±æ•ˆã€‚ï¼ˆ2ï¼‰ä¼°å€¼ç™¾åˆ†ä½æ³•éœ€è¦é€‰å–åˆé€‚çš„ä¼°å€¼æŒ‡æ ‡ï¼ŒæŒ‡æ ‡æ•°æ®å’Œç™¾åˆ†ä½å‡éœ€è¦æ‰‹åŠ¨è¿›è¡Œç»Ÿè®¡ï¼Œæ“ä½œè¿‡äºå¤æ‚ã€‚ï¼ˆ3ï¼‰è¯¥æ–¹æ³•éœ€è¦æŠ•èµ„è€…é¢„ä¼°åˆç†çš„å¿ƒç†ä¸´ç•Œå€¼å’Œå¹‚æ¬¡æ–¹nï¼ŒæŠ•èµ„è€…çš„ä¸“ä¸šæ€§è¦æ±‚è¾ƒé«˜ã€‚ï¼ˆ4ï¼‰è¯¥æ–¹æ³•å¯èƒ½å­˜åœ¨æŒ‡æ•°ç‚¹ä½ä¸ä¼°å€¼æŒ‡æ ‡ä¸èƒ½åŒå‘æ³¢åŠ¨çš„æƒ…å†µã€‚æ¯”å¦‚æŒ‡æ•°ç‚¹ä½è¶Šä½ï¼Œä¼°å€¼æŒ‡æ ‡åè€Œè¶Šé«˜ï¼Œæ­¤æƒ…å†µä¸‹å¯èƒ½å­˜åœ¨ä¸¥é‡çš„å½¢åŠ¿è¯¯åˆ¤ï¼Œå¯¼è‡´é«˜ä½ä¹°å…¥è¾ƒå¤šï¼Œä½ä½ä¹°å…¥è¾ƒå°‘ï¼Œå®¹æ˜“å‡ºç°äºæŸã€‚ï¼ˆ5ï¼‰ä¼°å€¼ç™¾åˆ†ä½æ³•å¯¹æŠ•èµ„è€…çš„ç°é‡‘æµè¦æ±‚æé«˜ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„èµ„é‡‘é‡å’Œå……è¶³çš„å¿ƒç†å‡†å¤‡ï¼Œå®¹æ˜“å‡ºç°å®šæŠ•åœæ­¢ï¼Œæ–­ä¾›åˆ™ä¼šä½¿æµ®äºå˜æˆçœŸå®äºæŸï¼Œå¯¼è‡´å‰åŠŸå°½å¼ƒã€‚</li><li>é€‚ç”¨äººç¾¤ï¼šå¤§é‡é—²æ•£èµ„é‡‘çš„æŠ•èµ„è€…ã€‚é£é™©èƒ½åŠ›æ‰¿å—è¾ƒé«˜ã€‚ä¸“ä¸šèƒ½åŠ›å¼ºã€‚ä¸“æ³¨äºåŸºæœ¬é¢çš„æŠ•èµ„ã€‚</li></ol></li></ol></li><li>6.æ”¹è¿›ä»·å€¼å¹³å‡ç­–ç•¥<ol><li>æ ¸å¿ƒé€»è¾‘ï¼šä»·å€¼å¹³å‡ç­–ç•¥åˆ™å®Œå…¨æ‘’å¼ƒäº†æœ¬é‡‘ï¼Œè€Œä»¥ç›®æ ‡å¸‚å€¼ä½œä¸ºæŠ•èµ„ç›®æ ‡ï¼Œå½“ç›®æ ‡å¸‚å€¼ç­‰äºæŒä»“å¸‚å€¼æ—¶ï¼Œè¯¥æ–¹æ³•çš„ç›®æ ‡ä¾¿è¾¾æˆäº†ã€‚æ‰€è°“ç›®æ ‡å¸‚å€¼ï¼ŒæŒ‡çš„æ˜¯éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒæŠ•èµ„è€…æœŸæœ›å¾—åˆ°çš„èµ„äº§å¸‚å€¼ï¼Œä¹Ÿæœ‰äººå°†ç›®æ ‡å¸‚å€¼ç§°ä¸ºâ€œç›®æ ‡ä»·å€¼â€ã€‚ä¾‹å¦‚ï¼ŒæŠ•èµ„è€…æœŸæœ›è‚¡å¸‚é‡Œçš„æŒä»“å¸‚å€¼æ¯æœˆé€’å¢1 000å…ƒï¼Œå®šæŠ•10ä¸ªæœˆåï¼ŒæŒä»“å¸‚å€¼åªè¦è¾¾åˆ°10 000å…ƒå³è¢«è§†ä¸ºå®Œæˆç›®æ ‡ã€‚</li><li>ç”³è´­é‡‘é¢ï¼šå¸‚å€¼å·®é¢ç³»æ•°xåŸºç¡€é‡‘é¢ã€‚ï¼ˆæœ¬æœŸç›®æ ‡å¸‚å€¼/æœ¬æœŸé¢„ä¼°åŸºé‡‘å•ä½å‡€å€¼xä¸ŠæœŸæŒä»“ä»½é¢ï¼‰x åŸºç¡€é‡‘é¢ã€‚<ol><li>ä¼˜ç‚¹ï¼šï¼ˆ1ï¼‰å¼¥è¡¥äº†ä¼ ç»Ÿä»·å€¼å¹³å‡ç­–ç•¥ç”±äºé«˜æŠ›ä½å¸å¯¼è‡´çš„æœ¬é‡‘æŠ•å…¥æ°´å¹³è¿‡ä½çš„ç¼ºé™·ã€‚ï¼ˆ2ï¼‰ä¸æ™®é€šå®šæŠ•æ³•ç›¸æ¯”ï¼Œæ”¹è¿›ä»·å€¼å¹³å‡ç­–ç•¥æœ‰ç€å¼ºå¤§çš„æˆæœ¬æ§åˆ¶èƒ½åŠ›ï¼Œæ”¶ç›Šç‡ä¼˜åŠ¿æ˜¾è‘—ã€‚</li><li>ç¼ºç‚¹ï¼šï¼ˆ1ï¼‰ç‰›å¸‚é˜¶æ®µæŠ•å…¥ä¸äº§å‡ºçš„ç»å¯¹å€¼å¯èƒ½è·‘è¾“æ™®é€šå®šæŠ•æ³•ã€‚ï¼ˆ2ï¼‰æ¯æœŸç”³è´­é‡‘é¢æ³¢åŠ¨èŒƒå›´è¾ƒå¤§ï¼Œå¯¹æŠ•èµ„è€…çš„ç°é‡‘æµæ„æˆè¾ƒå¤§å‹åŠ›ã€‚ï¼ˆ3ï¼‰éœ€è¦äººä¸ºè®¾ç½®ç›®æ ‡å¸‚å€¼åŠç›®æ ‡å¸‚å€¼æ¯æœŸçš„é€’å¢é‡‘é¢ï¼Œå¦‚æœç›®æ ‡å¸‚å€¼çš„è®¾å®šè¿‡äºç¦»è°±ï¼Œå®¹æ˜“å¯¹æŠ•èµ„è€…çš„ç°é‡‘æµæ„æˆè¾ƒå¤§å‹åŠ›ã€‚å¦å¤–ï¼Œæ“ä½œä¹Ÿç›¸å¯¹çƒ¦çï¼Œéœ€è¦å®šæœŸå®¡è§†ç›®æ ‡å¸‚å€¼ä¸æŒä»“å¸‚å€¼çš„å·®é¢ã€‚ï¼ˆ4ï¼‰æœªè€ƒè™‘åº•å±‚èµ„äº§çš„ä¼°å€¼ä¸æ€§ä»·æ¯”ã€‚</li><li>é€‚ç”¨äººç¾¤ï¼šä¸“ä¸šæ€§æå¼º</li></ol></li></ol></li><li>æ’å®šäºæŸæ¯”ä¾‹ç­–ç•¥<ol><li>æ ¸å¿ƒé€»è¾‘ï¼šæ— è®ºåŸºé‡‘å‡€å€¼å¦‚ä½•æ³¢åŠ¨ï¼ŒæŠ•èµ„è€…å®šæŠ•åŸºé‡‘çš„æœ€å¤§äºæŸä¸èƒ½ä½äºä¸€ä¸ªæ’å®šçš„æ•°å€¼ï¼Œè¯¥æ•°å€¼æ˜¯æŠ•èµ„è€…å¯ä»¥æ‰¿å—çš„æœ€å¤§äºæŸæ¯”ä¾‹ã€‚å½“å®šæŠ•æ”¶ç›Šç‡ä½äºè¯¥æ•°å€¼æ—¶ï¼Œé€šè¿‡æµ‹ç®—å¾—å‡ºéœ€è¦è¿½åŠ ä¹°å…¥çš„èµ„é‡‘é‡ï¼Œä»¤æ”¶ç›Šç‡å›å‡è‡³æŠ•èµ„è€…å¯ä»¥æ‰¿å—çš„æœ€å¤§äºæŸå¹…åº¦ã€‚</li><li>ç”³è´­é‡‘é¢ï¼šæ¯ä¸€æœŸæŠ•å…¥é‡‘é¢çš„æ—¶å€™ï¼Œéœ€ä¿è¯å½“æœˆæ”¶ç›Šç»´æŒåœ¨å¯ä»¥æœ€å¤§äºæŸå¹…åº¦çš„åº•çº¿ã€‚ä¾‹å¦‚ä¸€ç›´ç»´æŒ-10%<ol><li>ä¼˜ç‚¹ï¼šï¼ˆ1ï¼‰æå¼ºçš„æˆæœ¬æ§åˆ¶èƒ½åŠ›ã€‚æ’å®šäºæŸæ¯”ä¾‹ç­–ç•¥æœ‰ç€æ— ä¸ä¼¦æ¯”çš„æˆæœ¬æ§åˆ¶èƒ½åŠ›ï¼Œåœ¨æœ¬ä¹¦æ‰€æœ‰å®šæŠ•ç­–ç•¥ä¸­ï¼Œè¯¥ç­–ç•¥å¯¹æŒä»“æˆæœ¬çš„æ§åˆ¶èƒ½åŠ›é¦–å±ˆä¸€æŒ‡ã€‚åªè¦æŠ•èµ„è€…çš„èµ„é‡‘é‡è¶³å¤Ÿå……è£•ï¼Œå¹¶åˆç†è®¾å®šå„é¡¹å‚æ•°ï¼Œè¯¥ç­–ç•¥å‡ ä¹å¯ä»¥å¸®åŠ©æŠ•èµ„è€…å°†äºæŸå¹…åº¦æ§åˆ¶åœ¨è‡ªå·±æƒ³è¦çš„ä»»ä½•æ°´å¹³ã€‚ï¼ˆ2ï¼‰æçŸ­çš„å›æœ¬å‘¨æœŸã€‚æ’å®šäºæŸæ¯”ä¾‹ç­–ç•¥å¹³æŠ‘æ³¢åŠ¨çš„æ–¹å¼æ¥è‡ªå½“æœŸç”³è´­å‰æ€»æ”¶ç›Šç‡R&lt;æ’å®šäºæŸæ¯”ä¾‹Yæ—¶ï¼Œè¯¥ç­–ç•¥çš„ç–¯ç‹‚åŠ ç ä¹°å…¥æ‹‰ä½äº†æŒä»“æˆæœ¬ï¼›å½“R&gt;0æ—¶ï¼Œæ’å®šäºæŸæ¯”ä¾‹ç­–ç•¥åœæ­¢ä¹°å…¥å‹åˆ¶ä½æŒä»“æˆæœ¬çš„ä¸Šè¡Œï¼Œå› æ­¤æŒä»“æˆæœ¬åªä¼šä¸‹é™ä¸ä¼šä¸Šæ¶¨ï¼Œæå¤§åœ°ç¼©çŸ­äº†å›æœ¬å‘¨æœŸã€‚ï¼ˆ3ï¼‰å¤©ç„¶é€‚ç”¨äºç†Šé•¿ç‰›çŸ­çš„å¸‚åœºã€‚</li><li>ç¼ºç‚¹ï¼šï¼ˆ1ï¼‰é€‚ç”¨äººç¾¤æå…¶ç‹­çª„ã€‚ç”±äºåœ¨ç†Šå¸‚é˜¶æ®µæ’å®šäºæŸæ¯”ä¾‹ç­–ç•¥çš„å®šæŠ•é‡‘é¢ä¼šå‘ˆç°å‡ ä½•çº§çˆ†ç‚¸å¢é•¿ï¼Œå¯¹æŠ•èµ„è€…çš„èµ„é‡‘é‡è¦æ±‚éå¸¸è‹›åˆ»ï¼Œéœ€è¦æŠ•èµ„è€…æœ‰è¶³å¤Ÿçš„èµ„é‡‘å‚¨å¤‡ã€‚è¯¥ç­–ç•¥é€‚ç”¨äººç¾¤æå…¶ç‹­çª„ï¼Œå¹¿å¤§å·¥è–ªé˜¶å±‚æœªå¿…é€‚åˆè¯¥ç­–ç•¥ã€‚ï¼ˆ2ï¼‰è¯¥ç­–ç•¥éœ€è¦æŠ•èµ„è€…å…·å¤‡é’¢é“èˆ¬çš„æ„å¿—ä¸çºªå¾‹æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨ç†Šå¸‚é˜¶æ®µï¼Œå¦‚æœå‡ºç°æ–­ä¾›ï¼Œä¸­é€”é€€å‡ºå¯¼è‡´çš„ç»å¯¹æŸå¤±å°†ååˆ†åºå¤§ã€‚ï¼ˆ3ï¼‰è¯¥ç­–ç•¥åœ¨ç‰›å¸‚æ—¶æ”¶ç›Šç‡åŒæ ·è¶…è¶Šæ™®é€šå®šæŠ•æ³•ï¼Œä½†æŠ•å…¥æœ¬é‡‘çš„ç»å¯¹å€¼å¯èƒ½å­˜åœ¨è¿‡ä½çš„é£é™©ã€‚å¦‚æœæœ¬é‡‘æŠ•å…¥è¿‡ä½ï¼Œä¸ºæŠ•èµ„è€…èµšå–çš„ç»å¯¹å›æŠ¥ä¹Ÿå°†å‡å°‘ã€‚ï¼ˆ4ï¼‰è¯¥ç­–ç•¥éœ€è¦æŠ•èµ„è€…è®¾å®šåˆç†çš„æ’å®šäºæŸæ¯”ä¾‹å‚æ•°ã€åŸºç¡€é‡‘é¢å‚æ•°ï¼Œä»¥åŠæŒ‘é€‰åˆé€‚çš„è¿›åœºæ—¶æœºï¼Œå¯¹æŠ•èµ„è€…çš„ä¸“ä¸šæ€§æå‡ºæé«˜çš„è¦æ±‚ï¼Œæ“ä½œè¾ƒä¸ºçƒ¦çã€‚</li><li>é€‚ç”¨äººç¾¤ï¼šæå…¶ä¸“ä¸šäººå‘˜ã€‚è¶…å¤§é‡èµ„é‡‘äººå‘˜</li></ol></li></ol></li></ol></li><li><p>å®šæŠ•æ­¢ç›ˆç­–ç•¥</p><ol><li>å–å‡ºå…¬å¼æœ‰ä¸‰ç§ï¼šä¸€æ¬¡æ€§æ­¢ç›ˆå…¬å¼ã€ç­‰é¢åˆ†æ‰¹æ­¢ç›ˆå…¬å¼ã€éç­‰é¢åˆ†æ‰¹æ­¢ç›ˆå…¬å¼ã€‚</li><li>ä¹Ÿæ˜¯ä¾æ®åœ¨ä¸Šæ¶¨å¸‚ã€ä¸‹è·Œå¸‚ã€å…ˆè·Œåæ¶¨å¸‚ã€å…ˆæ¶¨åè·Œå¸‚ä¸‹çš„æ¨¡æ‹Ÿä¸å›æµ‹ã€‚</li><li>ç›®æ ‡æ”¶ç›Šç‡æ³•ï¼šæ ¸å¿ƒé€»è¾‘ï¼š<strong>è¾¾åˆ°å¿ƒä¸­çš„é¢„è®¡æ”¶ç›Šç‡å–å‡º</strong><ol><li>ä¼˜ç‚¹ï¼šåº”ç”¨å¹¿æ³›ã€æ“ä½œç®€å•ã€‚</li><li>ç¼ºç‚¹ï¼šå½“è¡Œæƒ…æ³¢åŠ¨è¾ƒä¸ºå¤æ‚ï¼Œå®é™…æ”¶ç›Šç‡èƒ½å¤Ÿè¾¾åˆ°æŠ•èµ„è€…é¢„è®¡çš„ç›®æ ‡æ”¶ç›Šç‡å­˜åœ¨è¾ƒå¤§çš„ä¸ç¡®å®šæ€§ã€‚ä¸€æ—¦è®¾å®šç›®æ ‡å¤¸å¼ ï¼Œå®¹æ˜“ç›ˆåˆ©å›åç”šè‡³äºæŸã€‚</li><li>é€‚ç”¨äººç¾¤ï¼šä»»æ„</li></ol></li><li>ç›®æ ‡ä¼°å€¼æ³•ï¼šæ ¸å¿ƒé€»è¾‘ï¼šæ ‡çš„ä¼°å€¼è¾¾åˆ°æŠ•èµ„è€…é¢„ä¼°çš„åˆç†ä¼°å€¼ä¸Šé™åè¿›è¡Œæ­¢ç›ˆï¼Œä¸æ”¶ç›Šç‡æ— å…³ã€‚ä¾‹å¦‚ä¸Šè¯3700é€‰æ‹©æ­¢ç›ˆã€‚<ol><li>ä¼˜ç‚¹ï¼šè€ƒè™‘åˆ°äº†åº•å±‚èµ„äº§çš„åŸºæœ¬é¢æƒ…å†µã€‚èµ„äº§çš„è·ªç€è¢«çº³å…¥å†³ç­–ç³»ç»Ÿï¼Œæ›´åŠ å®¢è§‚ã€åˆç†</li><li>ç¼ºç‚¹ï¼šæ“ä½œç•¥å¾®å¤æ‚ï¼Œæ ‡çš„æŒ‡æ•°çš„ä¼°å€¼æ³¢åŠ¨äºæ ‡çš„çš„æŒ‡æ•°ç‚¹ä½å¹¶éæ—¶æ—¶å¯¹åº”ã€‚é€‚ç”¨äºç›¸å¯¹ç¨³å®šçš„å¸‚åœºã€‚ï¼ˆä¸ªäººæ„Ÿè§‰ç¾è‚¡/é•¿æœŸåˆ©å¥½è¡Œä¸šã€‚ï¼‰</li><li>é€‚ç”¨äººç¾¤ï¼šå…·å¤‡åŸºæœ¬çŸ¥è¯†é¢æŠ•èµ„å’Œä¸€å®šçš„ä¸“ä¸šèƒ½åŠ›</li></ol></li><li>å‡çº¿æ­¢ç›ˆæ³•ï¼šæ ¸å¿ƒé€»è¾‘ï¼šå…šç›®æ ‡ç‰©è·Œç ´å‚ç…§ç‰©æ—¶ï¼Œè§¦å‘æ­¢ç›ˆã€‚è¿™é‡Œçš„å‚ç…§ç‰©æ˜¯æŒ‡æŠ•èµ„è€…é¢„ä¼°çš„æŸæ¡å‡çº¿ã€‚ä¾‹å¦‚30æ—¥å‡çº¿ã€‚60æ—¥å‡çº¿ç­‰ã€‚<ol><li>ä¼˜ç‚¹ï¼šç›´è§‚ã€æ˜“æ‡‚ã€‚å…·å¤‡Kçº¿åŸºç¡€çŸ¥è¯†å³å¯è½»æ¾é©¾é©­ã€‚</li><li>ç¼ºç‚¹ï¼šå¸‚åœºæ˜¯éšæœºçš„æ³¢åŠ¨çš„ï¼Œå†å²ä¸ä¸€å®šä¼šé‡å¤ã€‚</li><li>é€‚ç”¨äººç¾¤ï¼šé€‚ç”¨äºå¤§éƒ¨åˆ†æŠ•èµ„è€…å’Œä¸€å®šæŠ€æœ¯åˆ†æèƒ½åŠ›çš„æŠ•èµ„è€…ã€‚</li></ol></li><li>å›æ’¤æ­¢ç›ˆæ³•ï¼šæ ¸å¿ƒé€»è¾‘ï¼šä»·æ ¼å›è½åˆ°å‡çº¿ä½ç½®ï¼Œç›´è‡³è·Œç ´è¯¥å‡çº¿åè®¤å®šå¸‚åœºå·²ç»å‡»ç©¿æŸä¸€å…³é”®ä½ç½®ï¼Œæ­¤æ—¶ä¾¿å¯æ­¢ç›ˆã€‚ä¾‹å¦‚å‡»ç©¿ç®±ä½“çš„ä¸€åˆ»ã€‚æˆ–è€…å›æ’¤ç‡è¾¾åˆ°15%çš„æ—¶å€™é€‰æ‹©æ­¢ç›ˆã€‚<ol><li>ä¼˜ç‚¹ï¼šå…·å¤‡åŸºæœ¬Kçº¿çŸ¥è¯†å³å¯æŒæ¡ã€‚</li><li>ç¼ºç‚¹ï¼šéœ€è¦é¢‘ç¹ç›¯ç›˜ï¼Œåˆç†é¢„ä¼°å¯æ‰¿å—æœ€å¤§å›æ’¤å€¼ã€‚å®¹æ˜“é”™è¿‡å¤§è¡Œæƒ…orè¢«å¥—ã€‚ä¸ªäººå»ºè®®10%-20%å›æ’¤ã€‚</li><li>é€‚ç”¨äººç¾¤ï¼šé—²æš‡æ—¶é—´å¤šè€…ã€‚</li></ol></li><li>å¯è½¬å€ºè½¬è‚¡æ­¢ç›ˆæ³•ï¼ˆäº†è§£ï¼‰ã€æ–œç‡åç¦»æ³•ï¼ˆé€šè¿‡åˆ¤æ–­é€šé“æ¥åˆ¤æ–­æ˜¯å¦æ­¢ç›ˆï¼Œè§¦åŠé€šé“é¡¶éƒ¨æ­¢ç›ˆã€‚ï¼‰</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç»æµ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…±åŒåŸºé‡‘</title>
    <link href="/dajiangdahe/2021/10/22/%E3%80%90%E7%BB%8F%E6%B5%8E%E3%80%91%E5%85%B1%E5%90%8C%E5%9F%BA%E9%87%91/"/>
    <url>/dajiangdahe/2021/10/22/%E3%80%90%E7%BB%8F%E6%B5%8E%E3%80%91%E5%85%B1%E5%90%8C%E5%9F%BA%E9%87%91/</url>
    
    <content type="html"><![CDATA[<h1>å…±åŒåŸºé‡‘å¸¸è¯†ï¼ˆæŠ•èµ„åœ£ç»ï¼‰</h1><h2 id="1-æŠ•èµ„ç­–ç•¥">1.æŠ•èµ„ç­–ç•¥</h2><h3 id="1-é•¿æœŸæŠ•èµ„ï¼šå¼ºæ–¯ä¸èŠ±å›­">1.é•¿æœŸæŠ•èµ„ï¼šå¼ºæ–¯ä¸èŠ±å›­</h3><ol><li>ä¸€ä¸ªåˆ†æ•£åŒ–çš„æŠ•èµ„ç»„åˆå¯å°†é£é™©é™ä½è‡³è‚¡ç¥¨å’Œå€ºåˆ¸å¸‚åœºçš„å¹³å‡æ°´å¹³ï¼Œä»è€Œä½¿æŒæœ‰å•åªè¯åˆ¸çš„é£é™©æœ€å°åŒ–ã€‚</li><li>å½“æˆ‘ä»¬ä¿¡å¿ƒä½è¿·æ—¶ï¼Œå¸‚åœºä¼°å€¼å¾ˆå¯èƒ½å…·æœ‰å¸å¼•åŠ›ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥ç§°å…¶ä¸ºâ€œæŠ•èµ„çš„æ‚–è®ºâ€ã€‚<ol><li>æŠ•èµ„æ‚–è®ºå‡ºç°çš„æ—¶å€™ï¼Œæ­£æ˜¯ä»·å€¼æŠ•èµ„å¸ƒå±€çš„å¼€å§‹</li></ol></li><li>èŠ±å›­å†ç»å­£èŠ‚çš„å¾ªç¯å˜åŒ–ï¼Œä¸ç»æµå’Œé‡‘èå¸‚åœºçš„å‘¨æœŸç±»ä¼¼ã€‚<ol><li>æˆ‘ä»¬ä¸­çš„å¾ˆå¤šäººå¿˜è®°äº†è‡ªç„¶ç•Œä¸äººç±»ç¤¾ä¼šçš„ç›¸é€šä¹‹å¤„ã€‚æ­£å¦‚è‡ªç„¶ç•Œä¸€æ ·ï¼Œä»é•¿æœŸæ¥çœ‹ï¼Œæˆ‘ä»¬çš„ç»æµä½“ç³»ä¿æŒç€ç¨³å®šå’Œç†æ€§ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¸å¿…å®³æ€•è‡ªç„¶è§„å¾‹çš„åŸå› â€¦â€¦æˆ‘ä»¬å¦ç„¶è¿æ¥ä¸å¯é¿å…çš„å­£èŠ‚æ›´æ›¿ï¼Œå´ä¸ºç»æµçš„å‘¨æœŸå˜åŠ¨è€Œçƒ¦æ¼ï¼Œæˆ‘ä»¬æ˜¯å¤šä¹ˆæ„šè ¢å•Šï¼â€</li></ol></li><li>è‹¥æƒ³æŠ•èµ„æˆåŠŸï¼Œä½ å¿…é¡»æˆä¸ºä¸€ä¸ªé•¿æœŸæŠ•èµ„è€…ã€‚<ol><li>æ—¶é—´è¶Šé•¿ï¼Œå¹´å¹³å‡å›æŠ¥ç‡çš„æ³¢åŠ¨è¶Šå°ã€‚æŠ•èµ„è€…ä¸åº”è¯¥ä½ä¼°æ—¶é—´è·¨åº¦ã€‚</li><li>é£é™©ä¸æ˜¯çŸ­æœŸçš„æ³¢åŠ¨ï¼Œå› ä¸ºé•¿æœŸæŠ•èµ„è€…å¯ä»¥å¿½ç•¥çŸ­æœŸæ³¢åŠ¨ã€‚è€Œä¸”ï¼Œå¹¶ä¸å­˜åœ¨ä»»ä½•é¢„å®šçš„å›æŠ¥ç‡ï¼Œè€Œä»…ä»…å¯èƒ½æ˜¯ä¸€ä¸ªæ— æ³•å®ç°çš„æœŸæœ›å›æŠ¥ç‡ï¼Œé£é™©æ˜¯è¿™æ ·ä¸€ç§å¯èƒ½æ€§ã€‚åœ¨é•¿æœŸï¼Œè‚¡ç¥¨çš„å›æŠ¥å¯èƒ½å¾ˆå·®ã€‚</li><li>æˆ‘ä»¬çš„ç»æµå°±åƒä¸€ä¸ªå¥åº·è‚¥æ²ƒçš„èŠ±å›­ï¼Œé‚£ä¹ˆæ”¶è·é•¿æœŸå›æŠ¥çš„æœ€ä½³æ–¹å¼æ˜¯ï¼šå¦‚åŒæ€€ç€æœŸæœ›æ’­ä¸‹å¢é•¿çš„ç§å­ä¸€æ ·ï¼ŒæŠ•èµ„äºæ™®é€šè‚¡ã€‚ä½†æ˜¯ï¼Œä½ å¿…é¡»ä¹Ÿè¦åšå¥½å‡†å¤‡ä»¥åº”å¯¹ä¸å¯é¢„æ–™çš„å¯’å†¬ä¾µè¢­ã€‚é‚£æ—¶ï¼Œå€ºåˆ¸å°†æ‰®æ¼”å…³é”®è§’è‰²ã€‚</li><li>é•¿æœŸæŠ•èµ„è€…åº”å½“å°†å€ºåˆ¸çº³å…¥å…¶æŠ•èµ„ç»„åˆï¼Œå°†å…¶ä½œä¸ºé’ˆå¯¹è‚¡ç¥¨çŸ­æœŸæ³¢åŠ¨çš„ä¸è¶³çš„å¼¥è¡¥ã€‚è¿™æ ·çš„ä¸€ç§å¹³è¡¡æŠ•èµ„ç­–ç•¥å°†åœ¨ç¬¬3ç« è¯¦ç»†è®¨è®ºã€‚æ— è®ºå¸‚åœºä¸Šæ¶¨æˆ–ä¸‹è·Œï¼Œé€‰æ‹©ä¸€ä¸ªåŒ…æ‹¬è‚¡ç¥¨å’Œå€ºåˆ¸çš„ç†æ€§å¹³è¡¡ç»„åˆï¼Œå¹¶åšå®šåœ°æŒæœ‰å®ƒï¼Œä½ ä¸ä»…å¯ä»¥ç§¯ç´¯æ”¶ç›Šå¹¶ä¸”å¯æŠµæŠ—é€†å¢ƒã€‚</li><li>å¦‚æœé•¿æœŸæŠ•èµ„çš„ç†æƒ³æ˜¯æ„é€ ä¸€ä¸ªåœ¨è‚¡ç¥¨å’Œå€ºåˆ¸é—´åˆ†æ•£æŠ•èµ„çš„åˆç†å¹³è¡¡ç»„åˆï¼Œæ— è®ºå¸‚åœºå¦‚ä½•å˜è¿éƒ½å§‹ç»ˆæŒæœ‰å®ƒï¼Œå¹¶åŠ›äº‰å°†æˆæœ¬ä¿æŒåœ¨æœ€ä½ã€‚è¿™åº”è¯¥æˆä¸ºå…±åŒåŸºé‡‘ç»ç†å’ŒæŠ•èµ„è€…ä¸€è‡´å´‡å°šçš„åŸåˆ™ã€‚</li></ol></li><li>ä¸ç®¡å†å²è®°å½•æ˜¯å¤šä¹ˆç‰¢é ï¼Œè¿‡å»çš„ç»éªŒä»ç„¶æ— æ³•ä¿è¯æœªæ¥çš„æˆåŠŸã€‚ç„¶è€Œï¼Œå¯¹è¿‡å»çš„æ¢ç©¶ï¼ŒåŠ ä¹‹ä½¿äººè‡ªå¾‹çš„å¸¸è¯†ï¼Œè¿™ä¾ç„¶æ˜¯ä¸€ä¸ªèªæ˜æŠ•èµ„è€…æœ€å¯ä¾é çš„æ–¹æ³•ã€‚</li><li>ä»”ç»†å…³æ³¨æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„æŠ•èµ„è¦ç´ ï¼šé£é™©ã€æˆæœ¬å’Œæ—¶é—´ï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªé•¿æœŸçš„æŠ•èµ„è®¡åˆ’å¿…å°†åœ¨æœªæ¥è·ç›Šã€‚<ol><li>æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ ä¸‰å¤§è¦ç´ é‡Œé¢æ²¡æœ‰æ”¶ç›Šï¼Œè€Œåƒæˆ‘è¿™ç§å°ç™½æœ€å¼€å§‹è€ƒè™‘çš„æ˜¯ æ”¶ç›Šä¸é£é™©ã€‚é€åˆ©æ€§æ‘†æ”¾åœ¨æœ€å‰é¢å°±æ„å‘³ç€é®æŒ¡äº†ä¸€äº›é‡è¦çš„ä¿¡æ¯ æ¯”å¦‚è¿™é‡Œæå‡ºçš„é£é™© æˆæœ¬ æ—¶é—´ã€‚æ¢å¥è¯è¯´ åªæœ‰å½“ä½ æ§åˆ¶å¥½äº†ä»¥ä¸Šä¸‰å¤§è¦ç´  æ”¶ç›Šæ˜¯è‡ªç„¶è€Œç„¶å°±ä¼šåˆ°æ¥çš„ã€‚</li><li>åŸºé‡‘é€‰æ‹©çš„å…³é”®ä¸åœ¨äºåªå…³æ³¨æœªæ¥çš„å›æŠ¥ï¼Œå› ä¸ºè¿™æ˜¯æŠ•èµ„è€…æ‰€ä¸èƒ½æ§åˆ¶çš„ï¼Œè€Œåº”å…³æ³¨é£é™©ã€æˆæœ¬å’Œæ—¶é—´è¿™äº›æŠ•èµ„è€…èƒ½å¤Ÿæ§åˆ¶çš„å› ç´ </li></ol></li><li>æˆ‘ä»¬ä¸èƒ½ä»…ä¾é æƒ…æ„Ÿï¼Œæ›´è¦ä¾èµ–ç†æ™ºï¼Œå»æ´å¯Ÿå…·æœ‰åˆ›é€ åŠ›å’Œåˆ›æ–°æ€§çš„ç¾å›½ç»æµåœ¨é•¿æœŸä¸­å¦‚ä½•å¢é•¿ã€‚</li><li>é»„é‡‘ä¸åƒè‚¡ç¥¨å’Œå€ºåˆ¸ï¼Œå®ƒä¸èƒ½äº§ç”Ÿå†…éƒ¨ä»·å€¼ï¼›è€Œè‚¡ç¥¨å¯ä»¥é€šè¿‡ç›ˆåˆ©å¢é•¿å’Œè‚¡åˆ©åˆ†çº¢äº§ç”Ÿå†…éƒ¨ä»·å€¼ï¼›å€ºåˆ¸åˆ™å¯é€šè¿‡åˆ©æ¯æ”¯ä»˜å–å¾—å†…éƒ¨ä»·å€¼ã€‚</li><li>æŠ•èµ„çš„ç›®çš„åœ¨äºç§¯ç´¯å®é™…è´¢å¯Œï¼Œè¿™è¡¨ç°ä¸ºä¸æ–­æé«˜å¯¹å•†å“å’ŒæœåŠ¡çš„è´­ä¹°èƒ½åŠ›ï¼Œå› è€Œé•¿æœŸæŠ•èµ„çš„æœ€ç»ˆç›®æ ‡ä¸€å®šæ˜¯å®é™…å›æŠ¥ç‡è€Œéåä¹‰å›æŠ¥ç‡ã€‚</li><li>æ ‡å‡†å·®ï¼šè¡¡é‡å¹´å›æŠ¥ç‡èŒƒå›´çš„æŒ‡æ ‡<ol><li>ä»å­¦æœ¯è§’åº¦çœ‹ï¼Œæ ‡å‡†å·®æ˜¯ä¸€ä¸ªå…¬è®¤çš„æµ‹åº¦å˜å¼‚æ€§çš„æŒ‡æ ‡ã€‚åœ¨ç»™å®šçš„æ—¶é—´èŒƒå›´å†…ï¼Œå®ƒæŒ‡å‡ºäº†æŠ•èµ„å›æŠ¥çš„å˜åŠ¨èŒƒå›´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸé¡¹æŠ•èµ„çš„å¹³å‡å¹´å›æŠ¥ç‡ä¸º10%ï¼Œä¸”å¹´å›æŠ¥ç‡æœ‰2/3å¯èƒ½ä¼šå¤„åœ¨â€“5%ï½+25%çš„èŒƒå›´ä»¥å†…ï¼ˆåœ¨ä¸Šä¸‹ä»»ä½•ä¸€ä¸ªæ–¹å‘ä¸Šéƒ½æœ‰15%çš„å˜åŒ–ï¼‰ï¼Œåˆ™å¹´å›æŠ¥ç‡çš„æ ‡å‡†å·®ä¸º15%ã€‚è€Œä¸¤å€æ ‡å‡†å·®å°†æ¶µç›–95%çš„å¹´å›æŠ¥ç‡çš„å˜åŠ¨èŒƒå›´ã€‚</li></ol></li><li>é¦…é¥¼ç†è®ºï¼šé¢å¯¹å¸‚åœºè¿™ä¸ªé¦…é¥¼ï¼Œä½ èµšå–è¶…è¿‡å¹³å‡å€¼çš„å›æŠ¥ç‡å°±æ˜¯è¾ƒä¸æˆåŠŸçš„äººçš„å›æŠ¥ç‡ä¸å¹³å‡å€¼çš„å·®é¢ã€‚ï¼ˆä¸è®¡ç®—æˆæœ¬ï¼‰è¿™å°±æ˜¯è¾ƒæˆåŠŸçš„æŠ•èµ„è€…ã€‚<ol><li>å¦‚æœå°†è¿™ä¸ªå›æŠ¥ç‡è§†ä½œä¸€ä¸ªæ‰å¹³çš„åœ†å½¢å¹³é¢ï¼Œæ¯”å¦‚ä¸€å¼ é¦…é¥¼ï¼Œæ ¹æ®å®šä¹‰ï¼Œ11%å°±æ˜¯é‚£å¼ å…¨éƒ¨å¸‚åœºå‚ä¸è€…èƒ½å¤Ÿåˆ†é…çš„é¦…é¥¼ã€‚å¦‚æœæˆ‘ä»¬æ±‡æ€»æ‰€æœ‰è¡¨ç°è¾ƒå¥½çš„æŠ•èµ„è€…çš„å›æŠ¥ç‡ï¼Œå…¶å›æŠ¥ç‡ä¸€å®šä¼šè¢«æ‰€æœ‰è¡¨ç°è¾ƒå·®çš„æŠ•èµ„è€…çš„æ€»å›æŠ¥ç‡æ‰€æŠµæ¶ˆã€‚å‡†ç¡®åœ°è®²ï¼ŒæŠµæ¶ˆçš„å¹…åº¦ç›¸ç­‰ã€‚è¿™å°±æ˜¯é‚£å¼ æ‰£å‡æˆæœ¬å‰çš„æ€»é¦…é¥¼ã€‚</li></ol></li><li>åœ¨ä»»ä½•é€æœˆç”šè‡³é€å¹´çš„çŸ­æœŸåŸºç¡€ä¸Šï¼Œå¸‚åœºå®Œå…¨ä¸å¯é¢„æµ‹ã€‚æˆ‘ä»¬æ—¢ä¸åº”å½“æŒ‡æœ›å®ƒå˜å¾—å¯é¢„æµ‹ï¼Œä¹Ÿä¸åº”å½“æ ¹æ®ä¼ ç»Ÿè§‚å¿µæ‰€å¼•å‘çš„å†²åŠ¨åšå‡ºæŠ•èµ„å†³ç­–ã€‚æ— è®ºè¿™äº›å·å¬æ¥è‡ªæƒå¨åˆŠç‰©çš„å¤´æ¡ï¼Œè¿˜æ˜¯æ¥è‡ªæˆ‘ä»¬æ—¥å¸¸çš„å¸Œæœ›å’Œææƒ§ï¼Œå®ƒä»¬é€šå¸¸ä¼šè®©æˆ‘ä»¬å…³æ³¨çŸ­æœŸï¼Œæ¨¡ç³Šæˆ‘ä»¬å¯¹é•¿æœŸçš„è®¤è¯†ã€‚</li><li>é™¤å»æˆ‘æ‰€å¼•ç”¨çš„ä¸€äº›â€œè¡¨ç°æœ€ä½³â€çš„å…±åŒåŸºé‡‘ï¼ˆé‚£äº›éµä»ç›¸å¯¹ç¨³å®šçš„ä½æ¢æ‰‹ç‡ç­–ç•¥è€…ï¼‰ï¼Œå…±åŒåŸºé‡‘ä¸šç°åœ¨æ­£èµ°å‘ä¸€æ¡åªèƒ½åˆ›é€ æ›´å°‘ä»·å€¼çš„é“è·¯ã€‚<ol><li>æˆ‘ä»¬éœ€è¦å»å¯»æ‰¾ç¨³å®šçš„ä½æ¢æ‰‹ç‡ç­–ç•¥è€…æ‰€æŒæœ‰çš„ä¼˜ç§€åŸºé‡‘ï¼Œå¹¶ä¸”åšå®šçš„ç›¸ä¿¡ä»–ã€‚</li><li>ç»å¤§å¤šæ•°åŸºé‡‘åªè¦ä»…ä»…åœ¨å¹´åˆæŒæœ‰å…¶æŠ•èµ„ç»„åˆä¸å˜ï¼Œå¹¶åœ¨éšåçš„12ä¸ªæœˆä¸­ä¸é‡‡å–ä»»ä½•æ“ä½œï¼Œéƒ½èƒ½è·å¾—æ›´é«˜çš„å›æŠ¥ç‡ã€‚</li><li>å¸‚åœºæ‹©æ—¶åªæ˜¯å¤±è´¥çš„ç­–ç•¥ä¹‹ä¸€ï¼›æŠ•èµ„ç»„åˆçš„é«˜æ¢æ‰‹ç‡äº¦æ˜¯æœ€æ— æ•ˆçš„ã€‚æ— è®ºæ˜¯å¯¹åŸºé‡‘è¿˜æ˜¯åŸºé‡‘æŠ•èµ„è€…è€Œè¨€ï¼Œæ¢æ‰‹ç‡ä¸æ–­æé«˜æ‰€å¯¼è‡´çš„é«˜æˆæœ¬å’Œé«˜ç¨æ”¶ï¼Œæ³¨å®šå°†ä½¿æƒ…å†µæ›´ç³Ÿç³•ã€‚<ol><li>ä¸èƒ½ç›²ç›®æ‹©æ—¶</li><li>æŠ•èµ„çš„ç»„åˆä¸èƒ½é«˜æ¢æ‰‹ç‡</li></ol></li><li>æ— è®ºå¸‚åœºæ½®èµ·æ½®è½ï¼Œéƒ½æŒæœ‰ä¸€ä¸ªè‚¡ç¥¨å’Œå€ºåˆ¸ä¿æŒåˆç†å‡è¡¡çš„æŠ•èµ„ç»„åˆï¼Œå¹¶è¾¾åˆ°åˆç†çš„å¹³è¡¡ã€‚<ol><li>ç»™äºˆä½ çš„æŠ•èµ„ç»„åˆè¶³å¤Ÿçš„æ—¶é—´ï¼Œè®©å®ƒå—ç›Šäºå¤åˆ©çš„é­”åŠ›ï¼Œå¹¶ä½¿ä½ çš„æˆæœ¬æœ€ä½ã€‚</li></ol></li></ol></li><li>å·´è²ç‰¹å…ˆç”Ÿæç»˜å…¶ä¸åŒå¯»å¸¸çš„æœ‰æ•ˆæŠ•èµ„æ–¹æ³•ä¸ºï¼šä¿æŒâ€œæˆ‘ä»¬æ‰€ä¸»è¦æŒæœ‰çš„å¤§å¤šæ•°è‚¡ç¥¨ï¼Œä¸ç®¡å…¶ä»·æ ¼ç›¸å¯¹äºå…¶ï¼ˆå½“å‰çš„ï¼‰å†…åœ¨ä»·å€¼æ˜¯å¤šå°‘â€¦â€¦è‡³æ­»ä¸æ¸â€¦â€¦æˆ‘ä»¬ä¸€ç›´åœ¨æ‰¾å¯»ç¡®ä¿¡åœ¨æœªæ¥ä¸€äºŒåå¹´ä»æœ‰å·¨å¤§æ½œåŠ›çš„ä¼ä¸šã€‚ä½œä¸ºæŠ•èµ„è€…ï¼Œå¯¹äºåŠ¨è¡çš„è¡Œä¸šï¼Œæˆ‘ä»¬åº”åƒå¯¹å¾…å¤ªç©ºæ¢é™©ä¸€æ ·ï¼Œä¸ºåŠªåŠ›è€Œå–å½©ï¼Œä½†æˆ‘ä»¬å®æ„¿ç½®èº«å…¶å¤–â€ã€‚</li><li>å¸‚åœºä¸ŠæŠ•æœºè¡Œä¸ºçš„å¼ºåŠ¿åœ°ä½ï¼Œæ¥è‡ªæŠ•èµ„è€…æŒæœ‰è‚¡ç¥¨æ•°é‡çš„ä¸æ–­å¢é•¿ï¼Œè€Œè¿™äº›æŠ•èµ„è€…â€œæ¯«æ— ä¸“ä¸šæŠ•èµ„çŸ¥è¯†â€¦â€¦è€Œä¼ ç»Ÿçš„è‚¡ç¥¨å®šä»·æ–¹æ³•ï¼Œæ˜¯åŸºäºå¤§é‡æ— çŸ¥ä¸ªä½“çš„ç¾¤ä½“å¿ƒç†â€ã€‚ä¸“ä¸šæŠ•èµ„è€…åŠè¯åˆ¸è¡Œä¸šä¸“å®¶çš„æ„è§å°†ä¸èƒ½æŠµæ¶ˆç¾¤ä½“çš„è§‚ç‚¹ï¼Œäºæ˜¯ä»–ä»¬å°†è¯•å›¾å»é¢„æµ‹å…¬ä¼—å¯¹è‚¡ç¥¨ä¼°å€¼çš„å˜åŒ–ã€‚</li><li>ç”Ÿå­˜æ³•åˆ™<ol><li>ä½ å¿…é¡»æŠ•èµ„</li><li>æ—¶é—´æ˜¯ä½ çš„æœ‹å‹</li><li>å†²åŠ¨æ˜¯ä½ çš„æ•Œäºº</li><li>æŒæ¡åŸºæœ¬çš„ç®—æœ¯</li><li>åšæŒç®€å•åŒ–å¹¶ä¸”åšæŒåˆ°åº•</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç»æµ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¥¶ç‰›çš„ç§˜å¯†ç”Ÿæ´»</title>
    <link href="/dajiangdahe/2021/10/22/%E3%80%90%E6%95%A3%E6%96%87%E3%80%91%E5%A5%B6%E7%89%9B%E7%9A%84%E7%A7%98%E5%AF%86%E7%94%9F%E6%B4%BB/"/>
    <url>/dajiangdahe/2021/10/22/%E3%80%90%E6%95%A3%E6%96%87%E3%80%91%E5%A5%B6%E7%89%9B%E7%9A%84%E7%A7%98%E5%AF%86%E7%94%9F%E6%B4%BB/</url>
    
    <content type="html"><![CDATA[<h1><strong>ã€Šå¥¶ç‰›çš„ç§˜å¯†ç”Ÿæ´»ã€‹ï¼ˆç½—èæ›¼å¾· æ‰¬ï¼‰</strong></h1><p>è¿™æœ¬ä¹¦æœ€å€¼çš„æ€è€ƒçš„ä¸€ä¸ªåœ°æ–¹å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çˆ±ä»–ï¼ˆæ— è®ºæ˜¯å‹æƒ…ã€çˆ±æƒ…ã€äº²æƒ…ï¼‰æˆ‘ä»¬éƒ½åº”è¯¥ç§¯æçš„å‚ä¸ä»–ä»¬çš„ç”Ÿæ´»ï¼Œè§‚å¯Ÿä»–ä»¬çš„å–œå¥½ã€‚è¿™ä¸ä»…ä»…æ˜¯æˆ‘ä»¬è¡¨è¾¾çˆ±æ„çš„ä¸€ç§æ–¹å¼ï¼Œæ›´æ˜¯ä¸€ç§æˆ‘å¯ä»¥æ¢ä½æ€è€ƒï¼Œå¤„åœ¨å¯¹æ–¹çš„è§’åº¦å»æ€è€ƒé—®é¢˜çš„ç†è§£ã€‚</p><p>ä»¤ï¼šè¿™æœ¬æ•£æ–‡ä¹¦å¹¶ä¸æ²¡æœ‰å…¨éƒ¨çš„çœ‹å®Œï¼Œå®é™…ä¸Šéšç€å¹´é¾„å’Œé˜…è¯»ç†è§£çš„å¢é•¿ï¼Œçœ‹è¿™ç§ç±»å‹çš„ä¹¦ï¼Œä¸€éƒ¨åˆ†å°±èƒ½å¤Ÿæ˜ç™½ä½œè€…è¦è®²è¿°ä»€ä¹ˆå†…å®¹ï¼Œä¹Ÿå°±æ²¡æœ‰å…¨éƒ¨çœ‹å®Œçš„å¿…è¦ã€‚ï¼ˆä¸»è¦æ˜¯å¯¹æ•£æ–‡å®åœ¨ä¸æ„Ÿå†’ï¼Œå°±åƒæ‘ä¸Šæ˜¥æ ‘çš„ã€Šå¤§èåœå’Œéš¾æŒ‘çš„é³„æ¢¨ã€‹ï¼Œæˆ–è€…é™ˆå¹³åŸã€Šç¥ç¥é¬¼é¬¼ã€‹ã€æˆ–è€…é’±ç†ç¾¤ã€Šè¯´ä¸œé“è¥¿ã€‹ï¼‰å€’æ˜¯è§‰å¾—è¿™ç§æ•£æ–‡ç±»å‹çš„ä¹¦åƒæ˜¯å•æ‰€è¯»ä¹¦ï¼Œä»–åªåº”è¯¥å‘†åœ¨å•æ‰€çš„æ¶å­ä¸Šï¼Œé™ªä¼´è‡ªå·±åº¦è¿‡â€œç¾å¦™â€çš„ä¸€æ®µæ—¶é—´ã€‚</p><p>æ‘˜1ï¼šåˆé€‚çš„é£Ÿç‰©æ˜¯å¥åº·çš„èµ·ç‚¹å’Œç»ˆç‚¹ã€‚</p><p>ä»Šæ—¥2021.3.21ï¼Œä½“é‡138ï¼Œæœ€è¿‘ä¸€å‘¨å¹¶æ²¡æœ‰ç®¡ä½è‡ªå·±çš„å£è…¹ä¹‹æ¬²ï¼Œå¯¼è‡´ä¸ºæœŸä¸€å‘¨çš„200min+æ—¶é•¿æµªè´¹äº†ã€‚è‡ªå¾‹æœç„¶æ˜¯æœ€éš¾çš„ï¼Œä»¥åè¦åˆ†æˆä¸€å‘¨ä¸€å‘¨å»ç®¡ç†æ—¶é—´ï¼ˆäº‹å®ä¸Šä¹Ÿå¾ˆéš¾ï¼‰ï¼Œç®¡ç†é¥®é£Ÿï¼Œè¿™æ ·å°±èº²é¿äº†è¿ç»­å‡ ä¸ªæœˆæƒ³è±¡ä¸åˆ°çš„ç—›è‹¦å’ŒæŠ˜ç£¨ï¼ˆåƒçš„æ—¶å€™å…¶å®å¹¶æ²¡æœ‰é‚£ä¹ˆæŠ˜ç£¨ï¼Œè¿™å‡è‚¥è·¯ä¸Šçš„ç»Šè„šçŸ³æ˜¯çœŸæ»´å¤šï¼‰ï¼ˆå¥½åƒçš„ä¹Ÿå¤ªå¤šäº†ï¼‰</p><p>æ‘˜2ï¼šå…³äºå¥¶ç‰›ä½ åº”è¯¥çŸ¥é“çš„äºŒåä»¶äº‹ï¼ˆæ‡’çš„æ‰“å‡ºæ¥äº†ï¼Œæˆªå›¾å§ï¼‰</p><img src="/dajiangdahe.github.io/2021/10/22/%E3%80%90%E6%95%A3%E6%96%87%E3%80%91%E5%A5%B6%E7%89%9B%E7%9A%84%E7%A7%98%E5%AF%86%E7%94%9F%E6%B4%BB/clipboard.png" class="" title="img"><p>æ‘˜3ï¼šå…³äºç»µç¾Šä½ åº”è¯¥çŸ¥é“çš„äºŒåä»¶äº‹</p><img src="/dajiangdahe.github.io/2021/10/22/%E3%80%90%E6%95%A3%E6%96%87%E3%80%91%E5%A5%B6%E7%89%9B%E7%9A%84%E7%A7%98%E5%AF%86%E7%94%9F%E6%B4%BB/clipboard-1631537089379.png" class="" title="img"><p>æ‘˜4ï¼šå…³äºæ¯é¸¡ä½ åº”è¯¥çŸ¥é“çš„äºŒåä»¶äº‹</p><img src="/dajiangdahe.github.io/2021/10/22/%E3%80%90%E6%95%A3%E6%96%87%E3%80%91%E5%A5%B6%E7%89%9B%E7%9A%84%E7%A7%98%E5%AF%86%E7%94%9F%E6%B4%BB/clipboard-1631537104447.png" class="" title="img"><p>æ‘˜5ï¼šå…³äºçŒªä½ åº”è¯¥çŸ¥é“çš„äºŒåä»¶äº‹</p><img src="/dajiangdahe.github.io/2021/10/22/%E3%80%90%E6%95%A3%E6%96%87%E3%80%91%E5%A5%B6%E7%89%9B%E7%9A%84%E7%A7%98%E5%AF%86%E7%94%9F%E6%B4%BB/clipboard-1631537118561.png" class="" title="img"><p>ä»¤2ï¼šå…³äºæˆ‘è‡ªå·±çš„äºŒåä»¶ä½ å¿…é¡»çŸ¥é“çš„äº‹æƒ…</p><p>1.ä½ å¿…é¡»çŸ¥é“æˆ‘å¥½çœ‹</p><p>2.ä½ å¿…é¡»çŸ¥é“æˆ‘æœ‰è¶£</p><p>3.ä½ å¿…é¡»çŸ¥é“æˆ‘å–œæ¬¢åƒå¥½åƒçš„</p><p>4.ä½ å¿…é¡»æ‰¿è®¤æˆ‘æœ‰é­…åŠ›</p><p>5.è™½ç„¶å¾ˆä¸çˆ±å«ç”Ÿï¼Œä½†æ˜¯å‡ºé—¨å‰ä¸€å®šæ”¶æ‹¾çš„å¾ˆåˆ©ç´¢</p><p>6.æˆ‘æ¯å¤©æ—©ä¸Šéƒ½ä¼šå¯¹ç€é•œå­ç¬‘ä¸€ç¬‘</p><p>7.åƒé¥­çš„æ—¶å€™å¿…é¡»çœ‹æ­¦æ—å¤–ä¼ </p><p>8.å–œæ¬¢æµ…è‰²ç³»è¡£æœ</p><p>9.å–œæ¬¢æ—¶è€Œå¯çˆ±ï¼Œæ—¶è€ŒèºåŠ¨çš„ç¾å¥³ï¼Œä½ ä¸ç¾å¯ä»¥ï¼Œä½†å¾—æ¼‚äº®</p><p>10.æˆ‘ä¸é«˜å…´çš„æ—¶å€™å°±åªæƒ³èººåœ¨åºŠä¸Š</p><p>11.æˆ‘å–œæ¬¢å‡ºå»ç©ï¼Œä¸€ä¸ªäººä¹Ÿå¾ˆå–œæ¬¢</p><p>12.æˆ‘æ‰¿è®¤è‡ªå·±æœ‰æ—¶å€™å¾ˆåºŸæŸ´</p><p>13.æˆ‘éå¸¸æš´èºï¼Œä½†æ˜¯æˆ‘èƒ½æœ‰ä¸€ç¾¤å¯çˆ±çš„æœ‹å‹</p><p>14.å¦‚æœå¼•èµ·äº†äº‰è¾©ï¼Œæˆ‘ä¼šæ‹¿å‡ºåäºŒåˆ†ç²¾ç¥æ¥ï¼Œè¯·ä¸è¦è¯´è¿™æ˜¯â€œå¼€ç©ç¬‘â€â€¦</p><p>15.ä½ å¿…é¡»ç›´æ¥ç”¨ä½ çš„ä¸“ä¸šç´ å…»å‡»è´¥æˆ‘ã€‚</p><p>16.æˆ‘ä¼šæ‰¿è®¤æ¯”æˆ‘å¼ºçš„äººï¼Œæˆ‘ä¹Ÿä¸ä¼šå«‰å¦’ä»–ä»¬ï¼Œä¼šå­¦ç€æ‰“è´¥ä»–ä»¬</p><p>17.æˆ‘æ¯å¤©éƒ½éœ€è¦ç¡åˆè§‰ï¼Œè¿™æ˜¯è„¾æ°”æœ€å·®çš„æ—¶å€™</p><p>18.å¾ˆè®¨åŒä¸æ˜ç¡®æŸä¸ªâ€œæ¦‚å¿µâ€çš„äººå¯¹æˆ‘è¿›è¡ŒæŒ‡å¯¼ï¼Œå› ä¸ºæˆ‘è¿™å°±æ˜¯è¿™æ ·çš„äºº</p><p>19.æˆ‘ä¼šå…³å¿ƒäºº</p><p>20.çœ‹å®Œçš„äººå¯ä»¥ç»™æˆ‘ä»‹ç»å¥³æœ‹å‹äº†</p>]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•£æ–‡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®ºZY</title>
    <link href="/dajiangdahe/2021/10/22/%E3%80%90ZZ%E3%80%91%E8%AE%BAZY/"/>
    <url>/dajiangdahe/2021/10/22/%E3%80%90ZZ%E3%80%91%E8%AE%BAZY/</url>
    
    <content type="html"><![CDATA[<h1>è®ºZYï¼ˆçº¦ç¿°Â·ç©†å‹’ï¼‰</h1><h2 id="1-å¯¼è¯»">1.å¯¼è¯»</h2><img src="/dajiangdahe.github.io/2021/10/22/%E3%80%90ZZ%E3%80%91%E8%AE%BAZY/image-20211226230618684.png" class="" title="image-20211226230618684"><h2 id="2-å¼•è®º">2.å¼•è®º</h2><img src="/dajiangdahe.github.io/2021/10/22/%E3%80%90ZZ%E3%80%91%E8%AE%BAZY/image-20211226230641574.png" class="" title="image-20211226230641574"><img src="/dajiangdahe.github.io/2021/10/22/%E3%80%90ZZ%E3%80%91%E8%AE%BAZY/image-20211226230652998.png" class="" title="image-20211226230652998">]]></content>
    
    
    <categories>
      
      <category>ä¹¦ç±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>zz</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisé›†ç¾¤æ¨¡å¼</title>
    <link href="/dajiangdahe/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/"/>
    <url>/dajiangdahe/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>ä»å®è§‚è§’åº¦å›é¡¾ä¸€ä¸‹Rediså®ç°é«˜å¯ç”¨ç›¸å…³çš„æŠ€æœ¯ã€‚å®ƒä»¬åŒ…æ‹¬ï¼šæŒä¹…åŒ–ã€å¤åˆ¶ã€å“¨å…µå’Œé›†ç¾¤ï¼Œå…¶ä¸»è¦ä½œç”¨å’Œè§£å†³çš„é—®é¢˜æ˜¯ï¼š</p><ul><li>æŒä¹…åŒ–ï¼šæŒä¹…åŒ–æ˜¯æœ€ç®€å•çš„é«˜å¯ç”¨æ–¹æ³•(æœ‰æ—¶ç”šè‡³ä¸è¢«å½’ä¸ºé«˜å¯ç”¨çš„æ‰‹æ®µ)ï¼Œä¸»è¦ä½œç”¨æ˜¯æ•°æ®å¤‡ä»½ï¼Œå³å°†æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ï¼Œä¿è¯æ•°æ®ä¸ä¼šå› è¿›ç¨‹é€€å‡ºè€Œä¸¢å¤±ã€‚</li><li>å¤åˆ¶ï¼šå¤åˆ¶æ˜¯é«˜å¯ç”¨Redisçš„åŸºç¡€ï¼Œå“¨å…µå’Œé›†ç¾¤éƒ½æ˜¯åœ¨å¤åˆ¶åŸºç¡€ä¸Šå®ç°é«˜å¯ç”¨çš„ã€‚å¤åˆ¶ä¸»è¦å®ç°äº†æ•°æ®çš„å¤šæœºå¤‡ä»½ï¼Œä»¥åŠå¯¹äºè¯»æ“ä½œçš„è´Ÿè½½å‡è¡¡å’Œç®€å•çš„æ•…éšœæ¢å¤ã€‚ç¼ºé™·ï¼šæ•…éšœæ¢å¤æ— æ³•è‡ªåŠ¨åŒ–ï¼›å†™æ“ä½œæ— æ³•è´Ÿè½½å‡è¡¡ï¼›å­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚</li><li>å“¨å…µï¼šåœ¨å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œå“¨å…µå®ç°äº†è‡ªåŠ¨åŒ–çš„æ•…éšœæ¢å¤ã€‚ç¼ºé™·ï¼šå†™æ“ä½œæ— æ³•è´Ÿè½½å‡è¡¡ï¼›å­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚</li><li>é›†ç¾¤ï¼šé€šè¿‡é›†ç¾¤ï¼ŒRedisè§£å†³äº†å†™æ“ä½œæ— æ³•è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠå­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºé™åˆ¶çš„é—®é¢˜ï¼Œå®ç°äº†è¾ƒä¸ºå®Œå–„çš„é«˜å¯ç”¨æ–¹æ¡ˆã€‚</li></ul><h1>1.Redisä¸»ä»å¤åˆ¶</h1><h2 id="æ¦‚å¿µ">æ¦‚å¿µ</h2><p>ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave)ï¼›æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯å°RedisæœåŠ¡å™¨éƒ½æ˜¯ä¸»èŠ‚ç‚¹ï¼›ä¸”ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹(æˆ–æ²¡æœ‰ä»èŠ‚ç‚¹)ï¼Œä½†ä¸€ä¸ªä»èŠ‚ç‚¹åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚</p><h2 id="ä½œç”¨">ä½œç”¨</h2><ol><li>æ•°æ®å†—ä½™ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼</li><li>æ•…éšœæ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›</li><li>è´Ÿè½½å‡è¡¡ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼Œåˆ†æ‹…æœåŠ¡å™¨å‹åŠ›ï¼›åœ¨å¤šè¯»å°‘å†™çš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹è¿›è¡Œåˆ†æ‹…è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§çš„æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li><li>é«˜å¯ç”¨åŸºçŸ³ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤å®ç°çš„åŸºç¡€ã€‚</li></ol><h2 id="å¦‚ä½•ä½¿ç”¨ä¸»ä»å¤åˆ¶">å¦‚ä½•ä½¿ç”¨ä¸»ä»å¤åˆ¶</h2><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/a6c2adcacf3c3ebebd2853021a02ca32.png" class="" title="img"><p><strong>ä¸»ä»å¤åˆ¶çš„å¼€å¯ï¼Œå®Œå…¨æ˜¯åœ¨ä»èŠ‚ç‚¹å‘èµ·çš„ï¼›ä¸éœ€è¦æˆ‘ä»¬åœ¨ä¸»èŠ‚ç‚¹åšä»»ä½•äº‹æƒ…ã€‚</strong></p><ol><li><p>å¼€å¯ä¸»ä»å¤åˆ¶</p><ul><li>åœ¨slave ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šslaveof <masterip> <masterport></li><li>åœ¨ slave é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ï¼šslaveof <masterip> <masterport></li><li>ä½¿ç”¨å¯åŠ¨å‘½ä»¤ï¼šâ€“slaveof <masterip> <masterport></li></ul><p>æ³¨ï¼šåœ¨ Redis 5.0 ä¹‹åï¼Œslaveof ç›¸å…³å‘½ä»¤å’Œé…ç½®å·²ç»è¢«æ›¿æ¢æˆ replicaofï¼Œä¾‹å¦‚ replicaof <masterip> <masterport>ã€‚ä¸ºäº†å…¼å®¹æ—§ç‰ˆæœ¬ï¼Œé€šè¿‡é…ç½®çš„æ–¹å¼ä»ç„¶æ”¯æŒ slaveofï¼Œä½†æ˜¯é€šè¿‡å‘½ä»¤çš„æ–¹å¼åˆ™ä¸è¡Œäº†ã€‚</p></li><li><p>å»ºç«‹socketè¿æ¥</p><p>slave å°†æ ¹æ®æŒ‡å®šçš„ IP åœ°å€å’Œç«¯å£ï¼Œå‘ master å‘èµ·å¥—æ¥å­—ï¼ˆsocketï¼‰è¿æ¥ï¼Œmaster åœ¨æ¥å—acceptï¼‰slave çš„å¥—æ¥å­—è¿æ¥ä¹‹åï¼Œä¸ºè¯¥å¥—æ¥å­—åˆ›å»ºç›¸åº”çš„å®¢æˆ·ç«¯çŠ¶æ€ï¼Œæ­¤æ—¶è¿æ¥å»ºç«‹å®Œæˆã€‚</p></li><li><p>å‘é€Pingå‘½ä»¤</p><p>slave å‘ master å‘é€ä¸€ä¸ª PING å‘½ä»¤ï¼Œä»¥æ£€æŸ»å¥—æ¥å­—çš„è¯»å†™çŠ¶æ€æ˜¯å¦æ­£å¸¸ã€ master èƒ½å¦æ­£å¸¸å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚</p></li><li><p>èº«ä»½éªŒè¯</p><p>slave å‘ master å‘é€ AUTH password å‘½ä»¤æ¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p></li><li><p>å‘é€ç«¯å£ä¿¡æ¯</p><p>åœ¨èº«ä»½éªŒè¯é€šè¿‡ååï¼Œ slave å°†å‘ master å‘é€è‡ªå·±çš„ç›‘å¬ç«¯å£å·ï¼Œ master æ”¶åˆ°åè®°å½•åœ¨ slave æ‰€å¯¹åº”çš„å®¢æˆ·ç«¯çŠ¶æ€çš„ slave_listening_port å±æ€§ä¸­ã€‚</p></li><li><p>å‘é€IPåœ°å€</p><p>å¦‚æœé…ç½®äº† slave_announce_ipï¼Œåˆ™ slave å‘ master å‘é€ slave_announce_ip é…ç½®çš„ IP åœ°å€ï¼Œ master æ”¶åˆ°åè®°å½•åœ¨ slave æ‰€å¯¹åº”çš„å®¢æˆ·ç«¯çŠ¶æ€çš„ slave_ip å±æ€§ã€‚</p><p>è¯¥é…ç½®æ˜¯ç”¨äºè§£å†³æœåŠ¡å™¨è¿”å›å†…ç½‘ IP æ—¶ï¼Œå…¶ä»–æœåŠ¡å™¨æ— æ³•è®¿é—®çš„æƒ…å†µã€‚å¯ä»¥é€šè¿‡è¯¥é…ç½®ç›´æ¥æŒ‡å®šå…¬ç½‘ IPã€‚</p></li><li><p>å‘é€CAPA</p><p>CAPA å…¨ç§°æ˜¯ capabilitiesï¼Œè¿™è¾¹è¡¨ç¤ºçš„æ˜¯åŒæ­¥å¤åˆ¶çš„èƒ½åŠ›ã€‚slave ä¼šåœ¨è¿™ä¸€é˜¶æ®µå‘é€ capa å‘Šè¯‰ master è‡ªå·±å…·å¤‡çš„ï¼ˆåŒæ­¥ï¼‰å¤åˆ¶èƒ½åŠ›ï¼Œ master æ”¶åˆ°åè®°å½•åœ¨ slave æ‰€å¯¹åº”çš„å®¢æˆ·ç«¯çŠ¶æ€çš„ slave_capa å±æ€§ã€‚</p></li><li><p>æ•°æ®åŒæ­¥</p><p>slave å°†å‘ master å‘é€ PSYNC å‘½ä»¤ï¼Œ master æ”¶åˆ°è¯¥å‘½ä»¤ååˆ¤æ–­æ˜¯è¿›è¡Œéƒ¨åˆ†é‡åŒæ­¥è¿˜æ˜¯å®Œæ•´é‡åŒæ­¥ï¼Œç„¶åæ ¹æ®ç­–ç•¥è¿›è¡Œæ•°æ®çš„åŒæ­¥ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ•°æ®åŒæ­¥é˜¶æ®µä¹‹å‰ï¼Œä»èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ï¼Œä¸»èŠ‚ç‚¹ä¸æ˜¯ä»èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ï¼›è€Œåˆ°äº†è¿™ä¸€é˜¶æ®µåŠä»¥åï¼Œä¸»ä»èŠ‚ç‚¹äº’ä¸ºå®¢æˆ·ç«¯ã€‚åŸå› åœ¨äºï¼šåœ¨æ­¤ä¹‹å‰ï¼Œä¸»èŠ‚ç‚¹åªéœ€è¦å“åº”ä»èŠ‚ç‚¹çš„è¯·æ±‚å³å¯ï¼Œä¸éœ€è¦ä¸»åŠ¨å‘è¯·æ±‚ï¼Œè€Œåœ¨æ•°æ®åŒæ­¥é˜¶æ®µå’Œåé¢çš„å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä¸»èŠ‚ç‚¹éœ€è¦ä¸»åŠ¨å‘ä»èŠ‚ç‚¹å‘é€è¯·æ±‚ï¼ˆå¦‚æ¨é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼‰ï¼Œæ‰èƒ½å®Œæˆå¤åˆ¶ã€‚</p></li><li><p>å‘½ä»¤ä¼ æ’­</p><p>å½“å®Œæˆäº†åŒæ­¥ä¹‹åï¼Œå°±ä¼šè¿›å…¥å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œè¿™æ—¶ master åªè¦ä¸€ç›´å°†è‡ªå·±æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ slave ï¼Œè€Œ slave åªè¦ä¸€ç›´æ¥æ”¶å¹¶æ‰§è¡Œ master å‘æ¥çš„å†™å‘½ä»¤ï¼Œå°±å¯ä»¥ä¿è¯ master å’Œ slave ä¸€ç›´ä¿æŒä¸€è‡´äº†ã€‚</p><p>åœ¨å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œé™¤äº†å‘é€å†™å‘½ä»¤ï¼Œä¸»ä»èŠ‚ç‚¹è¿˜ç»´æŒç€å¿ƒè·³æœºåˆ¶ï¼šPINGå’ŒREPLCONF ACKã€‚ç”±äºå¿ƒè·³æœºåˆ¶çš„åŸç†æ¶‰åŠéƒ¨åˆ†å¤åˆ¶ï¼Œå› æ­¤å°†åœ¨ä»‹ç»äº†éƒ¨åˆ†å¤åˆ¶çš„ç›¸å…³å†…å®¹åå•ç‹¬ä»‹ç»è¯¥å¿ƒè·³æœºåˆ¶ã€‚</p><p><strong>ã€å»¶è¿Ÿä¸ä¸ä¸€è‡´ã€‘</strong></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‘½ä»¤ä¼ æ’­æ˜¯å¼‚æ­¥çš„è¿‡ç¨‹ï¼Œå³ä¸»èŠ‚ç‚¹å‘é€å†™å‘½ä»¤åå¹¶ä¸ä¼šç­‰å¾…ä»èŠ‚ç‚¹çš„å›å¤ï¼›å› æ­¤å®é™…ä¸Šä¸»ä»èŠ‚ç‚¹ä¹‹é—´å¾ˆéš¾ä¿æŒå®æ—¶çš„ä¸€è‡´æ€§ï¼Œå»¶è¿Ÿåœ¨æ‰€éš¾å…ã€‚æ•°æ®ä¸ä¸€è‡´çš„ç¨‹åº¦ï¼Œä¸ä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œçŠ¶å†µã€ä¸»èŠ‚ç‚¹å†™å‘½ä»¤çš„æ‰§è¡Œé¢‘ç‡ã€ä»¥åŠä¸»èŠ‚ç‚¹ä¸­çš„repl-disable-tcp-nodelayé…ç½®ç­‰æœ‰å…³ã€‚</p><p>repl-disable-tcp-nodelay noï¼šè¯¥é…ç½®ä½œç”¨äºå‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œæ§åˆ¶ä¸»èŠ‚ç‚¹æ˜¯å¦ç¦æ­¢ä¸ä»èŠ‚ç‚¹çš„TCP_NODELAYï¼›é»˜è®¤noï¼Œå³ä¸ç¦æ­¢TCP_NODELAYã€‚å½“è®¾ç½®ä¸ºyesæ—¶ï¼ŒTCPä¼šå¯¹åŒ…è¿›è¡Œåˆå¹¶ä»è€Œå‡å°‘å¸¦å®½ï¼Œä½†æ˜¯å‘é€çš„é¢‘ç‡ä¼šé™ä½ï¼Œä»èŠ‚ç‚¹æ•°æ®å»¶è¿Ÿå¢åŠ ï¼Œä¸€è‡´æ€§å˜å·®ï¼›å…·ä½“å‘é€é¢‘ç‡ä¸Linuxå†…æ ¸çš„é…ç½®æœ‰å…³ï¼Œé»˜è®¤é…ç½®ä¸º40msã€‚å½“è®¾ç½®ä¸ºnoæ—¶ï¼ŒTCPä¼šç«‹é©¬å°†ä¸»èŠ‚ç‚¹çš„æ•°æ®å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œå¸¦å®½å¢åŠ ä½†å»¶è¿Ÿå˜å°ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰å½“åº”ç”¨å¯¹Redisæ•°æ®ä¸ä¸€è‡´çš„å®¹å¿åº¦è¾ƒé«˜ï¼Œä¸”ä¸»ä»èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œçŠ¶å†µä¸å¥½æ—¶ï¼Œæ‰ä¼šè®¾ç½®ä¸ºyesï¼›å¤šæ•°æƒ…å†µä½¿ç”¨é»˜è®¤å€¼noã€‚</p><p><strong>ã€ä¼˜åŒ–æªæ–½ã€‘</strong></p><ul><li><p>ä¼˜åŒ–ä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œç¯å¢ƒï¼ˆå¦‚åœ¨åŒæœºæˆ¿éƒ¨ç½²ï¼‰</p></li><li><p>ç›‘æ§ä¸»ä»èŠ‚ç‚¹å»¶è¿Ÿï¼ˆé€šè¿‡offsetï¼‰åˆ¤æ–­ï¼Œå¦‚æœä»èŠ‚ç‚¹å»¶è¿Ÿè¿‡å¤§ï¼Œé€šçŸ¥åº”ç”¨ä¸å†é€šè¿‡è¯¥ä»èŠ‚ç‚¹è¯»å–æ•°æ®</p></li><li><p>ä½¿ç”¨é›†ç¾¤åŒæ—¶æ‰©å±•å†™è´Ÿè½½å’Œè¯»è´Ÿè½½</p></li></ul></li></ol><h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/image-20210924143457687.png" class="" title="image-20210924143457687"><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/image-20210924143508264.png" class="" title="image-20210924143508264"><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/image-20210924143519389.png" class="" title="image-20210924143519389"><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/image-20210924143551169.png" class="" title="image-20210924143551169"><h2 id="ã€æ•°æ®åŒæ­¥é˜¶æ®µã€‘å…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶">ã€æ•°æ®åŒæ­¥é˜¶æ®µã€‘å…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶</h2><ol><li>å…¨é‡å¤åˆ¶ï¼šç”¨äºåˆæ¬¡å¤åˆ¶æˆ–å…¶ä»–æ— æ³•è¿›è¡Œéƒ¨åˆ†å¤åˆ¶çš„æƒ…å†µï¼Œå°†ä¸»èŠ‚ç‚¹ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªéå¸¸é‡å‹çš„æ“ä½œã€‚</li><li>éƒ¨åˆ†å¤åˆ¶ï¼šç”¨äºç½‘ç»œä¸­æ–­ç­‰æƒ…å†µåçš„å¤åˆ¶ï¼Œåªå°†ä¸­æ–­æœŸé—´ä¸»èŠ‚ç‚¹æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¸å…¨é‡å¤åˆ¶ç›¸æ¯”æ›´åŠ é«˜æ•ˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç½‘ç»œä¸­æ–­æ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´ä¸»èŠ‚ç‚¹æ²¡æœ‰èƒ½å¤Ÿå®Œæ•´åœ°ä¿å­˜ä¸­æ–­æœŸé—´æ‰§è¡Œçš„å†™å‘½ä»¤ï¼Œåˆ™æ— æ³•è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ï¼Œä»ä½¿ç”¨å…¨é‡å¤åˆ¶ã€‚</li></ol><h3 id="å…¨é‡å¤åˆ¶">å…¨é‡å¤åˆ¶</h3><p>Redisé€šè¿‡psyncå‘½ä»¤è¿›è¡Œå…¨é‡å¤åˆ¶çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰ä»èŠ‚ç‚¹åˆ¤æ–­æ— æ³•è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ï¼Œå‘ä¸»èŠ‚ç‚¹å‘é€å…¨é‡å¤åˆ¶çš„è¯·æ±‚ï¼›æˆ–ä»èŠ‚ç‚¹å‘é€éƒ¨åˆ†å¤åˆ¶çš„è¯·æ±‚ï¼Œä½†ä¸»èŠ‚ç‚¹åˆ¤æ–­æ— æ³•è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ï¼›å…·ä½“åˆ¤æ–­è¿‡ç¨‹éœ€è¦åœ¨è®²è¿°äº†éƒ¨åˆ†å¤åˆ¶åŸç†åå†ä»‹ç»ã€‚</p><p>ï¼ˆ2ï¼‰ä¸»èŠ‚ç‚¹æ”¶åˆ°å…¨é‡å¤åˆ¶çš„å‘½ä»¤åï¼Œæ‰§è¡Œbgsaveï¼Œåœ¨åå°ç”ŸæˆRDBæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªç¼“å†²åŒºï¼ˆç§°ä¸ºå¤åˆ¶ç¼“å†²åŒºï¼‰è®°å½•ä»ç°åœ¨å¼€å§‹æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤</p><p>ï¼ˆ3ï¼‰ä¸»èŠ‚ç‚¹çš„bgsaveæ‰§è¡Œå®Œæˆåï¼Œå°†RDBæ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹ï¼›<strong>ä»èŠ‚ç‚¹é¦–å…ˆæ¸…é™¤è‡ªå·±çš„æ—§æ•°æ®ï¼Œç„¶åè½½å…¥æ¥æ”¶çš„RDBæ–‡ä»¶</strong>ï¼Œå°†æ•°æ®åº“çŠ¶æ€æ›´æ–°è‡³ä¸»èŠ‚ç‚¹æ‰§è¡Œbgsaveæ—¶çš„æ•°æ®åº“çŠ¶æ€</p><p>ï¼ˆ4ï¼‰ä¸»èŠ‚ç‚¹å°†å‰è¿°å¤åˆ¶ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹æ‰§è¡Œè¿™äº›å†™å‘½ä»¤ï¼Œå°†æ•°æ®åº“çŠ¶æ€æ›´æ–°è‡³ä¸»èŠ‚ç‚¹çš„æœ€æ–°çŠ¶æ€</p><p>ï¼ˆ5ï¼‰å¦‚æœä»èŠ‚ç‚¹å¼€å¯äº†AOFï¼Œåˆ™ä¼šè§¦å‘bgrewriteaofçš„æ‰§è¡Œï¼Œä»è€Œä¿è¯AOFæ–‡ä»¶æ›´æ–°è‡³ä¸»èŠ‚ç‚¹çš„æœ€æ–°çŠ¶æ€</p><p>é€šè¿‡å…¨é‡å¤åˆ¶çš„è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œå…¨é‡å¤åˆ¶æ˜¯éå¸¸é‡å‹çš„æ“ä½œï¼š</p><p>ï¼ˆ1ï¼‰ä¸»èŠ‚ç‚¹é€šè¿‡bgsaveå‘½ä»¤forkå­è¿›ç¨‹è¿›è¡ŒRDBæŒä¹…åŒ–ï¼Œè¯¥è¿‡ç¨‹æ˜¯éå¸¸æ¶ˆè€—CPUã€å†…å­˜(é¡µè¡¨å¤åˆ¶)ã€ç¡¬ç›˜IOçš„ï¼›å…³äºbgsaveçš„æ€§èƒ½é—®é¢˜ã€‚</p><p>ï¼ˆ2ï¼‰ä¸»èŠ‚ç‚¹é€šè¿‡ç½‘ç»œå°†RDBæ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œå¯¹ä¸»ä»èŠ‚ç‚¹çš„å¸¦å®½éƒ½ä¼šå¸¦æ¥å¾ˆå¤§çš„æ¶ˆè€—</p><p>ï¼ˆ3ï¼‰ä»èŠ‚ç‚¹æ¸…ç©ºè€æ•°æ®ã€è½½å…¥æ–°RDBæ–‡ä»¶çš„è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œæ— æ³•å“åº”å®¢æˆ·ç«¯çš„å‘½ä»¤ï¼›å¦‚æœä»èŠ‚ç‚¹æ‰§è¡Œbgrewriteaofï¼Œä¹Ÿä¼šå¸¦æ¥é¢å¤–çš„æ¶ˆè€—</p><p><strong>ã€ç¤ºä¾‹ã€‘</strong></p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/image-20210924152335494.png" class="" title="image-20210924152335494"><h3 id="éƒ¨åˆ†å¤åˆ¶">éƒ¨åˆ†å¤åˆ¶</h3><p>ç”±äºå…¨é‡å¤åˆ¶åœ¨ä¸»èŠ‚ç‚¹æ•°æ®é‡è¾ƒå¤§æ—¶æ•ˆç‡å¤ªä½ï¼Œå› æ­¤Redis2.8å¼€å§‹æä¾›éƒ¨åˆ†å¤åˆ¶ï¼Œç”¨äºå¤„ç†ç½‘ç»œä¸­æ–­æ—¶çš„æ•°æ®åŒæ­¥ã€‚</p><p>éƒ¨åˆ†å¤åˆ¶çš„å®ç°ï¼Œä¾èµ–äºä¸‰ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p><h4 id="ï¼ˆ1ï¼‰å¤åˆ¶åç§»é‡">ï¼ˆ1ï¼‰å¤åˆ¶åç§»é‡</h4><p>ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹åˆ†åˆ«ç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰ï¼Œä»£è¡¨çš„æ˜¯<strong>ä¸»èŠ‚ç‚¹å‘ä»èŠ‚ç‚¹ä¼ é€’çš„å­—èŠ‚æ•°</strong>ï¼›ä¸»èŠ‚ç‚¹æ¯æ¬¡å‘ä»èŠ‚ç‚¹ä¼ æ’­Nä¸ªå­—èŠ‚æ•°æ®æ—¶ï¼Œä¸»èŠ‚ç‚¹çš„offsetå¢åŠ Nï¼›ä»èŠ‚ç‚¹æ¯æ¬¡æ”¶åˆ°ä¸»èŠ‚ç‚¹ä¼ æ¥çš„Nä¸ªå­—èŠ‚æ•°æ®æ—¶ï¼Œä»èŠ‚ç‚¹çš„offsetå¢åŠ Nã€‚</p><p>offsetç”¨äºåˆ¤æ–­ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®åº“çŠ¶æ€æ˜¯å¦ä¸€è‡´ï¼šå¦‚æœäºŒè€…offsetç›¸åŒï¼Œåˆ™ä¸€è‡´ï¼›å¦‚æœoffsetä¸åŒï¼Œåˆ™ä¸ä¸€è‡´ï¼Œæ­¤æ—¶å¯ä»¥æ ¹æ®ä¸¤ä¸ªoffsetæ‰¾å‡ºä»èŠ‚ç‚¹ç¼ºå°‘çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸»èŠ‚ç‚¹çš„offsetæ˜¯1000ï¼Œè€Œä»èŠ‚ç‚¹çš„offsetæ˜¯500ï¼Œé‚£ä¹ˆéƒ¨åˆ†å¤åˆ¶å°±éœ€è¦å°†offsetä¸º501-1000çš„æ•°æ®ä¼ é€’ç»™ä»èŠ‚ç‚¹ã€‚è€Œoffsetä¸º501-1000çš„æ•°æ®å­˜å‚¨çš„ä½ç½®ï¼Œå°±æ˜¯ä¸‹é¢è¦ä»‹ç»çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€‚</p><h4 id="ï¼ˆ2ï¼‰å¤åˆ¶ç§¯å‹ç¼“å†²åŒº">ï¼ˆ2ï¼‰å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</h4><p>å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ˜¯ç”±ä¸»èŠ‚ç‚¹ç»´æŠ¤çš„ã€å›ºå®šé•¿åº¦çš„ã€å…ˆè¿›å…ˆå‡º(FIFO)é˜Ÿåˆ—ï¼Œé»˜è®¤å¤§å°1MBï¼›å½“ä¸»èŠ‚ç‚¹å¼€å§‹æœ‰ä»èŠ‚ç‚¹æ—¶åˆ›å»ºï¼Œå…¶ä½œç”¨æ˜¯<strong>å¤‡ä»½ä¸»èŠ‚ç‚¹æœ€è¿‘å‘é€ç»™ä»èŠ‚ç‚¹çš„æ•°æ®</strong>ã€‚æ³¨æ„ï¼Œ<strong>æ— è®ºä¸»èŠ‚ç‚¹æœ‰ä¸€ä¸ªè¿˜æ˜¯å¤šä¸ªä»èŠ‚ç‚¹ï¼Œéƒ½åªéœ€è¦ä¸€ä¸ªå¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€‚</strong></p><p>åœ¨å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä¸»èŠ‚ç‚¹é™¤äº†å°†å†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œè¿˜ä¼šå‘é€ä¸€ä»½ç»™å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œä½œä¸ºå†™å‘½ä»¤çš„å¤‡ä»½ï¼›é™¤äº†å­˜å‚¨å†™å‘½ä»¤ï¼Œå¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸­è¿˜å­˜å‚¨äº†å…¶ä¸­çš„æ¯ä¸ªå­—èŠ‚å¯¹åº”çš„å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰ã€‚ç”±äºå¤åˆ¶ç§¯å‹ç¼“å†²åŒºå®šé•¿ä¸”æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œæ‰€ä»¥å®ƒä¿å­˜çš„æ˜¯ä¸»èŠ‚ç‚¹æœ€è¿‘æ‰§è¡Œçš„å†™å‘½ä»¤ï¼›æ—¶é—´è¾ƒæ—©çš„å†™å‘½ä»¤ä¼šè¢«æŒ¤å‡ºç¼“å†²åŒºã€‚</p><p>ç”±äºè¯¥ç¼“å†²åŒºé•¿åº¦å›ºå®šä¸”æœ‰é™ï¼Œå› æ­¤å¯ä»¥å¤‡ä»½çš„å†™å‘½ä»¤ä¹Ÿæœ‰é™ï¼Œå½“ä¸»ä»èŠ‚ç‚¹offsetçš„å·®è·è¿‡å¤§è¶…è¿‡ç¼“å†²åŒºé•¿åº¦æ—¶ï¼Œå°†æ— æ³•æ‰§è¡Œéƒ¨åˆ†å¤åˆ¶ï¼Œåªèƒ½æ‰§è¡Œå…¨é‡å¤åˆ¶ã€‚åè¿‡æ¥è¯´ï¼Œä¸ºäº†æé«˜ç½‘ç»œä¸­æ–­æ—¶éƒ¨åˆ†å¤åˆ¶æ‰§è¡Œçš„æ¦‚ç‡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å¢å¤§å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¤§å°(é€šè¿‡é…ç½®repl-backlog-size)ï¼›ä¾‹å¦‚å¦‚æœç½‘ç»œä¸­æ–­çš„å¹³å‡æ—¶é—´æ˜¯60sï¼Œè€Œä¸»èŠ‚ç‚¹å¹³å‡æ¯ç§’äº§ç”Ÿçš„å†™å‘½ä»¤(ç‰¹å®šåè®®æ ¼å¼)æ‰€å çš„å­—èŠ‚æ•°ä¸º100KBï¼Œåˆ™å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¹³å‡éœ€æ±‚ä¸º6MBï¼Œä¿é™©èµ·è§ï¼Œå¯ä»¥è®¾ç½®ä¸º12MBï¼Œæ¥ä¿è¯ç»å¤§å¤šæ•°æ–­çº¿æƒ…å†µéƒ½å¯ä»¥ä½¿ç”¨éƒ¨åˆ†å¤åˆ¶ã€‚</p><p>ä»èŠ‚ç‚¹å°†offsetå‘é€ç»™ä¸»èŠ‚ç‚¹åï¼Œä¸»èŠ‚ç‚¹æ ¹æ®offsetå’Œç¼“å†²åŒºå¤§å°å†³å®šèƒ½å¦æ‰§è¡Œéƒ¨åˆ†å¤åˆ¶ï¼š</p><ul><li>å¦‚æœoffsetåç§»é‡ä¹‹åçš„æ•°æ®ï¼Œä»ç„¶éƒ½åœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œï¼Œåˆ™æ‰§è¡Œéƒ¨åˆ†å¤åˆ¶ï¼›</li><li>å¦‚æœoffsetåç§»é‡ä¹‹åçš„æ•°æ®å·²ä¸åœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸­ï¼ˆæ•°æ®å·²è¢«æŒ¤å‡ºï¼‰ï¼Œåˆ™æ‰§è¡Œå…¨é‡å¤åˆ¶ã€‚</li></ul><h4 id="ï¼ˆ3ï¼‰æœåŠ¡å™¨è¿è¡ŒID-runid">ï¼ˆ3ï¼‰æœåŠ¡å™¨è¿è¡ŒID(runid)</h4><p>æ¯ä¸ªRedisèŠ‚ç‚¹(æ— è®ºä¸»ä»)ï¼Œåœ¨å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºID(æ¯æ¬¡å¯åŠ¨éƒ½ä¸ä¸€æ ·)ï¼Œç”±40ä¸ªéšæœºçš„åå…­è¿›åˆ¶å­—ç¬¦ç»„æˆï¼›runidç”¨æ¥å”¯ä¸€è¯†åˆ«ä¸€ä¸ªRedisèŠ‚ç‚¹ã€‚é€šè¿‡info Serverå‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹èŠ‚ç‚¹çš„runidï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/1174710-20180628011537662-712436367.png" class="" title="img"><p>ä¸»ä»èŠ‚ç‚¹åˆæ¬¡å¤åˆ¶æ—¶ï¼Œä¸»èŠ‚ç‚¹å°†è‡ªå·±çš„runidå‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹å°†è¿™ä¸ªrunidä¿å­˜èµ·æ¥ï¼›å½“æ–­çº¿é‡è¿æ—¶ï¼Œä»èŠ‚ç‚¹ä¼šå°†è¿™ä¸ªrunidå‘é€ç»™ä¸»èŠ‚ç‚¹ï¼›ä¸»èŠ‚ç‚¹æ ¹æ®runidåˆ¤æ–­èƒ½å¦è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ï¼š</p><ul><li>å¦‚æœä»èŠ‚ç‚¹ä¿å­˜çš„runidä¸ä¸»èŠ‚ç‚¹ç°åœ¨çš„runidç›¸åŒï¼Œè¯´æ˜ä¸»ä»èŠ‚ç‚¹ä¹‹å‰åŒæ­¥è¿‡ï¼Œä¸»èŠ‚ç‚¹ä¼šç»§ç»­å°è¯•ä½¿ç”¨éƒ¨åˆ†å¤åˆ¶(åˆ°åº•èƒ½ä¸èƒ½éƒ¨åˆ†å¤åˆ¶è¿˜è¦çœ‹offsetå’Œå¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„æƒ…å†µ)ï¼›</li><li>å¦‚æœä»èŠ‚ç‚¹ä¿å­˜çš„runidä¸ä¸»èŠ‚ç‚¹ç°åœ¨çš„runidä¸åŒï¼Œè¯´æ˜ä»èŠ‚ç‚¹åœ¨æ–­çº¿å‰åŒæ­¥çš„RedisèŠ‚ç‚¹å¹¶ä¸æ˜¯å½“å‰çš„ä¸»èŠ‚ç‚¹ï¼Œåªèƒ½è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚</li></ul><p><strong>ã€ç¤ºä¾‹ã€‘</strong></p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/image-20210924155035634.png" class="" title="image-20210924155035634"><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/image-20210924155043945.png" class="" title="image-20210924155043945"><h2 id="ã€å‘½ä»¤ä¼ æ’­é˜¶æ®µã€‘å¿ƒè·³æœºåˆ¶">ã€å‘½ä»¤ä¼ æ’­é˜¶æ®µã€‘å¿ƒè·³æœºåˆ¶</h2><p>åœ¨å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œé™¤äº†å‘é€å†™å‘½ä»¤ï¼Œä¸»ä»èŠ‚ç‚¹è¿˜ç»´æŒç€å¿ƒè·³æœºåˆ¶ï¼šPINGå’ŒREPLCONF ACKã€‚å¿ƒè·³æœºåˆ¶å¯¹äº<strong>ä¸»ä»å¤åˆ¶çš„è¶…æ—¶åˆ¤æ–­ã€æ•°æ®å®‰å…¨</strong>ç­‰æœ‰ä½œç”¨ã€‚</p><h3 id="1-ä¸»-ä»ï¼šPING">1.ä¸»-&gt;ä»ï¼šPING</h3><p>æ¯éš”æŒ‡å®šçš„æ—¶é—´ï¼Œ<strong>ä¸»èŠ‚ç‚¹ä¼šå‘ä»èŠ‚ç‚¹å‘é€PINGå‘½ä»¤</strong>ï¼Œè¿™ä¸ªPINGå‘½ä»¤çš„ä½œç”¨ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®©ä»èŠ‚ç‚¹è¿›è¡Œè¶…æ—¶åˆ¤æ–­ã€‚</p><p>PINGå‘é€çš„é¢‘ç‡ç”±repl-ping-slave-periodå‚æ•°æ§åˆ¶ï¼Œå•ä½æ˜¯ç§’ï¼Œé»˜è®¤å€¼æ˜¯10sã€‚</p><p>å…³äºè¯¥PINGå‘½ä»¤ç©¶ç«Ÿæ˜¯ç”±ä¸»èŠ‚ç‚¹å‘ç»™ä»èŠ‚ç‚¹ï¼Œè¿˜æ˜¯ç›¸åï¼Œæœ‰ä¸€äº›äº‰è®®ï¼›å› ä¸ºåœ¨Redisçš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¯¹è¯¥å‚æ•°çš„æ³¨é‡Šä¸­è¯´æ˜æ˜¯ä»èŠ‚ç‚¹å‘ä¸»èŠ‚ç‚¹å‘é€PINGå‘½ä»¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/1174710-20180628011653835-25800141.png" class="" title="img"><p>ä½†æ˜¯æ ¹æ®è¯¥å‚æ•°çš„åç§°(å«æœ‰ping-slave)ï¼Œä»¥åŠä»£ç å®ç°ï¼Œæˆ‘è®¤ä¸ºè¯¥PINGå‘½ä»¤æ˜¯ä¸»èŠ‚ç‚¹å‘ç»™ä»èŠ‚ç‚¹çš„ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/1174710-20180628011700171-401488218.png" class="" title="img"><h3 id="2-ä»-ä¸»ï¼šREPLCONF-ACK">2. ä»-&gt;ä¸»ï¼šREPLCONF ACK</h3><p>åœ¨å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œ**ä»èŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹å‘é€REPLCONF ACKå‘½ä»¤ï¼Œ**é¢‘ç‡æ˜¯æ¯ç§’1æ¬¡ï¼›å‘½ä»¤æ ¼å¼ä¸ºï¼šREPLCONF ACK {offset}ï¼Œå…¶ä¸­offsetæŒ‡ä»èŠ‚ç‚¹ä¿å­˜çš„å¤åˆ¶åç§»é‡ã€‚REPLCONF ACKå‘½ä»¤çš„ä½œç”¨åŒ…æ‹¬ï¼š</p><p>ï¼ˆ1ï¼‰å®æ—¶ç›‘æµ‹ä¸»ä»èŠ‚ç‚¹ç½‘ç»œçŠ¶æ€ï¼šè¯¥å‘½ä»¤ä¼šè¢«ä¸»èŠ‚ç‚¹ç”¨äºå¤åˆ¶è¶…æ—¶çš„åˆ¤æ–­ã€‚æ­¤å¤–ï¼Œåœ¨ä¸»èŠ‚ç‚¹ä¸­ä½¿ç”¨info Replicationï¼Œå¯ä»¥çœ‹åˆ°å…¶ä»èŠ‚ç‚¹çš„çŠ¶æ€ä¸­çš„lagå€¼ï¼Œä»£è¡¨çš„æ˜¯ä¸»èŠ‚ç‚¹ä¸Šæ¬¡æ”¶åˆ°è¯¥REPLCONF ACKå‘½ä»¤çš„æ—¶é—´é—´éš”ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯¥å€¼åº”è¯¥æ˜¯0æˆ–1ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/1174710-20180628011708219-1385546367.png" class="" title="img"><p>ï¼ˆ2ï¼‰æ£€æµ‹å‘½ä»¤ä¸¢å¤±ï¼šä»èŠ‚ç‚¹å‘é€äº†è‡ªèº«çš„offsetï¼Œä¸»èŠ‚ç‚¹ä¼šä¸è‡ªå·±çš„offsetå¯¹æ¯”ï¼Œå¦‚æœä»èŠ‚ç‚¹æ•°æ®ç¼ºå¤±ï¼ˆå¦‚ç½‘ç»œä¸¢åŒ…ï¼‰ï¼Œä¸»èŠ‚ç‚¹ä¼šæ¨é€ç¼ºå¤±çš„æ•°æ®ï¼ˆè¿™é‡Œä¹Ÿä¼šåˆ©ç”¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼‰ã€‚<strong>æ³¨æ„ï¼Œoffsetå’Œå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œä¸ä»…å¯ä»¥ç”¨äºéƒ¨åˆ†å¤åˆ¶ï¼Œä¹Ÿå¯ä»¥ç”¨äºå¤„ç†å‘½ä»¤ä¸¢å¤±ç­‰æƒ…å½¢ï¼›åŒºåˆ«åœ¨äºå‰è€…æ˜¯åœ¨æ–­çº¿é‡è¿åè¿›è¡Œçš„ï¼Œè€Œåè€…æ˜¯åœ¨ä¸»ä»èŠ‚ç‚¹æ²¡æœ‰æ–­çº¿çš„æƒ…å†µä¸‹è¿›è¡Œçš„ã€‚</strong></p><p>ï¼ˆ3ï¼‰è¾…åŠ©ä¿è¯ä»èŠ‚ç‚¹çš„æ•°é‡å’Œå»¶è¿Ÿï¼šRedisä¸»èŠ‚ç‚¹ä¸­ä½¿ç”¨min-slaves-to-writeå’Œmin-slaves-max-lagå‚æ•°ï¼Œæ¥ä¿è¯ä¸»èŠ‚ç‚¹åœ¨ä¸å®‰å…¨çš„æƒ…å†µä¸‹ä¸ä¼šæ‰§è¡Œå†™å‘½ä»¤ï¼›æ‰€è°“ä¸å®‰å…¨ï¼Œæ˜¯æŒ‡ä»èŠ‚ç‚¹æ•°é‡å¤ªå°‘ï¼Œæˆ–å»¶è¿Ÿè¿‡é«˜ã€‚ä¾‹å¦‚min-slaves-to-writeå’Œmin-slaves-max-lagåˆ†åˆ«æ˜¯3å’Œ10ï¼Œå«ä¹‰æ˜¯å¦‚æœä»èŠ‚ç‚¹æ•°é‡å°äº3ä¸ªï¼Œæˆ–æ‰€æœ‰ä»èŠ‚ç‚¹çš„å»¶è¿Ÿå€¼éƒ½å¤§äº10sï¼Œåˆ™ä¸»èŠ‚ç‚¹æ‹’ç»æ‰§è¡Œå†™å‘½ä»¤ã€‚è€Œè¿™é‡Œä»èŠ‚ç‚¹å»¶è¿Ÿå€¼çš„è·å–ï¼Œå°±æ˜¯é€šè¿‡ä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°REPLCONF ACKå‘½ä»¤çš„æ—¶é—´æ¥åˆ¤æ–­çš„ï¼Œå³å‰é¢æ‰€è¯´çš„info Replicationä¸­çš„lagå€¼ã€‚</p><h2 id="ã€éƒ¨åˆ†äº‹æ•…åœºæ™¯ã€‘">ã€éƒ¨åˆ†äº‹æ•…åœºæ™¯ã€‘</h2><h3 id="1-å¤åˆ¶è¶…æ—¶é—®é¢˜">1.å¤åˆ¶è¶…æ—¶é—®é¢˜</h3><p>ï¼ˆ1ï¼‰æ•°æ®åŒæ­¥é˜¶æ®µï¼šåœ¨ä¸»ä»èŠ‚ç‚¹è¿›è¡Œå…¨é‡å¤åˆ¶bgsaveæ—¶ï¼Œä¸»èŠ‚ç‚¹éœ€è¦é¦–å…ˆforkå­è¿›ç¨‹å°†å½“å‰æ•°æ®ä¿å­˜åˆ°RDBæ–‡ä»¶ä¸­ï¼Œç„¶åå†å°†RDBæ–‡ä»¶é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°ä»èŠ‚ç‚¹ã€‚å¦‚æœRDBæ–‡ä»¶è¿‡å¤§ï¼Œä¸»èŠ‚ç‚¹åœ¨forkå­è¿›ç¨‹+ä¿å­˜RDBæ–‡ä»¶æ—¶è€—æ—¶è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»èŠ‚ç‚¹é•¿æ—¶é—´æ”¶ä¸åˆ°æ•°æ®è€Œè§¦å‘è¶…æ—¶ï¼›æ­¤æ—¶ä»èŠ‚ç‚¹ä¼šé‡è¿ä¸»èŠ‚ç‚¹ï¼Œç„¶åå†æ¬¡å…¨é‡å¤åˆ¶ï¼Œå†æ¬¡è¶…æ—¶ï¼Œå†æ¬¡é‡è¿â€¦â€¦è¿™æ˜¯ä¸ªæ‚²ä¼¤çš„å¾ªç¯ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œé™¤äº†æ³¨æ„Rediså•æœºæ•°æ®é‡ä¸è¦è¿‡å¤§ï¼Œå¦ä¸€æ–¹é¢å°±æ˜¯é€‚å½“å¢å¤§repl-timeoutå€¼ï¼Œå…·ä½“çš„å¤§å°å¯ä»¥æ ¹æ®bgsaveè€—æ—¶æ¥è°ƒæ•´ã€‚</p><p>ï¼ˆ2ï¼‰å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼šå¦‚å‰æ‰€è¿°ï¼Œåœ¨è¯¥é˜¶æ®µä¸»èŠ‚ç‚¹ä¼šå‘ä»èŠ‚ç‚¹å‘é€PINGå‘½ä»¤ï¼Œé¢‘ç‡ç”±repl-ping-slave-periodæ§åˆ¶ï¼›è¯¥å‚æ•°åº”æ˜æ˜¾å°äºrepl-timeoutå€¼(åè€…è‡³å°‘æ˜¯å‰è€…çš„å‡ å€)ã€‚å¦åˆ™ï¼Œå¦‚æœä¸¤ä¸ªå‚æ•°ç›¸ç­‰æˆ–æ¥è¿‘ï¼Œç½‘ç»œæŠ–åŠ¨å¯¼è‡´ä¸ªåˆ«PINGå‘½ä»¤ä¸¢å¤±ï¼Œæ­¤æ—¶æ°å·§ä¸»èŠ‚ç‚¹ä¹Ÿæ²¡æœ‰å‘ä»èŠ‚ç‚¹å‘é€æ•°æ®ï¼Œåˆ™ä»èŠ‚ç‚¹å¾ˆå®¹æ˜“åˆ¤æ–­è¶…æ—¶ã€‚</p><p>ï¼ˆ3ï¼‰æ…¢æŸ¥è¯¢å¯¼è‡´çš„é˜»å¡ï¼šå¦‚æœä¸»èŠ‚ç‚¹æˆ–ä»èŠ‚ç‚¹æ‰§è¡Œäº†ä¸€äº›æ…¢æŸ¥è¯¢ï¼ˆå¦‚keys *æˆ–è€…å¯¹å¤§æ•°æ®çš„hgetallç­‰ï¼‰ï¼Œå¯¼è‡´æœåŠ¡å™¨é˜»å¡ï¼›é˜»å¡æœŸé—´æ— æ³•å“åº”å¤åˆ¶è¿æ¥ä¸­å¯¹æ–¹èŠ‚ç‚¹çš„è¯·æ±‚ï¼Œå¯èƒ½å¯¼è‡´å¤åˆ¶è¶…æ—¶ã€‚</p><h3 id="2-å¤åˆ¶ç¼“å†²åŒºæº¢å‡ºé—®é¢˜">2.å¤åˆ¶ç¼“å†²åŒºæº¢å‡ºé—®é¢˜</h3><p>ä¸»ä»èŠ‚ç‚¹è¶…æ—¶æ˜¯å¤åˆ¶ä¸­æ–­çš„åŸå› ä¹‹ä¸€ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–æƒ…å†µå¯èƒ½å¯¼è‡´å¤åˆ¶ä¸­æ–­ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ˜¯å¤åˆ¶ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ã€‚</p><p>å‰é¢æ›¾æåˆ°è¿‡ï¼Œåœ¨å…¨é‡å¤åˆ¶é˜¶æ®µï¼Œä¸»èŠ‚ç‚¹ä¼šå°†æ‰§è¡Œçš„å†™å‘½ä»¤æ”¾åˆ°å¤åˆ¶ç¼“å†²åŒºä¸­ï¼Œè¯¥ç¼“å†²åŒºå­˜æ”¾çš„æ•°æ®åŒ…æ‹¬äº†ä»¥ä¸‹å‡ ä¸ªæ—¶é—´æ®µå†…ä¸»èŠ‚ç‚¹æ‰§è¡Œçš„å†™å‘½ä»¤ï¼šbgsaveç”ŸæˆRDBæ–‡ä»¶ã€RDBæ–‡ä»¶ç”±ä¸»èŠ‚ç‚¹å‘å¾€ä»èŠ‚ç‚¹ã€ä»èŠ‚ç‚¹æ¸…ç©ºè€æ•°æ®å¹¶è½½å…¥RDBæ–‡ä»¶ä¸­çš„æ•°æ®ã€‚å½“ä¸»èŠ‚ç‚¹æ•°æ®é‡è¾ƒå¤§ï¼Œæˆ–è€…ä¸»ä»èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå»¶è¿Ÿè¾ƒå¤§æ—¶ï¼Œå¯èƒ½å¯¼è‡´è¯¥ç¼“å†²åŒºçš„å¤§å°è¶…è¿‡äº†é™åˆ¶ï¼Œæ­¤æ—¶ä¸»èŠ‚ç‚¹ä¼šæ–­å¼€ä¸ä»èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ï¼›è¿™ç§æƒ…å†µå¯èƒ½å¼•èµ·å…¨é‡å¤åˆ¶-&gt;å¤åˆ¶ç¼“å†²åŒºæº¢å‡ºå¯¼è‡´è¿æ¥ä¸­æ–­-&gt;é‡è¿-&gt;å…¨é‡å¤åˆ¶-&gt;å¤åˆ¶ç¼“å†²åŒºæº¢å‡ºå¯¼è‡´è¿æ¥ä¸­æ–­â€¦â€¦çš„å¾ªç¯ã€‚</p><p>å¤åˆ¶ç¼“å†²åŒºçš„å¤§å°ç”±client-output-buffer-limit slave {hard limit} {soft limit} {soft seconds}é…ç½®ï¼Œé»˜è®¤å€¼ä¸ºclient-output-buffer-limit slave 256MB 64MB 60ï¼Œå…¶å«ä¹‰æ˜¯ï¼šå¦‚æœbufferå¤§äº256MBï¼Œæˆ–è€…è¿ç»­60så¤§äº64MBï¼Œåˆ™ä¸»èŠ‚ç‚¹ä¼šæ–­å¼€ä¸è¯¥ä»èŠ‚ç‚¹çš„è¿æ¥ã€‚è¯¥å‚æ•°æ˜¯å¯ä»¥é€šè¿‡config setå‘½ä»¤åŠ¨æ€é…ç½®çš„ï¼ˆå³ä¸é‡å¯Redisä¹Ÿå¯ä»¥ç”Ÿæ•ˆï¼‰ã€‚</p><p>å½“å¤åˆ¶ç¼“å†²åŒºæº¢å‡ºæ—¶ï¼Œä¸»èŠ‚ç‚¹æ‰“å°æ—¥å¿—å¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/1174710-20180628012000540-1190099498.png" class="" title="img"><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤åˆ¶ç¼“å†²åŒºæ˜¯å®¢æˆ·ç«¯è¾“å‡ºç¼“å†²åŒºçš„ä¸€ç§ï¼Œä¸»èŠ‚ç‚¹ä¼šä¸ºæ¯ä¸€ä¸ªä»èŠ‚ç‚¹åˆ†åˆ«åˆ†é…å¤åˆ¶ç¼“å†²åŒºï¼›è€Œå¤åˆ¶ç§¯å‹ç¼“å†²åŒºåˆ™æ˜¯ä¸€ä¸ªä¸»èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªï¼Œæ— è®ºå®ƒæœ‰å¤šå°‘ä¸ªä»èŠ‚ç‚¹ã€‚</strong></p><h3 id="3-ç¬¬ä¸€æ¬¡å»ºç«‹å¤åˆ¶é€‰æ‹©">3.ç¬¬ä¸€æ¬¡å»ºç«‹å¤åˆ¶é€‰æ‹©</h3><p>æ­¤æ—¶å…¨é‡å¤åˆ¶ä¸å¯é¿å…ï¼Œä½†ä»æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼šå¦‚æœä¸»èŠ‚ç‚¹çš„æ•°æ®é‡è¾ƒå¤§ï¼Œåº”è¯¥å°½é‡é¿å¼€æµé‡çš„é«˜å³°æœŸï¼Œé¿å…é€ æˆé˜»å¡ï¼›å¦‚æœæœ‰å¤šä¸ªä»èŠ‚ç‚¹éœ€è¦å»ºç«‹å¯¹ä¸»èŠ‚ç‚¹çš„å¤åˆ¶ï¼Œå¯ä»¥è€ƒè™‘å°†å‡ ä¸ªä»èŠ‚ç‚¹é”™å¼€ï¼Œé¿å…ä¸»èŠ‚ç‚¹å¸¦å®½å ç”¨è¿‡å¤§ã€‚æ­¤å¤–ï¼Œå¦‚æœä»èŠ‚ç‚¹è¿‡å¤šï¼Œä¹Ÿå¯ä»¥è°ƒæ•´ä¸»ä»å¤åˆ¶çš„æ‹“æ‰‘ç»“æ„ï¼Œç”±ä¸€ä¸»å¤šä»ç»“æ„å˜ä¸ºæ ‘çŠ¶ç»“æ„ï¼ˆä¸­é—´çš„èŠ‚ç‚¹æ—¢æ˜¯å…¶ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼Œä¹Ÿæ˜¯å…¶ä»èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹ï¼‰ï¼›ä½†ä½¿ç”¨æ ‘çŠ¶ç»“æ„åº”è¯¥è°¨æ…ï¼šè™½ç„¶ä¸»èŠ‚ç‚¹çš„ç›´æ¥ä»èŠ‚ç‚¹å‡å°‘ï¼Œé™ä½äº†ä¸»èŠ‚ç‚¹çš„è´Ÿæ‹…ï¼Œä½†æ˜¯å¤šå±‚ä»èŠ‚ç‚¹çš„å»¶è¿Ÿå¢å¤§ï¼Œæ•°æ®ä¸€è‡´æ€§å˜å·®ï¼›ä¸”ç»“æ„å¤æ‚ï¼Œç»´æŠ¤ç›¸å½“å›°éš¾ã€‚</p><h3 id="4-ä¸»èŠ‚ç‚¹é‡å¯">4.ä¸»èŠ‚ç‚¹é‡å¯</h3><p>ä¸»èŠ‚ç‚¹é‡å¯å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µæ¥è®¨è®ºï¼Œä¸€ç§æ˜¯æ•…éšœå¯¼è‡´å®•æœºï¼Œå¦ä¸€ç§åˆ™æ˜¯æœ‰è®¡åˆ’çš„é‡å¯ã€‚</p><p><strong>ä¸»èŠ‚ç‚¹å®•æœº</strong></p><p>ä¸»èŠ‚ç‚¹å®•æœºé‡å¯åï¼Œrunidä¼šå‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤ä¸èƒ½è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ï¼Œåªèƒ½å…¨é‡å¤åˆ¶ã€‚</p><p>å®é™…ä¸Šåœ¨ä¸»èŠ‚ç‚¹å®•æœºçš„æƒ…å†µä¸‹ï¼Œåº”è¿›è¡Œæ•…éšœè½¬ç§»å¤„ç†ï¼Œå°†å…¶ä¸­çš„ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–ä»èŠ‚ç‚¹ä»æ–°çš„ä¸»èŠ‚ç‚¹è¿›è¡Œå¤åˆ¶ï¼›ä¸”æ•…éšœè½¬ç§»åº”å°½é‡çš„è‡ªåŠ¨åŒ–ï¼Œåé¢æ–‡ç« å°†è¦ä»‹ç»çš„å“¨å…µä¾¿å¯ä»¥è¿›è¡Œè‡ªåŠ¨çš„æ•…éšœè½¬ç§»ã€‚</p><p><strong>å®‰å…¨é‡å¯ï¼šdebug reload</strong></p><p>åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œå¯èƒ½å¸Œæœ›å¯¹ä¸»èŠ‚ç‚¹è¿›è¡Œé‡å¯ï¼Œä¾‹å¦‚ä¸»èŠ‚ç‚¹å†…å­˜ç¢ç‰‡ç‡è¿‡é«˜ï¼Œæˆ–è€…å¸Œæœ›è°ƒæ•´ä¸€äº›åªèƒ½åœ¨å¯åŠ¨æ—¶è°ƒæ•´çš„å‚æ•°ã€‚å¦‚æœä½¿ç”¨æ™®é€šçš„æ‰‹æ®µé‡å¯ä¸»èŠ‚ç‚¹ï¼Œä¼šä½¿å¾—runidå‘ç”Ÿå˜åŒ–ï¼Œå¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„å…¨é‡å¤åˆ¶ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedisæä¾›äº†debug reloadçš„é‡å¯æ–¹å¼ï¼š<strong>é‡å¯åï¼Œä¸»èŠ‚ç‚¹çš„runidå’Œoffsetéƒ½ä¸å—å½±å“ï¼Œé¿å…äº†å…¨é‡å¤åˆ¶</strong>ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/1174710-20180628012018427-1532559550.png" class="" title="img"><p>ä½†debug reloadæ˜¯ä¸€æŸ„åŒåˆƒå‰‘ï¼š<strong>å®ƒä¼šæ¸…ç©ºå½“å‰å†…å­˜ä¸­çš„æ•°æ®ï¼Œé‡æ–°ä»RDBæ–‡ä»¶ä¸­åŠ è½½</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå¯¼è‡´ä¸»èŠ‚ç‚¹çš„é˜»å¡ï¼Œå› æ­¤ä¹Ÿéœ€è¦è°¨æ…ã€‚</p><h3 id="5-ç½‘ç»œä¸­æ–­">5.ç½‘ç»œä¸­æ–­</h3><p>å¦‚æœä¸»ä»èŠ‚ç‚¹ä¹‹é—´å‡ºç°ç½‘ç»œé—®é¢˜ï¼Œé€ æˆçŸ­æ—¶é—´å†…ç½‘ç»œä¸­æ–­ï¼Œå¯ä»¥åˆ†ä¸ºå¤šç§æƒ…å†µè®¨è®ºã€‚</p><p>ç¬¬ä¸€ç§æƒ…å†µï¼šç½‘ç»œé—®é¢˜æ—¶é—´æä¸ºçŸ­æš‚ï¼Œåªé€ æˆäº†çŸ­æš‚çš„ä¸¢åŒ…ï¼Œä¸»ä»èŠ‚ç‚¹éƒ½æ²¡æœ‰åˆ¤å®šè¶…æ—¶ï¼ˆæœªè§¦å‘repl-timeoutï¼‰ï¼›æ­¤æ—¶åªéœ€è¦é€šè¿‡REPLCONF ACKæ¥è¡¥å……ä¸¢å¤±çš„æ•°æ®å³å¯ã€‚</p><p>ç¬¬äºŒç§æƒ…å†µï¼šç½‘ç»œé—®é¢˜æ—¶é—´å¾ˆé•¿ï¼Œä¸»ä»èŠ‚ç‚¹åˆ¤æ–­è¶…æ—¶ï¼ˆè§¦å‘äº†repl-timeoutï¼‰ï¼Œä¸”ä¸¢å¤±çš„æ•°æ®è¿‡å¤šï¼Œè¶…è¿‡äº†å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ‰€èƒ½å­˜å‚¨çš„èŒƒå›´ï¼›æ­¤æ—¶ä¸»ä»èŠ‚ç‚¹æ— æ³•è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ï¼Œåªèƒ½è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚ä¸ºäº†å°½å¯èƒ½é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œåº”è¯¥æ ¹æ®å®é™…æƒ…å†µé€‚å½“è°ƒæ•´å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¤§å°ï¼›æ­¤å¤–åŠæ—¶å‘ç°å¹¶ä¿®å¤ç½‘ç»œä¸­æ–­ï¼Œä¹Ÿå¯ä»¥å‡å°‘å…¨é‡å¤åˆ¶ã€‚</p><p>ç¬¬ä¸‰ç§æƒ…å†µï¼šä»‹äºå‰è¿°ä¸¤ç§æƒ…å†µä¹‹é—´ï¼Œä¸»ä»èŠ‚ç‚¹åˆ¤æ–­è¶…æ—¶ï¼Œä¸”ä¸¢å¤±çš„æ•°æ®ä»ç„¶éƒ½åœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸­ï¼›æ­¤æ—¶ä¸»ä»èŠ‚ç‚¹å¯ä»¥è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ã€‚</p><h3 id="6-å•æœºå†…å­˜å¤§å°çš„é™åˆ¶">6.å•æœºå†…å­˜å¤§å°çš„é™åˆ¶</h3><p>forkæ“ä½œå¯¹Rediså•æœºå†…å­˜å¤§å°çš„é™åˆ¶ã€‚å®é™…ä¸Šåœ¨Redisçš„ä½¿ç”¨ä¸­ï¼Œé™åˆ¶å•æœºå†…å­˜å¤§å°çš„å› ç´ éå¸¸ä¹‹å¤šï¼Œä¸‹é¢æ€»ç»“ä¸€ä¸‹åœ¨ä¸»ä»å¤åˆ¶ä¸­ï¼Œå•æœºå†…å­˜è¿‡å¤§å¯èƒ½é€ æˆçš„å½±å“ï¼š</p><p>ï¼ˆ1ï¼‰åˆ‡ä¸»ï¼šå½“ä¸»èŠ‚ç‚¹å®•æœºæ—¶ï¼Œä¸€ç§å¸¸è§çš„å®¹ç¾ç­–ç•¥æ˜¯å°†å…¶ä¸­ä¸€ä¸ªä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶ä»–ä»èŠ‚ç‚¹æŒ‚è½½åˆ°æ–°çš„ä¸»èŠ‚ç‚¹ä¸Šï¼Œæ­¤æ—¶è¿™äº›ä»èŠ‚ç‚¹åªèƒ½è¿›è¡Œå…¨é‡å¤åˆ¶ï¼›å¦‚æœRediså•æœºå†…å­˜è¾¾åˆ°10GBï¼Œä¸€ä¸ªä»èŠ‚ç‚¹çš„åŒæ­¥æ—¶é—´åœ¨å‡ åˆ†é’Ÿçš„çº§åˆ«ï¼›å¦‚æœä»èŠ‚ç‚¹è¾ƒå¤šï¼Œæ¢å¤çš„é€Ÿåº¦ä¼šæ›´æ…¢ã€‚å¦‚æœç³»ç»Ÿçš„è¯»è´Ÿè½½å¾ˆé«˜ï¼Œè€Œè¿™æ®µæ—¶é—´ä»èŠ‚ç‚¹æ— æ³•æä¾›æœåŠ¡ï¼Œä¼šå¯¹ç³»ç»Ÿé€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚</p><p>ï¼ˆ2ï¼‰ä»åº“æ‰©å®¹ï¼šå¦‚æœè®¿é—®é‡çªç„¶å¢å¤§ï¼Œæ­¤æ—¶å¸Œæœ›å¢åŠ ä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¦‚æœæ•°æ®é‡è¿‡å¤§ï¼Œä»èŠ‚ç‚¹åŒæ­¥å¤ªæ…¢ï¼Œéš¾ä»¥åŠæ—¶åº”å¯¹è®¿é—®é‡çš„æš´å¢ã€‚</p><p>ï¼ˆ3ï¼‰ç¼“å†²åŒºæº¢å‡ºï¼šï¼ˆ1ï¼‰å’Œï¼ˆ2ï¼‰éƒ½æ˜¯ä»èŠ‚ç‚¹å¯ä»¥æ­£å¸¸åŒæ­¥çš„æƒ…å½¢ï¼ˆè™½ç„¶æ…¢ï¼‰ï¼Œä½†æ˜¯å¦‚æœæ•°æ®é‡è¿‡å¤§ï¼Œå¯¼è‡´å…¨é‡å¤åˆ¶é˜¶æ®µä¸»èŠ‚ç‚¹çš„å¤åˆ¶ç¼“å†²åŒºæº¢å‡ºï¼Œä»è€Œå¯¼è‡´å¤åˆ¶ä¸­æ–­ï¼Œåˆ™ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®åŒæ­¥ä¼šå…¨é‡å¤åˆ¶-&gt;å¤åˆ¶ç¼“å†²åŒºæº¢å‡ºå¯¼è‡´å¤åˆ¶ä¸­æ–­-&gt;é‡è¿-&gt;å…¨é‡å¤åˆ¶-&gt;å¤åˆ¶ç¼“å†²åŒºæº¢å‡ºå¯¼è‡´å¤åˆ¶ä¸­æ–­â€¦â€¦çš„å¾ªç¯ã€‚</p><p>ï¼ˆ4ï¼‰è¶…æ—¶ï¼šå¦‚æœæ•°æ®é‡è¿‡å¤§ï¼Œå…¨é‡å¤åˆ¶é˜¶æ®µä¸»èŠ‚ç‚¹fork+ä¿å­˜RDBæ–‡ä»¶è€—æ—¶è¿‡å¤§ï¼Œä»èŠ‚ç‚¹é•¿æ—¶é—´æ¥æ”¶ä¸åˆ°æ•°æ®è§¦å‘è¶…æ—¶ï¼Œä¸»ä»èŠ‚ç‚¹çš„æ•°æ®åŒæ­¥åŒæ ·å¯èƒ½é™·å…¥å…¨é‡å¤åˆ¶-&gt;è¶…æ—¶å¯¼è‡´å¤åˆ¶ä¸­æ–­-&gt;é‡è¿-&gt;å…¨é‡å¤åˆ¶-&gt;è¶…æ—¶å¯¼è‡´å¤åˆ¶ä¸­æ–­â€¦â€¦çš„å¾ªç¯ã€‚</p><p>æ­¤å¤–ï¼Œä¸»èŠ‚ç‚¹å•æœºå†…å­˜é™¤äº†ç»å¯¹é‡ä¸èƒ½å¤ªå¤§ï¼Œå…¶å ç”¨ä¸»æœºå†…å­˜çš„æ¯”ä¾‹ä¹Ÿä¸åº”è¿‡å¤§ï¼šæœ€å¥½åªä½¿ç”¨50%-65%çš„å†…å­˜ï¼Œç•™ä¸‹30%-45%çš„å†…å­˜ç”¨äºæ‰§è¡Œbgsaveå‘½ä»¤å’Œåˆ›å»ºå¤åˆ¶ç¼“å†²åŒºç­‰ã€‚</p><h2 id="ã€æ€»ç»“ã€‘">ã€æ€»ç»“ã€‘</h2><p>1ã€ä¸»ä»å¤åˆ¶çš„ä½œç”¨ï¼šå®è§‚çš„äº†è§£ä¸»ä»å¤åˆ¶æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œå³æ•°æ®å†—ä½™ã€æ•…éšœæ¢å¤ã€è¯»è´Ÿè½½å‡è¡¡ç­‰ã€‚</p><p>2ã€ä¸»ä»å¤åˆ¶çš„æ“ä½œï¼šå³slaveofå‘½ä»¤ã€‚</p><p>3ã€ä¸»ä»å¤åˆ¶çš„åŸç†ï¼šä¸»ä»å¤åˆ¶åŒ…æ‹¬äº†è¿æ¥å»ºç«‹é˜¶æ®µã€æ•°æ®åŒæ­¥é˜¶æ®µã€å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼›å…¶ä¸­æ•°æ®åŒæ­¥é˜¶æ®µï¼Œæœ‰å…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶ä¸¤ç§æ•°æ®åŒæ­¥æ–¹å¼ï¼›å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä¸»ä»èŠ‚ç‚¹ä¹‹é—´æœ‰PINGå’ŒREPLCONF ACKå‘½ä»¤äº’ç›¸è¿›è¡Œå¿ƒè·³æ£€æµ‹ã€‚</p><p>4ã€åº”ç”¨ä¸­çš„é—®é¢˜ï¼šåŒ…æ‹¬è¯»å†™åˆ†ç¦»çš„é—®é¢˜ï¼ˆæ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€æ•°æ®è¿‡æœŸé—®é¢˜ã€æ•…éšœåˆ‡æ¢é—®é¢˜ç­‰ï¼‰ã€å¤åˆ¶è¶…æ—¶é—®é¢˜ã€å¤åˆ¶ä¸­æ–­é—®é¢˜ç­‰ï¼Œç„¶åæ€»ç»“äº†ä¸»ä»å¤åˆ¶ç›¸å…³çš„é…ç½®ï¼Œå…¶ä¸­repl-timeoutã€client-output-buffer-limit slaveç­‰å¯¹è§£å†³Redisä¸»ä»å¤åˆ¶ä¸­å‡ºç°çš„é—®é¢˜å¯èƒ½ä¼šæœ‰å¸®åŠ©ã€‚</p><p>ä¸»ä»å¤åˆ¶è™½ç„¶è§£å†³æˆ–ç¼“è§£äº†æ•°æ®å†—ä½™ã€æ•…éšœæ¢å¤ã€è¯»è´Ÿè½½å‡è¡¡ç­‰é—®é¢˜ï¼Œä½†å…¶ç¼ºé™·ä»å¾ˆæ˜æ˜¾ï¼šæ•…éšœæ¢å¤æ— æ³•è‡ªåŠ¨åŒ–ï¼›å†™æ“ä½œæ— æ³•è´Ÿè½½å‡è¡¡ï¼›å­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ï¼›è¿™äº›é—®é¢˜çš„è§£å†³ï¼Œéœ€è¦å“¨å…µå’Œé›†ç¾¤çš„å¸®åŠ©</p><h1>2.Rediså“¨å…µ</h1><h2 id="ã€æ¦‚å¿µã€‘">ã€æ¦‚å¿µã€‘</h2><p>Redis Sentinelï¼Œå³Rediså“¨å…µï¼Œåœ¨Redis 2.8ç‰ˆæœ¬å¼€å§‹å¼•å…¥ã€‚**å“¨å…µçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸»èŠ‚ç‚¹çš„è‡ªåŠ¨æ•…éšœè½¬ç§»ã€‚**ä¸‹é¢æ˜¯Rediså®˜æ–¹æ–‡æ¡£å¯¹äºå“¨å…µåŠŸèƒ½çš„æè¿°ï¼š</p><ul><li>ç›‘æ§ï¼ˆMonitoringï¼‰ï¼šå“¨å…µä¼šä¸æ–­åœ°æ£€æŸ¥ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚</li><li>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆAutomatic failoverï¼‰ï¼šå½“ä¸»èŠ‚ç‚¹ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µä¼šå¼€å§‹è‡ªåŠ¨æ•…éšœè½¬ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆä¸»èŠ‚ç‚¹çš„å…¶ä¸­ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶è®©å…¶ä»–ä»èŠ‚ç‚¹æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚</li><li>é…ç½®æä¾›è€…ï¼ˆConfiguration providerï¼‰ï¼šå®¢æˆ·ç«¯åœ¨åˆå§‹åŒ–æ—¶ï¼Œé€šè¿‡è¿æ¥å“¨å…µæ¥è·å¾—å½“å‰RedisæœåŠ¡çš„ä¸»èŠ‚ç‚¹åœ°å€ã€‚</li><li>é€šçŸ¥ï¼ˆNotificationï¼‰ï¼šå“¨å…µå¯ä»¥å°†æ•…éšœè½¬ç§»çš„ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li></ul><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/1174710-20180908182924632-1069251418.png" class="" title="img"><p>å®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå“¨å…µèŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹ï¼š</p><ul><li>å“¨å…µèŠ‚ç‚¹ï¼šå“¨å…µç³»ç»Ÿç”±ä¸€ä¸ªæˆ–å¤šä¸ªå“¨å…µèŠ‚ç‚¹ç»„æˆï¼Œå“¨å…µèŠ‚ç‚¹æ˜¯ç‰¹æ®Šçš„redisèŠ‚ç‚¹ï¼Œä¸å­˜å‚¨æ•°æ®ã€‚</li><li>æ•°æ®èŠ‚ç‚¹ï¼šä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹éƒ½æ˜¯æ•°æ®èŠ‚ç‚¹ã€‚</li></ul><h2 id="ã€æ•…éšœè½¬ç§»ã€‘">ã€æ•…éšœè½¬ç§»ã€‘</h2><p><a href="https://www.cnblogs.com/kismetv/p/9609938.html">https://www.cnblogs.com/kismetv/p/9609938.html</a></p><p>å“¨å…µç³»ç»Ÿçš„æ­å»ºè¿‡ç¨‹ï¼Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p><p>ï¼ˆ1ï¼‰å“¨å…µç³»ç»Ÿä¸­çš„ä¸»ä»èŠ‚ç‚¹ï¼Œä¸æ™®é€šçš„ä¸»ä»èŠ‚ç‚¹å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæ•…éšœå‘ç°å’Œè½¬ç§»æ˜¯ç”±å“¨å…µæ¥æ§åˆ¶å’Œå®Œæˆçš„ã€‚</p><p>ï¼ˆ2ï¼‰å“¨å…µèŠ‚ç‚¹æœ¬è´¨ä¸Šæ˜¯redisèŠ‚ç‚¹ã€‚</p><p>ï¼ˆ3ï¼‰æ¯ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œåªéœ€è¦é…ç½®ç›‘æ§ä¸»èŠ‚ç‚¹ï¼Œä¾¿å¯ä»¥è‡ªåŠ¨å‘ç°å…¶ä»–çš„å“¨å…µèŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ã€‚</p><p>ï¼ˆ4ï¼‰åœ¨å“¨å…µèŠ‚ç‚¹å¯åŠ¨å’Œæ•…éšœè½¬ç§»é˜¶æ®µï¼Œå„ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¼šè¢«é‡å†™(config rewrite)ã€‚</p><p>ï¼ˆ5ï¼‰æœ¬ç« çš„ä¾‹å­ä¸­ï¼Œä¸€ä¸ªå“¨å…µåªç›‘æ§äº†ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼›å®é™…ä¸Šï¼Œä¸€ä¸ªå“¨å…µå¯ä»¥ç›‘æ§å¤šä¸ªä¸»èŠ‚ç‚¹ï¼Œé€šè¿‡é…ç½®å¤šæ¡sentinel monitorå³å¯å®ç°ã€‚</p><h2 id="ã€åŸºæœ¬åŸç†ã€‘">ã€åŸºæœ¬åŸç†ã€‘</h2><p>å…³äºå“¨å…µçš„åŸç†ï¼Œå…³é”®æ˜¯äº†è§£ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µã€‚</p><p>ï¼ˆ1ï¼‰å®šæ—¶ä»»åŠ¡ï¼šæ¯ä¸ªå“¨å…µèŠ‚ç‚¹ç»´æŠ¤äº†3ä¸ªå®šæ—¶ä»»åŠ¡ã€‚å®šæ—¶ä»»åŠ¡çš„åŠŸèƒ½åˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li>é€šè¿‡å‘ä¸»ä»èŠ‚ç‚¹å‘é€infoå‘½ä»¤è·å–æœ€æ–°çš„ä¸»ä»ç»“æ„ï¼›</li><li>é€šè¿‡å‘å¸ƒè®¢é˜…åŠŸèƒ½è·å–å…¶ä»–å“¨å…µèŠ‚ç‚¹çš„ä¿¡æ¯ï¼›</li><li>é€šè¿‡å‘å…¶ä»–èŠ‚ç‚¹å‘é€pingå‘½ä»¤è¿›è¡Œå¿ƒè·³æ£€æµ‹ï¼Œåˆ¤æ–­æ˜¯å¦ä¸‹çº¿ã€‚</li></ul><p>ï¼ˆ2ï¼‰ä¸»è§‚ä¸‹çº¿ï¼šåœ¨å¿ƒè·³æ£€æµ‹çš„å®šæ—¶ä»»åŠ¡ä¸­ï¼Œå¦‚æœå…¶ä»–èŠ‚ç‚¹è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰å›å¤ï¼Œå“¨å…µèŠ‚ç‚¹å°±ä¼šå°†å…¶è¿›è¡Œä¸»è§‚ä¸‹çº¿ã€‚é¡¾åæ€ä¹‰ï¼Œä¸»è§‚ä¸‹çº¿çš„æ„æ€æ˜¯ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹â€œä¸»è§‚åœ°â€åˆ¤æ–­ä¸‹çº¿ï¼›ä¸ä¸»è§‚ä¸‹çº¿ç›¸å¯¹åº”çš„æ˜¯å®¢è§‚ä¸‹çº¿ã€‚</p><p>ï¼ˆ3ï¼‰å®¢è§‚ä¸‹çº¿ï¼šå“¨å…µèŠ‚ç‚¹åœ¨å¯¹ä¸»èŠ‚ç‚¹è¿›è¡Œä¸»è§‚ä¸‹çº¿åï¼Œä¼šé€šè¿‡sentinel is-master-down-by-addrå‘½ä»¤è¯¢é—®å…¶ä»–å“¨å…µèŠ‚ç‚¹è¯¥ä¸»èŠ‚ç‚¹çš„çŠ¶æ€ï¼›å¦‚æœåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿çš„å“¨å…µæ•°é‡è¾¾åˆ°ä¸€å®šæ•°å€¼ï¼Œåˆ™å¯¹è¯¥ä¸»èŠ‚ç‚¹è¿›è¡Œå®¢è§‚ä¸‹çº¿ã€‚</p><p><strong>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå®¢è§‚ä¸‹çº¿æ˜¯ä¸»èŠ‚ç‚¹æ‰æœ‰çš„æ¦‚å¿µï¼›å¦‚æœä»èŠ‚ç‚¹å’Œå“¨å…µèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œè¢«å“¨å…µä¸»è§‚ä¸‹çº¿åï¼Œä¸ä¼šå†æœ‰åç»­çš„å®¢è§‚ä¸‹çº¿å’Œæ•…éšœè½¬ç§»æ“ä½œã€‚</strong></p><p>ï¼ˆ4ï¼‰é€‰ä¸¾é¢†å¯¼è€…å“¨å…µèŠ‚ç‚¹ï¼šå½“ä¸»èŠ‚ç‚¹è¢«åˆ¤æ–­å®¢è§‚ä¸‹çº¿ä»¥åï¼Œå„ä¸ªå“¨å…µèŠ‚ç‚¹ä¼šè¿›è¡Œåå•†ï¼Œé€‰ä¸¾å‡ºä¸€ä¸ªé¢†å¯¼è€…å“¨å…µèŠ‚ç‚¹ï¼Œå¹¶ç”±è¯¥é¢†å¯¼è€…èŠ‚ç‚¹å¯¹å…¶è¿›è¡Œæ•…éšœè½¬ç§»æ“ä½œã€‚</p><p>ç›‘è§†è¯¥ä¸»èŠ‚ç‚¹çš„æ‰€æœ‰å“¨å…µéƒ½æœ‰å¯èƒ½è¢«é€‰ä¸ºé¢†å¯¼è€…ï¼Œé€‰ä¸¾ä½¿ç”¨çš„ç®—æ³•æ˜¯Raftç®—æ³•ï¼›Raftç®—æ³•çš„åŸºæœ¬æ€è·¯æ˜¯å…ˆåˆ°å…ˆå¾—ï¼šå³åœ¨ä¸€è½®é€‰ä¸¾ä¸­ï¼Œå“¨å…µAå‘Bå‘é€æˆä¸ºé¢†å¯¼è€…çš„ç”³è¯·ï¼Œå¦‚æœBæ²¡æœ‰åŒæ„è¿‡å…¶ä»–å“¨å…µï¼Œåˆ™ä¼šåŒæ„Aæˆä¸ºé¢†å¯¼è€…ã€‚é€‰ä¸¾çš„å…·ä½“è¿‡ç¨‹è¿™é‡Œä¸åšè¯¦ç»†æè¿°ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå“¨å…µé€‰æ‹©çš„è¿‡ç¨‹å¾ˆå¿«ï¼Œè°å…ˆå®Œæˆå®¢è§‚ä¸‹çº¿ï¼Œä¸€èˆ¬å°±èƒ½æˆä¸ºé¢†å¯¼è€…ã€‚</p><p>ï¼ˆ5ï¼‰æ•…éšœè½¬ç§»ï¼šé€‰ä¸¾å‡ºçš„é¢†å¯¼è€…å“¨å…µï¼Œå¼€å§‹è¿›è¡Œæ•…éšœè½¬ç§»æ“ä½œï¼Œè¯¥æ“ä½œå¤§ä½“å¯ä»¥åˆ†ä¸º3ä¸ªæ­¥éª¤ï¼š</p><ul><li><p>åœ¨ä»èŠ‚ç‚¹ä¸­é€‰æ‹©æ–°çš„ä¸»èŠ‚ç‚¹ï¼šé€‰æ‹©çš„åŸåˆ™æ˜¯ï¼Œé¦–å…ˆè¿‡æ»¤æ‰ä¸å¥åº·çš„ä»èŠ‚ç‚¹ï¼›ç„¶åé€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„ä»èŠ‚ç‚¹(ç”±slave-priorityæŒ‡å®š)ï¼›å¦‚æœä¼˜å…ˆçº§æ— æ³•åŒºåˆ†ï¼Œåˆ™é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„ä»èŠ‚ç‚¹ï¼›å¦‚æœä»æ— æ³•åŒºåˆ†ï¼Œåˆ™é€‰æ‹©runidæœ€å°çš„ä»èŠ‚ç‚¹ã€‚</p></li><li><p>æ›´æ–°ä¸»ä»çŠ¶æ€ï¼šé€šè¿‡slaveof no oneå‘½ä»¤ï¼Œè®©é€‰å‡ºæ¥çš„ä»èŠ‚ç‚¹æˆä¸ºä¸»èŠ‚ç‚¹ï¼›å¹¶é€šè¿‡slaveofå‘½ä»¤è®©å…¶ä»–èŠ‚ç‚¹æˆä¸ºå…¶ä»èŠ‚ç‚¹ã€‚</p></li><li><p>å°†å·²ç»ä¸‹çº¿çš„ä¸»èŠ‚ç‚¹(å³6379)è®¾ç½®ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼Œå½“6379é‡æ–°ä¸Šçº¿åï¼Œå®ƒä¼šæˆä¸ºæ–°çš„ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/1174710-20180909004056625-1501495024.png" class="" title="img"></li></ul><h2 id="ã€å®è·µå»ºè®®ã€‘">ã€å®è·µå»ºè®®ã€‘</h2><p>1ï¼‰å“¨å…µèŠ‚ç‚¹çš„æ•°é‡åº”ä¸æ­¢ä¸€ä¸ªï¼Œä¸€æ–¹é¢å¢åŠ å“¨å…µèŠ‚ç‚¹çš„å†—ä½™ï¼Œé¿å…å“¨å…µæœ¬èº«æˆä¸ºé«˜å¯ç”¨çš„ç“¶é¢ˆï¼›å¦ä¸€æ–¹é¢å‡å°‘å¯¹ä¸‹çº¿çš„è¯¯åˆ¤ã€‚æ­¤å¤–ï¼Œè¿™äº›ä¸åŒçš„å“¨å…µèŠ‚ç‚¹åº”éƒ¨ç½²åœ¨ä¸åŒçš„ç‰©ç†æœºä¸Šã€‚</p><p>ï¼ˆ2ï¼‰å“¨å…µèŠ‚ç‚¹çš„æ•°é‡åº”è¯¥æ˜¯å¥‡æ•°ï¼Œä¾¿äºå“¨å…µé€šè¿‡æŠ•ç¥¨åšå‡ºâ€œå†³ç­–â€ï¼šé¢†å¯¼è€…é€‰ä¸¾çš„å†³ç­–ã€å®¢è§‚ä¸‹çº¿çš„å†³ç­–ç­‰ã€‚</p><p>ï¼ˆ3ï¼‰å„ä¸ªå“¨å…µèŠ‚ç‚¹çš„é…ç½®åº”ä¸€è‡´ï¼ŒåŒ…æ‹¬ç¡¬ä»¶ã€å‚æ•°ç­‰ï¼›æ­¤å¤–ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½åº”è¯¥ä½¿ç”¨ntpæˆ–ç±»ä¼¼æœåŠ¡ï¼Œä¿è¯æ—¶é—´å‡†ç¡®ã€ä¸€è‡´ã€‚</p><p>ï¼ˆ4ï¼‰å“¨å…µçš„é…ç½®æä¾›è€…å’Œé€šçŸ¥å®¢æˆ·ç«¯åŠŸèƒ½ï¼Œéœ€è¦å®¢æˆ·ç«¯çš„æ”¯æŒæ‰èƒ½å®ç°ï¼Œå¦‚å‰æ–‡æ‰€è¯´çš„Jedisï¼›å¦‚æœå¼€å‘è€…ä½¿ç”¨çš„åº“æœªæä¾›ç›¸åº”æ”¯æŒï¼Œåˆ™å¯èƒ½éœ€è¦å¼€å‘è€…è‡ªå·±å®ç°ã€‚</p><p>ï¼ˆ5ï¼‰å½“å“¨å…µç³»ç»Ÿä¸­çš„èŠ‚ç‚¹åœ¨dockerï¼ˆæˆ–å…¶ä»–å¯èƒ½è¿›è¡Œç«¯å£æ˜ å°„çš„è½¯ä»¶ï¼‰ä¸­éƒ¨ç½²æ—¶ï¼Œåº”ç‰¹åˆ«æ³¨æ„ç«¯å£æ˜ å°„å¯èƒ½ä¼šå¯¼è‡´å“¨å…µç³»ç»Ÿæ— æ³•æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºå“¨å…µçš„å·¥ä½œåŸºäºä¸å…¶ä»–èŠ‚ç‚¹çš„é€šä¿¡ï¼Œè€Œdockerçš„ç«¯å£æ˜ å°„å¯èƒ½å¯¼è‡´å“¨å…µæ— æ³•è¿æ¥åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œå“¨å…µä¹‹é—´äº’ç›¸å‘ç°ï¼Œä¾èµ–äºå®ƒä»¬å¯¹å¤–å®£ç§°çš„IPå’Œportï¼Œå¦‚æœæŸä¸ªå“¨å…µAéƒ¨ç½²åœ¨åšäº†ç«¯å£æ˜ å°„çš„dockerä¸­ï¼Œé‚£ä¹ˆå…¶ä»–å“¨å…µä½¿ç”¨Aå®£ç§°çš„portæ— æ³•è¿æ¥åˆ°Aã€‚</p><h2 id="ã€æ€»ç»“ã€‘-2">ã€æ€»ç»“ã€‘</h2><p>æœ¬æ–‡é¦–å…ˆä»‹ç»äº†å“¨å…µçš„ä½œç”¨ï¼šç›‘æ§ã€æ•…éšœè½¬ç§»ã€é…ç½®æä¾›è€…å’Œé€šçŸ¥ï¼›ç„¶åè®²è¿°äº†å“¨å…µç³»ç»Ÿçš„éƒ¨ç½²æ–¹æ³•ï¼Œä»¥åŠé€šè¿‡å®¢æˆ·ç«¯è®¿é—®å“¨å…µç³»ç»Ÿçš„æ–¹æ³•ï¼›å†ç„¶åç®€è¦è¯´æ˜äº†å“¨å…µå®ç°çš„åŸºæœ¬åŸç†ï¼›æœ€åç»™å‡ºäº†å…³äºå“¨å…µå®è·µçš„ä¸€äº›å»ºè®®ã€‚</p><p>åœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œå“¨å…µå¼•å…¥äº†ä¸»èŠ‚ç‚¹çš„è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œè¿›ä¸€æ­¥æé«˜äº†Redisçš„é«˜å¯ç”¨æ€§ï¼›ä½†æ˜¯å“¨å…µçš„ç¼ºé™·åŒæ ·å¾ˆæ˜æ˜¾ï¼šå“¨å…µæ— æ³•å¯¹ä»èŠ‚ç‚¹è¿›è¡Œè‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œåœ¨è¯»å†™åˆ†ç¦»åœºæ™¯ä¸‹ï¼Œä»èŠ‚ç‚¹æ•…éšœä¼šå¯¼è‡´è¯»æœåŠ¡ä¸å¯ç”¨ï¼Œéœ€è¦æˆ‘ä»¬å¯¹ä»èŠ‚ç‚¹åšé¢å¤–çš„ç›‘æ§ã€åˆ‡æ¢æ“ä½œã€‚</p><p>æ­¤å¤–ï¼Œå“¨å…µä»ç„¶æ²¡æœ‰è§£å†³å†™æ“ä½œæ— æ³•è´Ÿè½½å‡è¡¡ã€åŠå­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºé™åˆ¶çš„é—®é¢˜</p><h1>3.é›†ç¾¤</h1><h2 id="ã€ä½œç”¨ã€‘">ã€ä½œç”¨ã€‘</h2><p>é›†ç¾¤ï¼Œå³Redis Clusterï¼Œæ˜¯Redis 3.0å¼€å§‹å¼•å…¥çš„åˆ†å¸ƒå¼å­˜å‚¨æ–¹æ¡ˆã€‚</p><p>é›†ç¾¤ç”±å¤šä¸ªèŠ‚ç‚¹(Node)ç»„æˆï¼ŒRedisçš„æ•°æ®åˆ†å¸ƒåœ¨è¿™äº›èŠ‚ç‚¹ä¸­ã€‚é›†ç¾¤ä¸­çš„èŠ‚ç‚¹åˆ†ä¸ºä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ï¼šåªæœ‰ä¸»èŠ‚ç‚¹è´Ÿè´£è¯»å†™è¯·æ±‚å’Œé›†ç¾¤ä¿¡æ¯çš„ç»´æŠ¤ï¼›ä»èŠ‚ç‚¹åªè¿›è¡Œä¸»èŠ‚ç‚¹æ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯çš„å¤åˆ¶ã€‚</p><p>é›†ç¾¤çš„ä½œç”¨ï¼Œå¯ä»¥å½’çº³ä¸ºä¸¤ç‚¹ï¼š</p><p>1ã€æ•°æ®åˆ†åŒºï¼šæ•°æ®åˆ†åŒº(æˆ–ç§°æ•°æ®åˆ†ç‰‡)æ˜¯é›†ç¾¤æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚</p><p>é›†ç¾¤å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä¸€æ–¹é¢çªç ´äº†Rediså•æœºå†…å­˜å¤§å°çš„é™åˆ¶ï¼Œå­˜å‚¨å®¹é‡å¤§å¤§å¢åŠ ï¼›å¦ä¸€æ–¹é¢æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½å¯ä»¥å¯¹å¤–æä¾›è¯»æœåŠ¡å’Œå†™æœåŠ¡ï¼Œå¤§å¤§æé«˜äº†é›†ç¾¤çš„å“åº”èƒ½åŠ›ã€‚</p><p>Rediså•æœºå†…å­˜å¤§å°å—é™é—®é¢˜ï¼Œåœ¨ä»‹ç»æŒä¹…åŒ–å’Œä¸»ä»å¤åˆ¶æ—¶éƒ½æœ‰æåŠï¼›ä¾‹å¦‚ï¼Œå¦‚æœå•æœºå†…å­˜å¤ªå¤§ï¼Œbgsaveå’Œbgrewriteaofçš„forkæ“ä½œå¯èƒ½å¯¼è‡´ä¸»è¿›ç¨‹é˜»å¡ï¼Œä¸»ä»ç¯å¢ƒä¸‹ä¸»æœºåˆ‡æ¢æ—¶å¯èƒ½å¯¼è‡´ä»èŠ‚ç‚¹é•¿æ—¶é—´æ— æ³•æä¾›æœåŠ¡ï¼Œå…¨é‡å¤åˆ¶é˜¶æ®µä¸»èŠ‚ç‚¹çš„å¤åˆ¶ç¼“å†²åŒºå¯èƒ½æº¢å‡ºâ€¦â€¦ã€‚</p><p>2ã€é«˜å¯ç”¨ï¼šé›†ç¾¤æ”¯æŒä¸»ä»å¤åˆ¶å’Œä¸»èŠ‚ç‚¹çš„è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆä¸å“¨å…µç±»ä¼¼ï¼‰ï¼›å½“ä»»ä¸€èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œé›†ç¾¤ä»ç„¶å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><h2 id="ã€é›†ç¾¤æ–¹æ¡ˆè®¾è®¡ã€‘">ã€é›†ç¾¤æ–¹æ¡ˆè®¾è®¡ã€‘</h2><p>è®¾è®¡é›†ç¾¤æ–¹æ¡ˆæ—¶ï¼Œè‡³å°‘è¦è€ƒè™‘ä»¥ä¸‹å› ç´ ï¼š</p><p>ï¼ˆ1ï¼‰é«˜å¯ç”¨è¦æ±‚ï¼šæ ¹æ®æ•…éšœè½¬ç§»çš„åŸç†ï¼Œè‡³å°‘éœ€è¦3ä¸ªä¸»èŠ‚ç‚¹æ‰èƒ½å®Œæˆæ•…éšœè½¬ç§»ï¼Œä¸”3ä¸ªä¸»èŠ‚ç‚¹ä¸åº”åœ¨åŒä¸€å°ç‰©ç†æœºä¸Šï¼›æ¯ä¸ªä¸»èŠ‚ç‚¹è‡³å°‘éœ€è¦1ä¸ªä»èŠ‚ç‚¹ï¼Œä¸”ä¸»ä»èŠ‚ç‚¹ä¸åº”åœ¨ä¸€å°ç‰©ç†æœºä¸Šï¼›å› æ­¤é«˜å¯ç”¨é›†ç¾¤è‡³å°‘åŒ…å«6ä¸ªèŠ‚ç‚¹ã€‚</p><p>ï¼ˆ2ï¼‰æ•°æ®é‡å’Œè®¿é—®é‡ï¼šä¼°ç®—åº”ç”¨éœ€è¦çš„æ•°æ®é‡å’Œæ€»è®¿é—®é‡(è€ƒè™‘ä¸šåŠ¡å‘å±•ï¼Œç•™æœ‰å†—ä½™)ï¼Œç»“åˆæ¯ä¸ªä¸»èŠ‚ç‚¹çš„å®¹é‡å’Œèƒ½æ‰¿å—çš„è®¿é—®é‡(å¯ä»¥é€šè¿‡benchmarkå¾—åˆ°è¾ƒå‡†ç¡®ä¼°è®¡)ï¼Œè®¡ç®—éœ€è¦çš„ä¸»èŠ‚ç‚¹æ•°é‡ã€‚</p><p>ï¼ˆ3ï¼‰èŠ‚ç‚¹æ•°é‡é™åˆ¶ï¼šRediså®˜æ–¹ç»™å‡ºçš„èŠ‚ç‚¹æ•°é‡é™åˆ¶ä¸º1000ï¼Œä¸»è¦æ˜¯è€ƒè™‘èŠ‚ç‚¹é—´é€šä¿¡å¸¦æ¥çš„æ¶ˆè€—ã€‚åœ¨å®é™…åº”ç”¨ä¸­åº”å°½é‡é¿å…å¤§é›†ç¾¤ï¼›å¦‚æœèŠ‚ç‚¹æ•°é‡ä¸è¶³ä»¥æ»¡è¶³åº”ç”¨å¯¹Redisæ•°æ®é‡å’Œè®¿é—®é‡çš„è¦æ±‚ï¼Œå¯ä»¥è€ƒè™‘ï¼š(1)ä¸šåŠ¡åˆ†å‰²ï¼Œå¤§é›†ç¾¤åˆ†ä¸ºå¤šä¸ªå°é›†ç¾¤ï¼›(2)å‡å°‘ä¸å¿…è¦çš„æ•°æ®ï¼›(3)è°ƒæ•´æ•°æ®è¿‡æœŸç­–ç•¥ç­‰ã€‚</p><p>ï¼ˆ4ï¼‰é€‚åº¦å†—ä½™ï¼šRediså¯ä»¥åœ¨ä¸å½±å“é›†ç¾¤æœåŠ¡çš„æƒ…å†µä¸‹å¢åŠ èŠ‚ç‚¹ï¼Œå› æ­¤èŠ‚ç‚¹æ•°é‡é€‚å½“å†—ä½™å³å¯ï¼Œä¸ç”¨å¤ªå¤§ã€‚</p><h2 id="ã€åŸºæœ¬åŸç†ã€‘-2">ã€åŸºæœ¬åŸç†ã€‘</h2><p><strong>é›†ç¾¤æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯æ•°æ®åˆ†åŒºï¼Œå› æ­¤é¦–å…ˆä»‹ç»æ•°æ®çš„åˆ†åŒºè§„åˆ™ï¼›ç„¶åä»‹ç»é›†ç¾¤å®ç°çš„ç»†èŠ‚ï¼šé€šä¿¡æœºåˆ¶å’Œæ•°æ®ç»“æ„ï¼›æœ€åä»¥cluster meet(èŠ‚ç‚¹æ¡æ‰‹)ã€cluster addslots(æ§½åˆ†é…)ä¸ºä¾‹ï¼Œè¯´æ˜èŠ‚ç‚¹æ˜¯å¦‚ä½•åˆ©ç”¨ä¸Šè¿°æ•°æ®ç»“æ„å’Œé€šä¿¡æœºåˆ¶å®ç°é›†ç¾¤å‘½ä»¤çš„ã€‚</strong></p><h3 id="1-æ•°æ®åˆ†åŒºæ–¹æ¡ˆ">1.æ•°æ®åˆ†åŒºæ–¹æ¡ˆ</h3><p>æ•°æ®åˆ†åŒºæœ‰é¡ºåºåˆ†åŒºã€å“ˆå¸Œåˆ†åŒºç­‰ï¼Œå…¶ä¸­å“ˆå¸Œåˆ†åŒºç”±äºå…¶å¤©ç„¶çš„éšæœºæ€§ï¼Œä½¿ç”¨å¹¿æ³›ï¼›é›†ç¾¤çš„åˆ†åŒºæ–¹æ¡ˆä¾¿æ˜¯å“ˆå¸Œåˆ†åŒºçš„ä¸€ç§ã€‚</p><p>å“ˆå¸Œåˆ†åŒºçš„åŸºæœ¬æ€è·¯æ˜¯ï¼šå¯¹æ•°æ®çš„ç‰¹å¾å€¼ï¼ˆå¦‚keyï¼‰è¿›è¡Œå“ˆå¸Œï¼Œç„¶åæ ¹æ®å“ˆå¸Œå€¼å†³å®šæ•°æ®è½åœ¨å“ªä¸ªèŠ‚ç‚¹ã€‚å¸¸è§çš„å“ˆå¸Œåˆ†åŒºåŒ…æ‹¬ï¼š</p><ul><li><p>å“ˆå¸Œå–ä½™åˆ†åŒº</p></li><li><p>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº</p></li><li><p>å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºç­‰ã€‚</p></li></ul><p>è¡¡é‡æ•°æ®åˆ†åŒºæ–¹æ³•å¥½åçš„æ ‡å‡†æœ‰å¾ˆå¤šï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ªå› ç´ æ˜¯(1)æ•°æ®åˆ†å¸ƒæ˜¯å¦å‡åŒ€(2)å¢åŠ æˆ–åˆ å‡èŠ‚ç‚¹å¯¹æ•°æ®åˆ†å¸ƒçš„å½±å“ã€‚ç”±äºå“ˆå¸Œçš„éšæœºæ€§ï¼Œå“ˆå¸Œåˆ†åŒºåŸºæœ¬å¯ä»¥ä¿è¯æ•°æ®åˆ†å¸ƒå‡åŒ€ï¼›å› æ­¤åœ¨æ¯”è¾ƒå“ˆå¸Œåˆ†åŒºæ–¹æ¡ˆæ—¶ï¼Œé‡ç‚¹è¦çœ‹å¢å‡èŠ‚ç‚¹å¯¹æ•°æ®åˆ†å¸ƒçš„å½±å“ã€‚</p><p>ï¼ˆ1ï¼‰å“ˆå¸Œå–ä½™åˆ†åŒº</p><p>å“ˆå¸Œå–ä½™åˆ†åŒºæ€è·¯éå¸¸ç®€å•ï¼šè®¡ç®—keyçš„hashå€¼ï¼Œç„¶åå¯¹èŠ‚ç‚¹æ•°é‡è¿›è¡Œå–ä½™ï¼Œä»è€Œå†³å®šæ•°æ®æ˜ å°„åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šã€‚è¯¥æ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œå½“æ–°å¢æˆ–åˆ å‡èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹æ•°é‡å‘ç”Ÿå˜åŒ–ï¼Œç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦é‡æ–°è®¡ç®—æ˜ å°„å…³ç³»ï¼Œå¼•å‘å¤§è§„æ¨¡æ•°æ®è¿ç§»ã€‚</p><p>ï¼ˆ2ï¼‰ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº</p><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒèŒƒå›´ä¸º0-2^32-1ï¼›å¯¹äºæ¯ä¸ªæ•°æ®ï¼Œæ ¹æ®keyè®¡ç®—hashå€¼ï¼Œç¡®å®šæ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œç„¶åä»æ­¤ä½ç½®æ²¿ç¯é¡ºæ—¶é’ˆè¡Œèµ°ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥æ˜ å°„åˆ°çš„æœåŠ¡å™¨ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/1174710-20181025213424713-1246878063.png" class="" title="img"><p>ä¸å“ˆå¸Œå–ä½™åˆ†åŒºç›¸æ¯”ï¼Œä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºå°†å¢å‡èŠ‚ç‚¹çš„å½±å“é™åˆ¶åœ¨ç›¸é‚»èŠ‚ç‚¹ã€‚ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå¦‚æœåœ¨node1å’Œnode2ä¹‹é—´å¢åŠ node5ï¼Œåˆ™åªæœ‰node2ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®ä¼šè¿ç§»åˆ°node5ï¼›å¦‚æœå»æ‰node2ï¼Œåˆ™åŸnode2ä¸­çš„æ•°æ®åªä¼šè¿ç§»åˆ°node4ä¸­ï¼Œåªæœ‰node4ä¼šå—å½±å“ã€‚</p><p>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºçš„ä¸»è¦é—®é¢˜åœ¨äºï¼Œå½“èŠ‚ç‚¹æ•°é‡è¾ƒå°‘æ—¶ï¼Œå¢åŠ æˆ–åˆ å‡èŠ‚ç‚¹ï¼Œå¯¹å•ä¸ªèŠ‚ç‚¹çš„å½±å“å¯èƒ½å¾ˆå¤§ï¼Œé€ æˆæ•°æ®çš„ä¸¥é‡ä¸å¹³è¡¡ã€‚è¿˜æ˜¯ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå¦‚æœå»æ‰node2ï¼Œnode4ä¸­çš„æ•°æ®ç”±æ€»æ•°æ®çš„1/4å·¦å³å˜ä¸º1/2å·¦å³ï¼Œä¸å…¶ä»–èŠ‚ç‚¹ç›¸æ¯”è´Ÿè½½è¿‡é«˜ã€‚</p><p>ï¼ˆ3ï¼‰å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº</p><p>è¯¥æ–¹æ¡ˆåœ¨ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºçš„åŸºç¡€ä¸Šï¼Œå¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹çš„æ¦‚å¿µã€‚**Redis<strong><strong>é›†ç¾¤ä½¿ç”¨çš„ä¾¿æ˜¯è¯¥æ–¹æ¡ˆï¼Œå…¶ä¸­çš„è™šæ‹ŸèŠ‚ç‚¹ç§°ä¸ºæ§½ï¼ˆslot</strong></strong>ï¼‰ã€‚**æ§½æ˜¯ä»‹äºæ•°æ®å’Œå®é™…èŠ‚ç‚¹ä¹‹é—´çš„è™šæ‹Ÿæ¦‚å¿µï¼›æ¯ä¸ªå®é™…èŠ‚ç‚¹åŒ…å«ä¸€å®šæ•°é‡çš„æ§½ï¼Œæ¯ä¸ªæ§½åŒ…å«å“ˆå¸Œå€¼åœ¨ä¸€å®šèŒƒå›´å†…çš„æ•°æ®ã€‚å¼•å…¥æ§½ä»¥åï¼Œæ•°æ®çš„æ˜ å°„å…³ç³»ç”±æ•°æ®hash-&gt;å®é™…èŠ‚ç‚¹ï¼Œå˜æˆäº†æ•°æ®hash-&gt;æ§½-&gt;å®é™…èŠ‚ç‚¹ã€‚</p><p>**åœ¨ä½¿ç”¨äº†æ§½çš„ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºä¸­ï¼Œæ§½æ˜¯æ•°æ®ç®¡ç†å’Œè¿ç§»çš„åŸºæœ¬å•ä½ã€‚æ§½è§£è€¦äº†æ•°æ®å’Œå®é™…èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œå¢åŠ æˆ–åˆ é™¤èŠ‚ç‚¹å¯¹ç³»ç»Ÿçš„å½±å“å¾ˆå°ã€‚**ä»ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œç³»ç»Ÿä¸­æœ‰4ä¸ªå®é™…èŠ‚ç‚¹ï¼Œå‡è®¾ä¸ºå…¶åˆ†é…16ä¸ªæ§½(0-15)ï¼› æ§½0-3ä½äºnode1ï¼Œ4-7ä½äºnode2ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœæ­¤æ—¶åˆ é™¤node2ï¼Œåªéœ€è¦å°†æ§½4-7é‡æ–°åˆ†é…å³å¯ï¼Œä¾‹å¦‚æ§½4-5åˆ†é…ç»™node1ï¼Œæ§½6åˆ†é…ç»™node3ï¼Œæ§½7åˆ†é…ç»™node4ï¼›å¯ä»¥çœ‹å‡ºåˆ é™¤node2åï¼Œæ•°æ®åœ¨å…¶ä»–èŠ‚ç‚¹çš„åˆ†å¸ƒä»ç„¶è¾ƒä¸ºå‡è¡¡ã€‚</p><p>æ§½çš„æ•°é‡ä¸€èˆ¬è¿œå°äº2^32ï¼Œè¿œå¤§äºå®é™…èŠ‚ç‚¹çš„æ•°é‡ï¼›åœ¨Redisé›†ç¾¤ä¸­ï¼Œæ§½çš„æ•°é‡ä¸º16384ã€‚</p><p>ä¸‹é¢è¿™å¼ å›¾å¾ˆå¥½çš„æ€»ç»“äº†Redisé›†ç¾¤å°†æ•°æ®æ˜ å°„åˆ°å®é™…èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F/1174710-20190802191100758-1110624103.png" class="" title="img"><p>ï¼ˆ1ï¼‰Rediså¯¹æ•°æ®çš„ç‰¹å¾å€¼ï¼ˆä¸€èˆ¬æ˜¯keyï¼‰è®¡ç®—å“ˆå¸Œå€¼ï¼Œä½¿ç”¨çš„ç®—æ³•æ˜¯CRC16ã€‚</p><p>ï¼ˆ2ï¼‰æ ¹æ®å“ˆå¸Œå€¼ï¼Œè®¡ç®—æ•°æ®å±äºå“ªä¸ªæ§½ã€‚</p><p>ï¼ˆ3ï¼‰æ ¹æ®æ§½ä¸èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ï¼Œè®¡ç®—æ•°æ®å±äºå“ªä¸ªèŠ‚ç‚¹ã€‚</p><h3 id="3-èŠ‚ç‚¹é€šä¿¡æœºåˆ¶">3.èŠ‚ç‚¹é€šä¿¡æœºåˆ¶</h3><h4 id="ä¸¤ä¸ªç«¯å£">ä¸¤ä¸ªç«¯å£</h4><p>åœ¨å“¨å…µç³»ç»Ÿä¸­ï¼ŒèŠ‚ç‚¹åˆ†ä¸ºæ•°æ®èŠ‚ç‚¹å’Œå“¨å…µèŠ‚ç‚¹ï¼šå‰è€…å­˜å‚¨æ•°æ®ï¼Œåè€…å®ç°é¢å¤–çš„æ§åˆ¶åŠŸèƒ½ã€‚åœ¨é›†ç¾¤ä¸­ï¼Œæ²¡æœ‰æ•°æ®èŠ‚ç‚¹ä¸éæ•°æ®èŠ‚ç‚¹ä¹‹åˆ†ï¼šæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å­˜å‚¨æ•°æ®ï¼Œä¹Ÿéƒ½å‚ä¸é›†ç¾¤çŠ¶æ€çš„ç»´æŠ¤ã€‚ä¸ºæ­¤ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œéƒ½æä¾›äº†ä¸¤ä¸ªTCPç«¯å£ï¼š</p><ul><li>æ™®é€šç«¯å£ï¼šå³æˆ‘ä»¬åœ¨å‰é¢æŒ‡å®šçš„ç«¯å£(7000ç­‰)ã€‚æ™®é€šç«¯å£ä¸»è¦ç”¨äºä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼ˆä¸å•æœºèŠ‚ç‚¹ç±»ä¼¼ï¼‰ï¼›ä½†åœ¨èŠ‚ç‚¹é—´æ•°æ®è¿ç§»æ—¶ä¹Ÿä¼šä½¿ç”¨ã€‚</li><li>é›†ç¾¤ç«¯å£ï¼šç«¯å£å·æ˜¯æ™®é€šç«¯å£+10000ï¼ˆ10000æ˜¯å›ºå®šå€¼ï¼Œæ— æ³•æ”¹å˜ï¼‰ï¼Œå¦‚7000èŠ‚ç‚¹çš„é›†ç¾¤ç«¯å£ä¸º17000ã€‚é›†ç¾¤ç«¯å£åªç”¨äºèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ï¼Œå¦‚æ­å»ºé›†ç¾¤ã€å¢å‡èŠ‚ç‚¹ã€æ•…éšœè½¬ç§»ç­‰æ“ä½œæ—¶èŠ‚ç‚¹é—´çš„é€šä¿¡ï¼›ä¸è¦ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥é›†ç¾¤æ¥å£ã€‚ä¸ºäº†ä¿è¯é›†ç¾¤å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œåœ¨é…ç½®é˜²ç«å¢™æ—¶ï¼Œè¦åŒæ—¶å¼€å¯æ™®é€šç«¯å£å’Œé›†ç¾¤ç«¯å£ã€‚</li></ul><h4 id="Gossipåè®®">Gossipåè®®</h4><p>èŠ‚ç‚¹é—´é€šä¿¡ï¼ŒæŒ‰ç…§é€šä¿¡åè®®å¯ä»¥åˆ†ä¸ºå‡ ç§ç±»å‹ï¼šå•å¯¹å•ã€å¹¿æ’­ã€Gossipåè®®ç­‰ã€‚é‡ç‚¹æ˜¯å¹¿æ’­å’ŒGossipçš„å¯¹æ¯”ã€‚</p><p>å¹¿æ’­æ˜¯æŒ‡å‘é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹å‘é€æ¶ˆæ¯ï¼›ä¼˜ç‚¹æ˜¯é›†ç¾¤çš„æ”¶æ•›é€Ÿåº¦å¿«(é›†ç¾¤æ”¶æ•›æ˜¯æŒ‡é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹è·å¾—çš„é›†ç¾¤ä¿¡æ¯æ˜¯ä¸€è‡´çš„)ï¼Œç¼ºç‚¹æ˜¯æ¯æ¡æ¶ˆæ¯éƒ½è¦å‘é€ç»™æ‰€æœ‰èŠ‚ç‚¹ï¼ŒCPUã€å¸¦å®½ç­‰æ¶ˆè€—è¾ƒå¤§ã€‚</p><p>Gossipåè®®çš„ç‰¹ç‚¹æ˜¯ï¼šåœ¨èŠ‚ç‚¹æ•°é‡æœ‰é™çš„ç½‘ç»œä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½â€œéšæœºâ€çš„ä¸éƒ¨åˆ†èŠ‚ç‚¹é€šä¿¡ï¼ˆå¹¶ä¸æ˜¯çœŸæ­£çš„éšæœºï¼Œè€Œæ˜¯æ ¹æ®ç‰¹å®šçš„è§„åˆ™é€‰æ‹©é€šä¿¡çš„èŠ‚ç‚¹ï¼‰ï¼Œç»è¿‡ä¸€ç•ªæ‚ä¹±æ— ç« çš„é€šä¿¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€å¾ˆå¿«ä¼šè¾¾åˆ°ä¸€è‡´ã€‚Gossipåè®®çš„ä¼˜ç‚¹æœ‰è´Ÿè½½(æ¯”å¹¿æ’­)ä½ã€å»ä¸­å¿ƒåŒ–ã€å®¹é”™æ€§é«˜(å› ä¸ºé€šä¿¡æœ‰å†—ä½™)ç­‰ï¼›ç¼ºç‚¹ä¸»è¦æ˜¯é›†ç¾¤çš„æ”¶æ•›é€Ÿåº¦æ…¢ã€‚</p><h4 id="æ¶ˆæ¯ç±»å‹">æ¶ˆæ¯ç±»å‹</h4><p>é›†ç¾¤ä¸­çš„èŠ‚ç‚¹é‡‡ç”¨å›ºå®šé¢‘ç‡ï¼ˆæ¯ç§’10æ¬¡ï¼‰çš„å®šæ—¶ä»»åŠ¡è¿›è¡Œé€šä¿¡ç›¸å…³çš„å·¥ä½œï¼šåˆ¤æ–­æ˜¯å¦éœ€è¦å‘é€æ¶ˆæ¯åŠæ¶ˆæ¯ç±»å‹ã€ç¡®å®šæ¥æ”¶èŠ‚ç‚¹ã€å‘é€æ¶ˆæ¯ç­‰ã€‚å¦‚æœé›†ç¾¤çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚å¢å‡èŠ‚ç‚¹ã€æ§½çŠ¶æ€å˜æ›´ï¼Œé€šè¿‡èŠ‚ç‚¹é—´çš„é€šä¿¡ï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¼šå¾ˆå¿«å¾—çŸ¥æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼Œä½¿é›†ç¾¤æ”¶æ•›ã€‚</p><p>èŠ‚ç‚¹é—´å‘é€çš„æ¶ˆæ¯ä¸»è¦åˆ†ä¸º5ç§ï¼šmeetæ¶ˆæ¯ã€pingæ¶ˆæ¯ã€pongæ¶ˆæ¯ã€failæ¶ˆæ¯ã€publishæ¶ˆæ¯ã€‚ä¸åŒçš„æ¶ˆæ¯ç±»å‹ï¼Œé€šä¿¡åè®®ã€å‘é€çš„é¢‘ç‡å’Œæ—¶æœºã€æ¥æ”¶èŠ‚ç‚¹çš„é€‰æ‹©ç­‰æ˜¯ä¸åŒçš„ã€‚</p><ul><li>MEETæ¶ˆæ¯ï¼šåœ¨èŠ‚ç‚¹æ¡æ‰‹é˜¶æ®µï¼Œå½“èŠ‚ç‚¹æ”¶åˆ°å®¢æˆ·ç«¯çš„CLUSTER MEETå‘½ä»¤æ—¶ï¼Œä¼šå‘æ–°åŠ å…¥çš„èŠ‚ç‚¹å‘é€MEETæ¶ˆæ¯ï¼Œè¯·æ±‚æ–°èŠ‚ç‚¹åŠ å…¥åˆ°å½“å‰é›†ç¾¤ï¼›æ–°èŠ‚ç‚¹æ”¶åˆ°MEETæ¶ˆæ¯åä¼šå›å¤ä¸€ä¸ªPONGæ¶ˆæ¯ã€‚</li><li>PINGæ¶ˆæ¯ï¼šé›†ç¾¤é‡Œæ¯ä¸ªèŠ‚ç‚¹æ¯ç§’é’Ÿä¼šé€‰æ‹©éƒ¨åˆ†èŠ‚ç‚¹å‘é€PINGæ¶ˆæ¯ï¼Œæ¥æ”¶è€…æ”¶åˆ°æ¶ˆæ¯åä¼šå›å¤ä¸€ä¸ªPONGæ¶ˆæ¯ã€‚PINGæ¶ˆæ¯çš„å†…å®¹æ˜¯è‡ªèº«èŠ‚ç‚¹å’Œéƒ¨åˆ†å…¶ä»–èŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ï¼›ä½œç”¨æ˜¯å½¼æ­¤äº¤æ¢ä¿¡æ¯ï¼Œä»¥åŠæ£€æµ‹èŠ‚ç‚¹æ˜¯å¦åœ¨çº¿ã€‚PINGæ¶ˆæ¯ä½¿ç”¨Gossipåè®®å‘é€ï¼Œæ¥æ”¶èŠ‚ç‚¹çš„é€‰æ‹©å…¼é¡¾äº†æ”¶æ•›é€Ÿåº¦å’Œå¸¦å®½æˆæœ¬ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š(1)éšæœºæ‰¾5ä¸ªèŠ‚ç‚¹ï¼Œåœ¨å…¶ä¸­é€‰æ‹©æœ€ä¹…æ²¡æœ‰é€šä¿¡çš„1ä¸ªèŠ‚ç‚¹(2)æ‰«æèŠ‚ç‚¹åˆ—è¡¨ï¼Œé€‰æ‹©æœ€è¿‘ä¸€æ¬¡æ”¶åˆ°PONGæ¶ˆæ¯æ—¶é—´å¤§äºcluster_node_timeout/2çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œé˜²æ­¢è¿™äº›èŠ‚ç‚¹é•¿æ—¶é—´æœªæ›´æ–°ã€‚</li><li>PONGæ¶ˆæ¯ï¼šPONGæ¶ˆæ¯å°è£…äº†è‡ªèº«çŠ¶æ€æ•°æ®ã€‚å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šç¬¬ä¸€ç§æ˜¯åœ¨æ¥åˆ°MEET/PINGæ¶ˆæ¯åå›å¤çš„PONGæ¶ˆæ¯ï¼›ç¬¬äºŒç§æ˜¯æŒ‡èŠ‚ç‚¹å‘é›†ç¾¤å¹¿æ’­PONGæ¶ˆæ¯ï¼Œè¿™æ ·å…¶ä»–èŠ‚ç‚¹å¯ä»¥è·çŸ¥è¯¥èŠ‚ç‚¹çš„æœ€æ–°ä¿¡æ¯ï¼Œä¾‹å¦‚æ•…éšœæ¢å¤åæ–°çš„ä¸»èŠ‚ç‚¹ä¼šå¹¿æ’­PONGæ¶ˆæ¯ã€‚</li><li>FAILæ¶ˆæ¯ï¼šå½“ä¸€ä¸ªä¸»èŠ‚ç‚¹åˆ¤æ–­å¦ä¸€ä¸ªä¸»èŠ‚ç‚¹è¿›å…¥FAILçŠ¶æ€æ—¶ï¼Œä¼šå‘é›†ç¾¤å¹¿æ’­è¿™ä¸€FAILæ¶ˆæ¯ï¼›æ¥æ”¶èŠ‚ç‚¹ä¼šå°†è¿™ä¸€FAILæ¶ˆæ¯ä¿å­˜èµ·æ¥ï¼Œä¾¿äºåç»­çš„åˆ¤æ–­ã€‚</li><li>PUBLISHæ¶ˆæ¯ï¼šèŠ‚ç‚¹æ”¶åˆ°PUBLISHå‘½ä»¤åï¼Œä¼šå…ˆæ‰§è¡Œè¯¥å‘½ä»¤ï¼Œç„¶åå‘é›†ç¾¤å¹¿æ’­è¿™ä¸€æ¶ˆæ¯ï¼Œæ¥æ”¶èŠ‚ç‚¹ä¹Ÿä¼šæ‰§è¡Œè¯¥PUBLISHå‘½ä»¤ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RedisæŒä¹…åŒ–</title>
    <link href="/dajiangdahe/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    <url>/dajiangdahe/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1>1.Redisé«˜å¯ç”¨æ¦‚è¿°</h1><p>åœ¨ä»‹ç»Redisé«˜å¯ç”¨ä¹‹å‰ï¼Œå…ˆè¯´æ˜ä¸€ä¸‹åœ¨Redisçš„è¯­å¢ƒä¸­é«˜å¯ç”¨çš„å«ä¹‰ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨webæœåŠ¡å™¨ä¸­ï¼Œé«˜å¯ç”¨æ˜¯æŒ‡æœåŠ¡å™¨å¯ä»¥æ­£å¸¸è®¿é—®çš„æ—¶é—´ï¼Œè¡¡é‡çš„æ ‡å‡†æ˜¯åœ¨å¤šé•¿æ—¶é—´å†…å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡ï¼ˆ99.9%ã€99.99%ã€99.999% ç­‰ç­‰ï¼‰ã€‚ä½†æ˜¯åœ¨Redisè¯­å¢ƒä¸­ï¼Œé«˜å¯ç”¨çš„å«ä¹‰ä¼¼ä¹è¦å®½æ³›ä¸€äº›ï¼Œé™¤äº†ä¿è¯æä¾›æ­£å¸¸æœåŠ¡(å¦‚ä¸»ä»åˆ†ç¦»ã€å¿«é€Ÿå®¹ç¾æŠ€æœ¯)ï¼Œè¿˜éœ€è¦è€ƒè™‘æ•°æ®å®¹é‡çš„æ‰©å±•ã€æ•°æ®å®‰å…¨ä¸ä¼šä¸¢å¤±ç­‰ã€‚</p><p>åœ¨Redisä¸­ï¼Œå®ç°é«˜å¯ç”¨çš„æŠ€æœ¯ä¸»è¦åŒ…æ‹¬æŒä¹…åŒ–ã€å¤åˆ¶ã€å“¨å…µå’Œé›†ç¾¤ï¼Œä¸‹é¢åˆ†åˆ«è¯´æ˜å®ƒä»¬çš„ä½œç”¨ï¼Œä»¥åŠè§£å†³äº†ä»€ä¹ˆæ ·çš„é—®é¢˜ã€‚</p><ol><li><strong>æŒä¹…åŒ–</strong>ï¼šæŒä¹…åŒ–æ˜¯æœ€ç®€å•çš„é«˜å¯ç”¨æ–¹æ³•(æœ‰æ—¶ç”šè‡³ä¸è¢«å½’ä¸ºé«˜å¯ç”¨çš„æ‰‹æ®µ)ï¼Œä¸»è¦ä½œç”¨æ˜¯æ•°æ®å¤‡ä»½ï¼Œå³å°†æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ï¼Œä¿è¯æ•°æ®ä¸ä¼šå› è¿›ç¨‹é€€å‡ºè€Œä¸¢å¤±ã€‚</li><li><strong>å¤åˆ¶</strong>ï¼šå¤åˆ¶æ˜¯é«˜å¯ç”¨Redisçš„åŸºç¡€ï¼Œå“¨å…µå’Œé›†ç¾¤éƒ½æ˜¯åœ¨å¤åˆ¶åŸºç¡€ä¸Šå®ç°é«˜å¯ç”¨çš„ã€‚å¤åˆ¶ä¸»è¦å®ç°äº†æ•°æ®çš„å¤šæœºå¤‡ä»½ï¼Œä»¥åŠå¯¹äºè¯»æ“ä½œçš„è´Ÿè½½å‡è¡¡å’Œç®€å•çš„æ•…éšœæ¢å¤ã€‚ç¼ºé™·ï¼šæ•…éšœæ¢å¤æ— æ³•è‡ªåŠ¨åŒ–ï¼›å†™æ“ä½œæ— æ³•è´Ÿè½½å‡è¡¡ï¼›å­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚</li><li><strong>å“¨å…µ</strong>ï¼šåœ¨å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œå“¨å…µå®ç°äº†è‡ªåŠ¨åŒ–çš„æ•…éšœæ¢å¤ã€‚ç¼ºé™·ï¼šå†™æ“ä½œæ— æ³•è´Ÿè½½å‡è¡¡ï¼›å­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚</li><li><strong>é›†ç¾¤</strong>ï¼šé€šè¿‡é›†ç¾¤ï¼ŒRedisè§£å†³äº†å†™æ“ä½œæ— æ³•è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠå­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºé™åˆ¶çš„é—®é¢˜ï¼Œå®ç°äº†è¾ƒä¸ºå®Œå–„çš„é«˜å¯ç”¨æ–¹æ¡ˆã€‚</li></ol><h1>2.RedisæŒä¹…åŒ–æ¦‚è¿°</h1><p>æŒä¹…åŒ–çš„åŠŸèƒ½ï¼šRedisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†é¿å…è¿›ç¨‹é€€å‡ºå¯¼è‡´æ•°æ®çš„æ°¸ä¹…ä¸¢å¤±ï¼Œéœ€è¦å®šæœŸå°†Redisä¸­çš„æ•°æ®ä»¥æŸç§å½¢å¼(æ•°æ®æˆ–å‘½ä»¤)ä»å†…å­˜ä¿å­˜åˆ°ç¡¬ç›˜ï¼›å½“ä¸‹æ¬¡Redisé‡å¯æ—¶ï¼Œåˆ©ç”¨æŒä¹…åŒ–æ–‡ä»¶å®ç°æ•°æ®æ¢å¤ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸ºäº†è¿›è¡Œç¾éš¾å¤‡ä»½ï¼Œå¯ä»¥å°†æŒä¹…åŒ–æ–‡ä»¶æ‹·è´åˆ°ä¸€ä¸ªè¿œç¨‹ä½ç½®ã€‚</p><p>RedisæŒä¹…åŒ–åˆ†ä¸ºRDBæŒä¹…åŒ–å’ŒAOFæŒä¹…åŒ–**ï¼šå‰è€…å°†å½“å‰æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ï¼Œåè€…åˆ™æ˜¯å°†æ¯æ¬¡æ‰§è¡Œçš„==å†™å‘½ä»¤==ä¿å­˜åˆ°ç¡¬ç›˜ï¼ˆç±»ä¼¼äºMySQLçš„binlogï¼‰ï¼›**ç”±äºAOFæŒä¹…åŒ–çš„å®æ—¶æ€§æ›´å¥½ï¼Œå³å½“è¿›ç¨‹æ„å¤–é€€å‡ºæ—¶ä¸¢å¤±çš„æ•°æ®æ›´å°‘ï¼Œå› æ­¤AOFæ˜¯ç›®å‰ä¸»æµçš„æŒä¹…åŒ–æ–¹å¼ï¼Œä¸è¿‡RDBæŒä¹…åŒ–ä»ç„¶æœ‰å…¶ç”¨æ­¦ä¹‹åœ°ã€‚</p><h2 id="RDBæŒä¹…åŒ–">RDBæŒä¹…åŒ–</h2><p>RDBæŒä¹…åŒ–æ˜¯å°†å½“å‰è¿›ç¨‹ä¸­çš„æ•°æ®ç”Ÿæˆå¿«ç…§ä¿å­˜åˆ°ç¡¬ç›˜(å› æ­¤ä¹Ÿç§°ä½œå¿«ç…§æŒä¹…åŒ–)ï¼Œä¿å­˜çš„æ–‡ä»¶åç¼€æ˜¯rdbï¼›å½“Redisé‡æ–°å¯åŠ¨æ—¶ï¼Œå¯ä»¥è¯»å–å¿«ç…§æ–‡ä»¶æ¢å¤æ•°æ®ã€‚</p><h3 id="1-è§¦å‘æ¡ä»¶">1.è§¦å‘æ¡ä»¶</h3><p>RDBæŒä¹…åŒ–çš„è§¦å‘åˆ†ä¸ºæ‰‹åŠ¨è§¦å‘å’Œè‡ªåŠ¨è§¦å‘ä¸¤ç§ã€‚</p><p><strong>save</strong>å’Œ<strong>bgsave</strong>çš„åŒºåˆ«</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/1c950a7b02087bf43b4490d50ac25f2a11dfcf7e.jpeg" class="" title="img"><h4 id="1-æ‰‹åŠ¨è§¦å‘">(1)æ‰‹åŠ¨è§¦å‘</h4><p><strong>save</strong>å‘½ä»¤å’Œ<strong>bgsave</strong>å‘½ä»¤éƒ½å¯ä»¥ç”ŸæˆRDBæ–‡ä»¶ã€‚</p><p><strong>save</strong>å‘½ä»¤ä¼šé˜»å¡RedisæœåŠ¡å™¨è¿›ç¨‹ï¼Œç›´åˆ°RDBæ–‡ä»¶åˆ›å»ºå®Œæ¯•ä¸ºæ­¢ï¼Œåœ¨RedisæœåŠ¡å™¨é˜»å¡æœŸé—´ï¼ŒæœåŠ¡å™¨ä¸èƒ½å¤„ç†ä»»ä½•å‘½ä»¤è¯·æ±‚ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/1174710-20180605085242889-137050862.png" class="" title="img"><p>è€Œ<strong>bgsave</strong>å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹æ¥è´Ÿè´£åˆ›å»ºRDBæ–‡ä»¶ï¼Œçˆ¶è¿›ç¨‹(å³Redisä¸»è¿›ç¨‹)åˆ™ç»§ç»­å¤„ç†è¯·æ±‚ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/1174710-20180605085309364-1576452765.png" class="" title="img"><p>æ­¤æ—¶æœåŠ¡å™¨æ‰§è¡Œæ—¥å¿—å¦‚ä¸‹ï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/1174710-20180605085325656-76060516.png" class="" title="img"><p>bgsaveå‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåªæœ‰forkå­è¿›ç¨‹æ—¶ä¼šé˜»å¡æœåŠ¡å™¨ï¼Œè€Œå¯¹äºsaveå‘½ä»¤ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½ä¼šé˜»å¡æœåŠ¡å™¨ï¼Œå› æ­¤saveå·²åŸºæœ¬è¢«åºŸå¼ƒï¼Œçº¿ä¸Šç¯å¢ƒè¦æœç»saveçš„ä½¿ç”¨ï¼›åæ–‡ä¸­ä¹Ÿå°†åªä»‹ç»bgsaveå‘½ä»¤ã€‚æ­¤å¤–ï¼Œåœ¨è‡ªåŠ¨è§¦å‘RDBæŒä¹…åŒ–æ—¶ï¼ŒRedisä¹Ÿä¼šé€‰æ‹©bgsaveè€Œä¸æ˜¯saveæ¥è¿›è¡ŒæŒä¹…åŒ–ï¼›ä¸‹é¢ä»‹ç»è‡ªåŠ¨è§¦å‘RDBæŒä¹…åŒ–çš„æ¡ä»¶ã€‚</p><h4 id="2-è‡ªåŠ¨è§¦å‘">(2).è‡ªåŠ¨è§¦å‘</h4><p><strong>save m n</strong>:è‡ªåŠ¨è§¦å‘æœ€å¸¸è§çš„æƒ…å†µæ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡save m nï¼ŒæŒ‡å®šå½“mç§’å†…å‘ç”Ÿnæ¬¡å˜åŒ–æ—¶ï¼Œä¼šè§¦å‘bgsaveã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/1174710-20180605085420533-1928501600.png" class="" title="img"><p>é™¤äº†<strong>save m n</strong> ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–æƒ…å†µä¼šè§¦å‘bgsaveï¼š</p><ul><li>åœ¨ä¸»ä»å¤åˆ¶åœºæ™¯ä¸‹ï¼Œå¦‚æœä»èŠ‚ç‚¹æ‰§è¡Œå…¨é‡å¤åˆ¶æ“ä½œï¼Œåˆ™ä¸»èŠ‚ç‚¹ä¼šæ‰§è¡Œbgsaveå‘½ä»¤ï¼Œå¹¶å°†rdbæ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹</li><li>æ‰§è¡Œshutdownå‘½ä»¤æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡ŒrdbæŒä¹…åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ul><img src="/dajiangdahe.github.io/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/1174710-20180605085620830-1223048825.png" class="" title="img"><h3 id="2-æ‰§è¡Œæµç¨‹">2.æ‰§è¡Œæµç¨‹</h3><img src="/dajiangdahe.github.io/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/1174710-20180605085813461-389677620.png" class="" title="img"><p>å›¾ç‰‡ä¸­çš„5ä¸ªæ­¥éª¤æ‰€è¿›è¡Œçš„æ“ä½œå¦‚ä¸‹ï¼š</p><ol><li><p>Redisçˆ¶è¿›ç¨‹é¦–å…ˆåˆ¤æ–­ï¼šå½“å‰æ˜¯å¦åœ¨æ‰§è¡Œsaveï¼Œæˆ–bgsave/bgrewriteaofï¼ˆåé¢ä¼šè¯¦ç»†ä»‹ç»è¯¥å‘½ä»¤ï¼‰çš„å­è¿›ç¨‹ï¼Œå¦‚æœåœ¨æ‰§è¡Œåˆ™bgsaveå‘½ä»¤ç›´æ¥è¿”å›ã€‚bgsave/bgrewriteaof çš„å­è¿›ç¨‹ä¸èƒ½åŒæ—¶æ‰§è¡Œï¼Œä¸»è¦æ˜¯åŸºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼šä¸¤ä¸ªå¹¶å‘çš„å­è¿›ç¨‹åŒæ—¶æ‰§è¡Œå¤§é‡çš„ç£ç›˜å†™æ“ä½œï¼Œå¯èƒ½å¼•èµ·ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚</p></li><li><p>çˆ¶è¿›ç¨‹æ‰§è¡Œforkæ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­çˆ¶è¿›ç¨‹æ˜¯é˜»å¡çš„ï¼ŒRedisä¸èƒ½æ‰§è¡Œæ¥è‡ªå®¢æˆ·ç«¯çš„ä»»ä½•å‘½ä»¤</p></li><li><p>çˆ¶è¿›ç¨‹forkåï¼Œbgsaveå‘½ä»¤è¿”å›â€Background saving startedâ€ä¿¡æ¯å¹¶ä¸å†é˜»å¡çˆ¶è¿›ç¨‹ï¼Œå¹¶å¯ä»¥å“åº”å…¶ä»–å‘½ä»¤</p></li><li><p>å­è¿›ç¨‹åˆ›å»ºRDBæ–‡ä»¶ï¼Œæ ¹æ®çˆ¶è¿›ç¨‹å†…å­˜å¿«ç…§ç”Ÿæˆä¸´æ—¶å¿«ç…§æ–‡ä»¶ï¼Œå®Œæˆåå¯¹åŸæœ‰æ–‡ä»¶è¿›è¡ŒåŸå­æ›¿æ¢</p></li><li><p>å­è¿›ç¨‹å‘é€ä¿¡å·ç»™çˆ¶è¿›ç¨‹è¡¨ç¤ºå®Œæˆï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯</p></li></ol><h3 id="3-RDBä¼˜åŠ¿ä¸åŠ£åŠ¿">3.RDBä¼˜åŠ¿ä¸åŠ£åŠ¿</h3><p>â‘ ã€ä¼˜åŠ¿</p><p>ï¼ˆ1ï¼‰RDBæ–‡ä»¶ç´§å‡‘ï¼Œå…¨é‡å¤‡ä»½ï¼Œéå¸¸é€‚åˆç”¨äºè¿›è¡Œå¤‡ä»½å’Œç¾éš¾æ¢å¤ã€‚</p><p>ï¼ˆ2ï¼‰ç”ŸæˆRDBæ–‡ä»¶çš„æ—¶å€™ï¼Œredisä¸»è¿›ç¨‹ä¼šfork()ä¸€ä¸ªå­è¿›ç¨‹æ¥å¤„ç†æ‰€æœ‰ä¿å­˜å·¥ä½œï¼Œä¸»è¿›ç¨‹ä¸éœ€è¦è¿›è¡Œä»»ä½•ç£ç›˜IOæ“ä½œã€‚</p><p>ï¼ˆ3ï¼‰RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚</p><p>â‘¡ã€åŠ£åŠ¿</p><p>RDBå¿«ç…§æ˜¯ä¸€æ¬¡å…¨é‡å¤‡ä»½ï¼Œå­˜å‚¨çš„æ˜¯å†…å­˜æ•°æ®çš„äºŒè¿›åˆ¶åºåˆ—åŒ–å½¢å¼ï¼Œå­˜å‚¨ä¸Šéå¸¸ç´§å‡‘ã€‚å½“è¿›è¡Œå¿«ç…§æŒä¹…åŒ–æ—¶ï¼Œä¼šå¼€å¯ä¸€ä¸ªå­è¿›ç¨‹ä¸“é—¨è´Ÿè´£å¿«ç…§æŒä¹…åŒ–ï¼Œå­è¿›ç¨‹ä¼šæ‹¥æœ‰çˆ¶è¿›ç¨‹çš„å†…å­˜æ•°æ®ï¼Œçˆ¶è¿›ç¨‹ä¿®æ”¹å†…å­˜å­è¿›ç¨‹ä¸ä¼šååº”å‡ºæ¥ï¼Œæ‰€ä»¥åœ¨å¿«ç…§æŒä¹…åŒ–æœŸé—´ä¿®æ”¹çš„æ•°æ®ä¸ä¼šè¢«ä¿å­˜ï¼Œå¯èƒ½ä¸¢å¤±æ•°æ®ã€‚</p><h2 id="AOFæœºåˆ¶">AOFæœºåˆ¶</h2><p>å…¨é‡å¤‡ä»½æ€»æ˜¯è€—æ—¶çš„ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬æä¾›ä¸€ç§æ›´åŠ é«˜æ•ˆçš„æ–¹å¼AOFï¼Œå·¥ä½œæœºåˆ¶å¾ˆç®€å•ï¼Œredisä¼šå°†æ¯ä¸€ä¸ªæ”¶åˆ°çš„å†™å‘½ä»¤éƒ½é€šè¿‡writeå‡½æ•°è¿½åŠ åˆ°æ–‡ä»¶ä¸­ã€‚é€šä¿—çš„ç†è§£å°±æ˜¯æ—¥å¿—è®°å½•ã€‚</p><h3 id="1-æŒä¹…åŒ–åŸç†">1.æŒä¹…åŒ–åŸç†</h3><img src="/dajiangdahe.github.io/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/32fa828ba61ea8d3c2502e396b1b3848251f58b0.jpeg" class="" title="img"><p>æ¯å½“æœ‰ä¸€ä¸ª<strong>å†™å‘½ä»¤</strong>è¿‡æ¥æ—¶ï¼Œå°±ç›´æ¥ä¿å­˜åˆ°æˆ‘ä»¬çš„AOFä¸­</p><h3 id="2-æ–‡ä»¶é‡å†™åŸç†">2.æ–‡ä»¶é‡å†™åŸç†</h3><p>AOFçš„æ–¹å¼ä¹ŸåŒæ—¶å¸¦æ¥äº†å¦ä¸€ä¸ªé—®é¢˜ã€‚æŒä¹…åŒ–æ–‡ä»¶ä¼šå˜çš„è¶Šæ¥è¶Šå¤§ã€‚ä¸ºäº†å‹ç¼©aofçš„æŒä¹…åŒ–æ–‡ä»¶ã€‚redisæä¾›äº†bgrewriteaofå‘½ä»¤ã€‚å°†å†…å­˜ä¸­çš„æ•°æ®ä»¥å‘½ä»¤çš„æ–¹å¼ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶ä¼šforkå‡ºä¸€æ¡æ–°è¿›ç¨‹æ¥å°†æ–‡ä»¶é‡å†™ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/09fa513d269759ee28454d2c4cea4b106c22dfd3.jpeg" class="" title="img"><p>é‡å†™AOFæ–‡ä»¶çš„æ“ä½œï¼Œå¹¶æ²¡æœ‰è¯»å–æ—§çš„AOFæ–‡ä»¶ï¼Œè€Œæ˜¯å°†æ•´ä¸ªå†…å­˜ä¸­çš„æ•°æ®åº“å†…å®¹ç”¨å‘½ä»¤çš„æ–¹å¼é‡å†™äº†ä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶ï¼Œè¿™ç‚¹å’Œå¿«ç…§æœ‰ç‚¹ç±»ä¼¼ã€‚</p><h3 id="3-è§¦å‘æœºåˆ¶">3.è§¦å‘æœºåˆ¶</h3><p>ï¼ˆ1ï¼‰æ¯ä¿®æ”¹åŒæ­¥alwaysï¼šåŒæ­¥æŒä¹…åŒ– æ¯æ¬¡å‘ç”Ÿæ•°æ®å˜æ›´ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜ æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½</p><p>ï¼ˆ2ï¼‰æ¯ç§’åŒæ­¥everysecï¼šå¼‚æ­¥æ“ä½œï¼Œæ¯ç§’è®°å½• å¦‚æœä¸€ç§’å†…å®•æœºï¼Œæœ‰æ•°æ®ä¸¢å¤±</p><p>ï¼ˆ3ï¼‰ä¸åŒnoï¼šä»ä¸åŒæ­¥</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/b17eca8065380cd7df69859ba056a5325982816c.jpeg" class="" title="img"><h3 id="4-AOFä¼˜ç¼ºç‚¹">4.AOFä¼˜ç¼ºç‚¹</h3><p>â‘ ã€ä¼˜åŠ¿</p><p>ï¼ˆ1ï¼‰AOFå¯ä»¥æ›´å¥½çš„ä¿æŠ¤æ•°æ®ä¸ä¸¢å¤±ï¼Œä¸€èˆ¬AOFä¼šæ¯éš”1ç§’ï¼Œé€šè¿‡ä¸€ä¸ªåå°çº¿ç¨‹æ‰§è¡Œä¸€æ¬¡fsyncæ“ä½œï¼Œæœ€å¤šä¸¢å¤±1ç§’é’Ÿçš„æ•°æ®ã€‚</p><p>ï¼ˆ2ï¼‰AOFæ—¥å¿—æ–‡ä»¶æ²¡æœ‰ä»»ä½•ç£ç›˜å¯»å€çš„å¼€é”€ï¼Œå†™å…¥æ€§èƒ½éå¸¸é«˜ï¼Œæ–‡ä»¶ä¸å®¹æ˜“ç ´æŸã€‚</p><p>ï¼ˆ3ï¼‰AOFæ—¥å¿—æ–‡ä»¶å³ä½¿è¿‡å¤§çš„æ—¶å€™ï¼Œå‡ºç°åå°é‡å†™æ“ä½œï¼Œä¹Ÿä¸ä¼šå½±å“å®¢æˆ·ç«¯çš„è¯»å†™ã€‚</p><p>ï¼ˆ4ï¼‰AOFæ—¥å¿—æ–‡ä»¶çš„å‘½ä»¤é€šè¿‡éå¸¸å¯è¯»çš„æ–¹å¼è¿›è¡Œè®°å½•ï¼Œè¿™ä¸ªç‰¹æ€§éå¸¸é€‚åˆåšç¾éš¾æ€§çš„è¯¯åˆ é™¤çš„ç´§æ€¥æ¢å¤ã€‚æ¯”å¦‚æŸäººä¸å°å¿ƒç”¨flushallå‘½ä»¤æ¸…ç©ºäº†æ‰€æœ‰æ•°æ®ï¼Œåªè¦è¿™ä¸ªæ—¶å€™åå°rewriteè¿˜æ²¡æœ‰å‘ç”Ÿï¼Œé‚£ä¹ˆå°±å¯ä»¥ç«‹å³æ‹·è´AOFæ–‡ä»¶ï¼Œå°†æœ€åä¸€æ¡flushallå‘½ä»¤ç»™åˆ äº†ï¼Œç„¶åå†å°†è¯¥AOFæ–‡ä»¶æ”¾å›å»ï¼Œå°±å¯ä»¥é€šè¿‡æ¢å¤æœºåˆ¶ï¼Œè‡ªåŠ¨æ¢å¤æ‰€æœ‰æ•°æ®</p><p>â‘¡ã€åŠ£åŠ¿</p><p>ï¼ˆ1ï¼‰å¯¹äºåŒä¸€ä»½æ•°æ®æ¥è¯´ï¼ŒAOFæ—¥å¿—æ–‡ä»¶é€šå¸¸æ¯”RDBæ•°æ®å¿«ç…§æ–‡ä»¶æ›´å¤§</p><p>ï¼ˆ2ï¼‰AOFå¼€å¯åï¼Œæ”¯æŒçš„å†™QPSä¼šæ¯”RDBæ”¯æŒçš„å†™QPSä½ï¼Œå› ä¸ºAOFä¸€èˆ¬ä¼šé…ç½®æˆæ¯ç§’fsyncä¸€æ¬¡æ—¥å¿—æ–‡ä»¶ï¼Œå½“ç„¶ï¼Œæ¯ç§’ä¸€æ¬¡fsyncï¼Œæ€§èƒ½ä¹Ÿè¿˜æ˜¯å¾ˆé«˜çš„</p><p>ï¼ˆ3ï¼‰ä»¥å‰AOFå‘ç”Ÿè¿‡bugï¼Œå°±æ˜¯é€šè¿‡AOFè®°å½•çš„æ—¥å¿—ï¼Œè¿›è¡Œæ•°æ®æ¢å¤çš„æ—¶å€™ï¼Œæ²¡æœ‰æ¢å¤ä¸€æ¨¡ä¸€æ ·çš„æ•°æ®å‡ºæ¥ã€‚</p><h2 id="RDBå’ŒAOFåˆ°åº•è¯¥å¦‚ä½•é€‰æ‹©">RDBå’ŒAOFåˆ°åº•è¯¥å¦‚ä½•é€‰æ‹©</h2><img src="/dajiangdahe.github.io/2021/10/22/Redis%E6%8C%81%E4%B9%85%E5%8C%96/8326cffc1e178a82c532308ef2117b8ba977e8ae.jpeg" class="" title="img">]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rediså†…å­˜ç­–ç•¥</title>
    <link href="/dajiangdahe/2021/10/22/Redis%E5%86%85%E5%AD%98%E7%AD%96%E7%95%A5/"/>
    <url>/dajiangdahe/2021/10/22/Redis%E5%86%85%E5%AD%98%E7%AD%96%E7%95%A5/</url>
    
    <content type="html"><![CDATA[<h1>Rediså†…å­˜æ·˜æ±°ç­–ç•¥</h1><p>å½“ redis çš„å†…å­˜ç©ºé—´ï¼ˆmaxmemory å‚æ•°é…ç½®ï¼‰å·²ç»ç”¨æ»¡æ—¶ï¼Œredis å°†æ ¹æ®é…ç½®çš„é©±é€ç­–ç•¥ï¼ˆmaxmemory-policy å‚æ•°é…ç½®ï¼‰ï¼Œè¿›è¡Œç›¸åº”çš„åŠ¨ä½œã€‚åœ¨redis4.0ä¹‹åï¼Œå¢åŠ äº†ä¸¤ç§åŸºäºLFUç®—æ³•å®ç°çš„å†…å­˜æ·˜æ±°ç­–ç•¥</p><ul><li><strong>noeviction</strong>ï¼šé»˜è®¤ç­–ç•¥ï¼Œä¸æ·˜æ±°ä»»ä½• keyï¼Œç›´æ¥è¿”å›é”™è¯¯</li><li><strong>allkeys</strong>-<strong>lru</strong>ï¼šåœ¨æ‰€æœ‰çš„ key ä¸­ï¼Œä½¿ç”¨ LRU ç®—æ³•æ·˜æ±°éƒ¨åˆ† key</li><li><strong>allkeys</strong>-<strong>lfu</strong>ï¼šåœ¨æ‰€æœ‰çš„ key ä¸­ï¼Œä½¿ç”¨ LFU ç®—æ³•æ·˜æ±°éƒ¨åˆ† keyï¼Œè¯¥ç®—æ³•äº Redis 4.0 æ–°å¢</li><li><strong>allkeys</strong>-<strong>random</strong>ï¼šåœ¨æ‰€æœ‰çš„ key ä¸­ï¼Œéšæœºæ·˜æ±°éƒ¨åˆ† key</li><li><strong>volatile</strong>-<strong>lru</strong>ï¼šåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ key ä¸­ï¼Œä½¿ç”¨ LRU ç®—æ³•æ·˜æ±°éƒ¨åˆ† key</li><li><strong>volatile</strong>-<strong>lfu</strong>ï¼šåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ key ä¸­ï¼Œä½¿ç”¨ LFU ç®—æ³•æ·˜æ±°éƒ¨åˆ† keyï¼Œè¯¥ç®—æ³•äº Redis 4.0 æ–°å¢</li><li><strong>volatile</strong>-<strong>random</strong>ï¼šåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ key ä¸­ï¼Œéšæœºæ·˜æ±°éƒ¨åˆ† key</li><li><strong>volatile</strong>-<strong>ttl</strong>ï¼šåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ key ä¸­ï¼ŒæŒ‘é€‰ TTLï¼ˆtime to liveï¼Œå‰©ä½™æ—¶é—´ï¼‰çŸ­çš„ key æ·˜æ±°</li></ul><h3 id="LRUç®—æ³•">LRUç®—æ³•</h3><p>åœ¨æ“ä½œç³»ç»Ÿä¸­<strong>LRU</strong>ç®—æ³•æ·˜æ±°çš„<strong>ä¸æ˜¯å†…å­˜ä¸­çš„å¯¹è±¡</strong>ï¼Œè€Œæ˜¯é¡µ,å½“å†…å­˜ä¸­æ•°æ®ä¸è¶³æ—¶ï¼Œé€šè¿‡LRUç®—æ³•ï¼Œé€‰æ‹©<strong>ä¸€é¡µ</strong>(ä¸€èˆ¬æ˜¯4KB)å°†å…¶äº¤æ¢åˆ°è™šæ‹Ÿå†…å­˜åŒº(<strong>Swap</strong>åŒº)ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRediséšæœºæŒ‘é€‰5ä¸ªé”®ï¼Œå¹¶ä¸”ä»ä¸­é€‰å–ä¸€ä¸ªæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„keyè¿›è¡Œæ·˜æ±°ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡maxmemory-samplesçš„å€¼æ¥è®¾ç½®rediséœ€è¦æ£€æŸ¥keyçš„ä¸ªæ•°,ä½†æ˜¯æ “æŸ¥çš„è¶Šå¤šï¼Œè€—è´¹çš„æ—¶é—´ä¹Ÿå°±è¶Šä¹…,ä½†æ˜¯ç»“æ„è¶Šç²¾ç¡®</p><p>è¯¦è§£ï¼š<a href="https://blog.csdn.net/kuizhu7142/article/details/81115750">https://blog.csdn.net/kuizhu7142/article/details/81115750</a></p><p>ã€<strong>å‘½ä¸­ç‡</strong>ã€‘</p><p>å½“å­˜åœ¨çƒ­ç‚¹æ•°æ®æ—¶ï¼ŒLRUçš„æ•ˆç‡å¾ˆå¥½ï¼Œä½†å¶å‘æ€§çš„ã€å‘¨æœŸæ€§çš„æ‰¹é‡æ“ä½œä¼šå¯¼è‡´LRUå‘½ä¸­ç‡æ€¥å‰§ä¸‹é™ï¼Œç¼“å­˜æ±¡æŸ“æƒ…å†µæ¯”è¾ƒä¸¥é‡ã€‚</p><p>ã€<strong>å¤æ‚åº¦</strong>ã€‘</p><p>å®ç°ç®€å•ã€‚</p><p>ã€<strong>ä»£ä»·</strong>ã€‘</p><p>å‘½ä¸­æ—¶éœ€è¦éå†é“¾è¡¨ï¼Œæ‰¾åˆ°å‘½ä¸­çš„æ•°æ®å—ç´¢å¼•ï¼Œç„¶åéœ€è¦å°†æ•°æ®ç§»åˆ°å¤´éƒ¨ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E7%AD%96%E7%95%A5/aHR0cDovL2ltYWdlcy5jbml0YmxvZy5jb20vYmxvZzIwMTUvNDcxNTMyLzIwMTUwMy8yNTE5NTQzNDk3NDIyMjAucG5n" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><ul><li>æœ€å¼€å§‹æ—¶ï¼Œå†…å­˜ç©ºé—´æ˜¯ç©ºçš„ï¼Œå› æ­¤ä¾æ¬¡è¿›å…¥Aã€Bã€Cæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</li><li>å½“åŠ å…¥Dæ—¶ï¼Œå°±å‡ºç°äº†é—®é¢˜ï¼Œå†…å­˜ç©ºé—´ä¸å¤Ÿäº†ï¼Œå› æ­¤æ ¹æ®LRUç®—æ³•ï¼Œå†…å­˜ç©ºé—´ä¸­Aå¾…çš„æ—¶é—´æœ€ä¸ºä¹…è¿œï¼Œé€‰æ‹©A,å°†å…¶æ·˜æ±°ã€‚</li><li>å½“å†æ¬¡å¼•ç”¨Bæ—¶ï¼Œå†…å­˜ç©ºé—´ä¸­çš„Båˆå¤„äºæ´»è·ƒçŠ¶æ€ï¼Œè€ŒCåˆ™å˜æˆäº†å†…å­˜ç©ºé—´ä¸­ï¼Œè¿‘æ®µæ—¶é—´æœ€ä¹…æœªä½¿ç”¨çš„ã€‚</li><li>å½“å†æ¬¡å‘å†…å­˜ç©ºé—´åŠ å…¥Eæ—¶ï¼Œè¿™æ—¶å†…å­˜ç©ºé—´åˆä¸è¶³äº†ï¼Œé€‰æ‹©åœ¨å†…å­˜ç©ºé—´ä¸­å¾…çš„æœ€ä¹…çš„Cå°†å…¶æ·˜æ±°å‡ºå†…å­˜ï¼Œè¿™æ—¶çš„å†…å­˜ç©ºé—´å­˜æ”¾çš„å¯¹è±¡å°±æ˜¯E-&gt;B-&gt;Dã€‚</li></ul><h4 id="å®ç°åŸç†">å®ç°åŸç†</h4><p>ä¼ ç»Ÿæ„ä¹‰çš„LRUç®—æ³•æ˜¯ä¸ºæ¯ä¸€ä¸ªCacheå¯¹è±¡è®¾ç½®ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯æ¬¡Cacheå‘½ä¸­åˆ™ç»™è®¡æ•°å™¨+1ï¼Œè€ŒCacheç”¨å®Œï¼Œéœ€è¦æ·˜æ±°æ—§å†…å®¹ï¼Œæ”¾ç½®æ–°å†…å®¹æ—¶ï¼Œå°±æŸ¥çœ‹æ‰€æœ‰çš„è®¡æ•°å™¨ï¼Œå¹¶å°†æœ€å°‘ä½¿ç”¨çš„å†…å®¹æ›¿æ¢æ‰ã€‚</p><p>å®ƒçš„å¼Šç«¯å¾ˆæ˜æ˜¾ï¼Œå¦‚æœCacheçš„æ•°é‡å°‘ï¼Œé—®é¢˜ä¸ä¼šå¾ˆå¤§ï¼Œ ä½†æ˜¯å¦‚æœCacheçš„ç©ºé—´è¿‡å¤§ï¼Œè¾¾åˆ°10Wæˆ–è€…100Wä»¥ä¸Šï¼Œä¸€æ—¦éœ€è¦æ·˜æ±°ï¼Œåˆ™éœ€è¦éå†æ‰€æœ‰è®¡ç®—å™¨ï¼Œå…¶æ€§èƒ½ä¸èµ„æºæ¶ˆè€—æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿå°±éå¸¸çš„æ…¢äº†ã€‚</p><p>å®ƒçš„åŸç†ï¼š å°†Cacheçš„æ‰€æœ‰ä½ç½®éƒ½ç”¨åŒè¿è¡¨è¿æ¥èµ·æ¥ï¼Œå½“ä¸€ä¸ªä½ç½®è¢«å‘½ä¸­ä¹‹åï¼Œå°±å°†é€šè¿‡è°ƒæ•´é“¾è¡¨çš„æŒ‡å‘ï¼Œå°†è¯¥ä½ç½®è°ƒæ•´åˆ°é“¾è¡¨å¤´çš„ä½ç½®ï¼Œæ–°åŠ å…¥çš„Cacheç›´æ¥åŠ åˆ°é“¾è¡¨å¤´ä¸­ã€‚</p><p>è¿™æ ·ï¼Œåœ¨å¤šæ¬¡è¿›è¡ŒCacheæ“ä½œåï¼Œæœ€è¿‘è¢«å‘½ä¸­çš„ï¼Œå°±ä¼šè¢«å‘é“¾è¡¨å¤´æ–¹å‘ç§»åŠ¨ï¼Œè€Œæ²¡æœ‰å‘½ä¸­çš„ï¼Œè€Œæƒ³é“¾è¡¨åé¢ç§»åŠ¨ï¼Œé“¾è¡¨å°¾åˆ™è¡¨ç¤ºæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„Cacheã€‚</p><p>å½“éœ€è¦æ›¿æ¢å†…å®¹æ—¶å€™ï¼Œé“¾è¡¨çš„æœ€åä½ç½®å°±æ˜¯æœ€å°‘è¢«å‘½ä¸­çš„ä½ç½®ï¼Œæˆ‘ä»¬åªéœ€è¦æ·˜æ±°é“¾è¡¨æœ€åçš„éƒ¨åˆ†å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LRUCache</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LinkedHashMap</span>&lt;<span class="hljs-title">Integer</span>, <span class="hljs-title">Integer</span>&gt;</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> capacity;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LRUCache</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(capacity, <span class="hljs-number">0.75F</span>, <span class="hljs-keyword">true</span>);<br>        <span class="hljs-keyword">this</span>.capacity = capacity;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.getOrDefault(key, -<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key, <span class="hljs-keyword">int</span> value)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>.put(key, value);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">removeEldestEntry</span><span class="hljs-params">(Map.Entry&lt;Integer, Integer&gt; eldest)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> size() &gt; capacity; <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LRUCache</span> </span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DLinkedNode</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> key;<br>        <span class="hljs-keyword">int</span> value;<br>        DLinkedNode prev;<br>        DLinkedNode next;<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DLinkedNode</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DLinkedNode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> _key, <span class="hljs-keyword">int</span> _value)</span> </span>&#123;key = _key; value = _value;&#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> Map&lt;Integer, DLinkedNode&gt; cache = <span class="hljs-keyword">new</span> HashMap&lt;Integer, DLinkedNode&gt;();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> size;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> capacity;<br>    <span class="hljs-keyword">private</span> DLinkedNode head, tail;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LRUCache</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.size = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">this</span>.capacity = capacity;<br>        <span class="hljs-comment">// ä½¿ç”¨ä¼ªå¤´éƒ¨å’Œä¼ªå°¾éƒ¨èŠ‚ç‚¹</span><br>        head = <span class="hljs-keyword">new</span> DLinkedNode();<br>        tail = <span class="hljs-keyword">new</span> DLinkedNode();<br>        head.next = tail;<br>        tail.prev = head;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key)</span> </span>&#123;<br>        DLinkedNode node = cache.get(key);<br>        <span class="hljs-keyword">if</span> (node == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-comment">// å¦‚æœ key å­˜åœ¨ï¼Œå…ˆé€šè¿‡å“ˆå¸Œè¡¨å®šä½ï¼Œå†ç§»åˆ°å¤´éƒ¨</span><br>        moveToHead(node);<br>        <span class="hljs-keyword">return</span> node.value;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key, <span class="hljs-keyword">int</span> value)</span> </span>&#123;<br>        DLinkedNode node = cache.get(key);<br>        <span class="hljs-keyword">if</span> (node == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">// å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹</span><br>            DLinkedNode newNode = <span class="hljs-keyword">new</span> DLinkedNode(key, value);<br>            <span class="hljs-comment">// æ·»åŠ è¿›å“ˆå¸Œè¡¨</span><br>            cache.put(key, newNode);<br>            <span class="hljs-comment">// æ·»åŠ è‡³åŒå‘é“¾è¡¨çš„å¤´éƒ¨</span><br>            addToHead(newNode);<br>            ++size;<br>            <span class="hljs-keyword">if</span> (size &gt; capacity) &#123;<br>                <span class="hljs-comment">// å¦‚æœè¶…å‡ºå®¹é‡ï¼Œåˆ é™¤åŒå‘é“¾è¡¨çš„å°¾éƒ¨èŠ‚ç‚¹</span><br>                DLinkedNode tail = removeTail();<br>                <span class="hljs-comment">// åˆ é™¤å“ˆå¸Œè¡¨ä¸­å¯¹åº”çš„é¡¹</span><br>                cache.remove(tail.key);<br>                --size;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// å¦‚æœ key å­˜åœ¨ï¼Œå…ˆé€šè¿‡å“ˆå¸Œè¡¨å®šä½ï¼Œå†ä¿®æ”¹ valueï¼Œå¹¶ç§»åˆ°å¤´éƒ¨</span><br>            node.value = value;<br>            moveToHead(node);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addToHead</span><span class="hljs-params">(DLinkedNode node)</span> </span>&#123;<br>        node.prev = head;<br>        node.next = head.next;<br>        head.next.prev = node;<br>        head.next = node;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeNode</span><span class="hljs-params">(DLinkedNode node)</span> </span>&#123;<br>        node.prev.next = node.next;<br>        node.next.prev = node.prev;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">moveToHead</span><span class="hljs-params">(DLinkedNode node)</span> </span>&#123;<br>        removeNode(node);<br>        addToHead(node);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> DLinkedNode <span class="hljs-title">removeTail</span><span class="hljs-params">()</span> </span>&#123;<br>        DLinkedNode res = tail.prev;<br>        removeNode(res);<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="LFUç®—æ³•">LFUç®—æ³•</h2><p>LFUï¼ˆLeast Frequently Usedï¼‰ç®—æ³•ï¼Œå³æœ€å°‘è®¿é—®ç®—æ³•ï¼Œæ ¹æ®è®¿é—®ç¼“å­˜çš„å†å²é¢‘ç‡æ¥æ·˜æ±°æ•°æ®ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®åœ¨è¿‡å»ä¸€æ®µæ—¶é—´è¢«è®¿é—®çš„æ¬¡æ•°å¾ˆå°‘ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„æ¦‚ç‡ä¹Ÿä¼šå¾ˆä½â€ã€‚å¦‚æœä¸¤ä¸ªå…ƒç´ çš„è®¿é—®é¢‘ç‡ç›¸åŒï¼Œåˆ™æ·˜æ±°æœ€ä¹…æ²¡è¢«è®¿é—®çš„å…ƒç´ ã€‚ä¹Ÿå°±æ˜¯è¯´LFUæ·˜æ±°çš„æ—¶å€™ä¼šé€‰æ‹©ä¸¤ä¸ªç»´åº¦ï¼Œå…ˆæ¯”è¾ƒé¢‘ç‡ï¼Œé€‰æ‹©è®¿é—®é¢‘ç‡æœ€å°çš„å…ƒç´ ï¼›å¦‚æœé¢‘ç‡ç›¸åŒï¼Œåˆ™æŒ‰æ—¶é—´ç»´åº¦æ·˜æ±°æ‰æœ€ä¹…è¿œçš„é‚£ä¸ªå…ƒç´ ã€‚</p><p>ä¸€èˆ¬ä¼šç»´æŠ¤ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼š</p><ul><li><p>å“ˆå¸Œï¼šç”¨æ¥æä¾›å¯¹å¤–éƒ¨çš„è®¿é—®ï¼ŒæŸ¥è¯¢æ•ˆç‡æ›´é«˜ï¼›</p></li><li><p>åŒå‘é“¾è¡¨æˆ–é˜Ÿåˆ—ï¼šç»´æŠ¤äº†å¯¹å…ƒç´ è®¿é—®æ¬¡æ•°çš„æ’åº</p><p>ç¼“å­˜æ“ä½œå¯¼è‡´çš„é“¾è¡¨å˜åŒ–ï¼š</p></li><li><p>æ·»åŠ æ–°å…ƒç´ ï¼šæ–°å…ƒç´ è®¿é—®æ¬¡æ•°ä¸º1ï¼Œæ”¾åˆ°é˜Ÿå°¾ï¼›</p></li><li><p>ç¼“å­˜æ·˜æ±°ï¼šä»é˜Ÿå°¾å¼€å§‹æ·˜æ±°ï¼Œå› ä¸ºé˜Ÿå°¾å…ƒç´ çš„è®¿é—®æ¬¡æ•°æœ€å°‘ï¼›</p></li><li><p>è®¿é—®ç¼“å­˜ï¼šè®¿é—®ç¼“å­˜ä¼šå¢åŠ å…ƒç´ çš„è®¿é—®æ¬¡æ•°ï¼Œæ‰€ä»¥å…ƒç´ åœ¨é˜Ÿåˆ—æˆ–åŒå‘é“¾è¡¨ä¸­çš„ä½ç½®ä¼šé‡æ–°æ’åº</p></li></ul><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E7%AD%96%E7%95%A5/93e8e91e143ea01757667be4b54e4a10.png" class="" title="img"><p>è¿™é‡Œçš„keyå°±æ˜¯è¾“å…¥çš„keyï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚<strong>å…³é”®æ˜¯value</strong>ï¼Œå®ƒçš„valueä¸æ˜¯ä¸€ä¸ªç®€å•çš„valueï¼Œè€Œæ˜¯ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡ã€‚èŠ‚ç‚¹å¯¹è±¡<strong>Node</strong>åŒ…å«äº†<strong>keyï¼Œvalueï¼Œä»¥åŠé¢‘ç‡</strong>ï¼Œè¿™ä¸ªNodeåˆä¼šå‡ºç°åœ¨ç¬¬äºŒä¸ªå“ˆå¸Œè¡¨çš„valueä¸­(ç­‰ä¼šæˆ‘ä»¬å†è¯´)ã€‚è‡³äºä¸ºä»€ä¹ˆNodeä¸­åˆé‡å¤åŒ…å«äº†keyï¼Œå› ä¸ºæŸäº›æƒ…å†µä¸‹æˆ‘ä»¬ä¸æ˜¯é€šè¿‡k-vå“ˆå¸Œè¡¨æ‹¿åˆ°Nodeçš„ï¼Œè€Œæ˜¯é€šè¿‡å…¶ä»–æ–¹å¼è·å¾—äº†Nodeï¼Œä¹‹åéœ€è¦ç”¨Nodeä¸­çš„keyåå‘å»k-vå“ˆå¸Œè¡¨ä¸­åšä¸€äº›æ“ä½œï¼Œæ‰€ä»¥Nodeä¸­åŒ…å«äº†ä¸€äº›å†—ä½™ä¿¡æ¯ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E7%AD%96%E7%95%A5/23d1c0e3501b4b82b5eca0b9a631dc18.png" class="" title="img"><p>è¿™å¼ <strong>å“ˆå¸Œè¡¨ä¸­çš„keyæ˜¯é¢‘ç‡</strong>ï¼Œä¹Ÿå°±æ˜¯å…ƒç´ è¢«è®¿é—®çš„é¢‘ç‡(è¢«è®¿é—®äº†1æ¬¡ï¼Œè¢«è®¿é—®äº†ä¸¤æ¬¡ç­‰ç­‰)ï¼Œ<strong>å®ƒçš„valueæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨åˆšæ‰è¯´çš„Nodeå¯¹è±¡ï¼Œç°åœ¨åˆå‡ºç°äº†ï¼Œè¿™é‡Œçš„Nodeå…¶å®æ˜¯åŒå‘é“¾è¡¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹</strong>ã€‚ç¬¬ä¸€å¼ å›¾ä¸­æˆ‘ä»¬è¯´äº†Nodeä¸­åŒ…å«äº†ä¸€ä¸ªå†—ä½™çš„keyï¼Œå…¶å®å®ƒè¿˜åŒ…å«äº†ä¸€ä¸ªå†—ä½™çš„é¢‘ç‡å€¼ï¼Œå› ä¸ºæŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡Nodeä¸­çš„é¢‘ç‡å€¼ï¼Œåå‘å»é¢‘ç‡å“ˆå¸Œè¡¨ä¸­åšæŸ¥æ‰¾ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦ä¸€ä¸ªå†—ä½™çš„é¢‘ç‡å€¼ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E7%AD%96%E7%95%A5/c5bf76ee14075961a202f8dbf6dcb6b2.png" class="" title="img"><ul><li>ä¼˜ç‚¹ ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒLFUæ•ˆç‡è¦ä¼˜äºLRUï¼Œèƒ½å¤Ÿé¿å…å‘¨æœŸæ€§æˆ–è€…å¶å‘æ€§çš„æ“ä½œå¯¼è‡´ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™çš„é—®é¢˜ã€‚</li><li>ç¼ºç‚¹ï¼š<strong>å¤æ‚åº¦è¾ƒé«˜</strong>ï¼šéœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—æˆ–åŒå‘é“¾è¡¨ï¼Œå¤æ‚åº¦è¾ƒé«˜ã€‚<ul><li><strong>å¯¹æ–°ç¼“å­˜ä¸å‹å¥½</strong>ï¼šæ–°åŠ å…¥çš„ç¼“å­˜å®¹æ˜“è¢«æ¸…ç†æ‰ï¼Œå³ä½¿å¯èƒ½ä¼šè¢«ç»å¸¸è®¿é—®</li><li><strong>ç¼“å­˜æ±¡æŸ“</strong>ï¼šä¸€æ—¦ç¼“å­˜çš„è®¿é—®æ¨¡å¼å‘ç”Ÿå˜åŒ–ï¼Œè®¿é—®è®°å½•çš„å†å²å­˜é‡ï¼Œä¼šå¯¼è‡´ç¼“å­˜æ±¡æŸ“ï¼›</li><li><strong>å†…å­˜å¼€é”€</strong>ï¼šéœ€è¦å¯¹æ¯ä¸€é¡¹ç¼“å­˜æ•°æ®ç»´æŠ¤ä¸€ä¸ªè®¿é—®æ¬¡æ•°ï¼Œå†…å­˜æˆæœ¬è¾ƒå¤§ï¼›</li><li><strong>å¤„ç†å™¨å¼€é”€</strong>ï¼šéœ€è¦å¯¹è®¿é—®æ¬¡æ•°æ’åºï¼Œä¼šå¢åŠ ä¸€å®šçš„å¤„ç†å™¨å¼€é”€</li></ul></li></ul><h3 id="ç®—æ³•å®ç°">ç®—æ³•å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LFUCache</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> minfreq, capacity;<br>    Map&lt;Integer, Node&gt; key_table;<br>    Map&lt;Integer, LinkedList&lt;Node&gt;&gt; freq_table;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LFUCache</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.minfreq = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">this</span>.capacity = capacity;<br>        key_table = <span class="hljs-keyword">new</span> HashMap&lt;Integer, Node&gt;();;<br>        freq_table = <span class="hljs-keyword">new</span> HashMap&lt;Integer, LinkedList&lt;Node&gt;&gt;();<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (capacity == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!key_table.containsKey(key)) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125;<br>        Node node = key_table.get(key);<br>        <span class="hljs-keyword">int</span> val = node.val, freq = node.freq;<br>        freq_table.get(freq).remove(node);<br>        <span class="hljs-comment">// å¦‚æœå½“å‰é“¾è¡¨ä¸ºç©ºï¼Œæˆ‘ä»¬éœ€è¦åœ¨å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œä¸”æ›´æ–°minFreq</span><br>        <span class="hljs-keyword">if</span> (freq_table.get(freq).size() == <span class="hljs-number">0</span>) &#123;<br>            freq_table.remove(freq);<br>            <span class="hljs-keyword">if</span> (minfreq == freq) &#123;<br>                minfreq += <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// æ’å…¥åˆ° freq + 1 ä¸­</span><br>        LinkedList&lt;Node&gt; list = freq_table.getOrDefault(freq + <span class="hljs-number">1</span>, <span class="hljs-keyword">new</span> LinkedList&lt;Node&gt;());<br>        list.offerFirst(<span class="hljs-keyword">new</span> Node(key, val, freq + <span class="hljs-number">1</span>));<br>        freq_table.put(freq + <span class="hljs-number">1</span>, list);<br>        key_table.put(key, freq_table.get(freq + <span class="hljs-number">1</span>).peekFirst());<br>        <span class="hljs-keyword">return</span> val;<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key, <span class="hljs-keyword">int</span> value)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (capacity == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!key_table.containsKey(key)) &#123;<br>            <span class="hljs-comment">// ç¼“å­˜å·²æ»¡ï¼Œéœ€è¦è¿›è¡Œåˆ é™¤æ“ä½œ</span><br>            <span class="hljs-keyword">if</span> (key_table.size() == capacity) &#123;<br>                <span class="hljs-comment">// é€šè¿‡ minFreq æ‹¿åˆ° freq_table[minFreq] é“¾è¡¨çš„æœ«å°¾èŠ‚ç‚¹</span><br>                Node node = freq_table.get(minfreq).peekLast();<br>                key_table.remove(node.key);<br>                freq_table.get(minfreq).pollLast();<br>                <span class="hljs-keyword">if</span> (freq_table.get(minfreq).size() == <span class="hljs-number">0</span>) &#123;<br>                    freq_table.remove(minfreq);<br>                &#125;<br>            &#125;<br>            LinkedList&lt;Node&gt; list = freq_table.getOrDefault(<span class="hljs-number">1</span>, <span class="hljs-keyword">new</span> LinkedList&lt;Node&gt;());<br>            list.offerFirst(<span class="hljs-keyword">new</span> Node(key, value, <span class="hljs-number">1</span>));<br>            freq_table.put(<span class="hljs-number">1</span>, list);<br>            key_table.put(key, freq_table.get(<span class="hljs-number">1</span>).peekFirst());<br>            minfreq = <span class="hljs-number">1</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// ä¸ get æ“ä½œåŸºæœ¬ä¸€è‡´ï¼Œé™¤äº†éœ€è¦æ›´æ–°ç¼“å­˜çš„å€¼</span><br>            Node node = key_table.get(key);<br>            <span class="hljs-keyword">int</span> freq = node.freq;<br>            freq_table.get(freq).remove(node);<br>            <span class="hljs-keyword">if</span> (freq_table.get(freq).size() == <span class="hljs-number">0</span>) &#123;<br>                freq_table.remove(freq);<br>                <span class="hljs-keyword">if</span> (minfreq == freq) &#123;<br>                    minfreq += <span class="hljs-number">1</span>;<br>                &#125;<br>            &#125;<br>            LinkedList&lt;Node&gt; list = freq_table.getOrDefault(freq + <span class="hljs-number">1</span>, <span class="hljs-keyword">new</span> LinkedList&lt;Node&gt;());<br>            list.offerFirst(<span class="hljs-keyword">new</span> Node(key, value, freq + <span class="hljs-number">1</span>));<br>            freq_table.put(freq + <span class="hljs-number">1</span>, list);<br>            key_table.put(key, freq_table.get(freq + <span class="hljs-number">1</span>).peekFirst());<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> key, val, freq;<br><br>    Node(<span class="hljs-keyword">int</span> key, <span class="hljs-keyword">int</span> val, <span class="hljs-keyword">int</span> freq) &#123;<br>        <span class="hljs-keyword">this</span>.key = key;<br>        <span class="hljs-keyword">this</span>.val = val;<br>        <span class="hljs-keyword">this</span>.freq = freq;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1>Redisè¿‡æœŸé”®åˆ é™¤ç­–ç•¥</h1><p><strong>Redisä¸­å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„keyæ˜¯ä¿å­˜åœ¨ä¸€ä¸ªå­—å…¸ä¸­ï¼ˆè¿™ä¸ªå­—å…¸å«åš==è¿‡æœŸå­—å…¸==ï¼‰ï¼Œä»¥åä¼šå®šæ—¶éå†è¿™ä¸ªå­—å…¸ï¼Œåˆ é™¤è¿‡æœŸçš„keyã€‚</strong></p><p><strong>æ£€æŸ¥è¿‡æœŸæ—¶é—´ï¼šttl key</strong></p><ol><li><p>æŸ¥çœ‹è¿‡æœŸæ—¶é—´ ttl key( è¿”å›å€¼   -1:å½“å‰keyæ²¡æœ‰è¿‡æœŸæ—¶é—´   &gt;0:å½“å‰keyçš„å‰©ä½™å­˜æ´»æ—¶é—´  -2:å½“å‰keyä¸å­˜åœ¨)</p></li><li><p>åˆ é™¤è¿‡æœŸæ—¶é—´ persist key   æŠŠå¸¦æœ‰è¿‡æœŸæ—¶é—´çš„keyå˜ä¸ºæ°¸ä¹…ä¸è¿‡æœŸï¼ˆè¿”å›å€¼   1ä»£è¡¨åˆ é™¤è¿‡æœŸæ—¶é—´æˆåŠŸ     0ä»£è¡¨å½“å‰keyæ²¡è¿‡æœŸæ—¶é—´ or keyä¸å­˜åœ¨ï¼‰</p></li></ol><h2 id="1-å®šæ—¶åˆ é™¤">1.å®šæ—¶åˆ é™¤</h2><p>åœ¨è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´çš„åŒæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼ˆtimerï¼‰ï¼Œè®©å®šæ—¶å™¨åœ¨é”®çš„è¿‡æœŸæ—¶é—´æ¥ä¸´æ—¶ï¼Œç«‹å³æ‰§è¡Œå¯¹é”®çš„åˆ é™¤æ“ä½œã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¯¹å†…å­˜æ˜¯æœ€å‹å¥½çš„ï¼šé€šè¿‡ä½¿ç”¨å®šæ—¶å™¨ï¼Œå®šæ—¶åˆ é™¤ç­–ç•¥å¯ä»¥ä¿è¯è¿‡æœŸé”®ä¼šå°½ å¯èƒ½å¿«åœ°è¢«åˆ é™¤ï¼Œå¹¶é‡Šæ”¾è¿‡æœŸé”®æ‰€å ç”¨çš„å†…å­˜</li><li><strong>ç¼ºç‚¹</strong>ï¼šå®ƒå¯¹CPUæ—¶é—´æ˜¯æœ€ä¸å‹å¥½çš„ï¼šåœ¨è¿‡æœŸé”®æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œåˆ é™¤è¿‡æœŸé”®è¿™ä¸€è¡Œä¸ºå¯èƒ½ä¼šå ç”¨ç›¸å½“ä¸€éƒ¨åˆ†CPUæ—¶é—´ï¼Œåœ¨å†…å­˜ä¸ç´§å¼ ä½†æ˜¯CPUæ—¶é—´éå¸¸ç´§å¼ çš„æƒ…å†µä¸‹ï¼Œå°†CPUæ—¶é—´ç”¨åœ¨åˆ é™¤å’Œå½“å‰ä»»åŠ¡æ— å…³çš„è¿‡æœŸé”®ä¸Šï¼Œæ— ç–‘ä¼šå¯¹æœåŠ¡å™¨çš„å“åº”æ—¶é—´å’Œååé‡é€ æˆå½±å“åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨éœ€è¦ç”¨åˆ°RedisæœåŠ¡å™¨ä¸­çš„æ—¶é—´äº‹ä»¶ï¼Œè€Œå½“å‰æ—¶é—´äº‹ä»¶çš„å®ç°æ–¹å¼â€”â€”æ— åºé“¾è¡¨ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªäº‹ä»¶çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(N)â€”â€”å¹¶ä¸èƒ½é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ—¶é—´ äº‹ä»¶</li></ul><h2 id="2-æƒ°æ€§åˆ é™¤">2.æƒ°æ€§åˆ é™¤</h2><p><strong>æ¯æ¬¡ä»é”®ç©ºé—´è·å–é”®æ—¶ï¼Œéƒ½æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸåˆ™åˆ é™¤ï¼Œæœªè¿‡æœŸï¼Œåˆ™è¿”å›è¯¥é”®</strong></p><p>åªæœ‰å–å‡ºé”®æ—¶æ‰å¯¹å…¶è¿›è¡Œè¿‡æœŸæ£€æŸ¥ï¼Œä¸ä¼šåˆ é™¤å…¶ä»–é”®ï¼Œä¸ä¼šèŠ±è´¹CPUå¤ªå¤šæ—¶é—´ã€‚è‹¥ä¸€ä¸ªé”®æ—©å·²è¿‡æœŸï¼Œä½†ä¸€ç›´æœªè¢«å–åˆ°ï¼Œå®ƒä¾¿ä¼šä¸€ç›´å ç”¨å†…å­˜ã€‚è‹¥æœ‰å¤§é‡çš„æœªè¢«è®¿é—®çš„é”®ï¼Œè€ŒæœåŠ¡å™¨åˆä¸ä¼šä¸»åŠ¨é‡Šæ”¾ï¼Œå°±ä¼šé€ æˆå¤§é‡çš„å†…å­˜æµªè´¹ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¯¹CPUæ—¶é—´æ¥è¯´æ˜¯æœ€å‹å¥½çš„ï¼šç¨‹åºåªä¼šåœ¨å–å‡ºé”®æ—¶æ‰å¯¹é”®è¿›è¡Œè¿‡æœŸæ£€æŸ¥ï¼Œ<br>è¿™å¯ä»¥ä¿è¯åˆ é™¤è¿‡æœŸé”®çš„æ“ä½œåªä¼šåœ¨éåšä¸å¯çš„æƒ…å†µä¸‹è¿›è¡Œï¼Œå¹¶ä¸”åˆ é™¤çš„ç›®æ ‡ä»…é™äºå½“å‰å¤„ç†çš„é”®ï¼Œè¿™ä¸ªç­–ç•¥ä¸ä¼šåœ¨åˆ é™¤å…¶ä»–æ— å…³çš„è¿‡æœŸé”®ä¸ŠèŠ±è´¹ä»»ä½•CPUæ—¶é—´</li><li><strong>ç¼ºç‚¹</strong>ï¼šå®ƒå¯¹å†…å­˜æ˜¯æœ€ä¸å‹å¥½çš„ï¼šå¦‚æœä¸€ä¸ªé”®å·²ç»è¿‡æœŸï¼Œè€Œè¿™ä¸ªé”®åˆä» ç„¶ä¿ç•™åœ¨æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆåªè¦è¿™ä¸ªè¿‡æœŸé”®ä¸è¢«åˆ é™¤ï¼Œå®ƒæ‰€å ç”¨çš„å†…å­˜å°±ä¸ä¼šé‡Šæ”¾ã€‚<br>ä¾‹å¦‚ï¼šåœ¨ä½¿ç”¨æƒ°æ€§åˆ é™¤ç­–ç•¥æ—¶ï¼Œå¦‚æœæ•°æ®åº“ä¸­æœ‰éå¸¸å¤šçš„è¿‡æœŸé”®ï¼Œè€Œè¿™äº›è¿‡æœŸé”®åˆæ°å¥½æ²¡æœ‰è¢«è®¿é—®åˆ°çš„è¯ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹Ÿè®¸æ°¸è¿œä¹Ÿä¸ä¼šè¢«åˆ é™¤ï¼ˆé™¤éç”¨æˆ·æ‰‹åŠ¨æ‰§è¡ŒFLUSHDBï¼‰ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å°†è¿™ç§æƒ…å†µçœ‹ä½œæ˜¯ä¸€ç§å†…å­˜æ³„æ¼â€”â€”æ— ç”¨çš„åƒåœ¾æ•°æ®å ç”¨äº†å¤§é‡çš„å†…å­˜ï¼Œè€ŒæœåŠ¡å™¨å´ä¸ ä¼šè‡ªå·±å»é‡Šæ”¾å®ƒä»¬ï¼Œè¿™å¯¹äºè¿è¡ŒçŠ¶æ€éå¸¸ä¾èµ–äºå†…å­˜çš„RedisæœåŠ¡å™¨æ¥è¯´ï¼Œè‚¯å®šä¸æ˜¯ä¸€ä¸ªå¥½æ¶ˆæ¯</li></ul><h3 id="å®ç°åŸç†ï¼ˆexpireIfNeededå‡½æ•°ï¼‰">å®ç°åŸç†ï¼ˆexpireIfNeededå‡½æ•°ï¼‰</h3><p><strong>expireIfNeeded</strong>å‡½æ•°å°±åƒä¸€ä¸ª<strong>è¿‡æ»¤å™¨</strong>ï¼Œå®ƒå¯ä»¥==åœ¨å‘½ä»¤çœŸæ­£æ‰§è¡Œä¹‹å‰ï¼Œè¿‡æ»¤æ‰è¿‡æœŸçš„è¾“å…¥é”®ï¼Œä»è€Œé¿å…å‘½ä»¤æ¥è§¦åˆ°è¿‡æœŸé”®== ã€‚æƒ°æ€§åˆ é™¤ç­–ç•¥ç”±db.c/expireIfNeededå‡½æ•°å®ç°ï¼Œæ‰€æœ‰è¯»å†™æ•°æ®åº“çš„Rediså‘½ä»¤åœ¨æ‰§è¡Œä¹‹å‰éƒ½ä¼šè°ƒç”¨<strong>expireIfNeeded</strong>å‡½æ•°å¯¹è¾“å…¥é”®è¿›è¡Œæ£€æŸ¥ï¼š</p><ul><li><p>å¦‚æœè¾“å…¥é”®å·²ç»è¿‡æœŸï¼Œé‚£ä¹ˆexpireIfNeededå‡½æ•°å°†è¾“å…¥é”®ä»æ•°æ®åº“ä¸­åˆ é™¤</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E7%AD%96%E7%95%A5/20201204131000785.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li><li><p>å¦‚æœè¾“å…¥é”®æœªè¿‡æœŸï¼Œé‚£ä¹ˆexpireIfNeededå‡½æ•°ä¸åšåŠ¨ä½œã€‚å› ä¸ºæ¯ä¸ªè¢«è®¿é—®çš„é”®éƒ½å¯èƒ½å› ä¸ºè¿‡æœŸè€Œè¢«expireIfNeededå‡½æ•°åˆ é™¤ï¼Œæ‰€ä»¥æ¯ä¸ªå‘½ä»¤çš„å®ç°å‡½æ•°<strong>éƒ½å¿…é¡»èƒ½åŒæ—¶å¤„ç†é”®å­˜åœ¨ä»¥åŠé”®ä¸å­˜åœ¨è¿™ä¸¤ç§æƒ…å†µ</strong>ï¼š</p></li><li><p>å½“é”®å­˜åœ¨æ—¶ï¼Œå‘½ä»¤æŒ‰ç…§é”®å­˜åœ¨çš„æƒ…å†µæ‰§è¡Œ</p></li><li><p>å½“é”®ä¸å­˜åœ¨æˆ–è€…é”®å› ä¸ºè¿‡æœŸè€Œè¢«expireIfNeededå‡½æ•°åˆ é™¤æ—¶ï¼Œå‘½ä»¤æŒ‰ç…§é”®ä¸å­˜åœ¨çš„æƒ…å†µæ‰§è¡Œ</p></li></ul><p><strong>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹å›¾å±•ç¤ºäº†GETå‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå‘½ä»¤éœ€è¦åˆ¤æ–­é”®æ˜¯å¦å­˜åœ¨ä»¥åŠé”®æ˜¯å¦è¿‡æœŸï¼Œç„¶åæ ¹æ®åˆ¤æ–­æ¥æ‰§è¡Œåˆé€‚çš„åŠ¨ä½œ</strong></p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E7%AD%96%E7%95%A5/20201204131056907.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><h2 id="3-å®šæœŸåˆ é™¤">3.å®šæœŸåˆ é™¤</h2><p><strong>æ¯éš”ä¸€æ®µæ—¶é—´åˆ é™¤é‡Œé¢çš„è¿‡æœŸé”®</strong></p><p>Redisé»˜è®¤ä¼š1ç§’è¿›è¡Œ10æ¬¡è¿‡æœŸæ‰«æï¼Œè¿‡æœŸæ‰«æä¸ä¼šéå†å­—å…¸ä¸­æ‰€æœ‰çš„keyï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€ç§è´ªå¿ƒçš„ç­–ç•¥ã€‚</p><ol><li>ä»å­—å…¸ä¸­éšæœºé€‰å‡º20ä¸ªkeyã€‚</li><li>åˆ é™¤è¿™20ä¸ªkeyä¸­è¿‡æœŸçš„keyã€‚</li><li>å¦‚æœè¿‡æœŸçš„keyæ¯”ä¾‹è¶…è¿‡1/4ï¼Œé‚£å°±åœ¨è¿›è¡Œæ­¥éª¤1.</li><li>åŒæ—¶ï¼Œä¸ºäº†ä¿è¯æ‰«æä¸ä¼šå‡ºç°å¾ªç¯è¿‡åº¦ï¼Œå¯¼è‡´çº¿ç¨‹å¡æ­»çš„ç°è±¡ï¼Œç®—æ³•ä¼šè®¾ç½®æ‰«ææ—¶é—´çš„ä¸Šé™ï¼Œé»˜è®¤ä¸º25msã€‚</li></ol><ul><li><p><strong>ä¼˜ç‚¹</strong>ï¼šå®šæœŸåˆ é™¤ç­–ç•¥æ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡åˆ é™¤è¿‡æœŸé”®æ“ä½œï¼Œå¹¶é€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿ å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹CPUæ—¶é—´çš„å½±å“ã€‚é€šè¿‡å®šæœŸåˆ é™¤è¿‡æœŸé”®ï¼Œå®šæœŸåˆ é™¤ç­–ç•¥æœ‰æ•ˆåœ°å‡å°‘äº†å› ä¸ºè¿‡æœŸé”®è€Œå¸¦æ¥çš„å†…å­˜æµªè´¹ã€‚</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šå¦‚æœåˆ é™¤æ“ä½œæ‰§è¡Œå¾—å¤ªé¢‘ç¹ï¼Œæˆ–è€…æ‰§è¡Œçš„æ—¶é—´å¤ªé•¿ï¼Œå®šæœŸåˆ é™¤ç­–ç•¥å°±ä¼šé€€åŒ–æˆå®šæ—¶åˆ é™¤ç­–ç•¥ï¼Œä»¥è‡³äºå°†CPUæ—¶é—´è¿‡å¤šåœ°æ¶ˆè€—åœ¨åˆ é™¤è¿‡æœŸé”®ä¸Šé¢ã€‚å¦‚æœåˆ é™¤æ“ä½œæ‰§è¡Œå¾—å¤ªå°‘ï¼Œæˆ–è€…æ‰§è¡Œçš„æ—¶é—´å¤ªçŸ­ï¼Œå®šæœŸåˆ é™¤ç­–ç•¥åˆä¼šå’Œæƒ°æ€§åˆ é™¤ç­–ç•¥ä¸€ æ ·ï¼Œå‡ºç°æµªè´¹å†…å­˜çš„æƒ…å†µã€‚</p></li></ul><h3 id="å®ç°åŸç†ï¼ˆactiveExpireCycleå‡½æ•°ï¼‰">å®ç°åŸç†ï¼ˆactiveExpireCycleå‡½æ•°ï¼‰</h3><p>è¿‡æœŸé”®çš„å®šæœŸåˆ é™¤ç­–ç•¥ç”±redis.c/activeExpireCycleå‡½æ•°å®ç°ï¼Œæ¯å½“Redisçš„æœåŠ¡å™¨å‘¨æœŸæ€§æ“ä½œredis.c/serverCronå‡½æ•°æ‰§è¡Œæ—¶ï¼ŒactiveExpireCycleå‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œå®ƒåœ¨è§„å®šçš„æ—¶é—´å†…ï¼Œåˆ†å¤šæ¬¡éå†æœåŠ¡å™¨ä¸­çš„å„ä¸ªæ•°æ®åº“ï¼Œä»æ•°æ®åº“çš„expireså­—å…¸ä¸­éšæœºæ£€æŸ¥ä¸€éƒ¨åˆ†é”®çš„è¿‡æœŸæ—¶é—´ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„è¿‡æœŸé”®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#é»˜è®¤æ¯æ¬¡æ£€æŸ¥çš„æ•°æ®åº“æ•°é‡</span><br>DEFAULT_DB_NUMBERS = <span class="hljs-number">16</span><br> <br><span class="hljs-comment">#é»˜è®¤æ¯ä¸ªæ•°æ®åº“æ£€æŸ¥çš„é”®æ•°é‡</span><br>DEFAULT_KEY_NUMBERS = <span class="hljs-number">20</span><br> <br><span class="hljs-comment">#å…¨å±€å˜é‡ï¼Œè®°å½•æ£€æŸ¥è¿›åº¦</span><br>current_db = <span class="hljs-number">0</span><br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">activeExpireCycle</span>():</span><br>    <span class="hljs-comment"># åˆå§‹åŒ–è¦æ£€æŸ¥çš„æ•°æ®åº“æ•°é‡</span><br>    <span class="hljs-comment"># å¦‚æœæœåŠ¡å™¨çš„æ•°æ®åº“æ•°é‡æ¯” DEFAULT_DB_NUMBERS è¦å°</span><br>    <span class="hljs-comment"># é‚£ä¹ˆä»¥æœåŠ¡å™¨çš„æ•°æ®åº“æ•°é‡ä¸ºå‡†</span><br>    <span class="hljs-keyword">if</span> server.dbnum &lt; DEFAULT_DB_NUMBERS:<br>        db_numbers = server.dbnum<br>    <span class="hljs-keyword">else</span>:<br>        db_numbers = DEFAULT_DB_NUMBERS<br> <br>    <span class="hljs-comment"># éå†å„ä¸ªæ•°æ®åº“</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(db_numbers):<br>        <span class="hljs-comment"># å¦‚æœcurrent_db çš„å€¼ç­‰äºæœåŠ¡å™¨çš„æ•°æ®åº“æ•°é‡</span><br>        <span class="hljs-comment"># è¿™è¡¨ç¤ºæ£€æŸ¥ç¨‹åºå·²ç»éå†äº†æœåŠ¡å™¨çš„æ‰€æœ‰æ•°æ®åº“ä¸€æ¬¡</span><br>        <span class="hljs-comment"># å°†current_db é‡ç½®ä¸º0 ï¼Œå¼€å§‹æ–°çš„ä¸€è½®éå†</span><br>        <span class="hljs-keyword">if</span> current_db == server.dbnum:<br>            current_db = <span class="hljs-number">0</span><br>       <br>        <span class="hljs-comment"># è·å–å½“å‰è¦å¤„ç†çš„æ•°æ®åº“</span><br>        redisDb = server.db[current_db]<br> <br>        <span class="hljs-comment"># å°†æ•°æ®åº“ç´¢å¼•å¢1 ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªè¦å¤„ç†çš„æ•°æ®åº“</span><br>        current_db += <span class="hljs-number">1</span><br> <br>        <span class="hljs-comment"># æ£€æŸ¥æ•°æ®åº“é”®</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(DEFAULT_KEY_NUMBERS):<br>            <span class="hljs-comment"># å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰ä¸€ä¸ªé”®å¸¦æœ‰è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆè·³è¿‡è¿™ä¸ªæ•°æ®åº“</span><br>            <span class="hljs-keyword">if</span> redisDb.expires.size() == <span class="hljs-number">0</span>: <span class="hljs-keyword">break</span><br>                <span class="hljs-comment">#éšæœºè·å–ä¸€ä¸ªå¸¦æœ‰è¿‡æœŸæ—¶é—´çš„é”®</span><br>                key_with_ttl = redisDb.expires.get_random_key()<br>    <br>                <span class="hljs-comment"># æ£€æŸ¥é”®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸå°±åˆ é™¤å®ƒ</span><br>                <span class="hljs-keyword">if</span> is_expired(key_with_ttl):<br>                    delete_key(key_with_ttl)<br>                <span class="hljs-comment"># å·²è¾¾åˆ°æ—¶é—´ä¸Šé™ï¼Œåœæ­¢å¤„ç†</span><br>                <span class="hljs-keyword">if</span> reach_time_limit(): <span class="hljs-keyword">return</span><br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python">DB_NUMBER = <span class="hljs-number">16</span> <span class="hljs-comment"># æ•°æ®åº“æ•°é‡ï¼Œé»˜è®¤16ï¼ˆ0-15ï¼‰ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ— é™å¢åŠ </span><br>KEY_NUMBERS = <span class="hljs-number">20</span> <span class="hljs-comment"># æ¯æ¬¡æ£€æŸ¥keyçš„æ•°é‡</span><br><br>current_db = <span class="hljs-number">0</span> <span class="hljs-comment"># è®°å½•å½“å‰æ£€æŸ¥åˆ°å“ªä¸ªåº“</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">activeExpireCycle</span>():</span><br>  <br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(DB_NUMBERS):<br>  <br>    <span class="hljs-keyword">if</span> current_db == DB_BUMBERS:<br>      current_db = <span class="hljs-number">0</span><br><br>    <span class="hljs-comment"># è·å–å½“å‰æ•°æ®åº“</span><br>    redisDB = server.db[current_db]<br>    first_start = <span class="hljs-literal">True</span><br>    del_key_num = <span class="hljs-number">0</span><br>    current_db += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">while</span>(first_start <span class="hljs-keyword">or</span> del_key_num &gt; KEY_NUMBERS/<span class="hljs-number">4</span>):<br>      first_start = <span class="hljs-literal">False</span><br>      <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(KEY_NUMBERS):<br>        <br>        _key = redisDB.randomExpireKey()<br>        <span class="hljs-keyword">if</span> is_expire(_key):<br>          <span class="hljs-comment"># è¿‡æœŸ åˆ™ç›´æ¥åˆ é™¤</span><br>          delete_key(_key)<br>          del_key_num += <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">if</span> time_is_limit():<br>          <span class="hljs-comment"># è‹¥æ‰§è¡Œæ—¶é—´å¤ªé•¿ï¼Œåˆ™åœæ­¢ï¼Œé»˜è®¤25æ¯«ç§’</span><br>          <span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rediså†…å­˜æ¨¡å‹</title>
    <link href="/dajiangdahe/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/"/>
    <url>/dajiangdahe/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1>1.Rediså†…å­˜åˆ’åˆ†</h1><p>Redisä½œä¸ºå†…å­˜æ•°æ®åº“ï¼Œåœ¨å†…å­˜ä¸­å­˜å‚¨çš„å†…å®¹ä¸»è¦æ˜¯æ•°æ®ï¼ˆé”®å€¼å¯¹key-valueï¼‰å…¶ä»–éƒ¨åˆ†ä¹Ÿä¼šç«™ä¸€å®šçš„å†…å­˜ã€‚</p><h2 id="æ•°æ®">æ•°æ®</h2><p>Redisæ•°æ®ç±»å‹ï¼š</p><ul><li>stringï¼šå­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨ä½œåˆ†å¸ƒå¼é”</li><li>hashï¼šå“ˆå¸Œï¼Œå¯ä»¥ç”¨ä½œæ—©æœŸçš„è´­ç‰©è½¦</li><li>listï¼šåˆ—è¡¨ï¼Œå¯ä»¥ç”¨ä½œå¾®ä¿¡æ–‡ç« åˆ—è¡¨</li><li>setï¼šé›†åˆï¼Œå¯ä»¥ç”¨åœ¨åšäº¤é›†ï¼Œå·®é›†</li><li>zsetï¼šæœ‰åºé›†åˆï¼Œå¯ä»¥ç”¨åšæ’è¡Œæ¦œã€‚</li><li>HyperLogLogï¼šRedis HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®š çš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚</li><li>Geoï¼šRedis GEO ä¸»è¦ç”¨äºå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œå¹¶å¯¹å­˜å‚¨çš„ä¿¡æ¯è¿›è¡Œæ“ä½œï¼Œè¯¥åŠŸèƒ½åœ¨ Redis 3.2 ç‰ˆæœ¬æ–°å¢ã€‚</li><li>Streamï¼šRedis Stream ä¸»è¦ç”¨äºæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼ŒMessage Queueï¼‰ï¼ŒRedis æœ¬èº«æ˜¯æœ‰ä¸€ä¸ª Redis å‘å¸ƒè®¢é˜… (pub/sub) æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œä½†å®ƒæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯æ¶ˆæ¯æ— æ³•æŒä¹…åŒ–ï¼Œå¦‚æœå‡ºç°ç½‘ç»œæ–­å¼€ã€Redis å®•æœºç­‰ï¼Œæ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¼ƒã€‚ç®€å•æ¥è¯´å‘å¸ƒè®¢é˜… (pub/sub) å¯ä»¥åˆ†å‘æ¶ˆæ¯ï¼Œä½†æ— æ³•è®°å½•å†å²æ¶ˆæ¯ã€‚</li></ul><p>ä½œä¸ºæ•°æ®åº“ï¼Œæ•°æ®æ˜¯æœ€ä¸»è¦çš„éƒ¨åˆ†ï¼›è¿™éƒ¨åˆ†å ç”¨çš„å†…å­˜ä¼šç»Ÿè®¡åœ¨used_memoryä¸­ã€‚Redisåœ¨å­˜å‚¨å¯¹è±¡æ—¶ï¼Œå¹¶ä¸æ˜¯ç›´æ¥å°†æ•°æ®æ‰”è¿›å†…å­˜ï¼Œè€Œæ˜¯ä¼šå¯¹å¯¹è±¡è¿›è¡Œå„ç§åŒ…è£…ï¼šå¦‚redisObjectã€SDSç­‰</p><h2 id="è¿›ç¨‹æœ¬èº«è¿è¡Œéœ€è¦çš„å†…å­˜">è¿›ç¨‹æœ¬èº«è¿è¡Œéœ€è¦çš„å†…å­˜</h2><p>Redisä¸»è¿›ç¨‹æœ¬èº«è¿è¡Œè‚¯å®šéœ€è¦å ç”¨å†…å­˜ï¼Œå¦‚ä»£ç ã€å¸¸é‡æ± ç­‰ç­‰ï¼›è¿™éƒ¨åˆ†å†…å­˜å¤§çº¦å‡ å…†ï¼Œåœ¨å¤§å¤šæ•°ç”Ÿäº§ç¯å¢ƒä¸­ä¸Redisæ•°æ®å ç”¨çš„å†…å­˜ç›¸æ¯”å¯ä»¥å¿½ç•¥ã€‚è¿™éƒ¨åˆ†å†…å­˜ä¸æ˜¯ç”±jemallocåˆ†é…ï¼Œå› æ­¤ä¸ä¼šç»Ÿè®¡åœ¨used_memoryä¸­ã€‚</p><p>è¡¥å……è¯´æ˜ï¼šé™¤äº†ä¸»è¿›ç¨‹å¤–ï¼ŒRedisåˆ›å»ºçš„å­è¿›ç¨‹è¿è¡Œä¹Ÿä¼šå ç”¨å†…å­˜ï¼Œå¦‚Redisæ‰§è¡ŒAOFã€RDBé‡å†™æ—¶åˆ›å»ºçš„å­è¿›ç¨‹ã€‚å½“ç„¶ï¼Œè¿™éƒ¨åˆ†å†…å­˜ä¸å±äºRedisè¿›ç¨‹ï¼Œä¹Ÿä¸ä¼šç»Ÿè®¡åœ¨used_memoryå’Œused_memory_rssä¸­ã€‚</p><h2 id="ç¼“å†²å†…å­˜">ç¼“å†²å†…å­˜</h2><p>ç¼“å†²å†…å­˜åŒ…æ‹¬å®¢æˆ·ç«¯ç¼“å†²åŒºã€å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€AOFç¼“å†²åŒºç­‰ï¼›å…¶ä¸­ï¼Œå®¢æˆ·ç«¯ç¼“å†²å­˜å‚¨å®¢æˆ·ç«¯è¿æ¥çš„è¾“å…¥è¾“å‡ºç¼“å†²ï¼›å¤åˆ¶ç§¯å‹ç¼“å†²ç”¨äºéƒ¨åˆ†å¤åˆ¶åŠŸèƒ½ï¼›AOFç¼“å†²åŒºç”¨äºåœ¨è¿›è¡ŒAOFé‡å†™æ—¶ï¼Œä¿å­˜æœ€è¿‘çš„å†™å…¥å‘½ä»¤ã€‚åœ¨äº†è§£ç›¸åº”åŠŸèƒ½ä¹‹å‰ï¼Œä¸éœ€è¦çŸ¥é“è¿™äº›ç¼“å†²çš„ç»†èŠ‚ï¼›è¿™éƒ¨åˆ†å†…å­˜ç”±jemallocåˆ†é…ï¼Œå› æ­¤ä¼šç»Ÿè®¡åœ¨used_memoryä¸­ã€‚</p><h2 id="å†…å­˜ç¢ç‰‡">å†…å­˜ç¢ç‰‡</h2><p>å†…å­˜ç¢ç‰‡æ˜¯Redisåœ¨åˆ†é…ã€å›æ”¶ç‰©ç†å†…å­˜è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¯¹æ•°æ®çš„æ›´æ”¹é¢‘ç¹ï¼Œè€Œä¸”æ•°æ®ä¹‹é—´çš„å¤§å°ç›¸å·®å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´redisé‡Šæ”¾çš„ç©ºé—´åœ¨ç‰©ç†å†…å­˜ä¸­å¹¶æ²¡æœ‰é‡Šæ”¾ï¼Œä½†redisåˆæ— æ³•æœ‰æ•ˆåˆ©ç”¨ï¼Œè¿™å°±å½¢æˆäº†å†…å­˜ç¢ç‰‡ã€‚å†…å­˜ç¢ç‰‡ä¸ä¼šç»Ÿè®¡åœ¨used_memoryä¸­ã€‚</p><p>å¦‚æœRedisæœåŠ¡å™¨ä¸­çš„å†…å­˜ç¢ç‰‡å·²ç»å¾ˆå¤§ï¼Œå¯ä»¥é€šè¿‡å®‰å…¨é‡å¯çš„æ–¹å¼å‡å°å†…å­˜ç¢ç‰‡ï¼šå› ä¸ºé‡å¯ä¹‹åï¼ŒRedisé‡æ–°ä»å¤‡ä»½æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œåœ¨å†…å­˜ä¸­è¿›è¡Œé‡æ’ï¼Œä¸ºæ¯ä¸ªæ•°æ®é‡æ–°é€‰æ‹©åˆé€‚çš„å†…å­˜å•å…ƒï¼Œå‡å°å†…å­˜ç¢ç‰‡ã€‚</p><h1>2.Redisæ•°æ®å­˜å‚¨çš„ç»†èŠ‚</h1><h2 id="Rediså­˜å‚¨ç»†èŠ‚">Rediså­˜å‚¨ç»†èŠ‚</h2><p><a href="https://www.cnblogs.com/kismetv/p/8654978.html">https://www.cnblogs.com/kismetv/p/8654978.html</a></p><p>å…³äºRedisæ•°æ®å­˜å‚¨çš„ç»†èŠ‚ï¼Œæ¶‰åŠåˆ°å†…å­˜åˆ†é…å™¨ï¼ˆå¦‚jemallocï¼‰ã€ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰ã€5ç§å¯¹è±¡ç±»å‹åŠå†…éƒ¨ç¼–ç ã€redisObjectã€‚åœ¨è®²è¿°å…·ä½“å†…å®¹ä¹‹å‰ï¼Œå…ˆè¯´æ˜ä¸€ä¸‹è¿™å‡ ä¸ªæ¦‚å¿µä¹‹é—´çš„å…³ç³»ã€‚</p><p>ä¸‹å›¾æ˜¯æ‰§è¡Œset hello worldæ—¶ï¼Œæ‰€æ¶‰åŠåˆ°çš„æ•°æ®æ¨¡å‹ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/1174710-20180327001055927-1896197804.png" class="" title="img"><p>ï¼ˆ1ï¼‰dictEntryï¼šRedisæ˜¯Key-Valueæ•°æ®åº“ï¼Œå› æ­¤å¯¹æ¯ä¸ªé”®å€¼å¯¹éƒ½ä¼šæœ‰ä¸€ä¸ªdictEntryï¼Œé‡Œé¢å­˜å‚¨äº†æŒ‡å‘Keyå’ŒValueçš„æŒ‡é’ˆï¼›nextæŒ‡å‘ä¸‹ä¸€ä¸ªdictEntryï¼Œä¸æœ¬Key-Valueæ— å…³ã€‚</p><p>ï¼ˆ2ï¼‰Keyï¼šå›¾ä¸­å³ä¸Šè§’å¯è§ï¼ŒKeyï¼ˆâ€helloâ€ï¼‰å¹¶ä¸æ˜¯ç›´æ¥ä»¥å­—ç¬¦ä¸²å­˜å‚¨ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨SDSç»“æ„ä¸­ã€‚</p><p>ï¼ˆ3ï¼‰redisObjectï¼šValue(â€œworldâ€)æ—¢ä¸æ˜¯ç›´æ¥ä»¥å­—ç¬¦ä¸²å­˜å‚¨ï¼Œä¹Ÿä¸æ˜¯åƒKeyä¸€æ ·ç›´æ¥å­˜å‚¨åœ¨SDSä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨redisObjectä¸­ã€‚å®é™…ä¸Šï¼Œä¸è®ºValueæ˜¯5ç§ç±»å‹çš„å“ªä¸€ç§ï¼Œéƒ½æ˜¯é€šè¿‡redisObjectæ¥å­˜å‚¨çš„ï¼›è€ŒredisObjectä¸­çš„typeå­—æ®µæŒ‡æ˜äº†Valueå¯¹è±¡çš„ç±»å‹ï¼Œptrå­—æ®µåˆ™æŒ‡å‘å¯¹è±¡æ‰€åœ¨çš„åœ°å€ã€‚ä¸è¿‡å¯ä»¥çœ‹å‡ºï¼Œå­—ç¬¦ä¸²å¯¹è±¡è™½ç„¶ç»è¿‡äº†redisObjectçš„åŒ…è£…ï¼Œä½†ä»ç„¶éœ€è¦é€šè¿‡SDSå­˜å‚¨ã€‚</p><p>å®é™…ä¸Šï¼ŒredisObjecté™¤äº†typeå’Œptrå­—æ®µä»¥å¤–ï¼Œè¿˜æœ‰å…¶ä»–å­—æ®µå›¾ä¸­æ²¡æœ‰ç»™å‡ºï¼Œå¦‚ç”¨äºæŒ‡å®šå¯¹è±¡å†…éƒ¨ç¼–ç çš„å­—æ®µï¼›åé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚</p><p>ï¼ˆ4ï¼‰jemallocï¼šæ— è®ºæ˜¯DictEntryå¯¹è±¡ï¼Œè¿˜æ˜¯redisObjectã€SDSå¯¹è±¡ï¼Œéƒ½éœ€è¦å†…å­˜åˆ†é…å™¨ï¼ˆå¦‚jemallocï¼‰åˆ†é…å†…å­˜è¿›è¡Œå­˜å‚¨ã€‚ä»¥DictEntryå¯¹è±¡ä¸ºä¾‹ï¼Œæœ‰3ä¸ªæŒ‡é’ˆç»„æˆï¼Œåœ¨64ä½æœºå™¨ä¸‹å 24ä¸ªå­—èŠ‚ï¼Œjemallocä¼šä¸ºå®ƒåˆ†é…32å­—èŠ‚å¤§å°çš„å†…å­˜å•å…ƒã€‚</p><h2 id="SDSä¸Cå­—ç¬¦ä¸²çš„æ¯”è¾ƒ">SDSä¸Cå­—ç¬¦ä¸²çš„æ¯”è¾ƒ</h2><p>SDSåœ¨Cå­—ç¬¦ä¸²çš„åŸºç¡€ä¸ŠåŠ å…¥äº†freeå’Œlenå­—æ®µï¼Œå¸¦æ¥äº†å¾ˆå¤šå¥½å¤„ï¼š</p><ul><li>è·å–å­—ç¬¦ä¸²é•¿åº¦ï¼šSDSæ˜¯O(1)ï¼ŒCå­—ç¬¦ä¸²æ˜¯O(n)</li><li>ç¼“å†²åŒºæº¢å‡ºï¼šä½¿ç”¨Cå­—ç¬¦ä¸²çš„APIæ—¶ï¼Œå¦‚æœå­—ç¬¦ä¸²é•¿åº¦å¢åŠ ï¼ˆå¦‚strcatæ“ä½œï¼‰è€Œå¿˜è®°é‡æ–°åˆ†é…å†…å­˜ï¼Œå¾ˆå®¹æ˜“é€ æˆç¼“å†²åŒºçš„æº¢å‡ºï¼›è€ŒSDSç”±äºè®°å½•äº†é•¿åº¦ï¼Œç›¸åº”çš„APIåœ¨å¯èƒ½é€ æˆç¼“å†²åŒºæº¢å‡ºæ—¶ä¼šè‡ªåŠ¨é‡æ–°åˆ†é…å†…å­˜ï¼Œæœç»äº†ç¼“å†²åŒºæº¢å‡ºã€‚</li><li>ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å†…å­˜çš„é‡åˆ†é…ï¼šå¯¹äºCå­—ç¬¦ä¸²ï¼Œå¦‚æœè¦ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œå¿…é¡»è¦é‡æ–°åˆ†é…å†…å­˜ï¼ˆå…ˆé‡Šæ”¾å†ç”³è¯·ï¼‰ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰é‡æ–°åˆ†é…ï¼Œå­—ç¬¦ä¸²é•¿åº¦å¢å¤§æ—¶ä¼šé€ æˆå†…å­˜ç¼“å†²åŒºæº¢å‡ºï¼Œå­—ç¬¦ä¸²é•¿åº¦å‡å°æ—¶ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚è€Œå¯¹äºSDSï¼Œç”±äºå¯ä»¥è®°å½•lenå’Œfreeï¼Œå› æ­¤è§£é™¤äº†å­—ç¬¦ä¸²é•¿åº¦å’Œç©ºé—´æ•°ç»„é•¿åº¦ä¹‹é—´çš„å…³è”ï¼Œå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–ï¼šç©ºé—´é¢„åˆ†é…ç­–ç•¥ï¼ˆå³åˆ†é…å†…å­˜æ—¶æ¯”å®é™…éœ€è¦çš„å¤šï¼‰ä½¿å¾—å­—ç¬¦ä¸²é•¿åº¦å¢å¤§æ—¶é‡æ–°åˆ†é…å†…å­˜çš„æ¦‚ç‡å¤§å¤§å‡å°ï¼›æƒ°æ€§ç©ºé—´é‡Šæ”¾ç­–ç•¥ä½¿å¾—å­—ç¬¦ä¸²é•¿åº¦å‡å°æ—¶é‡æ–°åˆ†é…å†…å­˜çš„æ¦‚ç‡å¤§å¤§å‡å°ã€‚</li><li>å­˜å–äºŒè¿›åˆ¶æ•°æ®ï¼šSDSå¯ä»¥ï¼ŒCå­—ç¬¦ä¸²ä¸å¯ä»¥ã€‚å› ä¸ºCå­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸçš„æ ‡è¯†ï¼Œè€Œå¯¹äºä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ç­‰ï¼‰ï¼Œå†…å®¹å¯èƒ½åŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ï¼Œå› æ­¤Cå­—ç¬¦ä¸²æ— æ³•æ­£ç¡®å­˜å–ï¼›è€ŒSDSä»¥å­—ç¬¦ä¸²é•¿åº¦lenæ¥ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸæ ‡è¯†ï¼Œå› æ­¤æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚</li></ul><p>æ­¤å¤–ï¼Œç”±äºSDSä¸­çš„bufä»ç„¶ä½¿ç”¨äº†Cå­—ç¬¦ä¸²ï¼ˆå³ä»¥â€™\0â€™ç»“å°¾ï¼‰ï¼Œå› æ­¤SDSå¯ä»¥ä½¿ç”¨Cå­—ç¬¦ä¸²åº“ä¸­çš„éƒ¨åˆ†å‡½æ•°ï¼›ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰å½“SDSç”¨æ¥å­˜å‚¨æ–‡æœ¬æ•°æ®æ—¶æ‰å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼Œåœ¨å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®æ—¶åˆ™ä¸è¡Œï¼ˆâ€™\0â€™ä¸ä¸€å®šæ˜¯ç»“å°¾ï¼‰ã€‚</p><p>Redisåœ¨å­˜å‚¨å¯¹è±¡æ—¶ï¼Œä¸€å¾‹ä½¿ç”¨SDSä»£æ›¿Cå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚set hello worldå‘½ä»¤ï¼Œhelloå’Œworldéƒ½æ˜¯ä»¥SDSçš„å½¢å¼å­˜å‚¨çš„ã€‚è€Œsadd myset member1 member2 member3å‘½ä»¤ï¼Œä¸è®ºæ˜¯é”®ï¼ˆâ€mysetâ€ï¼‰ï¼Œè¿˜æ˜¯é›†åˆä¸­çš„å…ƒç´ ï¼ˆâ€member1â€ã€ â€member2â€å’Œâ€member3â€ï¼‰ï¼Œéƒ½æ˜¯ä»¥SDSçš„å½¢å¼å­˜å‚¨ã€‚é™¤äº†å­˜å‚¨å¯¹è±¡ï¼ŒSDSè¿˜ç”¨äºå­˜å‚¨å„ç§ç¼“å†²åŒºã€‚</p><p>åªæœ‰åœ¨å­—ç¬¦ä¸²ä¸ä¼šæ”¹å˜çš„æƒ…å†µä¸‹ï¼Œå¦‚æ‰“å°æ—¥å¿—æ—¶ï¼Œæ‰ä¼šä½¿ç”¨Cå­—ç¬¦ä¸²ã€‚</p><h1>3.Redisçš„å¯¹è±¡ç±»å‹ä¸å†…éƒ¨ç¼–ç </h1><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/1174710-20180327001358239-1304238510.png" class="" title="img"><h2 id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</h2><h3 id="ï¼ˆ1ï¼‰æ¦‚å†µ">ï¼ˆ1ï¼‰æ¦‚å†µ</h3><p>å­—ç¬¦ä¸²æ˜¯æœ€åŸºç¡€çš„ç±»å‹ï¼Œå› ä¸ºæ‰€æœ‰çš„é”®éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸”å­—ç¬¦ä¸²ä¹‹å¤–çš„å…¶ä»–å‡ ç§å¤æ‚ç±»å‹çš„å…ƒç´ ä¹Ÿæ˜¯å­—ç¬¦ä¸²ã€‚</p><p>å­—ç¬¦ä¸²é•¿åº¦ä¸èƒ½è¶…è¿‡512MBã€‚</p><h3 id="ï¼ˆ2ï¼‰å†…éƒ¨ç¼–ç ">ï¼ˆ2ï¼‰å†…éƒ¨ç¼–ç </h3><p>å­—ç¬¦ä¸²ç±»å‹çš„å†…éƒ¨ç¼–ç æœ‰3ç§ï¼Œå®ƒä»¬çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p><ul><li><p>intï¼š8ä¸ªå­—èŠ‚çš„é•¿æ•´å‹ã€‚å­—ç¬¦ä¸²å€¼æ˜¯æ•´å‹æ—¶ï¼Œè¿™ä¸ªå€¼ä½¿ç”¨longæ•´å‹è¡¨ç¤ºã€‚</p></li><li><p>embstrï¼š&lt;=39å­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚embsträ¸rawéƒ½ä½¿ç”¨redisObjectå’Œsdsä¿å­˜æ•°æ®ï¼ŒåŒºåˆ«åœ¨äºï¼Œembstrçš„ä½¿ç”¨åªåˆ†é…ä¸€æ¬¡å†…å­˜ç©ºé—´ï¼ˆå› æ­¤redisObjectå’Œsdsæ˜¯è¿ç»­çš„ï¼‰ï¼Œè€Œrawéœ€è¦åˆ†é…ä¸¤æ¬¡å†…å­˜ç©ºé—´ï¼ˆåˆ†åˆ«ä¸ºredisObjectå’Œsdsåˆ†é…ç©ºé—´ï¼‰ã€‚å› æ­¤ä¸rawç›¸æ¯”ï¼Œembstrçš„å¥½å¤„åœ¨äºåˆ›å»ºæ—¶å°‘åˆ†é…ä¸€æ¬¡ç©ºé—´ï¼Œåˆ é™¤æ—¶å°‘é‡Šæ”¾ä¸€æ¬¡ç©ºé—´ï¼Œä»¥åŠå¯¹è±¡çš„æ‰€æœ‰æ•°æ®è¿åœ¨ä¸€èµ·ï¼Œå¯»æ‰¾æ–¹ä¾¿ã€‚è€Œembstrçš„åå¤„ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå¦‚æœå­—ç¬¦ä¸²çš„é•¿åº¦å¢åŠ éœ€è¦é‡æ–°åˆ†é…å†…å­˜æ—¶ï¼Œæ•´ä¸ªredisObjectå’Œsdséƒ½éœ€è¦é‡æ–°åˆ†é…ç©ºé—´ï¼Œå› æ­¤redisä¸­çš„embstrå®ç°ä¸ºåªè¯»ã€‚</p></li><li><p>rawï¼šå¤§äº39ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/1174710-20180327001417703-15851809.png" class="" title="img"></li></ul><p>embstrå’Œrawè¿›è¡ŒåŒºåˆ†çš„é•¿åº¦ï¼Œæ˜¯39ï¼›æ˜¯å› ä¸ºredisObjectçš„é•¿åº¦æ˜¯16å­—èŠ‚ï¼Œsdsçš„é•¿åº¦æ˜¯9+å­—ç¬¦ä¸²é•¿åº¦ï¼›å› æ­¤å½“å­—ç¬¦ä¸²é•¿åº¦æ˜¯39æ—¶ï¼Œembstrçš„é•¿åº¦æ­£å¥½æ˜¯16+9+39=64ï¼Œjemallocæ­£å¥½å¯ä»¥åˆ†é…64å­—èŠ‚çš„å†…å­˜å•å…ƒã€‚</p><h3 id="ï¼ˆ3ï¼‰ç¼–ç è½¬æ¢">ï¼ˆ3ï¼‰ç¼–ç è½¬æ¢</h3><p>å½“intæ•°æ®ä¸å†æ˜¯æ•´æ•°ï¼Œæˆ–å¤§å°è¶…è¿‡äº†longçš„èŒƒå›´æ—¶ï¼Œè‡ªåŠ¨è½¬åŒ–ä¸ºrawã€‚</p><p>è€Œå¯¹äºembstrï¼Œç”±äºå…¶å®ç°æ˜¯åªè¯»çš„ï¼Œå› æ­¤åœ¨å¯¹embstrå¯¹è±¡è¿›è¡Œä¿®æ”¹æ—¶ï¼Œéƒ½ä¼šå…ˆè½¬åŒ–ä¸ºrawå†è¿›è¡Œä¿®æ”¹ï¼Œå› æ­¤ï¼Œåªè¦æ˜¯ä¿®æ”¹embstrå¯¹è±¡ï¼Œä¿®æ”¹åçš„å¯¹è±¡ä¸€å®šæ˜¯rawçš„ï¼Œæ— è®ºæ˜¯å¦è¾¾åˆ°äº†39ä¸ªå­—èŠ‚ã€‚ç¤ºä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/1174710-20180327001426651-1225081171.png" class="" title="img"><h2 id="åˆ—è¡¨">åˆ—è¡¨</h2><h3 id="ï¼ˆ1ï¼‰æ¦‚å†µ-2">ï¼ˆ1ï¼‰æ¦‚å†µ</h3><p>åˆ—è¡¨ï¼ˆlistï¼‰ç”¨æ¥å­˜å‚¨å¤šä¸ªæœ‰åºçš„å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²ç§°ä¸ºå…ƒç´ ï¼›ä¸€ä¸ªåˆ—è¡¨å¯ä»¥å­˜å‚¨2^32-1ä¸ªå…ƒç´ ã€‚Redisä¸­çš„åˆ—è¡¨æ”¯æŒä¸¤ç«¯æ’å…¥å’Œå¼¹å‡ºï¼Œå¹¶å¯ä»¥è·å¾—æŒ‡å®šä½ç½®ï¼ˆæˆ–èŒƒå›´ï¼‰çš„å…ƒç´ ï¼Œå¯ä»¥å……å½“æ•°ç»„ã€é˜Ÿåˆ—ã€æ ˆç­‰ã€‚</p><h3 id="ï¼ˆ2ï¼‰å†…éƒ¨ç¼–ç -2">ï¼ˆ2ï¼‰å†…éƒ¨ç¼–ç </h3><p>åˆ—è¡¨çš„å†…éƒ¨ç¼–ç å¯ä»¥æ˜¯å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰æˆ–åŒç«¯é“¾è¡¨ï¼ˆlinkedlistï¼‰ã€‚</p><p>åŒç«¯é“¾è¡¨ï¼šç”±ä¸€ä¸ªlistç»“æ„å’Œå¤šä¸ªlistNodeç»“æ„ç»„æˆï¼›å…¸å‹ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/1174710-20180327001435577-242733744.png" class="" title="img"><p>é€šè¿‡å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒåŒç«¯é“¾è¡¨åŒæ—¶ä¿å­˜äº†è¡¨å¤´æŒ‡é’ˆå’Œè¡¨å°¾æŒ‡é’ˆï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰æŒ‡å‘å‰å’ŒæŒ‡å‘åçš„æŒ‡é’ˆï¼›é“¾è¡¨ä¸­ä¿å­˜äº†åˆ—è¡¨çš„é•¿åº¦ï¼›dupã€freeå’Œmatchä¸ºèŠ‚ç‚¹å€¼è®¾ç½®ç±»å‹ç‰¹å®šå‡½æ•°ï¼Œæ‰€ä»¥é“¾è¡¨å¯ä»¥ç”¨äºä¿å­˜å„ç§ä¸åŒç±»å‹çš„å€¼ã€‚è€Œé“¾è¡¨ä¸­æ¯ä¸ªèŠ‚ç‚¹æŒ‡å‘çš„æ˜¯typeä¸ºå­—ç¬¦ä¸²çš„redisObjectã€‚</p><p>å‹ç¼©åˆ—è¡¨ï¼šå‹ç¼©åˆ—è¡¨æ˜¯Redisä¸ºäº†èŠ‚çº¦å†…å­˜è€Œå¼€å‘çš„ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„<strong>è¿ç»­å†…å­˜å—</strong>(è€Œä¸æ˜¯åƒåŒç«¯é“¾è¡¨ä¸€æ ·æ¯ä¸ªèŠ‚ç‚¹æ˜¯æŒ‡é’ˆ)ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„ï¼›å…·ä½“ç»“æ„ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œç•¥ã€‚ä¸åŒç«¯é“¾è¡¨ç›¸æ¯”ï¼Œå‹ç¼©åˆ—è¡¨å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œä½†æ˜¯è¿›è¡Œä¿®æ”¹æˆ–å¢åˆ æ“ä½œæ—¶ï¼Œå¤æ‚åº¦è¾ƒé«˜ï¼›å› æ­¤å½“èŠ‚ç‚¹æ•°é‡è¾ƒå°‘æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‹ç¼©åˆ—è¡¨ï¼›ä½†æ˜¯èŠ‚ç‚¹æ•°é‡å¤šæ—¶ï¼Œè¿˜æ˜¯ä½¿ç”¨åŒç«¯é“¾è¡¨åˆ’ç®—ã€‚</p><p>å‹ç¼©åˆ—è¡¨ä¸ä»…ç”¨äºå®ç°åˆ—è¡¨ï¼Œä¹Ÿç”¨äºå®ç°å“ˆå¸Œã€æœ‰åºåˆ—è¡¨ï¼›ä½¿ç”¨éå¸¸å¹¿æ³›ã€‚</p><h3 id="ï¼ˆ3ï¼‰ç¼–ç è½¬æ¢-2">ï¼ˆ3ï¼‰ç¼–ç è½¬æ¢</h3><p>åªæœ‰åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œæ‰ä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ï¼šåˆ—è¡¨ä¸­å…ƒç´ æ•°é‡å°äº512ä¸ªï¼›åˆ—è¡¨ä¸­æ‰€æœ‰å­—ç¬¦ä¸²å¯¹è±¡éƒ½ä¸è¶³64å­—èŠ‚ã€‚å¦‚æœæœ‰ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™ä½¿ç”¨åŒç«¯åˆ—è¡¨ï¼›ä¸”ç¼–ç åªå¯èƒ½ç”±å‹ç¼©åˆ—è¡¨è½¬åŒ–ä¸ºåŒç«¯é“¾è¡¨ï¼Œåæ–¹å‘åˆ™ä¸å¯èƒ½ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†åˆ—è¡¨ç¼–ç è½¬æ¢çš„ç‰¹ç‚¹ï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/1174710-20180327001457636-673470263.png" class="" title="img"><p>å…¶ä¸­ï¼Œå•ä¸ªå­—ç¬¦ä¸²ä¸èƒ½è¶…è¿‡64å­—èŠ‚ï¼Œæ˜¯ä¸ºäº†ä¾¿äºç»Ÿä¸€åˆ†é…æ¯ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼›è¿™é‡Œçš„64å­—èŠ‚æ˜¯æŒ‡å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œä¸åŒ…æ‹¬SDSç»“æ„ï¼Œå› ä¸º<strong>å‹ç¼©åˆ—è¡¨ä½¿ç”¨è¿ç»­ã€å®šé•¿å†…å­˜å—å­˜å‚¨å­—ç¬¦ä¸²</strong>ï¼Œä¸éœ€è¦SDSç»“æ„æŒ‡æ˜é•¿åº¦ã€‚åé¢æåˆ°å‹ç¼©åˆ—è¡¨ï¼Œä¹Ÿä¼šå¼ºè°ƒé•¿åº¦ä¸è¶…è¿‡64å­—èŠ‚ï¼ŒåŸç†ä¸è¿™é‡Œç±»ä¼¼ã€‚</p><h2 id="å“ˆå¸Œ">å“ˆå¸Œ</h2><h3 id="ï¼ˆ1ï¼‰æ¦‚å†µ-3">ï¼ˆ1ï¼‰æ¦‚å†µ</h3><p>å“ˆå¸Œï¼ˆä½œä¸ºä¸€ç§æ•°æ®ç»“æ„ï¼‰ï¼Œä¸ä»…æ˜¯rediså¯¹å¤–æä¾›çš„5ç§å¯¹è±¡ç±»å‹çš„ä¸€ç§ï¼ˆä¸å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºç»“åˆå¹¶åˆ—ï¼‰ï¼Œä¹Ÿæ˜¯Redisä½œä¸ºKey-Valueæ•°æ®åº“æ‰€ä½¿ç”¨çš„æ•°æ®ç»“æ„ã€‚ä¸ºäº†è¯´æ˜çš„æ–¹ä¾¿ï¼Œåœ¨æœ¬æ–‡åé¢å½“ä½¿ç”¨â€œå†…å±‚çš„å“ˆå¸Œâ€æ—¶ï¼Œä»£è¡¨çš„æ˜¯rediså¯¹å¤–æä¾›çš„5ç§å¯¹è±¡ç±»å‹çš„ä¸€ç§ï¼›ä½¿ç”¨â€œå¤–å±‚çš„å“ˆå¸Œâ€ä»£æŒ‡Redisä½œä¸ºKey-Valueæ•°æ®åº“æ‰€ä½¿ç”¨çš„æ•°æ®ç»“æ„ã€‚</p><h3 id="ï¼ˆ2ï¼‰å†…éƒ¨ç¼–ç -3">ï¼ˆ2ï¼‰å†…éƒ¨ç¼–ç </h3><p>å†…å±‚çš„å“ˆå¸Œä½¿ç”¨çš„å†…éƒ¨ç¼–ç å¯ä»¥æ˜¯å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰å’Œå“ˆå¸Œè¡¨ï¼ˆhashtableï¼‰ä¸¤ç§ï¼›Redisçš„å¤–å±‚çš„å“ˆå¸Œåˆ™åªä½¿ç”¨äº†hashtableã€‚</p><p>å‹ç¼©åˆ—è¡¨å‰é¢å·²ä»‹ç»ã€‚ä¸å“ˆå¸Œè¡¨ç›¸æ¯”ï¼Œå‹ç¼©åˆ—è¡¨ç”¨äºå…ƒç´ ä¸ªæ•°å°‘ã€å…ƒç´ é•¿åº¦å°çš„åœºæ™¯ï¼›å…¶ä¼˜åŠ¿åœ¨äºé›†ä¸­å­˜å‚¨ï¼ŒèŠ‚çœç©ºé—´ï¼›åŒæ—¶ï¼Œè™½ç„¶å¯¹äºå…ƒç´ çš„æ“ä½œå¤æ‚åº¦ä¹Ÿç”±O(1)å˜ä¸ºäº†O(n)ï¼Œä½†ç”±äºå“ˆå¸Œä¸­å…ƒç´ æ•°é‡è¾ƒå°‘ï¼Œå› æ­¤æ“ä½œçš„æ—¶é—´å¹¶æ²¡æœ‰æ˜æ˜¾åŠ£åŠ¿ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼ˆå³hashtableæ²¡æœ‰è¿›è¡Œrehashæ—¶ï¼‰å„éƒ¨åˆ†å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/1174710-20180327001627028-325473621.png" class="" title="img"><p><strong>dictEntry</strong></p><p>dictEntryç»“æ„ç”¨äºä¿å­˜é”®å€¼å¯¹ï¼Œç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">typedef struct dictEntry&#123;<br>    <span class="hljs-keyword">void</span> *key;<br>    union&#123;<br>        <span class="hljs-keyword">void</span> *val;<br>        uint64_tu64;<br>        int64_ts64;<br>    &#125;v;<br>    struct dictEntry *next;<br>&#125;dictEntry;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œå„ä¸ªå±æ€§çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li>keyï¼šé”®å€¼å¯¹ä¸­çš„é”®ï¼›</li><li>valï¼šé”®å€¼å¯¹ä¸­çš„å€¼ï¼Œä½¿ç”¨union(å³å…±ç”¨ä½“)å®ç°ï¼Œå­˜å‚¨çš„å†…å®¹æ—¢å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å€¼çš„æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯64ä½æ•´å‹ï¼Œæˆ–æ— ç¬¦å·64ä½æ•´å‹ï¼›</li><li>nextï¼šæŒ‡å‘ä¸‹ä¸€ä¸ªdictEntryï¼Œç”¨äºè§£å†³å“ˆå¸Œå†²çªé—®é¢˜</li></ul><p>åœ¨64ä½ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªdictEntryå¯¹è±¡å 24å­—èŠ‚ï¼ˆkey/val/nextå„å 8å­—èŠ‚ï¼‰ã€‚</p><p><strong>bucket</strong></p><p>bucketæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æŒ‡å‘dictEntryç»“æ„çš„æŒ‡é’ˆã€‚redisä¸­bucketæ•°ç»„çš„å¤§å°è®¡ç®—è§„åˆ™å¦‚ä¸‹ï¼šå¤§äºdictEntryçš„ã€æœ€å°çš„2^nï¼›ä¾‹å¦‚ï¼Œå¦‚æœæœ‰1000ä¸ªdictEntryï¼Œé‚£ä¹ˆbucketå¤§å°ä¸º1024ï¼›å¦‚æœæœ‰1500ä¸ªdictEntryï¼Œåˆ™bucketå¤§å°ä¸º2048ã€‚</p><p><strong>dictht</strong></p><p>dicthtç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">typedef struct dictht&#123;<br>    dictEntry **table;<br>    unsigned <span class="hljs-keyword">long</span> size;<br>    unsigned <span class="hljs-keyword">long</span> sizemask;<br>    unsigned <span class="hljs-keyword">long</span> used;<br>&#125;dictht;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œå„ä¸ªå±æ€§çš„åŠŸèƒ½è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>tableå±æ€§æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘bucketï¼›</li><li>sizeå±æ€§è®°å½•äº†å“ˆå¸Œè¡¨çš„å¤§å°ï¼Œå³bucketçš„å¤§å°ï¼›</li><li>usedè®°å½•äº†å·²ä½¿ç”¨çš„dictEntryçš„æ•°é‡ï¼›</li><li>sizemaskå±æ€§çš„å€¼æ€»æ˜¯ä¸ºsize-1ï¼Œè¿™ä¸ªå±æ€§å’Œå“ˆå¸Œå€¼ä¸€èµ·å†³å®šä¸€ä¸ªé”®åœ¨tableä¸­å­˜å‚¨çš„ä½ç½®ã€‚</li></ul><p><strong>dict</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œé€šè¿‡ä½¿ç”¨dicthtå’ŒdictEntryç»“æ„ï¼Œä¾¿å¯ä»¥å®ç°æ™®é€šå“ˆå¸Œè¡¨çš„åŠŸèƒ½ï¼›ä½†æ˜¯Redisçš„å®ç°ä¸­ï¼Œåœ¨dicthtç»“æ„çš„ä¸Šå±‚ï¼Œè¿˜æœ‰ä¸€ä¸ªdictç»“æ„ã€‚ä¸‹é¢è¯´æ˜dictç»“æ„çš„å®šä¹‰åŠä½œç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">typedef struct dict&#123;<br>    dictType *type;<br>    <span class="hljs-keyword">void</span> *privdata;<br>    dictht ht[<span class="hljs-number">2</span>];<br>    <span class="hljs-keyword">int</span> trehashidx;<br>&#125; dict;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œtypeå±æ€§å’Œprivdataå±æ€§æ˜¯ä¸ºäº†é€‚åº”ä¸åŒç±»å‹çš„é”®å€¼å¯¹ï¼Œç”¨äºåˆ›å»ºå¤šæ€å­—å…¸ã€‚</p><p>htå±æ€§å’Œtrehashidxå±æ€§åˆ™ç”¨äºrehashï¼Œå³å½“å“ˆå¸Œè¡¨éœ€è¦æ‰©å±•æˆ–æ”¶ç¼©æ—¶ä½¿ç”¨ã€‚htæ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªé¡¹çš„æ•°ç»„ï¼Œæ¯é¡¹éƒ½æŒ‡å‘ä¸€ä¸ªdicthtç»“æ„ï¼Œè¿™ä¹Ÿæ˜¯Redisçš„å“ˆå¸Œä¼šæœ‰1ä¸ªdictã€2ä¸ªdicthtç»“æ„çš„åŸå› ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å­˜åœ¨æ”¾dictçš„ht[0]ä¸­ï¼Œht[1]åªåœ¨rehashçš„æ—¶å€™ä½¿ç”¨ã€‚dictè¿›è¡Œrehashæ“ä½œçš„æ—¶å€™ï¼Œå°†ht[0]ä¸­çš„æ‰€æœ‰æ•°æ®rehashåˆ°ht[1]ä¸­ã€‚ç„¶åå°†ht[1]èµ‹å€¼ç»™ht[0]ï¼Œå¹¶æ¸…ç©ºht[1]ã€‚</p><p>å› æ­¤ï¼ŒRedisä¸­çš„å“ˆå¸Œä¹‹æ‰€ä»¥åœ¨dicthtå’ŒdictEntryç»“æ„ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªdictç»“æ„ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†é€‚åº”ä¸åŒç±»å‹çš„é”®å€¼å¯¹ï¼Œå¦ä¸€æ–¹é¢æ˜¯ä¸ºäº†rehashã€‚</p><h3 id="ï¼ˆ3ï¼‰ç¼–ç è½¬æ¢-3">ï¼ˆ3ï¼‰ç¼–ç è½¬æ¢</h3><p>å¦‚å‰æ‰€è¿°ï¼ŒRedisä¸­å†…å±‚çš„å“ˆå¸Œæ—¢å¯èƒ½ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨å‹ç¼©åˆ—è¡¨ã€‚</p><p>åªæœ‰åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œæ‰ä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ï¼šå“ˆå¸Œä¸­å…ƒç´ æ•°é‡å°äº512ä¸ªï¼›å“ˆå¸Œä¸­æ‰€æœ‰é”®å€¼å¯¹çš„é”®å’Œå€¼å­—ç¬¦ä¸²é•¿åº¦éƒ½å°äº64å­—èŠ‚ã€‚å¦‚æœæœ‰ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™ä½¿ç”¨å“ˆå¸Œè¡¨ï¼›ä¸”ç¼–ç åªå¯èƒ½ç”±å‹ç¼©åˆ—è¡¨è½¬åŒ–ä¸ºå“ˆå¸Œè¡¨ï¼Œåæ–¹å‘åˆ™ä¸å¯èƒ½ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†Rediså†…å±‚çš„å“ˆå¸Œç¼–ç è½¬æ¢çš„ç‰¹ç‚¹ï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/1174710-20180327001855681-1566128865.png" class="" title="img"><h2 id="é›†åˆ">é›†åˆ</h2><h3 id="ï¼ˆ1ï¼‰æ¦‚å†µ-4">ï¼ˆ1ï¼‰æ¦‚å†µ</h3><p>é›†åˆï¼ˆsetï¼‰ä¸åˆ—è¡¨ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨æ¥ä¿å­˜å¤šä¸ªå­—ç¬¦ä¸²ï¼Œä½†é›†åˆä¸åˆ—è¡¨æœ‰ä¸¤ç‚¹ä¸åŒï¼šé›†åˆä¸­çš„å…ƒç´ æ˜¯æ— åºçš„ï¼Œå› æ­¤ä¸èƒ½é€šè¿‡ç´¢å¼•æ¥æ“ä½œå…ƒç´ ï¼›é›†åˆä¸­çš„å…ƒç´ ä¸èƒ½æœ‰é‡å¤ã€‚</p><p>ä¸€ä¸ªé›†åˆä¸­æœ€å¤šå¯ä»¥å­˜å‚¨2^32-1ä¸ªå…ƒç´ ï¼›é™¤äº†æ”¯æŒå¸¸è§„çš„å¢åˆ æ”¹æŸ¥ï¼ŒRedisè¿˜æ”¯æŒå¤šä¸ªé›†åˆå–äº¤é›†ã€å¹¶é›†ã€å·®é›†ã€‚</p><h3 id="ï¼ˆ2ï¼‰å†…éƒ¨ç¼–ç -4">ï¼ˆ2ï¼‰å†…éƒ¨ç¼–ç </h3><p>é›†åˆçš„å†…éƒ¨ç¼–ç å¯ä»¥æ˜¯æ•´æ•°é›†åˆï¼ˆintsetï¼‰æˆ–å“ˆå¸Œè¡¨ï¼ˆhashtableï¼‰ã€‚</p><p>å“ˆå¸Œè¡¨å‰é¢å·²ç»è®²è¿‡ï¼Œè¿™é‡Œç•¥è¿‡ä¸æï¼›éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé›†åˆåœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æ—¶ï¼Œå€¼å…¨éƒ¨è¢«ç½®ä¸ºnullã€‚</p><p>æ•´æ•°é›†åˆçš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">typedef struct intset&#123;<br>    uint32_t encoding;<br>    uint32_t length;<br>    int8_t contents[];<br>&#125; intset;<br></code></pre></td></tr></table></figure><h3 id="ï¼ˆ3ï¼‰ç¼–ç è½¬æ¢-4">ï¼ˆ3ï¼‰ç¼–ç è½¬æ¢</h3><p>åªæœ‰åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œé›†åˆæ‰ä¼šä½¿ç”¨æ•´æ•°é›†åˆï¼šé›†åˆä¸­å…ƒç´ æ•°é‡å°äº512ä¸ªï¼›é›†åˆä¸­æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ•´æ•°å€¼ã€‚å¦‚æœæœ‰ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™ä½¿ç”¨å“ˆå¸Œè¡¨ï¼›ä¸”ç¼–ç åªå¯èƒ½ç”±æ•´æ•°é›†åˆè½¬åŒ–ä¸ºå“ˆå¸Œè¡¨ï¼Œåæ–¹å‘åˆ™ä¸å¯èƒ½ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†é›†åˆç¼–ç è½¬æ¢çš„ç‰¹ç‚¹ï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/1174710-20180327001926146-2105183556.png" class="" title="img"><h2 id="æœ‰åºé›†åˆ">æœ‰åºé›†åˆ</h2><h3 id="ï¼ˆ1ï¼‰æ¦‚å†µ-5">ï¼ˆ1ï¼‰æ¦‚å†µ</h3><p>æœ‰åºé›†åˆä¸é›†åˆä¸€æ ·ï¼Œå…ƒç´ éƒ½ä¸èƒ½é‡å¤ï¼›ä½†ä¸é›†åˆä¸åŒçš„æ˜¯ï¼Œæœ‰åºé›†åˆä¸­çš„å…ƒç´ æ˜¯æœ‰é¡ºåºçš„ã€‚ä¸åˆ—è¡¨ä½¿ç”¨ç´¢å¼•ä¸‹æ ‡ä½œä¸ºæ’åºä¾æ®ä¸åŒï¼Œæœ‰åºé›†åˆä¸ºæ¯ä¸ªå…ƒç´ è®¾ç½®ä¸€ä¸ªåˆ†æ•°ï¼ˆscoreï¼‰ä½œä¸ºæ’åºä¾æ®ã€‚</p><h3 id="ï¼ˆ2ï¼‰å†…éƒ¨ç¼–ç -5">ï¼ˆ2ï¼‰å†…éƒ¨ç¼–ç </h3><p>æœ‰åºé›†åˆçš„å†…éƒ¨ç¼–ç å¯ä»¥æ˜¯å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰æˆ–è·³è·ƒè¡¨ï¼ˆskiplistï¼‰ã€‚zipliståœ¨åˆ—è¡¨å’Œå“ˆå¸Œä¸­éƒ½æœ‰ä½¿ç”¨ï¼Œå‰é¢å·²ç»è®²è¿‡ï¼Œè¿™é‡Œç•¥è¿‡ä¸æã€‚</p><p>è·³è·ƒè¡¨æ˜¯ä¸€ç§æœ‰åºæ•°æ®ç»“æ„ï¼Œé€šè¿‡åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ç»´æŒå¤šä¸ªæŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»è€Œè¾¾åˆ°å¿«é€Ÿè®¿é—®èŠ‚ç‚¹çš„ç›®çš„ã€‚é™¤äº†è·³è·ƒè¡¨ï¼Œå®ç°æœ‰åºæ•°æ®ç»“æ„çš„å¦ä¸€ç§å…¸å‹å®ç°æ˜¯å¹³è¡¡æ ‘ï¼›å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè·³è·ƒè¡¨çš„æ•ˆç‡å¯ä»¥å’Œå¹³è¡¡æ ‘åª²ç¾ï¼Œä¸”è·³è·ƒè¡¨å®ç°æ¯”å¹³è¡¡æ ‘ç®€å•å¾ˆå¤šï¼Œå› æ­¤redisä¸­é€‰ç”¨è·³è·ƒè¡¨ä»£æ›¿å¹³è¡¡æ ‘ã€‚è·³è·ƒè¡¨æ”¯æŒå¹³å‡O(logN)ã€æœ€åO(N)çš„å¤æ‚ç‚¹è¿›è¡ŒèŠ‚ç‚¹æŸ¥æ‰¾ï¼Œå¹¶æ”¯æŒé¡ºåºæ“ä½œã€‚Redisçš„è·³è·ƒè¡¨å®ç°ç”±zskiplistå’ŒzskiplistNodeä¸¤ä¸ªç»“æ„ç»„æˆï¼šå‰è€…ç”¨äºä¿å­˜è·³è·ƒè¡¨ä¿¡æ¯ï¼ˆå¦‚å¤´ç»“ç‚¹ã€å°¾èŠ‚ç‚¹ã€é•¿åº¦ç­‰ï¼‰ï¼Œåè€…ç”¨äºè¡¨ç¤ºè·³è·ƒè¡¨èŠ‚ç‚¹ã€‚å…·ä½“ç»“æ„ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œç•¥ã€‚</p><h3 id="ï¼ˆ3ï¼‰ç¼–ç è½¬æ¢-5">ï¼ˆ3ï¼‰ç¼–ç è½¬æ¢</h3><p>åªæœ‰åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œæ‰ä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ï¼šæœ‰åºé›†åˆä¸­å…ƒç´ æ•°é‡å°äº128ä¸ªï¼›æœ‰åºé›†åˆä¸­æ‰€æœ‰æˆå‘˜é•¿åº¦éƒ½ä¸è¶³64å­—èŠ‚ã€‚å¦‚æœæœ‰ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™ä½¿ç”¨è·³è·ƒè¡¨ï¼›ä¸”ç¼–ç åªå¯èƒ½ç”±å‹ç¼©åˆ—è¡¨è½¬åŒ–ä¸ºè·³è·ƒè¡¨ï¼Œåæ–¹å‘åˆ™ä¸å¯èƒ½ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†æœ‰åºé›†åˆç¼–ç è½¬æ¢çš„ç‰¹ç‚¹ï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Redis%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/1174710-20180327001936290-955216194.png" class="" title="img">]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlç´¢å¼•</title>
    <link href="/dajiangdahe/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/"/>
    <url>/dajiangdahe/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/</url>
    
    <content type="html"><![CDATA[<h1>Mysqlç´¢å¼•</h1><h2 id="ã€æ¦‚å¿µã€‘">ã€æ¦‚å¿µã€‘</h2><p>MySQL å®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ© MySQL é«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚ç®€å•çš„ç†è§£ï¼Œç´¢å¼•ç±»ä¼¼äºå­—å…¸é‡Œé¢çš„ç›®å½•ã€‚</p><h2 id="ã€ç´¢å¼•ç±»å‹ã€‘">ã€ç´¢å¼•ç±»å‹ã€‘</h2><p>==ä»æ•°æ®ç»“æ„è§’åº¦åˆ’åˆ†ï¼š==</p><ul><li><p><strong>hashç´¢å¼•</strong>ï¼šåº•å±‚å°±æ˜¯ hash è¡¨ã€‚è¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œæ ¹æ® key è°ƒç”¨ hash å‡½æ•°è·å¾—å¯¹åº”çš„ hashcodeï¼Œæ ¹æ® hashcode æ‰¾åˆ°å¯¹åº”çš„æ•°<strong>æ®è¡Œåœ°å€</strong>ï¼Œæ ¹æ®åœ°å€æ‹¿åˆ°å¯¹åº”çš„æ•°æ®ã€‚</p></li><li><p>B æ ‘ç´¢å¼•ï¼šBæ ‘æ˜¯ä¸€ç§å¤šè·¯æœç´¢æ ‘ï¼Œn è·¯æœç´¢æ ‘ä»£è¡¨æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ n ä¸ªå­èŠ‚ç‚¹ã€‚æ¯ä¸ªèŠ‚ç‚¹<strong>å­˜å‚¨ key</strong> + <strong>æŒ‡å‘ä¸‹ä¸€å±‚èŠ‚ç‚¹çš„æŒ‡é’ˆ</strong>+ <strong>æŒ‡å‘ key æ•°æ®è®°å½•çš„åœ°å€</strong>ã€‚æŸ¥æ‰¾æ—¶ï¼Œä»æ ¹ç»“ç‚¹å‘ä¸‹è¿›è¡ŒæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å¯¹åº”çš„keyã€‚</p></li><li><p><strong>B+æ ‘ç´¢å¼•</strong>ï¼šB+æ ‘æ˜¯bæ ‘çš„å˜ç§ï¼Œä¸»è¦åŒºåˆ«åœ¨äºï¼šB+æ ‘çš„==éå¶å­èŠ‚ç‚¹==åª<strong>å­˜å‚¨ key + æŒ‡å‘ä¸‹ä¸€å±‚èŠ‚ç‚¹çš„æŒ‡é’ˆ</strong>ã€‚å¦å¤–ï¼Œ<strong>B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¹‹é—´é€šè¿‡æŒ‡é’ˆæ¥è¿æ¥</strong>ï¼Œæ„æˆä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼Œå› æ­¤å¯¹æ•´æ£µæ ‘çš„éå†åªéœ€è¦ä¸€æ¬¡çº¿æ€§éå†å¶å­ç»“ç‚¹å³å¯ï¼ˆoï¼ˆnï¼‰æ—¶é—´å¤æ‚åº¦éå†å…¨éƒ¨èŠ‚ç‚¹ï¼‰ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/aHR0cHM6Ly9tbWJpei5xcGljLmNuL3N6X21tYml6X3BuZy9LUlJ4dnFHY2ljWkhHY0JXdFdpYmxRb1RFWWdZcUlGQVJ3R0UydDhDdTZKeHZibTFNcDMxMGlhWlU1ekhYazZTNzhpYldUcDlodzQ4RE4wQ3U0ZUlIaWFjRVVnLw" class="" title="img"></li></ul><p>==ä»é€»è¾‘ç»“æ„è§’åº¦åˆ’åˆ†ï¼š==</p><ul><li><p><strong>èšç°‡ç´¢å¼•</strong>ï¼šèšç°‡ç´¢å¼•å¹¶ä¸æ˜¯ä¸€ç§å•ç‹¬çš„ç´¢å¼•ç±»å‹ï¼Œè€Œæ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ã€‚èšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®è¡Œæ”¾åˆ°äº†ä¸€å—ï¼Œæ‰¾åˆ°ç´¢å¼•ä¹Ÿå°±æ‰¾åˆ°äº†æ•°æ®ã€‚å› ä¸ºæ— éœ€è¿›è¡Œå›è¡¨æ“ä½œï¼Œæ‰€ä»¥æ•ˆç‡å¾ˆé«˜ã€‚<strong>InnoDB ä¸­å¿…ç„¶ä¼šæœ‰ï¼Œä¸”åªä¼šæœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•</strong>ã€‚é€šå¸¸æ˜¯ä¸»é”®ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©éç©ºçš„å”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœå”¯ä¸€ç´¢å¼•ä¹Ÿæ²¡æœ‰ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªéšè—çš„row_id ä½œä¸ºèšç°‡ç´¢å¼•ã€‚è‡³äºä¸ºå•¥ä¼šåªæœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®åªä¼šå­˜å‚¨ä¸€ä»½ã€‚</p><ul><li>ä¼˜ç‚¹ï¼š<ul><li>æ•°æ®è®¿é—®æ›´å¿«ï¼Œå› ä¸ºèšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB+æ ‘ä¸­ï¼Œå› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®æ¯”éèšç°‡ç´¢å¼•æ›´å¿«</li><li>èšç°‡ç´¢å¼•å¯¹äºä¸»é”®çš„æ’åºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿«</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåºï¼ŒæŒ‰ç…§ä¸»é”®çš„<strong>é¡ºåºæ’å…¥</strong>æ˜¯æœ€å¿«çš„æ–¹å¼ï¼Œå¦åˆ™å°†ä¼šå‡ºç°é¡µåˆ†è£‚ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚å› æ­¤ï¼Œå¯¹äºInnoDBè¡¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ª<strong>è‡ªå¢çš„IDåˆ—ä¸ºä¸»é”®</strong></li><li><strong>æ›´æ–°ä¸»é”®çš„ä»£ä»·å¾ˆé«˜</strong>ï¼Œå› ä¸ºå°†ä¼šå¯¼è‡´è¢«æ›´æ–°çš„è¡Œç§»åŠ¨ã€‚å› æ­¤ï¼Œå¯¹äºInnoDBè¡¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬å®šä¹‰ä¸»é”®ä¸ºä¸å¯æ›´æ–°ã€‚</li><li>äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œç¬¬ä¸€æ¬¡æ‰¾åˆ°ä¸»é”®å€¼ï¼Œç¬¬äºŒæ¬¡æ ¹æ®ä¸»é”®å€¼æ‰¾åˆ°è¡Œæ•°æ®ã€‚</li></ul></li></ul></li><li><p><strong>éèšç°‡ç´¢å¼•</strong>ï¼šåœ¨<strong>èšç°‡ç´¢å¼•ä¹‹ä¸Šåˆ›å»ºçš„ç´¢å¼•ç§°ä¹‹ä¸ºè¾…åŠ©ç´¢å¼•</strong>ï¼Œè¾…åŠ©ç´¢å¼•è®¿é—®æ•°æ®æ€»æ˜¯éœ€è¦äºŒæ¬¡æŸ¥æ‰¾ã€‚è¾…åŠ©ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„ä¸å†æ˜¯è¡Œçš„ç‰©ç†ä½ç½®ï¼Œè€Œæ˜¯ä¸»é”®å€¼ã€‚é€šè¿‡è¾…åŠ©ç´¢å¼•é¦–å…ˆæ‰¾åˆ°çš„æ˜¯ä¸»é”®å€¼ï¼Œå†é€šè¿‡ä¸»é”®å€¼æ‰¾åˆ°æ•°æ®è¡Œçš„æ•°æ®é¡µï¼Œå†é€šè¿‡æ•°æ®é¡µä¸­çš„Page Directoryæ‰¾åˆ°æ•°æ®è¡Œã€‚</p><p>â€‹1ã€ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œå› ä¸ºæ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»ç´¢å¼•ï¼Œè¿‡é•¿çš„ä¸»ç´¢å¼•ä¼šä»¤è¾…åŠ©ç´¢å¼•å˜å¾—è¿‡å¤§ã€‚</p><p>2ã€ç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®åœ¨InnoDBä¸­ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºInnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€é¢—B+Treeï¼Œéå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶æ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´ï¼Œååˆ†ä½æ•ˆï¼Œè€Œä½¿ç”¨è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®åˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p></li><li><p><strong>è”åˆç´¢å¼•</strong>ï¼šè”åˆç´¢å¼•åˆå«å¤åˆç´¢å¼•ã€‚å¯¹äºå¤åˆç´¢å¼•:Mysqlä»å·¦åˆ°å³çš„ä½¿ç”¨ç´¢å¼•ä¸­çš„å­—æ®µï¼Œä¸€ä¸ªæŸ¥è¯¢å¯ä»¥åªä½¿ç”¨ç´¢å¼•ä¸­çš„ä¸€éƒ¨ä»½ï¼Œä½†åªèƒ½æ˜¯æœ€å·¦ä¾§éƒ¨åˆ†ã€‚ä¾‹å¦‚ç´¢å¼•æ˜¯key index (a,b,c). å¯ä»¥æ”¯æŒ<strong>a</strong> | <strong>a,b</strong>| <strong>a,b,c</strong> 3ç§ç»„åˆè¿›è¡ŒæŸ¥æ‰¾ï¼Œä½†ä¸æ”¯æŒ b,cè¿›è¡ŒæŸ¥æ‰¾ .å½“æœ€å·¦ä¾§å­—æ®µæ˜¯å¸¸é‡å¼•ç”¨æ—¶ï¼Œç´¢å¼•å°±ååˆ†æœ‰æ•ˆã€‚</p></li><li><p><strong>å”¯ä¸€ç´¢å¼•</strong></p></li><li><p><strong>æ™®é€šç´¢å¼•</strong></p></li><li><p><strong>è¦†ç›–ç´¢å¼•</strong>ï¼šè¦†ç›–ç´¢å¼•ï¼ˆcovering indexï¼‰æŒ‡ä¸€ä¸ª<strong>æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œåªç”¨ä»ç´¢å¼•ä¸­å°±èƒ½å¤Ÿå–å¾—</strong>ï¼Œä¸å¿…ä»æ•°æ®è¡¨ä¸­è¯»å–ã€‚ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºå®ç°äº†ç´¢å¼•è¦†ç›–ã€‚ å½“ä¸€æ¡æŸ¥è¯¢è¯­å¥ç¬¦åˆè¦†ç›–ç´¢å¼•æ¡ä»¶æ—¶ï¼ŒMySQLåªéœ€è¦é€šè¿‡ç´¢å¼•å°±å¯ä»¥è¿”å›æŸ¥è¯¢æ‰€éœ€è¦çš„æ•°æ®ï¼Œè¿™æ ·é¿å…äº†æŸ¥åˆ°ç´¢å¼•åå†è¿”å›è¡¨æ“ä½œï¼Œå‡å°‘I/Oæé«˜æ•ˆç‡ã€‚ å¦‚ï¼Œè¡¨covering_index_sampleä¸­æœ‰ä¸€ä¸ªæ™®é€šç´¢å¼• idx_key1_key2(key1,key2)ã€‚å½“æˆ‘ä»¬é€šè¿‡SQLè¯­å¥ï¼šselect key2 from covering_index_sample where key1 = â€˜keytestâ€™;çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•æŸ¥è¯¢ï¼Œæ— éœ€å›è¡¨ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/aHR0cHM6Ly9tbWJpei5xcGljLmNuL3N6X21tYml6X3BuZy9LUlJ4dnFHY2ljWkhHY0JXdFdpYmxRb1RFWWdZcUlGQVJ3eDB5c3FQZ3JlemJteVFCdFRqMmJYWGZpYjR5aWJTZmxBNWhjT0JXZ0NpYXNjVUNvaWJDUDV1WmZuQS8" class="" title="img"></li><li><p>**è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•(adaptive hash indexï¼‰ï¼š**InnoDB ä¼šç›‘æ§å¯¹è¡¨ä¸Šç´¢å¼•çš„æŸ¥æ‰¾ï¼Œå¦‚æœè§‚å¯Ÿåˆ°æŸäº›ç´¢å¼•è¢«é¢‘ç¹è®¿é—®ï¼Œç´¢å¼•æˆä¸ºçƒ­æ•°æ®ï¼Œå»ºç«‹å“ˆå¸Œç´¢å¼•å¯ä»¥å¸¦æ¥é€Ÿåº¦çš„æå‡ï¼Œåˆ™å»ºç«‹å“ˆå¸Œç´¢å¼•ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºè‡ªé€‚åº”ï¼ˆadaptiveï¼‰çš„ã€‚è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•é€šè¿‡ç¼“å†²æ± çš„ B+ æ ‘æ„é€ è€Œæ¥ï¼Œå› æ­¤å»ºç«‹çš„é€Ÿåº¦å¾ˆå¿«ã€‚è€Œä¸”ä¸éœ€è¦å°†æ•´ä¸ªè¡¨éƒ½å»ºå“ˆå¸Œç´¢å¼•ï¼ŒInnoDB ä¼šè‡ªåŠ¨æ ¹æ®è®¿é—®çš„é¢‘ç‡å’Œæ¨¡å¼æ¥ä¸ºæŸäº›é¡µå»ºç«‹å“ˆå¸Œç´¢å¼•ã€‚</p></li></ul><h2 id="ã€InnoDBå¼•æ“å®ç°æ–¹å¼ã€‘">ã€InnoDBå¼•æ“å®ç°æ–¹å¼ã€‘</h2><p>InnoDB<strong>ä¹Ÿä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„</strong>ï¼Œä½†å…·ä½“å®ç°æ–¹å¼å´ä¸MyISAMæˆªç„¶ä¸åŒ.</p><p>1ï¼‰ä¸»é”®ç´¢å¼•ï¼š</p><p><strong>MyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„</strong>ï¼Œ<strong>ç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€</strong>ã€‚è€Œåœ¨<strong>InnoDBä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„</strong>ï¼Œè¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1464190-20191106145200302-932404581.png" class="" title="img"><p>(å›¾inndbä¸»é”®ç´¢å¼•ï¼‰æ˜¯InnoDBä¸»ç´¢å¼•ï¼ˆåŒæ—¶ä¹Ÿæ˜¯æ•°æ®æ–‡ä»¶ï¼‰çš„ç¤ºæ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°å¶èŠ‚ç‚¹åŒ…å«äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ç§ç´¢å¼•å«åšèšç°‡ç´¢å¼•ã€‚å› ä¸ºInnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«è¦æŒ‰ä¸»é”®èšé›†ï¼Œæ‰€ä»¥InnoDBè¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆMyISAMå¯ä»¥æ²¡æœ‰ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™*<em>MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µï¼ˆrow_idï¼‰<em>é•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å½¢</em></em>ã€‚</p><p>2ï¼‰InnoDBçš„è¾…åŠ©ç´¢å¼•</p><p>InnoDBçš„æ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚ä¾‹å¦‚ï¼Œä¸‹å›¾ä¸ºå®šä¹‰åœ¨Col3ä¸Šçš„ä¸€ä¸ªè¾…åŠ©ç´¢å¼•ï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1464190-20191106145241480-1330791289.png" class="" title="img"><p>InnoDB è¡¨æ˜¯åŸºäºèšç°‡ç´¢å¼•å»ºç«‹çš„ã€‚å› æ­¤InnoDB çš„ç´¢å¼•èƒ½æä¾›ä¸€ç§éå¸¸å¿«é€Ÿçš„ä¸»é”®æŸ¥æ‰¾æ€§èƒ½ã€‚ä¸è¿‡ï¼Œå®ƒçš„è¾…åŠ©ç´¢å¼•ï¼ˆSecondary Indexï¼Œ ä¹Ÿå°±æ˜¯éä¸»é”®ç´¢å¼•ï¼‰ä¹Ÿä¼šåŒ…å«ä¸»é”®åˆ—ï¼Œæ‰€ä»¥ï¼Œ<strong>å¦‚æœä¸»é”®å®šä¹‰çš„æ¯”è¾ƒå¤§ï¼Œå…¶ä»–ç´¢å¼•ä¹Ÿå°†å¾ˆå¤§</strong>ã€‚å¦‚æœæƒ³åœ¨è¡¨ä¸Šå®šä¹‰ ã€å¾ˆå¤šç´¢å¼•ï¼Œåˆ™äº‰å–å°½é‡æŠŠä¸»é”®å®šä¹‰å¾—å°ä¸€äº›ã€‚InnoDB ä¸ä¼šå‹ç¼©ç´¢å¼•ã€‚</p><p>æ–‡å­—ç¬¦çš„ASCIIç ä½œä¸ºæ¯”è¾ƒå‡†åˆ™ã€‚èšé›†ç´¢å¼•è¿™ç§å®ç°æ–¹å¼ä½¿å¾—æŒ‰ä¸»é”®çš„æœç´¢ååˆ†é«˜æ•ˆï¼Œä½†æ˜¯è¾…åŠ©ç´¢å¼•æœç´¢éœ€è¦æ£€ç´¢ä¸¤éç´¢å¼•ï¼šé¦–å…ˆæ£€ç´¢è¾…åŠ©ç´¢å¼•è·å¾—ä¸»é”®ï¼Œç„¶åç”¨ä¸»é”®åˆ°ä¸»ç´¢å¼•ä¸­æ£€ç´¢è·å¾—è®°å½•ã€‚</p><p>ä¸åŒå­˜å‚¨å¼•æ“çš„ç´¢å¼•å®ç°æ–¹å¼å¯¹äºæ­£ç¡®ä½¿ç”¨å’Œä¼˜åŒ–ç´¢å¼•éƒ½éå¸¸æœ‰å¸®åŠ©ï¼Œä¾‹å¦‚çŸ¥é“äº†InnoDBçš„ç´¢å¼•å®ç°åï¼Œå°±å¾ˆå®¹æ˜“æ˜ç™½ï¼š</p><p>1ã€ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œå› ä¸ºæ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»ç´¢å¼•ï¼Œ<strong>è¿‡é•¿çš„ä¸»ç´¢å¼•ä¼šä»¤è¾…åŠ©ç´¢å¼•å˜å¾—è¿‡å¤§ã€‚</strong></p><p>2ã€ç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®åœ¨InnoDBä¸­ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºInnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€é¢—B+Treeï¼Œ<strong>éå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶æ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´</strong>ï¼Œååˆ†ä½æ•ˆï¼Œè€Œä½¿ç”¨è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®åˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p><p>InnoDBä½¿ç”¨çš„æ˜¯èšç°‡ç´¢å¼•ï¼Œå°†ä¸»é”®ç»„ç»‡åˆ°ä¸€æ£µB+æ ‘ä¸­ï¼Œè€Œè¡Œæ•°æ®å°±å‚¨å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œè‹¥ä½¿ç”¨&quot;where id = 14&quot;è¿™æ ·çš„æ¡ä»¶æŸ¥æ‰¾ä¸»é”®ï¼Œåˆ™æŒ‰ç…§B+æ ‘çš„æ£€ç´¢ç®—æ³•å³å¯æŸ¥æ‰¾åˆ°å¯¹åº”çš„å¶èŠ‚ç‚¹ï¼Œä¹‹åè·å¾—è¡Œæ•°æ®ã€‚è‹¥å¯¹Nameåˆ—è¿›è¡Œæ¡ä»¶æœç´¢ï¼Œåˆ™éœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼šç¬¬ä¸€æ­¥åœ¨è¾…åŠ©ç´¢å¼•B+æ ‘ä¸­æ£€ç´¢Nameï¼Œåˆ°è¾¾å…¶å¶å­èŠ‚ç‚¹è·å–å¯¹åº”çš„ä¸»é”®ã€‚ç¬¬äºŒæ­¥ä½¿ç”¨ä¸»é”®åœ¨ä¸»ç´¢å¼•B+æ ‘ç§å†æ‰§è¡Œä¸€æ¬¡B+æ ‘æ£€ç´¢æ“ä½œï¼Œæœ€ç»ˆåˆ°è¾¾å¶å­èŠ‚ç‚¹å³å¯è·å–æ•´è¡Œæ•°æ®ã€‚</p><h2 id="ã€MyISAMç´¢å¼•å®ç°ã€‘">ã€MyISAMç´¢å¼•å®ç°ã€‘</h2><p>MyISAM<strong>ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„</strong>ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€</p><p>1ï¼‰ä¸»é”®ç´¢å¼•ï¼š</p><p>MyISAMå¼•æ“ä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶èŠ‚ç‚¹çš„<strong>dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€</strong>ã€‚ä¸‹å›¾æ˜¯MyISAMä¸»é”®ç´¢å¼•çš„åŸç†å›¾ï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1464190-20191106151308457-531875534.png" class="" title="img"><p>è¿™é‡Œè®¾è¡¨ä¸€å…±æœ‰ä¸‰åˆ—ï¼Œå‡è®¾æˆ‘ä»¬ä»¥Col1ä¸ºä¸»é”®ï¼Œå›¾myisam1æ˜¯ä¸€ä¸ªMyISAMè¡¨çš„ä¸»ç´¢å¼•ï¼ˆPrimary keyï¼‰ç¤ºæ„ã€‚å¯ä»¥çœ‹å‡ºMyISAMçš„ç´¢å¼•æ–‡ä»¶ä»…ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚</p><p>2ï¼‰è¾…åŠ©ç´¢å¼•ï¼ˆSecondary keyï¼‰</p><p>åœ¨MyISAMä¸­ï¼Œä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ï¼ˆSecondary keyï¼‰åœ¨ç»“æ„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œ<strong>åªæ˜¯ä¸»ç´¢å¼•è¦æ±‚keyæ˜¯å”¯ä¸€çš„ï¼Œè€Œè¾…åŠ©ç´¢å¼•çš„keyå¯ä»¥é‡å¤</strong>ã€‚å¦‚æœæˆ‘ä»¬åœ¨Col2ä¸Šå»ºç«‹ä¸€ä¸ªè¾…åŠ©ç´¢å¼•ï¼Œåˆ™æ­¤ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1464190-20191106151427711-625351515.png" class="" title="img"><p>åŒæ ·ä¹Ÿæ˜¯ä¸€é¢—B+Treeï¼ŒdataåŸŸä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚å› æ­¤ï¼ŒMyISAMä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸ºé¦–å…ˆæŒ‰ç…§B+Treeæœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„Keyå­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶dataåŸŸçš„å€¼ï¼Œç„¶åä»¥dataåŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚</p><p>MyISAMçš„ç´¢å¼•æ–¹å¼ä¹Ÿå«åšâ€œéèšé›†â€çš„ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç§°å‘¼æ˜¯ä¸ºäº†ä¸InnoDBçš„èšé›†ç´¢å¼•åŒºåˆ†ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1464190-20191106151527647-152458631.png" class="" title="img"><h2 id="ã€æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ã€‘">ã€æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ã€‘</h2><p>åœ¨MySQLå»ºç«‹è”åˆç´¢å¼•æ—¶ä¼šéµå®ˆæœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œå³æœ€å·¦ä¼˜å…ˆï¼Œåœ¨æ£€ç´¢æ•°æ®æ—¶ä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ã€‚</p><p>ä¸¾ä¾‹ï¼šåˆ›å»ºä¸€ä¸ªï¼ˆa,bï¼‰çš„è”åˆç´¢å¼•ï¼Œé‚£ä¹ˆå®ƒçš„ç´¢å¼•æ ‘å°±æ˜¯ä¸‹å›¾çš„æ ·å­ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521182659976-48843100.png" class="" title="img"><p>å¯ä»¥çœ‹åˆ°açš„å€¼æ˜¯æœ‰é¡ºåºçš„ï¼Œ1ï¼Œ1ï¼Œ2ï¼Œ2ï¼Œ3ï¼Œ3ï¼Œè€Œbçš„å€¼æ˜¯æ²¡æœ‰é¡ºåºçš„1ï¼Œ2ï¼Œ1ï¼Œ4ï¼Œ1ï¼Œ2ã€‚ä½†æ˜¯æˆ‘ä»¬åˆå¯å‘ç°aåœ¨ç­‰å€¼çš„æƒ…å†µä¸‹ï¼Œbå€¼åˆæ˜¯æŒ‰é¡ºåºæ’åˆ—çš„ï¼Œä½†æ˜¯è¿™ç§é¡ºåºæ˜¯ç›¸å¯¹çš„ã€‚è¿™æ˜¯å› ä¸º<strong>MySQLåˆ›å»ºè”åˆç´¢å¼•çš„è§„åˆ™æ˜¯é¦–å…ˆä¼šå¯¹è”åˆç´¢å¼•çš„æœ€å·¦è¾¹ç¬¬ä¸€ä¸ªå­—æ®µæ’åºï¼Œåœ¨ç¬¬ä¸€ä¸ªå­—æ®µçš„æ’åºåŸºç¡€ä¸Šï¼Œç„¶ååœ¨å¯¹ç¬¬äºŒä¸ªå­—æ®µè¿›è¡Œæ’åº</strong>ã€‚æ‰€ä»¥b=2è¿™ç§æŸ¥è¯¢æ¡ä»¶æ²¡æœ‰åŠæ³•åˆ©ç”¨ç´¢å¼•ã€‚</p><p>ç”±äºæ•´ä¸ªè¿‡ç¨‹æ˜¯åŸºäºexplainç»“æœåˆ†æçš„ï¼Œé‚£æ¥ä¸‹æ¥åœ¨äº†è§£ä¸‹explainä¸­çš„typeå­—æ®µå’Œkey_lefå­—æ®µã€‚</p><p><strong>1.type</strong>ï¼š<strong>è”æ¥ç±»å‹ã€‚ä¸‹é¢ç»™å‡ºå„ç§è”æ¥ç±»å‹,æŒ‰ç…§ä»æœ€ä½³ç±»å‹åˆ°æœ€åç±»å‹è¿›è¡Œæ’åº:ï¼ˆé‡ç‚¹çœ‹ref,rang,indexï¼‰</strong></p><p>systemï¼šè¡¨åªæœ‰ä¸€è¡Œè®°å½•ï¼ˆç­‰äºç³»ç»Ÿè¡¨ï¼‰ï¼Œè¿™æ˜¯constç±»å‹çš„ç‰¹ä¾‹ï¼Œå¹³æ—¶ä¸ä¼šå‡ºç°ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡<br>ã€€ã€€ã€€ã€€constï¼šè¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œconstç”¨äºæ¯”è¾ƒprimary key æˆ–è€… uniqueç´¢å¼•ã€‚å› ä¸ºåªéœ€åŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€æœ‰å¾ˆå¿«ã€‚å¦‚æœå°†ä¸»é”®ç½®äºwhereåˆ—è¡¨ä¸­ï¼Œmysqlå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªconst<br>ã€€ã€€ã€€ã€€eq_refï¼šå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…ã€‚å¸¸è§äºä¸»é”® æˆ– å”¯ä¸€ç´¢å¼•æ‰«æã€‚<br>ã€€ã€€ã€€ã€€æ³¨æ„ï¼šALLå…¨è¡¨æ‰«æçš„è¡¨è®°å½•æœ€å°‘çš„è¡¨å¦‚t1è¡¨<br>ã€€ã€€ã€€ã€€<strong>ref</strong>ï¼šéå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œã€‚æœ¬è´¨æ˜¯ä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œå®ƒè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œï¼Œç„¶è€Œä»–å¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥å®ƒåº”è¯¥å±äºæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“ã€‚<br>ã€€ã€€ã€€ã€€<strong>range</strong>ï¼šåªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚keyåˆ—æ˜¾ç¤ºä½¿ç”¨äº†é‚£ä¸ªç´¢å¼•ã€‚ä¸€èˆ¬å°±æ˜¯åœ¨whereè¯­å¥ä¸­å‡ºç°äº†bettweenã€&lt;ã€&gt;ã€inç­‰çš„æŸ¥è¯¢ã€‚è¿™ç§ç´¢å¼•åˆ—ä¸Šçš„èŒƒå›´æ‰«ææ¯”å…¨ç´¢å¼•æ‰«æè¦å¥½ã€‚<strong>åªéœ€è¦å¼€å§‹äºæŸä¸ªç‚¹ï¼Œç»“æŸäºå¦ä¸€ä¸ªç‚¹</strong>ï¼Œ<strong>ä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•ã€‚</strong><br>ã€€ã€€ã€€ã€€<strong>index</strong>ï¼šFull Index Scanï¼Œindexä¸ALLåŒºåˆ«ä¸ºindexç±»å‹åªéå†ç´¢å¼•æ ‘ã€‚è¿™é€šå¸¸ä¸ºALLå—ï¼Œåº”ä¸ºç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°ã€‚ï¼ˆIndexä¸ALLè™½ç„¶éƒ½æ˜¯è¯»å…¨è¡¨ï¼Œä½†indexæ˜¯ä»ç´¢å¼•ä¸­è¯»å–ï¼Œè€ŒALLæ˜¯ä»ç¡¬ç›˜è¯»å–ï¼‰<br>ã€€ã€€ã€€ã€€ALLï¼šFull Table Scanï¼Œéå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œ</p><p><strong>2.key_len</strong>ï¼š<strong>æ˜¾ç¤ºMySQLå®é™…å†³å®šä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚å¦‚æœç´¢å¼•æ˜¯NULLï¼Œåˆ™é•¿åº¦ä¸ºNULLã€‚å¦‚æœä¸æ˜¯NULLï¼Œåˆ™ä¸ºä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚æ‰€ä»¥é€šè¿‡æ­¤å­—æ®µå°±å¯æ¨æ–­å‡ºä½¿ç”¨äº†é‚£ä¸ªç´¢å¼•ã€‚</strong></p><p>è®¡ç®—è§„åˆ™ï¼š</p><p>1.å®šé•¿å­—æ®µï¼Œintå ç”¨4ä¸ªå­—èŠ‚ï¼Œdateå ç”¨3ä¸ªå­—èŠ‚ï¼Œchar(n)å ç”¨nä¸ªå­—ç¬¦ã€‚</p><p>2.å˜é•¿å­—æ®µvarchar(n)ï¼Œåˆ™å ç”¨nä¸ªå­—ç¬¦+ä¸¤ä¸ªå­—èŠ‚ã€‚</p><p>3.ä¸åŒçš„å­—ç¬¦é›†ï¼Œä¸€ä¸ªå­—ç¬¦å ç”¨çš„å­—èŠ‚æ•°æ˜¯ä¸åŒçš„ã€‚Latin1ç¼–ç çš„ï¼Œä¸€ä¸ªå­—ç¬¦å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œgdkç¼–ç çš„ï¼Œä¸€ä¸ªå­—ç¬¦å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œutf-8ç¼–ç çš„ï¼Œä¸€ä¸ªå­—ç¬¦å ç”¨ä¸‰ä¸ªå­—èŠ‚ã€‚</p><p>ï¼ˆç”±äºæˆ‘æ•°æ®åº“ä½¿ç”¨çš„æ˜¯Latin1ç¼–ç çš„æ ¼å¼ï¼Œæ‰€ä»¥åœ¨åé¢çš„è®¡ç®—ä¸­ï¼Œä¸€ä¸ªå­—ç¬¦æŒ‰ä¸€ä¸ªå­—èŠ‚ç®—ï¼‰</p><p>4.å¯¹äºæ‰€æœ‰çš„ç´¢å¼•å­—æ®µï¼Œå¦‚æœè®¾ç½®ä¸ºNULLï¼Œåˆ™è¿˜éœ€è¦1ä¸ªå­—èŠ‚ã€‚</p><h3 id="1-å…¨å€¼åŒ¹é…æŸ¥è¯¢æ—¶"><strong>1.å…¨å€¼åŒ¹é…æŸ¥è¯¢æ—¶</strong></h3><p>â€‹<img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521202947593-2126832810.png" class="" title="img"></p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521203003652-366842075.png" class="" title="img"><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521203020127-1655735915.png" class="" title="img"><p>é€šè¿‡è§‚å¯Ÿä¸Šé¢çš„ç»“æœå›¾å¯çŸ¥ï¼Œwhereåé¢çš„æŸ¥è¯¢æ¡ä»¶ï¼Œä¸è®ºæ˜¯ä½¿ç”¨ï¼ˆidï¼Œageï¼Œnameï¼‰ï¼ˆnameï¼Œidï¼Œageï¼‰è¿˜æ˜¯ï¼ˆageï¼Œnameï¼Œidï¼‰é¡ºåºï¼Œåœ¨æŸ¥è¯¢æ—¶éƒ½ä½¿ç”¨åˆ°äº†è”åˆç´¢å¼•ï¼Œå¯èƒ½æœ‰åŒå­¦ä¼šç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆåº•ä¸‹ä¸¤ä¸ªçš„æœç´¢æ¡ä»¶æ˜æ˜æ²¡æœ‰æŒ‰ç…§è”åˆç´¢å¼•ä»å·¦åˆ°å³è¿›è¡ŒåŒ¹é…ï¼Œå´ä¹Ÿä½¿ç”¨åˆ°äº†è”åˆç´¢å¼•ï¼Ÿ è¿™æ˜¯å› ä¸º<strong>MySQLä¸­æœ‰æŸ¥è¯¢ä¼˜åŒ–å™¨explainï¼Œæ‰€ä»¥sqlè¯­å¥ä¸­å­—æ®µçš„é¡ºåºä¸éœ€è¦å’Œè”åˆç´¢å¼•å®šä¹‰çš„å­—æ®µé¡ºåºç›¸åŒï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šåˆ¤æ–­çº æ­£è¿™æ¡SQLè¯­å¥ä»¥ä»€ä¹ˆæ ·çš„é¡ºåºæ‰§è¡Œæ•ˆç‡é«˜</strong>ï¼Œæœ€åæ‰èƒ½ç”ŸæˆçœŸæ­£çš„æ‰§è¡Œè®¡åˆ’ï¼Œæ‰€ä»¥ä¸è®ºä»¥ä½•ç§é¡ºåºéƒ½å¯ä½¿ç”¨åˆ°è”åˆç´¢å¼•ã€‚å¦å¤–é€šè¿‡è§‚å¯Ÿä¸Š<strong>é¢ä¸‰ä¸ªå›¾ä¸­çš„key_lenå­—æ®µï¼Œä¹Ÿå¯è¯´æ˜åœ¨æœç´¢æ—¶ä½¿ç”¨çš„è”åˆç´¢å¼•ä¸­çš„ï¼ˆid_name_ageï¼‰ç´¢å¼•</strong>ï¼Œå› ä¸ºidä¸ºintå‹ï¼Œå…è®¸nullï¼Œæ‰€ä»¥å 5ä¸ªå­—èŠ‚ï¼Œnameä¸ºchar(10)ï¼Œå…è®¸nullï¼Œåˆä½¿ç”¨çš„æ˜¯latin1ç¼–ç ï¼Œæ‰€ä»¥å 11ä¸ªå­—èŠ‚ï¼Œageä¸ºintå‹å…è®¸nullï¼Œæ‰€ä»¥ä¹Ÿå ç”¨5ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è¯¥ç´¢å¼•é•¿åº¦ä¸º21ï¼ˆ5+11+5ï¼‰ï¼Œè€Œä¸Šé¢key_lençš„å€¼ä¹Ÿæ­£å¥½ä¸º21ï¼Œ<strong>å¯è¯æ˜ä½¿ç”¨çš„ï¼ˆid_name_ageï¼‰ç´¢å¼•</strong>ã€‚</p><h3 id="2-åŒ¹é…æœ€å·¦è¾¹çš„åˆ—æ—¶"><strong>2.åŒ¹é…æœ€å·¦è¾¹çš„åˆ—æ—¶</strong></h3><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521202447168-1029938685.png" class="" title="img"><p>è¯¥æœç´¢æ˜¯éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™çš„ï¼Œé€šè¿‡keyå­—æ®µä¹Ÿå¯çŸ¥ï¼Œåœ¨æœç´¢è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°äº†è”åˆç´¢å¼•ï¼Œä¸”ä½¿ç”¨çš„æ˜¯è”åˆç´¢å¼•ä¸­çš„ï¼ˆidï¼‰ç´¢å¼•ï¼Œå› ä¸º<strong>key_lenå­—æ®µå€¼ä¸º5ï¼Œè€Œidç´¢å¼•çš„é•¿åº¦æ­£å¥½ä¸º5</strong>ï¼ˆå› ä¸ºidä¸ºintå‹ï¼Œå…è®¸nullï¼Œæ‰€ä»¥å 5ä¸ªå­—èŠ‚ï¼‰ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521202737461-1486677111.png" class="" title="img"><p><strong>ç”±äºidåˆ°nameæ˜¯ä»å·¦è¾¹ä¾æ¬¡å¾€å³è¾¹åŒ¹é…ï¼Œè¿™ä¸¤ä¸ªå­—æ®µä¸­çš„å€¼éƒ½æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ä¹Ÿéµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™</strong>ï¼Œé€šè¿‡keyå­—æ®µå¯çŸ¥ï¼Œåœ¨æœç´¢è¿‡ç¨‹ä¸­ä¹Ÿä½¿ç”¨åˆ°äº†è”åˆç´¢å¼•ï¼Œä½†ä½¿ç”¨çš„æ˜¯è”åˆç´¢å¼•ä¸­çš„ï¼ˆid_nameï¼‰ç´¢å¼•ï¼Œå› ä¸ºkey_lenå­—æ®µå€¼ä¸º16ï¼Œè€Œ(id_name)ç´¢å¼•çš„é•¿åº¦æ­£å¥½ä¸º16ï¼ˆå› ä¸ºidä¸ºintå‹ï¼Œå…è®¸nullï¼Œæ‰€ä»¥å 5ä¸ªå­—èŠ‚ï¼Œnameä¸ºchar(10)ï¼Œå…è®¸nullï¼Œåˆä½¿ç”¨çš„æ˜¯latin1ç¼–ç ï¼Œæ‰€ä»¥å 11ä¸ªå­—èŠ‚ï¼‰ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521202810363-1061003410.png" class="" title="img"><p>ç”±äºä¸Šé¢ä¸‰ä¸ªæœç´¢éƒ½æ˜¯ä»æœ€å·¦è¾¹idä¾æ¬¡å‘å³å¼€å§‹åŒ¹é…çš„ï¼Œæ‰€ä»¥éƒ½ç”¨åˆ°äº†id_name_age_indexè”åˆç´¢å¼•ã€‚</p><p><strong>==é‚£å¦‚æœä¸æ˜¯ä¾æ¬¡åŒ¹é…å‘¢ï¼Ÿ==</strong></p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521204203700-302471529.png" class="" title="img"><p>é€šè¿‡keyå­—æ®µå¯çŸ¥ï¼Œåœ¨æœç´¢è¿‡ç¨‹ä¸­ä¹Ÿä½¿ç”¨åˆ°äº†è”åˆç´¢å¼•ï¼Œä½†ä½¿ç”¨çš„æ˜¯è”åˆç´¢å¼•ä¸­çš„ï¼ˆidï¼‰ç´¢å¼•ï¼Œä»key_lenå­—æ®µä¹Ÿå¯çŸ¥ã€‚å› ä¸ºè”åˆç´¢å¼•æ ‘æ˜¯æŒ‰ç…§idå­—æ®µåˆ›å»ºçš„ï¼Œ<strong>ä½†ageç›¸å¯¹äºidæ¥è¯´æ˜¯æ— åºçš„ï¼Œåªæœ‰idåªæœ‰åºçš„ï¼Œæ‰€ä»¥ä»–åªèƒ½ä½¿ç”¨è”åˆç´¢å¼•ä¸­çš„idç´¢å¼•ã€‚</strong></p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521203757147-65081383.png" class="" title="img"><p>é€šè¿‡è§‚å¯Ÿå‘ç°ä¸Šé¢keyå­—æ®µå‘ç°åœ¨æœç´¢ä¸­ä¹Ÿä½¿ç”¨äº†id_name_age_indexç´¢å¼•ï¼Œå¯èƒ½è®¸å¤šåŒå­¦å°±ä¼šç–‘æƒ‘å®ƒå¹¶æ²¡æœ‰éµå®ˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼ŒæŒ‰é“ç†ä¼šç´¢å¼•å¤±æ•ˆï¼Œä¸ºä»€ä¹ˆä¹Ÿä½¿ç”¨åˆ°äº†è”åˆç´¢å¼•ï¼Ÿ<strong>å› ä¸ºæ²¡æœ‰ä»idå¼€å§‹åŒ¹é…ï¼Œä¸”nameå•ç‹¬æ¥è¯´æ˜¯æ— åºçš„ï¼Œæ‰€ä»¥å®ƒç¡®å®ä¸éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œç„¶è€Œä»typeå­—æ®µå¯çŸ¥ï¼Œå®ƒè™½ç„¶ä½¿ç”¨äº†è”åˆç´¢å¼•ï¼Œä½†æ˜¯å®ƒæ˜¯å¯¹æ•´ä¸ªç´¢å¼•æ ‘è¿›è¡Œäº†æ‰«æï¼Œæ­£å¥½åŒ¹é…åˆ°è¯¥ç´¢å¼•ï¼Œä¸æœ€å·¦åŒ¹é…åŸåˆ™æ— å…³</strong>ï¼Œä¸€èˆ¬åªè¦æ˜¯æŸè”åˆç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼Œä½†åˆä¸éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™æ—¶ï¼Œéƒ½å¯èƒ½ä¼šé‡‡ç”¨indexç±»å‹çš„æ–¹å¼æ‰«æï¼Œä½†å®ƒçš„æ•ˆç‡è¿œä¸å¦‚æœ€åšåŒ¹é…åŸåˆ™çš„æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œindexç±»å‹ç±»å‹çš„æ‰«ææ–¹å¼æ˜¯ä»ç´¢å¼•ç¬¬ä¸€ä¸ªå­—æ®µä¸€ä¸ªä¸€ä¸ªçš„æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¦åˆçš„æŸä¸ªç´¢å¼•ï¼Œ<strong>ä¸allä¸åŒçš„æ˜¯ï¼Œindexæ˜¯å¯¹æ‰€æœ‰ç´¢å¼•æ ‘è¿›è¡Œæ‰«æï¼Œè€Œallæ˜¯å¯¹æ•´ä¸ªç£ç›˜çš„æ•°æ®è¿›è¡Œå…¨è¡¨æ‰«æã€‚</strong></p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521203731486-172947522.png" class="" title="img"><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521203818877-809915868.png" class="" title="img"><p>è¿™ä¸¤ä¸ªç»“æœè·Ÿä¸Šé¢çš„æ˜¯åŒæ ·çš„é“ç†ï¼Œç”±äºå®ƒä»¬éƒ½æ²¡æœ‰ä»æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ï¼Œæ‰€ä»¥æ²¡æœ‰ç”¨åˆ°è”åˆç´¢å¼•ï¼Œä½¿ç”¨çš„<strong>éƒ½æ˜¯indexå…¨ç´¢å¼•æ‰«æã€‚</strong></p><h3 id="3-åŒ¹é…åˆ—å‰ç¼€"><strong>3.åŒ¹é…åˆ—å‰ç¼€</strong></h3><p>å¦‚æœidæ˜¯å­—ç¬¦å‹ï¼Œé‚£ä¹ˆå‰ç¼€åŒ¹é…ç”¨çš„æ˜¯ç´¢å¼•ï¼Œä¸­å å’Œåç¼€ç”¨çš„æ˜¯å…¨è¡¨æ‰«æã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> staffs <span class="hljs-keyword">where</span> id <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;A%&#x27;</span>;<span class="hljs-operator">/</span><span class="hljs-operator">/</span>å‰ç¼€éƒ½æ˜¯æ’å¥½åºçš„ï¼Œä½¿ç”¨çš„éƒ½æ˜¯è”åˆç´¢å¼•<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> staffs <span class="hljs-keyword">where</span> id <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%A%&#x27;</span>;<span class="hljs-operator">/</span><span class="hljs-operator">/</span>å…¨è¡¨æŸ¥è¯¢<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> staffs <span class="hljs-keyword">where</span> id <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%A&#x27;</span>;<span class="hljs-operator">/</span><span class="hljs-operator">/</span>å…¨è¡¨æŸ¥è¯¢<br></code></pre></td></tr></table></figure><h3 id="4-åŒ¹é…èŒƒå›´å€¼"><strong>4.åŒ¹é…èŒƒå›´å€¼</strong></h3><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521210125009-1177423028.png" class="" title="img"><p>åœ¨åŒ¹é…çš„è¿‡ç¨‹ä¸­<strong>é‡åˆ°&lt;&gt;=å·ï¼Œå°±ä¼šåœæ­¢åŒ¹é…</strong>ï¼Œä½†idæœ¬èº«å°±æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥é€šè¿‡possible_keyså­—æ®µå’Œkey_len å­—æ®µå¯çŸ¥ï¼Œåœ¨è¯¥æœç´¢è¿‡ç¨‹ä¸­<strong>ä½¿ç”¨äº†è”åˆç´¢å¼•çš„idç´¢å¼•</strong>ï¼ˆå› ä¸ºidä¸ºintå‹ï¼Œå…è®¸nullï¼Œæ‰€ä»¥å 5ä¸ªå­—èŠ‚ï¼‰ï¼Œä¸”è¿›è¡Œçš„æ˜¯rangèŒƒå›´æŸ¥è¯¢ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200522115901524-226070462.png" class="" title="img"><p>ç”±äºä¸éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œä¸”åœ¨<strong>id&lt;4çš„èŒƒå›´ä¸­ï¼Œageæ˜¯æ— åºçš„ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯indexå…¨ç´¢å¼•æ‰«æ</strong>ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521210146172-1428008775.png" class="" title="img"><p>ä¸éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œä½†åœ¨æ•°æ®åº“ä¸­id&lt;2çš„åªæœ‰ä¸€æ¡ï¼ˆidï¼‰ï¼Œæ‰€ä»¥åœ¨<strong>id&lt;2çš„èŒƒå›´ä¸­ï¼Œageæ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯rangèŒƒå›´æŸ¥è¯¢ã€‚</strong><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521210203002-1943736888.png" class="" title="img"></p><p>ä¸éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œè€Œageåˆæ˜¯æ— åºçš„ï¼Œæ‰€ä»¥è¿›è¡Œçš„<strong>å…¨ç´¢å¼•æ‰«æ</strong>ã€‚</p><h3 id="5-å‡†ç¡®åŒ¹é…ç¬¬ä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å…¶ä»–æŸä¸€åˆ—"><strong>5.å‡†ç¡®åŒ¹é…ç¬¬ä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å…¶ä»–æŸä¸€åˆ—</strong></h3><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E7%B4%A2%E5%BC%95/1804577-20200521210726024-2037980339.png" class="" title="img"><p>ç”±äºæœç´¢ä¸­æœ‰id=1ï¼Œæ‰€ä»¥åœ¨idèŒƒå›´å†…ageæ˜¯æ— åºçš„ï¼Œæ‰€ä»¥åª<strong>ä½¿ç”¨äº†è”åˆç´¢å¼•ä¸­çš„idç´¢å¼•ã€‚</strong></p><h2 id="ã€ç´¢å¼•ä¼˜åŒ–é—®é¢˜ã€‘">ã€ç´¢å¼•ä¼˜åŒ–é—®é¢˜ã€‘</h2><p><strong>1.åˆ›å»ºç´¢å¼•</strong></p><p>å¯¹äºæŸ¥è¯¢å ä¸»è¦çš„åº”ç”¨æ¥è¯´ï¼Œç´¢å¼•æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚å¾ˆå¤šæ—¶å€™æ€§èƒ½é—®é¢˜å¾ˆç®€å•çš„å°±æ˜¯å› ä¸ºæˆ‘ä»¬å¿˜äº†æ·»åŠ ç´¢å¼•è€Œé€ æˆçš„ï¼Œæˆ–è€…è¯´æ²¡æœ‰æ·»åŠ æ›´ä¸ºæœ‰æ•ˆçš„ç´¢å¼•å¯¼è‡´ã€‚å¦‚æœä¸åŠ </p><p>ç´¢å¼•çš„è¯ï¼Œé‚£ä¹ˆæŸ¥æ‰¾ä»»ä½•å“ªæ€•åªæ˜¯ä¸€æ¡ç‰¹å®šçš„æ•°æ®éƒ½ä¼šè¿›è¡Œä¸€æ¬¡å…¨è¡¨æ‰«æï¼Œå¦‚æœä¸€å¼ è¡¨çš„æ•°æ®é‡å¾ˆå¤§è€Œç¬¦åˆæ¡ä»¶çš„ç»“æœåˆå¾ˆå°‘ï¼Œé‚£ä¹ˆä¸åŠ ç´¢å¼•ä¼šå¼•èµ·è‡´å‘½çš„æ€§èƒ½ä¸‹é™ã€‚ä½†æ˜¯ä¹Ÿä¸æ˜¯ä»€ä¹ˆæƒ…å†µéƒ½éå¾—å»ºç´¢å¼•ä¸å¯ï¼Œ<strong>æ¯”å¦‚æ€§åˆ«å¯èƒ½å°±åªæœ‰ä¸¤ä¸ªå€¼ï¼Œå»ºç´¢å¼•ä¸ä»…æ²¡ä»€ä¹ˆä¼˜åŠ¿ï¼Œè¿˜ä¼šå½±å“åˆ°æ›´æ–°é€Ÿåº¦ï¼Œè¿™è¢«ç§°ä¸ºè¿‡åº¦ç´¢å¼•ã€‚</strong></p><p><strong>2.å¤åˆç´¢å¼•</strong></p><p>æ¯”å¦‚æœ‰ä¸€æ¡è¯­å¥æ˜¯è¿™æ ·çš„ï¼šselect * from users where area=â€™beijingâ€™ and age=22;</p><p>å¦‚æœæˆ‘ä»¬æ˜¯åœ¨areaå’Œageä¸Š<strong>åˆ†åˆ«åˆ›å»º</strong>å•ä¸ªç´¢å¼•çš„è¯ï¼Œç”±äºmysqlæŸ¥è¯¢æ¯æ¬¡åªèƒ½ä½¿ç”¨<strong>ä¸€ä¸ªç´¢å¼•</strong>ï¼Œæ‰€ä»¥è™½ç„¶è¿™æ ·å·²ç»ç›¸å¯¹ä¸åšç´¢å¼•æ—¶å…¨è¡¨æ‰«ææé«˜äº†å¾ˆå¤šæ•ˆç‡ï¼Œä½†æ˜¯å¦‚æœåœ¨areaã€ageä¸¤åˆ—ä¸Šåˆ›å»ºå¤åˆç´¢å¼•çš„è¯å°†å¸¦æ¥æ›´é«˜çš„æ•ˆç‡ã€‚å¦‚æœæˆ‘ä»¬åˆ›å»ºäº†(area, age,salary)çš„å¤åˆç´¢å¼•ï¼Œé‚£ä¹ˆå…¶å®ç›¸å½“äºåˆ›å»ºäº†(area,age,salary)ã€(area,age)ã€(area)ä¸‰ä¸ªç´¢å¼•ï¼Œè¿™è¢«ç§°ä¸ºæœ€ä½³å·¦å‰ç¼€ç‰¹æ€§ã€‚<strong>å› æ­¤æˆ‘ä»¬åœ¨åˆ›å»ºå¤åˆç´¢å¼•æ—¶åº”è¯¥å°†æœ€å¸¸ç”¨ä½œé™åˆ¶æ¡ä»¶çš„åˆ—æ”¾åœ¨æœ€å·¦è¾¹ï¼Œä¾æ¬¡é€’å‡ã€‚</strong></p><p><strong>3.ç´¢å¼•ä¸ä¼šåŒ…å«æœ‰NULLå€¼çš„åˆ—</strong></p><p>åªè¦åˆ—ä¸­åŒ…å«æœ‰NULLå€¼éƒ½å°†ä¸ä¼šè¢«åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼Œ<strong>å¤åˆç´¢å¼•ä¸­åªè¦æœ‰ä¸€åˆ—å«æœ‰NULLå€¼ï¼Œé‚£ä¹ˆè¿™ä¸€åˆ—å¯¹äºæ­¤å¤åˆç´¢å¼•å°±æ˜¯æ— æ•ˆçš„</strong>ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ•°æ®åº“è®¾è®¡æ—¶ä¸è¦è®©å­—æ®µçš„é»˜è®¤å€¼ä¸ºNULLã€‚</p><p><strong>4.ä½¿ç”¨çŸ­ç´¢å¼•</strong></p><p><strong>å¯¹ä¸²åˆ—è¿›è¡Œç´¢å¼•ï¼Œå¦‚æœå¯èƒ½åº”è¯¥æŒ‡å®šä¸€ä¸ªå‰ç¼€é•¿åº¦</strong>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªCHAR(255)çš„ åˆ—ï¼Œå¦‚æœåœ¨å‰10 ä¸ªæˆ–20 ä¸ªå­—ç¬¦å†…ï¼Œå¤šæ•°å€¼æ˜¯æƒŸä¸€çš„ï¼Œé‚£ä¹ˆå°±ä¸è¦å¯¹æ•´ä¸ªåˆ—è¿›è¡Œç´¢å¼•ã€‚<strong>çŸ­ç´¢å¼•ä¸ä»…å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦è€Œä¸”å¯ä»¥èŠ‚çœç£ç›˜ç©ºé—´å’ŒI/Oæ“ä½œã€‚</strong></p><p><strong>5.æ’åºçš„ç´¢å¼•é—®é¢˜</strong></p><p>mysqlæŸ¥è¯¢åªä½¿ç”¨ä¸€ä¸ªç´¢å¼•ï¼Œ<strong>å› æ­¤å¦‚æœwhereå­å¥ä¸­å·²ç»ä½¿ç”¨äº†ç´¢å¼•çš„è¯ï¼Œé‚£ä¹ˆorder byä¸­çš„åˆ—æ˜¯ä¸ä¼šä½¿ç”¨ç´¢å¼•çš„</strong>ã€‚å› æ­¤æ•°æ®åº“é»˜è®¤æ’åºå¯ä»¥<strong>ç¬¦åˆè¦æ±‚çš„æƒ…å†µä¸‹ä¸è¦ä½¿ç”¨æ’åºæ“ä½œ</strong>ï¼›å°½é‡ä¸è¦åŒ…å«<strong>å¤šä¸ªåˆ—çš„æ’åº</strong>ï¼Œå¦‚æœéœ€è¦æœ€å¥½ç»™è¿™äº›åˆ—åˆ›å»º<strong>å¤åˆç´¢å¼•</strong>ã€‚</p><p><strong>6.likeè¯­å¥æ“ä½œ</strong></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ä¸é¼“åŠ±ä½¿ç”¨likeæ“ä½œï¼Œå¦‚æœéä½¿ç”¨ä¸å¯ï¼Œå¦‚ä½•ä½¿ç”¨ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚l<strong>ike â€œ%aaa%â€ ä¸ä¼šä½¿ç”¨ç´¢å¼•è€Œlike â€œaaa%â€å¯ä»¥ä½¿ç”¨ç´¢å¼•ã€‚</strong></p><p><strong>7.ä¸è¦åœ¨åˆ—ä¸Šè¿›è¡Œè¿ç®—</strong></p><p>select * from users where YEAR(adddate)</p><p><strong>8.ä¸ä½¿ç”¨NOT IN</strong></p><p>NOT INéƒ½ä¸ä¼šä½¿ç”¨ç´¢å¼•å°†è¿›è¡Œå…¨è¡¨æ‰«æã€‚NOT INå¯ä»¥<strong>NOT EXISTSä»£æ›¿</strong></p><h3 id="ã€æ…¢SQLä¼˜åŒ–ã€‘">ã€æ…¢SQLä¼˜åŒ–ã€‘</h3><h4 id="ã€å¦‚ä½•åˆ†ææ…¢SQLè¯­å¥ã€‘">ã€å¦‚ä½•åˆ†ææ…¢SQLè¯­å¥ã€‘</h4><ul><li>é€šè¿‡æ…¢æ—¥å¿—æ£€æŸ¥</li><li>é€šè¿‡explain</li></ul><p>é¦–å…ˆè¦ææ˜ç™½æ…¢çš„åŸå› æ˜¯ä»€ä¹ˆï¼šæ˜¯æŸ¥è¯¢æ¡ä»¶æ²¡æœ‰å‘½ä¸­ç´¢å¼•ï¼Ÿè¿˜æ˜¯ load äº†ä¸éœ€è¦çš„æ•°æ®åˆ—ï¼Ÿè¿˜æ˜¯æ•°æ®é‡å¤ªå¤§ï¼Ÿæ‰€ä»¥ä¼˜åŒ–ä¹Ÿæ˜¯é’ˆå¯¹è¿™ä¸‰ä¸ªæ–¹å‘æ¥çš„ã€‚</p><h4 id="ã€SQLè¯­å¥ä¼˜åŒ–ã€‘">ã€SQLè¯­å¥ä¼˜åŒ–ã€‘</h4><ul><li><p>é¦–å…ˆç”¨ explain åˆ†æè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼ŒæŸ¥çœ‹ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µï¼Œæ˜¯ä¸æ˜¯æŸ¥è¯¢æ²¡èµ°ç´¢å¼•ï¼Œå¦‚æœå¯ä»¥åŠ ç´¢å¼•è§£å†³ï¼Œä¼˜å…ˆé‡‡ç”¨åŠ ç´¢å¼•è§£å†³ã€‚</p></li><li><p>åˆ†æè¯­å¥ï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨ä¸€äº›å¯¼è‡´ç´¢å¼•å¤±æ•ˆçš„ç”¨æ³•ï¼Œæ˜¯å¦ load äº†é¢å¤–çš„æ•°æ®ï¼Œæ˜¯å¦åŠ è½½äº†è®¸å¤šç»“æœä¸­å¹¶ä¸éœ€è¦çš„åˆ—ï¼Œå¯¹è¯­å¥è¿›è¡Œåˆ†æä»¥åŠé‡å†™ã€‚æ…ç”¨éƒ¨åˆ†å…³é”®å­—ï¼Œå¦‚distinctã€unionå…³é”®å­—ç­‰ã€‚</p></li><li><p>å¦‚æœå¯¹è¯­å¥çš„ä¼˜åŒ–å·²ç»æ— æ³•è¿›è¡Œï¼Œå¯ä»¥è€ƒè™‘è¡¨ä¸­çš„æ•°æ®é‡æ˜¯å¦å¤ªå¤§ï¼Œå¦‚æœæ˜¯çš„è¯å¯ä»¥è¿›è¡Œå‚ç›´æ‹†åˆ†æˆ–è€…æ°´å¹³æ‹†åˆ†ã€‚</p></li><li><p>èŒƒå›´æŸ¥è¯¢ï¼Œæ¯”å¦‚åœ¨æŸ¥è¯¢æŸæ¡è¯­å¥æ—¶ï¼ŒåŠ å…¥limit 1,ç­‰é™åˆ¶ã€‚</p></li><li><p><strong>ä¿è¯ä¸æŸ¥è¯¢å¤šä½™çš„åˆ—ä¸è¡Œã€‚</strong></p></li><li><p>å¦‚æœä½ åŒæ—¶ä¿®æ”¹æˆ–åˆ é™¤è¿‡å¤šæ•°æ®ï¼Œä¼šé€ æˆcpuåˆ©ç”¨ç‡è¿‡é«˜ä»è€Œå½±å“åˆ«äººå¯¹æ•°æ®åº“çš„è®¿é—®ã€‚å¦‚æœä½ åˆ é™¤æˆ–ä¿®æ”¹è¿‡å¤šæ•°æ®ï¼Œé‡‡ç”¨å•ä¸€å¾ªç¯æ“ä½œï¼Œé‚£ä¹ˆä¼šæ˜¯æ•ˆç‡å¾ˆä½ï¼Œä¹Ÿå°±æ˜¯æ“ä½œæ—¶é—´è¿‡ç¨‹ä¼šå¾ˆæ¼«é•¿ã€‚</p><p>è¿™æ ·ä½ è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>æŠ˜ä¸­çš„åŠæ³•å°±æ˜¯ï¼Œåˆ†æ‰¹æ“ä½œæ•°æ®ã€‚</p></li><li><p>è¿æ¥æŸ¥è¯¢çš„ä¼˜åŒ–</p><ul><li><p>é¦–å…ˆä½ è¦å¼„æ˜ç™½ä½ æƒ³è¦çš„æ•°æ®æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œç„¶åå†åšå‡ºå†³å®šä½¿ç”¨å“ªä¸€ç§è¿æ¥ï¼Œè¿™å¾ˆé‡è¦ã€‚</p><p>å„ç§è¿æ¥çš„å–å€¼å¤§å°ä¸ºï¼š</p><ul><li>å†…è¿æ¥ç»“æœé›†å¤§å°å–å†³äºå·¦å³è¡¨æ»¡è¶³æ¡ä»¶çš„æ•°é‡</li><li>å·¦è¿æ¥å–å†³ä¸å·¦è¡¨å¤§å°ï¼Œå³ç›¸åã€‚</li><li>å®Œå…¨è¿æ¥å’Œäº¤å‰è¿æ¥å–å†³ä¸å·¦å³ä¸¤ä¸ªè¡¨çš„æ•°æ®æ€»æ•°é‡</li></ul></li></ul></li></ul><h2 id="ã€hashã€‘vsã€çº¢é»‘æ ‘ã€‘vsã€Bæ ‘ã€‘vsã€B-æ ‘ã€‘">ã€hashã€‘vsã€çº¢é»‘æ ‘ã€‘vsã€Bæ ‘ã€‘vsã€B+æ ‘ã€‘</h2><p><strong>çº¢é»‘æ ‘</strong>ï¼šå¦‚æœåœ¨å†…å­˜ä¸­ï¼Œçº¢é»‘æ ‘çš„æŸ¥æ‰¾æ•ˆç‡æ¯”Bæ ‘æ›´é«˜ï¼Œä½†æ˜¯æ¶‰åŠåˆ°ç£ç›˜æ“ä½œï¼ŒBæ ‘å°±æ›´ä¼˜äº†ã€‚å› ä¸ºçº¢é»‘æ ‘æ˜¯äºŒå‰æ ‘ï¼Œæ•°æ®é‡å¤§æ—¶æ ‘çš„å±‚æ•°å¾ˆé«˜ï¼Œä»æ ‘çš„æ ¹ç»“ç‚¹å‘ä¸‹å¯»æ‰¾çš„è¿‡ç¨‹ï¼Œæ¯è¯»1ä¸ªèŠ‚ç‚¹ï¼Œéƒ½ç›¸å½“äºä¸€æ¬¡IOæ“ä½œï¼Œå› æ­¤çº¢é»‘æ ‘çš„I/Oæ“ä½œä¼šæ¯”Bæ ‘å¤šçš„å¤šã€‚</p><p><strong>hash ç´¢å¼•</strong>ï¼šå¦‚æœåªæŸ¥è¯¢å•ä¸ªå€¼çš„è¯ï¼Œhash ç´¢å¼•çš„æ•ˆç‡éå¸¸é«˜ã€‚ä½†æ˜¯ hash ç´¢å¼•æœ‰å‡ ä¸ªé—®é¢˜ï¼š1ï¼‰ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼›2ï¼‰ä¸æ”¯æŒç´¢å¼•å€¼çš„æ’åºæ“ä½œï¼›3ï¼‰ä¸æ”¯æŒè”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…è§„åˆ™ã€‚</p><p><strong>Bæ ‘ç´¢å¼•</strong>ï¼šBæ ‘ç´¢ç›¸æ¯”äºB+æ ‘ï¼Œåœ¨è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œéœ€è¦åšå±€éƒ¨çš„ä¸­åºéå†ï¼Œå¯èƒ½è¦è·¨å±‚è®¿é—®ï¼Œè·¨å±‚è®¿é—®ä»£è¡¨ç€è¦è¿›è¡Œé¢å¤–çš„ç£ç›˜I/Oæ“ä½œï¼›å¦å¤–ï¼ŒBæ ‘çš„éå¶å­èŠ‚ç‚¹å­˜æ”¾äº†æ•°æ®è®°å½•çš„åœ°å€ï¼Œä¼šå¯¼è‡´å­˜æ”¾çš„èŠ‚ç‚¹æ›´å°‘ï¼Œæ ‘çš„å±‚æ•°å˜é«˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlä¸»ä»å¤åˆ¶</title>
    <link href="/dajiangdahe/2021/10/22/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
    <url>/dajiangdahe/2021/10/22/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h1>1.ä»€ä¹ˆæ˜¯ä¸»ä»å¤åˆ¶</h1><p>å°†ä¸»æ•°æ®åº“ä¸­çš„DDLå’ŒDMLæ“ä½œé€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—ä¼ è¾“åˆ°ä»æ•°æ®åº“ä¸Šï¼Œç„¶åå°†è¿™äº›æ—¥å¿—é‡æ–°æ‰§è¡Œï¼ˆé‡åšï¼‰ï¼›ä»è€Œä½¿å¾—ä»æ•°æ®åº“çš„æ•°æ®ä¸ä¸»æ•°æ®åº“ä¿æŒä¸€è‡´ã€‚</p><h1>2.åŸºæœ¬åŸç†</h1><p>MySQLæ”¯æŒå•å‘ã€å¼‚æ­¥å¤åˆ¶ï¼Œå¤åˆ¶è¿‡ç¨‹ä¸­ä¸€ä¸ªæœåŠ¡å™¨å……å½“ä¸»æœåŠ¡å™¨ï¼Œè€Œä¸€ä¸ªæˆ–å¤šä¸ªå…¶å®ƒæœåŠ¡å™¨å……å½“ä»æœåŠ¡å™¨ã€‚</p><p>MySQLå¤åˆ¶æ˜¯åŸºäºä¸»æœåŠ¡å™¨åœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­è·Ÿè¸ªæ‰€æœ‰å¯¹æ•°æ®åº“çš„æ›´æ”¹ã€‚å› æ­¤ï¼Œè¦è¿›è¡Œå¤åˆ¶ï¼Œå¿…é¡»åœ¨ä¸»æœåŠ¡å™¨ä¸Šå¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogæ—¥å¿—ï¼‰ã€‚æ¯ä¸ªä»æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨æ¥æ”¶ä¸»æœåŠ¡å™¨å·²ç»è®°å½•åˆ°æ—¥å¿—çš„æ•°æ®ã€‚</p><p>å½“ä¸€ä¸ªä»æœåŠ¡å™¨è¿æ¥ä¸»æœåŠ¡å™¨æ—¶ï¼Œå®ƒé€šçŸ¥ä¸»æœåŠ¡å™¨ä»æœåŠ¡å™¨åœ¨æ—¥å¿—ä¸­è¯»å–çš„æœ€åä¸€æ¬¡æˆåŠŸæ›´æ–°çš„ä½ç½®ã€‚ä»æœåŠ¡å™¨æ¥æ”¶ä»é‚£æ—¶èµ·å‘ç”Ÿçš„ä»»ä½•æ›´æ–°ï¼Œå¹¶åœ¨æœ¬æœºä¸Šæ‰§è¡Œç›¸åŒçš„æ›´æ–°ã€‚ç„¶åå°é”å¹¶ç­‰å¾…ä¸»æœåŠ¡å™¨é€šçŸ¥æ–°çš„æ›´æ–°ã€‚ä»æœåŠ¡å™¨æ‰§è¡Œå¤‡ä»½ä¸ä¼šå¹²æ‰°ä¸»æœåŠ¡å™¨ï¼Œåœ¨å¤‡ä»½è¿‡ç¨‹ä¸­ä¸»æœåŠ¡å™¨å¯ä»¥ç»§ç»­å¤„ç†æ›´æ–°ã€‚</p><h1>3.ä¸»ä»å¤åˆ¶çš„ä½œç”¨</h1><p>1ã€ä¸»æ•°æ®åº“å‡ºç°é—®é¢˜ï¼Œå¯ä»¥åˆ‡æ¢åˆ°ä»æ•°æ®åº“ã€‚</p><p>2ã€å¯ä»¥è¿›è¡Œæ•°æ®åº“å±‚é¢çš„è¯»å†™åˆ†ç¦»ã€‚</p><p>3ã€å¯ä»¥åœ¨ä»æ•°æ®åº“ä¸Šè¿›è¡Œæ—¥å¸¸å¤‡ä»½ã€‚</p><h1>4.å¤åˆ¶è¿‡ç¨‹</h1><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/1606768-20190408141304873-785770801.png" class="" title="img"><p><em>Binary logï¼šä¸»æ•°æ®åº“çš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚</em></p><p><em>Relay logï¼šä»æœåŠ¡å™¨çš„ä¸­ç»§æ—¥å¿—ã€‚</em></p><p>**ç¬¬ä¸€æ­¥ï¼š**masteråœ¨æ¯ä¸ªäº‹åŠ¡æ›´æ–°æ•°æ®å®Œæˆä¹‹å‰ï¼Œå°†è¯¥æ“ä½œè®°å½•ä¸²è¡Œåœ°å†™å…¥åˆ°binlogæ–‡ä»¶ä¸­ã€‚</p><p>**ç¬¬äºŒæ­¥ï¼š**salveå¼€å¯ä¸€ä¸ªI/O Threadï¼Œè¯¥çº¿ç¨‹åœ¨masteræ‰“å¼€ä¸€ä¸ªæ™®é€šè¿æ¥ï¼Œä¸»è¦å·¥ä½œæ˜¯binlog dump processã€‚å¦‚æœè¯»å–çš„è¿›åº¦å·²ç»è·Ÿä¸Šäº†masterï¼Œå°±è¿›å…¥ç¡çœ çŠ¶æ€å¹¶ç­‰å¾…masteräº§ç”Ÿæ–°çš„äº‹ä»¶ã€‚I/Oçº¿ç¨‹æœ€ç»ˆçš„ç›®çš„æ˜¯å°†è¿™äº›äº‹ä»¶å†™å…¥åˆ°ä¸­ç»§æ—¥å¿—ä¸­ã€‚</p><p>**ç¬¬ä¸‰æ­¥ï¼š**SQL Threadä¼šè¯»å–ä¸­ç»§æ—¥å¿—ï¼Œå¹¶é¡ºåºæ‰§è¡Œè¯¥æ—¥å¿—ä¸­çš„SQLäº‹ä»¶ï¼Œä»è€Œä¸ä¸»æ•°æ®åº“ä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlä¸­çš„é”</title>
    <link href="/dajiangdahe/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/"/>
    <url>/dajiangdahe/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h1>Mysqlä¸­çš„é”</h1><p><strong>æ ¹æ®åŠ é”çš„èŒƒå›´ï¼ŒMySQLé‡Œé¢çš„é”å¤§è‡´å¯ä»¥åˆ†æˆå…¨å±€é”ã€è¡¨çº§é”å’Œè¡Œé”ä¸‰ç±»ã€‚</strong></p><h2 id="1-å…¨å±€é”">1.å…¨å±€é”</h2><p>å…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ã€‚MySQLæä¾›äº†ä¸€ä¸ªåŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼Œå‘½ä»¤æ˜¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">Flush tables <span class="hljs-keyword">with</span> read lock<br></code></pre></td></tr></table></figure><p>å½“éœ€è¦è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹‹åå…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ï¼šæ•°æ®æ›´æ–°è¯­å¥ï¼ˆæ•°æ®çš„å¢åˆ æ”¹ï¼‰ã€æ•°æ®å®šä¹‰è¯­å¥ï¼ˆåŒ…æ‹¬å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“æ„ç­‰ï¼‰å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ã€‚</p><p>**å…¨å±€é”çš„å…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œåšå…¨åº“é€»è¾‘å¤‡ä»½ã€‚**ä¹Ÿå°±æ˜¯æŠŠæ•´åº“æ¯ä¸ªè¡¨éƒ½selectå‡ºæ¥å­˜æˆæ–‡æœ¬</p><p>ä½†æ˜¯è®©æ•´ä¸ªåº“éƒ½åªè¯»ï¼Œå¯èƒ½å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>å¦‚æœåœ¨ä¸»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´éƒ½ä¸èƒ½æ‰§è¡Œæ›´æ–°ï¼Œä¸šåŠ¡åŸºæœ¬ä¸Šå°±å¾—åœæ‘†</li><li>æœåœ¨ä»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´ä»åº“ä¸èƒ½æ‰§è¡Œä¸»åº“åŒæ­¥è¿‡æ¥çš„binlogï¼Œä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿ<br>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¼€å¯ä¸€ä¸ªäº‹åŠ¡èƒ½å¤Ÿæ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾</li></ul><p>å®˜æ–¹è‡ªå¸¦çš„é€»è¾‘å¤‡ä»½å·¥å…·æ˜¯<strong>mysqldump</strong>ã€‚å½“mysqldumpä½¿ç”¨å‚æ•°â€“single-transactionçš„æ—¶å€™ï¼Œå¯¼æ•°æ®ä¹‹å‰å°±ä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œæ¥ç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾ã€‚è€Œç”±äºMVCCçš„æ”¯æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ•°æ®æ˜¯å¯ä»¥æ­£å¸¸æ›´æ–°çš„ã€‚single-transactionåªé€‚ç”¨äºæ‰€æœ‰çš„è¡¨ä½¿ç”¨äº‹åŠ¡å¼•æ“çš„åº“ã€‚</p><p><strong>1.æ—¢ç„¶è¦å…¨åº“åªè¯»ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨set global readonly=trueçš„æ–¹å¼ï¼Ÿ</strong></p><ul><li>åœ¨æœ‰äº›ç³»ç»Ÿä¸­ï¼Œreadonlyçš„å€¼ä¼šè¢«ç”¨æ¥åšå…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªåº“æ˜¯ä¸»åº“è¿˜æ˜¯å¤‡åº“ã€‚å› æ­¤ä¿®æ”¹globalå˜é‡çš„æ–¹å¼å½±å“é¢æ›´å¤§</li><li>åœ¨å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸Šæœ‰å·®å¼‚ã€‚å¦‚æœæ‰§è¡ŒFlush tables with read lockå‘½ä»¤ä¹‹åç”±äºå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸æ–­å¼€ï¼Œé‚£ä¹ˆMySQLä¼šè‡ªåŠ¨é‡Šæ”¾è¿™ä¸ªå…¨å±€é”ï¼Œæ•´ä¸ªåº“å›åˆ°å¯ä»¥æ­£å¸¸æ›´æ–°çš„çŠ¶æ€ã€‚è€Œå°†æ•´ä¸ªåº“è®¾ç½®ä¸ºreadonlyä¹‹åï¼Œå¦‚æœå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æ•°æ®åº“ä¼šä¸€ç›´ä¿æŒreadonlyçŠ¶æ€ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ•´ä¸ªåº“é•¿æ—¶é—´å¤„äºä¸å¯å†™çŠ¶æ€ï¼Œé£é™©è¾ƒé«˜</li></ul><h2 id="2-è¡¨çº§é”">2.è¡¨çº§é”</h2><p><strong>MySQLé‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDLï¼‰</strong></p><p>è¡¨é”çš„è¯­æ³•æ˜¯lock tables â€¦ read/writeã€‚å¯ä»¥ç”¨unlock tablesä¸»åŠ¨é‡Šæ”¾é”ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­å¼€çš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾ã€‚lock tablesè¯­æ³•é™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™å¤–ï¼Œä¹Ÿé™å®šäº†æœ¬çº¿ç¨‹æ¥ä¸‹æ¥çš„æ“ä½œå¯¹è±¡</p><p>å¦‚æœåœ¨æŸä¸ªçº¿ç¨‹Aä¸­æ‰§è¡Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">lock tables t1 read,t2 wirte;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè¯­å¥ï¼Œåˆ™å…¶ä»–çº¿ç¨‹å†™t1ã€è¯»å†™t2çš„è¯­å¥éƒ½ä¼šè¢«é˜»å¡ã€‚åŒæ—¶ï¼Œçº¿ç¨‹Aåœ¨æ‰§è¡Œunlock tablesä¹‹å‰ï¼Œä¹Ÿåªèƒ½æ‰§è¡Œè¯»t1ã€è¯»å†™t2çš„æ“ä½œã€‚è¿å†™t1éƒ½ä¸å…è®¸</p><p>å¦ä¸€ç±»è¡¨çº§çš„é”æ˜¯MDLã€‚MDLä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚**MDLçš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚**å¦‚æœä¸€ä¸ªæŸ¥è¯¢æ­£åœ¨éå†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œæ‰§è¡ŒæœŸé—´å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªè¡¨ç»“æ„åšäº†å˜æ›´ï¼Œåˆ äº†ä¸€åˆ—ï¼Œé‚£ä¹ˆæŸ¥è¯¢çº¿ç¨‹æ‹¿åˆ°çš„ç»“æœè·Ÿè¡¨ç»“æ„å¯¹ä¸ä¸Šï¼Œè‚¯å®šä¸è¡Œ</p><p>åœ¨MySQL5.5ç‰ˆæœ¬å¼•å…¥äº†MDLï¼Œå½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLè¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLå†™é”ã€‚</p><ul><li><strong>è¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œå› æ­¤å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å¼ è¡¨å¢åˆ æ”¹æŸ¥</strong></li><li><strong>è¯»å†™é”ä¹‹é—´ã€å†™é”ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æ„æ“ä½œçš„å®‰å…¨æ€§ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹è¦åŒæ—¶ç»™ä¸€ä¸ªè¡¨åŠ å­—æ®µï¼Œå…¶ä¸­ä¸€ä¸ªè¦ç­‰å¦ä¸€ä¸ªæ‰§è¡Œå®Œæ‰èƒ½å¼€å§‹æ‰§è¡Œ</strong></li></ul><p>ç»™ä¸€ä¸ªè¡¨åŠ å­—æ®µï¼Œæˆ–è€…ä¿®æ”¹å­—æ®µï¼Œæˆ–è€…åŠ ç´¢å¼•ï¼Œéœ€è¦æ‰«æå…¨è¡¨çš„æ•°æ®ã€‚åœ¨å¯¹å¤§è¡¨æ“ä½œçš„æ—¶å€™ï¼Œéœ€è¦ç‰¹åˆ«å°å¿ƒï¼Œä»¥å…å¯¹çº¿ä¸ŠæœåŠ¡é€ æˆå½±å“ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/201906051620443.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>session Aå…ˆå¯åŠ¨ï¼Œè¿™æ—¶å€™ä¼šå¯¹è¡¨tåŠ ä¸€ä¸ªMDLè¯»é”ã€‚ç”±äºsession Béœ€è¦çš„ä¹Ÿæ˜¯MDLè¯»é”ï¼Œå› æ­¤å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚ä¹‹åsesession Cä¼šè¢«blockedï¼Œæ˜¯å› ä¸ºsession Açš„MDLè¯»é”è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œè€Œsession Céœ€è¦MDLå†™é”ï¼Œå› æ­¤åªèƒ½è¢«é˜»å¡ã€‚å¦‚æœåªæœ‰session Cè‡ªå·±è¢«é˜»å¡è¿˜æ²¡ä»€ä¹ˆå…³ç³»ï¼Œä½†æ˜¯ä¹‹åæ‰€æœ‰è¦åœ¨è¡¨tä¸Šæ–°ç”³è¯·MDLè¯»é”çš„è¯·æ±‚ä¹Ÿä¼šè¢«session Cé˜»å¡ã€‚æ‰€æœ‰å¯¹è¡¨çš„å¢åˆ æ”¹æŸ¥æ“ä½œéƒ½éœ€è¦å…ˆç”³è¯·MDLè¯»é”ï¼Œå°±éƒ½è¢«é”ä½ï¼Œç­‰äºè¿™ä¸ªè¡¨ç°åœ¨å®Œå…¨ä¸å¯è¯»å†™äº†ã€‚</p><p><strong>äº‹åŠ¡ä¸­çš„MDLé”ï¼Œåœ¨è¯­å¥æ‰§è¡Œå¼€å§‹æ—¶ç”³è¯·ï¼Œä½†æ˜¯è¯­å¥ç»“æŸåå¹¶ä¸ä¼šé©¬ä¸Šé‡Šæ”¾ï¼Œè€Œä¼šç­‰åˆ°æ•´ä¸ªäº‹åŠ¡æäº¤åå†é‡Šæ”¾</strong></p><p><strong>1.å¦‚æœå®‰å…¨åœ°ç»™å°è¡¨åŠ å­—æ®µï¼Ÿ</strong></p><p>é¦–å…ˆè¦è§£å†³é•¿äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸æäº¤ï¼Œå°±ä¼šä¸€ç›´å ç€DMLé”ã€‚åœ¨MySQLçš„information_schemaåº“çš„innodb_trxè¡¨ä¸­ï¼Œå¯ä»¥æŸ¥åˆ°å½“å‰æ‰§è¡Œçš„äº‹åŠ¡ã€‚å¦‚æœè¦åšDDLå˜æ›´çš„è¡¨åˆšå¥½æœ‰é•¿äº‹åŠ¡åœ¨æ‰§è¡Œï¼Œè¦è€ƒè™‘å…ˆæš‚åœDDLï¼Œæˆ–è€…killæ‰è¿™ä¸ªé•¿äº‹åŠ¡</p><p><strong>2.å¦‚æœè¦å˜æ›´çš„è¡¨æ˜¯ä¸€ä¸ªçƒ­ç‚¹è¡¨ï¼Œè™½ç„¶æ•°æ®é‡ä¸å¤§ï¼Œä½†æ˜¯ä¸Šé¢çš„è¯·æ±‚å¾ˆé¢‘ç¹ï¼Œè€Œåˆä¸å¾—ä¸åŠ ä¸ªå­—æ®µï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ</strong></p><p>åœ¨alter tableè¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªæŒ‡å®šçš„ç­‰å¾…æ—¶é—´é‡Œé¢èƒ½å¤Ÿæ‹¿åˆ°MDLå†™é”æœ€å¥½ï¼Œæ‹¿ä¸åˆ°ä¹Ÿä¸è¦é˜»å¡åé¢çš„ä¸šåŠ¡è¯­å¥ï¼Œå…ˆæ”¾å¼ƒã€‚ä¹‹åå†é€šè¿‡é‡è¯•å‘½ä»¤é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚</p><h2 id="3-è¡Œçº§é”">3.è¡Œçº§é”</h2><p>MySQLçš„è¡Œé”æ˜¯åœ¨å¼•æ“å±‚ç”±å„ä¸ªå¼•æ“è‡ªå·±å®ç°çš„ã€‚ä½†ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒè¡Œé”ï¼Œæ¯”å¦‚MyISAMå¼•æ“å°±ä¸æ”¯æŒè¡Œé”</p><p>è¡Œé”å°±æ˜¯é’ˆå¯¹æ•°æ®è¡¨ä¸­è¡Œè®°å½•çš„é”ã€‚æ¯”å¦‚äº‹åŠ¡Aæ›´æ–°äº†ä¸€è¡Œï¼Œè€Œè¿™æ—¶å€™äº‹åŠ¡Bä¹Ÿè¦æ›´æ–°åŒä¸€è¡Œï¼Œåˆ™å¿…é¡»ç­‰äº‹åŠ¡Açš„æ“ä½œå®Œæˆåæ‰èƒ½è¿›è¡Œæ›´æ–°ã€‚</p><h3 id="1ã€ä¸¤é˜¶æ®µé”åè®®">1ã€ä¸¤é˜¶æ®µé”åè®®</h3><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162055774.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>äº‹åŠ¡AæŒæœ‰çš„ä¸¤ä¸ªè®°å½•çš„è¡Œé”éƒ½æ˜¯åœ¨commitçš„æ—¶å€™æ‰é‡Šæ”¾çš„ï¼Œäº‹åŠ¡Bçš„updateè¯­å¥ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡Aæ‰§è¡Œcommitä¹‹åï¼Œäº‹åŠ¡Bæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p><p><strong>åœ¨InnoDBäº‹åŠ¡ä¸­ï¼Œè¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚è¿™ä¸ªå°±æ˜¯ä¸¤é˜¶æ®µé”åè®®</strong></p><p><strong>å¦‚æœäº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾</strong></p><p>ã€<strong>ç¤ºä¾‹</strong>ã€‘</p><p>å‡è®¾è¦å®ç°ä¸€ä¸ªç”µå½±ç¥¨åœ¨çº¿äº¤æ˜“ä¸šåŠ¡ï¼Œé¡¾å®¢Aè¦åœ¨å½±é™¢Bè´­ä¹°ç”µå½±ç¥¨ã€‚ä¸šåŠ¡éœ€è¦æ¶‰åŠåˆ°ä»¥ä¸‹æ“ä½œï¼š</p><p>1.ä»é¡¾å®¢Aè´¦æˆ·ä½™é¢ä¸­æ‰£é™¤ç”µå½±ç¥¨ä»·</p><p>2.ç»™å½±é™¢Bçš„è´¦æˆ·ä½™é¢å¢åŠ è¿™å¼ ç”µå½±ç¥¨ä»·</p><p>3.è®°å½•ä¸€æ¡äº¤æ˜“æ—¥å¿—</p><p>ä¸ºäº†ä¿è¯äº¤æ˜“çš„åŸå­æ€§ï¼Œè¦æŠŠè¿™ä¸‰ä¸ªæ“ä½œæ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚å¦‚ä½•å®‰æ’è¿™ä¸‰ä¸ªè¯­å¥åœ¨äº‹åŠ¡ä¸­çš„é¡ºåºå‘¢ï¼Ÿ</p><p>å¦‚æœåŒæ—¶æœ‰å¦å¤–ä¸€ä¸ªé¡¾å®¢Cè¦åœ¨å½±é™¢Bä¹°ç¥¨ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªäº‹åŠ¡å†²çªçš„éƒ¨åˆ†å°±æ˜¯è¯­å¥2äº†ã€‚å› ä¸ºå®ƒä»¬è¦æ›´æ–°åŒä¸€ä¸ªå½±é™¢è´¦æˆ·çš„ä½™é¢ï¼Œéœ€è¦ä¿®æ”¹åŒä¸€è¡Œæ•°æ®ã€‚æ ¹æ®ä¸¤é˜¶æ®µé”åè®®ï¼Œæ‰€æœ‰çš„æ“ä½œéœ€è¦çš„è¡Œé”éƒ½æ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™æ‰é‡Šæ”¾çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœæŠŠè¯­å¥2å®‰æ’åœ¨æœ€åï¼Œæ¯”å¦‚æŒ‰ç…§3ã€1ã€2è¿™æ ·çš„é¡ºåºï¼Œé‚£ä¹ˆå½±é™¢è´¦æˆ·ä½™é¢è¿™ä¸€è¡Œçš„é”æ—¶é—´å°±æœ€å°‘ã€‚è¿™å°±æœ€å¤§ç¨‹åº¦åœ°å‡å°‘äº†äº‹åŠ¡ä¹‹é—´çš„é”ç­‰å¾…ï¼Œæå‡äº†å¹¶å‘åº¦ã€‚</p><h3 id="2ã€æ­»é”å’Œæ­»é”æ£€æµ‹">2ã€æ­»é”å’Œæ­»é”æ£€æµ‹</h3><p><strong>åœ¨å¹¶å‘ç³»ç»Ÿä¸­ä¸åŒçº¿ç¨‹å‡ºç°å¾ªç¯èµ„æºä¾èµ–ï¼Œæ¶‰åŠçš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…åˆ«çš„çº¿ç¨‹é‡Šæ”¾èµ„æºæ—¶ï¼Œå°±ä¼šå¯¼è‡´è¿™å‡ ä¸ªçº¿ç¨‹éƒ½è¿›å…¥æ— é™ç­‰å¾…çš„çŠ¶æ€ï¼Œç§°ä¸ºæ­»é”</strong>ã€‚</p><p><strong>ã€æ­»é”çš„æ¡ä»¶ã€‘ï¼š</strong></p><ul><li><p>äº’æ–¥æ¡ä»¶ï¼šç®€å•çš„è¯´å°±æ˜¯è¿›ç¨‹æŠ¢å¤ºçš„èµ„æºå¿…é¡»æ˜¯ä¸´ç•Œèµ„æºï¼Œä¸€æ®µæ—¶é—´å†…ï¼Œè¯¥èµ„æºåªèƒ½åŒæ—¶è¢«ä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰ã€‚</p></li><li><p>è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šå½“ä¸€ä¸ªè¿›ç¨‹æŒæœ‰äº†ä¸€ä¸ªï¼ˆæˆ–è€…æ›´å¤šï¼‰èµ„æºï¼Œç”³è¯·å¦å¤–çš„èµ„æºçš„æ—¶å€™å‘ç°ç”³è¯·çš„èµ„æºè¢«å…¶ä»–è¿›ç¨‹æ‰€æŒæœ‰ï¼Œå½“å‰è¿›ç¨‹é˜»å¡ï¼Œä½†ä¸ä¼šæ˜¯æ”¾è‡ªå·±æ‰€æŒæœ‰çš„èµ„æºã€‚</p></li><li><p>ä¸å¯æŠ¢å æ¡ä»¶ï¼šè¿›ç¨‹å·²ç»è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œæ¯•çš„æƒ…å†µä¸‹ä¸å¯è¢«å…¶ä»–è¿›ç¨‹æ‰€æŠ¢å ã€‚</p></li><li><p>å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šå­˜åœ¨ä¸€ä¸ªå°é—­çš„è¿›ç¨‹é“¾ï¼Œä½¿å¾—æ¯ä¸ªè¿›ç¨‹è‡³å°‘å æœ‰æ­¤é“¾ä¸­ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰€éœ€è¦çš„ä¸€ä¸ªèµ„æºã€‚</p></li></ul><p><strong>ã€é¢„é˜²æ­»é”ã€‘ï¼š</strong></p><ol><li><p>ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼š</p><p>1.æ‰€æœ‰è¿›ç¨‹åœ¨å¼€å§‹è¿è¡Œä¹‹å‰ï¼Œå¿…é¡»ä¸€æ¬¡æ€§è·å¾—æ‰€æœ‰èµ„æºï¼Œå¦‚æœæ— æ³•è·å¾—å®Œå…¨ï¼Œé‡Šæ”¾å·²ç»è·å¾—çš„èµ„æºï¼Œç­‰å¾…ï¼›</p><p>2.æ‰€æœ‰è¿›ç¨‹åœ¨å¼€å§‹è¿è¡Œä¹‹å‰ï¼Œåªè·å¾—åˆå§‹è¿è¡Œæ‰€éœ€è¦çš„èµ„æºï¼Œç„¶ååœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¸æ–­è¯·æ±‚æ–°çš„èµ„æºï¼ŒåŒæ—¶é‡Šæ”¾è‡ªå·±å·²ç»ç”¨å®Œçš„èµ„æºã€‚</p></li></ol><p>2.ç ´åä¸å¯æŠ¢å æ¡ä»¶ï¼š</p><p>â€‹1.åªè¦å½“ä¸€ä¸ªè¿›ç¨‹ç”³è¯·ä¸€ä¸ªèµ„æºï¼Œç„¶è€Œå´ç”³è¯·ä¸åˆ°çš„æ—¶å€™ï¼Œå¿…é¡»é‡Šæ”¾å·²ç»ç”³è¯·åˆ°çš„æ‰€æœ‰èµ„æºã€‚</p><p>3.ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ï¼š</p><p>â€‹1.è®¾ç«‹ä¸€ä¸ªè§„åˆ™ï¼Œè®©è¿›ç¨‹è·å–èµ„æºçš„æ—¶å€™æŒ‰ç…§ä¸€å®šçš„é¡ºåºä¾æ¬¡ç”³è¯·ï¼Œä¸èƒ½è¿èƒŒè¿™ä¸ªé¡ºåºçš„è§„åˆ™ã€‚å¿…é¡»æŒ‰ç…§é¡ºåºç”³è¯·å’Œé‡Šæ”¾ï¼Œæƒ³è¦ç”³è¯·åé¢çš„èµ„æºå¿…é¡»å…ˆæŠŠè¯¥èµ„æºä¹‹å‰çš„èµ„æºå…¨éƒ¨ç”³è¯·ï¼Œæƒ³è¦ç”³è¯·å‰é¢çš„èµ„æºå¿…é¡»å…ˆæŠŠè¯¥èµ„æºä¹‹åçš„èµ„æºã€‚</p><p>4.ç ´åäº’æ–¥æ¡ä»¶ï¼š</p><p>â€‹æ²¡æ³•ç ´åï¼Œæ˜¯èµ„æºæœ¬èº«çš„æ€§è´¨æ‰€å¼•èµ·çš„ã€‚</p><p><strong>ã€æ­»é”é¿å…ã€‘ï¼š</strong></p><p>1.æœ‰åºèµ„æºåˆ†é…æ³•ï¼š</p><p>â€‹è¿™ç§ç®—æ³•èµ„æºæŒ‰æŸç§è§„åˆ™ç³»ç»Ÿä¸­çš„æ‰€æœ‰èµ„æºç»Ÿä¸€ç¼–å·ï¼ˆä¾‹å¦‚æ‰“å°æœºä¸º1,ã€ç£å¸¦æœºä¸º2ã€ç£ç›˜ä¸º3ã€ç­‰ç­‰ï¼‰ï¼Œç”³è¯·æ—¶å¿…é¡»ä»¥ä¸Šå‡çš„æ¬¡åºã€‚</p><p>â€‹é‡‡ç”¨æœ‰åºèµ„æºåˆ†é…æ³•ï¼šR1çš„ç¼–å·ä¸º1ï¼ŒR2çš„ç¼–å·ä¸º2,ï¼›PAï¼šç”³è¯·æ¬¡åºåº”æ˜¯ï¼šR1ï¼ŒR2ï¼›PBï¼šç”³è¯·æ¬¡åºåº”æ˜¯ï¼šR1ï¼ŒR2ï¼›è¿™æ ·å°±ç ´åäº†ç¯è·¯æ¡ä»¶ï¼Œé¿å…äº†æ­»é”çš„å‘ç”Ÿã€‚</p><p>2.é“¶è¡Œå®¶ç®—æ³•ï¼š</p><p>â€‹è¯¥ç®—æ³•éœ€è¦æ£€æŸ¥ç”³è¯·è€…å¯¹èµ„æºçš„æœ€å¤§éœ€æ±‚é‡ï¼Œå¦‚æœç³»ç»Ÿç°å­˜çš„å„ç±»èµ„æºå¯ä»¥æ»¡è¶³ç”³è¯·è€…çš„è¯·æ±‚ï¼Œå°±æ»¡è¶³ç”³è¯·è€…çš„è¯·æ±‚ã€‚è¿™æ ·ç”³è¯·è€…å°±å¯ä»¥å¾ˆå¿«å®Œæˆå…¶è®¡ç®—ï¼Œç„¶åé‡Šæ”¾å®ƒå ç”¨çš„èµ„æºï¼Œä»è€Œä¿è¯äº†ç³»ç»Ÿä¸­çš„æ‰€æœ‰è¿›ç¨‹éƒ½èƒ½å®Œæˆï¼Œæ‰€ä»¥å¯é¿å…æ­»é”çš„å‘ç”Ÿã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162105380.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>äº‹åŠ¡Aåœ¨ç­‰å¾…äº‹åŠ¡Bé‡Šæ”¾id=2çš„è¡Œé”ï¼Œè€Œäº‹åŠ¡Båœ¨ç­‰å¾…äº‹åŠ¡Aé‡Šæ”¾id=1çš„è¡Œé”ã€‚äº‹åŠ¡Aå’Œäº‹åŠ¡Båœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„èµ„æºé‡Šæ”¾ï¼Œå°±æ˜¯è¿›å…¥äº†æ­»é”çŠ¶æ€ã€‚å½“å‡ºç°æ­»é”ä»¥åï¼Œæœ‰ä¸¤ç§ç­–ç•¥ï¼š</p><p>ä¸€ç§ç­–ç•¥æ˜¯ï¼Œ<strong>ç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶</strong>ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•°innodb_lock_wait_timeoutæ¥è®¾ç½®<br>å¦ä¸€ç§ç­–ç•¥æ˜¯ï¼Œ<strong>å‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡</strong>ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•°<strong>innodb_deadlock_detectè®¾ç½®ä¸ºon</strong>ï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚</p><p>åœ¨InnoDBä¸­ï¼Œ<strong>innodb_lock_wait_timeoutçš„é»˜è®¤å€¼æ˜¯50s</strong>ï¼Œæ„å‘³ç€å¦‚æœé‡‡ç”¨ç¬¬ä¸€ä¸ªç­–ç•¥ï¼Œå½“å‡ºç°æ­»é”ä»¥åï¼Œç¬¬ä¸€ä¸ªè¢«é”ä½çš„çº¿ç¨‹è¦è¿‡50sæ‰ä¼šè¶…æ—¶é€€å‡ºï¼Œç„¶åå…¶ä»–çº¿ç¨‹æ‰æœ‰å¯èƒ½ç»§ç»­æ‰§è¡Œã€‚å¯¹äºåœ¨çº¿æœåŠ¡æ¥è¯´ï¼Œè¿™ä¸ªç­‰å¾…æ—¶é—´å¾€å¾€æ˜¯æ— æ³•æ¥å—çš„</p><p>æ­£å¸¸æƒ…å†µä¸‹è¿˜æ˜¯è¦é‡‡ç”¨ä¸»åŠ¨æ­»é”æ£€æŸ¥ç­–ç•¥ï¼Œè€Œä¸”innodb_deadlock_detectçš„é»˜è®¤å€¼æœ¬èº«å°±æ˜¯onã€‚ä¸»åŠ¨æ­»é”ç›‘æµ‹åœ¨å‘ç”Ÿæ­»é”çš„æ—¶å€™ï¼Œæ˜¯èƒ½å¤Ÿå¿«é€Ÿå‘ç°å¹¶è¿›è¡Œå¤„ç†çš„ï¼Œä½†æ˜¯å®ƒæœ‰é¢å¤–è´Ÿæ‹…çš„ã€‚æ¯å½“ä¸€ä¸ªäº‹åŠ¡è¢«é”çš„æ—¶å€™ï¼Œå°±è¦çœ‹çœ‹å®ƒæ‰€ä¾èµ–çš„çº¿ç¨‹æœ‰æ²¡æœ‰è¢«åˆ«äººé”ä½ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œæœ€ååˆ¤æ–­æ˜¯å¦å‡ºç°äº†å¾ªç¯ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯æ­»é”</p><p>å¦‚æœæ‰€æœ‰äº‹åŠ¡éƒ½è¦æ›´æ–°åŒä¸€è¡Œçš„åœºæ™¯ï¼Œæ¯ä¸ªæ–°æ¥çš„è¢«å µä½çš„çº¿ç¨‹éƒ½è¦åˆ¤æ–­ä¼šä¸ä¼šç”±äºè‡ªå·±çš„åŠ å…¥å¯¼è‡´æ­»é”ï¼Œè¿™æ˜¯ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯O(n)çš„æ“ä½œã€‚</p><p>ã€<strong>ç¤ºä¾‹</strong>ã€‘</p><p><strong>æ€ä¹ˆè§£å†³ç”±è¿™ç§çƒ­ç‚¹è¡Œæ›´æ–°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Ÿ</strong></p><p>1.å¦‚æœç¡®ä¿è¿™ä¸ªä¸šåŠ¡ä¸€å®šä¸ä¼šå‡ºç°æ­»é”ï¼Œå¯ä»¥ä¸´æ—¶æŠŠæ­»é”æ£€æµ‹å…³æ‰</p><p>2.æ§åˆ¶å¹¶å‘åº¦</p><p>3.å°†ä¸€è¡Œæ”¹æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘é”å†²çªã€‚ä»¥å½±é™¢è´¦æˆ·ä¸ºä¾‹ï¼Œå¯ä»¥è€ƒè™‘æ”¾åœ¨å¤šæ¡è®°å½•ä¸Šï¼Œæ¯”å¦‚10ä¸ªè®°å½•ï¼Œå½±é™¢çš„è´¦æˆ·æ€»é¢ç­‰äºè¿™10ä¸ªè®°å½•çš„å€¼çš„æ€»å’Œã€‚è¿™æ ·æ¯æ¬¡è¦ç»™å½±é™¢è´¦æˆ·åŠ é‡‘é¢çš„æ—¶å€™ï¼Œéšæœºé€‰å…¶ä¸­ä¸€æ¡è®°å½•æ¥åŠ ã€‚è¿™æ ·æ¯æ¬¡å†²çªæ¦‚ç‡å˜æˆå‘˜åŸæ¥çš„1/10ï¼Œå¯ä»¥å‡å°‘é”ç­‰å¾…ä¸ªæ•°ï¼Œä¹Ÿå°±å‡å°‘äº†æ­»é”æ£€æµ‹çš„CPUæ¶ˆè€—ã€‚</p><h1>Mysqlä¸­çš„é”</h1><p>æ ¹æ®é”çš„è®¾è®¡æ€æƒ³ï¼ŒMySQLé‡Œé¢çš„é”å¤§è‡´åˆ†ä¸ºä¹è§‚é”å’Œæ‚²è§‚é”ã€‚</p><h2 id="1ã€ä¹è§‚é”å’Œæ‚²è§‚é”çš„æ¾„æ¸…">1ã€ä¹è§‚é”å’Œæ‚²è§‚é”çš„æ¾„æ¸…</h2><ul><li>æ— è®ºæ˜¯æ‚²è§‚é”è¿˜æ˜¯ä¹è§‚é”ï¼Œä»–ä»¬æœ¬è´¨ä¸Šä¸æ˜¯æ•°æ®åº“ä¸­å…·ä½“çš„é”æ¦‚å¿µï¼Œè€Œæ˜¯æˆ‘ä»¬å®šä¹‰å‡ºæ¥ï¼Œç”¨æ¥æè¿°ä¸¤ç§ç±»åˆ«çš„é”çš„æ€æƒ³ã€‚æ‰€ä»¥æœ‰äº†è®¾è®¡çš„åˆ†ç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªåˆ†ç±»å»å¯¹æ•°æ®åº“ä¸­å…·ä½“çš„é”è¿›è¡Œåˆ†é—¨åˆ«ç±»ï¼›</li><li>ä¸è¿‡æ•°æ®åº“ä¸­çš„ä¹è§‚é”æ›´å€¾å‘å«ä¹è§‚å¹¶å‘æ§åˆ¶ï¼ˆOCCï¼‰ï¼Œæ‚²è§‚é”å«æ‚²è§‚å¹¶å‘æ§åˆ¶ï¼ˆPCCï¼‰ï¼Œè¿˜æœ‰åŒºåˆ«äºä¹è§‚æ‚²è§‚é”çš„ä¸€ç§æ§åˆ¶å«MVCCï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</li><li>ä¹Ÿä¸è¦æŠŠä¹è§‚é”å’Œæ‚²è§‚é”ä¸æ•°æ®åº“ä¸­çš„è¡Œé”ï¼Œè¡¨é”ï¼Œæ’ä»–é”ï¼Œå…±äº«é”æ··ä¸ºä¸€è°ˆï¼Œä»–ä»¬å¹¶ä¸æ˜¯ä¸€ä¸ªç»´åº¦çš„ä¸œè¥¿ï¼›å‰è€…æ˜¯ä¸€ä¸ªé”æ€æƒ³ï¼Œå¯ä»¥å°†åè€…æ ¹æ®æ˜¯å¦è¿›è¡Œè¶‹è¿‘äºä¹è§‚æˆ–æ‚²è§‚é”çš„æ€æƒ³è¿›è¡Œåˆ†ç±»</li><li>ä¹è§‚é”å’Œæ‚²è§‚é”çš„æ¦‚å¿µä¸ä»…ä»…å­˜åœ¨äºæ•°æ®åº“é¢†åŸŸï¼Œå¯ä»¥è¯´å­˜åœ¨çº¿ç¨‹å®‰å…¨ï¼Œå­˜åœ¨å¹¶å‘çš„åœºæ™¯å‡ ä¹éƒ½æœ‰ä¹è§‚é”å’Œæ‚²è§‚é”çš„é€‚ç”¨åœºæ™¯ï¼Œæ¯”å¦‚Javaä¸­ä¹Ÿæœ‰ä¹è§‚é”å’Œæ‚²è§‚é”æ€æƒ³çš„å…·ä½“å®ç°ï¼›ä½†ä¸åŒé¢†åŸŸçš„ä¹è§‚å’Œæ‚²è§‚é”çš„å…·ä½“å®ç°éƒ½ä¸å°½ç›¸åŒï¼Œè¦è§£å†³çš„é—®é¢˜ä¹Ÿå¯èƒ½æœ‰æ‰€ä¸ä¸€æ ·</li></ul><h2 id="1ã€æ‚²è§‚é”">1ã€æ‚²è§‚é”</h2><h3 id="ã€æ¦‚å¿µã€‘">ã€æ¦‚å¿µã€‘</h3><p>åœ¨å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé‡Œï¼Œæ‚²è§‚å¹¶å‘æ§åˆ¶ï¼ˆåˆåâ€œæ‚²è§‚é”â€ï¼ŒPessimistic Concurrency Controlï¼Œç¼©å†™â€œPCCâ€ï¼‰æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•; <strong>æ‚²è§‚é”æŒ‡çš„æ˜¯é‡‡ç”¨ä¸€ç§æŒæ‚²è§‚æ¶ˆæçš„æ€åº¦ï¼Œé»˜è®¤æ•°æ®è¢«å¤–ç•Œè®¿é—®æ—¶ï¼Œå¿…ç„¶ä¼šäº§ç”Ÿå†²çªï¼Œæ‰€ä»¥åœ¨æ•°æ®å¤„ç†çš„æ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½é‡‡ç”¨åŠ é”çš„çŠ¶æ€ï¼Œä¿è¯åŒä¸€æ—¶é—´ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åˆ°æ•°æ®ï¼Œå®ç°æ•°æ®çš„æ’ä»–æ€§</strong>ï¼›é€šå¸¸ï¼Œæ•°æ®åº“çš„æ‚²è§‚é”æ˜¯åˆ©ç”¨æ•°æ®åº“æœ¬èº«æä¾›çš„é”æœºåˆ¶å»å®ç°çš„.</p><p>æ•°æ®åº“çš„æ‚²è§‚å¹¶å‘æ§åˆ¶å¯ä»¥è§£å†³<strong>è¯»-å†™å†²çªå’Œå†™-å†™å†²çª</strong>,æŒ‡åœ¨ç”¨<strong>åŠ é”çš„æ–¹å¼</strong>å»è§£å†³</p><hr><h3 id="ã€å®ç°ã€‘">ã€å®ç°ã€‘</h3><p><strong>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ•°æ®åº“çš„æ‚²è§‚é”å°±æ˜¯åˆ©ç”¨æ•°æ®åº“æœ¬èº«æä¾›çš„é”å»å®ç°çš„</strong></p><ul><li>å¤–ç•Œè¦è®¿é—®æŸæ¡æ•°æ®ï¼Œé‚£å®ƒå°±è¦é¦–å…ˆå‘æ•°æ®åº“ç”³è¯·è¯¥æ•°æ®çš„é”(æŸç§é”)</li><li>å¦‚æœè·å¾—æˆåŠŸï¼Œé‚£å®ƒå°±å¯ä»¥æ“ä½œè¯¥æ•°æ®ï¼Œåœ¨å®ƒæ“ä½œæœŸé—´ï¼Œå…¶ä»–å®¢æˆ·ç«¯å°±æ— æ³•å†æ“ä½œè¯¥æ•°æ®äº†</li><li>å¦‚æœè·å¾—å¤±è´¥ï¼Œåˆ™ä»£è¡¨åŒä¸€æ—¶é—´å·²æœ‰å…¶ä»–å®¢æˆ·ç«¯è·å¾—äº†è¯¥é”ï¼Œé‚£å°±å¿…é¡»ç­‰å¾…å…¶ä»–å®¢æˆ·ç«¯é‡Šæ”¾é”</li></ul><p>å½“ç„¶æ•°æ®åº“æä¾›äº†éå¸¸å¤šçš„é”ï¼Œæ¯ç§æ•°æ®åº“æä¾›çš„é”ä¹Ÿä¸å°½ç„¶ç›¸åŒï¼Œæ‰€ä»¥å…·ä½“æƒ…å†µå°±è¦çœ‹æ˜¯ä»€ä¹ˆé”äº†,æ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ã€‚</p><h3 id="ã€ä¼˜ç¼ºç‚¹ã€‘">ã€ä¼˜ç¼ºç‚¹ã€‘</h3><p>**ä¼˜ç‚¹ï¼š**é€‚åˆåœ¨å†™å¤šè¯»å°‘çš„å¹¶å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œè™½ç„¶æ— æ³•ç»´æŒéå¸¸é«˜çš„æ€§èƒ½ï¼Œä½†æ˜¯åœ¨ä¹è§‚é”æ— æ³•ææ›´å¥½çš„æ€§èƒ½å‰æä¸‹ï¼Œå¯ä»¥åšåˆ°æ•°æ®çš„å®‰å…¨æ€§<br>**ç¼ºç‚¹ï¼š**åŠ é”ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ï¼Œè™½ç„¶èƒ½ä¿è¯æ•°æ®çš„å®‰å…¨ï¼Œä½†æ•°æ®å¤„ç†ååé‡ä½ï¼Œä¸é€‚åˆåœ¨è¯»ä¹¦å†™å°‘çš„åœºåˆä¸‹ä½¿ç”¨ã€‚</p><h2 id="2ã€ä¹è§‚é”">2ã€ä¹è§‚é”</h2><h3 id="ã€æ¦‚å¿µã€‘-2">ã€æ¦‚å¿µã€‘</h3><p>åœ¨å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé‡Œï¼Œä¹è§‚å¹¶å‘æ§åˆ¶ï¼ˆåˆåâ€œä¹è§‚é”â€ï¼ŒOptimistic Concurrency Controlï¼Œç¼©å†™â€œOCCâ€ï¼‰æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•ï¼›ä¹è§‚é”ï¼ˆ Optimistic Locking ï¼‰ æ˜¯ç›¸å¯¹æ‚²è§‚é”è€Œè¨€ï¼Œ<strong>ä¹è§‚é”æ˜¯å‡è®¾è®¤ä¸ºå³ä½¿åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå¤–ç•Œå¯¹æ•°æ®çš„æ“ä½œä¸€èˆ¬æ˜¯ä¸ä¼šé€ æˆå†²çªï¼Œæ‰€ä»¥å¹¶ä¸ä¼šå»åŠ é”(æ‰€ä»¥ä¹è§‚é”ä¸æ˜¯ä¸€æŠŠé”)ï¼Œè€Œæ˜¯åœ¨æ•°æ®è¿›è¡Œæäº¤æ›´æ–°çš„æ—¶å€™ï¼Œæ‰ä¼šæ­£å¼å¯¹æ•°æ®çš„å†²çªä¸å¦è¿›è¡Œæ£€æµ‹</strong>ï¼Œå¦‚æœå‘ç°å†²çªäº†ï¼Œåˆ™è®©è¿”å›å†²çªä¿¡æ¯ï¼Œè®©ç”¨æˆ·å†³å®šå¦‚ä½•å»åšä¸‹ä¸€æ­¥ï¼Œæ¯”å¦‚è¯´é‡è¯•ï¼Œç›´è‡³æˆåŠŸä¸ºæ­¢ï¼›æ•°æ®åº“çš„ä¹è§‚é”ï¼Œå¹¶ä¸æ˜¯åˆ©ç”¨æ•°æ®åº“æœ¬èº«çš„é”å»å®ç°çš„ï¼Œå¯èƒ½æ˜¯åˆ©ç”¨æŸç§å®ç°é€»è¾‘å»å®ç°åšåˆ°ä¹è§‚é”çš„æ€æƒ³</p><p>æ•°æ®åº“çš„ä¹è§‚å¹¶å‘æ§åˆ¶è¦è§£å†³çš„æ˜¯æ•°æ®åº“å¹¶å‘åœºæ™¯ä¸‹çš„<strong>å†™-å†™å†²çª</strong>ï¼ŒæŒ‡åœ¨ç”¨<strong>æ— é”çš„æ–¹å¼</strong>å»è§£å†³</p><hr><h3 id="ã€CASæ€æƒ³ã€‘">ã€CASæ€æƒ³ã€‘</h3><p>å…¶å®æ•°æ®åº“ä¹è§‚é”çš„å…·ä½“å®ç°å‡ ä¹å°±è·ŸJavaä¸­ä¹è§‚é”é‡‡ç”¨çš„CASç®—æ³•æ€æƒ³æ˜¯ä¸€è‡´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»CASç®—æ³•ä¸­å­¦ä¹ åˆ°æ•°æ®åº“ä¹è§‚é”çš„è®¾è®¡ï¼š</p><p>CASæŒ‡ä»¤å…¨ç§°ä¸ºCompare and Swapï¼Œå®ƒæ˜¯ç³»ç»Ÿçš„æŒ‡ä»¤é›†ï¼Œ<strong>æ•´ä¸ªCASæ“ä½œæ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œæ˜¯ä¸å¯åˆ†å‰²çš„</strong>ã€‚ä»å…·ä½“çš„æè¿°ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆçœ‹CASæ“ä½œï¼š</p><hr><p><strong>CASæŒ‡ä»¤éœ€è¦3ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯å†…å­˜ä½ç½®Vï¼Œæ—§çš„é¢„æœŸå€¼A,å’Œæ–°å€¼Bã€‚CASæŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œå½“æˆ‘ä»¬è¯»å–çš„å†…ç½®ä½ç½®Vçš„ç°å€¼ç­‰äºæ—§é¢„æœŸå€¼Aæ—¶ï¼Œå¤„ç†å™¨æ‰ä¼šå°†æ–°å€¼Bå»æ›´æ–°å†…ç½®ä½ç½®Vçš„å€¼ã€‚å¦åˆ™å®ƒå°±ä¸æ‰§è¡Œæ›´æ–°ï¼Œä½†æ— è®ºæ˜¯å¦æ›´æ–°Vçš„å€¼ï¼Œéƒ½ä¼šè¿”å›Vçš„æ—§å€¼ã€‚</strong></p><p>æˆ‘ä»¬é€šä¿—çš„æ”¾åˆ°ä»£ç å±‚æ¬¡ä¸Šå»ç†è§£i = 2; i++ï¼Œå°±æ˜¯è¯´ï¼š</p><ul><li>é¦–å…ˆçº¿ç¨‹1ä»å†…å­˜ä½ç½®Vä¸­è¯»å–åˆ°äº†å€¼ï¼Œä¿å­˜å¹¶ä½œä¸ºæ—§é¢„æœŸå€¼A. (v = 2 ,a = 2)</li><li>ç„¶ååœ¨å› ä¸ºiè¦è¿›è¡Œ++æ“ä½œï¼Œç³»ç»Ÿä¼šæ¯”è¾ƒå†…å­˜ä½ç½®Vçš„ç°å€¼è·Ÿæ—§é¢„æœŸå€¼Aè¿›è¡Œæ¯”è¾ƒï¼Œæ—¢V =? Aã€‚</li><li>å¦‚æœç›¸ç­‰ï¼ŒB = i++ = 3 ï¼Œæ–°å€¼Bå°±ä¼šå¯¹å†…å­˜ä½ç½®Vè¿›è¡Œæ›´æ–°ï¼Œæ‰€ä»¥å†…å­˜ä½ç½®Vçš„å€¼å°±å˜æˆäº†Bçš„å€¼ï¼Œ3</li><li>å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è¯´æ˜æœ‰å…¶ä»–çš„çº¿ç¨‹ä¿®æ”¹è¿‡äº†å†…å­˜ä½ç½®Vçš„å€¼ï¼Œæ¯”å¦‚çº¿ç¨‹2åœ¨çº¿ç¨‹1ä¿®æ”¹içš„å€¼å‰å°±æ›´æ–°äº†içš„å€¼ã€‚ï¼Œæ‰€ä»¥çº¿ç¨‹1ä¼šæ›´æ–°å˜é‡iå¤±è´¥ã€‚ä½†çº¿ç¨‹ä¸ä¼šæŒ‚èµ·ï¼Œè€Œæ˜¯è¿”å›å¤±è´¥çŠ¶æ€ï¼Œç­‰å¾…è°ƒç”¨çº¿ç¨‹å†³å®šæ˜¯å¦é‡è¯•æˆ–å…¶ä»–æ“ä½œã€‚(é€šå¸¸ä¼šé‡è¯•ç›´åˆ°æˆåŠŸ)</li></ul><h3 id="ã€å®ç°ã€‘-2">ã€å®ç°ã€‘</h3><p><strong>é€šå¸¸ä¹è§‚é”çš„å®ç°æœ‰ä¸¤ç§ï¼Œä½†å®ƒä»¬çš„å†…åœ¨éƒ½æ˜¯CASæ€æƒ³çš„è®¾è®¡ï¼š</strong></p><ul><li><strong>æ–¹å¼ä¸€ï¼š</strong> ä½¿ç”¨æ•°æ®ç‰ˆæœ¬ï¼ˆ<code>version</code>ï¼‰å®ç°</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">è¿™æ˜¯ä¹è§‚é”æœ€å¸¸ç”¨çš„ä¸€ç§å®ç°æ–¹å¼ã€‚ä»€ä¹ˆæ˜¯æ•°æ®ç‰ˆæœ¬å‘¢ï¼Ÿå°±æ˜¯åœ¨è¡¨ä¸­å¢æ·»ä¸€ä¸ªå­—æ®µä½œä¸ºè¯¥è®°å½•çš„ç‰ˆæœ¬æ ‡è¯†ï¼Œæ¯”å¦‚å«versionï¼Œæ¯æ¬¡å¯¹è¯¥è®°å½•çš„å†™æ“ä½œéƒ½ä¼šè®© version<span class="hljs-operator">+</span> <span class="hljs-number">1</span>ã€‚<br><br>æ‰€ä»¥å½“æˆ‘ä»¬è¯»å–äº†æ•°æ®(åŒ…æ‹¬version)ï¼Œåšå‡ºæ›´æ–°ï¼Œè¦æäº¤çš„æ—¶å€™ï¼Œå°±ä¼šæ‹¿å–å¾—çš„versionå»è·Ÿæ•°æ®åº“ä¸­çš„versionæ¯”è¾ƒæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™ä»£è¡¨è¿™ä¸ªæ—¶é—´æ®µï¼Œå¹¶æ²¡æœ‰å…¶ä»–çš„çº¿ç¨‹çš„ä¹Ÿä¿®æ”¹è¿‡è¿™ä¸ªæ•°æ®ï¼Œç»™äºˆæ›´æ–°ï¼ŒåŒæ—¶version <span class="hljs-operator">+</span> <span class="hljs-number">1</span>ï¼›å¦‚æœä¸ä¸€è‡´ï¼Œåˆ™ä»£è¡¨åœ¨è¿™ä¸ªæ—¶é—´æ®µï¼Œè¯¥è®°å½•ä»¥åŠè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†ï¼Œ è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ï¼Œè¿”å›å†²çªä¿¡æ¯ï¼Œè®©ç”¨æˆ·å†³å®šä¸‹ä¸€æ­¥åŠ¨ä½œï¼Œæ¯”å¦‚é‡è¯•ï¼ˆé‡æ–°è¯»å–æœ€æ–°æ•°æ®ï¼Œå†è¿‡æ›´æ–°ï¼‰<br>update <span class="hljs-keyword">table</span> <span class="hljs-keyword">set</span> num <span class="hljs-operator">=</span> num <span class="hljs-operator">+</span> <span class="hljs-number">1</span> , version <span class="hljs-operator">=</span> version <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">where</span> version <span class="hljs-operator">=</span> #&#123;version&#125; <span class="hljs-keyword">and</span> id <span class="hljs-operator">=</span> #&#123;id&#125;<br><br></code></pre></td></tr></table></figure><ul><li><strong>æ–¹å¼äºŒï¼š</strong> ä½¿ç”¨æ—¶é—´æˆ³(<code>timestamp</code>)å®ç°</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">è¡¨ä¸­å¢åŠ ä¸€ä¸ªå­—æ®µï¼Œåç§°æ— æ‰€è°“ï¼Œæ¯”å¦‚å«update_time, å­—æ®µç±»å‹ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆ<span class="hljs-type">timestamp</span>ï¼‰<br><br>åŸç†å’Œæ–¹å¼ä¸€ä¸€è‡´ï¼Œä¹Ÿæ˜¯åœ¨æ›´æ–°æäº¤çš„æ—¶æ£€æŸ¥å½“å‰æ•°æ®åº“ä¸­æ•°æ®çš„æ—¶é—´æˆ³å’Œè‡ªå·±æ›´æ–°å‰å–åˆ°çš„æ—¶é—´æˆ³æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™ä»£è¡¨æ­¤åˆ»æ²¡æœ‰å†²çªï¼Œå¯ä»¥æäº¤æ›´æ–°ï¼ŒåŒæ—¶æ—¶é—´æˆ³æ›´æ–°ä¸ºå½“å‰æ—¶é—´ï¼Œå¦åˆ™å°±æ˜¯è¯¥æ—¶é—´æ®µæœ‰å…¶ä»–çº¿ç¨‹ä¹Ÿæ›´æ–°æäº¤è¿‡ï¼Œè¿”å›å†²çªä¿¡æ¯ï¼Œç­‰å¾…ç”¨æˆ·ä¸‹ä¸€æ­¥åŠ¨ä½œã€‚<br>update <span class="hljs-keyword">table</span> <span class="hljs-keyword">set</span> num <span class="hljs-operator">=</span> num <span class="hljs-operator">+</span> <span class="hljs-number">1</span> ,update_time <span class="hljs-operator">=</span> unix_timestamp(now()) <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> #&#123;id&#125; <span class="hljs-keyword">and</span> update_time <span class="hljs-operator">=</span> #&#123;updateTime&#125;<br><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬è¦æ³¨æ„çš„æ˜¯ï¼Œè¦å®ç°ä¹è§‚é”çš„æ€æƒ³çš„åŒæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è¦è¦ä¿è¯CASå¤šä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œå³<strong>è·å–æ•°æ®åº“æ•°æ®çš„ç‰ˆæœ¬</strong>ï¼Œ<strong>æ‹¿æ•°æ®åº“çš„æ•°æ®ç‰ˆæœ¬ä¸ä¹‹å‰æ‹¿åˆ°çš„ç‰ˆæœ¬çš„æ¯”è¾ƒ</strong>ï¼Œä»¥åŠ<strong>æ›´æ–°æ•°æ®</strong>ç­‰è¿™å‡ ä¸ªæ“ä½œçš„æ‰§è¡Œå¿…é¡»æ˜¯è¿è´¯æ‰§è¡Œï¼Œå…·æœ‰å¤åˆæ“ä½œçš„åŸå­æ€§ï¼›æ‰€ä»¥å¦‚æœæ˜¯æ•°æ®åº“çš„SQL,é‚£ä¹ˆæˆ‘ä»¬å°±è¦ä¿è¯<strong>å¤šä¸ªSQLæ“ä½œå¤„äºåŒä¸€ä¸ªäº‹åŠ¡ä¸­</strong>ã€‚</p><h3 id="ã€ä¼˜ç¼ºç‚¹ã€‘-2">ã€ä¼˜ç¼ºç‚¹ã€‘</h3><p>**ä¼˜ç‚¹ï¼š**åœ¨è¯»å¤šå†™å°‘çš„å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¯ä»¥é¿å…æ•°æ®åº“åŠ é”çš„å¼€é”€ï¼Œæé«˜Daoå±‚çš„å“åº”æ€§èƒ½ã€‚å…¶å®å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ormå·¥å…·éƒ½æœ‰å¸¦æœ‰ä¹è§‚é”çš„å®ç°ï¼Œæ‰€ä»¥è¿™äº›æ–¹æ³•ä¸ä¸€å®šéœ€è¦æˆ‘ä»¬äººä¸ºçš„å»å®ç°</p><p>**ç¼ºç‚¹ï¼š**åœ¨å†™å¤šè¯»å°‘çš„å¹¶å‘åœºæ™¯ä¸‹ï¼Œå³åœ¨å†™æ“ä½œç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´CASå¤šæ¬¡é‡è¯•ï¼Œå†²çªé¢‘ç‡è¿‡é«˜ï¼Œå¯¼è‡´å¼€é”€æ¯”æ‚²è§‚é”æ›´é«˜ã€‚</p><h1>Mysqlé”çš„åº•å±‚ç®—æ³•</h1><h2 id="1ã€è®°å½•é”">1ã€è®°å½•é”</h2><p>â€‹è®°å½•é”æ˜¯é”ä½è®°å½•ï¼Œé”ä½ç´¢å¼•è®°å½•ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„æ•°æ®è®°å½•</p><ul><li>é”æ˜¯éä¸»é”®ç´¢å¼•ï¼Œä¼šåœ¨ç´¢å¼•è®°å½•ä¸ŠåŠ é”åï¼Œåœ¨å»ä¸»é”®ç´¢å¼•ä¸ŠåŠ é”</li><li>è¡¨ä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œä¼šåœ¨éšè—çš„ä¸»é”®ç´¢å¼•ä¸ŠåŠ é”</li><li>å¦‚æœè¦é”çš„åˆ—æ²¡æœ‰ç´¢å¼•ï¼Œè¿›è¡Œå…¨è¡¨è®°å½•åŠ é”</li></ul><h2 id="2ã€é—´éš™é”">2ã€é—´éš™é”</h2><p>å½“æˆ‘ä»¬ç”¨<strong>èŒƒå›´æ¡ä»¶</strong>è€Œä¸æ˜¯ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBï¼ˆå¯é‡å¤è¯»ã€ä¸²è¡ŒåŒ–çº§åˆ«ä¸‹æ‰æœ‰æ•ˆï¼‰ä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®çš„ç´¢å¼•é¡¹åŠ é”ï¼›å¯¹äº<strong>é”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•</strong>ï¼Œå«åšâ€œé—´éš™(GAP)â€ï¼ŒInnoDBä¹Ÿä¼šå¯¹è¿™ä¸ªâ€œé—´éš™â€åŠ é”ï¼Œè¿™ç§é”æœºåˆ¶å°±æ˜¯æ‰€è°“çš„é—´éš™é”ï¼ˆNext-Keyé”ï¼‰ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162243301.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>å½“æ‰§è¡Œ<code>select * from t where d=5 for update</code>çš„æ—¶å€™ï¼Œå°±ä¸æ­¢æ˜¯ç»™æ•°æ®åº“ä¸­å·²æœ‰çš„6ä¸ªè®°å½•åŠ ä¸Šäº†è¡Œé”ï¼Œè¿˜åŒæ—¶åŠ äº†7ä¸ªé—´éš™é”ã€‚è¿™æ ·å°±ç¡®ä¿äº†æ— æ³•å†æ’å…¥æ–°çš„è®°å½•ã€‚</p><p><strong>è·Ÿé—´éš™é”å­˜åœ¨å†²çªå…³ç³»çš„æ˜¯å¾€è¿™ä¸ªé—´éš™ä¸­æ’å…¥ä¸€ä¸ªè®°å½•è¿™ä¸ªæ“ä½œã€‚é—´éš™é”ä¹‹é—´ä¸å­˜åœ¨å†²çªå…³ç³»</strong></p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162258745.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>è¿™é‡ŒsessionBå¹¶ä¸ä¼šè¢«å µä½ã€‚å› ä¸ºè¡¨té‡Œé¢å¹¶æ²¡æœ‰c=7ä¼šè¿™ä¸ªè®°å½•ï¼Œå› æ­¤sessionAåŠ çš„æ˜¯é—´éš™é”(5,10)ã€‚è€ŒsessionBä¹Ÿæ˜¯åœ¨è¿™ä¸ªé—´éš™åŠ çš„é—´éš™é”ã€‚å®ƒä»¬ç”¨å…±åŒçš„ç›®æ ‡ï¼Œä¿æŠ¤è¿™ä¸ªé—´éš™ï¼Œä¸å…è®¸æ’å…¥å€¼ã€‚ä½†å®ƒä»¬ä¹‹é—´æ˜¯ä¸å†²çªçš„ã€‚</p><p>é—´éš™é”å’Œè¡Œé”åˆç§°next-key lockï¼Œæ¯ä¸ªnext-key lockæ˜¯å‰å¼€åé—­åŒºé—´ã€‚è¡¨tåˆå§‹åŒ–ä»¥åï¼Œå¦‚æœç”¨select * from t for updateè¦æŠŠæ•´ä¸ªè¡¨æ‰€æœ‰è®°å½•é”èµ·æ¥ï¼Œå°±å½¢æˆäº†7ä¸ªnext-key lockï¼Œåˆ†åˆ«æ˜¯(-âˆ,0]ã€(0,5]ã€(5,10]ã€(10,15]ã€(15,20]ã€(20, 25]ã€(25, +supremum]ã€‚å› ä¸º+âˆæ˜¯å¼€åŒºé—´ï¼Œåœ¨å®ç°ä¸Šï¼ŒInnoDBç»™æ¯ä¸ªç´¢å¼•åŠ äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æœ€å¤§å€¼supremumï¼Œè¿™æ ·æ‰ç¬¦åˆéƒ½æ˜¯å‰å¼€åé—­åŒºé—´ã€‚</p><p>é—´éš™é”å’Œnext-key lockçš„å¼•å…¥ï¼Œè§£å†³äº†å¹»è¯»çš„é—®é¢˜ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›å›°æ‰°ã€‚</p><p><strong>é—´éš™é”å¯¼è‡´çš„æ­»é”ï¼š</strong></p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162307738.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>1.sessionAæ‰§è¡Œselect â€¦ for updateè¯­å¥ï¼Œç”±äºid=9è¿™ä¸€è¡Œå¹¶ä¸å­˜åœ¨ï¼Œå› æ­¤ä¼šåŠ ä¸Šé—´éš™é”(5,10)</p><p>2.sessionBæ‰§è¡Œselect â€¦ for updateè¯­å¥ï¼ŒåŒæ ·ä¼šåŠ ä¸Šé—´éš™é”(5,10)ï¼Œé—´éš™é”ä¹‹é—´ä¸ä¼šå†²çª</p><p>3.sessionBè¯•å›¾æ’å…¥ä¸€è¡Œ(9,9,9)ï¼Œè¢«sessionAçš„é—´éš™é”æŒ¡ä½äº†ï¼Œåªå¥½è¿›å…¥ç­‰å¾…</p><p>4.sessionAè¯•å›¾æ’å…¥ä¸€è¡Œ(9,9,9)ï¼Œè¢«sessionBçš„é—´éš™é”æŒ¡ä½äº†</p><p>ä¸¤ä¸ªsessionè¿›å…¥äº’ç›¸ç­‰å¾…çŠ¶æ€ï¼Œå½¢æˆäº†æ­»é”ï¼Œé—´éš™é”çš„å¼•å…¥å¯èƒ½ä¼šå¯¼è‡´åŒæ ·çš„è¯­å¥é”ä½æ›´å¤§çš„èŒƒå›´ï¼Œè¿™å…¶å®æ˜¯å½±å“å¹¶å‘åº¦çš„ã€‚åœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸å­˜åœ¨é—´éš™é”ã€‚</p><h2 id="3ã€the-next-key-lock">3ã€the next-key lock</h2><p>è¯¥é”æ˜¯è®°å½•é”åŠ gapé”ï¼Œåœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯¹è¡Œçš„æ‰«æã€é”å®šéƒ½æ˜¯ä½¿ç”¨è¿™ç§é”ã€‚å¦‚æœæŸ¥è¯¢ä¸­åŒ…å«å”¯ä¸€ç´¢å¼•ï¼Œå°±ä¼šåªé€‚ç”¨è®°å½•é”ã€‚å› ä¸ºå”¯ä¸€ç´¢å¼•èƒ½ç¡®å®šè®°å½•è¡Œæ•°ï¼Œå…¶ä»–ç´¢å¼•ä¸èƒ½ç¡®å®šè¡Œæ•°ï¼Œæœ‰å¯èƒ½åœ¨å…¶ä»–äº‹åŠ¡ä¸­æ·»åŠ è¿™ä¸ªç´¢å¼•çš„æ•°æ®å¯¼è‡´å¹»è¯»ã€‚</p><h3 id="1ã€next-key-lockåŠ é”è§„åˆ™">1ã€next-key lockåŠ é”è§„åˆ™</h3><ul><li>åŸåˆ™1ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯next-key lockï¼Œnext-key lockæ˜¯<strong>å‰å¼€åé—­åŒºé—´</strong></li><li>åŸåˆ™2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­<strong>è®¿é—®åˆ°çš„å¯¹è±¡</strong>æ‰ä¼šåŠ é”</li><li>ä¼˜åŒ–1ï¼šç´¢å¼•ä¸Šçš„<strong>ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºè¡Œé”</strong></li><li>ä¼˜åŒ–2ï¼šç´¢å¼•ä¸Šçš„<strong>ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºé—´éš™é”</strong></li><li>ä¸€ä¸ªbugï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢</li></ul><hr><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">è¿™ä¸ªè§„åˆ™åªé™äº<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">MySQL5</span>.</span></span>xç³»åˆ—&lt;=<span class="hljs-number">5.7</span>.<span class="hljs-number">24</span>ï¼Œ<span class="hljs-number">8.0</span>ç³»åˆ—&lt;=<span class="hljs-number">8.0</span>.<span class="hljs-number">13</span><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `c` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `d` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  KEY `c` (`c`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t <span class="hljs-keyword">values</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>),(<span class="hljs-number">5</span>,<span class="hljs-number">5</span>,<span class="hljs-number">5</span>),<br>(<span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-number">10</span>),(<span class="hljs-number">15</span>,<span class="hljs-number">15</span>,<span class="hljs-number">15</span>),(<span class="hljs-number">20</span>,<span class="hljs-number">20</span>,<span class="hljs-number">20</span>),(<span class="hljs-number">25</span>,<span class="hljs-number">25</span>,<span class="hljs-number">25</span>);<br><br></code></pre></td></tr></table></figure><h3 id="2ã€æ¡ˆä¾‹ä¸€ï¼šç­‰å€¼æŸ¥è¯¢é—´éš™é”">2ã€æ¡ˆä¾‹ä¸€ï¼šç­‰å€¼æŸ¥è¯¢é—´éš™é”</h3><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162316586.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>1.ç”±äºè¡¨tä¸­æ²¡æœ‰id=7çš„è®°å½•ï¼Œæ ¹æ®åŸåˆ™1ï¼ŒåŠ é”å•ä½æ˜¯next-key lockï¼ŒsessionAåŠ é”èŒƒå›´å°±æ˜¯(5,10]</p><p>2.æ ¹æ®ä¼˜åŒ–2ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢(id=7)ï¼Œè€Œid=10ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œnext-key locké€€åŒ–æˆé—´éš™é”ï¼Œå› æ­¤æœ€ç»ˆåŠ é”çš„èŒƒå›´æ˜¯(5,10)</p><p>æ‰€ä»¥ï¼ŒsessionBè¦å¾€è¿™ä¸ªé—´éš™é‡Œé¢æ’å…¥id=8çš„è®°å½•ä¼šè¢«é”ä½ï¼Œä½†æ˜¯sessionCä¿®æ”¹id=10è¿™è¡Œæ˜¯å¯ä»¥çš„</p><hr><h3 id="3ã€æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼é”">3ã€æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼é”</h3><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162326725.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>1.æ ¹æ®åŸåˆ™1ï¼ŒåŠ é”å•ä½æ˜¯next-key lockï¼Œå› æ­¤ä¼šç»™(0,5]åŠ ä¸Šnext-key lock</p><p>2.cæ˜¯æ™®é€šç´¢å¼•ï¼Œå› æ­¤è®¿é—®c=5è¿™ä¸€æ¡è®°å½•æ˜¯ä¸èƒ½é©¬ä¸Šåœä¸‹æ¥çš„ï¼Œéœ€è¦å‘å³éå†ï¼ŒæŸ¥åˆ°c=10æ‰æ”¾å¼ƒã€‚æ ¹æ®åŸåˆ™2ï¼Œè®¿é—®åˆ°çš„éƒ½è¦åŠ é”ï¼Œå› æ­¤è¦ç»™(5,10]åŠ next-key lock</p><p>3.æ ¹æ®ä¼˜åŒ–2ï¼Œç­‰å€¼åˆ¤æ–­ï¼Œå‘å³éå†ï¼Œæœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³c=5è¿™ä¸ªç­‰å€¼æ¡ä»¶ï¼Œå› æ­¤é€€åŒ–æˆé—´éš™é”(5,10)</p><p>4.æ ¹æ®åŸåˆ™2ï¼Œåªæœ‰è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ï¼Œè¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¹¶ä¸éœ€è¦è®¿é—®ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥ä¸»é”®ç´¢å¼•ä¸Šæ²¡æœ‰ä»»ä½•é”ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆsessionBçš„updateè¯­å¥å¯ä»¥æ‰§è¡Œå®Œæˆ</p><p>é”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œlock in share modeåªé”è¦†ç›–ç´¢å¼•ï¼Œä½†æ˜¯å¦‚æœæ˜¯for updateï¼Œç³»ç»Ÿä¼šè®¤ä¸ºä½ æ¥ä¸‹æ¥è¦æ›´æ–°æ•°æ®ï¼Œå› æ­¤ä¼šé¡ºä¾¿ç»™ä¸»é”®ç´¢å¼•ä¸Šæ»¡è¶³æ¡ä»¶çš„è¡ŒåŠ ä¸Šè¡Œé”ï¼Œè¿™æ ·çš„è¯sessionBçš„updateè¯­å¥ä¼šè¢«é˜»å¡ä½ã€‚å¦‚æœä½ è¦ç”¨ lock in share mode æ¥ç»™è¡ŒåŠ è¯»é”é¿å…æ•°æ®è¢«æ›´æ–°çš„è¯ï¼Œå°±å¿…é¡»å¾—ç»•è¿‡è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ï¼Œåœ¨æŸ¥è¯¢å­—æ®µä¸­åŠ å…¥ç´¢å¼•ä¸­ä¸å­˜åœ¨çš„å­—æ®µ</p><h3 id="4ã€æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´é”">4ã€æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´é”</h3><p>1.å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªid=10çš„è¡Œï¼Œå› æ­¤æœ¬è¯¥æ˜¯next-key lock(5,10]ã€‚æ ¹æ®ä¼˜åŒ–1ï¼Œä¸»é”®idä¸Šçš„ç­‰å€¼æ¡ä»¶ï¼Œé€€åŒ–æˆè¡Œé”ï¼ŒåªåŠ äº†id=10è¿™ä¸€è¡Œçš„è¡Œé”</p><p>2.èŒƒå›´æŸ¥è¯¢å°±å¾€åç»§ç»­æ‰¾ï¼Œæ‰¾åˆ°id=15è¿™ä¸€è¡Œåœä¸‹æ¥ï¼Œå› æ­¤éœ€è¦åŠ next-key lock(10,15]</p><p>æ‰€ä»¥ï¼ŒsessionAè¿™æ—¶å€™é”çš„èŒƒå›´å°±æ˜¯ä¸»é”®ç´¢å¼•ä¸Šï¼Œè¡Œé”id=10å’Œnext-key lock(10,15]</p><h3 id="5ã€æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´é”">5ã€æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´é”</h3><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162335984.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>è¿™æ¬¡sessionAç”¨å­—æ®µcæ¥åˆ¤æ–­ï¼ŒåŠ é”è§„åˆ™è·Ÿæ¡ˆä¾‹ä¸‰å”¯ä¸€çš„ä¸åŒæ˜¯ï¼šåœ¨ç¬¬ä¸€æ¬¡ç”¨c=10å®šä½è®°å½•çš„æ—¶å€™ï¼Œç´¢å¼•cä¸ŠåŠ ä¸Š(5,10]è¿™ä¸ªnext-key lockåï¼Œç”±äºç´¢å¼•cæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰ä¼˜åŒ–è§„åˆ™ï¼Œå› æ­¤æœ€ç»ˆsessionAåŠ çš„é”æ˜¯ç´¢å¼•cä¸Šçš„(5,10]å’Œ(10,15]è¿™ä¸¤ä¸ªnext-key lock</p><h3 id="6ã€æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´é”bug">6ã€æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´é”bug</h3><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162344192.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>sessionAæ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼ŒæŒ‰ç…§åŸåˆ™1çš„è¯ï¼Œåº”è¯¥æ˜¯ç´¢å¼•idä¸ŠåªåŠ (10,15]è¿™ä¸ªnext-key lockï¼Œå¹¶ä¸”å› ä¸ºidæ˜¯å”¯ä¸€é”®ï¼Œæ‰€ä»¥å¾ªç¯åˆ¤æ–­åˆ°id=15è¿™ä¸€è¡Œå°±åº”è¯¥åœæ­¢äº†</p><p>ä½†æ˜¯å®ç°ä¸Šï¼ŒInnoDBä¼šæ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è¡Œä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯id=20ã€‚è€Œä¸”ç”±äºè¿™æ˜¯ä¸ªèŒƒå›´æ‰«æï¼Œå› æ­¤ç´¢å¼•idä¸Šçš„(15,20]è¿™ä¸ªnext-key lockä¹Ÿä¼šè¢«é”ä¸Š</p><p>æ‰€ä»¥ï¼ŒsessionBè¦æ›´æ–°id=20è¿™ä¸€è¡Œæ˜¯ä¼šè¢«é”ä½çš„ã€‚åŒæ ·åœ°ï¼ŒsessionCè¦æ’å…¥id=16çš„ä¸€è¡Œï¼Œä¹Ÿä¼šè¢«é”ä½</p><h3 id="7ã€æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨ç­‰å€¼çš„ä¾‹å­">7ã€æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨ç­‰å€¼çš„ä¾‹å­</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t <span class="hljs-keyword">values</span>(<span class="hljs-number">30</span>,<span class="hljs-number">10</span>,<span class="hljs-number">30</span>);<br></code></pre></td></tr></table></figure><p>â€‹æ–°æ’å…¥çš„è¿™ä¸€è¡Œc=10ï¼Œç°åœ¨è¡¨é‡Œæœ‰ä¸¤ä¸ªc=10çš„è¡Œã€‚è™½ç„¶æœ‰ä¸¤ä¸ªc=10ï¼Œä½†æ˜¯å®ƒä»¬çš„ä¸»é”®å€¼idæ˜¯ä¸åŒçš„ï¼Œå› æ­¤è¿™ä¸¤ä¸ªc=10çš„è®°å½•ä¹‹é—´ä¹Ÿæ˜¯æœ‰é—´éš™çš„.</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162401642.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162410516.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>sessionAåœ¨éå†çš„æ—¶å€™ï¼Œå…ˆè®¿é—®ç¬¬ä¸€ä¸ªc=10çš„è®°å½•ã€‚æ ¹æ®åŸåˆ™1ï¼Œè¿™é‡ŒåŠ çš„æ˜¯(c=5,id=5)åˆ°(c=10,id=10)è¿™ä¸ªnext-key lockã€‚ç„¶åsessionAå‘å³æŸ¥æ‰¾ï¼Œç›´åˆ°ç¢°åˆ°(c=15,id=15)è¿™ä¸€è¡Œï¼Œå¾ªç¯æ‰ç»“æŸã€‚æ ¹æ®ä¼˜åŒ–2ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³æŸ¥æ‰¾åˆ°äº†ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥ä¼šé€€åŒ–æˆ(c=10,id=10)åˆ°(c=15,id=15)çš„é—´éš™é”</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªdeleteè¯­å¥åœ¨ç´¢å¼•cä¸Šçš„åŠ é”èŒƒå›´ï¼Œå°±æ˜¯ä¸‹å›¾ä¸­è“è‰²åŒºåŸŸè¦†ç›–çš„éƒ¨åˆ†ï¼Œè¿™ä¸ªè“è‰²åŒºåŸŸå·¦å³ä¸¤è¾¹éƒ½æ˜¯è™šçº¿ï¼Œè¡¨ç¤ºå¼€åŒºé—´.</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162418283.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><h3 id="8ã€æ¡ˆä¾‹ä¸ƒï¼šlimitè¯­å¥åŠ é”">8ã€æ¡ˆä¾‹ä¸ƒï¼šlimitè¯­å¥åŠ é”</h3><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/2019060516242975.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>åŠ äº†limit 2çš„é™åˆ¶ï¼Œå› æ­¤åœ¨éå†åˆ°(c=10,id=30)è¿™ä¸€è¡Œä¹‹åï¼Œæ»¡è¶³æ¡ä»¶çš„è¯­å¥å·²ç»æœ‰ä¸¤æ¡ï¼Œå¾ªç¯å°±ç»“æŸäº†ã€‚å› æ­¤ï¼Œç´¢å¼•cä¸Šçš„åŠ é”èŒƒå›´å°±å˜æˆäº†ä»(c=5,id=5)åˆ°(c=10,id=30)è¿™ä¸ªå‰å¼€åé—­åŒºé—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162438271.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>å†åˆ é™¤æ•°æ®çš„æ—¶å€™å°½é‡åŠ limitï¼Œè¿™æ ·ä¸ä»…å¯ä»¥æ§åˆ¶åˆ é™¤æ•°æ®çš„æ¡æ•°ï¼Œè®©æ“ä½œæ›´å®‰å…¨ï¼Œè¿˜å¯ä»¥å‡å°åŠ é”çš„èŒƒå›´</p><h3 id="9ã€æ¡ˆä¾‹å…«ï¼šä¸€ä¸ªæ­»é”çš„ä¾‹å­">9ã€æ¡ˆä¾‹å…«ï¼šä¸€ä¸ªæ­»é”çš„ä¾‹å­</h3><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162446585.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>1.sessionAå¯åŠ¨äº‹åŠ¡åæ‰§è¡ŒæŸ¥è¯¢è¯­å¥åŠ lock in share modeï¼Œåœ¨ç´¢å¼•cä¸ŠåŠ äº†next-key lock(5,10]å’Œé—´éš™é”(10,15)</p><p>2.sessionBçš„updateè¯­å¥ä¹Ÿè¦åœ¨ç´¢å¼•cä¸ŠåŠ next-key lock(5,10]ï¼Œè¿›å…¥é”ç­‰å¾…</p><p>3.ç„¶åsessionAè¦å†æ’å…¥(8,8,8)è¿™ä¸€è¡Œï¼Œè¢«sessionBçš„é—´éš™é”é”ä½ã€‚ç”±äºå‡ºç°äº†æ­»é”ï¼ŒInnoDBè®©sessionBå›æ»š</p><p>sessionBçš„åŠ next-key lock(5,10]æ“ä½œï¼Œå®é™…ä¸Šåˆ†æˆäº†ä¸¤æ­¥ï¼Œå…ˆæ˜¯åŠ (5,10)é—´éš™é”ï¼ŒåŠ é”æˆåŠŸï¼›ç„¶ååŠ c=10çš„è¡Œé”ï¼Œè¿™æ—¶å€™æ‰è¢«é”ä½çš„.</p><h3 id="10ã€ä¸ç­‰å·æ¡ä»¶é‡Œçš„ç­‰å€¼æŸ¥è¯¢">10ã€ä¸ç­‰å·æ¡ä»¶é‡Œçš„ç­‰å€¼æŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">begin</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> id<span class="hljs-operator">&gt;</span><span class="hljs-number">9</span> <span class="hljs-keyword">and</span> id<span class="hljs-operator">&lt;</span><span class="hljs-number">12</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> id <span class="hljs-keyword">desc</span> <span class="hljs-keyword">for</span> update;<br><br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ä¸Šé¢çš„åŠ é”è§„åˆ™ï¼Œè¿™ä¸ªè¯­å¥çš„åŠ é”èŒƒå›´æ˜¯ä¸»é”®ç´¢å¼•ä¸Šçš„(0,5]ã€(5,10]å’Œ(10,15)ã€‚åŠ é”å•ä½æ˜¯next-key lockï¼Œè¿™é‡Œç”¨åˆ°äº†ä¼˜åŒ–2ï¼Œå³ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†çš„æ—¶å€™id=15ä¸æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥next-key locké€€åŒ–ä¸ºäº†é—´éš™é”(10,15)</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162454802.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>1.é¦–å…ˆè¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„è¯­ä¹‰æ˜¯order by id descï¼Œè¦æ‹¿åˆ°æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è¡Œï¼Œä¼˜åŒ–å™¨å¿…é¡»å…ˆæ‰¾åˆ°ç¬¬ä¸€ä¸ªid&lt;12çš„å€¼</p><p>2.è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ç´¢å¼•æ ‘çš„æœç´¢è¿‡ç¨‹å¾—åˆ°çš„ï¼Œåœ¨å¼•æ“å†…éƒ¨ï¼Œå…¶å®æ˜¯è¦æ‰¾åˆ°id=12çš„è¿™ä¸ªå€¼ï¼Œåªæ˜¯æœ€ç»ˆæ²¡æ‰¾åˆ°ï¼Œä½†æ‰¾åˆ°äº†(10,15)è¿™ä¸ªé—´éš™</p><p>3.ç„¶åæ ¹æ®order by id descï¼Œå†å‘å·¦éå†ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œå°±ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢äº†ï¼Œä¼šæ‰«æåˆ°id=5è¿™ä¸€è¡Œï¼Œæ‰€ä»¥ä¼šåŠ ä¸€ä¸ªnext-key lock (0,5]</p><p>åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡æ ‘æœç´¢çš„æ–¹å¼å®šä½è®°å½•çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯ç­‰å€¼æŸ¥è¯¢çš„æ–¹æ³•</p><h3 id="11ã€ç­‰å€¼æŸ¥è¯¢çš„è¿‡ç¨‹">11ã€ç­‰å€¼æŸ¥è¯¢çš„è¿‡ç¨‹</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">begin</span>;<br><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> c <span class="hljs-keyword">in</span>(<span class="hljs-number">5</span>,<span class="hljs-number">20</span>,<span class="hljs-number">10</span>) lock <span class="hljs-keyword">in</span> share mode;<br><br></code></pre></td></tr></table></figure><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/2019060516250347.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>è¿™æ¡inè¯­å¥ä½¿ç”¨äº†ç´¢å¼•cå¹¶ä¸”rows=3ï¼Œè¯´æ˜è¿™ä¸‰ä¸ªå€¼éƒ½æ˜¯é€šè¿‡B+æ ‘æœç´¢å®šä½çš„</p><p><strong>åœ¨æŸ¥æ‰¾c=5çš„æ—¶å€™ï¼Œå…ˆé”ä½äº†(0,5]ã€‚ä½†æ˜¯å› ä¸ºcä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œä¸ºäº†ç¡®è®¤è¿˜æœ‰æ²¡æœ‰åˆ«çš„è®°å½•c=5ï¼Œå°±è¦å‘å³éå†ï¼Œæ‰¾åˆ°c=10ç¡®è®¤æ²¡æœ‰äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹æ»¡è¶³ä¼˜åŒ–2ï¼Œæ‰€ä»¥åŠ äº†é—´éš™é”(5,10)ã€‚æ‰§è¡Œc=10ä¼šè¿™ä¸ªé€»è¾‘çš„æ—¶å€™ï¼ŒåŠ é”çš„èŒƒå›´æ˜¯(5,10]å’Œ(10,15)ï¼Œæ‰§è¡Œc=20è¿™ä¸ªé€»è¾‘çš„æ—¶å€™ï¼ŒåŠ é”çš„èŒƒå›´æ˜¯(15,20]å’Œ(20,25)</strong></p><p>è¿™æ¡è¯­å¥åœ¨ç´¢å¼•cä¸ŠåŠ çš„ä¸‰ä¸ªè®°å½•é”çš„é¡ºåºæ˜¯ï¼šå…ˆåŠ c=5çš„è®°å½•é”ï¼Œå†åŠ c=10çš„è®°å½•é”ï¼Œæœ€ååŠ c=20çš„è®°å½•é”</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> c <span class="hljs-keyword">in</span>(<span class="hljs-number">5</span>,<span class="hljs-number">20</span>,<span class="hljs-number">10</span>) <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> c <span class="hljs-keyword">desc</span> <span class="hljs-keyword">for</span> update;<br><br></code></pre></td></tr></table></figure><p>ç”±äºè¯­å¥é‡Œé¢æ˜¯order by c descï¼Œè¿™ä¸‰ä¸ªè®°å½•é”çš„åŠ é”é¡ºåºæ˜¯å…ˆé”c=20ï¼Œç„¶åc=10ï¼Œæœ€åæ˜¯c=5ã€‚è¿™ä¸¤æ¡è¯­å¥è¦åŠ é”ç›¸åŒçš„èµ„æºï¼Œä½†æ˜¯åŠ é”é¡ºåºç›¸åã€‚å½“è¿™ä¸¤æ¡è¯­å¥å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±å¯èƒ½å‡ºç°æ­»é”ã€‚</p><h3 id="12ã€insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šï¼Ÿ">12ã€insertè¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šï¼Ÿ</h3><h4 id="1ã€insert-â€¦-selectè¯­å¥">1ã€insert â€¦ selectè¯­å¥</h4><p>è¡¨tå’Œt2çš„è¡¨ç»“æ„ã€åˆå§‹åŒ–æ•°æ®è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `c` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `d` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `c` (`c`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>, <span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>, <span class="hljs-number">2</span>,<span class="hljs-number">2</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>, <span class="hljs-number">3</span>,<span class="hljs-number">3</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>, <span class="hljs-number">4</span>,<span class="hljs-number">4</span>);<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t2 <span class="hljs-keyword">like</span> t;<br><br></code></pre></td></tr></table></figure><p><strong>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œbinlog_format=statementæ—¶æ‰§è¡Œä¸‹é¢è¿™ä¸ªè¯­å¥æ—¶ï¼Œéœ€è¦å¯¹è¡¨tçš„æ‰€æœ‰è¡Œå’Œé—´éš™åŠ é”</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t2(c,d) <span class="hljs-keyword">select</span> c,d <span class="hljs-keyword">from</span> t;<br><br></code></pre></td></tr></table></figure><h4 id="2ã€insertå¾ªç¯å†™å…¥">2ã€insertå¾ªç¯å†™å…¥</h4><p>è¦å¾€è¡¨t2ä¸­æ’å…¥ä¸€è¡Œæ•°æ®ï¼Œè¿™ä¸€è¡Œçš„cå€¼æ˜¯è¡¨tä¸­cå€¼çš„æœ€å¤§å€¼åŠ 1ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t2(c,d)  (<span class="hljs-keyword">select</span> c<span class="hljs-operator">+</span><span class="hljs-number">1</span>, d <span class="hljs-keyword">from</span> t force index(c) <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> c <span class="hljs-keyword">desc</span> limit <span class="hljs-number">1</span>);<br><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè¯­å¥çš„åŠ é”èŒƒå›´ï¼Œå°±æ˜¯è¡¨tç´¢å¼•cä¸Šçš„(3,4]å’Œ(4,supermum]è¿™ä¸¤ä¸ªnext-key lockï¼Œä»¥åŠä¸»é”®ç´¢å¼•ä¸Šid=4è¿™ä¸€è¡Œ</p><p>æ‰§è¡Œæµç¨‹æ˜¯ä»è¡¨tä¸­æŒ‰ç…§ç´¢å¼•cå€’åºå—ï¼Œæ‰«æç¬¬ä¸€è¡Œï¼Œæ‹¿åˆ°ç»“æœå†™å…¥åˆ°è¡¨t2ä¸­ï¼Œå› æ­¤æ•´æ¡è¯­å¥çš„æ‰«æè¡Œæ•°æ˜¯1</p><p>ä½†å¦‚æœè¦æŠŠè¿™ä¸€è¡Œçš„æ•°æ®æ’å…¥åˆ°è¡¨tä¸­çš„è¯:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t(c,d)  (<span class="hljs-keyword">select</span> c<span class="hljs-operator">+</span><span class="hljs-number">1</span>, d <span class="hljs-keyword">from</span> t force index(c) <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> c <span class="hljs-keyword">desc</span> limit <span class="hljs-number">1</span>);<br><br></code></pre></td></tr></table></figure><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162511513.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>explainç»“æœä¸­çš„Extraå­—æ®µä¸­Using temporaryå­—æ®µï¼Œè¡¨ç¤ºè¿™ä¸ªè¯­å¥ç”¨åˆ°äº†ä¸´æ—¶è¡¨</p><p>æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p>1.åˆ›å»ºä¸´æ—¶è¡¨ï¼Œè¡¨é‡Œæœ‰ä¸¤ä¸ªå­—æ®µcå’Œd</p><p>2.æŒ‰ç…§ç´¢å¼•cæ‰«æè¡¨tï¼Œä¾æ¬¡å–c=4ã€3ã€2ã€1ï¼Œç„¶åå›è¡¨ï¼Œè¯»åˆ°cå’Œdçš„å€¼å†™å…¥ä¸´æ—¶è¡¨</p><p>3.ç”±äºè¯­ä¹‰é‡Œé¢æœ‰limit 1ï¼Œæ‰€ä»¥åªå–äº†ä¸´æ—¶è¡¨çš„ç¬¬ä¸€è¡Œï¼Œå†æ’å…¥åˆ°è¡¨tä¸­</p><p>è¿™ä¸ªè¯­å¥ä¼šå¯¼è‡´åœ¨è¡¨tä¸Šåšå…¨è¡¨æ‰«æï¼Œå¹¶ä¸”ä¼šç»™ç´¢å¼•cä¸Šçš„æ‰€æœ‰é—´éš™éƒ½åŠ ä¸Šå…±äº«çš„next-key lockã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªè¯­å¥æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½åœ¨è¿™ä¸ªè¡¨ä¸Šæ’å…¥æ•°æ®</p><p>éœ€è¦ä¸´æ—¶è¡¨æ˜¯å› ä¸ºè¿™ç±»ä¸€è¾¹éå†æ•°æ®ï¼Œä¸€è¾¹æ›´æ–°æ•°æ®çš„æƒ…å†µï¼Œå¦‚æœè¯»å‡ºæ¥çš„æ•°æ®ç›´æ¥å†™å›åŸè¡¨ï¼Œå°±å¯èƒ½åœ¨éå†è¿‡ç¨‹ä¸­ï¼Œè¯»åˆ°åˆšåˆšæ’å…¥çš„è®°å½•ï¼Œæ–°æ’å…¥çš„è®°å½•å¦‚æœå‚ä¸è®¡ç®—é€»è¾‘ï¼Œå°±è·Ÿè¯­ä¹‰ä¸ç¬¦.</p><h4 id="3ã€insertå”¯ä¸€é”®å†²çª">3ã€insertå”¯ä¸€é”®å†²çª</h4><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162520967.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>sessionAæ‰§è¡Œçš„insertè¯­å¥ï¼Œå‘ç”Ÿå”¯ä¸€é”®å†²çªçš„æ—¶å€™ï¼Œå¹¶ä¸åªæ˜¯ç®€å•åœ°æŠ¥é”™è¿”å›ï¼Œè¿˜åœ¨å†²çªçš„ç´¢å¼•ä¸ŠåŠ äº†é”ï¼ŒsessionAæŒæœ‰ç´¢å¼•cä¸Šçš„(5,10]å…±äº«next-key lockï¼ˆè¯»é”ï¼‰</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162531598.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>åœ¨sessionAæ‰§è¡Œrollbackè¯­å¥å›æ»šçš„æ—¶å€™ï¼ŒsessionCå‡ ä¹åŒæ—¶å‘ç°æ­»é”å¹¶è¿”å›</p><p>1.åœ¨T1æ—¶åˆ»ï¼Œå¯åŠ¨sessionAï¼Œå¹¶æ‰§è¡Œinsertè¯­å¥ï¼Œæ­¤æ—¶åœ¨ç´¢å¼•cçš„c=5ä¸ŠåŠ äº†è®°å½•é”ã€‚è¿™ä¸ªç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå› æ­¤é€€åŒ–ä¸ºè®°å½•é”</p><p>2.åœ¨T2æ—¶åˆ»ï¼ŒsessionAå›æ»šã€‚è¿™æ—¶å€™ï¼ŒsessionBå’ŒsessionCéƒ½è¯•å›¾ç»§ç»­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œéƒ½è¦åŠ ä¸Šå†™é”ã€‚ä¸¤ä¸ªsessionéƒ½è¦ç­‰å¾…å¯¹æ–¹çš„è¡Œé”ï¼Œæ‰€ä»¥å°±å‡ºç°äº†æ­»é”</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/20190605162540324.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><h4 id="4ã€insert-into-â€¦-on-duplicate-key-update">4ã€insert into â€¦ on duplicate key update</h4><p>ä¸Šé¢è¿™ä¸ªä¾‹å­æ˜¯ä¸»é”®å†²çªåç›´æ¥æŠ¥é”™ï¼Œå¦‚æœæ”¹å†™æˆ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t <span class="hljs-keyword">values</span>(<span class="hljs-number">11</span>,<span class="hljs-number">10</span>,<span class="hljs-number">10</span>) <span class="hljs-keyword">on</span> duplicate key update d<span class="hljs-operator">=</span><span class="hljs-number">100</span>; <br><br></code></pre></td></tr></table></figure><p>å°±ä¼šç»™ç´¢å¼•cä¸Š(5,10]åŠ ä¸€ä¸ªæ’ä»–çš„next-key lockï¼ˆå†™é”ï¼‰</p><p>insert into â€¦ on duplicate key updateçš„è¯­ä¹‰é€»è¾‘æ˜¯ï¼Œæ’å…¥ä¸€è¡Œæ•°æ®ï¼Œå¦‚æœç¢°åˆ°å”¯ä¸€é”®çº¦æŸï¼Œå°±ç»§ç»­æ‰§è¡Œåé¢çš„æ›´æ–°è¯­å¥ã€‚å¦‚æœæœ‰å¤šä¸ªåˆ—è¿åäº†å”¯ä¸€æ€§ç´¢å¼•ï¼Œå°±ä¼šæŒ‰ç…§ç´¢å¼•çš„é¡ºåºï¼Œä¿®æ”¹è·Ÿç¬¬ä¸€ä¸ªç´¢å¼•å†²çªçš„è¡Œ</p><p>è¡¨té‡Œé¢å·²ç»æœ‰äº†(1,1,1)å’Œ(2,2,2)è¿™ä¸¤è¡Œï¼Œæ‰§è¡Œè¿™ä¸ªè¯­å¥æ•ˆæœå¦‚ä¸‹ï¼š</p><img src="/dajiangdahe.github.io/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E9%94%81/2019060516255097.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>ä¸»é”®idæ˜¯å…ˆåˆ¤æ–­çš„ï¼ŒMySQLè®¤ä¸ºè¿™ä¸ªè¯­å¥è·Ÿid=2è¿™ä¸€è¡Œå†²çªï¼Œæ‰€ä»¥ä¿®æ”¹çš„æ˜¯id=2çš„è¡Œ</p><p><strong>æ€è€ƒé¢˜ï¼š</strong><br>1ã€å¦‚æœè¦åˆ é™¤ä¸€ä¸ªè¡¨é‡Œé¢çš„å‰10000è¡Œæ•°æ®ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•å¯ä»¥åšåˆ°ï¼š</p><ul><li>ç¬¬ä¸€ç§ï¼Œç›´æ¥æ‰§è¡Œdelete from T limit 10000;</li><li>ç¬¬äºŒç§ï¼Œåœ¨ä¸€ä¸ªè¿æ¥ä¸­å¾ªç¯æ‰§è¡Œ20æ¬¡delete from T limit 500ï¼›</li><li>ç¬¬ä¸‰ç§ï¼Œåœ¨20ä¸ªè¿æ¥ä¸­åŒæ—¶æ‰§è¡Œdelete from T limit 500ï¼›<br>é€‰æ‹©å“ªä¸€ç§æ–¹å¼æ¯”è¾ƒå¥½ï¼Ÿ</li></ul><p><strong>å‚è€ƒç­”æ¡ˆï¼š</strong></p><ul><li><p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œå•ä¸ªè¯­å¥å ç”¨æ—¶é—´é•¿ï¼Œé”çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿ï¼Œè€Œä¸”å¤§äº‹åŠ¡è¿˜ä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿ</p></li><li><p>ç¬¬ä¸‰ç§æ–¹å¼ï¼Œä¼šäººä¸ºé€ æˆé”å†²çª</p></li><li><p>ç¬¬äºŒç§æ–¹å¼ç›¸å¯¹è¾ƒå¥½</p></li></ul><hr><h1>MyISAMå’ŒMySQLçš„é”çš„å¯¹æ¯”æ€»ç»“</h1><p><strong>å¯¹äºï¼­yISAMçš„è¡¨é”ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹</strong></p><p>ï¼ˆï¼‘ï¼‰å…±äº«è¯»é”ï¼ˆSï¼‰ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼Œä½†å…±äº«è¯»é”ï¼ˆSï¼‰å’Œæ’ä»–å†™é”ï¼ˆXï¼‰ä¹‹é—´ï¼Œä»¥åŠæ’ä»–å†™é”ä¹‹é—´ï¼ˆXï¼‰æ˜¯äº’æ–¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¯»å’Œå†™æ˜¯ä¸²è¡Œçš„ã€‚</p><p>ï¼ˆï¼’ï¼‰åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œï¼­yISAMå…è®¸æŸ¥è¯¢å’Œæ’å…¥å¹¶å‘æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥è§£å†³åº”ç”¨ä¸­å¯¹åŒä¸€è¡¨å’Œæ’å…¥çš„é”äº‰ç”¨é—®é¢˜ã€‚</p><p>ï¼ˆï¼“ï¼‰ï¼­yISAMé»˜è®¤çš„é”è°ƒåº¦æœºåˆ¶æ˜¯å†™ä¼˜å…ˆï¼Œè¿™å¹¶ä¸ä¸€å®šé€‚åˆæ‰€æœ‰åº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è®¾ç½®LOW_PRIPORITY_UPDATESå‚æ•°ï¼Œæˆ–åœ¨INSERTã€UPDATEã€DELETEè¯­å¥ä¸­æŒ‡å®šLOW_PRIORITYé€‰é¡¹æ¥è°ƒèŠ‚è¯»å†™é”çš„äº‰ç”¨ã€‚</p><p>ï¼ˆï¼”ï¼‰ç”±äºè¡¨é”çš„é”å®šç²’åº¦å¤§ï¼Œè¯»å†™ä¹‹é—´åˆæ˜¯ä¸²è¡Œçš„ï¼Œå› æ­¤ï¼Œå¦‚æœæ›´æ–°æ“ä½œè¾ƒå¤šï¼Œï¼­yISAMè¡¨å¯èƒ½ä¼šå‡ºç°ä¸¥é‡çš„é”ç­‰å¾…ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨InnoDBè¡¨æ¥å‡å°‘é”å†²çªã€‚</p><p><strong>å¯¹äºInnoDBè¡¨ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹</strong></p><p>ï¼ˆï¼‘ï¼‰InnoDBçš„è¡Œé”€æ˜¯åŸºäºç´¢å¼•å®ç°çš„ï¼Œå¦‚æœä¸é€šè¿‡ç´¢å¼•è®¿é—®æ•°æ®ï¼ŒInnoDBä¼šä½¿ç”¨è¡¨é”ã€‚</p><p>ï¼ˆï¼’ï¼‰InnoDBé—´éš™é”æœºåˆ¶ï¼Œä»¥åŠInnoDBä½¿ç”¨é—´éš™é”çš„åŸå› ã€‚</p><p>ï¼ˆï¼“ï¼‰åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹ï¼ŒInnoDBçš„é”æœºåˆ¶å’Œä¸€è‡´æ€§è¯»ç­–ç•¥ä¸åŒã€‚</p><p>ï¼ˆï¼”ï¼‰ï¼­ySQLçš„æ¢å¤å’Œå¤åˆ¶å¯¹InnoDBé”æœºåˆ¶å’Œä¸€è‡´æ€§è¯»ç­–ç•¥ä¹Ÿæœ‰è¾ƒå¤§å½±å“ã€‚</p><p>ï¼ˆï¼•ï¼‰é”å†²çªç”šè‡³æ­»é”å¾ˆéš¾å®Œå…¨é¿å…ã€‚</p><p><strong>åœ¨äº†è§£InnoDBçš„é”ç‰¹æ€§åï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è®¾è®¡å’ŒSQLè°ƒæ•´ç­‰æªæ–½å‡å°‘é”å†²çªå’Œæ­»é”ï¼ŒåŒ…æ‹¬ï¼š</strong></p><ul><li>å°½é‡ä½¿ç”¨è¾ƒä½çš„éš”ç¦»çº§åˆ«</li><li>ç²¾å¿ƒè®¾è®¡ç´¢å¼•ï¼Œå¹¶å°½é‡ä½¿ç”¨ç´¢å¼•è®¿é—®æ•°æ®ï¼Œä½¿åŠ é”æ›´ç²¾ç¡®ï¼Œä»è€Œå‡å°‘é”å†²çªçš„æœºä¼šã€‚</li><li>é€‰æ‹©åˆç†çš„äº‹åŠ¡å¤§å°ï¼Œå°äº‹åŠ¡å‘ç”Ÿé”å†²çªçš„å‡ ç‡ä¹Ÿæ›´å°ã€‚</li><li>ç»™è®°å½•é›†æ˜¾ç¤ºåŠ é”æ—¶ï¼Œæœ€å¥½ä¸€æ¬¡æ€§è¯·æ±‚è¶³å¤Ÿçº§åˆ«çš„é”ã€‚æ¯”å¦‚è¦ä¿®æ”¹æ•°æ®çš„è¯ï¼Œæœ€å¥½ç›´æ¥ç”³è¯·æ’ä»–é”ï¼Œè€Œä¸æ˜¯å…ˆç”³è¯·å…±äº«é”ï¼Œä¿®æ”¹æ—¶å†è¯·æ±‚æ’ä»–é”ï¼Œè¿™æ ·å®¹æ˜“äº§ç”Ÿæ­»é”ã€‚</li><li>ä¸åŒçš„ç¨‹åºè®¿é—®ä¸€ç»„è¡¨æ—¶ï¼Œåº”å°½é‡çº¦å®šä»¥ç›¸åŒçš„é¡ºåºè®¿é—®å„è¡¨ï¼Œå¯¹ä¸€ä¸ªè¡¨è€Œè¨€ï¼Œå°½å¯èƒ½ä»¥å›ºå®šçš„é¡ºåºå­˜å–è¡¨ä¸­çš„è¡Œã€‚è¿™æ ·å¯ä»¥å¤§å‡å°‘æ­»é”çš„æœºä¼šã€‚</li><li>å°½é‡ç”¨ç›¸ç­‰æ¡ä»¶è®¿é—®æ•°æ®ï¼Œè¿™æ ·å¯ä»¥é¿å…é—´éš™é”å¯¹å¹¶å‘æ’å…¥çš„å½±å“ã€‚</li><li>ä¸è¦ç”³è¯·è¶…è¿‡å®é™…éœ€è¦çš„é”çº§åˆ«ï¼›é™¤éå¿…é¡»ï¼ŒæŸ¥è¯¢æ—¶ä¸è¦æ˜¾ç¤ºåŠ é”ã€‚</li><li>å¯¹äºä¸€äº›ç‰¹å®šçš„äº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨è¡¨é”æ¥æé«˜å¤„ç†é€Ÿåº¦æˆ–å‡å°‘æ­»é”çš„å¯èƒ½ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlä¸­çš„æ—¥å¿—</title>
    <link href="/dajiangdahe/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E6%97%A5%E5%BF%97/"/>
    <url>/dajiangdahe/2021/10/22/Mysql%E4%B8%AD%E7%9A%84%E6%97%A5%E5%BF%97/</url>
    
    <content type="html"><![CDATA[<h1>Mysqlä¸­çš„æ—¥å¿—</h1><ul><li>é”™è¯¯æ—¥å¿—</li><li>æŸ¥è¯¢æ—¥å¿—</li><li>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰</li><li>undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰</li><li>bin logï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰</li></ul><h2 id="1-é”™è¯¯æ—¥å¿—">1.é”™è¯¯æ—¥å¿—</h2><p>ç”¨æ¥è®°å½• MySQL æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯,é»˜è®¤å¼€å¯æ— æ³•å…³é—­.<br>å¤åˆ¶ç¯å¢ƒä¸‹ï¼Œä»æœåŠ¡å™¨è¿›ç¨‹çš„ä¿¡æ¯ä¹Ÿä¼šè¢«è®°å½•è¿›é”™è¯¯æ—¥å¿—</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯æ—¥å¿—æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“çš„æ•°æ®æ–‡ä»¶ç›®å½•ä¸­ï¼Œåç§°ä¸º hostname.errï¼Œå…¶ä¸­ hostname ä¸ºæœåŠ¡å™¨ä¸»æœºåã€‚åœ¨ MySQL 5.5.7 ä¹‹å‰ï¼Œæ•°æ®åº“ç®¡ç†å‘˜å¯ä»¥åˆ é™¤å¾ˆé•¿æ—¶é—´ä¹‹å‰çš„é”™è¯¯æ—¥å¿—ï¼Œä»¥èŠ‚çœæœåŠ¡å™¨ä¸Šçš„ç¡¬ç›˜ç©ºé—´ï¼Œ MySQL 5.5.7 ä¹‹åï¼ŒæœåŠ¡å™¨å°†å…³é—­æ­¤é¡¹åŠŸèƒ½ï¼Œåªèƒ½ä½¿ç”¨é‡å‘½ååŸæ¥çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶ï¼Œæ‰‹åŠ¨å†²æ´—æ—¥å¿—åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œå‘½ä»¤ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mv hostname.err hostname.err.old mysqladmin flush<span class="hljs-operator">-</span>logs<br></code></pre></td></tr></table></figure><h2 id="2-æŸ¥è¯¢æ—¥å¿—">2.æŸ¥è¯¢æ—¥å¿—</h2><p><strong>æŸ¥è¯¢æ—¥å¿—é‡Œé¢è®°å½•äº†æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤ï¼Œä¸ç®¡è¯­å¥æ˜¯å¦æ­£ç¡®ï¼Œéƒ½ä¼šè¢«è®°å½•</strong>ï¼Œå…·ä½“åŸå› å¦‚ä¸‹:</p><ul><li>insert æŸ¥è¯¢ä¸ºäº†é¿å…æ•°æ®å†²çªï¼Œå¦‚æœæ­¤å‰æ’å…¥è¿‡æ•°æ®ï¼Œå½“å‰æ’å…¥çš„æ•°æ®å¦‚æœè·Ÿä¸»é”®æˆ–å”¯ä¸€é”®çš„æ•°æ®é‡å¤é‚£è‚¯å®šä¼šæŠ¥é”™ï¼›</li><li>update æ—¶ä¹Ÿä¼šæŸ¥è¯¢å› ä¸ºæ›´æ–°çš„æ—¶å€™å¾ˆå¯èƒ½ä¼šæ›´æ–°æŸä¸€å—æ•°æ®ï¼›</li><li>delete æŸ¥è¯¢ï¼Œåªåˆ é™¤ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼›</li></ul><p>å› æ­¤éƒ½ä¼šäº§ç”Ÿæ—¥å¿—ï¼Œåœ¨å¹¶å‘æ“ä½œéå¸¸å¤šçš„åœºæ™¯ä¸‹ï¼ŒæŸ¥è¯¢ä¿¡æ¯ä¼šéå¸¸å¤šï¼Œé‚£ä¹ˆå¦‚æœéƒ½è®°å½•ä¸‹æ¥ä¼šå¯¼è‡´ IO éå¸¸å¤§ï¼Œå½±å“ MySQL æ€§èƒ½ï¼Œå› æ­¤å¦‚æœä¸æ˜¯åœ¨è°ƒè¯•ç¯å¢ƒä¸‹ï¼Œæ˜¯ä¸å»ºè®®å¼€å¯æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½çš„ã€‚</p><p>æŸ¥è¯¢æ—¥å¿—æ¨¡å¼æ˜¯å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> generallog<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> logoutput<span class="hljs-operator">=</span>â€˜<span class="hljs-keyword">table</span>â€™;<br></code></pre></td></tr></table></figure><h2 id="3-redo-log-é‡åšæ—¥å¿—-ä¸€ç§ç¼“å­˜æœºåˆ¶">3.redo log(é‡åšæ—¥å¿—) ä¸€ç§ç¼“å­˜æœºåˆ¶</h2><p><strong>æ˜¯ä»€ä¹ˆ</strong>:ä¸ºäº†æœ€å¤§ç¨‹åº¦çš„é¿å…æ•°æ®å†™å…¥æ—¶ï¼Œå› ä¸º IO ç“¶é¢ˆé€ æˆçš„æ€§èƒ½é—®é¢˜</p><p>æ€ä¹ˆåŠ:<strong>å…ˆå°†æ•°æ®</strong>å†™å…¥å†…å­˜ä¸­ï¼Œå†<strong>æ‰¹é‡æŠŠå†…å­˜ä¸­çš„æ•°æ®</strong>ç»Ÿä¸€åˆ·å›ç£ç›˜ã€‚ä¸ºäº†é¿å…å°†æ•°æ®åˆ·å›ç£ç›˜è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæ‰ç”µæˆ–ç³»ç»Ÿæ•…éšœå¸¦æ¥çš„æ•°æ®ä¸¢å¤±é—®é¢˜ï¼ŒInnoDB é‡‡ç”¨ redo log æ¥è§£å†³æ­¤é—®é¢˜ã€‚</p><h2 id="4-undo-logï¼ˆå›æ»šæ—¥å¿—ï¼‰">4.undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰</h2><p><strong>æ˜¯ä»€ä¹ˆ</strong>ï¼šç”¨äºå­˜å‚¨æ—¥å¿—è¢«ä¿®æ”¹å‰çš„å€¼ï¼Œä»è€Œä¿è¯å¦‚æœä¿®æ”¹å‡ºç°å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨ undo log æ—¥å¿—æ¥å®ç°å›æ»šæ“ä½œã€‚</p><p><strong>æ€ä¹ˆåš</strong>:<strong>undo log</strong> å’Œ redo log è®°å½•ç‰©ç†æ—¥å¿—ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯é€»è¾‘æ—¥å¿—ï¼Œå¯ä»¥è®¤ä¸ºå½“ delete ä¸€æ¡è®°å½•æ—¶ï¼Œundo log ä¸­ä¼šè®°å½•ä¸€æ¡å¯¹åº”çš„ insert è®°å½•ï¼Œåä¹‹äº¦ç„¶ï¼Œå½“ update ä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒè®°å½•ä¸€æ¡å¯¹åº”ç›¸åçš„ update è®°å½•ï¼Œå½“æ‰§è¡Œ rollback æ—¶ï¼Œå°±å¯ä»¥ä» undo log ä¸­çš„é€»è¾‘è®°å½•è¯»å–åˆ°ç›¸åº”çš„å†…å®¹å¹¶è¿›è¡Œå›æ»šã€‚<strong>undo log é»˜è®¤å­˜æ”¾åœ¨å…±äº«è¡¨ç©ºé—´ä¸­</strong>ï¼Œåœ¨ ySQL 5.6 ä¸­ï¼Œundo log çš„å­˜æ”¾ä½ç½®è¿˜å¯ä»¥é€šè¿‡å˜é‡ innodbundodirectory æ¥è‡ªå®šä¹‰å­˜æ”¾ç›®å½•ï¼Œé»˜è®¤å€¼ä¸ºâ€œ.â€è¡¨ç¤º datadir ç›®å½•ã€‚</p><h2 id="5-bin-log-äºŒè¿›åˆ¶æ—¥å¿—">5.bin log(äºŒè¿›åˆ¶æ—¥å¿—)</h2><p>æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸»è¦è®°å½•æ‰€æœ‰æ•°æ®åº“è¡¨ç»“æ„å˜æ›´bin log ä¸­è®°å½•äº†å¯¹ MySQL æ•°æ®åº“<strong>æ‰§è¡Œæ›´æ”¹çš„æ‰€æœ‰æ“ä½œ</strong>ï¼Œå¹¶ä¸”è®°å½•äº†è¯­å¥å‘ç”Ÿæ—¶é—´ã€æ‰§è¡Œæ—¶é•¿ã€æ“ä½œæ•°æ®ç­‰å…¶å®ƒé¢å¤–ä¿¡æ¯ï¼Œä½†æ˜¯<strong>å®ƒä¸è®°å½• SELECTã€SHOW ç­‰é‚£äº›ä¸ä¿®æ”¹æ•°æ®çš„ SQL è¯­å¥</strong>ã€‚</p><p>ã€<strong>binlog çš„ä½œç”¨å¦‚ä¸‹</strong>ã€‘ï¼š</p><ul><li><strong>æ¢å¤ï¼ˆrecoveryï¼‰</strong>ï¼šæŸäº›æ•°æ®çš„æ¢å¤éœ€è¦äºŒè¿›åˆ¶æ—¥å¿—ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªæ•°æ®åº“å…¨å¤‡æ–‡ä»¶æ¢å¤åï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—è¿›è¡Œ point-in-time çš„æ¢å¤ï¼›</li><li><strong>å¤åˆ¶ï¼ˆreplicationï¼‰</strong>ï¼šå…¶åŸç†ä¸æ¢å¤ç±»ä¼¼ï¼Œé€šè¿‡å¤åˆ¶å’Œæ‰§è¡ŒäºŒè¿›åˆ¶æ—¥å¿—ä½¿ä¸€å°è¿œç¨‹çš„MySQLæ•°æ®åº“ï¼ˆä¸€èˆ¬ç§°ä¸º slave æˆ–è€… standbyï¼‰ä¸ä¸€å° MySQL æ•°æ®åº“ï¼ˆä¸€èˆ¬ç§°ä¸º master æˆ–è€… primaryï¼‰è¿›è¡Œå®æ—¶åŒæ­¥ï¼›</li><li><strong>å®¡è®¡ï¼ˆauditï¼‰</strong>ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—ä¸­çš„ä¿¡æ¯æ¥è¿›è¡Œå®¡è®¡ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å¯¹æ•°æ®åº“è¿›è¡Œæ³¨å…¥æ”»å‡»ã€‚</li><li>binlog å¯¹äºäº‹åŠ¡å­˜å‚¨å¼•æ“çš„å´©æºƒæ¢å¤ä¹Ÿæœ‰éå¸¸é‡è¦çš„ä½œç”¨</li></ul><p>å¼€å¯æ–¹æ³•:</p><p>binlog é»˜è®¤æ˜¯å…³é—­çŠ¶æ€ï¼Œå¯ä»¥åœ¨ MySQL é…ç½®æ–‡ä»¶ï¼ˆmy.cnfï¼‰ä¸­é€šè¿‡é…ç½®å‚æ•° log-bin = [base-name] å¼€å¯è®°å½• binlog æ—¥å¿—ï¼Œå¦‚æœä¸æŒ‡å®š base-nameï¼Œåˆ™é»˜è®¤äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åä¸ºä¸»æœºåï¼Œå¹¶ä»¥è‡ªå¢çš„æ•°å­—ä½œä¸ºåç¼€ï¼Œæ¯”å¦‚ï¼šmysql-bin.000001ï¼Œæ‰€åœ¨ç›®å½•ä¸ºæ•°æ®åº“æ‰€åœ¨ç›®å½•ï¼ˆdatadirï¼‰ã€‚</p><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥è¯¢ binlog æ˜¯å¦å¼€å¯ï¼š</p><blockquote><p>show variables like â€˜log_%â€™;</p></blockquote><p><strong>binlog æ ¼å¼åˆ†ä¸º: STATEMENTã€ROW å’Œ MIXED ä¸‰ç§ï¼š</strong></p><p><strong>STATEMENTæ ¼å¼</strong>ï¼šçš„ binlog è®°å½•çš„æ˜¯æ•°æ®åº“ä¸Šæ‰§è¡Œçš„åŸç”Ÿ SQL è¯­å¥ã€‚è¿™ç§æ ¼å¼çš„ä¼˜ç‚¹æ˜¯ç®€å•ï¼Œç®€å•åœ°è®°å½•å’Œæ‰§è¡Œè¿™äº›è¯­å¥ï¼Œèƒ½å¤Ÿè®©ä¸»å¤‡ä¿æŒåŒæ­¥ï¼Œåœ¨ä¸»æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„ SQL è¯­å¥ï¼Œåœ¨ä»æœåŠ¡å™¨ä¸Šæ‰§è¡ŒåŒæ ·çš„è¯­å¥ã€‚å¦ä¸€ä¸ªå¥½å¤„æ˜¯äºŒè¿›åˆ¶æ—¥å¿—é‡Œçš„æ—¶é—´æ›´åŠ ç´§å‡‘ï¼Œæ‰€ä»¥ç›¸å¯¹è€Œè¨€ï¼ŒåŸºäºè¯­å¥çš„å¤åˆ¶æ¨¡å¼ä¸ä¼šä½¿ç”¨å¤ªå¤šå¸¦å®½ï¼ŒåŒæ—¶ä¹ŸèŠ‚çº¦ç£ç›˜ç©ºé—´ã€‚</p><p><strong>ROW æ ¼å¼</strong>ï¼šæ˜¯ä» MySQL 5.1 å¼€å§‹æ”¯æŒåŸºäºè¡Œçš„å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯åŸºäºæ•°æ®çš„å¤åˆ¶ï¼ŒåŸºäºè¡Œçš„æ›´æ”¹ã€‚è¿™ç§æ–¹å¼ä¼šå°†å®é™…æ•°æ®è®°å½•åœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­ï¼Œå®ƒæœ‰å…¶è‡ªèº«çš„ä¸€äº›ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯å¯ä»¥æ­£ç¡®åœ°å¤åˆ¶æ¯ä¸€è¡Œæ•°æ®ï¼Œä¸€äº›è¯­å¥å¯ä»¥è¢«æ›´åŠ æœ‰æ•ˆåœ°å¤åˆ¶ï¼Œå¦å¤–å°±æ˜¯å‡ ä¹æ²¡æœ‰åŸºäºè¡Œçš„å¤åˆ¶æ¨¡å¼æ— æ³•å¤„ç†çš„åœºæ™¯ï¼Œå¯¹äºæ‰€æœ‰çš„ SQL æ„é€ ã€è§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹ç­‰éƒ½èƒ½æ­£ç¡®æ‰§è¡Œï¼›å®ƒçš„ç¼ºç‚¹å°±æ˜¯äºŒè¿›åˆ¶æ—¥å¿—å¯èƒ½ä¼šå¾ˆå¤§ï¼Œè€Œä¸”ä¸ç›´</p><p><strong>MIXED æ ¼å¼</strong>ï¼šä¹Ÿæ˜¯ MySQL é»˜è®¤ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—è®°å½•æ–¹å¼ï¼Œä½† MIXED æ ¼å¼é»˜è®¤é‡‡ç”¨åŸºäºè¯­å¥çš„å¤åˆ¶ï¼Œä¸€æ—¦å‘ç°åŸºäºè¯­å¥çš„æ— æ³•ç²¾ç¡®çš„å¤åˆ¶æ—¶ï¼Œå°±ä¼šé‡‡ç”¨åŸºäºè¡Œçš„å¤åˆ¶ã€‚æ¯”å¦‚ç”¨åˆ° UUID()ã€USER()ã€CURRENTUSER()ã€ROWCOUNT() ç­‰æ— æ³•ç¡®å®šçš„å‡½æ•°ã€‚</p><h1>MySQLæ—¥å¿—é—®é¢˜æ‰©å……</h1><h2 id="1-redo-log-å’Œ-binlog-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">1.redo log å’Œ binlog æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰å’Œ binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰éƒ½æ˜¯ MySQL çš„é‡è¦çš„æ—¥å¿—ï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ã€‚</li><li>binlog æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ ID=2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1 â€ã€‚</li><li>redo log æ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„ï¼›</li><li>binlog æ˜¯ MySQL çš„ Server å±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚</li><li>redo log æ˜¯å¾ªç¯å†™çš„ï¼Œç©ºé—´å›ºå®šä¼šç”¨å®Œï¼›</li><li>binlog æ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„ã€‚â€œè¿½åŠ å†™â€æ˜¯æŒ‡ binlog æ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚æœ€å¼€å§‹ MySQL é‡Œå¹¶æ²¡æœ‰ InnoDB å¼•æ“ï¼ŒMySQL è‡ªå¸¦çš„å¼•æ“æ˜¯ MyISAMï¼Œä½†æ˜¯ MyISAM æ²¡æœ‰ crash-safe çš„èƒ½åŠ›ï¼Œbinlog æ—¥å¿—åªèƒ½ç”¨äºå½’æ¡£ã€‚è€Œ InnoDB æ˜¯å¦ä¸€ä¸ªå…¬å¸ä»¥æ’ä»¶å½¢å¼å¼•å…¥ MySQL çš„ï¼Œæ—¢ç„¶åªä¾é  binlog æ˜¯æ²¡æœ‰ crash-safe èƒ½åŠ›çš„ï¼Œæ‰€ä»¥ InnoDB ä½¿ç”¨å¦å¤–ä¸€å¥—æ—¥å¿—ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ redo log æ¥å®ç° crash-safe èƒ½åŠ›ã€‚ï¼ˆä¸¤æ®µå¼æäº¤ï¼Œåˆ†æˆ<strong>prepare + commit</strong> æ¥ä¿è¯crash-safeï¼‰</li></ul><h2 id="2-ä»€ä¹ˆæ˜¯-crash-safeï¼Ÿ">2.ä»€ä¹ˆæ˜¯ crash-safeï¼Ÿ</h2><p>crash-safe æ˜¯æŒ‡å‘ç”Ÿå®•æœºç­‰æ„å¤–æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨é‡å¯åæ•°æ®ä¾ç„¶ä¸ä¼šä¸¢å¤±çš„æƒ…å†µã€‚</p><h2 id="3-ä»€ä¹ˆæ˜¯è„é¡µå’Œå¹²å‡€é¡µï¼Ÿ">3.ä»€ä¹ˆæ˜¯è„é¡µå’Œå¹²å‡€é¡µï¼Ÿ</h2><p>MySQL ä¸ºäº†æ“ä½œçš„æ€§èƒ½ä¼˜åŒ–ï¼Œä¼šæŠŠæ•°æ®æ›´æ–°å…ˆæ”¾å…¥å†…å­˜ä¸­ï¼Œä¹‹åå†ç»Ÿä¸€æ›´æ–°åˆ°ç£ç›˜ã€‚å½“å†…å­˜æ•°æ®å’Œç£ç›˜æ•°æ®å†…å®¹ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªå†…å­˜é¡µä¸ºè„é¡µï¼›å†…å­˜æ•°æ®å†™åˆ°ç£ç›˜åï¼Œå†…å­˜çš„æ•°æ®å’Œç£ç›˜ä¸Šçš„å†…å®¹å°±ä¸€è‡´äº†ï¼Œæˆ‘ä»¬ç§°ä¸ºâ€œå¹²å‡€é¡µâ€ã€‚</p><h2 id="4-MySQLä¸€é¡µçš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿ">4.MySQLä¸€é¡µçš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿ</h2><p>16KB</p><h2 id="5-ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¼•å‘-MySQL-åˆ·è„é¡µï¼ˆflushï¼‰çš„æ“ä½œï¼Ÿ">5.ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¼•å‘ MySQL åˆ·è„é¡µï¼ˆflushï¼‰çš„æ“ä½œï¼Ÿ</h2><ul><li>å†…å­˜å†™æ»¡äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå¼•å‘ flush æ“ä½œï¼Œå¯¹åº”åˆ° InnoDB å°±æ˜¯ redo log å†™æ»¡äº†ï¼›</li><li>ç³»ç»Ÿçš„å†…å­˜ä¸è¶³äº†ï¼Œå½“éœ€è¦æ–°çš„å†…å­˜é¡µçš„æ—¶å€™ï¼Œå°±ä¼šæ·˜æ±°ä¸€äº›å†…å­˜é¡µï¼Œå¦‚æœæ·˜æ±°çš„æ˜¯è„é¡µè¿™ä¸ªæ—¶å€™å°±ä¼šè§¦å‘ flush æ“ä½œï¼›</li><li>ç³»ç»Ÿç©ºé—²çš„æ—¶å€™ï¼ŒMySQL ä¼šåŒæ­¥å†…å­˜ä¸­çš„æ•°æ®åˆ°ç£ç›˜ä¹Ÿä¼šè§¦å‘ flush æ“ä½œï¼›</li><li>MySQL æœåŠ¡å…³é—­çš„æ—¶å€™ä¹Ÿä¼šåˆ·è„é¡µï¼Œè§¦å‘ flush æ“ä½œã€‚</li></ul><h2 id="6-MySQL-åˆ·è„é¡µçš„é€Ÿåº¦å¾ˆæ…¢å¯èƒ½æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ">6.MySQL åˆ·è„é¡µçš„é€Ÿåº¦å¾ˆæ…¢å¯èƒ½æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ</h2><p>åœ¨ MySQL ä¸­å•ç‹¬åˆ·ä¸€ä¸ªè„é¡µçš„é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œå¦‚æœå‘ç°åˆ·è„é¡µçš„é€Ÿåº¦å¾ˆæ…¢ï¼Œè¯´æ˜è§¦å‘äº† MySQL åˆ·è„é¡µçš„â€œè¿åâ€æœºåˆ¶ï¼ŒMySQL çš„â€œè¿åâ€æœºåˆ¶æ˜¯æŒ‡å½“ MySQL åˆ·è„é¡µçš„æ—¶å€™å¦‚æœå‘ç°ç›¸é‚»çš„æ•°æ®é¡µä¹Ÿæ˜¯è„é¡µä¹Ÿä¼šä¸€èµ·åˆ·æ‰ï¼Œè€Œè¿™ä¸ªåŠ¨ä½œå¯ä»¥ä¸€ç›´è”“å»¶ä¸‹å»ï¼Œè¿™å°±æ˜¯å¯¼è‡´ MySQL åˆ·è„é¡µæ…¢çš„åŸå› äº†ã€‚</p><h2 id="7-å¦‚ä½•æ§åˆ¶-MySQL-åªåˆ·æ–°å½“å‰è„é¡µï¼Ÿ">7.å¦‚ä½•æ§åˆ¶ MySQL åªåˆ·æ–°å½“å‰è„é¡µï¼Ÿ</h2><p>åœ¨ InnoDB ä¸­è®¾ç½® innodbflushneighbors è¿™ä¸ªå‚æ•°çš„å€¼ä¸º 0ï¼Œæ¥è§„å®š MySQL åªåˆ·å½“å‰è„é¡µï¼ŒMySQL 8 è¿™ä¸ªå€¼é»˜è®¤æ˜¯ 0ã€‚</p><h2 id="8-MySQL-çš„-WAL-æŠ€æœ¯æ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜çš„ï¼Ÿ">8.MySQL çš„ WAL æŠ€æœ¯æ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜çš„ï¼Ÿ</h2><p>WAL æŠ€æœ¯çš„å…¨ç§°æ˜¯ Write Ahead Loggingï¼ˆä¸­æ–‡ï¼šé¢„å†™å¼æ—¥å¿—ï¼‰ï¼Œæ˜¯å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜çš„æ–¹å¼ï¼Œå› ä¸ºæ¯æ¬¡æ›´æ–°éƒ½å†™ç£ç›˜çš„è¯ IO æˆæœ¬å¾ˆé«˜ï¼Œæ‰€ä»¥æ‰æœ‰äº† WAL æŠ€æœ¯ã€‚</p><h2 id="9-ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šæ„Ÿè§‰-MySQL-å¶å°”å¡ä¸€ä¸‹ï¼Ÿ">9.ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šæ„Ÿè§‰ MySQL å¶å°”å¡ä¸€ä¸‹ï¼Ÿ</h2><p>å¦‚æœå¶å°”æ„Ÿè§‰ MySQL å¡ä¸€ä¸‹ï¼Œå¯èƒ½æ˜¯ MySQL æ­£åœ¨åˆ·è„é¡µï¼Œæ­£åœ¨æŠŠå†…å­˜ä¸­çš„æ›´æ–°æ“ä½œåˆ·åˆ°ç£ç›˜ä¸­ã€‚</p><h2 id="10-redo-log-å’Œ-binlog-æ˜¯æ€ä¹ˆå…³è”çš„">10.redo log å’Œ binlog æ˜¯æ€ä¹ˆå…³è”çš„?</h2><p>å®ƒä»¬æœ‰ä¸€ä¸ªå…±åŒçš„æ•°æ®å­—æ®µï¼Œå« XIDã€‚å´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œä¼šæŒ‰é¡ºåºæ‰«æ redo logï¼š</p><ul><li>å¦‚æœç¢°åˆ°æ—¢æœ‰ prepareã€åˆæœ‰ commit çš„ redo logï¼Œå°±ç›´æ¥æäº¤ï¼›</li><li>å¦‚æœç¢°åˆ°åªæœ‰ parepareã€è€Œæ²¡æœ‰ commit çš„ redo logï¼Œå°±æ‹¿ç€ XID å» binlog æ‰¾å¯¹åº”çš„äº‹åŠ¡ã€‚</li></ul><h2 id="11-MySQL-æ€ä¹ˆçŸ¥é“-binlog-æ˜¯å®Œæ•´çš„">11.MySQL æ€ä¹ˆçŸ¥é“ binlog æ˜¯å®Œæ•´çš„?</h2><ul><li>statement æ ¼å¼çš„ binlogï¼Œå®Œæ•´çš„æ ‡è¯†æ˜¯æœ€åæœ‰ COMMIT å…³é”®å­—ã€‚</li><li>row æ ¼å¼çš„ binlogï¼Œå®Œæ•´çš„æ ‡è¯†æ˜¯æœ€åä¼šæœ‰ä¸€ä¸ª XID event å…³é”®å­—ã€‚</li></ul><h2 id="12-MySQL-ä¸­å¯ä¸å¯ä»¥åªè¦-binlogï¼Œä¸è¦-redo-logï¼Ÿ">12.MySQL ä¸­å¯ä¸å¯ä»¥åªè¦ binlogï¼Œä¸è¦ redo logï¼Ÿ</h2><p>ä¸å¯ä»¥ï¼Œbinlog æ²¡æœ‰å´©æºƒæ¢å¤çš„èƒ½åŠ›ã€‚</p><h2 id="13-MySQL-ä¸­å¯ä¸å¯ä»¥åªè¦-redo-logï¼Œä¸è¦-binlogï¼Ÿ">13.MySQL ä¸­å¯ä¸å¯ä»¥åªè¦ redo logï¼Œä¸è¦ binlogï¼Ÿ</h2><p>ä¸å¯ä»¥ï¼ŒåŸå› æœ‰ä»¥ä¸‹ä¸¤ä¸ªï¼š</p><ul><li>redo log æ˜¯å¾ªç¯å†™ä¸èƒ½ä¿è¯æ‰€æœ‰çš„å†å²æ•°æ®ï¼Œè¿™äº›å†å²æ•°æ®åªèƒ½åœ¨ binlog ä¸­æ‰¾åˆ°ï¼›</li><li>binlog æ˜¯é«˜å¯ç”¨çš„åŸºç¡€ï¼Œé«˜å¯ç”¨çš„å®ç°åŸç†å°±æ˜¯ binlog å¤åˆ¶ã€‚</li></ul><h2 id="14-ä¸ºä»€ä¹ˆ-binlog-cache-æ˜¯æ¯ä¸ªçº¿ç¨‹è‡ªå·±ç»´æŠ¤çš„ï¼Œè€Œ-redo-log-buffer-æ˜¯å…¨å±€å…±ç”¨çš„ï¼Ÿ">14.ä¸ºä»€ä¹ˆ binlog cache æ˜¯æ¯ä¸ªçº¿ç¨‹è‡ªå·±ç»´æŠ¤çš„ï¼Œè€Œ redo log buffer æ˜¯å…¨å±€å…±ç”¨çš„ï¼Ÿ</h2><p>å› ä¸º binlog æ˜¯ä¸èƒ½â€œè¢«æ‰“æ–­çš„â€ï¼Œä¸€ä¸ªäº‹åŠ¡çš„ binlog å¿…é¡»è¿ç»­å†™ï¼Œå› æ­¤è¦æ•´ä¸ªäº‹åŠ¡å®Œæˆåï¼Œå†ä¸€èµ·å†™åˆ°æ–‡ä»¶é‡Œã€‚è€Œ redo log å¹¶æ²¡æœ‰è¿™ä¸ªè¦æ±‚ï¼Œä¸­é—´æœ‰ç”Ÿæˆçš„æ—¥å¿—å¯ä»¥å†™åˆ° redo log buffer ä¸­ï¼Œredo log buffer ä¸­çš„å†…å®¹è¿˜èƒ½â€œæ­ä¾¿è½¦â€ï¼Œå…¶ä»–äº‹åŠ¡æäº¤çš„æ—¶å€™å¯ä»¥è¢«ä¸€èµ·å†™åˆ°ç£ç›˜ä¸­ã€‚</p><h2 id="15-äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œè¿˜æœªæäº¤ï¼Œå¦‚æœå‘ç”Ÿ-crashï¼Œredo-log-ä¸¢å¤±ï¼Œä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´å‘¢ï¼Ÿ">15.äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œè¿˜æœªæäº¤ï¼Œå¦‚æœå‘ç”Ÿ crashï¼Œredo log ä¸¢å¤±ï¼Œä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´å‘¢ï¼Ÿ</h2><p>ä¸ä¼šï¼Œå› ä¸ºè¿™æ—¶å€™ binlog ä¹Ÿè¿˜åœ¨ binlog cache é‡Œï¼Œæ²¡å‘ç»™å¤‡åº“ï¼Œcrash ä»¥å redo log å’Œ binlog éƒ½æ²¡æœ‰äº†ï¼Œä»ä¸šåŠ¡è§’åº¦çœ‹è¿™ä¸ªäº‹åŠ¡ä¹Ÿæ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚</p><h2 id="16-åœ¨-MySQL-ä¸­ç”¨ä»€ä¹ˆæœºåˆ¶æ¥ä¼˜åŒ–éšæœºè¯»-å†™ç£ç›˜å¯¹-IO-çš„æ¶ˆè€—ï¼Ÿ">16.åœ¨ MySQL ä¸­ç”¨ä»€ä¹ˆæœºåˆ¶æ¥ä¼˜åŒ–éšæœºè¯»/å†™ç£ç›˜å¯¹ IO çš„æ¶ˆè€—ï¼Ÿ</h2><p>redo log æ˜¯<strong>ç”¨æ¥èŠ‚çœéšæœºå†™ç£ç›˜çš„ IO æ¶ˆè€—</strong>ï¼Œè€Œ <strong>change buffer ä¸»è¦æ˜¯èŠ‚çœéšæœºè¯»ç£ç›˜çš„ IO</strong> æ¶ˆè€—ã€‚redo log ä¼šæŠŠ MySQL çš„æ›´æ–°æ“ä½œå…ˆè®°å½•åˆ°å†…å­˜ä¸­ï¼Œä¹‹åå†ç»Ÿä¸€æ›´æ–°åˆ°ç£ç›˜ï¼Œè€Œ change buffer ä¹Ÿæ˜¯æŠŠå…³é”®æŸ¥è¯¢æ•°æ®å…ˆåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»¥ä¾¿ä¼˜åŒ– MySQL çš„æŸ¥è¯¢ã€‚</p><p>A.redo log æ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„ï¼Œå®ƒçš„å›ºå®šå¤§å°çš„</p><p>B.redo log æ—¥å¿—æ˜¯ä¸å…¨çš„ï¼Œåªæœ‰æœ€æ–°çš„ä¸€äº›æ—¥å¿—ï¼Œè¿™å’Œå®ƒçš„å†…å­˜å¤§å°æœ‰å…³</p><p>C.redo log å¯ä»¥ä¿è¯æ•°æ®åº“å¼‚å¸¸é‡å¯ä¹‹åï¼Œæ•°æ®ä¸ä¸¢å¤±</p><p>D binlog æ˜¯ MySQL è‡ªå¸¦çš„æ—¥å¿—ï¼Œä½†å®ƒå¹¶ä¸èƒ½ä¿è¯æ•°æ®åº“å¼‚å¸¸é‡å¯ä¹‹åæ•°æ®ä¸ä¸¢å¤±ã€‚</p><p>E.binlog æ—¥å¿—æ˜¯è¿½åŠ å†™çš„ï¼Œåé¢çš„æ—¥å¿—å¹¶ä¸ä¼šè¦†ç›–å‰é¢çš„æ—¥å¿—ï¼Œredo log æ—¥å¿—æ˜¯å›ºå®šå¤§å°çš„ï¼Œåé¢çš„æ—¥å¿—ä¼šè¦†ç›–å‰é¢çš„æ—¥å¿—ã€‚</p><h2 id="17-æœ‰æ²¡æœ‰åŠæ³•æŠŠ-MySQL-çš„æ•°æ®æ¢å¤åˆ°è¿‡å»æŸä¸ªæŒ‡å®šçš„æ—¶é—´èŠ‚ç‚¹ï¼Ÿæ€ä¹ˆæ¢å¤ï¼Ÿ">17.æœ‰æ²¡æœ‰åŠæ³•æŠŠ MySQL çš„æ•°æ®æ¢å¤åˆ°è¿‡å»æŸä¸ªæŒ‡å®šçš„æ—¶é—´èŠ‚ç‚¹ï¼Ÿæ€ä¹ˆæ¢å¤ï¼Ÿ</h2><p>å¯ä»¥æ¢å¤ï¼Œåªè¦ä½ <strong>å¤‡ä»½äº†è¿™æ®µæ—¶é—´çš„æ‰€æœ‰ binlog</strong>ï¼ŒåŒæ—¶åšäº†<strong>å…¨é‡æ•°æ®åº“çš„å®šæœŸå¤‡ä»½</strong>ï¼Œæ¯”å¦‚ï¼Œä¸€å¤©ä¸€å¤‡ï¼Œæˆ–è€…ä¸‰å¤©ä¸€å¤‡ï¼Œè¿™å–å†³äºä½ ä»¬çš„å¤‡ä»½ç­–ç•¥ï¼Œè¿™ä¸ªæ—¶å€™ä½ å°±å¯ä»¥æŠŠä¹‹å‰å¤‡ä»½çš„æ•°æ®åº“å…ˆè¿˜åŸåˆ°æµ‹è¯•åº“ï¼Œä»å¤‡ä»½çš„æ—¶é—´ç‚¹å¼€å§‹ï¼Œå°†å¤‡ä»½çš„ binlog ä¾æ¬¡å–å‡ºæ¥ï¼Œé‡æ”¾åˆ°ä½ è¦æ¢å¤æ•°æ®çš„é‚£ä¸ªæ—¶åˆ»ï¼Œè¿™ä¸ªæ—¶å€™å°±å®Œæˆäº†æ•°æ®åˆ°æŒ‡å®šèŠ‚ç‚¹çš„æ¢å¤ã€‚æ¯”å¦‚ï¼Œä»Šå¤©æ—©ä¸Š 9 ç‚¹çš„æ—¶å€™ï¼Œä½ æƒ³æŠŠæ•°æ®æ¢å¤æˆä»Šå¤©æ—©ä¸Š 6:00:00 çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™ä½ å¯ä»¥å…ˆå–å‡ºä»Šå¤©å‡Œæ™¨ï¼ˆ00:01:59ï¼‰å¤‡ä»½çš„æ•°æ®åº“æ–‡ä»¶ï¼Œè¿˜åŸåˆ°æµ‹è¯•åº“ï¼Œå†ä» binlog æ–‡ä»¶ä¸­ä¾æ¬¡å–å‡º 00:01:59 ä¹‹åçš„æ“ä½œä¿¡æ¯ï¼Œé‡æ”¾åˆ° 6:00:00 è¿™ä¸ªæ—¶åˆ»ï¼Œè¿™å°±å®Œæˆäº†æ•°æ®åº“çš„è¿˜åŸã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysql MVCC</title>
    <link href="/dajiangdahe/2021/10/22/MysqlMVCC/"/>
    <url>/dajiangdahe/2021/10/22/MysqlMVCC/</url>
    
    <content type="html"><![CDATA[<h1>Mysql MVCC</h1><h2 id="ã€æ•°æ®åº“äº‹åŠ¡ã€‘">ã€æ•°æ®åº“äº‹åŠ¡ã€‘</h2><h3 id="ã€æ¦‚å¿µã€‘">ã€æ¦‚å¿µã€‘</h3><p>äº‹åŠ¡æ˜¯åº”ç”¨ç¨‹åºä¸­ä¸€ç³»åˆ—ä¸¥å¯†çš„æ“ä½œï¼Œæ‰€æœ‰æ“ä½œå¿…é¡»æˆåŠŸå®Œæˆï¼Œå¦åˆ™åœ¨æ¯ä¸ªæ“ä½œä¸­æ‰€ä½œçš„æ‰€æœ‰æ›´æ”¹éƒ½ä¼šè¢«æ’¤æ¶ˆã€‚ä¹Ÿå°±æ˜¯äº‹åŠ¡å…·æœ‰åŸå­æ€§ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸€ç³»åˆ—çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½ä¸åšã€‚</p><h3 id="ã€ç‰¹æ€§ã€‘">ã€ç‰¹æ€§ã€‘</h3><ul><li><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong></li></ul><p>åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡åŒ…å«çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šï¼Œè¿™å’Œå‰é¢ä¸¤ç¯‡åšå®¢ä»‹ç»äº‹åŠ¡çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„æ¦‚å¿µï¼Œå› æ­¤äº‹åŠ¡çš„æ“ä½œå¦‚æœæˆåŠŸå°±å¿…é¡»è¦å®Œå…¨åº”ç”¨åˆ°æ•°æ®åº“ï¼Œå¦‚æœæ“ä½œå¤±è´¥åˆ™ä¸èƒ½å¯¹æ•°æ®åº“æœ‰ä»»ä½•å½±å“ã€‚</p><ul><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong></li></ul><p>ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡å¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åéƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚</p><p>æ‹¿è½¬è´¦æ¥è¯´ï¼Œå‡è®¾ç”¨æˆ·Aå’Œç”¨æˆ·Bä¸¤è€…çš„é’±åŠ èµ·æ¥ä¸€å…±æ˜¯5000ï¼Œé‚£ä¹ˆä¸ç®¡Aå’ŒBä¹‹é—´å¦‚ä½•è½¬è´¦ï¼Œè½¬å‡ æ¬¡è´¦ï¼Œäº‹åŠ¡ç»“æŸåä¸¤ä¸ªç”¨æˆ·çš„é’±ç›¸åŠ èµ·æ¥åº”è¯¥è¿˜å¾—æ˜¯5000ï¼Œè¿™å°±æ˜¯äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚</p><ul><li><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong></li></ul><p>éš”ç¦»æ€§æ˜¯å½“å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œæ¯”å¦‚æ“ä½œåŒä¸€å¼ è¡¨æ—¶ï¼Œæ•°æ®åº“ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·å¼€å¯çš„äº‹åŠ¡ï¼Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡çš„æ“ä½œæ‰€å¹²æ‰°ï¼Œå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´è¦ç›¸äº’éš”ç¦»ã€‚</p><p>å³è¦è¾¾åˆ°è¿™ä¹ˆä¸€ç§æ•ˆæœï¼šå¯¹äºä»»æ„ä¸¤ä¸ªå¹¶å‘çš„äº‹åŠ¡T1å’ŒT2ï¼Œåœ¨äº‹åŠ¡T1çœ‹æ¥ï¼ŒT2è¦ä¹ˆåœ¨T1å¼€å§‹ä¹‹å‰å°±å·²ç»ç»“æŸï¼Œè¦ä¹ˆåœ¨T1ç»“æŸä¹‹åæ‰å¼€å§‹ï¼Œè¿™æ ·æ¯ä¸ªäº‹åŠ¡éƒ½æ„Ÿè§‰ä¸åˆ°æœ‰å…¶ä»–äº‹åŠ¡åœ¨å¹¶å‘åœ°æ‰§è¡Œã€‚</p><p>å…³äºäº‹åŠ¡çš„éš”ç¦»æ€§æ•°æ®åº“æä¾›äº†å¤šç§éš”ç¦»çº§åˆ«ï¼Œç¨åä¼šä»‹ç»åˆ°ã€‚</p><ul><li><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong></li></ul><p>æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤äº†ï¼Œé‚£ä¹ˆå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä¾¿æ˜¯åœ¨æ•°æ®åº“ç³»ç»Ÿé‡åˆ°æ•…éšœçš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šä¸¢å¤±æäº¤äº‹åŠ¡çš„æ“ä½œã€‚</p><p>â€‹ä¾‹å¦‚æˆ‘ä»¬åœ¨ä½¿ç”¨JDBCæ“ä½œæ•°æ®åº“æ—¶ï¼Œåœ¨æäº¤äº‹åŠ¡æ–¹æ³•åï¼Œæç¤ºç”¨æˆ·äº‹åŠ¡æ“ä½œå®Œæˆï¼Œå½“æˆ‘ä»¬ç¨‹åºæ‰§è¡Œå®Œæˆç›´åˆ°çœ‹åˆ°æç¤ºåï¼Œå°±å¯ä»¥è®¤å®šäº‹åŠ¡ä»¥åŠæ­£ç¡®æäº¤ï¼Œå³ä½¿è¿™æ—¶å€™æ•°æ®åº“å‡ºç°äº†é—®é¢˜ï¼Œä¹Ÿå¿…é¡»è¦å°†æˆ‘ä»¬çš„äº‹åŠ¡å®Œå…¨æ‰§è¡Œå®Œæˆï¼Œå¦åˆ™å°±ä¼šé€ æˆæˆ‘ä»¬çœ‹åˆ°æç¤ºäº‹åŠ¡å¤„ç†å®Œæ¯•ï¼Œä½†æ˜¯æ•°æ®åº“å› ä¸ºæ•…éšœè€Œæ²¡æœ‰æ‰§è¡Œäº‹åŠ¡çš„é‡å¤§é”™è¯¯ã€‚</p><h3 id="ã€å¹¶å‘äº§ç”Ÿçš„é—®é¢˜ã€‘">ã€å¹¶å‘äº§ç”Ÿçš„é—®é¢˜ã€‘</h3><ul><li><strong>ä¸¢å¤±ä¿®æ”¹</strong></li></ul><p>å½“ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡é€‰æ‹©åŒè¡Œï¼Œç„¶ååŸºäºæœ€åˆé€‰å®šçš„å€¼æ›´æ–°è¯¥è¡Œæ—¶ï¼Œç”±äºæ¯ä¸ªäº‹åŠ¡éƒ½ä¸çŸ¥é“å…¶ä»–äº‹åŠ¡çš„å­˜åœ¨ï¼Œå°±ä¼šå‘ç”Ÿä¸¢å¤±æ›´æ–°é—®é¢˜ä¸€ä¸€æœ€åçš„æ›´æ–°è¦†ç›–äº†ç”±å…¶ä»–äº‹åŠ¡æ‰€åšçš„æ›´æ–°ã€‚  ä¾‹å¦‚ï¼Œä¸¤ä¸ªç¨‹åºå‘˜ä¿®æ”¹åŒä¸€javaæ–‡ä»¶ã€‚æ¯ç¨‹åºå‘˜ç‹¬ç«‹åœ°æ›´æ”¹å…¶å‰¯æœ¬ï¼Œç„¶åä¿å­˜æ›´æ”¹åçš„å‰¯æœ¬ï¼Œè¿™æ ·å°±è¦†ç›–äº†åŸå§‹æ–‡æ¡£ã€‚æœ€åä¿å­˜å…¶æ›´æ”¹å‰¯æœ¬çš„ç¼–è¾‘äººå‘˜è¦†ç›–å‰ä¸€ä¸ªç¨‹åºå‘˜æ‰€åšçš„æ›´æ”¹ã€‚</p><ul><li><strong>è„è¯»</strong></li></ul><p>è„è¯»æ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å¤„ç†è¿‡ç¨‹é‡Œè¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡ä¸­çš„æ•°æ®ã€‚å½“ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨å¤šæ¬¡ä¿®æ”¹æŸä¸ªæ•°æ®ï¼Œè€Œåœ¨è¿™ä¸ªäº‹åŠ¡ä¸­è¿™å¤šæ¬¡çš„ä¿®æ”¹éƒ½è¿˜æœªæäº¤ï¼Œè¿™æ—¶ä¸€ä¸ªå¹¶å‘çš„äº‹åŠ¡æ¥è®¿é—®è¯¥æ•°æ®ï¼Œå°±ä¼šé€ æˆä¸¤ä¸ªäº‹åŠ¡å¾—åˆ°çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/MysqlMVCC/aHR0cHM6Ly9tbWJpei5xcGljLmNuL3N6X21tYml6X3BuZy9LUlJ4dnFHY2ljWkZxZzc4MjI5eWppYlBuOE9iczN2U040Vlo3TEtYanpsM3E1WE9wSWtxUUFLcGFwUDhoY0pLVlhHM21LbWtsMEk0WG9pYVM3eVRrdndWdy82NDA" class="" title="img"><ul><li><strong>ä¸å¯é‡å¤è¯»</strong></li></ul><p>ä¸å¯é‡å¤è¯»æ˜¯æŒ‡åœ¨å¯¹äºæ•°æ®åº“ä¸­çš„æŸä¸ªæ•°æ®ï¼Œä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…å¤šæ¬¡æŸ¥è¯¢å´è¿”å›äº†ä¸åŒçš„æ•°æ®å€¼ï¼Œè¿™æ˜¯ç”±äºåœ¨æŸ¥è¯¢é—´éš”ï¼Œè¢«å¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹å¹¶æäº¤äº†ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/MysqlMVCC/aHR0cHM6Ly9tbWJpei5xcGljLmNuL3N6X21tYml6X3BuZy9LUlJ4dnFHY2ljWkZxZzc4MjI5eWppYlBuOE9iczN2U040cWdRWWFrM043c29CRFZ3eVdKRHJpYU1ycVB2bE9zSXdURlpnVldxM1lNcUlTbUYxTkREWDVqZy82NDA" class="" title="img"><ul><li><strong>è™šè¯»(å¹»è¯»)</strong></li></ul><p>ä¸€ä¸ªäº‹åŠ¡æŒ‰ç›¸åŒçš„æŸ¥è¯¢æ¡ä»¶é‡æ–°è¯»å–ä»¥å‰æ£€ç´¢è¿‡çš„æ•°æ®ï¼Œå´å‘ç°å…¶ä»–äº‹åŠ¡æ’å…¥äº†æ»¡è¶³å…¶æŸ¥è¯¢æ¡ä»¶çš„æ–°æ•°æ®ï¼Œè¿™ç§ç°è±¡å°±ç§°ä¸ºâ€œå¹»è¯»â€ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/MysqlMVCC/aHR0cHM6Ly9tbWJpei5xcGljLmNuL3N6X21tYml6X3BuZy9LUlJ4dnFHY2ljWkZxZzc4MjI5eWppYlBuOE9iczN2U040WG1BSWpwRTRIVlpZaE5hTHZLNUNIeGNLWW4yaWJwZW9oVUxFbnE5ZThFSkNpYlZ0aWJZaGFzcW9nLzY0MA" class="" title="img"><h3 id="ã€éš”ç¦»çº§åˆ«ã€‘">ã€éš”ç¦»çº§åˆ«ã€‘</h3><p>â‘  Serializable (ä¸²è¡ŒåŒ–)ï¼šå¯é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»çš„å‘ç”Ÿã€‚</p><p>â‘¡ Repeatable read (å¯é‡å¤è¯»)ï¼šå¯é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»çš„å‘ç”Ÿã€‚</p><p>â‘¢ Read committed (è¯»å·²æäº¤)ï¼šå¯é¿å…è„è¯»çš„å‘ç”Ÿã€‚</p><p>â‘£ Read uncommitted (è¯»æœªæäº¤)ï¼šæœ€ä½çº§åˆ«ï¼Œä»»ä½•æƒ…å†µéƒ½æ— æ³•ä¿è¯ã€‚</p><table><thead><tr><th><strong>éš”ç¦»çº§åˆ«</strong></th><th><strong>è¯»æ•°æ®ä¸€è‡´æ€§</strong></th><th><strong>è„è¯»</strong></th><th><strong>ä¸å¯é‡å¤è¯»</strong></th><th><strong>å¹»è¯»</strong></th></tr></thead><tbody><tr><td>è¯»æœªæäº¤ï¼ˆread-uncommittedï¼‰</td><td>æœ€ä½çº§åˆ«ï¼Œåªèƒ½ä¿è¯ä¸è¯»å–ç‰©ç†ä¸ŠæŸåçš„æ•°æ®</td><td>æœ‰</td><td>æœ‰</td><td>æœ‰</td></tr><tr><td>è¯»å·²æäº¤ï¼ˆread-committedï¼‰</td><td>è¯­å¥çº§</td><td>å¦</td><td>æœ‰</td><td>æœ‰</td></tr><tr><td>å¯é‡å¤è¯»ï¼ˆrepeatable-readï¼‰</td><td>äº‹åŠ¡çº§</td><td>å¦</td><td>å¦</td><td>æœ‰</td></tr><tr><td>ä¸²è¡ŒåŒ–ï¼ˆserializableï¼‰</td><td>æœ€é«˜çº§åˆ«ï¼Œäº‹åŠ¡çº§</td><td>å¦</td><td>å¦</td><td>å¦</td></tr></tbody></table><p>åœ¨<strong>MySQL</strong>æ•°æ®åº“ä¸­ï¼Œæ”¯æŒä¸Šé¢å››ç§éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤çš„ä¸º<strong>Repeatable read (å¯é‡å¤è¯»)</strong>ï¼›è€Œåœ¨<strong>Oracle</strong>æ•°æ®åº“ä¸­ï¼Œåªæ”¯æŒSerializable (ä¸²è¡ŒåŒ–)çº§åˆ«å’ŒRead committed (è¯»å·²æäº¤)è¿™ä¸¤ç§çº§åˆ«ï¼Œå…¶ä¸­é»˜è®¤çš„ä¸º<strong>Read committed</strong>çº§åˆ«ã€‚</p><h2 id="ã€MVCCã€‘">ã€MVCCã€‘</h2><h3 id="ã€æ¦‚å¿µã€‘-2">ã€æ¦‚å¿µã€‘</h3><p>å¤šç‰ˆæœ¬æ§åˆ¶: æŒ‡çš„æ˜¯ä¸€ç§æé«˜å¹¶å‘çš„æŠ€æœ¯ã€‚æœ€æ—©çš„æ•°æ®åº“ç³»ç»Ÿï¼Œåªæœ‰è¯»è¯»ä¹‹é—´å¯ä»¥å¹¶å‘ï¼Œè¯»å†™ï¼Œå†™è¯»ï¼Œå†™å†™éƒ½è¦é˜»å¡ã€‚å¼•å…¥å¤šç‰ˆæœ¬ä¹‹åï¼Œ<strong>åªæœ‰å†™å†™ä¹‹é—´ç›¸äº’é˜»å¡ï¼Œå…¶ä»–ä¸‰ç§æ“ä½œéƒ½å¯ä»¥å¹¶è¡Œ</strong>ï¼Œè¿™æ ·å¤§å¹…åº¦æé«˜äº†InnoDBçš„å¹¶å‘åº¦ã€‚åœ¨å†…éƒ¨å®ç°ä¸­ï¼Œä¸Postgresåœ¨æ•°æ®è¡Œä¸Šå®ç°å¤šç‰ˆæœ¬ä¸åŒï¼Œ<strong>InnoDBæ˜¯åœ¨undologä¸­å®ç°çš„ï¼Œé€šè¿‡undologå¯ä»¥æ‰¾å›æ•°æ®çš„å†å²ç‰ˆæœ¬</strong>ã€‚æ‰¾å›çš„æ•°æ®å†å²ç‰ˆæœ¬å¯ä»¥æä¾›ç»™ç”¨æˆ·è¯»(æŒ‰ç…§éš”ç¦»çº§åˆ«çš„å®šä¹‰ï¼Œæœ‰äº›è¯»è¯·æ±‚åªèƒ½çœ‹åˆ°æ¯”è¾ƒè€çš„æ•°æ®ç‰ˆæœ¬)ï¼Œä¹Ÿå¯ä»¥åœ¨å›æ»šçš„æ—¶å€™è¦†ç›–æ•°æ®é¡µä¸Šçš„æ•°æ®ã€‚**åœ¨InnoDBå†…éƒ¨ä¸­ï¼Œä¼šè®°å½•ä¸€ä¸ªå…¨å±€çš„æ´»è·ƒè¯»å†™äº‹åŠ¡æ•°ç»„ï¼Œå…¶ä¸»è¦ç”¨æ¥åˆ¤æ–­äº‹åŠ¡çš„å¯è§æ€§ã€‚**MVCCæ˜¯ä¸€ç§å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æœºåˆ¶ã€‚</p><p>MVCCåœ¨MySQL InnoDBä¸­çš„å®ç°ä¸»è¦æ˜¯ä¸ºäº†æé«˜æ•°æ®åº“å¹¶å‘æ€§èƒ½ï¼Œç”¨æ›´å¥½çš„æ–¹å¼å»å¤„ç†è¯»-å†™å†²çªï¼Œåšåˆ°å³ä½¿æœ‰è¯»å†™å†²çªæ—¶ï¼Œä¹Ÿèƒ½åšåˆ°ä¸åŠ é”ï¼Œéé˜»å¡å¹¶å‘è¯»</p><h3 id="ã€å½“å‰è¯»å’Œå¿«ç…§è¯»ã€‘">ã€å½“å‰è¯»å’Œå¿«ç…§è¯»ã€‘</h3><ul><li>å½“å‰è¯»<br>åƒselect lock in share mode(<code>å…±äº«é”</code>), select for update ; update, insert ,delete(<code>æ’ä»–é”</code>)è¿™äº›æ“ä½œéƒ½æ˜¯ä¸€ç§å½“å‰è¯»ï¼Œä¸ºä»€ä¹ˆå«å½“å‰è¯»ï¼Ÿå°±æ˜¯å®ƒè¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¯»å–æ—¶è¿˜è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œä¼šå¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ é”ã€‚</li><li>å¿«ç…§è¯»<br>åƒ<code>ä¸åŠ é”</code>çš„selectæ“ä½œå°±æ˜¯å¿«ç…§è¯»ï¼Œå³ä¸åŠ é”çš„éé˜»å¡è¯»ï¼›å¿«ç…§è¯»çš„å‰ææ˜¯éš”ç¦»çº§åˆ«ä¸æ˜¯ä¸²è¡Œçº§åˆ«ï¼Œä¸²è¡Œçº§åˆ«ä¸‹çš„å¿«ç…§è¯»ä¼šé€€åŒ–æˆå½“å‰è¯»ï¼›ä¹‹æ‰€ä»¥å‡ºç°å¿«ç…§è¯»çš„æƒ…å†µï¼Œæ˜¯åŸºäºæé«˜å¹¶å‘æ€§èƒ½çš„è€ƒè™‘ï¼Œå¿«ç…§è¯»çš„å®ç°æ˜¯åŸºäºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œå³MVCC,å¯ä»¥è®¤ä¸ºMVCCæ˜¯è¡Œé”çš„ä¸€ä¸ªå˜ç§ï¼Œä½†å®ƒåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œé¿å…äº†åŠ é”æ“ä½œï¼Œé™ä½äº†å¼€é”€ï¼›æ—¢ç„¶æ˜¯åŸºäºå¤šç‰ˆæœ¬ï¼Œå³å¿«ç…§è¯»å¯èƒ½è¯»åˆ°çš„å¹¶ä¸ä¸€å®šæ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œæœ‰å¯èƒ½æ˜¯ä¹‹å‰çš„å†å²ç‰ˆæœ¬</li></ul><p>MVCCå°±æ˜¯ä¸ºäº†å®ç°è¯»-å†™å†²çªä¸åŠ é”ï¼Œè€Œè¿™ä¸ª<strong>è¯»æŒ‡çš„å°±æ˜¯<code>å¿«ç…§è¯»</code>, è€Œéå½“å‰è¯»</strong>ï¼Œå½“å‰è¯»å®é™…ä¸Šæ˜¯ä¸€ç§åŠ é”çš„æ“ä½œï¼Œæ˜¯æ‚²è§‚é”çš„å®ç°</p><h3 id="ã€å½“å‰è¯»å’Œå¿«ç…§è¯»çš„å…³ç³»ã€‘">ã€å½“å‰è¯»å’Œå¿«ç…§è¯»çš„å…³ç³»ã€‘</h3><ul><li>å‡†ç¡®çš„è¯´ï¼ŒMVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æŒ‡çš„æ˜¯ â€œç»´æŒä¸€ä¸ªæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼Œä½¿å¾—è¯»å†™æ“ä½œæ²¡æœ‰å†²çªâ€ è¿™ä¹ˆä¸€ä¸ªæ¦‚å¿µã€‚ä»…ä»…æ˜¯ä¸€ä¸ªç†æƒ³æ¦‚å¿µ</li><li>è€Œåœ¨MySQLä¸­ï¼Œå®ç°è¿™ä¹ˆä¸€ä¸ªMVCCç†æƒ³æ¦‚å¿µï¼Œæˆ‘ä»¬å°±éœ€è¦MySQLæä¾›å…·ä½“çš„åŠŸèƒ½å»å®ç°å®ƒï¼Œè€Œå¿«ç…§è¯»å°±æ˜¯MySQLä¸ºæˆ‘ä»¬å®ç°MVCCç†æƒ³æ¨¡å‹çš„å…¶ä¸­ä¸€ä¸ªå…·ä½“éé˜»å¡è¯»åŠŸèƒ½ã€‚è€Œç›¸å¯¹è€Œè¨€ï¼Œå½“å‰è¯»å°±æ˜¯æ‚²è§‚é”çš„å…·ä½“åŠŸèƒ½å®ç°</li><li>è¦è¯´çš„å†ç»†è‡´ä¸€äº›ï¼Œå¿«ç…§è¯»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå†æ·±å…¥ç ”ç©¶ã€‚MVCCæ¨¡å‹åœ¨MySQLä¸­çš„å…·ä½“å®ç°åˆ™æ˜¯ç”± <code>3ä¸ªéšå¼å­—æ®µ</code>ï¼Œ<code>undoæ—¥å¿—</code> ï¼Œ<code>Read View</code> ç­‰å»å®Œæˆçš„ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„MVCCå®ç°åŸç†</li></ul><h3 id="ã€å¹¶å‘åœºæ™¯ã€‘">ã€å¹¶å‘åœºæ™¯ã€‘</h3><ul><li><code>è¯»-è¯»</code>ï¼šä¸å­˜åœ¨ä»»ä½•é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦å¹¶å‘æ§åˆ¶</li><li><code>è¯»-å†™</code>ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šé€ æˆäº‹åŠ¡éš”ç¦»æ€§é—®é¢˜ï¼Œå¯èƒ½é‡åˆ°è„è¯»ï¼Œå¹»è¯»ï¼Œä¸å¯é‡å¤è¯»</li><li><code>å†™-å†™</code>ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šå­˜åœ¨æ›´æ–°ä¸¢å¤±é—®é¢˜ï¼Œæ¯”å¦‚ç¬¬ä¸€ç±»æ›´æ–°ä¸¢å¤±ï¼Œç¬¬äºŒç±»æ›´æ–°ä¸¢å¤±</li></ul><p>å¤‡æ³¨ï¼šç¬¬1ç±»ä¸¢å¤±æ›´æ–°ï¼šäº‹åŠ¡Aæ’¤é”€æ—¶ï¼ŒæŠŠå·²ç»æäº¤çš„äº‹åŠ¡Bçš„æ›´æ–°æ•°æ®è¦†ç›–äº†ï¼›ç¬¬2ç±»ä¸¢å¤±æ›´æ–°ï¼šäº‹åŠ¡Aè¦†ç›–äº‹åŠ¡Bå·²ç»æäº¤çš„æ•°æ®ï¼Œé€ æˆäº‹åŠ¡Bæ‰€åšçš„æ“ä½œä¸¢å¤±</p><p>ã€<strong>ä¼˜ç‚¹</strong>ã€‘</p><p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰æ˜¯ä¸€ç§ç”¨æ¥è§£å†³<code>è¯»-å†™å†²çª</code>çš„æ— é”å¹¶å‘æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº‹åŠ¡åˆ†é…å•å‘å¢é•¿çš„æ—¶é—´æˆ³ï¼Œä¸ºæ¯ä¸ªä¿®æ”¹ä¿å­˜ä¸€ä¸ªç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸äº‹åŠ¡æ—¶é—´æˆ³å…³è”ï¼Œè¯»æ“ä½œåªè¯»è¯¥äº‹åŠ¡å¼€å§‹å‰çš„æ•°æ®åº“çš„å¿«ç…§ã€‚ æ‰€ä»¥MVCCå¯ä»¥ä¸ºæ•°æ®åº“è§£å†³ä»¥ä¸‹é—®é¢˜</p><ul><li><p>åœ¨å¹¶å‘è¯»å†™æ•°æ®åº“æ—¶ï¼Œå¯ä»¥åšåˆ°åœ¨è¯»æ“ä½œæ—¶ä¸ç”¨é˜»å¡å†™æ“ä½œï¼Œå†™æ“ä½œä¹Ÿä¸ç”¨é˜»å¡è¯»æ“ä½œï¼Œæé«˜äº†æ•°æ®åº“å¹¶å‘è¯»å†™çš„æ€§èƒ½</p></li><li><p>åŒæ—¶è¿˜å¯ä»¥è§£å†³è„è¯»ï¼Œå¹»è¯»ï¼Œä¸å¯é‡å¤è¯»ç­‰äº‹åŠ¡éš”ç¦»é—®é¢˜ï¼Œä½†ä¸èƒ½è§£å†³æ›´æ–°ä¸¢å¤±é—®é¢˜</p></li></ul><p>ã€<strong>æ–¹æ¡ˆ</strong>ã€‘</p><ul><li><code>MVCC + æ‚²è§‚é”</code><br>MVCCè§£å†³è¯»å†™å†²çªï¼Œæ‚²è§‚é”è§£å†³å†™å†™å†²çª</li><li><code>MVCC + ä¹è§‚é”</code><br>MVCCè§£å†³è¯»å†™å†²çªï¼Œä¹è§‚é”è§£å†³å†™å†™å†²çª</li></ul><p>è¿™ç§ç»„åˆçš„æ–¹å¼å°±å¯ä»¥æœ€å¤§ç¨‹åº¦çš„æé«˜æ•°æ®åº“å¹¶å‘æ€§èƒ½ï¼Œå¹¶è§£å†³è¯»å†™å†²çªï¼Œå’Œå†™å†™å†²çªå¯¼è‡´çš„é—®é¢˜</p><h3 id="ã€å®ç°åŸç†ã€‘">ã€å®ç°åŸç†ã€‘</h3><p>MVCCçš„ç›®çš„å°±æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œåœ¨æ•°æ®åº“ä¸­çš„å®ç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³<code>è¯»å†™å†²çª</code>ï¼Œå®ƒçš„å®ç°åŸç†ä¸»è¦æ˜¯ä¾èµ–è®°å½•ä¸­çš„ <code>3ä¸ªéšå¼å­—æ®µ</code>ï¼Œ<code>undoæ—¥å¿—</code> ï¼Œ<code>Read View</code> æ¥å®ç°çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªä¸‰ä¸ªpointçš„æ¦‚å¿µ</p><h3 id="ã€éšå¼å­—æ®µã€‘">ã€<strong>éšå¼å­—æ®µ</strong>ã€‘</h3><p>æ¯è¡Œè®°å½•é™¤äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„å­—æ®µå¤–ï¼Œè¿˜æœ‰æ•°æ®åº“éšå¼å®šä¹‰çš„<code>DB_TRX_ID</code>,<code>DB_ROLL_PTR</code>,<code>DB_ROW_ID</code>ç­‰å­—æ®µ</p><ul><li><code>DB_TRX_ID</code><br>6byteï¼Œæœ€è¿‘ä¿®æ”¹(<code>ä¿®æ”¹/æ’å…¥</code>)äº‹åŠ¡IDï¼šè®°å½•åˆ›å»ºè¿™æ¡è®°å½•/æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡ID</li><li><code>DB_ROLL_PTR</code><br>7byteï¼Œå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼ˆå­˜å‚¨äºrollback segmenté‡Œï¼‰</li><li><code>DB_ROW_ID</code><br>6byteï¼Œéšå«çš„è‡ªå¢IDï¼ˆéšè—ä¸»é”®ï¼‰ï¼Œå¦‚æœæ•°æ®è¡¨æ²¡æœ‰ä¸»é”®ï¼ŒInnoDBä¼šè‡ªåŠ¨ä»¥<code>DB_ROW_ID</code>äº§ç”Ÿä¸€ä¸ªèšç°‡ç´¢å¼•</li><li>å®é™…è¿˜æœ‰ä¸€ä¸ªåˆ é™¤flagéšè—å­—æ®µ, æ—¢è®°å½•è¢«æ›´æ–°æˆ–åˆ é™¤å¹¶ä¸ä»£è¡¨çœŸçš„åˆ é™¤ï¼Œè€Œæ˜¯åˆ é™¤flagå˜äº†</li></ul><img src="/dajiangdahe.github.io/2021/10/22/MysqlMVCC/20190313213705258.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>å¦‚ä¸Šå›¾ï¼Œ<code>DB_ROW_ID</code>æ˜¯æ•°æ®åº“é»˜è®¤ä¸ºè¯¥è¡Œè®°å½•ç”Ÿæˆçš„å”¯ä¸€éšå¼ä¸»é”®ï¼Œ<strong><code>DB_TRX_ID</code>æ˜¯å½“å‰æ“ä½œè¯¥è®°å½•çš„äº‹åŠ¡ID,è€Œ<code>DB_ROLL_PTR</code>æ˜¯ä¸€ä¸ªå›æ»šæŒ‡é’ˆï¼Œç”¨äºé…åˆundoæ—¥å¿—ï¼ŒæŒ‡å‘ä¸Šä¸€ä¸ªæ—§ç‰ˆæœ¬</strong></p><h3 id="ã€undoæ—¥å¿—ã€‘">ã€<strong>undoæ—¥å¿—</strong>ã€‘</h3><p>undo logä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>insert undo log<br>ä»£è¡¨äº‹åŠ¡åœ¨<code>insert</code>æ–°è®°å½•æ—¶äº§ç”Ÿçš„<code>undo log</code>, <strong>åªåœ¨äº‹åŠ¡å›æ»šæ—¶éœ€è¦ï¼Œå¹¶ä¸”åœ¨äº‹åŠ¡æäº¤åå¯ä»¥è¢«ç«‹å³ä¸¢å¼ƒ</strong></li><li>update undo log<br>äº‹åŠ¡åœ¨è¿›è¡Œ<code>update</code>æˆ–<code>delete</code>æ—¶äº§ç”Ÿçš„<code>undo log</code>; <strong>ä¸ä»…åœ¨äº‹åŠ¡å›æ»šæ—¶éœ€è¦ï¼Œåœ¨å¿«ç…§è¯»æ—¶ä¹Ÿéœ€è¦ï¼›æ‰€ä»¥ä¸èƒ½éšä¾¿åˆ é™¤ï¼Œåªæœ‰åœ¨å¿«é€Ÿè¯»æˆ–äº‹åŠ¡å›æ»šä¸æ¶‰åŠè¯¥æ—¥å¿—æ—¶ï¼Œå¯¹åº”çš„æ—¥å¿—æ‰ä¼šè¢«<code>purge</code>çº¿ç¨‹ç»Ÿä¸€æ¸…é™¤</strong></li></ul><p>ã€<strong>purge</strong>ã€‘</p><ul><li>ä»å‰é¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼Œä¸ºäº†å®ç°InnoDBçš„MVCCæœºåˆ¶ï¼Œ<strong>æ›´æ–°æˆ–è€…åˆ é™¤æ“ä½œéƒ½åªæ˜¯è®¾ç½®ä¸€ä¸‹è€è®°å½•çš„deleted_bit</strong>ï¼Œå¹¶ä¸çœŸæ­£å°†è¿‡æ—¶çš„è®°å½•åˆ é™¤ã€‚</li><li>ä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼ŒInnoDBæœ‰ä¸“é—¨çš„purgeçº¿ç¨‹æ¥æ¸…ç†deleted_bitä¸ºtrueçš„è®°å½•ã€‚ä¸ºäº†ä¸å½±å“MVCCçš„æ­£å¸¸å·¥ä½œï¼Œpurgeçº¿ç¨‹è‡ªå·±ä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªread viewï¼ˆè¿™ä¸ªread viewç›¸å½“äºç³»ç»Ÿä¸­æœ€è€æ´»è·ƒäº‹åŠ¡çš„read viewï¼‰;å¦‚æœæŸä¸ªè®°å½•çš„deleted_bitä¸ºtrueï¼Œå¹¶ä¸”DB_TRX_IDç›¸å¯¹äºpurgeçº¿ç¨‹çš„read viewå¯è§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•ä¸€å®šæ˜¯å¯ä»¥è¢«å®‰å…¨æ¸…é™¤çš„ã€‚</li></ul><h3 id="ã€ç¤ºä¾‹ã€‘">ã€<strong>ç¤ºä¾‹</strong>ã€‘</h3><p>å¯¹MVCCæœ‰å¸®åŠ©çš„å®è´¨æ˜¯<code>update undo log</code> ï¼Œ<code>undo log</code>å®é™…ä¸Šå°±æ˜¯å­˜åœ¨<code>rollback segment</code>ä¸­æ—§è®°å½•é“¾ï¼Œå®ƒçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><strong>ä¸€ã€ æ¯”å¦‚ä¸€ä¸ªæœ‰ä¸ªäº‹åŠ¡æ’å…¥persionè¡¨æ’å…¥äº†ä¸€æ¡æ–°è®°å½•ï¼Œè®°å½•å¦‚ä¸‹ï¼Œ<code>name</code>ä¸ºJerry, <code>age</code>ä¸º24å²ï¼Œ<code>éšå¼ä¸»é”®</code>æ˜¯1ï¼Œ<code>äº‹åŠ¡ID</code>å’Œ<code>å›æ»šæŒ‡é’ˆ</code>ï¼Œæˆ‘ä»¬å‡è®¾ä¸ºNULLã€‚</strong></p><img src="/dajiangdahe.github.io/2021/10/22/MysqlMVCC/20190313213836406.png" class="" title="img"><p><strong>äºŒã€ ç°åœ¨æ¥äº†ä¸€ä¸ª<code>äº‹åŠ¡1</code>å¯¹è¯¥è®°å½•çš„<code>name</code>åšå‡ºäº†ä¿®æ”¹ï¼Œæ”¹ä¸ºTom</strong></p><ul><li>åœ¨<code>äº‹åŠ¡1</code>ä¿®æ”¹è¯¥è¡Œ(è®°å½•)æ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¼šå…ˆå¯¹è¯¥è¡ŒåŠ <code>æ’ä»–é”</code></li><li>ç„¶åæŠŠè¯¥è¡Œæ•°æ®æ‹·è´åˆ°<code>undo log</code>ä¸­ï¼Œä½œä¸ºæ—§è®°å½•ï¼Œ<strong>æ—¢åœ¨<code>undo log</code>ä¸­æœ‰å½“å‰è¡Œçš„æ‹·è´å‰¯æœ¬</strong></li><li>æ‹·è´å®Œæ¯•åï¼Œä¿®æ”¹è¯¥è¡Œ<code>name</code>ä¸ºTomï¼Œå¹¶ä¸”<strong>ä¿®æ”¹éšè—å­—æ®µçš„äº‹åŠ¡IDä¸ºå½“å‰<code>äº‹åŠ¡1</code>çš„ID</strong>, æˆ‘ä»¬é»˜è®¤ä»<code>1</code>å¼€å§‹ï¼Œä¹‹åé€’å¢ï¼Œå›æ»šæŒ‡é’ˆæŒ‡å‘æ‹·è´åˆ°<code>undo log</code>çš„å‰¯æœ¬è®°å½•ï¼Œæ—¢è¡¨ç¤ºæˆ‘çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯å®ƒ</li><li>äº‹åŠ¡æäº¤åï¼Œé‡Šæ”¾é”ã€‚</li></ul><img src="/dajiangdahe.github.io/2021/10/22/MysqlMVCC/20190313220441831.png" class="" title="img"><p><strong>ä¸‰ã€ åˆæ¥äº†ä¸ª<code>äº‹åŠ¡2</code>ä¿®æ”¹<code>personè¡¨</code>çš„åŒä¸€ä¸ªè®°å½•ï¼Œå°†<code>age</code>ä¿®æ”¹ä¸º30å²</strong></p><ul><li>åœ¨<code>äº‹åŠ¡2</code>ä¿®æ”¹è¯¥è¡Œæ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¹Ÿå…ˆä¸ºè¯¥è¡ŒåŠ é”</li><li>ç„¶åæŠŠè¯¥è¡Œæ•°æ®æ‹·è´åˆ°<code>undo log</code>ä¸­ï¼Œä½œä¸ºæ—§è®°å½•ï¼Œå‘ç°è¯¥è¡Œè®°å½•å·²ç»æœ‰<code>undo log</code>äº†ï¼Œé‚£ä¹ˆæœ€æ–°çš„æ—§æ•°æ®ä½œä¸ºé“¾è¡¨çš„è¡¨å¤´ï¼Œæ’åœ¨è¯¥è¡Œè®°å½•çš„<code>undo log</code>æœ€å‰é¢</li><li>ä¿®æ”¹è¯¥è¡Œ<code>age</code>ä¸º30å²ï¼Œå¹¶ä¸”ä¿®æ”¹éšè—å­—æ®µçš„äº‹åŠ¡IDä¸ºå½“å‰<code>äº‹åŠ¡2</code>çš„ID, é‚£å°±æ˜¯<code>2</code>ï¼Œå›æ»šæŒ‡é’ˆæŒ‡å‘åˆšåˆšæ‹·è´åˆ°<code>undo log</code>çš„å‰¯æœ¬è®°å½•</li><li>äº‹åŠ¡æäº¤ï¼Œé‡Šæ”¾é”</li></ul><img src="/dajiangdahe.github.io/2021/10/22/MysqlMVCC/20190313220528630.png" class="" title="img"><p>ä»ä¸Šé¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼Œä¸åŒäº‹åŠ¡æˆ–è€…ç›¸åŒäº‹åŠ¡çš„å¯¹åŒä¸€è®°å½•çš„ä¿®æ”¹ï¼Œä¼šå¯¼è‡´è¯¥è®°å½•çš„<code>undo log</code>æˆä¸ºä¸€æ¡è®°å½•ç‰ˆæœ¬çº¿æ€§è¡¨ï¼Œæ—¢é“¾è¡¨ï¼Œ<code>undo log</code>çš„é“¾é¦–å°±æ˜¯æœ€æ–°çš„æ—§è®°å½•ï¼Œ<strong>é“¾å°¾å°±æ˜¯æœ€æ—©çš„æ—§è®°å½•</strong>ï¼ˆå½“ç„¶å°±åƒä¹‹å‰è¯´çš„è¯¥undo logçš„èŠ‚ç‚¹å¯èƒ½æ˜¯ä¼špurgeçº¿ç¨‹æ¸…é™¤æ‰ï¼Œå‘å›¾ä¸­çš„ç¬¬ä¸€æ¡insert undo logï¼Œå…¶å®åœ¨äº‹åŠ¡æäº¤ä¹‹åå¯èƒ½å°±è¢«åˆ é™¤ä¸¢å¤±äº†ï¼Œä¸è¿‡è¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæ‰€ä»¥è¿˜æ”¾åœ¨è¿™é‡Œï¼‰</p><h3 id="Read-View-è¯»è§†å›¾">Read View(è¯»è§†å›¾)</h3><p>ä»€ä¹ˆæ˜¯Read View?</p><p>ä»€ä¹ˆæ˜¯Read Viewï¼Œè¯´ç™½äº†Read Viewå°±æ˜¯äº‹åŠ¡è¿›è¡Œ<code>å¿«ç…§è¯»</code>æ“ä½œçš„æ—¶å€™ç”Ÿäº§çš„<code>è¯»è§†å›¾</code>(Read View)ï¼Œåœ¨è¯¥äº‹åŠ¡æ‰§è¡Œçš„å¿«ç…§è¯»çš„é‚£ä¸€åˆ»ï¼Œä¼šç”Ÿæˆæ•°æ®åº“ç³»ç»Ÿå½“å‰çš„ä¸€ä¸ªå¿«ç…§ï¼Œè®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰æ´»è·ƒäº‹åŠ¡çš„ID(å½“æ¯ä¸ªäº‹åŠ¡å¼€å¯æ—¶ï¼Œéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªID, è¿™ä¸ªIDæ˜¯é€’å¢çš„ï¼Œæ‰€ä»¥æœ€æ–°çš„äº‹åŠ¡ï¼ŒIDå€¼è¶Šå¤§)</p><p>æ‰€ä»¥æˆ‘ä»¬çŸ¥é“ <code>Read View</code>ä¸»è¦æ˜¯ç”¨æ¥åšå¯è§æ€§åˆ¤æ–­çš„, å³å½“æˆ‘ä»¬æŸä¸ªäº‹åŠ¡æ‰§è¡Œå¿«ç…§è¯»çš„æ—¶å€™ï¼Œå¯¹è¯¥è®°å½•åˆ›å»ºä¸€ä¸ª<code>Read View</code>è¯»è§†å›¾ï¼ŒæŠŠå®ƒæ¯”ä½œæ¡ä»¶ç”¨æ¥åˆ¤æ–­å½“å‰äº‹åŠ¡èƒ½å¤Ÿçœ‹åˆ°å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œæ—¢å¯èƒ½æ˜¯å½“å‰æœ€æ–°çš„æ•°æ®ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯è¯¥è¡Œè®°å½•çš„<code>undo log</code>é‡Œé¢çš„æŸä¸ªç‰ˆæœ¬çš„æ•°æ®ã€‚</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">Read View`éµå¾ªä¸€ä¸ªå¯è§æ€§ç®—æ³•ï¼Œä¸»è¦æ˜¯å°†`è¦è¢«ä¿®æ”¹çš„æ•°æ®`çš„æœ€æ–°è®°å½•ä¸­çš„`DB_TRX_ID`ï¼ˆå³å½“å‰äº‹åŠ¡IDï¼‰å–å‡ºæ¥ï¼Œä¸ç³»ç»Ÿå½“å‰å…¶ä»–æ´»è·ƒäº‹åŠ¡çš„IDå»å¯¹æ¯”ï¼ˆç”±Read Viewç»´æŠ¤ï¼‰ï¼Œå¦‚æœ`DB_TRX_ID`è·ŸRead Viewçš„å±æ€§åšäº†æŸäº›æ¯”è¾ƒï¼Œä¸ç¬¦åˆå¯è§æ€§ï¼Œé‚£å°±é€šè¿‡`DB_ROLL_PTR`å›æ»šæŒ‡é’ˆå»å–å‡º`Undo Log`ä¸­çš„`DB_TRX_ID`å†æ¯”è¾ƒï¼Œå³éå†é“¾è¡¨çš„`DB_TRX_ID`ï¼ˆä»é“¾é¦–åˆ°é“¾å°¾ï¼Œå³ä»æœ€è¿‘çš„ä¸€æ¬¡ä¿®æ”¹æŸ¥èµ·ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„`DB_TRX_ID`, é‚£ä¹ˆè¿™ä¸ªDB_TRX_IDæ‰€åœ¨çš„æ—§è®°å½•å°±æ˜¯å½“å‰äº‹åŠ¡èƒ½çœ‹è§çš„æœ€æ–°`è€ç‰ˆæœ¬<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™ä¸ªåˆ¤æ–­æ¡ä»¶æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><img src="/dajiangdahe.github.io/2021/10/22/MysqlMVCC/20190314144440494.png" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><ul><li><p><code>trx_list</code>ï¼ˆåå­—æˆ‘éšä¾¿å–çš„ï¼‰<br>ä¸€ä¸ªæ•°å€¼åˆ—è¡¨ï¼Œç”¨æ¥ç»´æŠ¤Read Viewç”Ÿæˆæ—¶åˆ»ç³»ç»Ÿæ­£æ´»è·ƒçš„äº‹åŠ¡ID</p></li><li><p><code>up_limit_id</code><br>è®°å½•trx_liståˆ—è¡¨ä¸­äº‹åŠ¡IDæœ€å°çš„ID</p></li><li><p><code>low_limit_id</code><br>ReadViewç”Ÿæˆæ—¶åˆ»ç³»ç»Ÿå°šæœªåˆ†é…çš„ä¸‹ä¸€ä¸ªäº‹åŠ¡IDï¼Œä¹Ÿå°±æ˜¯<code>ç›®å‰å·²å‡ºç°è¿‡çš„äº‹åŠ¡IDçš„æœ€å¤§å€¼+1</code></p></li><li><p>é¦–å…ˆæ¯”è¾ƒ<code>DB_TRX_ID &lt; up_limit_id</code>, å¦‚æœå°äºï¼Œåˆ™å½“å‰äº‹åŠ¡èƒ½çœ‹åˆ°<code>DB_TRX_ID</code> æ‰€åœ¨çš„è®°å½•ï¼Œå¦‚æœå¤§äºç­‰äºè¿›å…¥ä¸‹ä¸€ä¸ªåˆ¤æ–­</p></li><li><p>æ¥ä¸‹æ¥åˆ¤æ–­ <code>DB_TRX_ID å¤§äºç­‰äº low_limit_id</code> , å¦‚æœå¤§äºç­‰äºåˆ™ä»£è¡¨<code>DB_TRX_ID</code> æ‰€åœ¨çš„è®°å½•åœ¨<code>Read View</code>ç”Ÿæˆåæ‰å‡ºç°çš„ï¼Œé‚£å¯¹å½“å‰äº‹åŠ¡è‚¯å®šä¸å¯è§ï¼Œå¦‚æœå°äºåˆ™è¿›å…¥ä¸‹ä¸€ä¸ªåˆ¤æ–­</p></li><li><p>åˆ¤æ–­<code>DB_TRX_ID</code> æ˜¯å¦åœ¨æ´»è·ƒäº‹åŠ¡ä¹‹ä¸­ï¼Œ<code>trx_list.contains(DB_TRX_ID)</code>ï¼Œå¦‚æœåœ¨ï¼Œåˆ™ä»£è¡¨æˆ‘<code>Read View</code>ç”Ÿæˆæ—¶åˆ»ï¼Œä½ è¿™ä¸ªäº‹åŠ¡è¿˜åœ¨æ´»è·ƒï¼Œè¿˜æ²¡æœ‰Commitï¼Œä½ ä¿®æ”¹çš„æ•°æ®ï¼Œæˆ‘å½“å‰äº‹åŠ¡ä¹Ÿæ˜¯çœ‹ä¸è§çš„ï¼›å¦‚æœä¸åœ¨ï¼Œåˆ™è¯´æ˜ï¼Œä½ è¿™ä¸ªäº‹åŠ¡åœ¨<code>Read View</code>ç”Ÿæˆä¹‹å‰å°±å·²ç»Commitäº†ï¼Œä½ ä¿®æ”¹çš„ç»“æœï¼Œæˆ‘å½“å‰äº‹åŠ¡æ˜¯èƒ½çœ‹è§çš„</p></li></ul><h4 id="æ•´ä½“æµç¨‹">æ•´ä½“æµç¨‹</h4><p>æˆ‘ä»¬åœ¨äº†è§£äº†<code>éšå¼å­—æ®µ</code>ï¼Œ<code>undo log</code>ï¼Œ ä»¥åŠ<code>Read View</code>çš„æ¦‚å¿µä¹‹åï¼Œå°±å¯ä»¥æ¥çœ‹çœ‹MVCCå®ç°çš„æ•´ä½“æµç¨‹æ˜¯æ€ä¹ˆæ ·äº†</p><p>æ•´ä½“çš„æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸‹</p><ul><li>å½“<code>äº‹åŠ¡2</code>å¯¹æŸè¡Œæ•°æ®æ‰§è¡Œäº†<code>å¿«ç…§è¯»</code>ï¼Œæ•°æ®åº“ä¸ºè¯¥è¡Œæ•°æ®ç”Ÿæˆä¸€ä¸ª<code>Read View</code>è¯»è§†å›¾ï¼Œå‡è®¾å½“å‰äº‹åŠ¡IDä¸º<code>2</code>ï¼Œæ­¤æ—¶è¿˜æœ‰<code>äº‹åŠ¡1</code>å’Œ<code>äº‹åŠ¡3</code>åœ¨æ´»è·ƒä¸­ï¼Œ<code>äº‹åŠ¡4</code>åœ¨<code>äº‹åŠ¡2</code>å¿«ç…§è¯»å‰ä¸€åˆ»æäº¤æ›´æ–°äº†ï¼Œæ‰€ä»¥Read Viewè®°å½•äº†ç³»ç»Ÿå½“å‰æ´»è·ƒäº‹åŠ¡1ï¼Œ3çš„IDï¼Œç»´æŠ¤åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸Šï¼Œå‡è®¾æˆ‘ä»¬ç§°ä¸º<code>trx_list</code></li></ul><table><thead><tr><th>äº‹åŠ¡1</th><th>äº‹åŠ¡2</th><th>äº‹åŠ¡3</th><th>äº‹åŠ¡4</th></tr></thead><tbody><tr><td>äº‹åŠ¡å¼€å§‹</td><td>äº‹åŠ¡å¼€å§‹</td><td>äº‹åŠ¡å¼€å§‹</td><td>äº‹åŠ¡å¼€å§‹</td></tr><tr><td>â€¦</td><td>â€¦</td><td>â€¦</td><td>ä¿®æ”¹ä¸”å·²æäº¤</td></tr><tr><td>è¿›è¡Œä¸­</td><td>å¿«ç…§è¯»</td><td>è¿›è¡Œä¸­</td><td></td></tr><tr><td>â€¦</td><td>â€¦</td><td>â€¦</td><td></td></tr></tbody></table><ul><li>Read Viewä¸ä»…ä»…ä¼šé€šè¿‡ä¸€ä¸ªåˆ—è¡¨<code>trx_list</code>æ¥ç»´æŠ¤<code>äº‹åŠ¡2</code>æ‰§è¡Œ<code>å¿«ç…§è¯»</code>é‚£åˆ»ç³»ç»Ÿæ­£æ´»è·ƒçš„äº‹åŠ¡IDï¼Œè¿˜ä¼šæœ‰ä¸¤ä¸ªå±æ€§<code>up_limit_id</code>ï¼ˆè®°å½•trx_liståˆ—è¡¨ä¸­äº‹åŠ¡IDæœ€å°çš„IDï¼‰ï¼Œ<code>low_limit_id</code>(è®°å½•trx_liståˆ—è¡¨ä¸­äº‹åŠ¡IDæœ€å¤§çš„IDï¼Œä¹Ÿæœ‰äººè¯´å¿«ç…§è¯»é‚£åˆ»ç³»ç»Ÿå°šæœªåˆ†é…çš„ä¸‹ä¸€ä¸ªäº‹åŠ¡IDä¹Ÿå°±æ˜¯<code>ç›®å‰å·²å‡ºç°è¿‡çš„äº‹åŠ¡IDçš„æœ€å¤§å€¼+1</code>ï¼Œæˆ‘æ›´å€¾å‘äºåè€…ã€‚æ‰€ä»¥åœ¨è¿™é‡Œä¾‹å­ä¸­<code>up_limit_id</code>å°±æ˜¯1ï¼Œ<code>low_limit_id</code>å°±æ˜¯4 + 1 = 5ï¼Œtrx_listé›†åˆçš„å€¼æ˜¯1,3ï¼Œ<code>Read View</code>å¦‚ä¸‹å›¾</li></ul><img src="/dajiangdahe.github.io/2021/10/22/MysqlMVCC/20190313224045780.png" class="" title="img"><ul><li>æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œåªæœ‰<code>äº‹åŠ¡4</code>ä¿®æ”¹è¿‡è¯¥è¡Œè®°å½•ï¼Œå¹¶åœ¨<code>äº‹åŠ¡2</code>æ‰§è¡Œ<code>å¿«ç…§è¯»</code>å‰ï¼Œå°±æäº¤äº†äº‹åŠ¡ï¼Œæ‰€ä»¥å½“å‰è¯¥è¡Œå½“å‰æ•°æ®çš„<code>undo log</code>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼›æˆ‘ä»¬çš„äº‹åŠ¡2åœ¨å¿«ç…§è¯»è¯¥è¡Œè®°å½•çš„æ—¶å€™ï¼Œå°±ä¼šæ‹¿è¯¥è¡Œè®°å½•çš„<code>DB_TRX_ID</code>å»è·Ÿ<code>up_limit_id</code>,<code>low_limit_id</code>å’Œ<code>æ´»è·ƒäº‹åŠ¡IDåˆ—è¡¨(trx_list)</code>è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­å½“å‰<code>äº‹åŠ¡2</code>èƒ½çœ‹åˆ°è¯¥è®°å½•çš„ç‰ˆæœ¬æ˜¯å“ªä¸ªã€‚</li></ul><img src="/dajiangdahe.github.io/2021/10/22/MysqlMVCC/2019031322511052.png" class="" title="img"><ul><li>æ‰€ä»¥å…ˆæ‹¿è¯¥è®°å½•<code>DB_TRX_ID</code>å­—æ®µè®°å½•çš„äº‹åŠ¡ID <code>4</code>å»è·Ÿ<code>Read View</code>çš„çš„<code>up_limit_id</code>æ¯”è¾ƒï¼Œçœ‹<code>4</code>æ˜¯å¦å°äº<code>up_limit_id</code>(1)ï¼Œæ‰€ä»¥ä¸ç¬¦åˆæ¡ä»¶ï¼Œç»§ç»­åˆ¤æ–­ <code>4</code> æ˜¯å¦å¤§äºç­‰äº <code>low_limit_id</code>(5)ï¼Œä¹Ÿä¸ç¬¦åˆæ¡ä»¶ï¼Œæœ€ååˆ¤æ–­<code>4</code>æ˜¯å¦å¤„äº<code>trx_list</code>ä¸­çš„æ´»è·ƒäº‹åŠ¡, æœ€åå‘ç°äº‹åŠ¡IDä¸º<code>4</code>çš„äº‹åŠ¡ä¸åœ¨å½“å‰æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­, ç¬¦åˆå¯è§æ€§æ¡ä»¶ï¼Œæ‰€ä»¥<code>äº‹åŠ¡4</code>ä¿®æ”¹åæäº¤çš„æœ€æ–°ç»“æœå¯¹<code>äº‹åŠ¡2</code>å¿«ç…§è¯»æ—¶æ˜¯å¯è§çš„ï¼Œæ‰€ä»¥<code>äº‹åŠ¡2</code>èƒ½è¯»åˆ°çš„æœ€æ–°æ•°æ®è®°å½•æ˜¯<code>äº‹åŠ¡4</code>æ‰€æäº¤çš„ç‰ˆæœ¬ï¼Œè€Œäº‹åŠ¡4æäº¤çš„ç‰ˆæœ¬ä¹Ÿæ˜¯å…¨å±€è§’åº¦ä¸Šæœ€æ–°çš„ç‰ˆæœ¬</li></ul><img src="/dajiangdahe.github.io/2021/10/22/MysqlMVCC/20190314141320189.jpg" class="" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><ul><li>ä¹Ÿæ­£æ˜¯Read Viewç”Ÿæˆæ—¶æœºçš„ä¸åŒï¼Œä»è€Œé€ æˆRC,RRçº§åˆ«ä¸‹å¿«ç…§è¯»çš„ç»“æœçš„ä¸åŒ</li></ul><h3 id="ã€ç›¸å…³é—®é¢˜ã€‘">ã€ç›¸å…³é—®é¢˜ã€‘</h3><h5 id="å½“å‰è¯»å’Œå¿«ç…§è¯»åœ¨RRçº§åˆ«ä¸‹çš„åŒºåˆ«ï¼š">å½“å‰è¯»å’Œå¿«ç…§è¯»åœ¨RRçº§åˆ«ä¸‹çš„åŒºåˆ«ï¼š</h5><table><thead><tr><th>äº‹åŠ¡A</th><th>äº‹åŠ¡B</th></tr></thead><tbody><tr><td>å¼€å¯äº‹åŠ¡</td><td>å¼€å¯äº‹åŠ¡</td></tr><tr><td>å¿«ç…§è¯»(æ— å½±å“)æŸ¥è¯¢é‡‘é¢ä¸º500</td><td>å¿«ç…§è¯»æŸ¥è¯¢é‡‘é¢ä¸º500</td></tr><tr><td>æ›´æ–°é‡‘é¢ä¸º400</td><td></td></tr><tr><td>æäº¤äº‹åŠ¡</td><td></td></tr><tr><td></td><td>select <code>å¿«ç…§è¯»</code>é‡‘é¢ä¸º500</td></tr><tr><td></td><td>select lock in share mode<code>å½“å‰è¯»</code>é‡‘é¢ä¸º400</td></tr></tbody></table><p>åœ¨ä¸Šè¡¨çš„é¡ºåºä¸‹ï¼Œäº‹åŠ¡Bçš„åœ¨äº‹åŠ¡Aæäº¤ä¿®æ”¹åçš„å¿«ç…§è¯»æ˜¯æ—§ç‰ˆæœ¬æ•°æ®ï¼Œè€Œå½“å‰è¯»æ˜¯å®æ—¶æ–°æ•°æ®400</p><table><thead><tr><th>äº‹åŠ¡A</th><th>äº‹åŠ¡B</th></tr></thead><tbody><tr><td>å¼€å¯äº‹åŠ¡</td><td>å¼€å¯äº‹åŠ¡</td></tr><tr><td>å¿«ç…§è¯»ï¼ˆæ— å½±å“ï¼‰æŸ¥è¯¢é‡‘é¢ä¸º500</td><td></td></tr><tr><td>æ›´æ–°é‡‘é¢ä¸º400</td><td></td></tr><tr><td>æäº¤äº‹åŠ¡</td><td></td></tr><tr><td></td><td>select <code>å¿«ç…§è¯»</code>é‡‘é¢ä¸º400</td></tr><tr><td></td><td>select lock in share mode<code>å½“å‰è¯»</code>é‡‘é¢ä¸º400</td></tr></tbody></table><p>è€Œåœ¨<code>è¡¨2</code>è¿™é‡Œçš„é¡ºåºä¸­ï¼Œäº‹åŠ¡Båœ¨äº‹åŠ¡Aæäº¤åçš„å¿«ç…§è¯»å’Œå½“å‰è¯»éƒ½æ˜¯å®æ—¶çš„æ–°æ•°æ®400ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>è¿™é‡Œä¸ä¸Šè¡¨çš„å”¯ä¸€åŒºåˆ«ä»…ä»…æ˜¯<code>è¡¨1</code>çš„äº‹åŠ¡Båœ¨äº‹åŠ¡Aä¿®æ”¹é‡‘é¢å‰<code>å¿«ç…§è¯»</code>è¿‡ä¸€æ¬¡é‡‘é¢æ•°æ®ï¼Œè€Œ<code>è¡¨2</code>çš„äº‹åŠ¡Båœ¨äº‹åŠ¡Aä¿®æ”¹é‡‘é¢å‰æ²¡æœ‰è¿›è¡Œè¿‡å¿«ç…§è¯»ã€‚</li></ul><p>æ‰€ä»¥æˆ‘ä»¬çŸ¥é“äº‹åŠ¡ä¸­å¿«ç…§è¯»çš„ç»“æœæ˜¯éå¸¸ä¾èµ–è¯¥äº‹åŠ¡é¦–æ¬¡å‡ºç°å¿«ç…§è¯»çš„åœ°æ–¹ï¼Œå³æŸä¸ªäº‹åŠ¡ä¸­é¦–æ¬¡å‡ºç°å¿«ç…§è¯»çš„åœ°æ–¹éå¸¸å…³é”®ï¼Œå®ƒæœ‰å†³å®šè¯¥äº‹åŠ¡åç»­å¿«ç…§è¯»ç»“æœçš„èƒ½åŠ›</p><p>æˆ‘ä»¬è¿™é‡Œæµ‹è¯•çš„æ˜¯<code>æ›´æ–°</code>ï¼ŒåŒæ—¶<code>åˆ é™¤</code>å’Œ<code>æ›´æ–°</code>ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœäº‹åŠ¡Bçš„å¿«ç…§è¯»æ˜¯åœ¨äº‹åŠ¡Aæ“ä½œä¹‹åè¿›è¡Œçš„ï¼Œäº‹åŠ¡Bçš„å¿«ç…§è¯»ä¹Ÿæ˜¯èƒ½è¯»å–åˆ°æœ€æ–°çš„æ•°æ®çš„</p><h4 id="RC-RRçº§åˆ«ä¸‹çš„InnoDBå¿«ç…§è¯»æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ">RC,RRçº§åˆ«ä¸‹çš„InnoDBå¿«ç…§è¯»æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h4><p>æ­£æ˜¯<code>Read View</code>ç”Ÿæˆæ—¶æœºçš„ä¸åŒï¼Œä»è€Œé€ æˆRC,RRçº§åˆ«ä¸‹å¿«ç…§è¯»çš„ç»“æœçš„ä¸åŒ</p><ul><li><strong>åœ¨RRçº§åˆ«ä¸‹çš„æŸä¸ªäº‹åŠ¡çš„å¯¹æŸæ¡è®°å½•çš„ç¬¬ä¸€æ¬¡å¿«ç…§è¯»ä¼šåˆ›å»ºä¸€ä¸ªå¿«ç…§åŠRead View</strong>, å°†å½“å‰ç³»ç»Ÿæ´»è·ƒçš„å…¶ä»–äº‹åŠ¡è®°å½•èµ·æ¥ï¼Œæ­¤ååœ¨<strong>è°ƒç”¨å¿«ç…§è¯»çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªRead</strong> <strong>View</strong>ï¼Œæ‰€ä»¥åªè¦å½“å‰äº‹åŠ¡åœ¨å…¶ä»–äº‹åŠ¡æäº¤æ›´æ–°ä¹‹å‰ä½¿ç”¨è¿‡å¿«ç…§è¯»ï¼Œé‚£ä¹ˆ<strong>ä¹‹åçš„å¿«ç…§è¯»ä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªRead View</strong>ï¼Œæ‰€ä»¥å¯¹ä¹‹åçš„ä¿®æ”¹ä¸å¯è§ï¼›å³RRçº§åˆ«ä¸‹ï¼Œå¿«ç…§è¯»ç”ŸæˆRead Viewæ—¶ï¼ŒRead Viewä¼šè®°å½•æ­¤æ—¶æ‰€æœ‰å…¶ä»–æ´»åŠ¨äº‹åŠ¡çš„å¿«ç…§ï¼Œè¿™äº›äº‹åŠ¡çš„ä¿®æ”¹å¯¹äºå½“å‰äº‹åŠ¡éƒ½æ˜¯ä¸å¯è§çš„ã€‚è€Œæ—©äºRead Viewåˆ›å»ºçš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å‡æ˜¯å¯è§</li><li>è€Œåœ¨<strong>RCçº§åˆ«ä¸‹çš„ï¼Œäº‹åŠ¡ä¸­ï¼Œæ¯æ¬¡å¿«ç…§è¯»éƒ½ä¼šæ–°ç”Ÿæˆä¸€ä¸ªå¿«ç…§å’ŒRead View</strong>, è¿™å°±æ˜¯æˆ‘ä»¬åœ¨RCçº§åˆ«ä¸‹çš„äº‹åŠ¡ä¸­å¯ä»¥çœ‹åˆ°åˆ«çš„äº‹åŠ¡æäº¤çš„æ›´æ–°çš„åŸå› </li></ul><p><strong>æ€»ä¹‹åœ¨RCéš”ç¦»çº§åˆ«ä¸‹ï¼Œæ˜¯æ¯ä¸ªå¿«ç…§è¯»éƒ½ä¼šç”Ÿæˆå¹¶è·å–æœ€æ–°çš„Read Viewï¼›è€Œåœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œåˆ™æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„ç¬¬ä¸€ä¸ªå¿«ç…§è¯»æ‰ä¼šåˆ›å»ºRead View, ä¹‹åçš„å¿«ç…§è¯»è·å–çš„éƒ½æ˜¯åŒä¸€ä¸ªRead Viewã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>Mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaInterview-04</title>
    <link href="/dajiangdahe/2021/10/22/JavaInterview-04/"/>
    <url>/dajiangdahe/2021/10/22/JavaInterview-04/</url>
    
    <content type="html"><![CDATA[<h3 id="åäº”ã€Kafka">åäº”ã€Kafka</h3><h4 id="152-kafka-å¯ä»¥è„±ç¦»-zookeeper-å•ç‹¬ä½¿ç”¨å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ">152.kafka å¯ä»¥è„±ç¦» zookeeper å•ç‹¬ä½¿ç”¨å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h4><p>kafka ä¸èƒ½è„±ç¦» zookeeper å•ç‹¬ä½¿ç”¨ï¼Œå› ä¸º kafka ä½¿ç”¨ zookeeper ç®¡ç†å’Œåè°ƒ kafka çš„èŠ‚ç‚¹æœåŠ¡å™¨ã€‚</p><h4 id="153-kafka-æœ‰å‡ ç§æ•°æ®ä¿ç•™çš„ç­–ç•¥ï¼Ÿ">153.kafka æœ‰å‡ ç§æ•°æ®ä¿ç•™çš„ç­–ç•¥ï¼Ÿ</h4><p>kafka æœ‰ä¸¤ç§æ•°æ®ä¿å­˜ç­–ç•¥ï¼šæŒ‰ç…§è¿‡æœŸæ—¶é—´ä¿ç•™å’ŒæŒ‰ç…§å­˜å‚¨çš„æ¶ˆæ¯å¤§å°ä¿ç•™ã€‚</p><h4 id="154-kafka-åŒæ—¶è®¾ç½®äº†-7-å¤©å’Œ-10G-æ¸…é™¤æ•°æ®ï¼Œåˆ°ç¬¬äº”å¤©çš„æ—¶å€™æ¶ˆæ¯è¾¾åˆ°äº†-10Gï¼Œè¿™ä¸ªæ—¶å€™-kafka-å°†å¦‚ä½•å¤„ç†ï¼Ÿ">154.kafka åŒæ—¶è®¾ç½®äº† 7 å¤©å’Œ 10G æ¸…é™¤æ•°æ®ï¼Œåˆ°ç¬¬äº”å¤©çš„æ—¶å€™æ¶ˆæ¯è¾¾åˆ°äº† 10Gï¼Œè¿™ä¸ªæ—¶å€™ kafka å°†å¦‚ä½•å¤„ç†ï¼Ÿ</h4><p>è¿™ä¸ªæ—¶å€™ kafka ä¼šæ‰§è¡Œæ•°æ®æ¸…é™¤å·¥ä½œï¼Œæ—¶é—´å’Œå¤§å°ä¸è®ºé‚£ä¸ªæ»¡è¶³æ¡ä»¶ï¼Œéƒ½ä¼šæ¸…ç©ºæ•°æ®ã€‚</p><h4 id="155-ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´-kafka-è¿è¡Œå˜æ…¢ï¼Ÿ">155.ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´ kafka è¿è¡Œå˜æ…¢ï¼Ÿ</h4><ul><li>cpu æ€§èƒ½ç“¶é¢ˆ</li><li>ç£ç›˜è¯»å†™ç“¶é¢ˆ</li><li>ç½‘ç»œç“¶é¢ˆ</li></ul><h4 id="156-ä½¿ç”¨-kafka-é›†ç¾¤éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ">156.ä½¿ç”¨ kafka é›†ç¾¤éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h4><ul><li>é›†ç¾¤çš„æ•°é‡ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡ 7 ä¸ªï¼Œå› ä¸ºèŠ‚ç‚¹è¶Šå¤šï¼Œæ¶ˆæ¯å¤åˆ¶éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œæ•´ä¸ªç¾¤ç»„çš„ååé‡å°±è¶Šä½ã€‚</li><li>é›†ç¾¤æ•°é‡æœ€å¥½æ˜¯å•æ•°ï¼Œå› ä¸ºè¶…è¿‡ä¸€åŠæ•…éšœé›†ç¾¤å°±ä¸èƒ½ç”¨äº†ï¼Œè®¾ç½®ä¸ºå•æ•°å®¹é”™ç‡æ›´é«˜ã€‚</li></ul><h3 id="åå…­ã€Zookeeper">åå…­ã€Zookeeper</h3><h4 id="157-zookeeper-æ˜¯ä»€ä¹ˆï¼Ÿ">157.zookeeper æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¼€æ”¾æºç çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œæ˜¯ google chubby çš„å¼€æºå®ç°ï¼Œæ˜¯ hadoop å’Œ hbase çš„é‡è¦ç»„ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚</p><h4 id="158-zookeeper-éƒ½æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ">158.zookeeper éƒ½æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ</h4><ul><li>é›†ç¾¤ç®¡ç†ï¼šç›‘æ§èŠ‚ç‚¹å­˜æ´»çŠ¶æ€ã€è¿è¡Œè¯·æ±‚ç­‰ã€‚</li><li>ä¸»èŠ‚ç‚¹é€‰ä¸¾ï¼šä¸»èŠ‚ç‚¹æŒ‚æ‰äº†ä¹‹åå¯ä»¥ä»å¤‡ç”¨çš„èŠ‚ç‚¹å¼€å§‹æ–°ä¸€è½®é€‰ä¸»ï¼Œä¸»èŠ‚ç‚¹é€‰ä¸¾è¯´çš„å°±æ˜¯è¿™ä¸ªé€‰ä¸¾çš„è¿‡ç¨‹ï¼Œä½¿ç”¨ zookeeper å¯ä»¥ååŠ©å®Œæˆè¿™ä¸ªè¿‡ç¨‹ã€‚</li><li>åˆ†å¸ƒå¼é”ï¼šzookeeper æä¾›ä¸¤ç§é”ï¼šç‹¬å é”ã€å…±äº«é”ã€‚ç‹¬å é”å³ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨èµ„æºï¼Œå…±äº«é”æ˜¯è¯»é”å…±äº«ï¼Œè¯»å†™äº’æ–¥ï¼Œå³å¯ä»¥æœ‰å¤šçº¿çº¿ç¨‹åŒæ—¶è¯»åŒä¸€ä¸ªèµ„æºï¼Œå¦‚æœè¦ä½¿ç”¨å†™é”ä¹Ÿåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚zookeeperå¯ä»¥å¯¹åˆ†å¸ƒå¼é”è¿›è¡Œæ§åˆ¶ã€‚</li><li>å‘½åæœåŠ¡ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé€šè¿‡ä½¿ç”¨å‘½åæœåŠ¡ï¼Œå®¢æˆ·ç«¯åº”ç”¨èƒ½å¤Ÿæ ¹æ®æŒ‡å®šåå­—æ¥è·å–èµ„æºæˆ–æœåŠ¡çš„åœ°å€ï¼Œæä¾›è€…ç­‰ä¿¡æ¯ã€‚</li></ul><h4 id="159-zookeeper-æœ‰å‡ ç§éƒ¨ç½²æ¨¡å¼ï¼Ÿ">159.zookeeper æœ‰å‡ ç§éƒ¨ç½²æ¨¡å¼ï¼Ÿ</h4><p>zookeeper æœ‰ä¸‰ç§éƒ¨ç½²æ¨¡å¼ï¼š</p><ul><li>å•æœºéƒ¨ç½²ï¼šä¸€å°é›†ç¾¤ä¸Šè¿è¡Œï¼›</li><li>é›†ç¾¤éƒ¨ç½²ï¼šå¤šå°é›†ç¾¤è¿è¡Œï¼›</li><li>ä¼ªé›†ç¾¤éƒ¨ç½²ï¼šä¸€å°é›†ç¾¤å¯åŠ¨å¤šä¸ª zookeeper å®ä¾‹è¿è¡Œã€‚</li></ul><h4 id="160-zookeeper-æ€ä¹ˆä¿è¯ä¸»ä»èŠ‚ç‚¹çš„çŠ¶æ€åŒæ­¥ï¼Ÿ">160.zookeeper æ€ä¹ˆä¿è¯ä¸»ä»èŠ‚ç‚¹çš„çŠ¶æ€åŒæ­¥ï¼Ÿ</h4><p>zookeeper çš„æ ¸å¿ƒæ˜¯åŸå­å¹¿æ’­ï¼Œè¿™ä¸ªæœºåˆ¶ä¿è¯äº†å„ä¸ª server ä¹‹é—´çš„åŒæ­¥ã€‚å®ç°è¿™ä¸ªæœºåˆ¶çš„åè®®å«åš zab åè®®ã€‚ zab åè®®æœ‰ä¸¤ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯æ¢å¤æ¨¡å¼ï¼ˆé€‰ä¸»ï¼‰å’Œå¹¿æ’­æ¨¡å¼ï¼ˆåŒæ­¥ï¼‰ã€‚å½“æœåŠ¡å¯åŠ¨æˆ–è€…åœ¨é¢†å¯¼è€…å´©æºƒåï¼Œzab å°±è¿›å…¥äº†æ¢å¤æ¨¡å¼ï¼Œå½“é¢†å¯¼è€…è¢«é€‰ä¸¾å‡ºæ¥ï¼Œä¸”å¤§å¤šæ•° server å®Œæˆäº†å’Œ leader çš„çŠ¶æ€åŒæ­¥ä»¥åï¼Œæ¢å¤æ¨¡å¼å°±ç»“æŸäº†ã€‚çŠ¶æ€åŒæ­¥ä¿è¯äº† leader å’Œ server å…·æœ‰ç›¸åŒçš„ç³»ç»ŸçŠ¶æ€ã€‚</p><h4 id="161-é›†ç¾¤ä¸­ä¸ºä»€ä¹ˆè¦æœ‰ä¸»èŠ‚ç‚¹ï¼Ÿ">161.é›†ç¾¤ä¸­ä¸ºä»€ä¹ˆè¦æœ‰ä¸»èŠ‚ç‚¹ï¼Ÿ</h4><p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæœ‰äº›ä¸šåŠ¡é€»è¾‘åªéœ€è¦é›†ç¾¤ä¸­çš„æŸä¸€å°æœºå™¨è¿›è¡Œæ‰§è¡Œï¼Œå…¶ä»–çš„æœºå™¨å¯ä»¥å…±äº«è¿™ä¸ªç»“æœï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘é‡å¤è®¡ç®—ï¼Œæé«˜æ€§èƒ½ï¼Œæ‰€ä»¥å°±éœ€è¦ä¸»èŠ‚ç‚¹ã€‚</p><h4 id="162-é›†ç¾¤ä¸­æœ‰-3-å°æœåŠ¡å™¨ï¼Œå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œè¿™ä¸ªæ—¶å€™-zookeeper-è¿˜å¯ä»¥ä½¿ç”¨å—ï¼Ÿ">162.é›†ç¾¤ä¸­æœ‰ 3 å°æœåŠ¡å™¨ï¼Œå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œè¿™ä¸ªæ—¶å€™ zookeeper è¿˜å¯ä»¥ä½¿ç”¨å—ï¼Ÿ</h4><p>å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œå•æ•°æœåŠ¡å™¨åªè¦æ²¡è¶…è¿‡ä¸€åŠçš„æœåŠ¡å™¨å®•æœºå°±å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚</p><h4 id="163-è¯´ä¸€ä¸‹-zookeeper-çš„é€šçŸ¥æœºåˆ¶ï¼Ÿ">163.è¯´ä¸€ä¸‹ zookeeper çš„é€šçŸ¥æœºåˆ¶ï¼Ÿ</h4><p>å®¢æˆ·ç«¯ç«¯ä¼šå¯¹æŸä¸ª znode å»ºç«‹ä¸€ä¸ª watcher äº‹ä»¶ï¼Œå½“è¯¥ znode å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™äº›å®¢æˆ·ç«¯ä¼šæ”¶åˆ° zookeeper çš„é€šçŸ¥ï¼Œç„¶åå®¢æˆ·ç«¯å¯ä»¥æ ¹æ® znode å˜åŒ–æ¥åšå‡ºä¸šåŠ¡ä¸Šçš„æ”¹å˜ã€‚</p><h3 id="åä¸ƒã€MySql">åä¸ƒã€MySql</h3><h4 id="164-æ•°æ®åº“çš„ä¸‰èŒƒå¼æ˜¯ä»€ä¹ˆï¼Ÿ">164.æ•°æ®åº“çš„ä¸‰èŒƒå¼æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>ç¬¬ä¸€èŒƒå¼ï¼šå¼ºè°ƒçš„æ˜¯åˆ—çš„åŸå­æ€§ï¼Œå³æ•°æ®åº“è¡¨çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­æ•°æ®é¡¹ã€‚</li><li>ç¬¬äºŒèŒƒå¼ï¼šè¦æ±‚å®ä½“çš„å±æ€§å®Œå…¨ä¾èµ–äºä¸»å…³é”®å­—ã€‚æ‰€è°“å®Œå…¨ä¾èµ–æ˜¯æŒ‡ä¸èƒ½å­˜åœ¨ä»…ä¾èµ–ä¸»å…³é”®å­—ä¸€éƒ¨åˆ†çš„å±æ€§ã€‚</li><li>ç¬¬ä¸‰èŒƒå¼ï¼šä»»ä½•éä¸»å±æ€§ä¸ä¾èµ–äºå…¶å®ƒéä¸»å±æ€§ã€‚</li></ul><h4 id="165-ä¸€å¼ è‡ªå¢è¡¨é‡Œé¢æ€»å…±æœ‰-7-æ¡æ•°æ®ï¼Œåˆ é™¤äº†æœ€å-2-æ¡æ•°æ®ï¼Œé‡å¯-mysql-æ•°æ®åº“ï¼Œåˆæ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œæ­¤æ—¶-id-æ˜¯å‡ ï¼Ÿ">165.ä¸€å¼ è‡ªå¢è¡¨é‡Œé¢æ€»å…±æœ‰ 7 æ¡æ•°æ®ï¼Œåˆ é™¤äº†æœ€å 2 æ¡æ•°æ®ï¼Œé‡å¯ mysql æ•°æ®åº“ï¼Œåˆæ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œæ­¤æ—¶ id æ˜¯å‡ ï¼Ÿ</h4><ul><li>è¡¨ç±»å‹å¦‚æœæ˜¯ MyISAM ï¼Œé‚£ id å°±æ˜¯ 8ã€‚</li><li>è¡¨ç±»å‹å¦‚æœæ˜¯ InnoDBï¼Œé‚£ id å°±æ˜¯ 6ã€‚</li></ul><p>InnoDB è¡¨åªä¼šæŠŠè‡ªå¢ä¸»é”®çš„æœ€å¤§ id è®°å½•åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥é‡å¯ä¹‹åä¼šå¯¼è‡´æœ€å¤§ id ä¸¢å¤±ã€‚</p><h4 id="166-å¦‚ä½•è·å–å½“å‰æ•°æ®åº“ç‰ˆæœ¬ï¼Ÿ">166.å¦‚ä½•è·å–å½“å‰æ•°æ®åº“ç‰ˆæœ¬ï¼Ÿ</h4><p>ä½¿ç”¨ select version() è·å–å½“å‰ mysql æ•°æ®åº“ç‰ˆæœ¬ã€‚</p><h4 id="167-è¯´ä¸€ä¸‹-ACID-æ˜¯ä»€ä¹ˆï¼Ÿ">167.è¯´ä¸€ä¸‹ ACID æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>Atomicityï¼ˆåŸå­æ€§ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…å…¨éƒ¨å®Œæˆï¼Œæˆ–è€…å…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«æ¢å¤ï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚å³ï¼Œäº‹åŠ¡ä¸å¯åˆ†å‰²ã€ä¸å¯çº¦ç®€ã€‚</li><li>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾çº¦æŸã€è§¦å‘å™¨ã€çº§è”å›æ»šç­‰ã€‚</li><li>Isolationï¼ˆéš”ç¦»æ€§ï¼‰ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚</li><li>Durabilityï¼ˆæŒä¹…æ€§ï¼‰ï¼šäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li></ul><h4 id="168-char-å’Œ-varchar-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">168.char å’Œ varchar çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li><strong>char(n)</strong> ï¼šå›ºå®šé•¿åº¦ç±»å‹ï¼Œæ¯”å¦‚è®¢é˜… char(10)ï¼Œå½“ä½ è¾“å…¥&quot;abc&quot;ä¸‰ä¸ªå­—ç¬¦çš„æ—¶å€™ï¼Œå®ƒä»¬å çš„ç©ºé—´è¿˜æ˜¯ 10 ä¸ªå­—èŠ‚ï¼Œå…¶ä»– 7 ä¸ªæ˜¯ç©ºå­—èŠ‚ã€‚</li></ul><p>chat ä¼˜ç‚¹ï¼šæ•ˆç‡é«˜ï¼›ç¼ºç‚¹ï¼šå ç”¨ç©ºé—´ï¼›é€‚ç”¨åœºæ™¯ï¼šå­˜å‚¨å¯†ç çš„ md5 å€¼ï¼Œå›ºå®šé•¿åº¦çš„ï¼Œä½¿ç”¨ char éå¸¸åˆé€‚ã€‚</p><ul><li><strong>varchar(n)</strong> ï¼šå¯å˜é•¿åº¦ï¼Œå­˜å‚¨çš„å€¼æ˜¯æ¯ä¸ªå€¼å ç”¨çš„å­—èŠ‚å†åŠ ä¸Šä¸€ä¸ªç”¨æ¥è®°å½•å…¶é•¿åº¦çš„å­—èŠ‚çš„é•¿åº¦ã€‚</li></ul><p>æ‰€ä»¥ï¼Œä»ç©ºé—´ä¸Šè€ƒè™‘ varcahr æ¯”è¾ƒåˆé€‚ï¼›ä»æ•ˆç‡ä¸Šè€ƒè™‘ char æ¯”è¾ƒåˆé€‚ï¼ŒäºŒè€…ä½¿ç”¨éœ€è¦æƒè¡¡ã€‚</p><h4 id="169-float-å’Œ-double-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">169.float å’Œ double çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>float æœ€å¤šå¯ä»¥å­˜å‚¨ 8 ä½çš„åè¿›åˆ¶æ•°ï¼Œå¹¶åœ¨å†…å­˜ä¸­å  4 å­—èŠ‚ã€‚</li><li>double æœ€å¯å¯ä»¥å­˜å‚¨ 16 ä½çš„åè¿›åˆ¶æ•°ï¼Œå¹¶åœ¨å†…å­˜ä¸­å  8 å­—èŠ‚ã€‚</li></ul><h4 id="170-mysql-çš„å†…è¿æ¥ã€å·¦è¿æ¥ã€å³è¿æ¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">170.mysql çš„å†…è¿æ¥ã€å·¦è¿æ¥ã€å³è¿æ¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>å†…è¿æ¥å…³é”®å­—ï¼šinner joinï¼›å·¦è¿æ¥ï¼šleft joinï¼›å³è¿æ¥ï¼šright joinã€‚</p><p>å†…è¿æ¥æ˜¯æŠŠåŒ¹é…çš„å…³è”æ•°æ®æ˜¾ç¤ºå‡ºæ¥ï¼›å·¦è¿æ¥æ˜¯å·¦è¾¹çš„è¡¨å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥ï¼Œå³è¾¹çš„è¡¨æ˜¾ç¤ºå‡ºç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼›å³è¿æ¥æ­£å¥½ç›¸åã€‚</p><h4 id="171-mysql-ç´¢å¼•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ">171.mysql ç´¢å¼•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h4><p>ç´¢å¼•æ˜¯æ»¡è¶³æŸç§ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè€Œè¿™äº›æ•°æ®ç»“æ„ä¼šä»¥æŸç§æ–¹å¼æŒ‡å‘æ•°æ®ï¼Œä»è€Œå®ç°é«˜æ•ˆæŸ¥æ‰¾æ•°æ®ã€‚</p><p>å…·ä½“æ¥è¯´ mysql ä¸­çš„ç´¢å¼•ï¼Œä¸åŒçš„æ•°æ®å¼•æ“å®ç°æœ‰æ‰€ä¸åŒï¼Œä½†ç›®å‰ä¸»æµçš„æ•°æ®åº“å¼•æ“çš„ç´¢å¼•éƒ½æ˜¯ B+ æ ‘å®ç°çš„ï¼ŒB+ æ ‘çš„æœç´¢æ•ˆç‡ï¼Œå¯ä»¥åˆ°è¾¾äºŒåˆ†æ³•çš„æ€§èƒ½ï¼Œæ‰¾åˆ°æ•°æ®åŒºåŸŸä¹‹åå°±æ‰¾åˆ°äº†å®Œæ•´çš„æ•°æ®ç»“æ„äº†ï¼Œæ‰€æœ‰ç´¢å¼•çš„æ€§èƒ½ä¹Ÿæ˜¯æ›´å¥½çš„ã€‚</p><h4 id="172-æ€ä¹ˆéªŒè¯-mysql-çš„ç´¢å¼•æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Ÿ">172.æ€ä¹ˆéªŒè¯ mysql çš„ç´¢å¼•æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Ÿ</h4><p>ä½¿ç”¨ explain æŸ¥çœ‹ sql æ˜¯å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„ï¼Œä»è€Œåˆ†æä½ çš„ç´¢å¼•æ˜¯å¦æ»¡è¶³éœ€æ±‚ã€‚</p><p>explain è¯­æ³•ï¼šexplain select * from table where type=1ã€‚</p><h4 id="173-è¯´ä¸€ä¸‹æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ">173.è¯´ä¸€ä¸‹æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ</h4><p>mysql çš„äº‹åŠ¡éš”ç¦»æ˜¯åœ¨ mysql.ini é…ç½®æ–‡ä»¶é‡Œæ·»åŠ çš„ï¼Œåœ¨æ–‡ä»¶çš„æœ€åæ·»åŠ ï¼š</p><blockquote><p>transaction-isolation = REPEATABLE-READ</p></blockquote><p>å¯ç”¨çš„é…ç½®å€¼ï¼šREAD-UNCOMMITTEDã€READ-COMMITTEDã€REPEATABLE-READã€SERIALIZABLEã€‚</p><ul><li>READ-UNCOMMITTEDï¼šæœªæäº¤è¯»ï¼Œæœ€ä½éš”ç¦»çº§åˆ«ã€äº‹åŠ¡æœªæäº¤å‰ï¼Œå°±å¯è¢«å…¶ä»–äº‹åŠ¡è¯»å–ï¼ˆä¼šå‡ºç°å¹»è¯»ã€è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰ã€‚</li><li>READ-COMMITTEDï¼šæäº¤è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡è¯»å–åˆ°ï¼ˆä¼šé€ æˆå¹»è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰ã€‚</li><li>REPEATABLE-READï¼šå¯é‡å¤è¯»ï¼Œé»˜è®¤çº§åˆ«ï¼Œä¿è¯å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œå…¶å€¼éƒ½å’Œäº‹åŠ¡å¼€å§‹æ—¶å€™çš„å†…å®¹æ˜¯ä¸€è‡´ï¼Œç¦æ­¢è¯»å–åˆ°åˆ«çš„äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼ˆä¼šé€ æˆå¹»è¯»ï¼‰ã€‚</li><li>SERIALIZABLEï¼šåºåˆ—åŒ–ï¼Œä»£ä»·æœ€é«˜æœ€å¯é çš„éš”ç¦»çº§åˆ«ï¼Œè¯¥éš”ç¦»çº§åˆ«èƒ½é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚</li></ul><p><strong>è„è¯»</strong> ï¼šè¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡èƒ½å¤Ÿè¯»å–å¦ä¸€ä¸ªäº‹åŠ¡ä¸­è¿˜æœªæäº¤çš„æ•°æ®ã€‚æ¯”å¦‚ï¼ŒæŸä¸ªäº‹åŠ¡å°è¯•æ’å…¥è®°å½• Aï¼Œæ­¤æ—¶è¯¥äº‹åŠ¡è¿˜æœªæäº¤ï¼Œç„¶åå¦ä¸€ä¸ªäº‹åŠ¡å°è¯•è¯»å–åˆ°äº†è®°å½• Aã€‚</p><p><strong>ä¸å¯é‡å¤è¯»</strong> ï¼šæ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚</p><p><strong>å¹»è¯»</strong> ï¼šæŒ‡åŒä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢è¿”å›çš„ç»“æœé›†ä¸ä¸€æ ·ã€‚æ¯”å¦‚åŒä¸€ä¸ªäº‹åŠ¡ A ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶å€™æœ‰ n æ¡è®°å½•ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡åŒç­‰æ¡ä»¶ä¸‹æŸ¥è¯¢å´æœ‰ n+1 æ¡è®°å½•ï¼Œè¿™å°±å¥½åƒäº§ç”Ÿäº†å¹»è§‰ã€‚å‘ç”Ÿå¹»è¯»çš„åŸå› ä¹Ÿæ˜¯å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ–°å¢æˆ–è€…åˆ é™¤æˆ–è€…ä¿®æ”¹äº†ç¬¬ä¸€ä¸ªäº‹åŠ¡ç»“æœé›†é‡Œé¢çš„æ•°æ®ï¼ŒåŒä¸€ä¸ªè®°å½•çš„æ•°æ®å†…å®¹è¢«ä¿®æ”¹äº†ï¼Œæ‰€æœ‰æ•°æ®è¡Œçš„è®°å½•å°±å˜å¤šæˆ–è€…å˜å°‘äº†ã€‚</p><h4 id="174-è¯´ä¸€ä¸‹-mysql-å¸¸ç”¨çš„å¼•æ“ï¼Ÿ">174.è¯´ä¸€ä¸‹ mysql å¸¸ç”¨çš„å¼•æ“ï¼Ÿ</h4><ul><li>InnoDB å¼•æ“ï¼šmysql 5.1 ä¹‹åé»˜è®¤å¼•æ“ï¼Œæä¾›äº†å¯¹æ•°æ®åº“ acid äº‹åŠ¡çš„æ”¯æŒï¼Œå¹¶ä¸”è¿˜æä¾›äº†è¡Œçº§é”å’Œå¤–é”®çš„çº¦æŸï¼Œå®ƒçš„è®¾è®¡çš„ç›®æ ‡å°±æ˜¯å¤„ç†å¤§æ•°æ®å®¹é‡çš„æ•°æ®åº“ç³»ç»Ÿã€‚mysql è¿è¡Œçš„æ—¶å€™ï¼ŒInnoDB ä¼šåœ¨å†…å­˜ä¸­å»ºç«‹ç¼“å†²æ± ï¼Œç”¨äºç¼“å†²æ•°æ®å’Œç´¢å¼•ã€‚ä½†æ˜¯è¯¥å¼•æ“æ˜¯ä¸æ”¯æŒå…¨æ–‡æœç´¢ï¼ŒåŒæ—¶å¯åŠ¨ä¹Ÿæ¯”è¾ƒçš„æ…¢ï¼Œå®ƒæ˜¯ä¸ä¼šä¿å­˜è¡¨çš„è¡Œæ•°çš„ï¼Œæ‰€ä»¥å½“è¿›è¡Œ select count(*) from table æŒ‡ä»¤çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œæ‰«æå…¨è¡¨ã€‚ç”±äºé”çš„ç²’åº¦å°ï¼Œå†™æ“ä½œæ˜¯ä¸ä¼šé”å®šå…¨è¡¨çš„,æ‰€ä»¥åœ¨å¹¶å‘åº¦è¾ƒé«˜çš„åœºæ™¯ä¸‹ä½¿ç”¨ä¼šæå‡æ•ˆç‡çš„ã€‚</li><li>MyIASM å¼•æ“ï¼šä¸æä¾›äº‹åŠ¡çš„æ”¯æŒï¼Œä¹Ÿä¸æ”¯æŒè¡Œçº§é”å’Œå¤–é”®ã€‚å› æ­¤å½“æ‰§è¡Œæ’å…¥å’Œæ›´æ–°è¯­å¥æ—¶ï¼Œå³æ‰§è¡Œå†™æ“ä½œçš„æ—¶å€™éœ€è¦é”å®šè¿™ä¸ªè¡¨ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ•ˆç‡ä¼šé™ä½ã€‚ä¸è¿‡å’Œ InnoDB ä¸åŒçš„æ˜¯ï¼ŒMyIASM å¼•æ“æ˜¯ä¿å­˜äº†è¡¨çš„è¡Œæ•°ï¼Œäºæ˜¯å½“è¿›è¡Œ select count(*) from table è¯­å¥æ—¶ï¼Œå¯ä»¥ç›´æ¥çš„è¯»å–å·²ç»ä¿å­˜çš„å€¼è€Œä¸éœ€è¦è¿›è¡Œæ‰«æå…¨è¡¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœè¡¨çš„è¯»æ“ä½œè¿œè¿œå¤šäºå†™æ“ä½œæ—¶ï¼Œå¹¶ä¸”ä¸éœ€è¦äº‹åŠ¡çš„æ”¯æŒçš„ï¼Œå¯ä»¥å°† MyIASM ä½œä¸ºæ•°æ®åº“å¼•æ“çš„é¦–é€‰ã€‚</li></ul><h4 id="175-è¯´ä¸€ä¸‹-mysql-çš„è¡Œé”å’Œè¡¨é”ï¼Ÿ">175.è¯´ä¸€ä¸‹ mysql çš„è¡Œé”å’Œè¡¨é”ï¼Ÿ</h4><p>MyISAM åªæ”¯æŒè¡¨é”ï¼ŒInnoDB æ”¯æŒè¡¨é”å’Œè¡Œé”ï¼Œé»˜è®¤ä¸ºè¡Œé”ã€‚</p><ul><li>è¡¨çº§é”ï¼šå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘é‡æœ€ä½ã€‚</li><li>è¡Œçº§é”ï¼šå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”ã€‚é”åŠ›åº¦å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡å°ï¼Œå¹¶å‘åº¦æœ€é«˜ã€‚</li></ul><h4 id="176-è¯´ä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ">176.è¯´ä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ</h4><ul><li>ä¹è§‚é”ï¼šæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æäº¤æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ã€‚</li><li>æ‚²è§‚é”ï¼šæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»æ­¢ï¼Œç›´åˆ°è¿™ä¸ªé”è¢«é‡Šæ”¾ã€‚</li></ul><p>æ•°æ®åº“çš„ä¹è§‚é”éœ€è¦è‡ªå·±å®ç°ï¼Œåœ¨è¡¨é‡Œé¢æ·»åŠ ä¸€ä¸ª version å­—æ®µï¼Œæ¯æ¬¡ä¿®æ”¹æˆåŠŸå€¼åŠ  1ï¼Œè¿™æ ·æ¯æ¬¡ä¿®æ”¹çš„æ—¶å€™å…ˆå¯¹æ¯”ä¸€ä¸‹ï¼Œè‡ªå·±æ‹¥æœ‰çš„ version å’Œæ•°æ®åº“ç°åœ¨çš„ version æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±ä¸ä¿®æ”¹ï¼Œè¿™æ ·å°±å®ç°äº†ä¹è§‚é”ã€‚</p><h4 id="177-mysql-é—®é¢˜æ’æŸ¥éƒ½æœ‰å“ªäº›æ‰‹æ®µï¼Ÿ">177.mysql é—®é¢˜æ’æŸ¥éƒ½æœ‰å“ªäº›æ‰‹æ®µï¼Ÿ</h4><ul><li>ä½¿ç”¨ show processlist å‘½ä»¤æŸ¥çœ‹å½“å‰æ‰€æœ‰è¿æ¥ä¿¡æ¯ã€‚</li><li>ä½¿ç”¨ explain å‘½ä»¤æŸ¥è¯¢ sql è¯­å¥æ‰§è¡Œè®¡åˆ’ã€‚</li><li>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ŒæŸ¥çœ‹æ…¢æŸ¥è¯¢çš„ sqlã€‚</li></ul><h4 id="178-å¦‚ä½•åš-mysql-çš„æ€§èƒ½ä¼˜åŒ–ï¼Ÿ">178.å¦‚ä½•åš mysql çš„æ€§èƒ½ä¼˜åŒ–ï¼Ÿ</h4><ul><li>ä¸ºæœç´¢å­—æ®µåˆ›å»ºç´¢å¼•ã€‚</li><li>é¿å…ä½¿ç”¨ select *ï¼Œåˆ—å‡ºéœ€è¦æŸ¥è¯¢çš„å­—æ®µã€‚</li><li>å‚ç›´åˆ†å‰²åˆ†è¡¨ã€‚</li><li>é€‰æ‹©æ­£ç¡®çš„å­˜å‚¨å¼•æ“ã€‚</li></ul><h3 id="åå…«ã€Redis">åå…«ã€Redis</h3><h4 id="179-redis-æ˜¯ä»€ä¹ˆï¼Ÿéƒ½æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ">179.redis æ˜¯ä»€ä¹ˆï¼Ÿéƒ½æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</h4><p>redis æ˜¯ä¸€ä¸ªä½¿ç”¨ C è¯­è¨€å¼€å‘çš„é«˜é€Ÿç¼“å­˜æ•°æ®åº“ã€‚</p><p>redis ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>è®°å½•å¸–å­ç‚¹èµæ•°ã€ç‚¹å‡»æ•°ã€è¯„è®ºæ•°ï¼›</li><li>ç¼“å­˜è¿‘æœŸçƒ­å¸–ï¼›</li><li>ç¼“å­˜æ–‡ç« è¯¦æƒ…ä¿¡æ¯ï¼›</li><li>è®°å½•ç”¨æˆ·ä¼šè¯ä¿¡æ¯ã€‚</li></ul><h4 id="180-redis-æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ">180.redis æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ</h4><ul><li>æ•°æ®ç¼“å­˜åŠŸèƒ½</li><li>åˆ†å¸ƒå¼é”çš„åŠŸèƒ½</li><li>æ”¯æŒæ•°æ®æŒä¹…åŒ–</li><li>æ”¯æŒäº‹åŠ¡</li><li>æ”¯æŒæ¶ˆæ¯é˜Ÿåˆ—</li></ul><h4 id="181-redis-å’Œ-memcache-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">181.redis å’Œ memcache æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>å­˜å‚¨æ–¹å¼ä¸åŒï¼šmemcache æŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ï¼Œæ–­ç”µåä¼šæŒ‚æ‰ï¼Œæ•°æ®ä¸èƒ½è¶…è¿‡å†…å­˜å¤§å°ï¼›redis æœ‰éƒ¨ä»½å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œè¿™æ ·èƒ½ä¿è¯æ•°æ®çš„æŒä¹…æ€§ã€‚</li><li>æ•°æ®æ”¯æŒç±»å‹ï¼šmemcache å¯¹æ•°æ®ç±»å‹æ”¯æŒç›¸å¯¹ç®€å•ï¼›redis æœ‰å¤æ‚çš„æ•°æ®ç±»å‹ã€‚</li><li>ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒï¼šå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ï¼Œä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ï¼Œredis è‡ªå·±æ„å»ºäº† vm æœºåˆ¶ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ã€‚</li><li>value å€¼å¤§å°ä¸åŒï¼šredis æœ€å¤§å¯ä»¥è¾¾åˆ° 512mbï¼›memcache åªæœ‰ 1mbã€‚</li></ul><h4 id="182-redis-ä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„ï¼Ÿ">182.redis ä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„ï¼Ÿ</h4><p>å› ä¸º cpu ä¸æ˜¯ redis çš„ç“¶é¢ˆï¼Œredis çš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜æˆ–è€…ç½‘ç»œå¸¦å®½ã€‚æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®ç°ï¼Œè€Œä¸” cpu  åˆä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« åœ°é‡‡ç”¨å•çº¿ç¨‹çš„æ–¹æ¡ˆäº†ã€‚</p><p>å…³äº redis çš„æ€§èƒ½ï¼Œå®˜æ–¹ç½‘ç«™ä¹Ÿæœ‰ï¼Œæ™®é€šç¬”è®°æœ¬è½»æ¾å¤„ç†æ¯ç§’å‡ åä¸‡çš„è¯·æ±‚ã€‚</p><p>è€Œä¸”å•çº¿ç¨‹å¹¶ä¸ä»£è¡¨å°±æ…¢ nginx å’Œ nodejs ä¹Ÿéƒ½æ˜¯é«˜æ€§èƒ½å•çº¿ç¨‹çš„ä»£è¡¨ã€‚</p><h4 id="183-ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ">183.ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</h4><p>ç¼“å­˜ç©¿é€ï¼šæŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶éœ€è¦ä»æ•°æ®åº“æŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°æ•°æ®åº“å»æŸ¥è¯¢ï¼Œé€ æˆç¼“å­˜ç©¿é€ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼šæœ€ç®€å•ç²—æš´çš„æ–¹æ³•å¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•°æ®ä¸å­˜åœ¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿæ•…éšœï¼‰ï¼Œæˆ‘ä»¬å°±æŠŠè¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼Œä½†å®ƒçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿã€‚</p><h4 id="184-redis-æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ">184.redis æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ</h4><p>redis æ”¯æŒçš„æ•°æ®ç±»å‹ï¼šstringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€listï¼ˆåˆ—è¡¨ï¼‰ã€hashï¼ˆå­—å…¸ï¼‰ã€setï¼ˆé›†åˆï¼‰ã€zsetï¼ˆæœ‰åºé›†åˆï¼‰ã€‚</p><h4 id="185-redis-æ”¯æŒçš„-java-å®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿ">185.redis æ”¯æŒçš„ java å®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿ</h4><p>æ”¯æŒçš„ java å®¢æˆ·ç«¯æœ‰ redissonã€jedisã€lettuce ç­‰ã€‚</p><h4 id="186-jedis-å’Œ-redisson-æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ">186.jedis å’Œ redisson æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</h4><ul><li>jedisï¼šæä¾›äº†æ¯”è¾ƒå…¨é¢çš„ redis å‘½ä»¤çš„æ”¯æŒã€‚</li><li>redissonï¼šå®ç°äº†åˆ†å¸ƒå¼å’Œå¯æ‰©å±•çš„ java æ•°æ®ç»“æ„ï¼Œä¸ jedis ç›¸æ¯” redisson çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸æ”¯æŒæ’åºã€äº‹åŠ¡ã€ç®¡é“ã€åˆ†åŒºç­‰ redis ç‰¹æ€§ã€‚</li></ul><h4 id="187-æ€ä¹ˆä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ">187.æ€ä¹ˆä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ</h4><ul><li>åˆç†è®¾ç½®ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ã€‚</li><li>æ–°å¢ã€æ›´æ”¹ã€åˆ é™¤æ•°æ®åº“æ“ä½œæ—¶åŒæ­¥æ›´æ–° redisï¼Œå¯ä»¥ä½¿ç”¨äº‹ç‰©æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li></ul><h4 id="188-redis-æŒä¹…åŒ–æœ‰å‡ ç§æ–¹å¼ï¼Ÿ">188.redis æŒä¹…åŒ–æœ‰å‡ ç§æ–¹å¼ï¼Ÿ</h4><p>redis çš„æŒä¹…åŒ–æœ‰ä¸¤ç§æ–¹å¼ï¼Œæˆ–è€…è¯´æœ‰ä¸¤ç§ç­–ç•¥ï¼š</p><ul><li>RDBï¼ˆRedis Databaseï¼‰ï¼šæŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨ã€‚</li><li>AOFï¼ˆAppend Only Fileï¼‰ï¼šæ¯ä¸€ä¸ªæ”¶åˆ°çš„å†™å‘½ä»¤éƒ½é€šè¿‡writeå‡½æ•°è¿½åŠ åˆ°æ–‡ä»¶ä¸­ã€‚</li></ul><h4 id="189-redis-æ€ä¹ˆå®ç°åˆ†å¸ƒå¼é”ï¼Ÿ">189.redis æ€ä¹ˆå®ç°åˆ†å¸ƒå¼é”ï¼Ÿ</h4><p>redis åˆ†å¸ƒå¼é”å…¶å®å°±æ˜¯åœ¨ç³»ç»Ÿé‡Œé¢å ä¸€ä¸ªâ€œå‘â€ï¼Œå…¶ä»–ç¨‹åºä¹Ÿè¦å â€œå‘â€çš„æ—¶å€™ï¼Œå ç”¨æˆåŠŸäº†å°±å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œå¤±è´¥äº†å°±åªèƒ½æ”¾å¼ƒæˆ–ç¨åé‡è¯•ã€‚</p><p>å å‘ä¸€èˆ¬ä½¿ç”¨ setnx(set if not exists)æŒ‡ä»¤ï¼Œåªå…è®¸è¢«ä¸€ä¸ªç¨‹åºå æœ‰ï¼Œä½¿ç”¨å®Œè°ƒç”¨ del é‡Šæ”¾é”ã€‚</p><h4 id="190-redis-åˆ†å¸ƒå¼é”æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ">190.redis åˆ†å¸ƒå¼é”æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ</h4><p>redis åˆ†å¸ƒå¼é”ä¸èƒ½è§£å†³è¶…æ—¶çš„é—®é¢˜ï¼Œåˆ†å¸ƒå¼é”æœ‰ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œç¨‹åºçš„æ‰§è¡Œå¦‚æœè¶…å‡ºäº†é”çš„è¶…æ—¶æ—¶é—´å°±ä¼šå‡ºç°é—®é¢˜ã€‚</p><h4 id="191-redis-å¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ">191.redis å¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ</h4><p>å°½é‡ä½¿ç”¨ redis çš„æ•£åˆ—è¡¨ï¼ŒæŠŠç›¸å…³çš„ä¿¡æ¯æ”¾åˆ°æ•£åˆ—è¡¨é‡Œé¢å­˜å‚¨ï¼Œè€Œä¸æ˜¯æŠŠæ¯ä¸ªå­—æ®µå•ç‹¬å­˜å‚¨ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„å‡å°‘å†…å­˜ä½¿ç”¨ã€‚æ¯”å¦‚å°† web ç³»ç»Ÿçš„ç”¨æˆ·å¯¹è±¡ï¼Œåº”è¯¥æ”¾åˆ°æ•£åˆ—è¡¨é‡Œé¢å†æ•´ä½“å­˜å‚¨åˆ° redisï¼Œè€Œä¸æ˜¯æŠŠç”¨æˆ·çš„å§“åã€å¹´é¾„ã€å¯†ç ã€é‚®ç®±ç­‰å­—æ®µåˆ†åˆ«è®¾ç½® key è¿›è¡Œå­˜å‚¨ã€‚</p><h4 id="192-redis-æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ">192.redis æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>volatile-lruï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚</li><li>volatile-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°ã€‚</li><li>volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚</li><li>allkeys-lruï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚</li><li>allkeys-randomï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚</li><li>no-envictionï¼ˆé©±é€ï¼‰ï¼šç¦æ­¢é©±é€æ•°æ®ã€‚</li></ul><h4 id="193-redis-å¸¸è§çš„æ€§èƒ½é—®é¢˜æœ‰å“ªäº›ï¼Ÿè¯¥å¦‚ä½•è§£å†³ï¼Ÿ">193.redis å¸¸è§çš„æ€§èƒ½é—®é¢˜æœ‰å“ªäº›ï¼Ÿè¯¥å¦‚ä½•è§£å†³ï¼Ÿ</h4><ul><li>ä¸»æœåŠ¡å™¨å†™å†…å­˜å¿«ç…§ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œå½“å¿«ç…§æ¯”è¾ƒå¤§æ—¶å¯¹æ€§èƒ½å½±å“æ˜¯éå¸¸å¤§çš„ï¼Œä¼šé—´æ–­æ€§æš‚åœæœåŠ¡ï¼Œæ‰€ä»¥ä¸»æœåŠ¡å™¨æœ€å¥½ä¸è¦å†™å†…å­˜å¿«ç…§ã€‚</li><li>redis ä¸»ä»å¤åˆ¶çš„æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼Œä¸»ä»åº“æœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€‚</li></ul><h3 id="åä¹ã€JVM">åä¹ã€JVM</h3><h4 id="194-è¯´ä¸€ä¸‹-jvm-çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼ŸåŠå…¶ä½œç”¨ï¼Ÿ">194.è¯´ä¸€ä¸‹ jvm çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼ŸåŠå…¶ä½œç”¨ï¼Ÿ</h4><ul><li>ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰</li><li>è¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime Data Areaï¼‰</li><li>æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰</li><li>æœ¬åœ°åº“æ¥å£ï¼ˆNative Interfaceï¼‰</li></ul><p><strong>ç»„ä»¶çš„ä½œç”¨ï¼š</strong> é¦–å…ˆé€šè¿‡ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ä¼šæŠŠ java ä»£ç è½¬æ¢æˆå­—èŠ‚ç ï¼Œè¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime Data Areaï¼‰å†æŠŠå­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œå­—èŠ‚ç æ–‡ä»¶åªæ˜¯ jvm çš„ä¸€å¥—æŒ‡ä»¤é›†è§„èŒƒï¼Œå¹¶ä¸èƒ½ç›´æ¥äº¤ç»™åº•å±‚æ“ä½œç³»ç»Ÿå»æ‰§è¡Œï¼Œå› æ­¤éœ€è¦ç‰¹å®šçš„å‘½ä»¤è§£æå™¨æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰ï¼Œå°†å­—èŠ‚ç ç¿»è¯‘æˆåº•å±‚ç³»ç»ŸæŒ‡ä»¤ï¼Œå†äº¤ç”± CPU å»æ‰§è¡Œï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è°ƒç”¨å…¶ä»–è¯­è¨€çš„æœ¬åœ°åº“æ¥å£ï¼ˆNative Interfaceï¼‰æ¥å®ç°æ•´ä¸ªç¨‹åºçš„åŠŸèƒ½ã€‚</p><h4 id="195-è¯´ä¸€ä¸‹-jvm-è¿è¡Œæ—¶æ•°æ®åŒºï¼Ÿ">195.è¯´ä¸€ä¸‹ jvm è¿è¡Œæ—¶æ•°æ®åŒºï¼Ÿ</h4><p>ä¸åŒè™šæ‹Ÿæœºçš„è¿è¡Œæ—¶æ•°æ®åŒºå¯èƒ½ç•¥å¾®æœ‰æ‰€ä¸åŒï¼Œä½†éƒ½ä¼šéµä» java è™šæ‹Ÿæœºè§„èŒƒï¼Œ java è™šæ‹Ÿæœºè§„èŒƒè§„å®šçš„åŒºåŸŸåˆ†ä¸ºä»¥ä¸‹ 5 ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼šå½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œå­—èŠ‚ç è§£æå™¨çš„å·¥ä½œæ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼ï¼Œæ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½ï¼Œéƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆï¼›</li><li>Java è™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰ï¼šç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ï¼›</li><li>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰ï¼šä¸è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è™šæ‹Ÿæœºæ ˆæ˜¯æœåŠ¡ java æ–¹æ³•çš„ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºè™šæ‹Ÿæœºè°ƒç”¨ Native æ–¹æ³•æœåŠ¡çš„ï¼›</li><li>Java å †ï¼ˆJava Heapï¼‰ï¼šjava è™šæ‹Ÿæœºä¸­å†…å­˜æœ€å¤§çš„ä¸€å—ï¼Œæ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ï¼›</li><li>æ–¹æ³•åŒºï¼ˆMethed Areaï¼‰ï¼šç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</li></ul><h4 id="196-è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ">196.è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ</h4><ul><li>åŠŸèƒ½æ–¹é¢ï¼šå †æ˜¯ç”¨æ¥å­˜æ”¾å¯¹è±¡çš„ï¼Œæ ˆæ˜¯ç”¨æ¥æ‰§è¡Œç¨‹åºçš„ã€‚</li><li>å…±äº«æ€§ï¼šå †æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</li><li>ç©ºé—´å¤§å°ï¼šå †å¤§å°è¿œè¿œå¤§äºæ ˆã€‚</li></ul><h4 id="197-é˜Ÿåˆ—å’Œæ ˆæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">197.é˜Ÿåˆ—å’Œæ ˆæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>é˜Ÿåˆ—å’Œæ ˆéƒ½æ˜¯è¢«ç”¨æ¥é¢„å­˜å‚¨æ•°æ®çš„ã€‚</p><p>é˜Ÿåˆ—å…è®¸å…ˆè¿›å…ˆå‡ºæ£€ç´¢å…ƒç´ ï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–çš„æƒ…å†µï¼ŒDeque æ¥å£å…è®¸ä»ä¸¤ç«¯æ£€ç´¢å…ƒç´ ã€‚</p><p>æ ˆå’Œé˜Ÿåˆ—å¾ˆç›¸ä¼¼ï¼Œä½†å®ƒè¿è¡Œå¯¹å…ƒç´ è¿›è¡Œåè¿›å…ˆå‡ºè¿›è¡Œæ£€ç´¢ã€‚</p><h4 id="198-ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ">198.ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</h4><p>åœ¨ä»‹ç»åŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰å…ˆè¯´ä¸‹ç±»åŠ è½½å™¨ã€‚å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±åŠ è½½å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®ç«‹åœ¨ jvm ä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚ç±»åŠ è½½å™¨å°±æ˜¯æ ¹æ®æŒ‡å®šå…¨é™å®šåç§°å°† class æ–‡ä»¶åŠ è½½åˆ° jvm å†…å­˜ï¼Œç„¶åå†è½¬åŒ–ä¸º class å¯¹è±¡ã€‚</p><p>ç±»åŠ è½½å™¨åˆ†ç±»ï¼š</p><ul><li>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼Œæ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥åŠ è½½JAVA_HOME/lib/ç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢« -Xbootclasspath å‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­å¹¶ä¸”è¢«è™šæ‹Ÿæœºè¯†åˆ«çš„ç±»åº“ï¼›</li><li>å…¶ä»–ç±»åŠ è½½å™¨ï¼š<ul><li>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼šè´Ÿè´£åŠ è½½&lt;JAVA_HOME&gt;\lib\extç›®å½•æˆ–java.ext.dirsç³»ç»Ÿå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ï¼›</li><li>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ã€‚è´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆclasspathï¼‰ä¸Šçš„æŒ‡å®šç±»åº“ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ã€‚ä¸€èˆ¬æƒ…å†µï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰è‡ªå®šä¹‰ç±»åŠ è½½å™¨é»˜è®¤å°±æ˜¯ç”¨è¿™ä¸ªåŠ è½½å™¨ã€‚</li></ul></li></ul><p>åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€å±‚çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œè¿™æ ·æ‰€æœ‰çš„åŠ è½½è¯·æ±‚éƒ½ä¼šè¢«ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•å»åŠ è½½ç±»ã€‚</p><h4 id="199-è¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ">199.è¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ</h4><p>ç±»è£…è½½åˆ†ä¸ºä»¥ä¸‹ 5 ä¸ªæ­¥éª¤ï¼š</p><ul><li>åŠ è½½ï¼šæ ¹æ®æŸ¥æ‰¾è·¯å¾„æ‰¾åˆ°ç›¸åº”çš„ class æ–‡ä»¶ç„¶åå¯¼å…¥ï¼›</li><li>æ£€æŸ¥ï¼šæ£€æŸ¥åŠ è½½çš„ class æ–‡ä»¶çš„æ­£ç¡®æ€§ï¼›</li><li>å‡†å¤‡ï¼šç»™ç±»ä¸­çš„é™æ€å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼›</li><li>è§£æï¼šè™šæ‹Ÿæœºå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢æˆç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ç¬¦å·å¼•ç”¨å°±ç†è§£ä¸ºä¸€ä¸ªæ ‡ç¤ºï¼Œè€Œåœ¨ç›´æ¥å¼•ç”¨ç›´æ¥æŒ‡å‘å†…å­˜ä¸­çš„åœ°å€ï¼›</li><li>åˆå§‹åŒ–ï¼šå¯¹é™æ€å˜é‡å’Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œã€‚</li></ul><h4 id="200-æ€ä¹ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ï¼Ÿ">200.æ€ä¹ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ï¼Ÿ</h4><p>ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•æ¥åˆ¤æ–­ï¼š</p><ul><li>å¼•ç”¨è®¡æ•°å™¨ï¼šä¸ºæ¯ä¸ªå¯¹è±¡åˆ›å»ºä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œæœ‰å¯¹è±¡å¼•ç”¨æ—¶è®¡æ•°å™¨ +1ï¼Œå¼•ç”¨è¢«é‡Šæ”¾æ—¶è®¡æ•° -1ï¼Œå½“è®¡æ•°å™¨ä¸º 0 æ—¶å°±å¯ä»¥è¢«å›æ”¶ã€‚å®ƒæœ‰ä¸€ä¸ªç¼ºç‚¹ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼›</li><li>å¯è¾¾æ€§åˆ†æï¼šä» GC Roots å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ã€‚å½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯å¯ä»¥è¢«å›æ”¶çš„ã€‚</li></ul><h4 id="201-java-ä¸­éƒ½æœ‰å“ªäº›å¼•ç”¨ç±»å‹ï¼Ÿ">201.java ä¸­éƒ½æœ‰å“ªäº›å¼•ç”¨ç±»å‹ï¼Ÿ</h4><ul><li>å¼ºå¼•ç”¨ï¼šå‘ç”Ÿ gc çš„æ—¶å€™ä¸ä¼šè¢«å›æ”¶ã€‚</li><li>è½¯å¼•ç”¨ï¼šæœ‰ç”¨ä½†ä¸æ˜¯å¿…é¡»çš„å¯¹è±¡ï¼Œåœ¨å‘ç”Ÿå†…å­˜æº¢å‡ºä¹‹å‰ä¼šè¢«å›æ”¶ã€‚</li><li>å¼±å¼•ç”¨ï¼šæœ‰ç”¨ä½†ä¸æ˜¯å¿…é¡»çš„å¯¹è±¡ï¼Œåœ¨ä¸‹ä¸€æ¬¡GCæ—¶ä¼šè¢«å›æ”¶ã€‚</li><li>è™šå¼•ç”¨ï¼ˆå¹½çµå¼•ç”¨/å¹»å½±å¼•ç”¨ï¼‰ï¼šæ— æ³•é€šè¿‡è™šå¼•ç”¨è·å¾—å¯¹è±¡ï¼Œç”¨ PhantomReference å®ç°è™šå¼•ç”¨ï¼Œè™šå¼•ç”¨çš„ç”¨é€”æ˜¯åœ¨ gc æ—¶è¿”å›ä¸€ä¸ªé€šçŸ¥ã€‚</li></ul><h4 id="202-è¯´ä¸€ä¸‹-jvm-æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ">202.è¯´ä¸€ä¸‹ jvm æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ</h4><ul><li>æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼šæ ‡è®°æ— ç”¨å¯¹è±¡ï¼Œç„¶åè¿›è¡Œæ¸…é™¤å›æ”¶ã€‚ç¼ºç‚¹ï¼šæ•ˆç‡ä¸é«˜ï¼Œæ— æ³•æ¸…é™¤åƒåœ¾ç¢ç‰‡ã€‚</li><li>æ ‡è®°-æ•´ç†ç®—æ³•ï¼šæ ‡è®°æ— ç”¨å¯¹è±¡ï¼Œè®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…é™¤æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</li><li>å¤åˆ¶ç®—æ³•ï¼šæŒ‰ç…§å®¹é‡åˆ’åˆ†äºŒä¸ªå¤§å°ç›¸ç­‰çš„å†…å­˜åŒºåŸŸï¼Œå½“ä¸€å—ç”¨å®Œçš„æ—¶å€™å°†æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚ç¼ºç‚¹ï¼šå†…å­˜ä½¿ç”¨ç‡ä¸é«˜ï¼Œåªæœ‰åŸæ¥çš„ä¸€åŠã€‚</li><li>åˆ†ä»£ç®—æ³•ï¼šæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬æ˜¯æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£åŸºæœ¬é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•ã€‚</li></ul><h4 id="203-è¯´ä¸€ä¸‹-jvm-æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ">203.è¯´ä¸€ä¸‹ jvm æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ</h4><ul><li>Serialï¼šæœ€æ—©çš„å•çº¿ç¨‹ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ã€‚</li><li>Serial Oldï¼šSerial åƒåœ¾å›æ”¶å™¨çš„è€å¹´ç‰ˆæœ¬ï¼ŒåŒæ ·ä¹Ÿæ˜¯å•çº¿ç¨‹çš„ï¼Œå¯ä»¥ä½œä¸º CMS åƒåœ¾å›æ”¶å™¨çš„å¤‡é€‰é¢„æ¡ˆã€‚</li><li>ParNewï¼šæ˜¯ Serial çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚</li><li>Parallel å’Œ ParNew æ”¶é›†å™¨ç±»ä¼¼æ˜¯å¤šçº¿ç¨‹çš„ï¼Œä½† Parallel æ˜¯ååé‡ä¼˜å…ˆçš„æ”¶é›†å™¨ï¼Œå¯ä»¥ç‰ºç‰²ç­‰å¾…æ—¶é—´æ¢å–ç³»ç»Ÿçš„ååé‡ã€‚</li><li>Parallel Old æ˜¯ Parallel è€ç”Ÿä»£ç‰ˆæœ¬ï¼ŒParallel ä½¿ç”¨çš„æ˜¯å¤åˆ¶çš„å†…å­˜å›æ”¶ç®—æ³•ï¼ŒParallel Old ä½¿ç”¨çš„æ˜¯æ ‡è®°-æ•´ç†çš„å†…å­˜å›æ”¶ç®—æ³•ã€‚</li><li>CMSï¼šä¸€ç§ä»¥è·å¾—æœ€çŸ­åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œéå¸¸é€‚ç”¨ B/S ç³»ç»Ÿã€‚</li><li>G1ï¼šä¸€ç§å…¼é¡¾ååé‡å’Œåœé¡¿æ—¶é—´çš„ GC å®ç°ï¼Œæ˜¯ JDK 9 ä»¥åçš„é»˜è®¤ GC é€‰é¡¹ã€‚</li></ul><h4 id="204-è¯¦ç»†ä»‹ç»ä¸€ä¸‹-CMS-åƒåœ¾å›æ”¶å™¨ï¼Ÿ">204.è¯¦ç»†ä»‹ç»ä¸€ä¸‹ CMS åƒåœ¾å›æ”¶å™¨ï¼Ÿ</h4><p>CMS æ˜¯è‹±æ–‡ Concurrent Mark-Sweep çš„ç®€ç§°ï¼Œæ˜¯ä»¥ç‰ºç‰²ååé‡ä¸ºä»£ä»·æ¥è·å¾—æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´çš„åƒåœ¾å›æ”¶å™¨ã€‚å¯¹äºè¦æ±‚æœåŠ¡å™¨å“åº”é€Ÿåº¦çš„åº”ç”¨ä¸Šï¼Œè¿™ç§åƒåœ¾å›æ”¶å™¨éå¸¸é€‚åˆã€‚åœ¨å¯åŠ¨ jvm çš„å‚æ•°åŠ ä¸Šâ€œ-XX:+UseConcMarkSweepGCâ€æ¥æŒ‡å®šä½¿ç”¨ CMS åƒåœ¾å›æ”¶å™¨ã€‚</p><p>CMS ä½¿ç”¨çš„æ˜¯æ ‡è®°-æ¸…é™¤çš„ç®—æ³•å®ç°çš„ï¼Œæ‰€ä»¥åœ¨ gc çš„æ—¶å€™å›äº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå½“å‰©ä½™å†…å­˜ä¸èƒ½æ»¡è¶³ç¨‹åºè¿è¡Œè¦æ±‚æ—¶ï¼Œç³»ç»Ÿå°†ä¼šå‡ºç° Concurrent Mode Failureï¼Œä¸´æ—¶ CMS ä¼šé‡‡ç”¨ Serial Old å›æ”¶å™¨è¿›è¡Œåƒåœ¾æ¸…é™¤ï¼Œæ­¤æ—¶çš„æ€§èƒ½å°†ä¼šè¢«é™ä½ã€‚</p><h4 id="205-æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨å’Œè€ç”Ÿä»£åƒåœ¾å›æ”¶å™¨éƒ½æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">205.æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨å’Œè€ç”Ÿä»£åƒåœ¾å›æ”¶å™¨éƒ½æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>æ–°ç”Ÿä»£å›æ”¶å™¨ï¼šSerialã€ParNewã€Parallel Scavenge</li><li>è€å¹´ä»£å›æ”¶å™¨ï¼šSerial Oldã€Parallel Oldã€CMS</li><li>æ•´å †å›æ”¶å™¨ï¼šG1</li></ul><p>æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•ï¼Œå¤åˆ¶ç®—æ³•çš„ä¼˜ç‚¹æ˜¯æ•ˆç‡é«˜ï¼Œç¼ºç‚¹æ˜¯å†…å­˜åˆ©ç”¨ç‡ä½ï¼›è€å¹´ä»£å›æ”¶å™¨ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯æ ‡è®°-æ•´ç†çš„ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p><h4 id="206-ç®€è¿°åˆ†ä»£åƒåœ¾å›æ”¶å™¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ">206.ç®€è¿°åˆ†ä»£åƒåœ¾å›æ”¶å™¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</h4><p>åˆ†ä»£å›æ”¶å™¨æœ‰ä¸¤ä¸ªåˆ†åŒºï¼šè€ç”Ÿä»£å’Œæ–°ç”Ÿä»£ï¼Œæ–°ç”Ÿä»£é»˜è®¤çš„ç©ºé—´å æ¯”æ€»ç©ºé—´çš„ 1/3ï¼Œè€ç”Ÿä»£çš„é»˜è®¤å æ¯”æ˜¯ 2/3ã€‚</p><p>æ–°ç”Ÿä»£ä½¿ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£é‡Œæœ‰ 3 ä¸ªåˆ†åŒºï¼šEdenã€To Survivorã€From Survivorï¼Œå®ƒä»¬çš„é»˜è®¤å æ¯”æ˜¯ 8:1:1ï¼Œå®ƒçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æŠŠ Eden + From Survivor å­˜æ´»çš„å¯¹è±¡æ”¾å…¥ To Survivor åŒºï¼›</li><li>æ¸…ç©º Eden å’Œ From Survivor åˆ†åŒºï¼›</li><li>From Survivor å’Œ To Survivor åˆ†åŒºäº¤æ¢ï¼ŒFrom Survivor å˜ To Survivorï¼ŒTo Survivor å˜ From Survivorã€‚</li></ul><p>æ¯æ¬¡åœ¨ From Survivor åˆ° To Survivor ç§»åŠ¨æ—¶éƒ½å­˜æ´»çš„å¯¹è±¡ï¼Œå¹´é¾„å°± +1ï¼Œå½“å¹´é¾„åˆ°è¾¾ 15ï¼ˆé»˜è®¤é…ç½®æ˜¯ 15ï¼‰æ—¶ï¼Œå‡çº§ä¸ºè€ç”Ÿä»£ã€‚å¤§å¯¹è±¡ä¹Ÿä¼šç›´æ¥è¿›å…¥è€ç”Ÿä»£ã€‚</p><p>è€ç”Ÿä»£å½“ç©ºé—´å ç”¨åˆ°è¾¾æŸä¸ªå€¼ä¹‹åå°±ä¼šè§¦å‘å…¨å±€åƒåœ¾æ”¶å›ï¼Œä¸€èˆ¬ä½¿ç”¨æ ‡è®°æ•´ç†çš„æ‰§è¡Œç®—æ³•ã€‚ä»¥ä¸Šè¿™äº›å¾ªç¯å¾€å¤å°±æ„æˆäº†æ•´ä¸ªåˆ†ä»£åƒåœ¾å›æ”¶çš„æ•´ä½“æ‰§è¡Œæµç¨‹ã€‚</p><h4 id="207-è¯´ä¸€ä¸‹-jvm-è°ƒä¼˜çš„å·¥å…·ï¼Ÿ">207.è¯´ä¸€ä¸‹ jvm è°ƒä¼˜çš„å·¥å…·ï¼Ÿ</h4><p>jdk è‡ªå¸¦äº†å¾ˆå¤šç›‘æ§å·¥å…·ï¼Œéƒ½ä½äº jdk çš„ bin ç›®å½•ä¸‹ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯ jconsole å’Œ jvisualvm è¿™ä¸¤æ¬¾è§†å›¾ç›‘æ§å·¥å…·ã€‚</p><ul><li>jconsoleï¼šç”¨äºå¯¹ jvm ä¸­çš„å†…å­˜ã€çº¿ç¨‹å’Œç±»ç­‰è¿›è¡Œç›‘æ§ï¼›</li><li>jvisualvmï¼šjdk è‡ªå¸¦çš„å…¨èƒ½åˆ†æå·¥å…·ï¼Œå¯ä»¥åˆ†æï¼šå†…å­˜å¿«ç…§ã€çº¿ç¨‹å¿«ç…§ã€ç¨‹åºæ­»é”ã€ç›‘æ§å†…å­˜çš„å˜åŒ–ã€gc å˜åŒ–ç­‰ã€‚</li></ul><h4 id="208-å¸¸ç”¨çš„-jvm-è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ">208.å¸¸ç”¨çš„ jvm è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>-Xms2gï¼šåˆå§‹åŒ–æ¨å¤§å°ä¸º 2gï¼›</li><li>-Xmx2gï¼šå †æœ€å¤§å†…å­˜ä¸º 2gï¼›</li><li>-XX:NewRatio=4ï¼šè®¾ç½®å¹´è½»çš„å’Œè€å¹´ä»£çš„å†…å­˜æ¯”ä¾‹ä¸º 1:4ï¼›</li><li>-XX:SurvivorRatio=8ï¼šè®¾ç½®æ–°ç”Ÿä»£ Eden å’Œ Survivor æ¯”ä¾‹ä¸º 8:2ï¼›</li><li>â€“XX:+UseParNewGCï¼šæŒ‡å®šä½¿ç”¨ ParNew + Serial Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›</li><li>-XX:+UseParallelOldGCï¼šæŒ‡å®šä½¿ç”¨ ParNew + ParNew Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›</li><li>-XX:+UseConcMarkSweepGCï¼šæŒ‡å®šä½¿ç”¨ CMS + Serial Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›</li><li>-XX:+PrintGCï¼šå¼€å¯æ‰“å° gc ä¿¡æ¯ï¼›</li><li>-XX:+PrintGCDetailsï¼šæ‰“å° gc è¯¦ç»†ä¿¡æ¯ã€‚</li></ul><h2 id="ç»“å°¾">ç»“å°¾</h2><p>è¿™ä¸æ­¢æ˜¯ä¸€ä»½é¢è¯•æ¸…å•ï¼Œæ›´æ˜¯ä¸€ç§â€œè¢«æœŸæœ›çš„è´£ä»»â€ï¼Œå› ä¸ºæœ‰æ— æ•°ä¸ªå¾…é¢è¯•ç€ï¼Œå¸Œæœ›ä»è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæ‰¾å‡ºé€šå¾€æœŸæœ›å…¬å¸çš„â€œé’¥åŒ™â€ï¼Œæ‰€ä»¥ä¸Šé¢çš„æ¯é“é€‰é¢˜éƒ½æ˜¯ç»“åˆæˆ‘è‡ªèº«çš„ç»éªŒï¼Œäºåƒä¸‡ä¸ªé¢è¯•é¢˜ä¸­ç»è¿‡è‰°è¾›çš„ä¸¤å‘¨ï¼Œä¸€ä¸ªé¢˜ä¸€ä¸ªé¢˜ç­›é€‰å‡ºæ¥å†æ ¡å¯¹å¥½ç­”æ¡ˆå’Œæ ¼å¼åšå‡ºæ¥çš„ï¼Œé¢è¯•çš„ç­”æ¡ˆä¹Ÿæ˜¯å†ä¸‰æ–Ÿé…Œï¼Œç”Ÿæ€•è¯¯äººå­å¼Ÿæ˜¯å°ï¼Œå½±å“ä»–äººçš„â€œä»•é€”â€æ‰æ˜¯å¤§è¿‡ï¼Œæ‰€ä»¥å¦‚æœ‰çº°æ¼ï¼Œè¿˜è¯·è¯»è€…æœ‹å‹ä»¬åœ¨è¯„è®ºåŒºä¸åæŒ‡å‡ºã€‚</p><p>ä¹Ÿå¸Œæœ›æ‚¨èƒ½æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ï¼Œè®©å®ƒå¸®åŠ©æ›´å¤šçš„äººã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JavaInterview</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaInterview-03</title>
    <link href="/dajiangdahe/2021/10/22/JavaInterview-03/"/>
    <url>/dajiangdahe/2021/10/22/JavaInterview-03/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¹ã€è®¾è®¡æ¨¡å¼">ä¹ã€è®¾è®¡æ¨¡å¼</h3><h4 id="88-è¯´ä¸€ä¸‹ä½ ç†Ÿæ‚‰çš„è®¾è®¡æ¨¡å¼ï¼Ÿ">88.è¯´ä¸€ä¸‹ä½ ç†Ÿæ‚‰çš„è®¾è®¡æ¨¡å¼ï¼Ÿ</h4><ul><li>å•ä¾‹æ¨¡å¼ï¼šä¿è¯è¢«åˆ›å»ºä¸€æ¬¡ï¼ŒèŠ‚çœç³»ç»Ÿå¼€é”€ã€‚</li><li>å·¥å‚æ¨¡å¼ï¼ˆç®€å•å·¥å‚ã€æŠ½è±¡å·¥å‚ï¼‰ï¼šè§£è€¦ä»£ç ã€‚</li><li>è§‚å¯Ÿè€…æ¨¡å¼ï¼šå®šä¹‰äº†å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šçš„ä¾èµ–ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜æ—¶ï¼Œå®ƒçš„æ‰€æœ‰çš„ä¾èµ–è€…éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚</li><li>å¤–è§‚æ¨¡å¼ï¼šæä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ï¼Œå¤–è§‚å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚çš„æ¥å£ï¼Œè®©å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚</li><li>æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼ï¼šå®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œæ¨¡ç‰ˆæ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•çš„æ­¥éª¤ã€‚</li><li>çŠ¶æ€æ¨¡å¼ï¼šå…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚</li></ul><h4 id="89-ç®€å•å·¥å‚å’ŒæŠ½è±¡å·¥å‚æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">89.ç®€å•å·¥å‚å’ŒæŠ½è±¡å·¥å‚æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>ç®€å•å·¥å‚ï¼šç”¨æ¥ç”Ÿäº§åŒä¸€ç­‰çº§ç»“æ„ä¸­çš„ä»»æ„äº§å“ï¼Œå¯¹äºå¢åŠ æ–°çš„äº§å“ï¼Œæ— èƒ½ä¸ºåŠ›ã€‚</li><li>å·¥å‚æ–¹æ³•ï¼šç”¨æ¥ç”Ÿäº§åŒä¸€ç­‰çº§ç»“æ„ä¸­çš„å›ºå®šäº§å“ï¼Œæ”¯æŒå¢åŠ ä»»æ„äº§å“ã€‚</li><li>æŠ½è±¡å·¥å‚ï¼šç”¨æ¥ç”Ÿäº§ä¸åŒäº§å“æ—çš„å…¨éƒ¨äº§å“ï¼Œå¯¹äºå¢åŠ æ–°çš„äº§å“ï¼Œæ— èƒ½ä¸ºåŠ›ï¼›æ”¯æŒå¢åŠ äº§å“æ—ã€‚</li></ul><h3 id="åã€Spring-Spring-MVC">åã€Spring/Spring MVC</h3><h4 id="90-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-springï¼Ÿ">90.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ springï¼Ÿ</h4><ul><li>spring æä¾› ioc æŠ€æœ¯ï¼Œå®¹å™¨ä¼šå¸®ä½ ç®¡ç†ä¾èµ–çš„å¯¹è±¡ï¼Œä»è€Œä¸éœ€è¦è‡ªå·±åˆ›å»ºå’Œç®¡ç†ä¾èµ–å¯¹è±¡äº†ï¼Œæ›´è½»æ¾çš„å®ç°äº†ç¨‹åºçš„è§£è€¦ã€‚</li><li>spring æä¾›äº†äº‹åŠ¡æ”¯æŒï¼Œä½¿å¾—äº‹åŠ¡æ“ä½œå˜çš„æ›´åŠ æ–¹ä¾¿ã€‚</li><li>spring æä¾›äº†é¢å‘åˆ‡ç‰‡ç¼–ç¨‹ï¼Œè¿™æ ·å¯ä»¥æ›´æ–¹ä¾¿çš„å¤„ç†æŸä¸€ç±»çš„é—®é¢˜ã€‚</li><li>æ›´æ–¹ä¾¿çš„æ¡†æ¶é›†æˆï¼Œspring å¯ä»¥å¾ˆæ–¹ä¾¿çš„é›†æˆå…¶ä»–æ¡†æ¶ï¼Œæ¯”å¦‚ mybatisã€hibernate ç­‰ã€‚</li><li>æ–¹ä¾¿ç¨‹åºçš„æµ‹è¯•ï¼Œæä¾›äº†å¯¹Junit4çš„æ”¯æŒã€‚</li></ul><h4 id="91-è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯-aopï¼Ÿ">91.è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ aopï¼Ÿ</h4><p>aop æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯ç»Ÿä¸€å¤„ç†æŸä¸€â€œåˆ‡é¢â€ï¼ˆç±»ï¼‰çš„é—®é¢˜çš„ç¼–ç¨‹æ€æƒ³ï¼Œæ¯”å¦‚ç»Ÿä¸€å¤„ç†æ—¥å¿—ã€å¼‚å¸¸ç­‰ã€‚</p><h4 id="92-è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯-iocï¼Ÿ">92.è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ iocï¼Ÿ</h4><p>iocï¼šInversionof Controlï¼ˆä¸­æ–‡ï¼šæ§åˆ¶åè½¬ï¼‰æ˜¯ spring çš„æ ¸å¿ƒï¼Œå¯¹äº spring æ¡†æ¶æ¥è¯´ï¼Œå°±æ˜¯ç”± spring æ¥è´Ÿè´£æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡é—´çš„å…³ç³»ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œæ§åˆ¶æŒ‡çš„æ˜¯å½“å‰å¯¹è±¡å¯¹å†…éƒ¨æˆå‘˜çš„æ§åˆ¶æƒï¼›æ§åˆ¶åè½¬æŒ‡çš„æ˜¯ï¼Œè¿™ç§æ§åˆ¶æƒä¸ç”±å½“å‰å¯¹è±¡ç®¡ç†äº†ï¼Œç”±å…¶ä»–ï¼ˆç±»,ç¬¬ä¸‰æ–¹å®¹å™¨ï¼‰æ¥ç®¡ç†ã€‚</p><h4 id="93-spring-æœ‰å“ªäº›ä¸»è¦æ¨¡å—ï¼Ÿ">93.spring æœ‰å“ªäº›ä¸»è¦æ¨¡å—ï¼Ÿ</h4><ul><li>spring coreï¼šæ¡†æ¶çš„æœ€åŸºç¡€éƒ¨åˆ†ï¼Œæä¾› ioc å’Œä¾èµ–æ³¨å…¥ç‰¹æ€§ã€‚</li><li>spring contextï¼šæ„å»ºäº core å°è£…åŒ…åŸºç¡€ä¸Šçš„ context å°è£…åŒ…ï¼Œæä¾›äº†ä¸€ç§æ¡†æ¶å¼çš„å¯¹è±¡è®¿é—®æ–¹æ³•ã€‚</li><li>spring daoï¼šData Access Object æä¾›äº†JDBCçš„æŠ½è±¡å±‚ã€‚</li><li>spring aopï¼šæä¾›äº†é¢å‘åˆ‡é¢çš„ç¼–ç¨‹å®ç°ï¼Œè®©ä½ å¯ä»¥è‡ªå®šä¹‰æ‹¦æˆªå™¨ã€åˆ‡ç‚¹ç­‰ã€‚</li><li>spring webï¼šæä¾›äº†é’ˆå¯¹ web å¼€å‘çš„é›†æˆç‰¹æ€§ï¼Œä¾‹å¦‚æ–‡ä»¶ä¸Šä¼ ï¼Œåˆ©ç”¨ servlet listeners è¿›è¡Œ ioc å®¹å™¨åˆå§‹åŒ–å’Œé’ˆå¯¹ web çš„ ApplicationContextã€‚</li><li>spring web mvcï¼šspring ä¸­çš„ mvc å°è£…åŒ…æä¾›äº† web åº”ç”¨çš„ Model-View-Controllerï¼ˆMVCï¼‰çš„å®ç°ã€‚</li></ul><h4 id="94-spring-å¸¸ç”¨çš„æ³¨å…¥æ–¹å¼æœ‰å“ªäº›ï¼Ÿ">94.spring å¸¸ç”¨çš„æ³¨å…¥æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>setter å±æ€§æ³¨å…¥</li><li>æ„é€ æ–¹æ³•æ³¨å…¥</li><li>æ³¨è§£æ–¹å¼æ³¨å…¥</li></ul><h4 id="95-spring-ä¸­çš„-bean-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ">95.spring ä¸­çš„ bean æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</h4><p>spring ä¸­çš„ bean é»˜è®¤æ˜¯å•ä¾‹æ¨¡å¼ï¼Œspring æ¡†æ¶å¹¶æ²¡æœ‰å¯¹å•ä¾‹ bean è¿›è¡Œå¤šçº¿ç¨‹çš„å°è£…å¤„ç†ã€‚</p><p>å®é™…ä¸Šå¤§éƒ¨åˆ†æ—¶å€™ spring bean æ— çŠ¶æ€çš„ï¼ˆæ¯”å¦‚ dao ç±»ï¼‰ï¼Œæ‰€æœ‰æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ bean ä¹Ÿæ˜¯å®‰å…¨çš„ï¼Œä½†å¦‚æœ bean æœ‰çŠ¶æ€çš„è¯ï¼ˆæ¯”å¦‚ view model å¯¹è±¡ï¼‰ï¼Œé‚£å°±è¦å¼€å‘è€…è‡ªå·±å»ä¿è¯çº¿ç¨‹å®‰å…¨äº†ï¼Œæœ€ç®€å•çš„å°±æ˜¯æ”¹å˜ bean çš„ä½œç”¨åŸŸï¼ŒæŠŠâ€œsingletonâ€å˜æ›´ä¸ºâ€œprototypeâ€ï¼Œè¿™æ ·è¯·æ±‚ bean ç›¸å½“äº new Bean()äº†ï¼Œæ‰€ä»¥å°±å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚</p><ul><li>æœ‰çŠ¶æ€å°±æ˜¯æœ‰æ•°æ®å­˜å‚¨åŠŸèƒ½ã€‚</li><li>æ— çŠ¶æ€å°±æ˜¯ä¸ä¼šä¿å­˜æ•°æ®ã€‚</li></ul><h4 id="96-spring-æ”¯æŒå‡ ç§-bean-çš„ä½œç”¨åŸŸï¼Ÿ">96.spring æ”¯æŒå‡ ç§ bean çš„ä½œç”¨åŸŸï¼Ÿ</h4><p>spring æ”¯æŒ 5 ç§ä½œç”¨åŸŸï¼Œå¦‚ä¸‹ï¼š</p><ul><li>singletonï¼šspring ioc å®¹å™¨ä¸­åªå­˜åœ¨ä¸€ä¸ª bean å®ä¾‹ï¼Œbean ä»¥å•ä¾‹æ¨¡å¼å­˜åœ¨ï¼Œæ˜¯ç³»ç»Ÿé»˜è®¤å€¼ï¼›</li><li>prototypeï¼šæ¯æ¬¡ä»å®¹å™¨è°ƒç”¨ bean æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¤ºä¾‹ï¼Œæ—¢æ¯æ¬¡ getBean()ç›¸å½“äºæ‰§è¡Œ new Bean()æ“ä½œï¼›</li><li>Web ç¯å¢ƒä¸‹çš„ä½œç”¨åŸŸï¼š<ul><li>requestï¼šæ¯æ¬¡ http è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ª beanï¼›</li><li>sessionï¼šåŒä¸€ä¸ª http session å…±äº«ä¸€ä¸ª bean å®ä¾‹ï¼›</li><li>global-sessionï¼šç”¨äº portlet å®¹å™¨ï¼Œå› ä¸ºæ¯ä¸ª portlet æœ‰å•ç‹¬çš„ sessionï¼Œglobalsession æä¾›ä¸€ä¸ªå…¨å±€æ€§çš„ http sessionã€‚</li></ul></li></ul><p><strong>æ³¨æ„ï¼š</strong> ä½¿ç”¨ prototype ä½œç”¨åŸŸéœ€è¦æ…é‡çš„æ€è€ƒï¼Œå› ä¸ºé¢‘ç¹åˆ›å»ºå’Œé”€æ¯ bean ä¼šå¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½å¼€é”€ã€‚</p><h4 id="97-spring-è‡ªåŠ¨è£…é…-bean-æœ‰å“ªäº›æ–¹å¼ï¼Ÿ">97.spring è‡ªåŠ¨è£…é… bean æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</h4><ul><li>noï¼šé»˜è®¤å€¼ï¼Œè¡¨ç¤ºæ²¡æœ‰è‡ªåŠ¨è£…é…ï¼Œåº”ä½¿ç”¨æ˜¾å¼ bean å¼•ç”¨è¿›è¡Œè£…é…ã€‚</li><li>byNameï¼šå®ƒæ ¹æ® bean çš„åç§°æ³¨å…¥å¯¹è±¡ä¾èµ–é¡¹ã€‚</li><li>byTypeï¼šå®ƒæ ¹æ®ç±»å‹æ³¨å…¥å¯¹è±¡ä¾èµ–é¡¹ã€‚</li><li>æ„é€ å‡½æ•°ï¼šé€šè¿‡æ„é€ å‡½æ•°æ¥æ³¨å…¥ä¾èµ–é¡¹ï¼Œéœ€è¦è®¾ç½®å¤§é‡çš„å‚æ•°ã€‚</li><li>autodetectï¼šå®¹å™¨é¦–å…ˆé€šè¿‡æ„é€ å‡½æ•°ä½¿ç”¨ autowire è£…é…ï¼Œå¦‚æœä¸èƒ½ï¼Œåˆ™é€šè¿‡ byType è‡ªåŠ¨è£…é…ã€‚</li></ul><h4 id="98-spring-äº‹åŠ¡å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ">98.spring äº‹åŠ¡å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>å£°æ˜å¼äº‹åŠ¡ï¼šå£°æ˜å¼äº‹åŠ¡ä¹Ÿæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼ŒåŸºäº xml é…ç½®æ–‡ä»¶çš„æ–¹å¼å’Œæ³¨è§£æ–¹å¼ï¼ˆåœ¨ç±»ä¸Šæ·»åŠ  @Transaction æ³¨è§£ï¼‰ã€‚</li><li>ç¼–ç æ–¹å¼ï¼šæä¾›ç¼–ç çš„å½¢å¼ç®¡ç†å’Œç»´æŠ¤äº‹åŠ¡ã€‚</li></ul><h4 id="99-è¯´ä¸€ä¸‹-spring-çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ">99.è¯´ä¸€ä¸‹ spring çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ</h4><p>spring æœ‰äº”å¤§éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤å€¼ä¸º ISOLATION_DEFAULTï¼ˆä½¿ç”¨æ•°æ®åº“çš„è®¾ç½®ï¼‰ï¼Œå…¶ä»–å››ä¸ªéš”ç¦»çº§åˆ«å’Œæ•°æ®åº“çš„éš”ç¦»çº§åˆ«ä¸€è‡´ï¼š</p><p>ISOLATION_DEFAULTï¼šç”¨åº•å±‚æ•°æ®åº“çš„è®¾ç½®éš”ç¦»çº§åˆ«ï¼Œæ•°æ®åº“è®¾ç½®çš„æ˜¯ä»€ä¹ˆæˆ‘å°±ç”¨ä»€ä¹ˆï¼›</p><p>ISOLATION_READ_UNCOMMITTEDï¼šæœªæäº¤è¯»ï¼Œæœ€ä½éš”ç¦»çº§åˆ«ã€äº‹åŠ¡æœªæäº¤å‰ï¼Œå°±å¯è¢«å…¶ä»–äº‹åŠ¡è¯»å–ï¼ˆä¼šå‡ºç°å¹»è¯»ã€è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰ï¼›</p><p>ISOLATION_READ_COMMITTEDï¼šæäº¤è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡è¯»å–åˆ°ï¼ˆä¼šé€ æˆå¹»è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰ï¼Œsql server çš„é»˜è®¤çº§åˆ«ï¼›</p><p>ISOLATION_REPEATABLE_READï¼šå¯é‡å¤è¯»ï¼Œä¿è¯å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œå…¶å€¼éƒ½å’Œäº‹åŠ¡å¼€å§‹æ—¶å€™çš„å†…å®¹æ˜¯ä¸€è‡´ï¼Œç¦æ­¢è¯»å–åˆ°åˆ«çš„äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼ˆä¼šé€ æˆå¹»è¯»ï¼‰ï¼Œmysql çš„é»˜è®¤çº§åˆ«ï¼›</p><p>ISOLATION_SERIALIZABLEï¼šåºåˆ—åŒ–ï¼Œä»£ä»·æœ€é«˜æœ€å¯é çš„éš”ç¦»çº§åˆ«ï¼Œè¯¥éš”ç¦»çº§åˆ«èƒ½é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚</p><p><strong>è„è¯»</strong> ï¼šè¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡èƒ½å¤Ÿè¯»å–å¦ä¸€ä¸ªäº‹åŠ¡ä¸­è¿˜æœªæäº¤çš„æ•°æ®ã€‚æ¯”å¦‚ï¼ŒæŸä¸ªäº‹åŠ¡å°è¯•æ’å…¥è®°å½• Aï¼Œæ­¤æ—¶è¯¥äº‹åŠ¡è¿˜æœªæäº¤ï¼Œç„¶åå¦ä¸€ä¸ªäº‹åŠ¡å°è¯•è¯»å–åˆ°äº†è®°å½• Aã€‚</p><p><strong>ä¸å¯é‡å¤è¯»</strong> ï¼šæ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚</p><p><strong>å¹»è¯»</strong> ï¼šæŒ‡åŒä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢è¿”å›çš„ç»“æœé›†ä¸ä¸€æ ·ã€‚æ¯”å¦‚åŒä¸€ä¸ªäº‹åŠ¡ A ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶å€™æœ‰ n æ¡è®°å½•ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡åŒç­‰æ¡ä»¶ä¸‹æŸ¥è¯¢å´æœ‰ n+1 æ¡è®°å½•ï¼Œè¿™å°±å¥½åƒäº§ç”Ÿäº†å¹»è§‰ã€‚å‘ç”Ÿå¹»è¯»çš„åŸå› ä¹Ÿæ˜¯å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ–°å¢æˆ–è€…åˆ é™¤æˆ–è€…ä¿®æ”¹äº†ç¬¬ä¸€ä¸ªäº‹åŠ¡ç»“æœé›†é‡Œé¢çš„æ•°æ®ï¼ŒåŒä¸€ä¸ªè®°å½•çš„æ•°æ®å†…å®¹è¢«ä¿®æ”¹äº†ï¼Œæ‰€æœ‰æ•°æ®è¡Œçš„è®°å½•å°±å˜å¤šæˆ–è€…å˜å°‘äº†ã€‚</p><h4 id="100-è¯´ä¸€ä¸‹-spring-mvc-è¿è¡Œæµç¨‹ï¼Ÿ">100.è¯´ä¸€ä¸‹ spring mvc è¿è¡Œæµç¨‹ï¼Ÿ</h4><ul><li>spring mvc å…ˆå°†è¯·æ±‚å‘é€ç»™ DispatcherServletã€‚</li><li>DispatcherServlet æŸ¥è¯¢ä¸€ä¸ªæˆ–å¤šä¸ª HandlerMappingï¼Œæ‰¾åˆ°å¤„ç†è¯·æ±‚çš„ Controllerã€‚</li><li>DispatcherServlet å†æŠŠè¯·æ±‚æäº¤åˆ°å¯¹åº”çš„ Controllerã€‚</li><li>Controller è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†åï¼Œä¼šè¿”å›ä¸€ä¸ªModelAndViewã€‚</li><li>Dispathcher æŸ¥è¯¢ä¸€ä¸ªæˆ–å¤šä¸ª ViewResolver è§†å›¾è§£æå™¨ï¼Œæ‰¾åˆ° ModelAndView å¯¹è±¡æŒ‡å®šçš„è§†å›¾å¯¹è±¡ã€‚</li><li>è§†å›¾å¯¹è±¡è´Ÿè´£æ¸²æŸ“è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ul><h4 id="101-spring-mvc-æœ‰å“ªäº›ç»„ä»¶ï¼Ÿ">101.spring mvc æœ‰å“ªäº›ç»„ä»¶ï¼Ÿ</h4><ul><li>å‰ç½®æ§åˆ¶å™¨ DispatcherServletã€‚</li><li>æ˜ å°„æ§åˆ¶å™¨ HandlerMappingã€‚</li><li>å¤„ç†å™¨ Controllerã€‚</li><li>æ¨¡å‹å’Œè§†å›¾ ModelAndViewã€‚</li><li>è§†å›¾è§£æå™¨ ViewResolverã€‚</li></ul><h4 id="102-RequestMapping-çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ">102.@RequestMapping çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>å°† http è¯·æ±‚æ˜ å°„åˆ°ç›¸åº”çš„ç±»/æ–¹æ³•ä¸Šã€‚</p><h4 id="103-Autowired-çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ">103.@Autowired çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>@Autowired å®ƒå¯ä»¥å¯¹ç±»æˆå‘˜å˜é‡ã€æ–¹æ³•åŠæ„é€ å‡½æ•°è¿›è¡Œæ ‡æ³¨ï¼Œå®Œæˆè‡ªåŠ¨è£…é…çš„å·¥ä½œï¼Œé€šè¿‡@Autowired çš„ä½¿ç”¨æ¥æ¶ˆé™¤ set/get æ–¹æ³•ã€‚</p><h3 id="åä¸€ã€Spring-Boot-Spring-Cloud">åä¸€ã€Spring Boot/Spring Cloud</h3><h4 id="104-ä»€ä¹ˆæ˜¯-spring-bootï¼Ÿ">104.ä»€ä¹ˆæ˜¯ spring bootï¼Ÿ</h4><p>spring boot æ˜¯ä¸º spring æœåŠ¡çš„ï¼Œæ˜¯ç”¨æ¥ç®€åŒ–æ–° spring åº”ç”¨çš„åˆå§‹æ­å»ºä»¥åŠå¼€å‘è¿‡ç¨‹çš„ã€‚</p><h4 id="105-ä¸ºä»€ä¹ˆè¦ç”¨-spring-bootï¼Ÿ">105.ä¸ºä»€ä¹ˆè¦ç”¨ spring bootï¼Ÿ</h4><ul><li>é…ç½®ç®€å•</li><li>ç‹¬ç«‹è¿è¡Œ</li><li>è‡ªåŠ¨è£…é…</li><li>æ— ä»£ç ç”Ÿæˆå’Œ xml é…ç½®</li><li>æä¾›åº”ç”¨ç›‘æ§</li><li>æ˜“ä¸Šæ‰‹</li><li>æå‡å¼€å‘æ•ˆç‡</li></ul><h4 id="106-spring-boot-æ ¸å¿ƒé…ç½®æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ">106.spring boot æ ¸å¿ƒé…ç½®æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>spring boot æ ¸å¿ƒçš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><ul><li>bootstrap (.yml æˆ–è€… .properties)ï¼šboostrap ç”±çˆ¶ ApplicationContext åŠ è½½çš„ï¼Œæ¯” applicaton ä¼˜å…ˆåŠ è½½ï¼Œä¸” boostrap é‡Œé¢çš„å±æ€§ä¸èƒ½è¢«è¦†ç›–ï¼›</li><li>application (.yml æˆ–è€… .properties)ï¼šç”¨äº spring boot é¡¹ç›®çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚</li></ul><h4 id="107-spring-boot-é…ç½®æ–‡ä»¶æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">107.spring boot é…ç½®æ–‡ä»¶æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>é…ç½®æ–‡ä»¶æœ‰ .properties æ ¼å¼å’Œ .yml æ ¼å¼ï¼Œå®ƒä»¬ä¸»è¦çš„åŒºåˆ«æ˜¯ä¹¦æ³•é£æ ¼ä¸åŒã€‚</p><p>.properties é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">spring</span>.rabbitmq.<span class="hljs-keyword">port</span>=5672<br><br></code></pre></td></tr></table></figure><p>.yml é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-attr">rabbitmq:</span><br><span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br><br></code></pre></td></tr></table></figure><p>.yml æ ¼å¼ä¸æ”¯æŒ @PropertySource æ³¨è§£å¯¼å…¥ã€‚</p><h4 id="108-spring-boot-æœ‰å“ªäº›æ–¹å¼å¯ä»¥å®ç°çƒ­éƒ¨ç½²ï¼Ÿ">108.spring boot æœ‰å“ªäº›æ–¹å¼å¯ä»¥å®ç°çƒ­éƒ¨ç½²ï¼Ÿ</h4><ul><li>ä½¿ç”¨ devtools å¯åŠ¨çƒ­éƒ¨ç½²ï¼Œæ·»åŠ  devtools åº“ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æŠŠ spring.devtools.restart.enabled è®¾ç½®ä¸º trueï¼›</li><li>ä½¿ç”¨ Intellij Idea ç¼–è¾‘å™¨ï¼Œå‹¾ä¸Šè‡ªåŠ¨ç¼–è¯‘æˆ–æ‰‹åŠ¨é‡æ–°ç¼–è¯‘ã€‚</li></ul><h4 id="109-jpa-å’Œ-hibernate-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">109.jpa å’Œ hibernate æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>jpa å…¨ç§° Java Persistence APIï¼Œæ˜¯ java æŒä¹…åŒ–æ¥å£è§„èŒƒï¼Œhibernate å±äº jpa çš„å…·ä½“å®ç°ã€‚</p><h4 id="110-ä»€ä¹ˆæ˜¯-spring-cloudï¼Ÿ">110.ä»€ä¹ˆæ˜¯ spring cloudï¼Ÿ</h4><p>spring cloud æ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„æœ‰åºé›†åˆã€‚å®ƒåˆ©ç”¨ spring boot çš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚æœåŠ¡å‘ç°æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€æ•°æ®ç›‘æ§ç­‰ï¼Œéƒ½å¯ä»¥ç”¨ spring boot çš„å¼€å‘é£æ ¼åšåˆ°ä¸€é”®å¯åŠ¨å’Œéƒ¨ç½²ã€‚</p><h4 id="111-spring-cloud-æ–­è·¯å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ">111.spring cloud æ–­è·¯å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼Œæ–­è·¯å™¨æ¨¡å¼çš„ä½œç”¨ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœï¼ˆç±»ä¼¼ç”¨ç”µå™¨å‘ç”ŸçŸ­è·¯ï¼‰ä¹‹åï¼Œé€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§ï¼ˆç±»ä¼¼ç†”æ–­ä¿é™©ä¸ï¼‰ï¼Œå‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªé”™è¯¯å“åº”ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…ã€‚è¿™æ ·å°±ä¸ä¼šä½¿å¾—çº¿ç¨‹å› è°ƒç”¨æ•…éšœæœåŠ¡è¢«é•¿æ—¶é—´å ç”¨ä¸é‡Šæ”¾ï¼Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è”“å»¶ã€‚</p><h4 id="112-spring-cloud-çš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ">112.spring cloud çš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>Eurekaï¼šæœåŠ¡æ³¨å†Œäºå‘ç°ã€‚</li><li>Feignï¼šåŸºäºåŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œæ ¹æ®æ³¨è§£å’Œé€‰æ‹©çš„æœºå™¨ï¼Œæ‹¼æ¥è¯·æ±‚ url åœ°å€ï¼Œå‘èµ·è¯·æ±‚ã€‚</li><li>Ribbonï¼šå®ç°è´Ÿè½½å‡è¡¡ï¼Œä»ä¸€ä¸ªæœåŠ¡çš„å¤šå°æœºå™¨ä¸­é€‰æ‹©ä¸€å°ã€‚</li><li>Hystrixï¼šæä¾›çº¿ç¨‹æ± ï¼Œä¸åŒçš„æœåŠ¡èµ°ä¸åŒçš„çº¿ç¨‹æ± ï¼Œå®ç°äº†ä¸åŒæœåŠ¡è°ƒç”¨çš„éš”ç¦»ï¼Œé¿å…äº†æœåŠ¡é›ªå´©çš„é—®é¢˜ã€‚</li><li>Zuulï¼šç½‘å…³ç®¡ç†ï¼Œç”± Zuul ç½‘å…³è½¬å‘è¯·æ±‚ç»™å¯¹åº”çš„æœåŠ¡ã€‚</li></ul><h3 id="åäºŒã€Hibernate">åäºŒã€Hibernate</h3><h4 id="113-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-hibernateï¼Ÿ">113.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ hibernateï¼Ÿ</h4><ul><li>hibernate æ˜¯å¯¹ jdbc çš„å°è£…ï¼Œå¤§å¤§ç®€åŒ–äº†æ•°æ®è®¿é—®å±‚çš„ç¹ççš„é‡å¤æ€§ä»£ç ã€‚</li><li>hibernate æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ ORM å®ç°ï¼Œå¾ˆå¤šç¨‹åº¦ä¸Šç®€åŒ–äº† DAO å±‚çš„ç¼–ç åŠŸèƒ½ã€‚</li><li>å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œæ•°æ®åº“çš„ç§»æ¤å·¥ä½œã€‚</li><li>æä¾›äº†ç¼“å­˜æœºåˆ¶ï¼Œæ˜¯ç¨‹åºæ‰§è¡Œæ›´æ”¹çš„é«˜æ•ˆã€‚</li></ul><h4 id="114-ä»€ä¹ˆæ˜¯-ORM-æ¡†æ¶ï¼Ÿ">114.ä»€ä¹ˆæ˜¯ ORM æ¡†æ¶ï¼Ÿ</h4><p>ORMï¼ˆObject Relation Mappingï¼‰å¯¹è±¡å…³ç³»æ˜ å°„ï¼Œæ˜¯æŠŠæ•°æ®åº“ä¸­çš„å…³ç³»æ•°æ®æ˜ å°„æˆä¸ºç¨‹åºä¸­çš„å¯¹è±¡ã€‚</p><p>ä½¿ç”¨ ORM çš„ä¼˜ç‚¹ï¼šæé«˜äº†å¼€å‘æ•ˆç‡é™ä½äº†å¼€å‘æˆæœ¬ã€å¼€å‘æ›´ç®€å•æ›´å¯¹è±¡åŒ–ã€å¯ç§»æ¤æ›´å¼ºã€‚</p><h4 id="115-hibernate-ä¸­å¦‚ä½•åœ¨æ§åˆ¶å°æŸ¥çœ‹æ‰“å°çš„-sql-è¯­å¥ï¼Ÿ">115.hibernate ä¸­å¦‚ä½•åœ¨æ§åˆ¶å°æŸ¥çœ‹æ‰“å°çš„ sql è¯­å¥ï¼Ÿ</h4><p>åœ¨ Config é‡Œé¢æŠŠ hibernate.show_sql è®¾ç½®ä¸º true å°±å¯ä»¥ã€‚ä½†ä¸å»ºè®®å¼€å¯ï¼Œå¼€å¯ä¹‹åä¼šé™ä½ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</p><h4 id="116-hibernate-æœ‰å‡ ç§æŸ¥è¯¢æ–¹å¼ï¼Ÿ">116.hibernate æœ‰å‡ ç§æŸ¥è¯¢æ–¹å¼ï¼Ÿ</h4><p>ä¸‰ç§ï¼šhqlã€åŸç”Ÿ sqlã€æ¡ä»¶æŸ¥è¯¢ Criteriaã€‚</p><h4 id="117-hibernate-å®ä½“ç±»å¯ä»¥è¢«å®šä¹‰ä¸º-final-å—ï¼Ÿ">117.hibernate å®ä½“ç±»å¯ä»¥è¢«å®šä¹‰ä¸º final å—ï¼Ÿ</h4><p>å®ä½“ç±»å¯ä»¥å®šä¹‰ä¸º final ç±»ï¼Œä½†è¿™æ ·çš„è¯å°±ä¸èƒ½ä½¿ç”¨ hibernate ä»£ç†æ¨¡å¼ä¸‹çš„å»¶è¿Ÿå…³è”æä¾›æ€§èƒ½äº†ï¼Œæ‰€ä»¥ä¸å»ºè®®å®šä¹‰å®ä½“ç±»ä¸º finalã€‚</p><h4 id="118-åœ¨-hibernate-ä¸­ä½¿ç”¨-Integer-å’Œ-int-åšæ˜ å°„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">118.åœ¨ hibernate ä¸­ä½¿ç”¨ Integer å’Œ int åšæ˜ å°„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>Integer ç±»å‹ä¸ºå¯¹è±¡ï¼Œå®ƒçš„å€¼å…è®¸ä¸º nullï¼Œè€Œ int å±äºåŸºç¡€æ•°æ®ç±»å‹ï¼Œå€¼ä¸èƒ½ä¸º nullã€‚</p><h4 id="119-hibernate-æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ">119.hibernate æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h4><ul><li>è¯»å–å¹¶è§£æé…ç½®æ–‡ä»¶ã€‚</li><li>è¯»å–å¹¶è§£ææ˜ å°„æ–‡ä»¶ï¼Œåˆ›å»º SessionFactoryã€‚</li><li>æ‰“å¼€ Sessionã€‚</li><li>åˆ›å»ºäº‹åŠ¡ã€‚</li><li>è¿›è¡ŒæŒä¹…åŒ–æ“ä½œã€‚</li><li>æäº¤äº‹åŠ¡ã€‚</li><li>å…³é—­ Sessionã€‚</li><li>å…³é—­ SessionFactoryã€‚</li></ul><h4 id="120-get-å’Œ-load-çš„åŒºåˆ«ï¼Ÿ">120.get()å’Œ load()çš„åŒºåˆ«ï¼Ÿ</h4><ul><li>æ•°æ®æŸ¥è¯¢æ—¶ï¼Œæ²¡æœ‰ OID æŒ‡å®šçš„å¯¹è±¡ï¼Œget()è¿”å› nullï¼›load()è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</li><li>load()æ”¯æŒå»¶è¿ŸåŠ è½½ï¼›get()ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ã€‚</li></ul><h4 id="121-è¯´ä¸€ä¸‹-hibernate-çš„ç¼“å­˜æœºåˆ¶ï¼Ÿ">121.è¯´ä¸€ä¸‹ hibernate çš„ç¼“å­˜æœºåˆ¶ï¼Ÿ</h4><p>hibernate å¸¸ç”¨çš„ç¼“å­˜æœ‰ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼š</p><p>ä¸€çº§ç¼“å­˜ï¼šä¹Ÿå« Session ç¼“å­˜ï¼Œåªåœ¨ Session ä½œç”¨èŒƒå›´å†…æœ‰æ•ˆï¼Œä¸éœ€è¦ç”¨æˆ·å¹²æ¶‰ï¼Œç”± hibernate è‡ªèº«ç»´æŠ¤ï¼Œå¯ä»¥é€šè¿‡ï¼ševict(object)æ¸…é™¤ object çš„ç¼“å­˜ï¼›clear()æ¸…é™¤ä¸€çº§ç¼“å­˜ä¸­çš„æ‰€æœ‰ç¼“å­˜ï¼›flush()åˆ·å‡ºç¼“å­˜ï¼›</p><p>äºŒçº§ç¼“å­˜ï¼šåº”ç”¨çº§åˆ«çš„ç¼“å­˜ï¼Œåœ¨æ‰€æœ‰ Session ä¸­éƒ½æœ‰æ•ˆï¼Œæ”¯æŒé…ç½®ç¬¬ä¸‰æ–¹çš„ç¼“å­˜ï¼Œå¦‚ï¼šEhCacheã€‚</p><h4 id="122-hibernate-å¯¹è±¡æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ">122.hibernate å¯¹è±¡æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ</h4><ul><li>ä¸´æ—¶/ç¬æ—¶çŠ¶æ€ï¼šç›´æ¥ new å‡ºæ¥çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¿˜æ²¡è¢«æŒä¹…åŒ–ï¼ˆæ²¡ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼‰ï¼Œä¸å— Session ç®¡ç†ã€‚</li><li>æŒä¹…åŒ–çŠ¶æ€ï¼šå½“è°ƒç”¨ Session çš„ save/saveOrupdate/get/load/list ç­‰æ–¹æ³•çš„æ—¶å€™ï¼Œå¯¹è±¡å°±æ˜¯æŒä¹…åŒ–çŠ¶æ€ã€‚</li><li>æ¸¸ç¦»çŠ¶æ€ï¼šSession å…³é—­ä¹‹åå¯¹è±¡å°±æ˜¯æ¸¸ç¦»çŠ¶æ€ã€‚</li></ul><h4 id="123-åœ¨-hibernate-ä¸­-getCurrentSession-å’Œ-openSession-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">123.åœ¨ hibernate ä¸­ getCurrentSession å’Œ openSession çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>getCurrentSession ä¼šç»‘å®šå½“å‰çº¿ç¨‹ï¼Œè€Œ openSession åˆ™ä¸ä¼šã€‚</li><li>getCurrentSession äº‹åŠ¡æ˜¯ Spring æ§åˆ¶çš„ï¼Œå¹¶ä¸”ä¸éœ€è¦æ‰‹åŠ¨å…³é—­ï¼Œè€Œ openSession éœ€è¦æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å¼€å¯å’Œæäº¤äº‹åŠ¡ã€‚</li></ul><h4 id="124-hibernate-å®ä½“ç±»å¿…é¡»è¦æœ‰æ— å‚æ„é€ å‡½æ•°å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ">124.hibernate å®ä½“ç±»å¿…é¡»è¦æœ‰æ— å‚æ„é€ å‡½æ•°å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h4><p>hibernate ä¸­æ¯ä¸ªå®ä½“ç±»å¿…é¡»æä¾›ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ï¼Œå› ä¸º hibernate æ¡†æ¶è¦ä½¿ç”¨ reflection apiï¼Œé€šè¿‡è°ƒç”¨ ClassnewInstance() æ¥åˆ›å»ºå®ä½“ç±»çš„å®ä¾‹ï¼Œå¦‚æœæ²¡æœ‰æ— å‚çš„æ„é€ å‡½æ•°å°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><h3 id="åä¸‰ã€Mybatis">åä¸‰ã€Mybatis</h3><h4 id="125-mybatis-ä¸­-å’Œ-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">125.mybatis ä¸­ #{}å’Œ ${}çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>#{}æ˜¯é¢„ç¼–è¯‘å¤„ç†ï¼Œ${}æ˜¯å­—ç¬¦æ›¿æ¢ã€‚<br>åœ¨ä½¿ç”¨ #{}æ—¶ï¼Œmybatis ä¼šå°† sql ä¸­çš„ #{}æ›¿æ¢æˆâ€œ?â€ï¼Œé…åˆ PreparedStatement çš„ set æ–¹æ³•èµ‹å€¼ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢ sql æ³¨å…¥ï¼Œä¿è¯ç¨‹åºçš„è¿è¡Œå®‰å…¨ã€‚</p><h4 id="126-mybatis-æœ‰å‡ ç§åˆ†é¡µæ–¹å¼ï¼Ÿ">126.mybatis æœ‰å‡ ç§åˆ†é¡µæ–¹å¼ï¼Ÿ</h4><p>åˆ†é¡µæ–¹å¼ï¼šé€»è¾‘åˆ†é¡µå’Œç‰©ç†åˆ†é¡µã€‚</p><p><strong>1).é€»è¾‘åˆ†é¡µï¼š</strong> ä½¿ç”¨ mybatis è‡ªå¸¦çš„ RowBounds è¿›è¡Œåˆ†é¡µï¼Œå®ƒæ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å¾ˆå¤šæ•°æ®ï¼Œç„¶ååœ¨æ•°æ®ä¸­å†è¿›è¡Œæ£€ç´¢ã€‚</p><p><strong>2).ç‰©ç†åˆ†é¡µï¼š</strong> è‡ªå·±æ‰‹å†™ sql åˆ†é¡µæˆ–ä½¿ç”¨åˆ†é¡µæ’ä»¶ PageHelperï¼Œå»æ•°æ®åº“æŸ¥è¯¢æŒ‡å®šæ¡æ•°çš„åˆ†é¡µæ•°æ®çš„å½¢å¼ã€‚</p><h4 id="127-RowBounds-æ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å…¨éƒ¨ç»“æœå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ">127.RowBounds æ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å…¨éƒ¨ç»“æœå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h4><p>RowBounds è¡¨é¢æ˜¯åœ¨â€œæ‰€æœ‰â€æ•°æ®ä¸­æ£€ç´¢æ•°æ®ï¼Œå…¶å®å¹¶éæ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®ï¼Œå› ä¸º mybatis æ˜¯å¯¹ jdbc çš„å°è£…ï¼Œåœ¨ jdbc é©±åŠ¨ä¸­æœ‰ä¸€ä¸ª Fetch Size çš„é…ç½®ï¼Œå®ƒè§„å®šäº†æ¯æ¬¡æœ€å¤šä»æ•°æ®åº“æŸ¥è¯¢å¤šå°‘æ¡æ•°æ®ï¼Œå‡å¦‚ä½ è¦æŸ¥è¯¢æ›´å¤šæ•°æ®ï¼Œå®ƒä¼šåœ¨ä½ æ‰§è¡Œ next()çš„æ—¶å€™ï¼Œå»æŸ¥è¯¢æ›´å¤šçš„æ•°æ®ã€‚å°±å¥½æ¯”ä½ å»è‡ªåŠ¨å–æ¬¾æœºå– 10000 å…ƒï¼Œä½†å–æ¬¾æœºæ¯æ¬¡æœ€å¤šèƒ½å– 2500 å…ƒï¼Œæ‰€ä»¥ä½ è¦å– 4 æ¬¡æ‰èƒ½æŠŠé’±å–å®Œã€‚åªæ˜¯å¯¹äº jdbc æ¥è¯´ï¼Œå½“ä½ è°ƒç”¨ next()çš„æ—¶å€™ä¼šè‡ªåŠ¨å¸®ä½ å®ŒæˆæŸ¥è¯¢å·¥ä½œã€‚è¿™æ ·åšçš„å¥½å¤„å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢å†…å­˜æº¢å‡ºã€‚</p><p>Fetch Size å®˜æ–¹ç›¸å…³æ–‡æ¡£ï¼š<a href="http://t.cn/EfSE2g3">http://t.cn/EfSE2g3</a></p><h4 id="128-mybatis-é€»è¾‘åˆ†é¡µå’Œç‰©ç†åˆ†é¡µçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">128.mybatis é€»è¾‘åˆ†é¡µå’Œç‰©ç†åˆ†é¡µçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>é€»è¾‘åˆ†é¡µæ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å¾ˆå¤šæ•°æ®ï¼Œç„¶åå†åœ¨ç»“æœä¸­æ£€ç´¢åˆ†é¡µçš„æ•°æ®ã€‚è¿™æ ·åšå¼Šç«¯æ˜¯éœ€è¦æ¶ˆè€—å¤§é‡çš„å†…å­˜ã€æœ‰å†…å­˜æº¢å‡ºçš„é£é™©ã€å¯¹æ•°æ®åº“å‹åŠ›è¾ƒå¤§ã€‚</li><li>ç‰©ç†åˆ†é¡µæ˜¯ä»æ•°æ®åº“æŸ¥è¯¢æŒ‡å®šæ¡æ•°çš„æ•°æ®ï¼Œå¼¥è¡¥äº†ä¸€æ¬¡æ€§å…¨éƒ¨æŸ¥å‡ºçš„æ‰€æœ‰æ•°æ®çš„ç§ç§ç¼ºç‚¹ï¼Œæ¯”å¦‚éœ€è¦å¤§é‡çš„å†…å­˜ï¼Œå¯¹æ•°æ®åº“æŸ¥è¯¢å‹åŠ›è¾ƒå¤§ç­‰é—®é¢˜ã€‚</li></ul><h4 id="129-mybatis-æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå»¶è¿ŸåŠ è½½çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ">129.mybatis æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå»¶è¿ŸåŠ è½½çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>mybatis æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œè®¾ç½® lazyLoadingEnabled=true å³å¯ã€‚</p><p>å»¶è¿ŸåŠ è½½çš„åŸç†çš„æ˜¯è°ƒç”¨çš„æ—¶å€™è§¦å‘åŠ è½½ï¼Œè€Œä¸æ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±åŠ è½½ä¿¡æ¯ã€‚æ¯”å¦‚è°ƒç”¨ a.getB().getName()ï¼Œè¿™ä¸ªæ—¶å€™å‘ç° a.getB() çš„å€¼ä¸º nullï¼Œæ­¤æ—¶ä¼šå•ç‹¬è§¦å‘äº‹å…ˆä¿å­˜å¥½çš„å…³è” B å¯¹è±¡çš„ sqlï¼Œå…ˆæŸ¥è¯¢å‡ºæ¥ Bï¼Œç„¶åå†è°ƒç”¨ a.setB(b)ï¼Œè€Œè¿™æ—¶å€™å†è°ƒç”¨ a.getB().getName() å°±æœ‰å€¼äº†ï¼Œè¿™å°±æ˜¯å»¶è¿ŸåŠ è½½çš„åŸºæœ¬åŸç†ã€‚</p><h4 id="130-è¯´ä¸€ä¸‹-mybatis-çš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Ÿ">130.è¯´ä¸€ä¸‹ mybatis çš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Ÿ</h4><ul><li>ä¸€çº§ç¼“å­˜ï¼šåŸºäº PerpetualCache çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œå®ƒçš„å£°æ˜å‘¨æœŸæ˜¯å’Œ sqlSession  ä¸€è‡´çš„ï¼Œæœ‰å¤šä¸ª sqlSession æˆ–è€…åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸­æ•°æ®åº“æ“ä½œï¼Œå¯èƒ½ä¼šå‡ºç°è„æ•°æ®ã€‚å½“ Session flush æˆ– close ä¹‹åï¼Œè¯¥ Session ä¸­çš„æ‰€æœ‰ Cache å°±å°†æ¸…ç©ºï¼Œé»˜è®¤ä¸€çº§ç¼“å­˜æ˜¯å¼€å¯çš„ã€‚</li><li>äºŒçº§ç¼“å­˜ï¼šä¹Ÿæ˜¯åŸºäº PerpetualCache çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œä¸åŒåœ¨äºå…¶å­˜å‚¨ä½œç”¨åŸŸä¸º Mapper çº§åˆ«çš„ï¼Œå¦‚æœå¤šä¸ªsqlSessionä¹‹é—´éœ€è¦å…±äº«ç¼“å­˜ï¼Œåˆ™éœ€è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜ï¼Œå¹¶ä¸”äºŒçº§ç¼“å­˜å¯è‡ªå®šä¹‰å­˜å‚¨æºï¼Œå¦‚ Ehcacheã€‚é»˜è®¤ä¸æ‰“å¼€äºŒçº§ç¼“å­˜ï¼Œè¦å¼€å¯äºŒçº§ç¼“å­˜ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜å±æ€§ç±»éœ€è¦å®ç° Serializable åºåˆ—åŒ–æ¥å£(å¯ç”¨æ¥ä¿å­˜å¯¹è±¡çš„çŠ¶æ€)ã€‚</li></ul><p>å¼€å¯äºŒçº§ç¼“å­˜æ•°æ®æŸ¥è¯¢æµç¨‹ï¼šäºŒçº§ç¼“å­˜ -&gt; ä¸€çº§ç¼“å­˜ -&gt; æ•°æ®åº“ã€‚</p><p>ç¼“å­˜æ›´æ–°æœºåˆ¶ï¼šå½“æŸä¸€ä¸ªä½œç”¨åŸŸ(ä¸€çº§ç¼“å­˜ Session/äºŒçº§ç¼“å­˜ Mapper)è¿›è¡Œäº†C/U/D æ“ä½œåï¼Œé»˜è®¤è¯¥ä½œç”¨åŸŸä¸‹æ‰€æœ‰ select ä¸­çš„ç¼“å­˜å°†è¢« clearã€‚</p><h4 id="131-mybatis-å’Œ-hibernate-çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ">131.mybatis å’Œ hibernate çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>çµæ´»æ€§ï¼šmybatis æ›´åŠ çµæ´»ï¼Œè‡ªå·±å¯ä»¥å†™ sql è¯­å¥ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚</li><li>å¯ç§»æ¤æ€§ï¼šmybatis æœ‰å¾ˆå¤šè‡ªå·±å†™çš„ sqlï¼Œå› ä¸ºæ¯ä¸ªæ•°æ®åº“çš„ sql å¯ä»¥ä¸ç›¸åŒï¼Œæ‰€ä»¥å¯ç§»æ¤æ€§æ¯”è¾ƒå·®ã€‚</li><li>å­¦ä¹ å’Œä½¿ç”¨é—¨æ§›ï¼šmybatis å…¥é—¨æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨é—¨æ§›ä¹Ÿæ›´ä½ã€‚</li><li>äºŒçº§ç¼“å­˜ï¼šhibernate æ‹¥æœ‰æ›´å¥½çš„äºŒçº§ç¼“å­˜ï¼Œå®ƒçš„äºŒçº§ç¼“å­˜å¯ä»¥è‡ªè¡Œæ›´æ¢ä¸ºç¬¬ä¸‰æ–¹çš„äºŒçº§ç¼“å­˜ã€‚</li></ul><h4 id="132-mybatis-æœ‰å“ªäº›æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰ï¼Ÿ">132.mybatis æœ‰å“ªäº›æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰ï¼Ÿ</h4><p>mybatis æœ‰ä¸‰ç§åŸºæœ¬çš„Executoræ‰§è¡Œå™¨ï¼š</p><ul><li>SimpleExecutorï¼šæ¯æ‰§è¡Œä¸€æ¬¡ update æˆ– select å°±å¼€å¯ä¸€ä¸ª Statement å¯¹è±¡ï¼Œç”¨å®Œç«‹åˆ»å…³é—­ Statement å¯¹è±¡ï¼›</li><li>ReuseExecutorï¼šæ‰§è¡Œ update æˆ– selectï¼Œä»¥ sql ä½œä¸º key æŸ¥æ‰¾ Statement å¯¹è±¡ï¼Œå­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºï¼Œç”¨å®Œåä¸å…³é—­ Statement å¯¹è±¡ï¼Œè€Œæ˜¯æ”¾ç½®äº Map å†…ä¾›ä¸‹ä¸€æ¬¡ä½¿ç”¨ã€‚ç®€è¨€ä¹‹ï¼Œå°±æ˜¯é‡å¤ä½¿ç”¨ Statement å¯¹è±¡ï¼›</li><li>BatchExecutorï¼šæ‰§è¡Œ updateï¼ˆæ²¡æœ‰ selectï¼Œjdbc æ‰¹å¤„ç†ä¸æ”¯æŒ selectï¼‰ï¼Œå°†æ‰€æœ‰ sql éƒ½æ·»åŠ åˆ°æ‰¹å¤„ç†ä¸­ï¼ˆaddBatch()ï¼‰ï¼Œç­‰å¾…ç»Ÿä¸€æ‰§è¡Œï¼ˆexecuteBatch()ï¼‰ï¼Œå®ƒç¼“å­˜äº†å¤šä¸ª Statement å¯¹è±¡ï¼Œæ¯ä¸ª Statement å¯¹è±¡éƒ½æ˜¯ addBatch()å®Œæ¯•åï¼Œç­‰å¾…é€ä¸€æ‰§è¡Œ executeBatch()æ‰¹å¤„ç†ï¼Œä¸ jdbc æ‰¹å¤„ç†ç›¸åŒã€‚</li></ul><h4 id="133-mybatis-åˆ†é¡µæ’ä»¶çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ">133.mybatis åˆ†é¡µæ’ä»¶çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>åˆ†é¡µæ’ä»¶çš„åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨ mybatis æä¾›çš„æ’ä»¶æ¥å£ï¼Œå®ç°è‡ªå®šä¹‰æ’ä»¶ï¼Œåœ¨æ’ä»¶çš„æ‹¦æˆªæ–¹æ³•å†…æ‹¦æˆªå¾…æ‰§è¡Œçš„ sqlï¼Œç„¶åé‡å†™ sqlï¼Œæ ¹æ® dialect æ–¹è¨€ï¼Œæ·»åŠ å¯¹åº”çš„ç‰©ç†åˆ†é¡µè¯­å¥å’Œç‰©ç†åˆ†é¡µå‚æ•°ã€‚</p><h4 id="134-mybatis-å¦‚ä½•ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ’ä»¶ï¼Ÿ">134.mybatis å¦‚ä½•ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ’ä»¶ï¼Ÿ</h4><p><strong>1).è‡ªå®šä¹‰æ’ä»¶å®ç°åŸç†</strong></p><p>mybatis è‡ªå®šä¹‰æ’ä»¶é’ˆå¯¹ mybatis å››å¤§å¯¹è±¡ï¼ˆExecutorã€StatementHandlerã€ParameterHandlerã€ResultSetHandlerï¼‰è¿›è¡Œæ‹¦æˆªï¼š</p><ul><li>Executorï¼šæ‹¦æˆªå†…éƒ¨æ‰§è¡Œå™¨ï¼Œå®ƒè´Ÿè´£è°ƒç”¨ StatementHandler æ“ä½œæ•°æ®åº“ï¼Œå¹¶æŠŠç»“æœé›†é€šè¿‡ ResultSetHandler è¿›è¡Œè‡ªåŠ¨æ˜ å°„ï¼Œå¦å¤–å®ƒè¿˜å¤„ç†äº†äºŒçº§ç¼“å­˜çš„æ“ä½œï¼›</li><li>StatementHandlerï¼šæ‹¦æˆª sql è¯­æ³•æ„å»ºçš„å¤„ç†ï¼Œå®ƒæ˜¯ mybatis ç›´æ¥å’Œæ•°æ®åº“æ‰§è¡Œ sql è„šæœ¬çš„å¯¹è±¡ï¼Œå¦å¤–å®ƒä¹Ÿå®ç°äº† mybatis çš„ä¸€çº§ç¼“å­˜ï¼›</li><li>ParameterHandlerï¼šæ‹¦æˆªå‚æ•°çš„å¤„ç†ï¼›</li><li>ResultSetHandlerï¼šæ‹¦æˆªç»“æœé›†çš„å¤„ç†ã€‚</li></ul><p><strong>2).è‡ªå®šä¹‰æ’ä»¶å®ç°å…³é”®</strong></p><p>mybatis æ’ä»¶è¦å®ç° Interceptor æ¥å£ï¼Œæ¥å£åŒ…å«çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Interceptor</span> </span>&#123;   <br>   <span class="hljs-function">Object <span class="hljs-title">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable</span>;       <br>   <span class="hljs-function">Object <span class="hljs-title">plugin</span><span class="hljs-params">(Object target)</span></span>;    <br>   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setProperties</span><span class="hljs-params">(Properties properties)</span></span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>setProperties æ–¹æ³•æ˜¯åœ¨ mybatis è¿›è¡Œé…ç½®æ’ä»¶çš„æ—¶å€™å¯ä»¥é…ç½®è‡ªå®šä¹‰ç›¸å…³å±æ€§ï¼Œå³ï¼šæ¥å£å®ç°å¯¹è±¡çš„å‚æ•°é…ç½®ï¼›</li><li>plugin æ–¹æ³•æ˜¯æ’ä»¶ç”¨äºå°è£…ç›®æ ‡å¯¹è±¡çš„ï¼Œé€šè¿‡è¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥è¿”å›ç›®æ ‡å¯¹è±¡æœ¬èº«ï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå®ƒçš„ä»£ç†ï¼Œå¯ä»¥å†³å®šæ˜¯å¦è¦è¿›è¡Œæ‹¦æˆªè¿›è€Œå†³å®šè¦è¿”å›ä¸€ä¸ªä»€ä¹ˆæ ·çš„ç›®æ ‡å¯¹è±¡ï¼Œå®˜æ–¹æä¾›äº†ç¤ºä¾‹ï¼šreturn Plugin.wrap(target, this)ï¼›</li><li>intercept æ–¹æ³•å°±æ˜¯è¦è¿›è¡Œæ‹¦æˆªçš„æ—¶å€™è¦æ‰§è¡Œçš„æ–¹æ³•ã€‚</li></ul><p><strong>3).è‡ªå®šä¹‰æ’ä»¶å®ç°ç¤ºä¾‹</strong></p><p>å®˜æ–¹æ’ä»¶å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Intercepts(&#123;@Signature(type = Executor.class, method = &quot;query&quot;,</span><br><span class="hljs-meta">        args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;)&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Interceptor</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>     Object target = invocation.getTarget(); <span class="hljs-comment">//è¢«ä»£ç†å¯¹è±¡</span><br>     Method method = invocation.getMethod(); <span class="hljs-comment">//ä»£ç†æ–¹æ³•</span><br>     Object[] args = invocation.getArgs(); <span class="hljs-comment">//æ–¹æ³•å‚æ•°</span><br>     <span class="hljs-comment">// do something ...... æ–¹æ³•æ‹¦æˆªå‰æ‰§è¡Œä»£ç å—</span><br>     Object result = invocation.proceed();<br>     <span class="hljs-comment">// do something .......æ–¹æ³•æ‹¦æˆªåæ‰§è¡Œä»£ç å—</span><br>     <span class="hljs-keyword">return</span> result;<br>   &#125;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">plugin</span><span class="hljs-params">(Object target)</span> </span>&#123;<br>     <span class="hljs-keyword">return</span> Plugin.wrap(target, <span class="hljs-keyword">this</span>);<br>   &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="åå››ã€RabbitMQ">åå››ã€RabbitMQ</h3><h4 id="135-rabbitmq-çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ">135.rabbitmq çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>æŠ¢è´­æ´»åŠ¨ï¼Œå‰Šå³°å¡«è°·ï¼Œé˜²æ­¢ç³»ç»Ÿå´©å¡Œã€‚</li><li>å»¶è¿Ÿä¿¡æ¯å¤„ç†ï¼Œæ¯”å¦‚ 10 åˆ†é’Ÿä¹‹åç»™ä¸‹å•æœªä»˜æ¬¾çš„ç”¨æˆ·å‘é€é‚®ä»¶æé†’ã€‚</li><li>è§£è€¦ç³»ç»Ÿï¼Œå¯¹äºæ–°å¢çš„åŠŸèƒ½å¯ä»¥å•ç‹¬å†™æ¨¡å—æ‰©å±•ï¼Œæ¯”å¦‚ç”¨æˆ·ç¡®è®¤è¯„ä»·ä¹‹åï¼Œæ–°å¢äº†ç»™ç”¨æˆ·è¿”ç§¯åˆ†çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæ—¶å€™ä¸ç”¨åœ¨ä¸šåŠ¡ä»£ç é‡Œæ·»åŠ æ–°å¢ç§¯åˆ†çš„åŠŸèƒ½ï¼Œåªéœ€è¦æŠŠæ–°å¢ç§¯åˆ†çš„æ¥å£è®¢é˜…ç¡®è®¤è¯„ä»·çš„æ¶ˆæ¯é˜Ÿåˆ—å³å¯ï¼Œåé¢å†æ·»åŠ ä»»ä½•åŠŸèƒ½åªéœ€è¦è®¢é˜…å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—å³å¯ã€‚</li></ul><h4 id="136-rabbitmq-æœ‰å“ªäº›é‡è¦çš„è§’è‰²ï¼Ÿ">136.rabbitmq æœ‰å“ªäº›é‡è¦çš„è§’è‰²ï¼Ÿ</h4><p>rabbitmq ä¸­é‡è¦çš„è§’è‰²æœ‰ï¼šç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å’Œä»£ç†ï¼š</p><ul><li>ç”Ÿäº§è€…ï¼šæ¶ˆæ¯çš„åˆ›å»ºè€…ï¼Œè´Ÿè´£åˆ›å»ºå’Œæ¨é€æ•°æ®åˆ°æ¶ˆæ¯æœåŠ¡å™¨ï¼›</li><li>æ¶ˆè´¹è€…ï¼šæ¶ˆæ¯çš„æ¥æ”¶æ–¹ï¼Œç”¨äºå¤„ç†æ•°æ®å’Œç¡®è®¤æ¶ˆæ¯ï¼›</li><li>ä»£ç†ï¼šå°±æ˜¯ rabbitmq æœ¬èº«ï¼Œç”¨äºæ‰®æ¼”â€œå¿«é€’â€çš„è§’è‰²ï¼Œæœ¬èº«ä¸ç”Ÿäº§æ¶ˆæ¯ï¼Œåªæ˜¯æ‰®æ¼”â€œå¿«é€’â€çš„è§’è‰²ã€‚</li></ul><h4 id="137-rabbitmq-æœ‰å“ªäº›é‡è¦çš„ç»„ä»¶ï¼Ÿ">137.rabbitmq æœ‰å“ªäº›é‡è¦çš„ç»„ä»¶ï¼Ÿ</h4><ul><li>ConnectionFactoryï¼ˆè¿æ¥ç®¡ç†å™¨ï¼‰ï¼šåº”ç”¨ç¨‹åºä¸Rabbitä¹‹é—´å»ºç«‹è¿æ¥çš„ç®¡ç†å™¨ï¼Œç¨‹åºä»£ç ä¸­ä½¿ç”¨ã€‚</li><li>Channelï¼ˆä¿¡é“ï¼‰ï¼šæ¶ˆæ¯æ¨é€ä½¿ç”¨çš„é€šé“ã€‚</li><li>Exchangeï¼ˆäº¤æ¢å™¨ï¼‰ï¼šç”¨äºæ¥å—ã€åˆ†é…æ¶ˆæ¯ã€‚</li><li>Queueï¼ˆé˜Ÿåˆ—ï¼‰ï¼šç”¨äºå­˜å‚¨ç”Ÿäº§è€…çš„æ¶ˆæ¯ã€‚</li><li>RoutingKeyï¼ˆè·¯ç”±é”®ï¼‰ï¼šç”¨äºæŠŠç”Ÿæˆè€…çš„æ•°æ®åˆ†é…åˆ°äº¤æ¢å™¨ä¸Šã€‚</li><li>BindingKeyï¼ˆç»‘å®šé”®ï¼‰ï¼šç”¨äºæŠŠäº¤æ¢å™¨çš„æ¶ˆæ¯ç»‘å®šåˆ°é˜Ÿåˆ—ä¸Šã€‚</li></ul><h4 id="138-rabbitmq-ä¸­-vhost-çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ">138.rabbitmq ä¸­ vhost çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>vhostï¼šæ¯ä¸ª rabbitmq éƒ½èƒ½åˆ›å»ºå¾ˆå¤š vhostï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè™šæ‹Ÿä¸»æœºï¼Œæ¯ä¸ªè™šæ‹Ÿä¸»æœºå…¶å®éƒ½æ˜¯ mini ç‰ˆçš„rabbitmqï¼Œå®ƒæ‹¥æœ‰è‡ªå·±çš„é˜Ÿåˆ—ï¼Œäº¤æ¢å™¨å’Œç»‘å®šï¼Œæ‹¥æœ‰è‡ªå·±çš„æƒé™æœºåˆ¶ã€‚</p><h4 id="139-rabbitmq-çš„æ¶ˆæ¯æ˜¯æ€ä¹ˆå‘é€çš„ï¼Ÿ">139.rabbitmq çš„æ¶ˆæ¯æ˜¯æ€ä¹ˆå‘é€çš„ï¼Ÿ</h4><p>é¦–å…ˆå®¢æˆ·ç«¯å¿…é¡»è¿æ¥åˆ° rabbitmq æœåŠ¡å™¨æ‰èƒ½å‘å¸ƒå’Œæ¶ˆè´¹æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å’Œ rabbit server ä¹‹é—´ä¼šåˆ›å»ºä¸€ä¸ª tcp è¿æ¥ï¼Œä¸€æ—¦ tcp æ‰“å¼€å¹¶é€šè¿‡äº†è®¤è¯ï¼ˆè®¤è¯å°±æ˜¯ä½ å‘é€ç»™ rabbit æœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç ï¼‰ï¼Œä½ çš„å®¢æˆ·ç«¯å’Œ rabbitmq å°±åˆ›å»ºäº†ä¸€æ¡ amqp ä¿¡é“ï¼ˆchannelï¼‰ï¼Œä¿¡é“æ˜¯åˆ›å»ºåœ¨â€œçœŸå®â€ tcp ä¸Šçš„è™šæ‹Ÿè¿æ¥ï¼Œamqp å‘½ä»¤éƒ½æ˜¯é€šè¿‡ä¿¡é“å‘é€å‡ºå»çš„ï¼Œæ¯ä¸ªä¿¡é“éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„ idï¼Œä¸è®ºæ˜¯å‘å¸ƒæ¶ˆæ¯ï¼Œè®¢é˜…é˜Ÿåˆ—éƒ½æ˜¯é€šè¿‡è¿™ä¸ªä¿¡é“å®Œæˆçš„ã€‚</p><h4 id="140-rabbitmq-æ€ä¹ˆä¿è¯æ¶ˆæ¯çš„ç¨³å®šæ€§ï¼Ÿ">140.rabbitmq æ€ä¹ˆä¿è¯æ¶ˆæ¯çš„ç¨³å®šæ€§ï¼Ÿ</h4><ul><li>æä¾›äº†äº‹åŠ¡çš„åŠŸèƒ½ã€‚</li><li>é€šè¿‡å°† channel è®¾ç½®ä¸º confirmï¼ˆç¡®è®¤ï¼‰æ¨¡å¼ã€‚</li></ul><h4 id="141-rabbitmq-æ€ä¹ˆé¿å…æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ">141.rabbitmq æ€ä¹ˆé¿å…æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ</h4><ul><li>æŠŠæ¶ˆæ¯æŒä¹…åŒ–ç£ç›˜ï¼Œä¿è¯æœåŠ¡å™¨é‡å¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚</li><li>æ¯ä¸ªé›†ç¾¤ä¸­è‡³å°‘æœ‰ä¸€ä¸ªç‰©ç†ç£ç›˜ï¼Œä¿è¯æ¶ˆæ¯è½å…¥ç£ç›˜ã€‚</li></ul><h4 id="142-è¦ä¿è¯æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸçš„æ¡ä»¶æœ‰å“ªäº›ï¼Ÿ">142.è¦ä¿è¯æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸçš„æ¡ä»¶æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>å£°æ˜é˜Ÿåˆ—å¿…é¡»è®¾ç½®æŒä¹…åŒ– durable è®¾ç½®ä¸º true.</li><li>æ¶ˆæ¯æ¨é€æŠ•é€’æ¨¡å¼å¿…é¡»è®¾ç½®æŒä¹…åŒ–ï¼ŒdeliveryMode è®¾ç½®ä¸º 2ï¼ˆæŒä¹…ï¼‰ã€‚</li><li>æ¶ˆæ¯å·²ç»åˆ°è¾¾æŒä¹…åŒ–äº¤æ¢å™¨ã€‚</li><li>æ¶ˆæ¯å·²ç»åˆ°è¾¾æŒä¹…åŒ–é˜Ÿåˆ—ã€‚</li></ul><p>ä»¥ä¸Šå››ä¸ªæ¡ä»¶éƒ½æ»¡è¶³æ‰èƒ½ä¿è¯æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸã€‚</p><h4 id="143-rabbitmq-æŒä¹…åŒ–æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ">143.rabbitmq æŒä¹…åŒ–æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ</h4><p>æŒä¹…åŒ–çš„ç¼ºåœ°å°±æ˜¯é™ä½äº†æœåŠ¡å™¨çš„ååé‡ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯ç£ç›˜è€Œéå†…å­˜å­˜å‚¨ï¼Œä»è€Œé™ä½äº†ååé‡ã€‚å¯å°½é‡ä½¿ç”¨ ssd ç¡¬ç›˜æ¥ç¼“è§£ååé‡çš„é—®é¢˜ã€‚</p><h4 id="144-rabbitmq-æœ‰å‡ ç§å¹¿æ’­ç±»å‹ï¼Ÿ">144.rabbitmq æœ‰å‡ ç§å¹¿æ’­ç±»å‹ï¼Ÿ</h4><ul><li>directï¼ˆé»˜è®¤æ–¹å¼ï¼‰ï¼šæœ€åŸºç¡€æœ€ç®€å•çš„æ¨¡å¼ï¼Œå‘é€æ–¹æŠŠæ¶ˆæ¯å‘é€ç»™è®¢é˜…æ–¹ï¼Œå¦‚æœæœ‰å¤šä¸ªè®¢é˜…è€…ï¼Œé»˜è®¤é‡‡å–è½®è¯¢çš„æ–¹å¼è¿›è¡Œæ¶ˆæ¯å‘é€ã€‚</li><li>headersï¼šä¸ direct ç±»ä¼¼ï¼Œåªæ˜¯æ€§èƒ½å¾ˆå·®ï¼Œæ­¤ç±»å‹å‡ ä¹ç”¨ä¸åˆ°ã€‚</li><li>fanoutï¼šåˆ†å‘æ¨¡å¼ï¼ŒæŠŠæ¶ˆè´¹åˆ†å‘ç»™æ‰€æœ‰è®¢é˜…è€…ã€‚</li><li>topicï¼šåŒ¹é…è®¢é˜…æ¨¡å¼ï¼Œä½¿ç”¨æ­£åˆ™åŒ¹é…åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œèƒ½åŒ¹é…åˆ°çš„éƒ½èƒ½æ¥æ”¶åˆ°ã€‚</li></ul><h4 id="145-rabbitmq-æ€ä¹ˆå®ç°å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ">145.rabbitmq æ€ä¹ˆå®ç°å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</h4><p>å»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>é€šè¿‡æ¶ˆæ¯è¿‡æœŸåè¿›å…¥æ­»ä¿¡äº¤æ¢å™¨ï¼Œå†ç”±äº¤æ¢å™¨è½¬å‘åˆ°å»¶è¿Ÿæ¶ˆè´¹é˜Ÿåˆ—ï¼Œå®ç°å»¶è¿ŸåŠŸèƒ½ï¼›</li><li>ä½¿ç”¨ rabbitmq-delayed-message-exchange æ’ä»¶å®ç°å»¶è¿ŸåŠŸèƒ½ã€‚</li></ul><h4 id="146-rabbitmq-é›†ç¾¤æœ‰ä»€ä¹ˆç”¨ï¼Ÿ">146.rabbitmq é›†ç¾¤æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h4><p>é›†ç¾¤ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªç”¨é€”ï¼š</p><ul><li>é«˜å¯ç”¨ï¼šæŸä¸ªæœåŠ¡å™¨å‡ºç°é—®é¢˜ï¼Œæ•´ä¸ª rabbitmq è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼›</li><li>é«˜å®¹é‡ï¼šé›†ç¾¤å¯ä»¥æ‰¿è½½æ›´å¤šçš„æ¶ˆæ¯é‡ã€‚</li></ul><h4 id="147-rabbitmq-èŠ‚ç‚¹çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ">147.rabbitmq èŠ‚ç‚¹çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>ç£ç›˜èŠ‚ç‚¹ï¼šæ¶ˆæ¯ä¼šå­˜å‚¨åˆ°ç£ç›˜ã€‚</li><li>å†…å­˜èŠ‚ç‚¹ï¼šæ¶ˆæ¯éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé‡å¯æœåŠ¡å™¨æ¶ˆæ¯ä¸¢å¤±ï¼Œæ€§èƒ½é«˜äºç£ç›˜ç±»å‹ã€‚</li></ul><h4 id="148-rabbitmq-é›†ç¾¤æ­å»ºéœ€è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ">148.rabbitmq é›†ç¾¤æ­å»ºéœ€è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ</h4><ul><li>å„èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨â€œâ€“linkâ€è¿æ¥ï¼Œæ­¤å±æ€§ä¸èƒ½å¿½ç•¥ã€‚</li><li>å„èŠ‚ç‚¹ä½¿ç”¨çš„ erlang cookie å€¼å¿…é¡»ç›¸åŒï¼Œæ­¤å€¼ç›¸å½“äºâ€œç§˜é’¥â€çš„åŠŸèƒ½ï¼Œç”¨äºå„èŠ‚ç‚¹çš„è®¤è¯ã€‚</li><li>æ•´ä¸ªé›†ç¾¤ä¸­å¿…é¡»åŒ…å«ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹ã€‚</li></ul><h4 id="149-rabbitmq-æ¯ä¸ªèŠ‚ç‚¹æ˜¯å…¶ä»–èŠ‚ç‚¹çš„å®Œæ•´æ‹·è´å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ">149.rabbitmq æ¯ä¸ªèŠ‚ç‚¹æ˜¯å…¶ä»–èŠ‚ç‚¹çš„å®Œæ•´æ‹·è´å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h4><p>ä¸æ˜¯ï¼ŒåŸå› æœ‰ä»¥ä¸‹ä¸¤ä¸ªï¼š</p><ul><li>å­˜å‚¨ç©ºé—´çš„è€ƒè™‘ï¼šå¦‚æœæ¯ä¸ªèŠ‚ç‚¹éƒ½æ‹¥æœ‰æ‰€æœ‰é˜Ÿåˆ—çš„å®Œå…¨æ‹·è´ï¼Œè¿™æ ·æ–°å¢èŠ‚ç‚¹ä¸ä½†æ²¡æœ‰æ–°å¢å­˜å‚¨ç©ºé—´ï¼Œåè€Œå¢åŠ äº†æ›´å¤šçš„å†—ä½™æ•°æ®ï¼›</li><li>æ€§èƒ½çš„è€ƒè™‘ï¼šå¦‚æœæ¯æ¡æ¶ˆæ¯éƒ½éœ€è¦å®Œæ•´æ‹·è´åˆ°æ¯ä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹ï¼Œé‚£æ–°å¢èŠ‚ç‚¹å¹¶æ²¡æœ‰æå‡å¤„ç†æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œæœ€å¤šæ˜¯ä¿æŒå’Œå•èŠ‚ç‚¹ç›¸åŒçš„æ€§èƒ½ç”šè‡³æ˜¯æ›´ç³Ÿã€‚</li></ul><h4 id="150-rabbitmq-é›†ç¾¤ä¸­å”¯ä¸€ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹å´©æºƒäº†ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ">150.rabbitmq é›†ç¾¤ä¸­å”¯ä¸€ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹å´©æºƒäº†ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ</h4><p>å¦‚æœå”¯ä¸€ç£ç›˜çš„ç£ç›˜èŠ‚ç‚¹å´©æºƒäº†ï¼Œä¸èƒ½è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>ä¸èƒ½åˆ›å»ºé˜Ÿåˆ—</li><li>ä¸èƒ½åˆ›å»ºäº¤æ¢å™¨</li><li>ä¸èƒ½åˆ›å»ºç»‘å®š</li><li>ä¸èƒ½æ·»åŠ ç”¨æˆ·</li><li>ä¸èƒ½æ›´æ”¹æƒé™</li><li>ä¸èƒ½æ·»åŠ å’Œåˆ é™¤é›†ç¾¤èŠ‚ç‚¹</li></ul><p>å”¯ä¸€ç£ç›˜èŠ‚ç‚¹å´©æºƒäº†ï¼Œé›†ç¾¤æ˜¯å¯ä»¥ä¿æŒè¿è¡Œçš„ï¼Œä½†ä½ ä¸èƒ½æ›´æ”¹ä»»ä½•ä¸œè¥¿ã€‚</p><h4 id="151-rabbitmq-å¯¹é›†ç¾¤èŠ‚ç‚¹åœæ­¢é¡ºåºæœ‰è¦æ±‚å—ï¼Ÿ">151.rabbitmq å¯¹é›†ç¾¤èŠ‚ç‚¹åœæ­¢é¡ºåºæœ‰è¦æ±‚å—ï¼Ÿ</h4><p>rabbitmq å¯¹é›†ç¾¤çš„åœæ­¢çš„é¡ºåºæ˜¯æœ‰è¦æ±‚çš„ï¼Œåº”è¯¥å…ˆå…³é—­å†…å­˜èŠ‚ç‚¹ï¼Œæœ€åå†å…³é—­ç£ç›˜èŠ‚ç‚¹ã€‚å¦‚æœé¡ºåºæ°å¥½ç›¸åçš„è¯ï¼Œå¯èƒ½ä¼šé€ æˆæ¶ˆæ¯çš„ä¸¢å¤±ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JavaInterview</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaInterview-02</title>
    <link href="/dajiangdahe/2021/10/22/JavaInterview-02/"/>
    <url>/dajiangdahe/2021/10/22/JavaInterview-02/</url>
    
    <content type="html"><![CDATA[<h3 id="å››ã€åå°„">å››ã€åå°„</h3><h4 id="57-ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ">57.ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ</h4><p>åå°„æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º java è¯­è¨€çš„åå°„æœºåˆ¶ã€‚</p><h4 id="58-ä»€ä¹ˆæ˜¯-java-åºåˆ—åŒ–ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦åºåˆ—åŒ–ï¼Ÿ">58.ä»€ä¹ˆæ˜¯ java åºåˆ—åŒ–ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦åºåˆ—åŒ–ï¼Ÿ</h4><p>java åºåˆ—åŒ–æ˜¯ä¸ºäº†ä¿å­˜å„ç§å¯¹è±¡åœ¨å†…å­˜ä¸­çš„çŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥æŠŠä¿å­˜çš„å¯¹è±¡çŠ¶æ€å†è¯»å‡ºæ¥ã€‚</p><p>ä»¥ä¸‹æƒ…å†µéœ€è¦ä½¿ç”¨ java åºåˆ—åŒ–ï¼š</p><ul><li>æƒ³æŠŠçš„å†…å­˜ä¸­çš„å¯¹è±¡çŠ¶æ€ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­æˆ–è€…æ•°æ®åº“ä¸­æ—¶å€™ï¼›</li><li>æƒ³ç”¨å¥—æ¥å­—åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡çš„æ—¶å€™ï¼›</li><li>æƒ³é€šè¿‡RMIï¼ˆè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼‰ä¼ è¾“å¯¹è±¡çš„æ—¶å€™ã€‚</li></ul><h4 id="59-åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›åº”ç”¨ï¼Ÿ">59.åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›åº”ç”¨ï¼Ÿ</h4><p>åœ¨è¿è¡Œæ—¶æä¾›äº†ä¸€ç³»åˆ—çš„APIæ¥è®¿é—®ç³»ç»Ÿé‡Œé¢çš„å¯¹è±¡å’Œç±»çš„ä¿¡æ¯ã€‚</p><p>åŠ¨æ€ä»£ç†çš„åº”ç”¨æœ‰ spring aopã€hibernate æ•°æ®æŸ¥è¯¢ã€æµ‹è¯•æ¡†æ¶çš„åç«¯ mockã€rpcï¼Œjavaæ³¨è§£å¯¹è±¡è·å–ç­‰ã€‚</p><p>JDKæä¾›äº†java.lang.reflect.InvocationHandleræ¥å£å’Œ java.lang.reflect.Proxyç±»ï¼Œè¿™ä¸¤ä¸ªç±»ç›¸äº’é…åˆï¼Œå…¥å£æ˜¯Proxyã€‚</p><h4 id="60-æ€ä¹ˆå®ç°åŠ¨æ€ä»£ç†ï¼Ÿ">60.æ€ä¹ˆå®ç°åŠ¨æ€ä»£ç†ï¼Ÿ</h4><p>jdk åŸç”ŸåŠ¨æ€ä»£ç†å’Œ cglib åŠ¨æ€ä»£ç†ã€‚jdk åŸç”ŸåŠ¨æ€ä»£ç†æ˜¯åŸºäºæ¥å£å®ç°çš„ï¼Œè€Œ cglib æ˜¯åŸºäºç»§æ‰¿å½“å‰ç±»çš„å­ç±»å®ç°çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä»£ç†ç±»</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProxyFactory</span></span>&#123;<br>    <span class="hljs-comment">//è§£å†³é—®é¢˜1ï¼šå¦‚ä½•æ ¹æ®åŠ è½½åˆ°å†…å­˜ä¸­çš„è¢«ä»£ç†ç±»ï¼ŒåŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªä»£ç†ç±»åŠå…¶å¯¹è±¡</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">getProxyInstance</span><span class="hljs-params">(Object obj)</span></span>&#123;<br>        <span class="hljs-comment">//obj:è¢«ä»£ç†ç±»</span><br>        <span class="hljs-comment">//è§£å†³é—®é¢˜2ï¼šå½“é€šè¿‡ä»£ç†ç±»çš„å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œå¦‚ä½•åŠ¨æ€çš„å»è°ƒç”¨è¢«ä»£ç†ç±»ä¸­çš„åŒåæ–¹æ³•</span><br>        MyInvocationHandler handler = <span class="hljs-keyword">new</span> MyInvocationHandler();<br>        handler.bind(obj);<br><br>        <span class="hljs-keyword">return</span> Proxy.newProxyInstance(obj.getClass().getClassLoader(), obj.getClass().getInterfaces(),handler);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InvocationHandler</span></span>&#123;<br>    <span class="hljs-keyword">private</span> Object object;<span class="hljs-comment">//éœ€è¦ä½¿ç”¨è¢«ä»£ç†ç±»çš„å¯¹è±¡è¿›è¡Œèµ‹å€¼</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bind</span><span class="hljs-params">(Object object)</span></span>&#123;<br>        <span class="hljs-keyword">this</span>.object = object;<br>    &#125;<br>    <span class="hljs-comment">//å½“æˆ‘ä»¬é€šè¿‡ä»£ç†ç±»çš„å¯¹è±¡æ—¶ï¼Œè°ƒç”¨æ–¹æ³•aï¼Œå°±ä¼šè·‘åˆ°ä¸‹é¢æ¥è°ƒç”¨invoke()ã€‚</span><br>    <span class="hljs-comment">//å°†è¢«ä»£ç†ç±»è¦æ‰§è¡Œçš„æ–¹æ³•aå£°æ˜å¸¦invokeä¸­</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>        <span class="hljs-comment">//ä»£ç†ç±»å¯¹è±¡è°ƒç”¨çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯è¢«ä»£ç†ç±»å³å°†è°ƒç”¨çš„æ–¹æ³•ã€‚</span><br>        <span class="hljs-comment">//object:è¢«ä»£ç†ç±»å¯¹è±¡</span><br>        Object returnValue = method.invoke(object, args);<br>        <span class="hljs-comment">//ä¸Šè¿°æ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯ä½œä¸ºå½“å‰ç±»ä¸­çš„invokeï¼ˆï¼‰å€¼</span><br>        <span class="hljs-keyword">return</span> returnValue;<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="äº”ã€å¯¹è±¡æ‹·è´">äº”ã€å¯¹è±¡æ‹·è´</h3><h4 id="61-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å…‹éš†ï¼Ÿ">61.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å…‹éš†ï¼Ÿ</h4><p>å…‹éš†çš„å¯¹è±¡å¯èƒ½åŒ…å«ä¸€äº›å·²ç»ä¿®æ”¹è¿‡çš„å±æ€§ï¼Œè€Œ new å‡ºæ¥çš„å¯¹è±¡çš„å±æ€§éƒ½è¿˜æ˜¯åˆå§‹åŒ–æ—¶å€™çš„å€¼ï¼Œæ‰€ä»¥å½“éœ€è¦ä¸€ä¸ªæ–°çš„å¯¹è±¡æ¥ä¿å­˜å½“å‰å¯¹è±¡çš„â€œçŠ¶æ€â€å°±é å…‹éš†æ–¹æ³•äº†ã€‚</p><h4 id="62-å¦‚ä½•å®ç°å¯¹è±¡å…‹éš†ï¼Ÿ">62.å¦‚ä½•å®ç°å¯¹è±¡å…‹éš†ï¼Ÿ</h4><ul><li>å®ç° Cloneable æ¥å£å¹¶é‡å†™ Object ç±»ä¸­çš„ clone()æ–¹æ³•ã€‚</li><li>å®ç° Serializable æ¥å£ï¼Œé€šè¿‡å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°å…‹éš†ï¼Œå¯ä»¥å®ç°çœŸæ­£çš„æ·±åº¦å…‹éš†ã€‚</li></ul><h4 id="63-æ·±æ‹·è´å’Œæµ…æ‹·è´åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">63.æ·±æ‹·è´å’Œæµ…æ‹·è´åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>æµ…å…‹éš†ï¼šå½“å¯¹è±¡è¢«å¤åˆ¶æ—¶åªå¤åˆ¶å®ƒæœ¬èº«å’Œå…¶ä¸­åŒ…å«çš„å€¼ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œè€Œå¼•ç”¨ç±»å‹çš„æˆå‘˜å¯¹è±¡å¹¶æ²¡æœ‰å¤åˆ¶ã€‚</li><li>æ·±å…‹éš†ï¼šé™¤äº†å¯¹è±¡æœ¬èº«è¢«å¤åˆ¶å¤–ï¼Œå¯¹è±¡æ‰€åŒ…å«çš„æ‰€æœ‰æˆå‘˜å˜é‡ä¹Ÿå°†å¤åˆ¶ã€‚</li></ul><h3 id="å…­ã€Java-Web">å…­ã€Java Web</h3><h4 id="64-jsp-å’Œ-servlet-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">64.jsp å’Œ servlet æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ol><li>Servletæ˜¯ä¸€ç§æœåŠ¡å™¨ç«¯çš„Javaç¨‹åºï¼Œæ‹…å½“å®¢æˆ·ç«¯è¯·æ±‚ä¸æœåŠ¡å™¨ç«¯å“åº”çš„ä¸­é—´å±‚ã€‚Servletç”±webæœåŠ¡å™¨ç«¯è¿›è¡ŒåŠ è½½ã€‚</li><li>JSPæ˜¯ä¸€ç§åŠ¨æ€é¡µé¢è®¾è®¡ï¼Œä¸»è¦ç›®çš„æ˜¯å°†è¡¨ç¤ºé€»è¾‘ä»Servletä¸­åˆ†ç¦»å‡ºæ¥ã€‚</li></ol><p>jsp æ˜¯ servlet æŠ€æœ¯çš„æ‰©å±•ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ servlet çš„ç®€æ˜“æ–¹å¼ã€‚servlet å’Œ jsp æœ€ä¸»è¦çš„ä¸åŒç‚¹åœ¨äºï¼Œservlet çš„åº”ç”¨é€»è¾‘æ˜¯åœ¨ java æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å®Œå…¨ä»è¡¨ç¤ºå±‚ä¸­çš„ html é‡Œåˆ†ç¦»å¼€æ¥ï¼Œè€Œ jsp çš„æƒ…å†µæ˜¯ java å’Œ html å¯ä»¥ç»„åˆæˆä¸€ä¸ªæ‰©å±•åä¸º jsp çš„æ–‡ä»¶ã€‚jspä»£ç ç»è¿‡webå®¹å™¨çš„ç¼–è¯‘å°±èƒ½å˜æˆJVMè¯†åˆ«çš„javaç±»ã€‚</p><ol><li>jsp ä¾§é‡äºè§†å›¾ï¼Œservlet ä¸»è¦ç”¨äºæ§åˆ¶é€»è¾‘</li><li>JSPä¸­çš„å†…ç½®å¯¹è±¡éƒ½æ˜¯å¿…é¡»é€šè¿‡HttpServletRequestå¯¹è±¡ï¼ŒHttpServletResponseå¯¹è±¡ä»¥åŠHttpServletå¯¹è±¡å¾—åˆ°ã€‚</li></ol><h4 id="65-jsp-æœ‰å“ªäº›å†…ç½®å¯¹è±¡ï¼Ÿä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">65.jsp æœ‰å“ªäº›å†…ç½®å¯¹è±¡ï¼Ÿä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>jsp æœ‰ 9 å¤§å†…ç½®å¯¹è±¡ï¼š</p><ul><li>HttpServletRequetç±»çš„Requestå¯¹è±¡ï¼šä»£è¡¨è¯·æ±‚å¯¹è±¡ï¼Œä¸»è¦ç”¨äºæ¥å—å®¢æˆ·ç«¯é€šè¿‡HTTPåè®®è¿æ¥ä¼ è¾“æœåŠ¡å™¨ç«¯çš„æ•°æ®ï¼›</li><li>HttpSevletResponseç±»çš„Responseå¯¹è±¡ï¼šä»£è¡¨å“åº”å¯¹è±¡ï¼Œä¸»è¦ç”¨äºå‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼›</li><li>PageContextç±»çš„PageContextå¯¹è±¡ï¼šç®¡ç†ç½‘é¡µå±æ€§ï¼Œä¸ºjspé¡µé¢åŒ…è£…é¡µé¢çš„ä¸Šä¸‹æ–‡ï¼Œç®¡ç†å¯¹å±äºjspçš„ç‰¹æ®Šå¯è§éƒ¨åˆ†ä¸­å·²ç»å‘½åå¯¹è±¡çš„è®¿é—®ï¼Œå®ƒçš„åˆ›å»ºå’Œåˆå§‹åŒ–éƒ½æ˜¯ç”±å®¹å™¨æ¥å®Œæˆçš„ï¼›</li><li>HttpSessionç±»çš„sessionå¯¹è±¡ï¼šä¸»è¦ç”¨æ¥åˆ†åˆ«ä¿å­˜æ¯ä¸ªæœˆçš„ä¿¡æ¯ä¸è¯·æ±‚å…³è”çš„ä¼šè¯ï¼›ä¼šè¯çŠ¶æ€çš„ç»´æŒæ˜¯webåº”ç”¨å¼€å‘è€…å¿…é¡»é¢å¯¹çš„é—®é¢˜ï¼›</li><li>ServletContextç±»çš„applicationå¯¹è±¡ï¼šä¸»è¦ç”¨äºä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œä»£ç ç‰‡æ®µçš„è¿è¡Œç¯å¢ƒï¼›å®ƒæ˜¯ä¸€ä¸ªå…±äº«çš„å†…ç½®å¯¹è±¡ï¼Œå³ä¸€ä¸ªå®¹å™¨ä¸­çš„å¤šä¸ªç”¨æˆ·å…±äº«ä¸€ä¸ªapplicationï¼›</li><li>JspWriterç±»çš„outå¯¹è±¡ï¼šä¸»è¦ç”¨äºå‘å®¢æˆ·ç«¯è¾“å‡ºæ•°æ®ï¼Œoutçš„åŸºç±»æ˜¯jspWriterï¼›</li><li>ServletConfigç±»çš„Configå¯¹è±¡ï¼šä»£ç ç‰‡æ®µé…ç½®å¯¹è±¡ï¼Œæ ‡è¯†Servletçš„é…ç½®ï¼›</li><li>Objectç±»çš„Pageå¯¹è±¡ï¼šå¤„ç†jspé¡µé¢ï¼Œæ˜¯objectç±»çš„ä¸€ä¸ªå®ä¾‹ï¼ŒæŒ‡çš„æ˜¯jspå®ç°ç±»çš„å®ä¾‹ï¼›</li><li>Exceptionï¼šå¤„ç†jspæ–‡ä»¶æ‰§è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯å’Œå¼‚å¸¸ï¼Œåªæœ‰åœ¨é”™è¯¯é¡µé¢é‡Œæ‰ä½¿ç”¨ï¼Œå‰ææ˜¯åœ¨é¡µé¢æŒ‡ä»¤é‡Œè¦æœ‰isErrorPage=trueã€‚ã€‚</li></ul><h4 id="66-è¯´ä¸€ä¸‹-jsp-çš„-4-ç§ä½œç”¨åŸŸï¼Ÿ">66.è¯´ä¸€ä¸‹ jsp çš„ 4 ç§ä½œç”¨åŸŸï¼Ÿ</h4><ul><li>pageï¼šä»£è¡¨ä¸ä¸€ä¸ªé¡µé¢ç›¸å…³çš„å¯¹è±¡å’Œå±æ€§ã€‚</li><li>requestï¼šä»£è¡¨ä¸å®¢æˆ·ç«¯å‘å‡ºçš„ä¸€ä¸ªè¯·æ±‚ç›¸å…³çš„å¯¹è±¡å’Œå±æ€§ã€‚ä¸€ä¸ªè¯·æ±‚å¯èƒ½è·¨è¶Šå¤šä¸ªé¡µé¢ï¼Œæ¶‰åŠå¤šä¸ª web ç»„ä»¶ï¼›éœ€è¦åœ¨é¡µé¢æ˜¾ç¤ºçš„ä¸´æ—¶æ•°æ®å¯ä»¥ç½®äºæ­¤ä½œç”¨åŸŸã€‚</li><li>sessionï¼šä»£è¡¨ä¸æŸä¸ªç”¨æˆ·ä¸æœåŠ¡å™¨å»ºç«‹çš„ä¸€æ¬¡ä¼šè¯ç›¸å…³çš„å¯¹è±¡å’Œå±æ€§ã€‚è·ŸæŸä¸ªç”¨æˆ·ç›¸å…³çš„æ•°æ®åº”è¯¥æ”¾åœ¨ç”¨æˆ·è‡ªå·±çš„ session ä¸­ã€‚</li><li>applicationï¼šä»£è¡¨ä¸æ•´ä¸ª web åº”ç”¨ç¨‹åºç›¸å…³çš„å¯¹è±¡å’Œå±æ€§ï¼Œå®ƒå®è´¨ä¸Šæ˜¯è·¨è¶Šæ•´ä¸ª web åº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬å¤šä¸ªé¡µé¢ã€è¯·æ±‚å’Œä¼šè¯çš„ä¸€ä¸ªå…¨å±€ä½œç”¨åŸŸã€‚</li></ul><h4 id="67-session-å’Œ-cookie-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">67.session å’Œ cookie æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>å­˜å‚¨ä½ç½®ä¸åŒï¼šsession å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼›cookie å­˜å‚¨åœ¨æµè§ˆå™¨ç«¯ã€‚</li><li>å®‰å…¨æ€§ä¸åŒï¼šcookie å®‰å…¨æ€§ä¸€èˆ¬ï¼Œåœ¨æµè§ˆå™¨å­˜å‚¨ï¼Œå¯ä»¥è¢«ä¼ªé€ å’Œä¿®æ”¹ã€‚</li><li>å®¹é‡å’Œä¸ªæ•°é™åˆ¶ï¼šcookie æœ‰å®¹é‡é™åˆ¶&lt;=4KBï¼Œä¸€ä¸ªç«™ç‚¹ä¸‹çš„ cookie æœ€å¤šå­˜20ä¸ªcookieã€‚</li><li>å­˜å‚¨çš„å¤šæ ·æ€§ï¼šsession å¯ä»¥å­˜å‚¨åœ¨ redis ä¸­ã€æ•°æ®åº“ä¸­ã€åº”ç”¨ç¨‹åºä¸­ï¼›è€Œ cookie åªèƒ½å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ã€‚</li><li>æœ‰æ•ˆæœŸä¸åŒï¼šå¼€å‘å¯ä»¥é€šè¿‡è®¾ç½®cookieçš„å±æ€§ï¼Œè¾¾åˆ°ä½¿cookieé•¿æœŸæœ‰æ•ˆçš„æ•ˆæœã€‚sessionä¾èµ–äºåä¸ºJSESSIONIDçš„cookieï¼Œè€Œcookie JSESSIONIDçš„è¿‡æœŸæ—¶é—´é»˜è®¤ä¸º-1ï¼Œåªéœ€å…³é—­çª—å£è¯¥sessionå°±ä¼šå¤±æ•ˆï¼Œå› è€Œsessionä¸èƒ½è¾¾åˆ°é•¿æœŸæœ‰æ•ˆçš„æ•ˆæœã€‚</li><li>è·¨åŸŸæ”¯æŒä¸Šä¸åŒï¼šcookieæ”¯æŒè·¨åŸŸè®¿é—®ï¼Œsessionä¸æ”¯æŒè·¨åŸŸè®¿é—®ã€‚</li></ul><h4 id="68-è¯´ä¸€ä¸‹-session-çš„å·¥ä½œåŸç†ï¼Ÿ">68.è¯´ä¸€ä¸‹ session çš„å·¥ä½œåŸç†ï¼Ÿ</h4><p><img src="https://img-blog.csdnimg.cn/20200422094415521.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzM2MTg0MDc1,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰§è¡Œæµç¨‹ï¼š</p><ol><li>ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œè¯·æ±‚å¤´ä¸­æ²¡æœ‰jsessionidçš„cookieï¼Œå½“è®¿é—®åˆ°å¯¹åº”çš„servletèµ„æºæ—¶ï¼Œæ‰§è¡Œåˆ°getSession()ä¼šåˆ›å»ºHttpSessionå¯¹è±¡ï¼›è¿›è€Œå“åº”æ—¶å°±å°†sessionçš„idä½œä¸ºcookieçš„valueï¼Œå“åº”åˆ°æµè§ˆå™¨ Set-cookie:jsessionid=xxxx;</li><li>å†ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œhttpè¯·æ±‚ä¸­å°±æœ‰ä¸€ä¸ªcookie:jsessionid=xxxxä¿¡æ¯ï¼Œé‚£ä¹ˆè¯¥servletå°±å¯ä»¥é€šè¿‡getSession()è·å–åˆ°jsessionidåœ¨æœåŠ¡å™¨å†…æŸ¥æ‰¾å¯¹åº”çš„sessionå¯¹è±¡ï¼Œæœ‰å°±ä½¿ç”¨ï¼Œæ— å°±åˆ›å»ºã€‚</li></ol><p>ç”Ÿå‘½å‘¨æœŸï¼š</p><p>â€‹ä¸€èˆ¬éƒ½æ˜¯é»˜è®¤30minï¼Œå–å†³äºtomcatä¸­çš„web.xmlæ–‡ä»¶é‡Œçš„è®¾ç½®</p><p>â€‹ç»“æŸæ—¶æœºï¼š</p><ul><li>æµè§ˆå™¨å…³é—­ï¼šé”€æ¯cookieä¸­çš„jsessionid=xxx</li><li>sessioné”€æ¯ï¼šä¸»åŠ¨è°ƒç”¨session.invalidate()æ–¹æ³•åï¼Œç«‹å³å°†sessionå¯¹è±¡é”€æ¯ã€‚</li></ul><h4 id="69-å¦‚æœå®¢æˆ·ç«¯ç¦æ­¢-cookie-èƒ½å®ç°-session-è¿˜èƒ½ç”¨å—ï¼Ÿ">69.å¦‚æœå®¢æˆ·ç«¯ç¦æ­¢ cookie èƒ½å®ç° session è¿˜èƒ½ç”¨å—ï¼Ÿ</h4><p>å¯ä»¥ç”¨ï¼Œsession åªæ˜¯ä¾èµ– cookie å­˜å‚¨ sessionidï¼Œå¦‚æœ cookie è¢«ç¦ç”¨äº†ï¼Œå¯ä»¥ä½¿ç”¨ url ä¸­æ·»åŠ  sessionid çš„æ–¹å¼ä¿è¯ session èƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p><h4 id="70-spring-mvc-å’Œ-struts-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">70.spring mvc å’Œ struts çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>æ‹¦æˆªçº§åˆ«ï¼šstruts2 æ˜¯ç±»çº§åˆ«çš„æ‹¦æˆªï¼›spring mvc æ˜¯æ–¹æ³•çº§åˆ«çš„æ‹¦æˆªã€‚</li><li>æ•°æ®ç‹¬ç«‹æ€§ï¼šspring mvc çš„æ–¹æ³•ä¹‹é—´åŸºæœ¬ä¸Šç‹¬ç«‹çš„ï¼Œç‹¬äº« request å’Œ response æ•°æ®ï¼Œè¯·æ±‚æ•°æ®é€šè¿‡å‚æ•°è·å–ï¼Œå¤„ç†ç»“æœé€šè¿‡ ModelMap äº¤å›ç»™æ¡†æ¶ï¼Œæ–¹æ³•ä¹‹é—´ä¸å…±äº«å˜é‡ï¼›è€Œ struts2 è™½ç„¶æ–¹æ³•ä¹‹é—´ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼Œä½†å…¶æ‰€æœ‰ action å˜é‡æ˜¯å…±äº«çš„ï¼Œè¿™ä¸ä¼šå½±å“ç¨‹åºè¿è¡Œï¼Œå´ç»™æˆ‘ä»¬ç¼–ç å’Œè¯»ç¨‹åºæ—¶å¸¦æ¥äº†ä¸€å®šçš„éº»çƒ¦ã€‚</li><li>æ‹¦æˆªæœºåˆ¶ï¼šstruts2 æœ‰ä»¥è‡ªå·±çš„ interceptor æœºåˆ¶ï¼Œspring mvc ç”¨çš„æ˜¯ç‹¬ç«‹çš„ aop æ–¹å¼ï¼Œè¿™æ ·å¯¼è‡´struts2 çš„é…ç½®æ–‡ä»¶é‡æ¯” spring mvc å¤§ã€‚</li><li>å¯¹ ajax çš„æ”¯æŒï¼šspring mvc é›†æˆäº†ajaxï¼Œæ‰€ä»¥ ajax ä½¿ç”¨å¾ˆæ–¹ä¾¿ï¼Œåªéœ€è¦ä¸€ä¸ªæ³¨è§£ @ResponseBody å°±å¯ä»¥å®ç°äº†ï¼›è€Œ struts2 ä¸€èˆ¬éœ€è¦å®‰è£…æ’ä»¶æˆ–è€…è‡ªå·±å†™ä»£ç æ‰è¡Œã€‚</li></ul><h4 id="71-å¦‚ä½•é¿å…-sql-æ³¨å…¥ï¼Ÿ">71.å¦‚ä½•é¿å… sql æ³¨å…¥ï¼Ÿ</h4><ul><li>ä½¿ç”¨é¢„å¤„ç† PreparedStatementã€‚</li><li>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤æ‰å­—ç¬¦ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚</li></ul><h4 id="72-ä»€ä¹ˆæ˜¯-XSS-æ”»å‡»ï¼Œå¦‚ä½•é¿å…ï¼Ÿ">72.ä»€ä¹ˆæ˜¯ XSS æ”»å‡»ï¼Œå¦‚ä½•é¿å…ï¼Ÿ</h4><p>XSS æ”»å‡»ï¼šå³è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œå®ƒæ˜¯ web ç¨‹åºä¸­å¸¸è§çš„æ¼æ´ã€‚åŸç†æ˜¯æ”»å‡»è€…å¾€ web é¡µé¢é‡Œæ’å…¥æ¶æ„çš„è„šæœ¬ä»£ç ï¼ˆcss ä»£ç ã€javascript ä»£ç ç­‰ï¼‰ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µé¢æ—¶ï¼ŒåµŒå…¥å…¶ä¸­çš„è„šæœ¬ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ï¼Œå¦‚ç›—å–ç”¨æˆ· cookieã€ç ´åé¡µé¢ç»“æ„ã€é‡å®šå‘åˆ°å…¶ä»–ç½‘ç«™ç­‰ã€‚</p><p>é¢„é˜² XSS çš„æ ¸å¿ƒæ˜¯å¿…é¡»å¯¹è¾“å…¥çš„æ•°æ®åšè¿‡æ»¤å¤„ç†ã€‚</p><h4 id="73-ä»€ä¹ˆæ˜¯-CSRF-æ”»å‡»ï¼Œå¦‚ä½•é¿å…ï¼Ÿ">73.ä»€ä¹ˆæ˜¯ CSRF æ”»å‡»ï¼Œå¦‚ä½•é¿å…ï¼Ÿ</h4><p>CSRFï¼šCross-Site Request Forgeryï¼ˆä¸­æ–‡ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ï¼Œå¯ä»¥ç†è§£ä¸ºæ”»å‡»è€…ç›—ç”¨äº†ä½ çš„èº«ä»½ï¼Œä»¥ä½ çš„åä¹‰å‘é€æ¶æ„è¯·æ±‚ï¼Œæ¯”å¦‚ï¼šä»¥ä½ åä¹‰å‘é€é‚®ä»¶ã€å‘æ¶ˆæ¯ã€è´­ä¹°å•†å“ï¼Œè™šæ‹Ÿè´§å¸è½¬è´¦ç­‰ã€‚</p><p>é˜²å¾¡æ‰‹æ®µï¼š</p><ul><li>éªŒè¯è¯·æ±‚æ¥æºåœ°å€ï¼›</li><li>å…³é”®æ“ä½œæ·»åŠ éªŒè¯ç ï¼›</li><li>åœ¨è¯·æ±‚åœ°å€æ·»åŠ  token å¹¶éªŒè¯ã€‚</li></ul><h3 id="ä¸ƒã€å¼‚å¸¸">ä¸ƒã€å¼‚å¸¸</h3><h4 id="74-throw-å’Œ-throws-çš„åŒºåˆ«ï¼Ÿ">74.throw å’Œ throws çš„åŒºåˆ«ï¼Ÿ</h4><ul><li>throwï¼šæ˜¯çœŸå®æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</li><li>throwsï¼šæ˜¯å£°æ˜å¯èƒ½ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</li></ul><h4 id="75-finalã€finallyã€finalize-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">75.finalã€finallyã€finalize æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>finalï¼šæ˜¯ä¿®é¥°ç¬¦ï¼Œå¦‚æœä¿®é¥°ç±»ï¼Œæ­¤ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼›å¦‚æœä¿®é¥°æ–¹æ³•å’Œå˜é‡ï¼Œåˆ™è¡¨ç¤ºæ­¤æ–¹æ³•å’Œæ­¤å˜é‡ä¸èƒ½åœ¨è¢«æ”¹å˜ï¼Œåªèƒ½ä½¿ç”¨ã€‚</li><li>finallyï¼šæ˜¯ try{} catch{} finally{} æœ€åä¸€éƒ¨åˆ†ï¼Œè¡¨ç¤ºä¸è®ºå‘ç”Ÿä»»ä½•æƒ…å†µéƒ½ä¼šæ‰§è¡Œï¼Œfinally éƒ¨åˆ†å¯ä»¥çœç•¥ï¼Œä½†å¦‚æœ finally éƒ¨åˆ†å­˜åœ¨ï¼Œåˆ™ä¸€å®šä¼šæ‰§è¡Œ finally é‡Œé¢çš„ä»£ç ã€‚</li><li>finalizeï¼š æ˜¯ Object ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨åƒåœ¾æ”¶é›†å™¨æ‰§è¡Œçš„æ—¶å€™ä¼šè°ƒç”¨è¢«å›æ”¶å¯¹è±¡çš„æ­¤æ–¹æ³•ã€‚</li></ul><h4 id="76-try-catch-finally-ä¸­å“ªä¸ªéƒ¨åˆ†å¯ä»¥çœç•¥ï¼Ÿ">76.try-catch-finally ä¸­å“ªä¸ªéƒ¨åˆ†å¯ä»¥çœç•¥ï¼Ÿ</h4><p>try-catch-finally å…¶ä¸­ catch å’Œ finally éƒ½å¯ä»¥è¢«çœç•¥ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶çœç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰ try çš„æ—¶å€™ï¼Œå¿…é¡»åé¢è·Ÿä¸€ä¸ª catch æˆ–è€… finallyã€‚</p><h4 id="77-try-catch-finally-ä¸­ï¼Œå¦‚æœ-catch-ä¸­-return-äº†ï¼Œfinally-è¿˜ä¼šæ‰§è¡Œå—ï¼Ÿ">77.try-catch-finally ä¸­ï¼Œå¦‚æœ catch ä¸­ return äº†ï¼Œfinally è¿˜ä¼šæ‰§è¡Œå—ï¼Ÿ</h4><p>finally ä¸€å®šä¼šæ‰§è¡Œï¼Œå³ä½¿æ˜¯ catch ä¸­ return äº†ï¼Œcatch ä¸­çš„ return ä¼šç­‰ finally ä¸­çš„ä»£ç æ‰§è¡Œå®Œä¹‹åï¼Œæ‰ä¼šæ‰§è¡Œã€‚</p><h4 id="78-å¸¸è§çš„å¼‚å¸¸ç±»æœ‰å“ªäº›ï¼Ÿ">78.å¸¸è§çš„å¼‚å¸¸ç±»æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>NullPointerException ç©ºæŒ‡é’ˆå¼‚å¸¸</li><li>ClassNotFoundException æŒ‡å®šç±»ä¸å­˜åœ¨</li><li>NumberFormatException å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—å¼‚å¸¸</li><li>IndexOutOfBoundsException æ•°ç»„ä¸‹æ ‡è¶Šç•Œå¼‚å¸¸</li><li>ClassCastException æ•°æ®ç±»å‹è½¬æ¢å¼‚å¸¸</li><li>FileNotFoundException æ–‡ä»¶æœªæ‰¾åˆ°å¼‚å¸¸</li><li>NoSuchMethodException æ–¹æ³•ä¸å­˜åœ¨å¼‚å¸¸</li><li>IOException IO å¼‚å¸¸</li><li>SocketException Socket å¼‚å¸¸</li></ul><h3 id="å…«ã€ç½‘ç»œ">å…«ã€ç½‘ç»œ</h3><h4 id="79-http-å“åº”ç -301-å’Œ-302-ä»£è¡¨çš„æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">79.http å“åº”ç  301 å’Œ 302 ä»£è¡¨çš„æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>301ï¼šæ°¸ä¹…é‡å®šå‘ã€‚</p><p>302ï¼šæš‚æ—¶é‡å®šå‘ã€‚</p><p>å®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼Œ301 å¯¹æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰æ›´åŠ æœ‰åˆ©ï¼›302 æœ‰è¢«æç¤ºä¸ºç½‘ç»œæ‹¦æˆªçš„é£é™©ã€‚</p><h4 id="80-forward-å’Œ-redirect-çš„åŒºåˆ«ï¼Ÿ">80.forward å’Œ redirect çš„åŒºåˆ«ï¼Ÿ</h4><p>forward æ˜¯è½¬å‘ å’Œ redirect æ˜¯é‡å®šå‘ï¼š</p><ul><li>åœ°å€æ  url æ˜¾ç¤ºï¼šfoward url ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œredirect url ä¼šå‘ç”Ÿæ”¹å˜ï¼›</li><li>æ•°æ®å…±äº«ï¼šforward å¯ä»¥å…±äº« request é‡Œçš„æ•°æ®ï¼Œredirect ä¸èƒ½å…±äº«ï¼›</li><li>æ•ˆç‡ï¼šforward æ¯” redirect æ•ˆç‡é«˜ã€‚</li></ul><h4 id="81-ç®€è¿°-tcp-å’Œ-udpçš„åŒºåˆ«ï¼Ÿ">81.ç®€è¿° tcp å’Œ udpçš„åŒºåˆ«ï¼Ÿ</h4><p>tcp å’Œ udp æ˜¯ OSI æ¨¡å‹ä¸­çš„è¿è¾“å±‚ä¸­çš„åè®®ã€‚tcp æä¾›å¯é çš„é€šä¿¡ä¼ è¾“ï¼Œè€Œ udp åˆ™å¸¸è¢«ç”¨äºè®©å¹¿æ’­å’Œç»†èŠ‚æ§åˆ¶äº¤ç»™åº”ç”¨çš„é€šä¿¡ä¼ è¾“ã€‚</p><p>ä¸¤è€…çš„åŒºåˆ«å¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li>tcp é¢å‘è¿æ¥ï¼Œudp é¢å‘éè¿æ¥å³å‘é€æ•°æ®å‰ä¸éœ€è¦å»ºç«‹é“¾æ¥ï¼›</li><li>tcp æä¾›å¯é çš„æœåŠ¡ï¼ˆæ•°æ®ä¼ è¾“ï¼‰ï¼Œudp æ— æ³•ä¿è¯ï¼›</li><li>tcp é¢å‘å­—èŠ‚æµï¼Œudp é¢å‘æŠ¥æ–‡ï¼›</li><li>tcp æ•°æ®ä¼ è¾“æ…¢ï¼Œudp æ•°æ®ä¼ è¾“å¿«ï¼›</li></ul><ol><li><p><strong>TCPè¯¦è§£</strong></p><p><a href="https://blog.csdn.net/sinat_36629696/article/details/80740678">https://blog.csdn.net/sinat_36629696/article/details/80740678</a></p><p><img src="https://img-blog.csdn.net/20180620002403691?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzM2NjI5Njk2/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Alt text"></p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">URG:</span> æ ‡è¯†ç´§æ€¥æŒ‡é’ˆæ˜¯å¦æœ‰æ•ˆ<br><span class="hljs-symbol">ACK:</span> æ ‡è¯†ç¡®è®¤åºå·æ˜¯å¦æœ‰æ•ˆ<br><span class="hljs-symbol">PSH:</span> ç”¨æ¥æç¤ºæ¥æ”¶ç«¯åº”ç”¨ç¨‹åºç«‹åˆ»å°†æ•°æ®ä»tcpç¼“å†²åŒºè¯»èµ°<br><span class="hljs-symbol">RST:</span> è¦æ±‚é‡æ–°å»ºç«‹è¿æ¥. æˆ‘ä»¬æŠŠå«æœ‰RSTæ ‡è¯†çš„æŠ¥æ–‡ç§°ä¸ºå¤ä½æŠ¥æ–‡æ®µ<br><span class="hljs-symbol">SYN:</span> è¯·æ±‚å»ºç«‹è¿æ¥. æˆ‘ä»¬æŠŠå«æœ‰SYNæ ‡è¯†çš„æŠ¥æ–‡ç§°ä¸ºåŒæ­¥æŠ¥æ–‡æ®µ<br><span class="hljs-symbol">FIN:</span> é€šçŸ¥å¯¹ç«¯, æœ¬ç«¯å³å°†å…³é—­. æˆ‘ä»¬æŠŠå«æœ‰FINæ ‡è¯†çš„æŠ¥æ–‡ç§°ä¸ºç»“æŸæŠ¥æ–‡æ®µ<br></code></pre></td></tr></table></figure><p><img src="C:%5CUsers%5C13126%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210517141753451.png" alt="image-20210517141753451"><strong>ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹åŸç†</strong>ï¼š</p><ul><li>TCPæœåŠ¡å™¨è¿›ç¨‹å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶å—TCB, æ—¶åˆ»å‡†å¤‡æ¥å—å®¢æˆ·ç«¯è¿›ç¨‹çš„è¿æ¥è¯·æ±‚, æ­¤æ—¶æœåŠ¡å™¨å°±è¿›å…¥äº† LISTENï¼ˆç›‘å¬ï¼‰çŠ¶æ€</li><li>TCPå®¢æˆ·ç«¯è¿›ç¨‹ä¹Ÿæ˜¯å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶å—TCB, ç„¶åå‘æœåŠ¡å™¨å‘å‡ºè¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œæ­¤æ—¶æŠ¥æ–‡é¦–éƒ¨ä¸­çš„åŒæ­¥æ ‡å¿—ä½SYN=1, åŒæ—¶é€‰æ‹©ä¸€ä¸ªåˆå§‹åºåˆ—å· seq = x, æ­¤æ—¶ï¼ŒTCPå®¢æˆ·ç«¯è¿›ç¨‹è¿›å…¥äº† SYN-SENTï¼ˆåŒæ­¥å·²å‘é€çŠ¶æ€ï¼‰çŠ¶æ€ã€‚TCPè§„å®š, SYNæŠ¥æ–‡æ®µï¼ˆSYN=1çš„æŠ¥æ–‡æ®µï¼‰ä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†éœ€è¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·ã€‚</li><li>TCPæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æŠ¥æ–‡å, å¦‚æœåŒæ„è¿æ¥, åˆ™å‘å‡ºç¡®è®¤æŠ¥æ–‡ã€‚ç¡®è®¤æŠ¥æ–‡ä¸­çš„ ACK=1, SYN=1, ç¡®è®¤åºå·æ˜¯ x+1, åŒæ—¶ä¹Ÿè¦ä¸ºè‡ªå·±åˆå§‹åŒ–ä¸€ä¸ªåºåˆ—å· seq = y, æ­¤æ—¶, TCPæœåŠ¡å™¨è¿›ç¨‹è¿›å…¥äº†SYN-RCVDï¼ˆåŒæ­¥æ”¶åˆ°ï¼‰çŠ¶æ€ã€‚è¿™ä¸ªæŠ¥æ–‡ä¹Ÿä¸èƒ½æºå¸¦æ•°æ®, ä½†æ˜¯åŒæ ·è¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚</li><li>TCPå®¢æˆ·ç«¯è¿›ç¨‹æ”¶åˆ°ç¡®è®¤åè¿˜, è¦å‘æœåŠ¡å™¨ç»™å‡ºç¡®è®¤ã€‚ç¡®è®¤æŠ¥æ–‡çš„ACK=1ï¼Œç¡®è®¤åºå·æ˜¯ y+1ï¼Œè‡ªå·±çš„åºåˆ—å·æ˜¯ x+1</li><li>æ­¤æ—¶ï¼ŒTCPè¿æ¥å»ºç«‹ï¼Œå®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDï¼ˆå·²å»ºç«‹è¿æ¥ï¼‰çŠ¶æ€ã€‚å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¡®è®¤åä¹Ÿè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œæ­¤ååŒæ–¹å°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚</li></ul><p><img src="C:%5CUsers%5C13126%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210517143200048.png" alt="image-20210517143200048"></p><p><strong>å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹åŸç†</strong>ï¼š</p><p>æ•°æ®ä¼ è¾“å®Œæ¯•åï¼ŒåŒæ–¹éƒ½å¯ä»¥é‡Šæ”¾è¿æ¥.<br>æ­¤æ—¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ˜¯å¤„äºESTABLISHEDçŠ¶æ€ï¼Œç„¶åå®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥ï¼ŒæœåŠ¡å™¨è¢«åŠ¨æ–­å¼€è¿æ¥.</p><ul><li>å®¢æˆ·ç«¯è¿›ç¨‹å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚<br>é‡Šæ”¾æ•°æ®æŠ¥æ–‡é¦–éƒ¨ï¼ŒFIN=1ï¼Œå…¶åºåˆ—å·ä¸ºseq=uï¼ˆç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ã€‚ TCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚</li><li>æœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK=1ï¼Œç¡®è®¤åºå·ä¸º u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq=vï¼Œæ­¤æ—¶æœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚<br>TCPæœåŠ¡å™¨é€šçŸ¥é«˜å±‚çš„åº”ç”¨è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„æ–¹å‘å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªCLOSE-WAITçŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€ç»ˆæ•°æ®ï¼‰</li><li>æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ï¼Œç¡®è®¤åºå·ä¸ºv+1ï¼Œç”±äºåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸ºseq=wï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡å™¨å°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤</li><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œå¿…é¡»å‘å‡ºç¡®è®¤ï¼ŒACK=1ï¼Œç¡®è®¤åºå·ä¸ºw+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ³¨æ„æ­¤æ—¶TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2âˆ—MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚</li><li>æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼Œæ’¤é”€TCBåï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸTCPè¿æ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚</li></ul></li><li><p><strong>tcpåœ¨å››æ¬¡æŒ¥æ‰‹æ—¶ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç­‰å¾…2*MSLç§’å‘¢ï¼Ÿ</strong></p><ol><li>MSLï¼ˆMaximum Segment Lifetimeï¼‰ï¼ŒTCPå…è®¸ä¸åŒçš„å®ç°å¯ä»¥è®¾ç½®ä¸åŒçš„MSLå€¼ã€‚</li><li>ç¬¬ä¸€ï¼Œä¿è¯å®¢æˆ·ç«¯å‘é€çš„æœ€åä¸€ä¸ªACKæŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾æœåŠ¡å™¨ï¼Œå› ä¸ºè¿™ä¸ªACKæŠ¥æ–‡å¯èƒ½ä¸¢å¤±ï¼Œç«™åœ¨æœåŠ¡å™¨çš„è§’åº¦çœ‹æ¥ï¼Œæˆ‘å·²ç»å‘é€äº†FIN+ACKæŠ¥æ–‡è¯·æ±‚æ–­å¼€äº†ï¼Œå®¢æˆ·ç«¯è¿˜æ²¡æœ‰ç»™æˆ‘å›åº”ï¼Œåº”è¯¥æ˜¯æˆ‘å‘é€çš„è¯·æ±‚æ–­å¼€æŠ¥æ–‡å®ƒæ²¡æœ‰æ”¶åˆ°ï¼Œäºæ˜¯æœåŠ¡å™¨åˆä¼šé‡æ–°å‘é€ä¸€æ¬¡ï¼Œè€Œå®¢æˆ·ç«¯å°±èƒ½åœ¨è¿™ä¸ª2MSLæ—¶é—´æ®µå†…æ”¶åˆ°è¿™ä¸ªé‡ä¼ çš„æŠ¥æ–‡ï¼Œæ¥ç€ç»™å‡ºå›åº”æŠ¥æ–‡ï¼Œå¹¶ä¸”ä¼šé‡å¯2MSLè®¡æ—¶å™¨ã€‚</li><li>ç¬¬äºŒï¼Œé˜²æ­¢ç±»ä¼¼ä¸â€œä¸‰æ¬¡æ¡æ‰‹â€ä¸­æåˆ°äº†çš„â€œå·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µâ€å‡ºç°åœ¨æœ¬è¿æ¥ä¸­ã€‚å®¢æˆ·ç«¯å‘é€å®Œæœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡åï¼Œåœ¨è¿™ä¸ª2MSLæ—¶é—´ä¸­ï¼Œå°±å¯ä»¥ä½¿æœ¬è¿æ¥æŒç»­çš„æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ã€‚è¿™æ ·æ–°çš„è¿æ¥ä¸­ä¸ä¼šå‡ºç°æ—§è¿æ¥çš„è¯·æ±‚æŠ¥æ–‡ã€‚</li></ol></li><li><p><strong>tcpå…³é—­è¿æ¥ä¸ºä»€ä¹ˆä¼šæ¯”å»ºç«‹è¿æ¥å¤šä¸€æ¬¡å‘¢ï¼Ÿ</strong></p><ol><li>å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œ æœåŠ¡å™¨åœ¨LISTENçŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°å»ºç«‹è¿æ¥è¯·æ±‚çš„SYNæŠ¥æ–‡åï¼ŒæŠŠACKå’ŒSYNæ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚<br>è€Œå…³é—­è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ï¼Œè€Œè‡ªå·±ä¹Ÿæœªå¿…å…¨éƒ¨æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥å·±æ–¹å¯ä»¥ç«‹å³å…³é—­ï¼Œä¹Ÿå¯ä»¥å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹åï¼Œå†å‘é€FINæŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ï¼Œå› æ­¤ï¼Œå·±æ–¹ACKå’ŒFINä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œä»è€Œå¯¼è‡´å¤šäº†ä¸€æ¬¡ã€‚</li></ol></li><li><p><strong>å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯åˆå‘ç”Ÿäº†æ•…éšœæ€ä¹ˆåŠï¼Ÿ</strong></p><ol><li>TCPè®¾æœ‰ä¸€ä¸ªä¿æ´»è®¡æ—¶å™¨ï¼Œæ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯å¦‚æœå‡ºç°æ•…éšœï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸€ç›´ç­‰ä¸‹å»ï¼Œç™½ç™½æµªè´¹èµ„æºã€‚æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åéƒ½ä¼šé‡æ–°å¤ä½è¿™ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯è®¾ç½®ä¸º2å°æ—¶ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”75åˆ†é’Ÿå‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚</li></ol></li><li><p><strong>æ‹¥å¡æ§åˆ¶</strong></p><ol><li>TCPå¼•å…¥æ…¢å¯åŠ¨æœºåˆ¶ï¼Œå…ˆå‘å°‘é‡çš„æ•°æ®æ¢æ¢è·¯ï¼Œæ‘¸æ¸…å½“å‰çš„ç½‘ç»œæ‹¥å µæƒ…å†µä»¥åï¼Œåœ¨æŒ‰ç…§å¤šå¤§çš„é€Ÿåº¦ä¼ è¾“æ•°æ®ã€‚</li><li>æ‹¥å¡çª—å£ï¼šæ¯æ¥æ”¶åˆ°ä¸€æ¬¡ACKåº”ç­”ï¼Œæ‹¥å¡çª—å£å¤§å°+1</li><li>æ…¢å¯åŠ¨é˜ˆå€¼ï¼šå½“æ‹¥å¡çª—å£è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œæ”¹ä¸ºçº¿æ€§å¢åŠ çš„æ–¹å¼ã€‚å½“TCPå¯åŠ¨çš„æ—¶å€™ï¼Œæ…¢å¯åŠ¨é˜ˆå€¼ç­‰äºçª—å£æœ€å¤§å€¼ã€‚åœ¨æ¯æ¬¡è¶…æ—¶é‡å‘çš„æ—¶å€™ï¼Œæ…¢å¯åŠ¨é˜ˆå€¼ä¼šå˜ä¸ºåŸæ¥çš„ä¸€åŠï¼ŒåŒæ—¶æ‹¥å¡çª—å£ç½®ä¸º1</li></ol></li></ol><h4 id="82-tcp-ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡ä¸è¡Œå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ">82.tcp ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡ä¸è¡Œå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h4><p>â€‹      ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢å·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡çªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡å™¨ï¼Œä»è€Œäº§ç”Ÿé”™è¯¯ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯ä¸¤æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œå‡è®¾æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼Œå®¢æˆ·ç«¯å‘é€çš„ç¬¬ä¸€ä¸ªè¯·æ±‚è¿æ¥å¹¶ä¸”æ²¡æœ‰ä¸¢å¤±ï¼Œåªæ˜¯å› ä¸ºåœ¨ç½‘ç»œä¸­æ»ç•™çš„æ—¶é—´å¤ªé•¿äº†ï¼Œç”±äºTCPçš„å®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ï¼Œä»¥ä¸ºæœåŠ¡å™¨æ²¡æœ‰æ”¶åˆ°ï¼Œæ­¤æ—¶é‡æ–°å‘æœåŠ¡å™¨å‘é€è¿™æ¡æŠ¥æ–‡ï¼Œæ­¤åå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»è¿‡ä¸¤æ¬¡æ¡æ‰‹å®Œæˆè¿æ¥ï¼Œä¼ è¾“æ•°æ®ï¼Œç„¶åå…³é—­è¿æ¥ã€‚æ­¤æ—¶ä¹‹å‰æ»ç•™çš„é‚£ä¸€æ¬¡è¯·æ±‚è¿æ¥ï¼Œå› ä¸ºç½‘ç»œé€šç•…äº†, åˆ°è¾¾äº†æœåŠ¡å™¨ï¼Œè¿™ä¸ªæŠ¥æ–‡æœ¬è¯¥æ˜¯å¤±æ•ˆçš„ï¼Œä½†æ˜¯ï¼Œä¸¤æ¬¡æ¡æ‰‹çš„æœºåˆ¶å°†ä¼šè®©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å†æ¬¡å»ºç«‹è¿æ¥ï¼Œè¿™å°†å¯¼è‡´ä¸å¿…è¦çš„é”™è¯¯å’Œèµ„æºçš„è´¹ã€‚<br>â€‹     å¦‚æœé‡‡ç”¨çš„æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå°±ç®—æ˜¯é‚£ä¸€æ¬¡å¤±æ•ˆçš„æŠ¥æ–‡ä¼ é€è¿‡æ¥äº†ï¼ŒæœåŠ¡ç«¯æ¥å—åˆ°äº†é‚£æ¡å¤±æ•ˆæŠ¥æ–‡å¹¶ä¸”å›å¤äº†ç¡®è®¤æŠ¥æ–‡ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸ä¼šå†æ¬¡å‘å‡ºç¡®è®¤ã€‚ç”±äºæœåŠ¡å™¨æ”¶ä¸åˆ°ç¡®è®¤ï¼Œå°±çŸ¥é“å®¢æˆ·ç«¯å¹¶æ²¡æœ‰è¯·æ±‚è¿æ¥ã€‚</p><h4 id="83-tcpç²˜åŒ…äº§ç”Ÿçš„åŸå› ï¼Ÿ">83.tcpç²˜åŒ…äº§ç”Ÿçš„åŸå› ï¼Ÿ</h4><p>ç²˜åŒ…ï¼šæŒ‡çš„æ˜¯åº”ç”¨å±‚çš„æ•°æ®åŒ…ï¼ŒæŒ‡çš„æ˜¯ç«™åœ¨åº”ç”¨å±‚çš„è§’åº¦ï¼Œçœ‹åˆ°äº†å‘æ¥çš„ä¸€è¿ä¸²çš„å­—èŠ‚æ•°æ®ï¼Œå°±ä¸çŸ¥é“ä»å“ªä¸ªéƒ¨åˆ†å¼€å§‹ï¼Œåˆ°å“ªä¸ªéƒ¨åˆ†ç»“æŸæ˜¯ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨æ•°æ®åŒ…ã€‚æ­¤æ—¶æ•°æ®æ²¡æœ‰äº†è¾¹ç•Œï¼Œå°±äº§ç”Ÿäº†ç²˜åŒ…é—®é¢˜ã€‚</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">å¯¹äºå®šé•¿çš„åŒ…<br><span class="hljs-bullet">- </span>ä¿è¯æ¯æ¬¡éƒ½æŒ‰å›ºå®šå¤§å°è¯»å–å³å¯<br>ä¾‹å¦‚ä¸Šé¢çš„Requestç»“æ„, æ˜¯å›ºå®šå¤§å°çš„, é‚£ä¹ˆå°±ä»ç¼“å†²åŒºä»å¤´å¼€å§‹æŒ‰sizeof(Request)ä¾æ¬¡è¯»å–å³å¯<br><br>å¯¹äºå˜é•¿çš„åŒ…<br><span class="hljs-bullet">- </span>å¯ä»¥åœ¨æ•°æ®åŒ…çš„å¤´éƒ¨, çº¦å®šä¸€ä¸ªæ•°æ®åŒ…æ€»é•¿åº¦çš„å­—æ®µ, ä»è€Œå°±çŸ¥é“äº†åŒ…çš„ç»“æŸä½ç½®<br>è¿˜å¯ä»¥åœ¨åŒ…å’ŒåŒ…ä¹‹é—´ä½¿ç”¨æ˜ç¡®çš„åˆ†éš”ç¬¦æ¥ä½œä¸ºè¾¹ç•Œ(åº”ç”¨å±‚åè®®, æ˜¯ç¨‹åºå‘˜è‡ªå·±æ¥å®šçš„, åªè¦ä¿è¯åˆ†éš”ç¬¦ä¸å’Œæ­£æ–‡å†²çªå³å¯)<br></code></pre></td></tr></table></figure><p>tcp ç²˜åŒ…å¯èƒ½å‘ç”Ÿåœ¨å‘é€ç«¯æˆ–è€…æ¥æ”¶ç«¯ï¼Œåˆ†åˆ«æ¥çœ‹ä¸¤ç«¯å„ç§äº§ç”Ÿç²˜åŒ…çš„åŸå› ï¼š</p><ul><li>å‘é€ç«¯ç²˜åŒ…ï¼šå‘é€ç«¯éœ€è¦ç­‰ç¼“å†²åŒºæ»¡æ‰å‘é€å‡ºå»ï¼Œé€ æˆç²˜åŒ…ï¼›</li><li>æ¥æ”¶æ–¹ç²˜åŒ…ï¼šæ¥æ”¶æ–¹ä¸åŠæ—¶æ¥æ”¶ç¼“å†²åŒºçš„åŒ…ï¼Œé€ æˆå¤šä¸ªåŒ…æ¥æ”¶ã€‚</li></ul><h4 id="84-OSI-çš„ä¸ƒå±‚æ¨¡å‹éƒ½æœ‰å“ªäº›ï¼Ÿ">84.OSI çš„ä¸ƒå±‚æ¨¡å‹éƒ½æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>ç‰©ç†å±‚ï¼šåˆ©ç”¨ä¼ è¾“ä»‹è´¨ä¸ºæ•°æ®é“¾è·¯å±‚æä¾›ç‰©ç†è¿æ¥ï¼Œå®ç°æ¯”ç‰¹æµçš„é€æ˜ä¼ è¾“ã€‚</li><li>æ•°æ®é“¾è·¯å±‚ï¼šè´Ÿè´£å»ºç«‹å’Œç®¡ç†èŠ‚ç‚¹é—´çš„é“¾è·¯ã€‚</li><li>ç½‘ç»œå±‚ï¼šé€šè¿‡è·¯ç”±é€‰æ‹©ç®—æ³•ï¼Œä¸ºæŠ¥æ–‡æˆ–åˆ†ç»„é€šè¿‡é€šä¿¡å­ç½‘é€‰æ‹©æœ€é€‚å½“çš„è·¯å¾„ã€‚</li><li>ä¼ è¾“å±‚ï¼šå‘ç”¨æˆ·æä¾›å¯é çš„ç«¯åˆ°ç«¯çš„å·®é”™å’Œæµé‡æ§åˆ¶ï¼Œä¿è¯æŠ¥æ–‡çš„æ­£ç¡®ä¼ è¾“ã€‚</li><li>ä¼šè¯å±‚ï¼šå‘ä¸¤ä¸ªå®ä½“çš„è¡¨ç¤ºå±‚æä¾›å»ºç«‹å’Œä½¿ç”¨è¿æ¥çš„æ–¹æ³•ã€‚</li><li>è¡¨ç¤ºå±‚ï¼šå¤„ç†ç”¨æˆ·ä¿¡æ¯çš„è¡¨ç¤ºé—®é¢˜ï¼Œå¦‚ç¼–ç ã€æ•°æ®æ ¼å¼è½¬æ¢å’ŒåŠ å¯†è§£å¯†ç­‰ã€‚</li><li>åº”ç”¨å±‚ï¼šç›´æ¥å‘ç”¨æˆ·æä¾›æœåŠ¡ï¼Œå®Œæˆç”¨æˆ·å¸Œæœ›åœ¨ç½‘ç»œä¸Šå®Œæˆçš„å„ç§å·¥ä½œã€‚</li></ul><h4 id="85-get-å’Œ-post-è¯·æ±‚æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ">85.get å’Œ post è¯·æ±‚æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</h4><ul><li>åœ¨æµè§ˆå™¨è¿›è¡Œå›é€€æ“ä½œæ—¶,getè¯·æ±‚æ˜¯æ— å®³çš„,è€Œpostè¯·æ±‚åˆ™ä¼šé‡æ–°è¯·æ±‚ä¸€æ¬¡</li><li>getè¯·æ±‚å‚æ•°æ˜¯è¿æ¥åœ¨urlåé¢çš„,è€Œpostè¯·æ±‚å‚æ•°æ˜¯å­˜æ”¾åœ¨requestbodyå†…çš„</li><li>getè¯·æ±‚å› ä¸ºæµè§ˆå™¨å¯¹urlé•¿åº¦æœ‰é™åˆ¶(ä¸åŒæµè§ˆå™¨é•¿åº¦é™åˆ¶ä¸ä¸€æ ·)å¯¹ä¼ å‚æ•°é‡æœ‰é™åˆ¶,è€Œpostè¯·æ±‚å› ä¸ºå‚æ•°å­˜æ”¾åœ¨requestbodyå†…æ‰€ä»¥å‚æ•°æ•°é‡æ²¡æœ‰é™åˆ¶(äº‹å®ä¸Šgetè¯·æ±‚ä¹Ÿèƒ½åœ¨requestbodyå†…æºå¸¦å‚æ•°,åªä¸è¿‡ä¸ç¬¦åˆè§„å®š,æœ‰çš„æµè§ˆå™¨èƒ½å¤Ÿè·å–åˆ°æ•°æ®,è€Œæœ‰çš„ä¸èƒ½)</li><li>å› ä¸ºgetè¯·æ±‚å‚æ•°æš´éœ²åœ¨urlä¸Š,æ‰€ä»¥å®‰å…¨æ–¹é¢postæ¯”getæ›´åŠ å®‰å…¨</li><li>getè¯·æ±‚æµè§ˆå™¨ä¼šä¸»åŠ¨cache,postå¹¶ä¸ä¼š,é™¤éä¸»åŠ¨è®¾ç½®</li><li>getè¯·æ±‚å‚æ•°ä¼šä¿å­˜åœ¨æµè§ˆå™¨å†å²è®°å½•å†…,postè¯·æ±‚å¹¶ä¸ä¼š</li><li>getè¯·æ±‚åªèƒ½è¿›è¡Œurlç¼–ç ,è€Œpostè¯·æ±‚å¯ä»¥æ”¯æŒå¤šç§ç¼–ç æ–¹å¼</li><li>getè¯·æ±‚äº§ç”Ÿ1ä¸ªtcpæ•°æ®åŒ…,postè¯·æ±‚äº§ç”Ÿ2ä¸ªtcpæ•°æ®åŒ…</li><li>==æµè§ˆå™¨åœ¨å‘é€getè¯·æ±‚æ—¶ä¼šå°†headerå’Œdataä¸€èµ·å‘é€ç»™æœåŠ¡å™¨,æœåŠ¡å™¨è¿”å›200çŠ¶æ€ç ,è€Œåœ¨å‘é€postè¯·æ±‚æ—¶,ä¼šå…ˆå°†headerå‘é€ç»™æœåŠ¡å™¨,æœåŠ¡å™¨è¿”å›100,ä¹‹åå†å°†dataå‘é€ç»™æœåŠ¡å™¨,æœåŠ¡å™¨è¿”å›200 OK==</li></ul><h4 id="86-å¦‚ä½•å®ç°è·¨åŸŸï¼Ÿ">86.å¦‚ä½•å®ç°è·¨åŸŸï¼Ÿ</h4><p>è·¨åŸŸï¼šå½“æµè§ˆå™¨æ‰§è¡Œè„šæœ¬æ—¶ä¼šæ£€æŸ¥æ˜¯å¦åŒæºï¼Œåªæœ‰åŒæºçš„è„šæœ¬æ‰ä¼šæ‰§è¡Œï¼Œå¦‚æœä¸åŒæºå³ä¸ºè·¨åŸŸã€‚</p><ul><li><p>è¿™é‡Œçš„åŒæºæŒ‡è®¿é—®çš„åè®®ã€åŸŸåã€ç«¯å£éƒ½ç›¸åŒã€‚</p></li><li><p>åŒæºç­–ç•¥æ˜¯ç”± Netscape æå‡ºçš„è‘—åå®‰å…¨ç­–ç•¥ï¼Œæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒã€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œå®ƒé™åˆ¶äº†ä¸€ä¸ªæºä¸­åŠ è½½è„šæœ¬ä¸æ¥è‡ªå…¶ä»–æºä¸­èµ„æºçš„äº¤äº’æ–¹å¼ã€‚</p></li><li><p>Ajax å‘èµ·çš„è·¨åŸŸ HTTP è¯·æ±‚ï¼Œç»“æœè¢«æµè§ˆå™¨æ‹¦æˆªï¼ŒåŒæ—¶ Ajax è¯·æ±‚ä¸èƒ½æºå¸¦ä¸æœ¬ç½‘ç«™ä¸åŒæºçš„ Cookieã€‚</p></li><li><script> <img> <iframe> <link> <video> <audio> ç­‰å¸¦æœ‰ src å±æ€§çš„æ ‡ç­¾å¯ä»¥ä»ä¸åŒçš„åŸŸåŠ è½½å’Œæ‰§è¡Œèµ„æº<script> <img> <iframe> <link> <video> <audio> ç­‰å¸¦æœ‰ src å±æ€§çš„æ ‡ç­¾å¯ä»¥ä»ä¸åŒçš„åŸŸåŠ è½½å’Œæ‰§è¡Œèµ„</li></ul><p>å®ç°è·¨åŸŸæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š</p><ul><li>æœåŠ¡å™¨ç«¯è¿è¡Œè·¨åŸŸ è®¾ç½® CORSï¼ˆCross-Origin Resource Sharingï¼‰è·¨åŸŸèµ„æºå…±äº« ç­‰äº *ï¼›<ul><li>å½“ä½¿ç”¨XMLHttpRequestå‘é€è¯·æ±‚æ—¶ï¼Œå¦‚æœæµè§ˆå™¨å‘ç°è¿åäº†åŒæºç­–ç•¥å°±ä¼šè‡ªåŠ¨åŠ ä¸Šä¸€ä¸ªè¯·æ±‚å¤´ originï¼›</li><li>åç«¯åœ¨æ¥å—åˆ°è¯·æ±‚åç¡®å®šå“åº”åä¼šåœ¨åç«¯åœ¨æ¥å—åˆ°è¯·æ±‚åç¡®å®šå“åº”åä¼šåœ¨ Response Headers ä¸­åŠ å…¥ä¸€ä¸ªå±æ€§ Access-Control-Allow-Originï¼›</li><li>æµè§ˆå™¨åˆ¤æ–­å“åº”ä¸­çš„ Access-Control-Allow-Origin å€¼æ˜¯å¦å’Œå½“å‰çš„åœ°å€ç›¸åŒï¼ŒåŒ¹é…æˆåŠŸåæ‰ç»§ç»­å“åº”å¤„ç†ï¼Œå¦åˆ™æŠ¥é”™</li></ul></li><li>åœ¨å•ä¸ªæ¥å£ä½¿ç”¨æ³¨è§£ @CrossOrigin è¿è¡Œè·¨åŸŸï¼›</li><li>ä½¿ç”¨ jsonp è·¨åŸŸï¼›åˆ©ç”¨äº†scriptsä¸å—åŒæºç­–ç•¥çš„é™åˆ¶</li></ul><h4 id="87-è¯´ä¸€ä¸‹-JSONP-å®ç°åŸç†ï¼Ÿ">87.è¯´ä¸€ä¸‹ JSONP å®ç°åŸç†ï¼Ÿ</h4><p>jsonpï¼šJSON with Paddingï¼Œå®ƒæ˜¯åˆ©ç”¨<script>æ ‡ç­¾çš„ src è¿æ¥å¯ä»¥è®¿é—®ä¸åŒæºçš„ç‰¹æ€§ï¼ŒåŠ è½½è¿œç¨‹è¿”å›çš„â€œJS å‡½æ•°â€æ¥æ‰§è¡Œçš„ã€‚</p><h4 id="88-HTTPå“åº”ç±»å‹æœ‰å“ªå‡ ç§ï¼Ÿ">88.HTTPå“åº”ç±»å‹æœ‰å“ªå‡ ç§ï¼Ÿ</h4><ol><li>æ¶ˆæ¯å“åº”ï¼š100ï¼ˆç»§ç»­ï¼‰ã€101ï¼ˆåˆ‡æ¢åè®®ï¼‰</li><li>æˆåŠŸå“åº”ï¼š200ï¼ˆæˆåŠŸï¼‰</li><li>é‡å®šå‘ï¼š301ï¼ˆæ°¸ä¹…ç§»åŠ¨ï¼‰è¡¨ç¤ºæ‰€è¯·æ±‚çš„URIèµ„æºè·¯å¾„å·²ç»æ”¹å˜,æ–°çš„URLä¼šåœ¨å“åº”çš„<code>Location</code>:å¤´å­—æ®µé‡Œæ‰¾åˆ°.ï¼‰ã€302ï¼ˆä¸´æ—¶ç§»åŠ¨ï¼‰==http0.9==ã€307ï¼ˆä¸´æ—¶é‡å®šå‘ï¼‰ã€308ï¼ˆæ°¸ä¹…é‡å®šå‘ï¼‰ ==http1.1==ï¼ŒåŒºåˆ« 307ã€308å¿…é¡»æ˜¯ä¸¤æ¬¡ç›¸åŒè¯·æ±‚è®¿é—®ã€‚</li><li>å®¢æˆ·ç«¯é”™è¯¯ï¼š400ï¼ˆé”™è¯¯è¯·æ±‚ï¼‰ã€401ï¼ˆæœªæˆæƒï¼‰ã€403ï¼ˆç¦æ­¢è®¿é—®ï¼‰ã€404ï¼ˆè¯·æ±‚èµ„æºæ‰¾ä¸åˆ°ï¼‰ã€405ï¼ˆä¸å…è®¸ä½¿ç”¨æ­¤æ–¹æ³•ï¼‰ã€408ï¼ˆè¯·æ±‚è¶…æ—¶ï¼‰</li><li>æœåŠ¡å™¨ç«¯é”™è¯¯ï¼š500ï¼ˆå†…éƒ¨æœåŠ¡å™¨é”™è¯¯ï¼‰ã€501ï¼ˆæœåŠ¡å™¨ä¸æ”¯æŒä½¿ç”¨çš„æ–¹æ³•ï¼Œå¦‚putã€deleteï¼‰ã€502ï¼ˆç½‘å…³é”™è¯¯ï¼‰ã€503ï¼ˆæœåŠ¡ä¸å¯ç”¨ï¼‰</li></ol>]]></content>
    
    
    <categories>
      
      <category>JavaInterview</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaInterview-01</title>
    <link href="/dajiangdahe/2021/10/22/JavaInterview-01/"/>
    <url>/dajiangdahe/2021/10/22/JavaInterview-01/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆå¿ƒ">åˆå¿ƒ</h2><p>åœ¨æœ¬ç¯‡æ–‡ç« å¼€å§‹ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆæ¥å›ç­”ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä¸ºä»€ä¹ˆè¦å†™è¿™æ ·ä¸€ç¯‡å…³äºé¢è¯•çš„æ–‡ç« ï¼ŸåŸå› æœ‰ä¸‰ä¸ªï¼šç¬¬ä¸€ï¼Œæˆ‘æƒ³ä¸ºæ¯ä¸€ä¸ªä¸ºæ¢¦æƒ³æ—¶åˆ»å‡†å¤‡ç€çš„â€œæœ‰å¿ƒäººâ€ï¼Œå°½ä¸€ä»½è‡ªå·±çš„åŠ›é‡ï¼Œæä¾›ä¸€ä»½é«˜åº¦ç²¾åçš„ java é¢è¯•æ¸…å•ï¼›ç¬¬äºŒï¼Œç›®å‰å¸‚é¢ä¸Šçš„é¢è¯•é¢˜ä¸æ˜¯ç­”æ¡ˆä¸å‡†ç¡®å°±æ˜¯å†…å®¹è¦†ç›–é¢å¤ªçª„ï¼Œæ‰€ä»¥æä¾›ä¸€ä»½ç»å…¸è€Œåˆå‡†ç¡®çš„é¢è¯•é¢˜æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼›ç¬¬ä¸‰ï¼Œæœ¬æ–‡ä¼šå¯¹éƒ¨åˆ†é¢è¯•é¢˜æä¾›è¯¦ç»†è§£è¯»å’Œä»£ç æ¡ˆä¾‹ï¼Œè®©è¯»è€…çŸ¥å…¶ç„¶å¹¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œä»è€Œå­¦åˆ°æ›´å¤šçš„çŸ¥è¯†ã€‚</p><p>æˆ–è®¸è¿™ä»½é¢è¯•é¢˜è¿˜ä¸è¶³ä»¥å›Šæ‹¬æ‰€æœ‰ java é—®é¢˜ï¼Œä½†æœ‰äº†å®ƒï¼Œæˆ‘ç›¸ä¿¡ä½ ä¸€å®šä¸ä¼šâ€œè´¥â€çš„å¾ˆæƒ¨ï¼Œå› ä¸ºæœ‰äº†å®ƒï¼Œè¶³ä»¥åº”å¯¹ç›®å‰å¸‚é¢ä¸Šç»å¤§éƒ¨åˆ†çš„ java é¢è¯•äº†ï¼Œå› ä¸ºè¿™ç¯‡æ–‡ç« ä¸è®ºæ˜¯ä»æ·±åº¦è¿˜æ˜¯å¹¿åº¦ä¸Šæ¥è®²ï¼Œéƒ½å·²ç»å›Šæ‹¬äº†éå¸¸å¤šçš„çŸ¥è¯†ç‚¹äº†ã€‚</p><p>å‡¡äº‹é¢„åˆ™ç«‹ï¼Œä¸é¢„åˆ™åºŸã€‚èƒ½è¯»åˆ°è¿™é‡Œçš„äººï¼Œæˆ‘ç›¸ä¿¡éƒ½æ˜¯è¿™ä¸ªä¸–ç•Œä¸Šçš„â€œæœ‰å¿ƒäººâ€ï¼Œè¿˜æ˜¯é‚£å¥è€è¯ï¼šä¸Šå¤©ä¸è´Ÿæœ‰å¿ƒäººï¼æˆ‘ç›¸ä¿¡ä½ çš„æ¯ä¸€æ­¥åŠªåŠ›ï¼Œéƒ½ä¼šæ”¶è·æ„æƒ³ä¸åˆ°çš„å›æŠ¥ã€‚</p><h2 id="é€‚å®œé˜…è¯»äººç¾¤">é€‚å®œé˜…è¯»äººç¾¤</h2><ul><li>å‡†å¤‡è·³æ§½çš„åˆ/ä¸­/é«˜çº§ Java ç¨‹åºå‘˜</li><li>æƒ³è¦æŸ¥æ¼è¡¥ç¼ºçš„äºº</li><li>æƒ³è¦ä¸æ–­å®Œå–„å’Œæ‰©å……è‡ªå·± Java æŠ€æœ¯æ ˆçš„äºº</li><li>Java é¢è¯•å®˜</li></ul><h2 id="é˜…è¯»å»ºè®®">é˜…è¯»å»ºè®®</h2><p>æœ¬æ–‡ä¼šæŒ‰æŠ€èƒ½æ¨¡å—åˆ’åˆ†æ–‡ç« æ®µè½ï¼Œæ¯ä¸ªæ¨¡å—é‡Œçš„å†…å®¹ï¼Œä»æ˜“åˆ°éš¾ä¾æ¬¡è¿›è¡Œæ’åºï¼Œå„æ¨¡å—ä¹‹é—´ä¸å­˜åœ¨äº’ç›¸å…³è”çš„å…³ç³»ï¼Œè¯»è€…å¯é€‰æ‹©æ–‡ç« é¡ºåºé˜…è¯»æˆ–è€…è·³è·ƒå¼é˜…è¯»ã€‚</p><h2 id="æ­£æ–‡">æ­£æ–‡</h2><p>æœ¬æ–‡åˆ†ä¸ºåä¹ä¸ªæ¨¡å—ï¼Œåˆ†åˆ«æ˜¯ï¼š <strong>Java åŸºç¡€ã€å®¹å™¨ã€å¤šçº¿ç¨‹ã€åå°„ã€å¯¹è±¡æ‹·è´ã€Java Web æ¨¡å—ã€å¼‚å¸¸ã€ç½‘ç»œã€è®¾è®¡æ¨¡å¼ã€Spring/Spring MVCã€Spring Boot/Spring Cloudã€Hibernateã€Mybatisã€RabbitMQã€Kafkaã€Zookeeperã€MySqlã€Redisã€JVM</strong> ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://icdn.apigo.cn/gitchat/java-intervier-gitchat-path.png" alt=""></p><p>å…±åŒ…å« 208 é“é¢è¯•é¢˜ï¼Œæœ¬æ–‡çš„å®—æ—¨æ˜¯ä¸ºè¯»è€…æœ‹å‹ä»¬æ•´ç†ä¸€ä»½è¯¦å®è€Œåˆæƒå¨çš„é¢è¯•æ¸…å•ï¼Œä¸‹é¢ä¸€èµ·è¿›å…¥ä¸»é¢˜å§ã€‚</p><h3 id="ä¸€ã€Java-åŸºç¡€">ä¸€ã€Java åŸºç¡€</h3><h4 id="1-JDK-å’Œ-JRE-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">1.JDK å’Œ JRE æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>JDKï¼šJava Development Kit çš„ç®€ç§°ï¼Œjava å¼€å‘å·¥å…·åŒ…ï¼Œæä¾›äº† java çš„å¼€å‘ç¯å¢ƒå’Œè¿è¡Œç¯å¢ƒã€‚</li><li>JREï¼šJava Runtime Environment çš„ç®€ç§°ï¼Œjava è¿è¡Œç¯å¢ƒï¼Œä¸º java çš„è¿è¡Œæä¾›äº†æ‰€éœ€ç¯å¢ƒã€‚</li></ul><p>å…·ä½“æ¥è¯´ JDK å…¶å®åŒ…å«äº† JREï¼ŒåŒæ—¶è¿˜åŒ…å«äº†ç¼–è¯‘ java æºç çš„ç¼–è¯‘å™¨ javacï¼Œè¿˜åŒ…å«äº†å¾ˆå¤š java ç¨‹åºè°ƒè¯•å’Œåˆ†æçš„å·¥å…·ã€‚ç®€å•æ¥è¯´ï¼šå¦‚æœä½ éœ€è¦è¿è¡Œ java ç¨‹åºï¼Œåªéœ€å®‰è£… JRE å°±å¯ä»¥äº†ï¼Œå¦‚æœä½ éœ€è¦ç¼–å†™ java ç¨‹åºï¼Œéœ€è¦å®‰è£… JDKã€‚</p><h4 id="2-å’Œ-equals-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">2.== å’Œ equals çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p><strong>== è§£è¯»</strong></p><p>å¯¹äºåŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ == çš„ä½œç”¨æ•ˆæœæ˜¯ä¸åŒçš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>åŸºæœ¬ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸åŒï¼›</li><li>å¼•ç”¨ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å¼•ç”¨æ˜¯å¦ç›¸åŒï¼›</li></ul><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">String x = <span class="hljs-string">&quot;string&quot;</span>;<br>String y = <span class="hljs-string">&quot;string&quot;</span>;<br>String z = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;string&quot;</span>);<br>System.out.println(x==y); <span class="hljs-comment">// true</span><br>System.out.println(x==z); <span class="hljs-comment">// false</span><br>System.out.println(x.equals(y)); <span class="hljs-comment">// true</span><br>System.out.println(x.equals(z)); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure><p>ä»£ç è§£è¯»ï¼šå› ä¸º x å’Œ y æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥ == ä¹Ÿæ˜¯ trueï¼Œè€Œ new String()æ–¹æ³•åˆ™é‡å†™å¼€è¾Ÿäº†å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥ == ç»“æœä¸º falseï¼Œè€Œ equals æ¯”è¾ƒçš„ä¸€ç›´æ˜¯å€¼ï¼Œæ‰€ä»¥ç»“æœéƒ½ä¸º trueã€‚</p><p><strong>equals è§£è¯»</strong></p><p>equals æœ¬è´¨ä¸Šå°±æ˜¯ ==ï¼Œåªä¸è¿‡ String å’Œ Integer ç­‰é‡å†™äº† equals æ–¹æ³•ï¼ŒæŠŠå®ƒå˜æˆäº†å€¼æ¯”è¾ƒã€‚çœ‹ä¸‹é¢çš„ä»£ç å°±æ˜ç™½äº†ã€‚</p><p>é¦–å…ˆæ¥çœ‹é»˜è®¤æƒ…å†µä¸‹ equals æ¯”è¾ƒä¸€ä¸ªæœ‰ç›¸åŒå€¼çš„å¯¹è±¡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cat</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Cat</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>    &#125;<br>&#125;<br><br>Cat c1 = <span class="hljs-keyword">new</span> Cat(<span class="hljs-string">&quot;ç‹ç£Š&quot;</span>);<br>Cat c2 = <span class="hljs-keyword">new</span> Cat(<span class="hljs-string">&quot;ç‹ç£Š&quot;</span>);<br>System.out.println(c1.equals(c2)); <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå‡ºä¹æˆ‘ä»¬çš„æ„æ–™ï¼Œç«Ÿç„¶æ˜¯ falseï¼Ÿè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Œçœ‹äº† equals æºç å°±çŸ¥é“äº†ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object obj)</span> </span>&#123;<br><span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span> == obj);<br>&#125;<br></code></pre></td></tr></table></figure><p>åŸæ¥ equals æœ¬è´¨ä¸Šå°±æ˜¯ ==ã€‚</p><p>é‚£é—®é¢˜æ¥äº†ï¼Œä¸¤ä¸ªç›¸åŒå€¼çš„ String å¯¹è±¡ï¼Œä¸ºä»€ä¹ˆè¿”å›çš„æ˜¯ trueï¼Ÿä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">String s1 = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;è€ç‹&quot;</span>);<br>String s2 = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;è€ç‹&quot;</span>);<br>System.out.println(s1.equals(s2)); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œå½“æˆ‘ä»¬è¿›å…¥ String çš„ equals æ–¹æ³•ï¼Œæ‰¾åˆ°äº†ç­”æ¡ˆï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object anObject)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == anObject) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (anObject <span class="hljs-keyword">instanceof</span> String) &#123;<br>        String anotherString = (String)anObject;<br>        <span class="hljs-keyword">int</span> n = value.length;<br>        <span class="hljs-keyword">if</span> (n == anotherString.value.length) &#123;<br>            <span class="hljs-keyword">char</span> v1[] = value;<br>            <span class="hljs-keyword">char</span> v2[] = anotherString.value;<br>            <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">while</span> (n-- != <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">if</span> (v1[i] != v2[i])<br>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>                i++;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŸæ¥æ˜¯ String é‡å†™äº† Object çš„ equals æ–¹æ³•ï¼ŒæŠŠå¼•ç”¨æ¯”è¾ƒæ”¹æˆäº†å€¼æ¯”è¾ƒã€‚</p><p><strong>æ€»ç»“</strong> ï¼š== å¯¹äºåŸºæœ¬ç±»å‹æ¥è¯´æ˜¯å€¼æ¯”è¾ƒï¼Œå¯¹äºå¼•ç”¨ç±»å‹æ¥è¯´æ˜¯æ¯”è¾ƒçš„æ˜¯å¼•ç”¨ï¼›è€Œ equals é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼•ç”¨æ¯”è¾ƒï¼Œåªæ˜¯å¾ˆå¤šç±»é‡å†™äº† equals æ–¹æ³•ï¼Œæ¯”å¦‚ Stringã€Integer ç­‰æŠŠå®ƒå˜æˆäº†å€¼æ¯”è¾ƒï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ equals æ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸ç­‰ã€‚</p><h4 id="3-ä¸¤ä¸ªå¯¹è±¡çš„-hashCode-ç›¸åŒï¼Œåˆ™-equals-ä¹Ÿä¸€å®šä¸º-trueï¼Œå¯¹å—ï¼Ÿ">3.ä¸¤ä¸ªå¯¹è±¡çš„ hashCode()ç›¸åŒï¼Œåˆ™ equals()ä¹Ÿä¸€å®šä¸º trueï¼Œå¯¹å—ï¼Ÿ</h4><p>ä¸å¯¹ï¼Œä¸¤ä¸ªå¯¹è±¡çš„ hashCode()ç›¸åŒï¼Œequals()ä¸ä¸€å®š trueã€‚</p><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">String str1 = <span class="hljs-string">&quot;é€šè¯&quot;</span>;<br>String str2 = <span class="hljs-string">&quot;é‡åœ°&quot;</span>;<br>System.out.println(String.format(<span class="hljs-string">&quot;str1ï¼š%d | str2ï¼š%d&quot;</span>,  str1.hashCode(),str2.hashCode()));<br>System.out.println(str1.equals(str2));<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œçš„ç»“æœï¼š</p><p>str1ï¼š1179395 | str2ï¼š1179395</p><p>false</p><p>ä»£ç è§£è¯»ï¼šå¾ˆæ˜¾ç„¶â€œé€šè¯â€å’Œâ€œé‡åœ°â€çš„ hashCode() ç›¸åŒï¼Œç„¶è€Œ equals() åˆ™ä¸º falseï¼Œå› ä¸ºåœ¨æ•£åˆ—è¡¨ä¸­ï¼ŒhashCode()ç›¸ç­‰å³ä¸¤ä¸ªé”®å€¼å¯¹çš„å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œç„¶è€Œå“ˆå¸Œå€¼ç›¸ç­‰ï¼Œå¹¶ä¸ä¸€å®šèƒ½å¾—å‡ºé”®å€¼å¯¹ç›¸ç­‰ã€‚</p><h4 id="4-final-åœ¨-java-ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ">4.final åœ¨ java ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h4><ul><li>final ä¿®é¥°çš„ç±»å«æœ€ç»ˆç±»ï¼Œè¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚</li><li>final ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«é‡å†™ã€‚</li><li>final ä¿®é¥°çš„å˜é‡å«å¸¸é‡ï¼Œå¸¸é‡å¿…é¡»åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–ä¹‹åå€¼å°±ä¸èƒ½è¢«ä¿®æ”¹ã€‚</li></ul><h4 id="5-java-ä¸­çš„-Math-round-1-5-ç­‰äºå¤šå°‘ï¼Ÿ">5.java ä¸­çš„ Math.round(-1.5) ç­‰äºå¤šå°‘ï¼Ÿ</h4><p>ç­‰äº -1ï¼Œå› ä¸ºåœ¨æ•°è½´ä¸Šå–å€¼æ—¶ï¼Œä¸­é—´å€¼ï¼ˆ0.5ï¼‰å‘å³å–æ•´ï¼Œæ‰€ä»¥æ­£ 0.5 æ˜¯å¾€ä¸Šå–æ•´ï¼Œè´Ÿ 0.5 æ˜¯ç›´æ¥èˆå¼ƒã€‚</p><h4 id="6-String-å±äºåŸºç¡€çš„æ•°æ®ç±»å‹å—ï¼Ÿ">6.String å±äºåŸºç¡€çš„æ•°æ®ç±»å‹å—ï¼Ÿ</h4><p>String ä¸å±äºåŸºç¡€ç±»å‹ï¼ŒåŸºç¡€ç±»å‹æœ‰ 8 ç§ï¼šbyteã€booleanã€charã€shortã€intã€floatã€longã€doubleï¼Œè€Œ String å±äºå¯¹è±¡ã€‚</p><h4 id="7-java-ä¸­æ“ä½œå­—ç¬¦ä¸²éƒ½æœ‰å“ªäº›ç±»ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">7.java ä¸­æ“ä½œå­—ç¬¦ä¸²éƒ½æœ‰å“ªäº›ç±»ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>æ“ä½œå­—ç¬¦ä¸²çš„ç±»æœ‰ï¼šStringã€StringBufferã€StringBuilderã€‚</p><p>String å’Œ StringBufferã€StringBuilder çš„åŒºåˆ«åœ¨äº String å£°æ˜çš„æ˜¯ä¸å¯å˜çš„å¯¹è±¡ï¼Œæ¯æ¬¡æ“ä½œéƒ½ä¼šç”Ÿæˆæ–°çš„ String å¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„ String å¯¹è±¡ï¼Œè€Œ StringBufferã€StringBuilder å¯ä»¥åœ¨åŸæœ‰å¯¹è±¡çš„åŸºç¡€ä¸Šè¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥åœ¨ç»å¸¸æ”¹å˜å­—ç¬¦ä¸²å†…å®¹çš„æƒ…å†µä¸‹æœ€å¥½ä¸è¦ä½¿ç”¨ Stringã€‚</p><p>StringBuffer å’Œ StringBuilder æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼ŒStringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ StringBuilder æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä½† StringBuilder çš„æ€§èƒ½å´é«˜äº StringBufferï¼Œæ‰€ä»¥åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹æ¨èä½¿ç”¨ StringBuilderï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ¨èä½¿ç”¨ StringBufferã€‚</p><h4 id="8-String-str-i-ä¸-String-str-new-String-â€œiâ€-ä¸€æ ·å—ï¼Ÿ">8.String str=&quot;i&quot;ä¸ String str=new String(â€œiâ€)ä¸€æ ·å—ï¼Ÿ</h4><p>ä¸ä¸€æ ·ï¼Œå› ä¸ºå†…å­˜çš„åˆ†é…æ–¹å¼ä¸ä¸€æ ·ã€‚String str=&quot;i&quot;çš„æ–¹å¼ï¼Œjava è™šæ‹Ÿæœºä¼šå°†å…¶åˆ†é…åˆ°å¸¸é‡æ± ä¸­ï¼›è€Œ String str=new String(â€œiâ€) åˆ™ä¼šè¢«åˆ†åˆ°å †å†…å­˜ä¸­ã€‚</p><h4 id="9-å¦‚ä½•å°†å­—ç¬¦ä¸²åè½¬ï¼Ÿ">9.å¦‚ä½•å°†å­—ç¬¦ä¸²åè½¬ï¼Ÿ</h4><p>ä½¿ç”¨ StringBuilder æˆ–è€… stringBuffer çš„ reverse() æ–¹æ³•ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// StringBuffer reverse</span><br>StringBuffer stringBuffer = <span class="hljs-keyword">new</span> StringBuffer();<br>stringBuffer.append(<span class="hljs-string">&quot;abcdefg&quot;</span>);<br>System.out.println(stringBuffer.reverse()); <span class="hljs-comment">// gfedcba</span><br><span class="hljs-comment">// StringBuilder reverse</span><br>StringBuilder stringBuilder = <span class="hljs-keyword">new</span> StringBuilder();<br>stringBuilder.append(<span class="hljs-string">&quot;abcdefg&quot;</span>);<br>System.out.println(stringBuilder.reverse()); <span class="hljs-comment">// gfedcba</span><br></code></pre></td></tr></table></figure><h4 id="10-String-ç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰é‚£äº›ï¼Ÿ">10.String ç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰é‚£äº›ï¼Ÿ</h4><ul><li>indexOf()ï¼šè¿”å›æŒ‡å®šå­—ç¬¦çš„ç´¢å¼•ã€‚</li><li>charAt()ï¼šè¿”å›æŒ‡å®šç´¢å¼•å¤„çš„å­—ç¬¦ã€‚</li><li>replace()ï¼šå­—ç¬¦ä¸²æ›¿æ¢ã€‚</li><li>trim()ï¼šå»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯ç©ºç™½ã€‚</li><li>split()ï¼šåˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªåˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„ã€‚</li><li>getBytes()ï¼šè¿”å›å­—ç¬¦ä¸²çš„ byte ç±»å‹æ•°ç»„ã€‚</li><li>length()ï¼šè¿”å›å­—ç¬¦ä¸²é•¿åº¦ã€‚</li><li>toLowerCase()ï¼šå°†å­—ç¬¦ä¸²è½¬æˆå°å†™å­—æ¯ã€‚</li><li>toUpperCase()ï¼šå°†å­—ç¬¦ä¸²è½¬æˆå¤§å†™å­—ç¬¦ã€‚</li><li>substring()ï¼šæˆªå–å­—ç¬¦ä¸²ã€‚</li><li>equals()ï¼šå­—ç¬¦ä¸²æ¯”è¾ƒã€‚</li></ul><h4 id="11-æŠ½è±¡ç±»å¿…é¡»è¦æœ‰æŠ½è±¡æ–¹æ³•å—ï¼Ÿ">11.æŠ½è±¡ç±»å¿…é¡»è¦æœ‰æŠ½è±¡æ–¹æ³•å—ï¼Ÿ</h4><p>ä¸éœ€è¦ï¼ŒæŠ½è±¡ç±»ä¸ä¸€å®šéè¦æœ‰æŠ½è±¡æ–¹æ³•ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cat</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHi</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;hi~&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ï¼ŒæŠ½è±¡ç±»å¹¶æ²¡æœ‰æŠ½è±¡æ–¹æ³•ä½†å®Œå…¨å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p><h4 id="12-æ™®é€šç±»å’ŒæŠ½è±¡ç±»æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ">12.æ™®é€šç±»å’ŒæŠ½è±¡ç±»æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</h4><ul><li>æ™®é€šç±»ä¸èƒ½åŒ…å«æŠ½è±¡æ–¹æ³•ï¼ŒæŠ½è±¡ç±»å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ã€‚</li><li>æŠ½è±¡ç±»ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œæ™®é€šç±»å¯ä»¥ç›´æ¥å®ä¾‹åŒ–ã€‚</li></ul><h4 id="13-æŠ½è±¡ç±»èƒ½ä½¿ç”¨-final-ä¿®é¥°å—ï¼Ÿ">13.æŠ½è±¡ç±»èƒ½ä½¿ç”¨ final ä¿®é¥°å—ï¼Ÿ</h4><p>ä¸èƒ½ï¼Œå®šä¹‰æŠ½è±¡ç±»å°±æ˜¯è®©å…¶ä»–ç±»ç»§æ‰¿çš„ï¼Œå¦‚æœå®šä¹‰ä¸º final è¯¥ç±»å°±ä¸èƒ½è¢«ç»§æ‰¿ï¼Œè¿™æ ·å½¼æ­¤å°±ä¼šäº§ç”ŸçŸ›ç›¾ï¼Œæ‰€ä»¥ final ä¸èƒ½ä¿®é¥°æŠ½è±¡ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç¼–è¾‘å™¨ä¹Ÿä¼šæç¤ºé”™è¯¯ä¿¡æ¯ï¼š</p><p><img src="http://icdn.apigo.cn/gitchat/java-intervier002.png" alt="finalå®šä¹‰æŠ½è±¡ç±»"></p><h4 id="14-æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">14.æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>å®ç°ï¼šæŠ½è±¡ç±»çš„å­ç±»ä½¿ç”¨ extends æ¥ç»§æ‰¿ï¼›æ¥å£å¿…é¡»ä½¿ç”¨ implements æ¥å®ç°æ¥å£ã€‚</li><li>æ„é€ å‡½æ•°ï¼šæŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ å‡½æ•°ï¼›æ¥å£ä¸èƒ½æœ‰ã€‚</li><li>å®ç°æ•°é‡ï¼šç±»å¯ä»¥å®ç°å¾ˆå¤šä¸ªæ¥å£ï¼›ä½†æ˜¯åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ã€‚</li><li>è®¿é—®ä¿®é¥°ç¬¦ï¼šæ¥å£ä¸­çš„æ–¹æ³•é»˜è®¤ä½¿ç”¨ public ä¿®é¥°ï¼›æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å¯ä»¥æ˜¯ä»»æ„è®¿é—®ä¿®é¥°ç¬¦ã€‚</li></ul><h4 id="15-java-ä¸­-IO-æµåˆ†ä¸ºå‡ ç§ï¼Ÿ">15.java ä¸­ IO æµåˆ†ä¸ºå‡ ç§ï¼Ÿ</h4><p>æŒ‰åŠŸèƒ½æ¥åˆ†ï¼šè¾“å…¥æµï¼ˆinputï¼‰ã€è¾“å‡ºæµï¼ˆoutputï¼‰ã€‚</p><p>æŒ‰ç±»å‹æ¥åˆ†ï¼šå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚</p><p>å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«æ˜¯ï¼šå­—èŠ‚æµæŒ‰ 8 ä½ä¼ è¾“ä»¥å­—èŠ‚ä¸ºå•ä½è¾“å…¥è¾“å‡ºæ•°æ®ï¼Œå­—ç¬¦æµæŒ‰ 16 ä½ä¼ è¾“ä»¥å­—ç¬¦ä¸ºå•ä½è¾“å…¥è¾“å‡ºæ•°æ®ã€‚</p><h4 id="16-BIOã€NIOã€AIO-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">16.BIOã€NIOã€AIO æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>BIOï¼šBlock IO åŒæ­¥é˜»å¡å¼ IOï¼Œå°±æ˜¯æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„ä¼ ç»Ÿ IOï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯æ¨¡å¼ç®€å•ä½¿ç”¨æ–¹ä¾¿ï¼Œå¹¶å‘å¤„ç†èƒ½åŠ›ä½ã€‚</li><li>NIOï¼šNew IOï¼ˆæˆ– Non Blocking IOï¼‰åŒæ­¥éé˜»å¡ IOï¼Œæ˜¯ä¼ ç»Ÿ IO çš„å‡çº§ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯é€šè¿‡ Channelï¼ˆé€šé“ï¼‰é€šè®¯ï¼Œå®ç°äº†å¤šè·¯å¤ç”¨ã€‚</li><li>AIOï¼šAsynchronous IO æ˜¯ NIO çš„å‡çº§ï¼Œä¹Ÿå« NIO2ï¼Œå®ç°äº†å¼‚æ­¥éå µå¡ IO ï¼Œå¼‚æ­¥ IO çš„æ“ä½œåŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶ã€‚</li></ul><h4 id="17-Filesçš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼Ÿ">17.Filesçš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>Files.exists()ï¼šæ£€æµ‹æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨ã€‚</li><li>Files.createFile()ï¼šåˆ›å»ºæ–‡ä»¶ã€‚</li><li>Files.createDirectory()ï¼šåˆ›å»ºæ–‡ä»¶å¤¹ã€‚</li><li>Files.delete()ï¼šåˆ é™¤ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚</li><li>Files.copy()ï¼šå¤åˆ¶æ–‡ä»¶ã€‚</li><li>Files.move()ï¼šç§»åŠ¨æ–‡ä»¶ã€‚</li><li>Files.size()ï¼šæŸ¥çœ‹æ–‡ä»¶ä¸ªæ•°ã€‚</li><li>Files.read()ï¼šè¯»å–æ–‡ä»¶ã€‚</li><li>Files.write()ï¼šå†™å…¥æ–‡ä»¶ã€‚</li></ul><h3 id="äºŒã€å®¹å™¨">äºŒã€å®¹å™¨</h3><h4 id="18-java-å®¹å™¨éƒ½æœ‰å“ªäº›ï¼Ÿ">18.java å®¹å™¨éƒ½æœ‰å“ªäº›ï¼Ÿ</h4><p>java å®¹å™¨åˆ†ä¸º Collection å’Œ Map ä¸¤å¤§ç±»ï¼Œå…¶ä¸‹åˆæœ‰å¾ˆå¤šå­ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>Collection<ul><li>List<ul><li>ArrayList</li><li>LinkedList</li><li>Vector<ul><li>Stack</li></ul></li></ul></li><li>Set<ul><li>HashSet<ul><li>LinkedHashSet</li></ul></li><li>TreeSet</li></ul></li></ul></li><li>Map<ul><li>HashMap<ul><li>LinkedHashMap</li></ul></li><li>TreeMap</li><li>ConcurrentHashMap</li><li>Hashtable</li></ul></li></ul><h4 id="19-Collection-å’Œ-Collections-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">19.Collection å’Œ Collections æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>Collection æ˜¯ä¸€ä¸ªé›†åˆæ¥å£ï¼Œå®ƒæä¾›äº†å¯¹é›†åˆå¯¹è±¡è¿›è¡ŒåŸºæœ¬æ“ä½œçš„é€šç”¨æ¥å£æ–¹æ³•ï¼Œæ‰€æœ‰é›†åˆéƒ½æ˜¯å®ƒçš„å­ç±»ï¼Œæ¯”å¦‚ Listã€Set ç­‰ã€‚</li><li>Collections æ˜¯ä¸€ä¸ªåŒ…è£…ç±»ï¼ŒåŒ…å«äº†å¾ˆå¤šé™æ€æ–¹æ³•ï¼Œä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œå°±åƒä¸€ä¸ªå·¥å…·ç±»ï¼Œæ¯”å¦‚æä¾›çš„æ’åºæ–¹æ³•ï¼š Collections.sort(list)ã€‚</li></ul><h4 id="20-Listã€Setã€Map-ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">20.Listã€Setã€Map ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>Listã€Setã€Map çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼šå…ƒç´ æ˜¯å¦æœ‰åºã€æ˜¯å¦å…è®¸å…ƒç´ é‡å¤ã€‚</p><p>ä¸‰è€…ä¹‹é—´çš„åŒºåˆ«ï¼Œå¦‚ä¸‹è¡¨ï¼š</p><p><img src="http://icdn.apigo.cn/gitchat/listmapset.png" alt="list/set/mapåŒºåˆ«å›¾"></p><h4 id="21-HashMap-å’Œ-Hashtable-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">21.HashMap å’Œ Hashtable æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>å­˜å‚¨ï¼šHashMap å…è®¸ key å’Œ value ä¸º nullï¼Œè€Œ Hashtable ä¸å…è®¸ã€‚</li><li>çº¿ç¨‹å®‰å…¨ï¼šHashtable æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>æ¨èä½¿ç”¨ï¼šåœ¨ Hashtable çš„ç±»æ³¨é‡Šå¯ä»¥çœ‹åˆ°ï¼ŒHashtable æ˜¯ä¿ç•™ç±»ä¸å»ºè®®ä½¿ç”¨ï¼Œæ¨èåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ HashMap æ›¿ä»£ï¼Œå¦‚æœéœ€è¦å¤šçº¿ç¨‹ä½¿ç”¨åˆ™ç”¨ ConcurrentHashMap æ›¿ä»£ã€‚</li><li>HashMap çš„é»˜è®¤åˆå§‹å®¹é‡ä¸º 16ï¼ŒHashtable ä¸º 11ã€‚</li><li>HashMap çš„æ‰©å®¹ä¸ºåŸæ¥çš„ 2 å€ï¼ŒHashtable çš„æ‰©å®¹ä¸ºåŸæ¥çš„ 2 å€åŠ  1ã€‚</li><li>HashMap çš„ hash å€¼é‡æ–°è®¡ç®—è¿‡ï¼ŒHashtable ç›´æ¥ä½¿ç”¨ hashCodeã€‚</li><li>HashMap å»æ‰äº† Hashtable ä¸­çš„ contains æ–¹æ³•ã€‚</li><li>HashMap ç»§æ‰¿è‡ª AbstractMap ç±»ï¼ŒHashtable ç»§æ‰¿è‡ª Dictionary ç±»ã€‚</li></ul><h4 id="22-å¦‚ä½•å†³å®šä½¿ç”¨-HashMap-è¿˜æ˜¯-TreeMapï¼Ÿ">22.å¦‚ä½•å†³å®šä½¿ç”¨ HashMap è¿˜æ˜¯ TreeMapï¼Ÿ</h4><p>å¯¹äºåœ¨ Map ä¸­æ’å…¥ã€åˆ é™¤ã€å®šä½ä¸€ä¸ªå…ƒç´ è¿™ç±»æ“ä½œï¼ŒHashMap æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºç›¸å¯¹è€Œè¨€ HashMap çš„æ’å…¥ä¼šæ›´å¿«ï¼Œä½†å¦‚æœä½ è¦å¯¹ä¸€ä¸ª key é›†åˆè¿›è¡Œæœ‰åºçš„éå†ï¼Œé‚£ TreeMap æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p><h4 id="23-è¯´ä¸€ä¸‹-HashMap-çš„å®ç°åŸç†ï¼Ÿ">23.è¯´ä¸€ä¸‹ HashMap çš„å®ç°åŸç†ï¼Ÿ</h4><p>HashMap åŸºäº Hash ç®—æ³•å®ç°çš„ï¼Œæˆ‘ä»¬é€šè¿‡ put(key,value)å­˜å‚¨ï¼Œget(key)æ¥è·å–ã€‚å½“ä¼ å…¥ key æ—¶ï¼ŒHashMap ä¼šæ ¹æ® key.hashCode() è®¡ç®—å‡º hash å€¼ï¼Œæ ¹æ® hash å€¼å°† value ä¿å­˜åœ¨ bucket é‡Œã€‚å½“è®¡ç®—å‡ºçš„ hash å€¼ç›¸åŒæ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º hash å†²çªï¼ŒHashMap çš„åšæ³•æ˜¯ç”¨é“¾è¡¨å’Œçº¢é»‘æ ‘å­˜å‚¨ç›¸åŒ hash å€¼çš„ valueã€‚å½“ hash å†²çªçš„ä¸ªæ•°æ¯”è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨é“¾è¡¨å¦åˆ™ä½¿ç”¨çº¢é»‘æ ‘ã€‚</p><p>==HashMapçš„é“¾è¡¨ä¸Šæ•°æ®èŠ‚ç‚¹è¶…è¿‡8æ—¶ï¼Œå°±ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚==</p><ol><li><p>è¡¥å……ï¼š</p><ol><li>å¤´ç»“ç‚¹æ˜¯HashMap&lt;K,V&gt; tableè¡¨ä¸Šç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹</li><li>çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ä¸ä¸€å®šæ˜¯ç´¢å¼•ä½ç½®çš„å¤´ç»“ç‚¹ï¼ŒHashMapé€šè¿‡moveRootToFontæ¥ç»´æŠ¤å¤´ç»“ç‚¹çš„ä½ç½®ã€‚</li><li>è½¬æ¢ä¸ºçº¢é»‘æ ‘ä¹‹åï¼Œé“¾è¡¨çš„ç»“æ„è¿˜å­˜åœ¨ï¼Œé€šè¿‡nextå±æ€§æ¥ç»´æŒï¼Œçº¢é»‘æ ‘ä¸Šçš„ä»»ä½•æ“ä½œéƒ½ä¼šé¡ºå¸¦ç»´æŠ¤é“¾è¡¨ç»“æ„ã€‚</li><li>åœ¨çº¢é»‘æ ‘ä¸Šï¼Œå¶å­ç»“ç‚¹ä¹Ÿå¯èƒ½æ˜¯nextèŠ‚ç‚¹ï¼Œä¸¤ç§ç»“æ„äº’ä¸å½±å“ã€‚</li><li>æºç ä¸­ï¼Œåœ¨è¿›è¡Œçº¢é»‘æ ‘çš„æŸ¥æ‰¾æ—¶ï¼Œä¼šåˆ©ç”¨ä»¥ä¸‹ä¸¤ç§è§„åˆ™ï¼š<ol><li>å¦‚æœç›®æ ‡èŠ‚ç‚¹çš„ hash å€¼å°äº p èŠ‚ç‚¹çš„ hash å€¼ï¼Œåˆ™å‘ p èŠ‚ç‚¹çš„å·¦è¾¹éå†ï¼›å¦åˆ™å‘ p èŠ‚ç‚¹çš„å³è¾¹éå†ã€‚</li><li>å¦‚æœç›®æ ‡èŠ‚ç‚¹çš„ key å€¼å°äº p èŠ‚ç‚¹çš„ key å€¼ï¼Œåˆ™å‘ p èŠ‚ç‚¹çš„å·¦è¾¹éå†ï¼›å¦åˆ™å‘ p èŠ‚ç‚¹çš„å³è¾¹éå†ã€‚ï¼ˆå·¦èŠ‚ç‚¹ &lt; æ ¹èŠ‚ç‚¹ &lt; å³èŠ‚ç‚¹ï¼‰</li></ol></li></ol></li><li><p>é»˜è®¤å®¹é‡ï¼š16</p></li><li><p>é»˜è®¤è´Ÿè½½å› å­ï¼š0.75</p></li><li><p>é“¾è¡¨èŠ‚ç‚¹è½¬æ¢çš„çº¢é»‘æ ‘çš„é˜ˆå€¼ï¼š8</p></li><li><p>çº¢é»‘æ ‘è½¬é“¾è¡¨çš„é˜ˆå€¼ï¼š6</p></li><li><p>è½¬çº¢é»‘æ ‘çš„æ—¶å€™ï¼Œtableçš„é•¿åº¦é˜ˆå€¼ï¼š64</p></li><li><p><strong>getæ–¹æ³•</strong></p><ol><li>å¯¹tableè¿›è¡Œæ ¡éªŒï¼štableä¸ä¸ºç©º&amp;&amp;tableé•¿åº¦å¤§äº0&amp;&amp;ç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹ä¸ä¸ºç©º</li><li>ç„¶åæ£€æŸ¥firstèŠ‚ç‚¹æ˜¯ç›®æ ‡å…¥å‚ï¼Œæ˜¯è¿”å›ï¼Œä¸æ˜¯æ‰§è¡Œ3ã€‚</li><li>é€šè¿‡nextéå†firstä¸‹çš„é“¾è¡¨<ol><li>å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹çš„æ–¹æ³•getTreeNode()</li><li>ä¸æ˜¯åˆ™éå†é“¾è¡¨ï¼Œæ‰¾åˆ°èŠ‚ç‚¹keyå’Œå…¥å‚keyç›¸ç­‰çš„å€¼ï¼Œè¿”å›value</li></ol></li></ol></li><li><p><strong>putæ–¹æ³•</strong></p><ol><li>æ ¡éªŒtableæ˜¯å¦ä¸ºç©º&amp;&amp;é•¿åº¦==0ï¼Œå¦‚æœæ˜¯è°ƒç”¨resize()è¿›è¡Œåˆå§‹åŒ–ã€‚<ol><li>é€šè¿‡Hashå€¼è®¡ç®—ç´¢å¼•ä½ç½®ï¼Œå°†è¯¥ç´¢å¼•ä½ç½®çš„å¤´ç»“ç‚¹èµ‹å€¼ç»™Pï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™åœ¨æ­¤æ–°å¢èŠ‚ç‚¹ã€‚</li></ol></li><li>è‹¥tableä¸ä¸ºç©ºï¼Œåˆ¤æ–­pçš„keyçš„hashå€¼æ˜¯å¦ä¸€æ ·ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å°†pèµ‹å€¼ç»™eèŠ‚ç‚¹</li><li>åˆ¤æ–­pèŠ‚ç‚¹æ˜¯ä¸æ˜¯TreeNodeï¼Œå¦‚æœæ˜¯è°ƒç”¨çº¢é»‘æ ‘çš„putTreeValæ–¹æ³•æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹</li><li>å¦åˆ™ï¼Œæ˜¯æ™®é€šé“¾è¡¨èŠ‚ç‚¹ï¼ˆä½¿ç”¨bincountè®¡æ•°ï¼‰<ol><li>å¦‚æœpçš„nextä¸ºç©ºï¼Œåˆ™æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹æ’å…¥å°¾éƒ¨ã€‚<ol><li>å¦‚æœbincountçš„å€¼è¶…è¿‡8ä¸ªï¼Œåˆ™è°ƒç”¨treeifyBinå°†é“¾è¡¨èŠ‚ç‚¹è½¬æ¢ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹</li></ol></li><li>å¦‚æœeèŠ‚ç‚¹å­˜åœ¨hashå€¼å’Œkeyå€¼éƒ½ä¸ä¼ å…¥çš„ç›¸åŒï¼Œåˆ™eèŠ‚ç‚¹å³ä¸ºç›®æ ‡èŠ‚ç‚¹ã€‚pæŒ‡å‘eã€‚</li></ol></li><li>å¦‚æœeçš„èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™ä»£è¡¨ç›®æ ‡èŠ‚ç‚¹å­˜åœ¨ï¼Œä½¿ç”¨valueè¦†ç›–è¯¥èŠ‚ç‚¹çš„valueï¼Œå¹¶è¿”å›oldValueã€‚</li><li>å¦‚æœæ’å…¥èŠ‚ç‚¹åèŠ‚ç‚¹æ•°è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™è°ƒç”¨resizeæ–¹æ³•è¿›è¡Œæ‰©å®¹</li></ol></li><li><p><strong>æ‰©å®¹</strong>resizeæ–¹æ³•</p><ol><li><p>å¦‚æœoldè¡¨çš„å®¹é‡ä¸ä¸º0</p><ol><li>åˆ¤æ–­oldè¡¨çš„å®¹é‡æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡ï¼Œå¦‚æœè¶…è¿‡æœ€å¤§é˜ˆå€¼è®¾ç½®ä¸ºInterger.MAX_VALUEï¼Œå¹¶ç›´æ¥è¿”å›oldè¡¨ã€‚æ­¤æ—¶oldCap*2æ¯”Integer.MAX_VALUEå¤§ï¼Œå› æ­¤æ— æ³•è¿›è¡Œé‡æ–°åˆ†å¸ƒï¼Œåªæ˜¯å•çº¯çš„å°†é˜ˆå€¼æ‰©å®¹åˆ°æœ€å¤§ã€‚</li><li>==å°†newCapèµ‹å€¼ä¸ºoldCapçš„2å€ï¼Œå¦‚æœnewCap&lt;æœ€å¤§å®¹é‡å¹¶ä¸”oldCap&gt;=16ï¼Œåˆ™å°†æ–°é˜ˆå€¼è®¾ç½®ä¸ºåŸæ¥çš„ä¸¤å€==</li></ol></li><li><p>å¦‚æœoldè¡¨çš„å®¹é‡ä¸º0ï¼Œé˜ˆå€¼&gt;0ï¼Œæ˜¯å› ä¸ºåˆå§‹å®¹é‡è¢«æ”¾å…¥é˜ˆå€¼ï¼Œåˆ™å°†æ–°è¡¨çš„å®¹é‡è®¾ç½®ä¸ºoldè¡¨çš„é˜ˆå€¼</p></li><li><p>å¦‚æœoldè¡¨çš„å®¹é‡ä¸º0ï¼Œé˜ˆå€¼&gt;=0ï¼Œè¿™ç§æƒ…å†µæ˜¯æ²¡æœ‰ç©¿åˆå§‹å®¹é‡çš„newæ–¹æ³•åˆ›å»ºçš„ç©ºè¡¨ï¼Œå°†é˜ˆå€¼å’Œå®¹é‡è®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚</p></li><li><p>å¦‚æœæ–°è¡¨çš„é˜ˆå€¼ä¸ºç©ºï¼Œåˆ™é€šè¿‡æ–°çš„å®¹é‡*è´Ÿè½½å› å­è·å¾—é˜ˆå€¼ã€‚</p></li><li><p>å°†å½“å‰é˜ˆå€¼è®¾ç½®æˆæ–°è®¡ç®—å‡ºæ¥çš„æ–°çš„é˜ˆå€¼ï¼Œå®šä¹‰æ–°è¡¨ï¼Œå®¹é‡ä¸ºåˆšè®¡ç®—å‡ºæ¥çš„æ–°å®¹é‡ï¼Œå°†tableè®¾ç½®ä¸ºæ–°å®šä¹‰çš„è¡¨ã€‚</p></li><li><p>æ‰©å®¹åï¼ŒèŠ‚ç‚¹é‡ hash ä¸ºä»€ä¹ˆåªå¯èƒ½åˆ†å¸ƒåœ¨ â€œåŸç´¢å¼•ä½ç½®â€ ä¸ â€œåŸç´¢å¼• + oldCap ä½ç½®â€œã€‚ï¼ˆé’ˆå¯¹äºæ™®é€šçš„é“¾è¡¨èŠ‚ç‚¹ï¼‰</p></li></ol></li></ol><h4 id="24-è¯´ä¸€ä¸‹-HashSet-çš„å®ç°åŸç†ï¼Ÿ">24.è¯´ä¸€ä¸‹ HashSet çš„å®ç°åŸç†ï¼Ÿ</h4><p>HashSet æ˜¯åŸºäº HashMap å®ç°çš„ï¼ŒHashSet åº•å±‚ä½¿ç”¨ HashMap æ¥ä¿å­˜æ‰€æœ‰å…ƒç´ ï¼Œå› æ­¤ HashSet çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œç›¸å…³ HashSet çš„æ“ä½œï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç›´æ¥è°ƒç”¨åº•å±‚ HashMap çš„ç›¸å…³æ–¹æ³•æ¥å®Œæˆï¼ŒHashSet ä¸å…è®¸é‡å¤çš„å€¼ã€‚</p><h4 id="25-ArrayList-å’Œ-LinkedList-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">25.ArrayList å’Œ LinkedList çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>æ•°æ®ç»“æ„å®ç°ï¼šArrayList æ˜¯åŠ¨æ€æ•°ç»„çš„æ•°æ®ç»“æ„å®ç°ï¼Œè€Œ LinkedList æ˜¯åŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„å®ç°ã€‚</li><li>éšæœºè®¿é—®æ•ˆç‡ï¼šArrayList æ¯” LinkedList åœ¨éšæœºè®¿é—®çš„æ—¶å€™æ•ˆç‡è¦é«˜ï¼Œå› ä¸º LinkedList æ˜¯çº¿æ€§çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œæ‰€ä»¥éœ€è¦ç§»åŠ¨æŒ‡é’ˆä»å‰å¾€åä¾æ¬¡æŸ¥æ‰¾ã€‚</li><li>å¢åŠ å’Œåˆ é™¤æ•ˆç‡ï¼šåœ¨éé¦–å°¾çš„å¢åŠ å’Œåˆ é™¤æ“ä½œï¼ŒLinkedList è¦æ¯” ArrayList æ•ˆç‡è¦é«˜ï¼Œå› ä¸º ArrayList å¢åˆ æ“ä½œè¦å½±å“æ•°ç»„å†…çš„å…¶ä»–æ•°æ®çš„ä¸‹æ ‡ã€‚</li></ul><p>ç»¼åˆæ¥è¯´ï¼Œåœ¨éœ€è¦é¢‘ç¹è¯»å–é›†åˆä¸­çš„å…ƒç´ æ—¶ï¼Œæ›´æ¨èä½¿ç”¨ ArrayListï¼Œè€Œåœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œè¾ƒå¤šæ—¶ï¼Œæ›´æ¨èä½¿ç”¨ LinkedListã€‚</p><h4 id="26-å¦‚ä½•å®ç°æ•°ç»„å’Œ-List-ä¹‹é—´çš„è½¬æ¢ï¼Ÿ">26.å¦‚ä½•å®ç°æ•°ç»„å’Œ List ä¹‹é—´çš„è½¬æ¢ï¼Ÿ</h4><ul><li>æ•°ç»„è½¬ Listï¼šä½¿ç”¨ Arrays.asList(array) è¿›è¡Œè½¬æ¢ã€‚</li><li>List è½¬æ•°ç»„ï¼šä½¿ç”¨ List è‡ªå¸¦çš„ toArray() æ–¹æ³•ã€‚</li></ul><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// list to array</span><br>List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<br>list.add(<span class="hljs-string">&quot;ç‹ç£Š&quot;</span>);<br>list.add(<span class="hljs-string">&quot;çš„åšå®¢&quot;</span>);<br>list.toArray();<br><span class="hljs-comment">// array to list</span><br>String[] array = <span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">&quot;ç‹ç£Š&quot;</span>,<span class="hljs-string">&quot;çš„åšå®¢&quot;</span>&#125;;<br>Arrays.asList(array);<br></code></pre></td></tr></table></figure><h4 id="27-ArrayList-å’Œ-Vector-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">27.ArrayList å’Œ Vector çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>çº¿ç¨‹å®‰å…¨ï¼šVector ä½¿ç”¨äº† Synchronized æ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ ArrayList æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>æ€§èƒ½ï¼šArrayList åœ¨æ€§èƒ½æ–¹é¢è¦ä¼˜äº Vectorã€‚</li><li>æ‰©å®¹ï¼šArrayList å’Œ Vector éƒ½ä¼šæ ¹æ®å®é™…çš„éœ€è¦åŠ¨æ€çš„è°ƒæ•´å®¹é‡ï¼Œåªä¸è¿‡åœ¨ Vector æ‰©å®¹æ¯æ¬¡ä¼šå¢åŠ  1 å€ï¼Œè€Œ ArrayList åªä¼šå¢åŠ  50%ã€‚</li></ul><h4 id="28-Array-å’Œ-ArrayList-æœ‰ä½•åŒºåˆ«ï¼Ÿ">28.Array å’Œ ArrayList æœ‰ä½•åŒºåˆ«ï¼Ÿ</h4><ul><li>Array å¯ä»¥å­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡ï¼ŒArrayList åªèƒ½å­˜å‚¨å¯¹è±¡ã€‚</li><li>Array æ˜¯æŒ‡å®šå›ºå®šå¤§å°çš„ï¼Œè€Œ ArrayList å¤§å°æ˜¯è‡ªåŠ¨æ‰©å±•çš„ã€‚</li><li>Array å†…ç½®æ–¹æ³•æ²¡æœ‰ ArrayList å¤šï¼Œæ¯”å¦‚ addAllã€removeAllã€iteration ç­‰æ–¹æ³•åªæœ‰ ArrayList æœ‰ã€‚</li></ul><h4 id="29-åœ¨-Queue-ä¸­-poll-å’Œ-remove-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">29.åœ¨ Queue ä¸­ poll()å’Œ remove()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>ç›¸åŒç‚¹ï¼šéƒ½æ˜¯è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶åœ¨é˜Ÿåˆ—ä¸­åˆ é™¤è¿”å›çš„å¯¹è±¡ã€‚</li><li>ä¸åŒç‚¹ï¼šå¦‚æœæ²¡æœ‰å…ƒç´  poll()ä¼šè¿”å› nullï¼Œè€Œ remove()ä¼šç›´æ¥æŠ›å‡º NoSuchElementException å¼‚å¸¸ã€‚</li></ul><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Queue&lt;String&gt; queue = <span class="hljs-keyword">new</span> LinkedList&lt;String&gt;();<br>queue.offer(<span class="hljs-string">&quot;string&quot;</span>); <span class="hljs-comment">// add</span><br>System.out.println(queue.poll());<br>System.out.println(queue.remove());<br>System.out.println(queue.size());<br></code></pre></td></tr></table></figure><h4 id="30-å“ªäº›é›†åˆç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ">30.å“ªäº›é›†åˆç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</h4><p>Vectorã€Hashtableã€Stack éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œåƒ HashMap åˆ™æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸è¿‡åœ¨ jdk 1.5 ä¹‹åéšç€ java.util.concurrent å¹¶å‘åŒ…çš„å‡ºç°ï¼Œå®ƒä»¬ä¹Ÿæœ‰äº†è‡ªå·±å¯¹åº”çš„çº¿ç¨‹å®‰å…¨ç±»ï¼Œæ¯”å¦‚ HashMap å¯¹åº”çš„çº¿ç¨‹å®‰å…¨ç±»å°±æ˜¯ ConcurrentHashMapã€‚</p><h4 id="31-è¿­ä»£å™¨-Iterator-æ˜¯ä»€ä¹ˆï¼Ÿ">31.è¿­ä»£å™¨ Iterator æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>Iterator æ¥å£æä¾›éå†ä»»ä½• Collection çš„æ¥å£ã€‚æˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ª Collection ä¸­ä½¿ç”¨è¿­ä»£å™¨æ–¹æ³•æ¥è·å–è¿­ä»£å™¨å®ä¾‹ã€‚è¿­ä»£å™¨å–ä»£äº† java é›†åˆæ¡†æ¶ä¸­çš„ Enumerationï¼Œè¿­ä»£å™¨å…è®¸è°ƒç”¨è€…åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ç§»é™¤å…ƒç´ ã€‚</p><h4 id="32-Iterator-æ€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ">32.Iterator æ€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</h4><p>Iterator ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>Iterator&lt;String&gt; it = list.iterator();<br><span class="hljs-keyword">while</span>(it.hasNext())&#123;<br>  String obj = it.next();<br>  System.out.println(obj);<br>&#125;<br></code></pre></td></tr></table></figure><p>Iterator çš„ç‰¹ç‚¹æ˜¯æ›´åŠ å®‰å…¨ï¼Œå› ä¸ºå®ƒå¯ä»¥ç¡®ä¿ï¼Œåœ¨å½“å‰éå†çš„é›†åˆå…ƒç´ è¢«æ›´æ”¹çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸ã€‚</p><h4 id="33-Iterator-å’Œ-ListIterator-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">33.Iterator å’Œ ListIterator æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>Iterator å¯ä»¥éå† Set å’Œ List é›†åˆï¼Œè€Œ ListIterator åªèƒ½éå† Listã€‚</li><li>Iterator åªèƒ½å•å‘éå†ï¼Œè€Œ ListIterator å¯ä»¥åŒå‘éå†ï¼ˆå‘å‰/åéå†ï¼‰ã€‚</li><li>ListIterator ä» Iterator æ¥å£ç»§æ‰¿ï¼Œç„¶åæ·»åŠ äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€æ›¿æ¢ä¸€ä¸ªå…ƒç´ ã€è·å–å‰é¢æˆ–åé¢å…ƒç´ çš„ç´¢å¼•ä½ç½®ã€‚</li></ul><h4 id="34-æ€ä¹ˆç¡®ä¿ä¸€ä¸ªé›†åˆä¸èƒ½è¢«ä¿®æ”¹ï¼Ÿ">34.æ€ä¹ˆç¡®ä¿ä¸€ä¸ªé›†åˆä¸èƒ½è¢«ä¿®æ”¹ï¼Ÿ</h4><p>å¯ä»¥ä½¿ç”¨ Collections.unmodifiableCollection(Collection c) æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªåªè¯»é›†åˆï¼Œè¿™æ ·æ”¹å˜é›†åˆçš„ä»»ä½•æ“ä½œéƒ½ä¼šæŠ›å‡º java.lang.UnsupportedOperationException å¼‚å¸¸ã€‚</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>list.add(<span class="hljs-string">&quot;x&quot;</span>);<br>Collection&lt;String&gt; clist = Collections.unmodifiableCollection(list);<br>clist.add(<span class="hljs-string">&quot;y&quot;</span>); <span class="hljs-comment">// è¿è¡Œæ—¶æ­¤è¡ŒæŠ¥é”™</span><br>System.out.println(list.size());<br></code></pre></td></tr></table></figure><h3 id="ä¸‰ã€å¤šçº¿ç¨‹">ä¸‰ã€å¤šçº¿ç¨‹</h3><h4 id="35-å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">35.å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨æˆ–å¤šæ ¸å¤„ç†å™¨åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚</li><li>å¹¶å‘ï¼šå¤šä¸ªä»»åŠ¡åœ¨åŒä¸€ä¸ª CPU æ ¸ä¸Šï¼ŒæŒ‰ç»†åˆ†çš„æ—¶é—´ç‰‡è½®æµ(äº¤æ›¿)æ‰§è¡Œï¼Œä»é€»è¾‘ä¸Šæ¥çœ‹é‚£äº›ä»»åŠ¡æ˜¯åŒæ—¶æ‰§è¡Œã€‚</li></ul><p>å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://icdn.apigo.cn/gitchat/gitchat208-010.png" alt=""></p><p>å¹¶å‘ = ä¸¤ä¸ªé˜Ÿåˆ—å’Œä¸€å°å’–å•¡æœºã€‚</p><p>å¹¶è¡Œ = ä¸¤ä¸ªé˜Ÿåˆ—å’Œä¸¤å°å’–å•¡æœºã€‚</p><h4 id="36-çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ">36.çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ</h4><p>ä¸€ä¸ªç¨‹åºä¸‹è‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸‹ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹æ¥å¢åŠ ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ã€‚</p><h4 id="37-å®ˆæŠ¤çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ">37.å®ˆæŠ¤çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>å®ˆæŠ¤çº¿ç¨‹æ˜¯è¿è¡Œåœ¨åå°çš„ä¸€ç§ç‰¹æ®Šè¿›ç¨‹ã€‚å®ƒç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯å¹¶ä¸”å‘¨æœŸæ€§åœ°æ‰§è¡ŒæŸç§ä»»åŠ¡æˆ–ç­‰å¾…å¤„ç†æŸäº›å‘ç”Ÿçš„äº‹ä»¶ã€‚åœ¨ java ä¸­åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯ç‰¹æ®Šçš„å®ˆæŠ¤çº¿ç¨‹ã€‚</p><h4 id="38-åˆ›å»ºçº¿ç¨‹æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ">38.åˆ›å»ºçº¿ç¨‹æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</h4><p>åˆ›å»ºçº¿ç¨‹æœ‰å››ç§æ–¹å¼ï¼š</p><ul><li>ç»§æ‰¿ Thread é‡å†™ run æ–¹æ³•ï¼›</li><li>å®ç° Runnable æ¥å£ï¼›</li><li>å®ç° Callable æ¥å£ã€‚</li><li>ä½¿ç”¨çº¿ç¨‹æ± ThreadPoolExecutorã€‚</li></ul><h4 id="39-è¯´ä¸€ä¸‹-runnable-å’Œ-callable-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">39.è¯´ä¸€ä¸‹ runnable å’Œ callable æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>runnable æ²¡æœ‰è¿”å›å€¼ï¼Œcallable å¯ä»¥æ‹¿åˆ°æœ‰è¿”å›å€¼ï¼Œcallable å¯ä»¥çœ‹ä½œæ˜¯ runnable çš„è¡¥å……ã€‚</p><p>FutureTaskç±»ï¼š</p><ol><li><p>â€‹ä¸€ä¸ªå¯å–æ¶ˆçš„å¼‚æ­¥è®¡ç®—ã€‚FutureTaskæä¾›äº†å¯¹Futureçš„åŸºæœ¬å®ç°ã€‚å¯ä»¥è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å»å¼€å§‹æˆ–è€…å–æ¶ˆä¸€ä¸ªè®¡ç®—ï¼Œå¹¶å¯ä»¥æŸ¥è¯¢å’Œè¿”å›ä¸€ä¸ªè®¡ç®—ç»“æœã€‚</p></li><li><p>FutureTaskè¿˜å®ç°äº†Runnableæ¥å£ï¼Œæ‰€ä»¥FutureTashçš„å®ä¾‹å¯¹è±¡å¯ä»¥äº¤ç»™Threadæˆ–è€…Excutoræ‰§è¡Œã€‚ä¹Ÿå¯ä»¥è‡ªå·±è°ƒç”¨futureTash.run()ï¼šåˆ†ä¸ºä¸‰ä¸ªçŠ¶æ€ï¼š</p><ol><li><p>æœªå¯åŠ¨</p></li><li><p>å·²å¯åŠ¨</p></li><li><p>å·²å®Œæˆ</p><p><img src="https://img-blog.csdnimg.cn/20190530214704456.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NjU0ODQx,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li><li></li></ol></li></ol><h4 id="40-çº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ">40.çº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ</h4><p>çº¿ç¨‹çš„çŠ¶æ€ï¼šnew Runnable Running  Blocked Dead</p><ul><li><p>NEW å°šæœªå¯åŠ¨</p></li><li><p>RUNNABLE å¯è¿è¡Œ/å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…åˆ†é…CPUæ—¶é—´ç‰‡</p></li><li><p>Running  è·å–CPUæ—¶é—´ç‰‡ï¼Œæ­£åœ¨è¿è¡Œ</p></li><li><p>BLOCKED é˜»å¡çš„ï¼ˆè¢«åŒæ­¥é”æˆ–è€…IOé”é˜»å¡ï¼‰</p><ul><li>çº¿ç¨‹é€šè¿‡è°ƒç”¨sleepæ–¹æ³•è¿›å…¥ç¡çœ çŠ¶æ€ï¼›</li><li>çº¿ç¨‹è°ƒç”¨ä¸€ä¸ªåœ¨I/Oä¸Šè¢«é˜»å¡çš„æ“ä½œï¼Œå³è¯¥æ“ä½œåœ¨è¾“å…¥è¾“å‡ºæ“ä½œå®Œæˆä¹‹å‰ä¸ä¼šè¿”å›åˆ°å®ƒçš„è°ƒç”¨è€…ï¼›ã€</li><li>çº¿ç¨‹è¯•å›¾å¾—åˆ°ä¸€ä¸ªé”ï¼Œè€Œè¯¥é”æ­£è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼›</li><li>çº¿ç¨‹åœ¨ç­‰å¾…æŸä¸ªè§¦å‘æ¡ä»¶ï¼›</li></ul></li><li><p>Dead ï¼šçº¿ç¨‹ç»“æŸï¼ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦æ´»ç€ç”¨ isAliveï¼ˆï¼‰æ–¹æ³•ï¼‰</p><ul><li>runæ–¹æ³•æ­£å¸¸é€€å‡ºè€Œè‡ªç„¶æ­»äº¡ï¼›</li><li>ä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸ç»ˆæ­¢äº†runæ–¹æ³•è€Œä½¿çº¿ç¨‹çŒæ­»ï¼›</li></ul><p><img src="https://img-blog.csdnimg.cn/20201228162648820.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li></ul><h4 id="41-sleep-å’Œ-wait-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">41.sleep() å’Œ wait() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>ç±»çš„ä¸åŒï¼šsleep() æ¥è‡ª Threadï¼Œwait() æ¥è‡ª Objectã€‚</li><li>é‡Šæ”¾é”ï¼šsleep() ä¸é‡Šæ”¾é”ï¼›wait() é‡Šæ”¾é”ã€‚</li><li>ç”¨æ³•ä¸åŒï¼šsleep() æ—¶é—´åˆ°ä¼šè‡ªåŠ¨æ¢å¤ï¼›wait() å¯ä»¥ä½¿ç”¨ notify()/notifyAll()ç›´æ¥å”¤é†’ã€‚è€Œä¸”ä½¿ç”¨waitçš„çº¿ç¨‹ä¼šè¿›å…¥Wait Seté›†ä¸­ã€‚</li></ul><h4 id="42-notify-å’Œ-notifyAll-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">42.notify()å’Œ notifyAll()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>notifyAll()ä¼šå”¤é†’æ‰€æœ‰çš„çº¿ç¨‹ï¼Œnotify()ä¹‹åå”¤é†’ä¸€ä¸ªçº¿ç¨‹ã€‚notifyAll() è°ƒç”¨åï¼Œä¼šå°†å…¨éƒ¨çº¿ç¨‹ç”±ç­‰å¾…æ± ç§»åˆ°é”æ± ï¼Œç„¶åå‚ä¸é”çš„ç«äº‰ï¼Œç«äº‰æˆåŠŸåˆ™ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœä¸æˆåŠŸåˆ™ç•™åœ¨é”æ± ç­‰å¾…é”è¢«é‡Šæ”¾åå†æ¬¡å‚ä¸ç«äº‰ã€‚è€Œ notify()åªä¼šå”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œå…·ä½“å”¤é†’å“ªä¸€ä¸ªçº¿ç¨‹ç”±è™šæ‹Ÿæœºæ§åˆ¶ã€‚å…¶ä¸­ç­‰å¾…æ± å°±æ˜¯ JVM ç»´æŠ¤çš„ Wait Seté›†åˆ</p><h4 id="43-çº¿ç¨‹çš„-run-å’Œ-start-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">43.çº¿ç¨‹çš„ run()å’Œ start()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>start()æ–¹æ³•ç”¨äºå¯åŠ¨çº¿ç¨‹ï¼Œrun()æ–¹æ³•ç”¨äºæ‰§è¡Œçº¿ç¨‹çš„è¿è¡Œæ—¶ä»£ç ã€‚run() å¯ä»¥é‡å¤è°ƒç”¨ï¼Œè€Œ start()åªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚</p><h4 id="44-åˆ›å»ºçº¿ç¨‹æ± æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ">44.åˆ›å»ºçº¿ç¨‹æ± æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</h4><p>çº¿ç¨‹æ± åˆ›å»ºæœ‰ä¸ƒç§æ–¹å¼ï¼Œæœ€æ ¸å¿ƒçš„æ˜¯æœ€åä¸€ç§ï¼š</p><ul><li>new SingleThreadExecutor()ï¼šå®ƒçš„ç‰¹ç‚¹åœ¨äºå·¥ä½œçº¿ç¨‹æ•°ç›®è¢«é™åˆ¶ä¸º 1ï¼Œæ“ä½œä¸€ä¸ªæ— ç•Œçš„å·¥ä½œé˜Ÿåˆ—ï¼Œæ‰€ä»¥å®ƒä¿è¯äº†æ‰€æœ‰ä»»åŠ¡çš„éƒ½æ˜¯è¢«é¡ºåºæ‰§è¡Œï¼Œæœ€å¤šä¼šæœ‰ä¸€ä¸ªä»»åŠ¡å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”ä¸å…è®¸ä½¿ç”¨è€…æ”¹åŠ¨çº¿ç¨‹æ± å®ä¾‹ï¼Œå› æ­¤å¯ä»¥é¿å…å…¶æ”¹å˜çº¿ç¨‹æ•°ç›®ï¼›</li><li>new CachedThreadPool()ï¼šå®ƒæ˜¯ä¸€ç§ç”¨æ¥å¤„ç†å¤§é‡çŸ­æ—¶é—´å·¥ä½œä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œå…·æœ‰å‡ ä¸ªé²œæ˜ç‰¹ç‚¹ï¼šå®ƒä¼šè¯•å›¾ç¼“å­˜çº¿ç¨‹å¹¶é‡ç”¨ï¼Œå½“æ— ç¼“å­˜çº¿ç¨‹å¯ç”¨æ—¶ï¼Œå°±ä¼šåˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼›å¦‚æœçº¿ç¨‹é—²ç½®çš„æ—¶é—´è¶…è¿‡ 60 ç§’ï¼Œåˆ™è¢«ç»ˆæ­¢å¹¶ç§»å‡ºç¼“å­˜ï¼›é•¿æ—¶é—´é—²ç½®æ—¶ï¼Œè¿™ç§çº¿ç¨‹æ± ï¼Œä¸ä¼šæ¶ˆè€—ä»€ä¹ˆèµ„æºã€‚å…¶å†…éƒ¨ä½¿ç”¨ SynchronousQueue ä½œä¸ºå·¥ä½œé˜Ÿåˆ—ï¼›</li><li>new FixedThreadPool(int nThreads)ï¼šé‡ç”¨æŒ‡å®šæ•°ç›®ï¼ˆnThreadsï¼‰çš„çº¿ç¨‹ï¼Œå…¶èƒŒåä½¿ç”¨çš„æ˜¯æ— ç•Œçš„å·¥ä½œé˜Ÿåˆ—ï¼Œä»»ä½•æ—¶å€™æœ€å¤šæœ‰ nThreads ä¸ªå·¥ä½œçº¿ç¨‹æ˜¯æ´»åŠ¨çš„ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä»»åŠ¡æ•°é‡è¶…è¿‡äº†æ´»åŠ¨é˜Ÿåˆ—æ•°ç›®ï¼Œå°†åœ¨å·¥ä½œé˜Ÿåˆ—ä¸­ç­‰å¾…ç©ºé—²çº¿ç¨‹å‡ºç°ï¼›å¦‚æœæœ‰å·¥ä½œçº¿ç¨‹é€€å‡ºï¼Œå°†ä¼šæœ‰æ–°çš„å·¥ä½œçº¿ç¨‹è¢«åˆ›å»ºï¼Œä»¥è¡¥è¶³æŒ‡å®šçš„æ•°ç›® nThreadsï¼›</li><li>new SingleThreadScheduledExecutor()ï¼šåˆ›å»ºå•çº¿ç¨‹æ± ï¼Œè¿”å› ScheduledExecutorServiceï¼Œå¯ä»¥è¿›è¡Œå®šæ—¶æˆ–å‘¨æœŸæ€§çš„å·¥ä½œè°ƒåº¦ï¼›</li><li>new ScheduledThreadPool(int corePoolSize)ï¼šå’Œnew SingleThreadScheduledExecutor()ç±»ä¼¼ï¼Œåˆ›å»ºçš„æ˜¯ä¸ª ScheduledExecutorServiceï¼Œå¯ä»¥è¿›è¡Œå®šæ—¶æˆ–å‘¨æœŸæ€§çš„å·¥ä½œè°ƒåº¦ï¼ŒåŒºåˆ«åœ¨äºå•ä¸€å·¥ä½œçº¿ç¨‹è¿˜æ˜¯å¤šä¸ªå·¥ä½œçº¿ç¨‹ï¼›</li><li>new WorkStealingPool(int parallelism)ï¼šè¿™æ˜¯ä¸€ä¸ªç»å¸¸è¢«äººå¿½ç•¥çš„çº¿ç¨‹æ± ï¼ŒJava 8 æ‰åŠ å…¥è¿™ä¸ªåˆ›å»ºæ–¹æ³•ï¼Œå…¶å†…éƒ¨ä¼šæ„å»ºForkJoinPoolï¼Œåˆ©ç”¨Work-Stealingç®—æ³•ï¼Œå¹¶è¡Œåœ°å¤„ç†ä»»åŠ¡ï¼Œä¸ä¿è¯å¤„ç†é¡ºåºï¼›</li><li>ThreadPoolExecutor()ï¼šæ˜¯æœ€åŸå§‹çš„çº¿ç¨‹æ± åˆ›å»ºï¼Œä¸Šé¢1-3åˆ›å»ºæ–¹å¼éƒ½æ˜¯å¯¹ThreadPoolExecutorçš„å°è£…ã€‚</li></ul><h4 id="45-çº¿ç¨‹æ± éƒ½æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ">45.çº¿ç¨‹æ± éƒ½æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ</h4><ul><li><p>RUNNINGï¼šè¿™æ˜¯æœ€æ­£å¸¸çš„çŠ¶æ€ï¼Œæ¥å—æ–°çš„ä»»åŠ¡ï¼Œå¤„ç†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</p></li><li><p>SHUTDOWNï¼šä¸æ¥å—æ–°çš„ä»»åŠ¡æäº¤ï¼Œä½†æ˜¯ä¼šç»§ç»­å¤„ç†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</p></li><li><p>STOPï¼šä¸æ¥å—æ–°çš„ä»»åŠ¡æäº¤ï¼Œä¸å†å¤„ç†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä¸­æ–­æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ã€‚</p></li><li><p>TIDYINGï¼šæ‰€æœ‰çš„ä»»åŠ¡éƒ½é”€æ¯äº†ï¼ŒworkCount ä¸º 0ï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€åœ¨è½¬æ¢ä¸º TIDYING çŠ¶æ€æ—¶ï¼Œä¼šæ‰§è¡Œé’©å­æ–¹æ³• terminated()ã€‚</p></li><li><p>TERMINATEDï¼šterminated()æ–¹æ³•ç»“æŸåï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€å°±ä¼šå˜æˆè¿™ä¸ªã€‚</p><p><img src="https://img-blog.csdnimg.cn/20201228162704883.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li></ul><h4 id="46-çº¿ç¨‹æ± ä¸­-submit-å’Œ-execute-æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">46.çº¿ç¨‹æ± ä¸­ submit()å’Œ execute()æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li><p>execute()ï¼šåªèƒ½æ‰§è¡Œ Runnable ç±»å‹çš„ä»»åŠ¡ã€‚</p></li><li><p>submit()ï¼šå¯ä»¥æ‰§è¡Œ Runnable å’Œ Callable ç±»å‹çš„ä»»åŠ¡ã€‚</p></li><li><p>æ–¹æ³•æ‰€åœ¨çš„ç±»ä¸åŒï¼š<br><code>execute</code> æ–¹æ³•ï¼š<code>java.util.concurrent.Executor</code>;<br><code>submit</code>æ–¹æ³•ï¼š<code>java.util.concurrent.ExecutorService</code></p></li><li><p>æ‰€éœ€è¦çš„å‚æ•°ä¸åŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">execute : java.util.concurrent.Executor#execute(java.lang.Runnable)<br>submit: java.util.concurrent.ExecutorService#submit(java.lang.Runnable, T),<br>Â Â Â  Â Â Â Â Â Â Â Â Â Â Â java.util.concurrent.ExecutorService#submit(java.lang.Runnable)<br>Â Â Â  Â Â Â Â Â Â Â Â Â Â Â java.util.concurrent.ExecutorService#submit(java.util.concurrent.Callable&lt;T&gt;)<br><br></code></pre></td></tr></table></figure></li></ul><p>Callable ç±»å‹çš„ä»»åŠ¡å¯ä»¥è·å–æ‰§è¡Œçš„è¿”å›å€¼ï¼Œè€Œ Runnable æ‰§è¡Œæ— è¿”å›å€¼ã€‚</p><h4 id="47-åœ¨-java-ç¨‹åºä¸­æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹çš„è¿è¡Œå®‰å…¨ï¼Ÿ">47.åœ¨ java ç¨‹åºä¸­æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹çš„è¿è¡Œå®‰å…¨ï¼Ÿ</h4><ul><li>æ–¹æ³•ä¸€ï¼šä½¿ç”¨å®‰å…¨ç±»ï¼Œæ¯”å¦‚ java.util.concurrent ä¸‹çš„ç±»ã€‚</li><li>æ–¹æ³•äºŒï¼šä½¿ç”¨è‡ªåŠ¨é” synchronizedã€‚</li><li>æ–¹æ³•ä¸‰ï¼šä½¿ç”¨æ‰‹åŠ¨é” Lockã€‚</li></ul><p>æ‰‹åŠ¨é” java ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">Lock lock = <span class="hljs-keyword">new</span> ReentrantLock();<br>lock.lock();<br><span class="hljs-keyword">try</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;è·å¾—é”&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> handle exception</span><br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;é‡Šæ”¾é”&quot;</span>);<br>    lock.unlock();<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="48-å¤šçº¿ç¨‹ä¸­-synchronized-é”å‡çº§çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ">48.å¤šçº¿ç¨‹ä¸­ synchronized é”å‡çº§çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>synchronized é”å‡çº§åŸç†ï¼šåœ¨é”å¯¹è±¡çš„å¯¹è±¡å¤´é‡Œé¢æœ‰ä¸€ä¸ª threadid å­—æ®µï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™ threadid ä¸ºç©ºï¼Œjvm è®©å…¶æŒæœ‰åå‘é”ï¼Œå¹¶å°† threadid è®¾ç½®ä¸ºå…¶çº¿ç¨‹ idï¼Œå†æ¬¡è¿›å…¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­ threadid æ˜¯å¦ä¸å…¶çº¿ç¨‹ id ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨æ­¤å¯¹è±¡ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™å‡çº§åå‘é”ä¸ºè½»é‡çº§é”ï¼Œé€šè¿‡è‡ªæ—‹å¾ªç¯ä¸€å®šæ¬¡æ•°æ¥è·å–é”ï¼Œæ‰§è¡Œä¸€å®šæ¬¡æ•°ä¹‹åï¼Œå¦‚æœè¿˜æ²¡æœ‰æ­£å¸¸è·å–åˆ°è¦ä½¿ç”¨çš„å¯¹è±¡ï¼Œæ­¤æ—¶å°±ä¼šæŠŠé”ä»è½»é‡çº§å‡çº§ä¸ºé‡é‡çº§é”ï¼Œæ­¤è¿‡ç¨‹å°±æ„æˆäº† synchronized é”çš„å‡çº§ã€‚</p><p>é”çš„å‡çº§çš„ç›®çš„ï¼šé”å‡çº§æ˜¯ä¸ºäº†å‡ä½äº†é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚åœ¨ Java 6 ä¹‹åä¼˜åŒ– synchronized çš„å®ç°æ–¹å¼ï¼Œä½¿ç”¨äº†åå‘é”å‡çº§ä¸ºè½»é‡çº§é”å†å‡çº§åˆ°é‡é‡çº§é”çš„æ–¹å¼ï¼Œä»è€Œå‡ä½äº†é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚</p><h4 id="49-ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ">49.ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ</h4><p>å½“çº¿ç¨‹AæŒæœ‰ç‹¬å é”aï¼Œå¹¶å°è¯•å»è·å–ç‹¬å é”bçš„åŒæ—¶ï¼Œçº¿ç¨‹BæŒæœ‰ç‹¬å é”bï¼Œå¹¶å°è¯•è·å–ç‹¬å é”açš„æƒ…å†µä¸‹ï¼Œå°±ä¼šå‘ç”ŸABä¸¤ä¸ªçº¿ç¨‹ç”±äºäº’ç›¸æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”ï¼Œè€Œå‘ç”Ÿçš„é˜»å¡ç°è±¡ï¼Œæˆ‘ä»¬ç§°ä¸ºæ­»é”ã€‚</p><ol><li><strong>æ­»é”äº§ç”Ÿçš„åŸå› </strong>ï¼š<ol><li>ç³»ç»Ÿèµ„æºçš„ç«äº‰ï¼šå¤šä¸ªè¿›ç¨‹ä½¿ç”¨ä¸€ä¸ªèµ„æºé€ æˆçš„åƒµå±€ï¼Œä¾‹å¦‚æ‰“å°æœºã€‚</li><li>è¿›ç¨‹æ¨è¿›é¡ºåºçš„éæ³•ï¼šè¯·æ±‚å’Œé‡Šæ”¾èµ„æºçš„é¡ºåºé—®é¢˜</li><li>æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶ï¼šåªè¦ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±ä¸ä¼šäº§ç”Ÿæ­»é”ã€‚<ol><li>äº’æ–¥æ¡ä»¶ï¼šåŒä¸€æ—¶é—´å†…åªå…è®¸ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚</li><li>ä¸å‰¥å¤ºæ¡ä»¶ï¼šçº¿ç¨‹åœ¨è·å–èµ„æºè¿˜æ²¡ä½¿ç”¨å®Œæ¯•ï¼Œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œå¿…é¡»ç”±æ­¤çº¿ç¨‹è‡ªå·±é‡Šæ”¾</li><li>è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šçº¿ç¨‹å·²ç»ä¿æŒäº†è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†æ˜¯åˆè¯·æ±‚äº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œæ­¤æ—¶è¯·æ±‚èµ„æºè¿›ç¨‹ç­‰å¾…ï¼Œä¿æŒçš„èµ„æºä¸é‡Šæ”¾</li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šè¯·æ±‚èµ„æºçš„çº¿ç¨‹æ„æˆä¸€ä¸ªè¯·æ±‚èµ„æºé“¾{p1,p2â€¦pn}ï¼Œåä¸€ä¸ªçº¿ç¨‹å¿…é¡»ä¾èµ–äºå‰ä¸€ä¸ªçº¿ç¨‹ã€‚</li></ol></li></ol></li><li><strong>JVMå¯¹é”çš„ç»´æŠ¤</strong>ï¼š<ol><li>JVMåœ¨åº•å±‚ç»´æŠ¤äº†ä¸¤ä¸ªâ€œé˜Ÿåˆ—â€ï¼Œä¸€ä¸ªæ˜¯Entry Setï¼ˆå…¥å£é›†ï¼‰ï¼Œä¸€ä¸ªWait Setï¼ˆç­‰å¾…é›†ï¼‰</li><li>é¦–å…ˆæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰å”¯ä¸€ä¸€ä¸ªå†…éƒ¨çš„monitorï¼ˆå†…éƒ¨é”ï¼‰ï¼ŒEntry Setå­˜å‚¨æ‰€æœ‰çš„ç­‰å¾…è·å–èµ„æºçš„èµ„æºï¼ŒWait Setå­˜å‚¨æ‰§è¡Œäº†objectX.waitï¼ˆï¼‰çš„çº¿ç¨‹ã€‚</li><li>å‡è®¾ABCä¸‰ä¸ªçº¿ç¨‹ï¼ŒBçº¿ç¨‹è·å–äº†èµ„æºï¼Œçº¿ç¨‹ACè¿›å…¥Entry Setï¼Œç­‰å¾…è¯·æ±‚èµ„æºï¼ˆæ­¤æ—¶å¤„äºBLOCKEDçŠ¶æ€ï¼‰ï¼Œå½“Bé‡Šæ”¾èµ„æºï¼ŒEntry Seté˜Ÿåˆ—é‡Œéšæœºä¸€ä¸ªçº¿ç¨‹å‡ºåˆ—ä¸å…¶ä»–è·å–çš„çº¿ç¨‹æ¥äº‰å¤ºçº¿ç¨‹ï¼ˆå¤„äºRUNNABLEï¼‰ï¼ŒæŠ¢å æˆåŠŸå°±çœŸæ­£ç¦»å¼€Entry Setï¼Œå¦åˆ™ï¼Œå†å›åˆ°Entry Setã€‚</li><li>å¦‚æœæœ‰ä¸ªçº¿ç¨‹æ‰§è¡Œäº†objectX.waitï¼ˆï¼‰æ–¹æ³•ï¼Œåˆ™è¿›å…¥Wait Seté˜Ÿåˆ—ï¼Œå½“å…¶ä»–çº¿ç¨‹æ‰§è¡Œäº†objectX.notify()/notifyAll()æ–¹æ³•ï¼ŒWait Setä¸­çš„çº¿ç¨‹æ‰ä¼šç¦»å¼€é˜Ÿåˆ—ï¼Œå…±åŒå»æŠ¢å èµ„æºï¼Œå¦‚æœè¢«å”¤é†’çš„çº¿ç¨‹æŠ¢å¤ºäº†èµ„æºï¼Œåˆ™ä¼šç¦»å¼€é˜Ÿåˆ—ï¼Œå¦åˆ™ï¼Œå†æ¬¡å›åˆ°Wait Setä¸­</li></ol></li></ol><h4 id="50-æ€ä¹ˆé˜²æ­¢æ­»é”ï¼Ÿ">50.æ€ä¹ˆé˜²æ­¢æ­»é”ï¼Ÿ</h4><ul><li>å°½é‡ä½¿ç”¨ tryLock(long timeout, TimeUnit unit)çš„æ–¹æ³•(ReentrantLockã€ReentrantReadWriteLock)ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶å¯ä»¥é€€å‡ºé˜²æ­¢æ­»é”ã€‚ ï¼ˆè®¾ç½®åŠ é”æ—¶é•¿ï¼‰</li><li>å°½é‡ä½¿ç”¨ java.util.concurrent å¹¶å‘ç±»ä»£æ›¿è‡ªå·±æ‰‹å†™é”ã€‚</li><li>å°½é‡é™ä½é”çš„ä½¿ç”¨ç²’åº¦ï¼Œå°½é‡ä¸è¦å‡ ä¸ªåŠŸèƒ½ç”¨åŒä¸€æŠŠé”ã€‚</li><li>åŠ é”é¡ºåºã€‚</li><li>æ­»é”æ£€æµ‹ã€‚å¹¶ä¸”ç»™çº¿ç¨‹è®¾ç½®ä¼˜å…ˆçº§ã€‚</li></ul><h4 id="51-ThreadLocal-æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ">51.ThreadLocal æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</h4><p>ThreadLocal ä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶å®ƒçº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬ã€‚</p><p>ThreadLocal çš„ç»å…¸ä½¿ç”¨åœºæ™¯æ˜¯æ•°æ®åº“è¿æ¥å’Œ session ç®¡ç†ç­‰ã€‚</p><h4 id="52-è¯´ä¸€ä¸‹-synchronized-åº•å±‚å®ç°åŸç†ï¼Ÿ">52.è¯´ä¸€ä¸‹ synchronized åº•å±‚å®ç°åŸç†ï¼Ÿ</h4><p>synchronized æ˜¯ç”±ä¸€å¯¹ monitorenter/monitorexit æŒ‡ä»¤å®ç°çš„ï¼Œmonitor å¯¹è±¡æ˜¯åŒæ­¥çš„åŸºæœ¬å®ç°å•å…ƒã€‚åœ¨ java 6 ä¹‹å‰ï¼Œmonitor çš„å®ç°å®Œå…¨æ˜¯ä¾é æ“ä½œç³»ç»Ÿå†…éƒ¨çš„äº’æ–¥é”ï¼Œå› ä¸ºéœ€è¦è¿›è¡Œç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ‰€ä»¥åŒæ­¥æ“ä½œæ˜¯ä¸€ä¸ªæ— å·®åˆ«çš„é‡é‡çº§æ“ä½œï¼Œæ€§èƒ½ä¹Ÿå¾ˆä½ã€‚ä½†åœ¨ java 6 çš„æ—¶å€™ï¼Œjava è™šæ‹Ÿæœº å¯¹æ­¤è¿›è¡Œäº†å¤§åˆ€é˜”æ–§åœ°æ”¹è¿›ï¼Œæä¾›äº†ä¸‰ç§ä¸åŒçš„ monitor å®ç°ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ä¸‰ç§ä¸åŒçš„é”ï¼šåå‘é”ï¼ˆBiased Lockingï¼‰ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ï¼Œå¤§å¤§æ”¹è¿›äº†å…¶æ€§èƒ½</p><p>==è¡¥å……1ï¼ši++ç­‰æ“ä½œä¸å…·å¤‡åŸå­æ€§ï¼Œå®ƒåˆ†ä¸ºè¯»å–ï¼Œè®¡ç®—ï¼Œèµ‹å€¼ä¸‰ä¸ªæ­¥éª¤ï¼Œå¯èƒ½åœ¨æ­¥éª¤è¿˜æ²¡å®Œæˆå°±è¢«èµ‹å€¼äº†ã€‚==</p><p>==synchronized è¿‡ç¨‹ï¼šå½“çº¿ç¨‹è·å–é”çš„æ—¶å€™ï¼Œmonitor+1ï¼Œå¦‚æœé‡å¤è¿›å…¥ï¼Œåˆ™ç»§ç»­+1ï¼Œå¦‚æœå¤±å»é”ï¼Œåˆ™monitor=0ã€‚é€šè¿‡æŒ‡ä»¤monittorenterå’Œmonitorexitæ¥æ“ä½œã€‚==</p><p>==synchronized é”è†¨èƒ€ï¼šæ— é”çŠ¶æ€ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼Œæ­¤è¿‡ç¨‹ä¸å¯é€†ã€‚==</p><p>==åå‘é”ï¼šå‡å°‘åŒä¸€çº¿ç¨‹è·å–é”çš„ä»£ä»·ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œæ€»æ˜¯ç”±ç»Ÿä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ã€‚==</p><p>==è½»é‡çº§é”ï¼šå½“å­˜åœ¨ç¬¬äºŒä¸ªçº¿ç¨‹ç”³è¯·åŒä¸€ä¸ªé”æ—¶ï¼Œåå‘é”å°±ä¼šç«‹å³å‡çº§ä¸ºè½»é‡çº§é”ï¼Œè¿™é‡Œæ˜¯ç”³è¯·é”ï¼Œè€Œä¸æ˜¯ç«äº‰é”ï¼Œå¯ä»¥ä¸€å‰ä¸€åçš„äº¤æ›¿æ‰§è¡Œä»£ç å—ã€‚==</p><p>==é‡é‡çº§é”ï¼šå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ç«äº‰ä¸€ä¸ªé”æ—¶ï¼Œå°±ä¼šå‡çº§æˆé‡é‡çº§é”ï¼Œä¸€èˆ¬è¿½æ±‚ååé‡ã€åŒæ­¥å—ã€æˆ–è€…åŒæ­¥æ–¹æ³•è¾ƒé•¿çš„åœºæ™¯ä¸‹ã€‚==</p><p>==é”æ¶ˆé™¤ï¼šjvmæ‰«æä¸Šä¸‹æ–‡ï¼Œå»é™¤ä¸å­˜åœ¨ç«äº‰çš„é”==</p><p>==é”ç²—åŒ–ï¼šjvmæ‰«æä¸Šä¸‹æ–‡ï¼Œé€šè¿‡æ‰©å¤§æ·é”çš„èŒƒå›´ï¼Œé¿å…åå¤åŠ é”å’Œé‡Šæ”¾é”==</p><p>==è‡ªæ—‹é”ï¼šåœ¨å…±äº«æ•°æ®çš„çŠ¶æ€æŒç»­è¿‡çŸ­çš„æƒ…å†µä¸‹ï¼Œåˆ‡æ¢çº¿ç¨‹ä¸å€¼å¾—ï¼Œå°±é€šè¿‡è®©çº¿ç¨‹æ‰§è¡Œå¾ªç¯ç­‰å¾…é”çš„é‡Šæ”¾çš„æ–¹å¼æ¥è¿›è¡Œä¼˜åŒ–ï¼Œå¾—åˆ°é”å°±è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¦åˆ™å°±æŒ‚èµ·ã€‚ç¼ºç‚¹ï¼šå¦‚æœä¸€ç›´å¾—ä¸åˆ°é”ï¼Œå°±ä¼šå¸¦æ¥å¤§é‡æ€§èƒ½å¼€é”€==</p><p>==è‡ªé€‚åº”è‡ªæ—‹é”ï¼šå®ƒçš„è‡ªæ—‹çš„æ¬¡æ•°ä¸å†å›ºå®šï¼Œå…¶è‡ªæ—‹çš„æ¬¡æ•°ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚==</p><h4 id="53-synchronized-å’Œ-volatile-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">53.synchronized å’Œ volatile çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>volatile æ˜¯å˜é‡ä¿®é¥°ç¬¦ï¼›synchronized æ˜¯ä¿®é¥°ç±»ã€æ–¹æ³•ã€ä»£ç æ®µã€‚</li><li>volatile ä»…èƒ½å®ç°å˜é‡çš„ä¿®æ”¹å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼›è€Œ synchronized åˆ™å¯ä»¥ä¿è¯å˜é‡çš„ä¿®æ”¹å¯è§æ€§å’ŒåŸå­æ€§ã€‚</li><li>volatile ä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼›synchronized å¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ã€‚</li></ul><p>==volatile å®šä¹‰ï¼švolatile æ˜¯ä¸€ä¸ªç±»å‹ä¿®é¥°ç¬¦ã€‚volatile çš„ä½œç”¨æ˜¯ä½œä¸ºæŒ‡ä»¤å…³é”®å­—ï¼Œç¡®ä¿æœ¬æ¡æŒ‡ä»¤ä¸ä¼šå› ç¼–è¯‘å™¨çš„ä¼˜åŒ–è€Œçœç•¥ï¼ˆå¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§ï¼‰==</p><p>==ä½œç”¨ï¼šä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œä¿®æ”¹æ—¶ï¼Œæ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹é©¬å¯è§çš„ã€‚ åªèƒ½ä¿è¯å¯¹å˜é‡çš„å•æ¬¡è¯»/å†™æ“ä½œçš„åŸå­æ€§ã€‚èƒ½å¤Ÿç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº==</p><h4 id="54-synchronized-å’Œ-Lock-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">54.synchronized å’Œ Lock æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><ul><li>synchronized å¯ä»¥ç»™ç±»ã€æ–¹æ³•ã€ä»£ç å—åŠ é”ï¼›è€Œ lock åªèƒ½ç»™ä»£ç å—åŠ é”ã€‚</li><li>synchronized ä¸éœ€è¦æ‰‹åŠ¨è·å–é”å’Œé‡Šæ”¾é”ï¼Œä½¿ç”¨ç®€å•ï¼Œå‘ç”Ÿå¼‚å¸¸ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œä¸ä¼šé€ æˆæ­»é”ï¼›è€Œ lock éœ€è¦è‡ªå·±åŠ é”å’Œé‡Šæ”¾é”ï¼Œå¦‚æœä½¿ç”¨ä¸å½“æ²¡æœ‰ unLock()å»é‡Šæ”¾é”å°±ä¼šé€ æˆæ­»é”ã€‚</li><li>é€šè¿‡ Lock å¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰æˆåŠŸè·å–é”ï¼Œè€Œ synchronized å´æ— æ³•åŠåˆ°ã€‚</li></ul><h4 id="55-synchronized-å’Œ-ReentrantLock-åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">55.synchronized å’Œ ReentrantLock åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>synchronized æ—©æœŸçš„å®ç°æ¯”è¾ƒä½æ•ˆï¼Œå¯¹æ¯” ReentrantLockï¼Œå¤§å¤šæ•°åœºæ™¯æ€§èƒ½éƒ½ç›¸å·®è¾ƒå¤§ï¼Œä½†æ˜¯åœ¨ java 6 ä¸­å¯¹ synchronized è¿›è¡Œäº†éå¸¸å¤šçš„æ”¹è¿›ã€‚</p><p>ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>ReentrantLock ä½¿ç”¨èµ·æ¥æ¯”è¾ƒçµæ´»ï¼Œä½†æ˜¯å¿…é¡»æœ‰é‡Šæ”¾é”çš„é…åˆåŠ¨ä½œï¼›</li><li>ReentrantLock å¿…é¡»æ‰‹åŠ¨è·å–ä¸é‡Šæ”¾é”ï¼Œè€Œ synchronized ä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾å’Œå¼€å¯é”ï¼›</li><li>ReentrantLock åªé€‚ç”¨äºä»£ç å—é”ï¼Œè€Œ synchronized å¯ç”¨äºä¿®é¥°æ–¹æ³•ã€ä»£ç å—ç­‰ã€‚</li><li>volatile æ ‡è®°çš„å˜é‡ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼›synchronized æ ‡è®°çš„å˜é‡å¯ä»¥è¢«ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</li></ul><p>==AbstractQueuedSynchronizer(AQS)ï¼šæ˜¯ä¸€ä¸ªæ„å»ºé”å’Œç›¸å…³åŒæ­¥å™¨çš„æ¡†æ¶ï¼Œå®ƒä¾èµ–äºFIFOçš„ç­‰å¾…é˜Ÿåˆ—å®ç°ã€‚ReentrantLockå°±æ˜¯åŸºäºAQSæ„å»ºçš„ã€‚AQSç»´æŠ¤äº†ä¸€ä¸ªFIFOçš„é˜Ÿåˆ—ï¼Œè®°å½•ç­‰å¾…çš„çº¿ç¨‹ï¼Œä¸Šé”å’Œé‡Šæ”¾é”å°±æ˜¯çº¿ç¨‹è¿›é˜Ÿorå‡ºé˜Ÿçš„è¿‡ç¨‹ï¼›è·å–ä¸åˆ°é”ï¼Œå°±è¿›å…¥é˜Ÿåˆ—è¿›è¡Œç­‰å¾…ï¼Œè¢«å”¤é†’å°±å‡ºé˜Ÿåˆ—ã€‚==</p><h4 id="56-è¯´ä¸€ä¸‹-atomic-çš„åŸç†ï¼Ÿ">56.è¯´ä¸€ä¸‹ atomic çš„åŸç†ï¼Ÿ</h4><p>atomic ä¸»è¦åˆ©ç”¨ CAS (Compare And Wwap) å’Œ volatile å’Œ native æ–¹æ³•æ¥ä¿è¯åŸå­æ“ä½œï¼Œä»è€Œé¿å… synchronized çš„é«˜å¼€é”€ï¼Œæ‰§è¡Œæ•ˆç‡å¤§ä¸ºæå‡ã€‚</p><p>==Atomicçš„ä½œç”¨ï¼šæ–¹é¢ç¨‹åºå‘˜åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œè¿›è¡Œæ— é”ç¼–ç¨‹==</p><p>==CASï¼šæ¯”è¾ƒå’Œæ›¿æ¢æŠ€æœ¯ï¼Œå°†é¢„æœŸå€¼ä¸å½“å‰å˜é‡çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰å°±ç”¨æ–°å€¼æ›¿æ¢ï¼Œå¦åˆ™å°±ä¸æ“ä½œã€‚æ³¨æ„ï¼šCASçš„æ“ä½œä¸­çš„å†é¢å¯¹ABAé—®é¢˜æ—¶ï¼Œä¸èƒ½ä¿è¯è¿™ä¸ªå€¼æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼Œå¯ä»¥ç»™è‡ªå·±å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡ä¿®æ”¹å˜é‡æ—¶ï¼Œç‰ˆæœ¬è‡ªå¢ï¼Œæ¯”è¾ƒçš„æ—¶å€™æ¯”è¾ƒå€¼ä¸ç‰ˆæœ¬å·==</p>]]></content>
    
    
    <categories>
      
      <category>JavaInterview</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HRé¢è¯•</title>
    <link href="/dajiangdahe/2021/10/22/HR%E9%9D%A2%E8%AF%95%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E5%9B%9E%E7%AD%94%E7%AD%96%E7%95%A5/"/>
    <url>/dajiangdahe/2021/10/22/HR%E9%9D%A2%E8%AF%95%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E5%9B%9E%E7%AD%94%E7%AD%96%E7%95%A5/</url>
    
    <content type="html"><![CDATA[<h1>1ã€ä½ æ€ä¹ˆçœ‹å¾…æœ¬å…¬å¸åœ¨è¡Œä¸šå†…çš„åœ°ä½ã€‚</h1><p>â€‹å¯¹å…¬å¸çš„è®¤çŸ¥ä»¥åŠçš„è¡Œä¸šè®¤çŸ¥ã€‚å“ªé‡Œçš„ä¼˜åŠ¿ï¼Œå“ªé‡Œçš„ç¼ºç‚¹ã€‚</p><h1>2ã€ä½ ç°åœ¨æ”¶åˆ°äº†å‡ ä¸ªofferäº†ï¼Œæ¥æœ¬å…¬å¸çš„æ„æ„¿æœ‰å¤šå¤§ã€‚</h1><p>æ±‚èŒæ„æ„¿ï¼ŒåŸºäºä¸ªäººæœªæ¥è§„åˆ’ã€‚ æ ¹æ®è§„åˆ’é¢è¯•äº†é‚£äº›å…¬å¸ï¼Œæ‹¿åˆ°äº†å“ªäº›offerï¼Œä½†æ˜¯æˆ‘æœ€æœ€ç»ˆç›®æ ‡çš„æ˜¯xxxã€‚ 1.ä¸æ±‚èŒæ„æ„¿ç¬¦åˆ       2.åœ¨æˆ‘çš„offerä¸­ï¼Œä¹Ÿæ˜¯æˆ‘çš„æœ€ä¼˜è§£ã€‚3ã€åŸå¸‚çš„é€‰æ‹©ï¼Œ</p><h1>3ã€ä¸ºä»€ä¹ˆé€‰æ‹©æ­å·/åŒ—äº¬ï¼Œï¼ˆæœ‰è€ƒè™‘å®šå±…çš„æ‰“ç®—å—ï¼‰</h1><p>1.æœ‰å®šå±…çš„æ‰“ç®—ã€‚è¿™æ˜¯æˆ‘ç¬¬ä¸€ä»½çš„å·¥ä½œï¼Œæˆ‘å¯èƒ½è¦è¿›è¡Œå­¦æ ¡-ç¤¾ä¼šçš„è½¬æ¢ï¼Œè¿™ä¸€è½¬æ¢å’Œä»»æˆ‘è®¤çŸ¥çš„å‘å±•æ˜¯éœ€è¦é•¿æ—¶æœŸçš„ã€‚å› ä¸ºå…ˆåŠ å¼ºè‡ªå·±çš„æŠ€æœ¯æ ˆï¼Œéœ€è¦åœ¨è¿™ä¸ªå²—ä½é•¿æœŸå­¦ä¹ ï¼Œæˆ‘ä¹Ÿæ„¿æ„ä¸ºäº†å®šå±…å»åŠªåŠ›ï¼Œå°½è‡ªå·±æœ€å¤§çš„å¯èƒ½å»ç•™ä¸‹æ¥ã€‚       2.è®©è‡ªå·±ç•™ä¸‹æ¥çš„æ–¹æ³•ï¼š           1.è®©è‡ªå·±å€¼é’± â€” æŠ€æœ¯           2.å·¥èµ„ â€” ç”Ÿå­˜ã€‚</p><h1>4ã€ä¸ªäººå­¦ä¹ ä¸Šæœ‰ä»€ä¹ˆè§„åˆ’</h1><p>è¡¨è¾¾å‡ºæˆå°±æ„Ÿçš„äº‹æƒ…ï¼Œé•¿æœŸåšæŒçš„äº‹æƒ…ï¼ŒæŠ—å‹æ€§ã€‚è§£å†³å‹åŠ›çš„åŠæ³•ã€‚</p><h1>5ã€å¯¹å®ä¹ æœ‰ä»€ä¹ˆçœ‹æ³•ã€‚</h1><h1>6ã€åé—®</h1><p>1.åœ¨é¢è¯•ç»“æŸæ—¶ï¼Œèµ¶ç´§è¡¥å……è¿™ä¸€å¥ï¼šæˆ‘å¾ˆçœ‹é‡æˆ‘è¿™æ¬¡çš„äº¤æµï¼Œå¸Œæœ›æœ‰æ›´å¤šçš„äº¤æµæœºä¼šï¼Œæˆ‘å¯ä»¥ç•™æ‚¨ä¸€ä¸ªè”ç³»æ–¹å¼å—ï¼Ÿ</p><h1>7ã€æœŸæœ›è–ªèµ„å¤šå°‘ã€‚</h1><p>â€‹1.è¡Œä¸šå¹³å‡ä¹‹ä¸Š/ä¸èƒ½ä½äºå»å¹´æ ¡æ‹›ç›¸åŒå²—ä½å·¥èµ„</p><h1>8ã€ä½ å¯¹ä»€ä¹ˆè¡Œä¸š/å…¬å¸æœ€æ„Ÿå…´è¶£ï¼Ÿ</h1><p>æ™ºæ…§ä¼ä¸š/åŸå¸‚ã€ é‡‘èç§‘æŠ€ã€è½¦è”ç½‘</p><h1>9ã€ä½ å¦‚æœæ‹¿åˆ°æˆ‘ä»¬çš„offerï¼Œä½†æ˜¯æœ€ç»ˆæ²¡æœ‰æ¥ï¼Œä½ è§‰å¾—ä»€ä¹ˆåŸå› å¯¼è‡´çš„å‘¢ã€‚</h1><p>é¦–å…ˆï¼Œæˆ‘èƒ½æ‹¿åˆ°offerï¼Œæˆ‘è‚¯å®šéå¸¸å¼€å¿ƒï¼Œæˆ‘è‚¯å®šä¹Ÿä¼šå»ã€‚å¦‚æœæˆ‘æœ€ç»ˆæ²¡æœ‰æ¥ï¼Œå¯èƒ½å…¬å¸è§‰å¾—æˆ‘å¤ªèœäº†ï¼Œæ”¶å›offeräº†ã€‚</p><h1>10ã€ä½ é€‰æ‹©ä¸€ä¸ªå…¬å¸çš„æ ‡å‡†æ˜¯ä»€ä¹ˆã€‚</h1><p>1.ä¼ä¸šæ–‡åŒ–</p><p>2.å›¢é˜Ÿç²¾ç¥</p><p>3.æ˜¯å¦æ˜¯è¿›æ­¥çš„ç§¯æçš„</p><p>4.ä»˜å‡ºå’Œå›æŠ¥æ˜¯å¦æˆæ­£æ¯”</p><h1>11ã€ä½ å¯¹åŠ ç­æ€ä¹ˆçœ‹</h1><ol><li>å¦‚æœé¡¹ç›®å‡ºç°bugå’Œç´§æ€¥æƒ…å†µçš„è¯ï¼Œæˆ‘ä¹Ÿä¼šåŠ ç­å»å®Œæˆè¿™ä¸ªäº‹æƒ…ã€‚å½“ç„¶å…¬å¸è¦æ±‚çš„æ¯å¤©ä»»åŠ¡è¿˜æ˜¯è¦ç§¯æå®Œæˆçš„ï¼Œå¦‚æœæ²¡å®Œæˆï¼Œä¼šè¦æ±‚ä¸»åŠ¨åŠ ç­å»å®Œæˆã€‚       2. å‡å°‘æ— æ„ä¹‰çš„åŠ ç­ï¼Œç„¶åè®©è‡ªå·±æœ‰ä¸€å®šçš„æ—¶é—´å»æå‡è‡ªå·±ï¼Œå½¢æˆä¸€ç§å·¥ä½œ-æå‡çš„è‰¯æ€§å¾ªç¯ã€‚       3. å¯¹æ¯å¤©å·¥ä½œè¿›è¡Œä¸€ç§å¤ç›˜ã€‚</li></ol><h1>12ã€é¡¹ç›®åˆä½œä¸­å¦‚æœä½ ä»¬äº§ç”Ÿäº†æ„è§åˆ†æ­§æ€ä¹ˆè§£å†³ï¼Ÿ</h1><p>1.è¿‡å¾€çœŸå®æ•…äº‹ã€‚è™šå‡çš„æƒ…èŠ‚ä¼šå®¹æ˜“è¢«æ‰¾åˆ°æ¼æ´ã€‚</p><h1>13ã€ä½ çš„é¢†å¯¼å’Œèº«è¾¹çš„åŒäº‹å’Œä½ ç›¸å¤„ä¸æ¥æ€ä¹ˆåŠã€‚</h1><p>å¦‚æœåªå¯¹æˆ‘ä¸å’Œçš„è¯ï¼Œå¯èƒ½å°±æ˜¯æˆ‘é—®é¢˜ï¼Œæˆ‘å›åæ€ä¸€ä¸‹è‡ªå·±ï¼Œä¼šå¾ˆå¦é™ˆçš„ä¸å¤§å®¶è¿›è¡Œä¸€ç§æ²Ÿé€šï¼Œæ”¹æ‰è‡ªå·±çš„æ¯›ç—…ã€‚     å¦‚æœæ˜¯é¢†å¯¼é—®é¢˜çš„è¯ï¼Œé‚£æ˜¯éƒ¨é—¨äººå¿ƒä¸é½å—ï¼Œåº”è¯¥ä¸ä¼šï¼Œæ¯•ç«Ÿä¸€ä¸ªéƒ¨é—¨æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ç›®æ ‡ã€‚é‚£å¯èƒ½ä¹Ÿæ˜¯ç®¡ç†æ–¹å¼ä¸åŒï¼Œå¯ä»¥å¤§å®¶ä¸€èµ·æ¢è®¨ä¸€ä¸‹ã€‚æ¯•ç«Ÿæ¯ä¸ªäººéƒ½æœ‰ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œæˆ‘ä»¬ä¸èƒ½åªçœ‹åˆ°åˆ«äººçš„ç¼ºç‚¹ï¼Œä¹Ÿéœ€è¦çœ‹åˆ°åˆ«äººçš„ä¼˜ç‚¹ã€‚</p><h1>14ã€è‡ªæˆ‘ä»‹ç»</h1><p>ä¸ªäºº ç›¸å…³ä¿¡æ¯ï¼Œåº”è˜ä»€ä¹ˆå²—ä½ï¼Œé¢è¯•xxçš„åŸå› ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JavaInterview</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ ¡æ‹›</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºhexoè‡ªåŠ¨æ¨é€é—®é¢˜</title>
    <link href="/dajiangdahe/2021/10/22/hexo%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/"/>
    <url>/dajiangdahe/2021/10/22/hexo%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1>1.è§£å†³æ¯æ¬¡gitæ—¶ï¼Œéƒ½éœ€è¦è¾“å…¥è´¦å·å¯†ç é—®é¢˜</h1><p>åªéœ€è¦åœ¨git bash é‡Œæ‰§è¡Œæ­¤gitå‘½ä»¤ï¼Œä»¥åNæ¬¡æ“ä½œå°±ä¸éœ€è¦è¾“å…¥è´¦å·å¯†ç äº†ã€‚ï¼ˆç¬¬ä¸€æ¬¡pushçš„æ—¶å€™éœ€è¦è´¦å·å’Œå¯†ç ï¼‰</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">$ git config --<span class="hljs-keyword">global</span> credential.helper <span class="hljs-keyword">store</span><br></code></pre></td></tr></table></figure><h1>2.è§£å†³hexoè‡ªåŠ¨æ¨é€åšå®¢åˆ°ç äº‘é—®é¢˜ï¼ˆæ–¹æ¡ˆä¸€ï¼‰</h1><p>1.åœ¨/{your blog}ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œ<a href="http://xn--ss0ao17a.sh">éƒ¨ç½².sh</a></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo clean</span><br><span class="hljs-attribute">hexo g</span><br><span class="hljs-attribute">hexo d</span><br></code></pre></td></tr></table></figure><p>2.æ–‡ä»¶å†…å®¹å¦‚ä¸Šå›¾æ‰€ç¤º</p><p>â€‹hexo clean æ˜¯æ¸…é™¤æ–‡ä»¶</p><p>â€‹    hexo g æ˜¯ç”Ÿæˆé™æ€æ–‡ä»¶</p><p>â€‹hexo d æ˜¯éƒ¨ç½²åˆ°gitee</p><p>3.åœ¨ç äº‘ gitee pages é¡µé¢ç‚¹å‡»æ›´æ–°å³å¯ã€‚ï¼ˆä»˜è´¹ç‰ˆå¯ä»¥è‡ªåŠ¨æ›´æ–°ï¼‰</p><h1>3.è§£å†³å›¾ç‰‡ä¸æ˜¾ç¤ºé—®é¢˜</h1><p>1.éœ€è¦å®‰è£…æ¨é€å›¾ç‰‡æ’ä»¶</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">npm install hexo-asset-<span class="hljs-built_in">image</span> --<span class="hljs-built_in">save</span><br></code></pre></td></tr></table></figure><p>2.è®¾ç½®åšå®¢ç›®å½•ä¸‹_config.ymlæ–‡ä»¶ä¸­çš„ post_asset_folderï¼šé€‰é¡¹æ˜¯å¦ä¸º true</p><p>3.è®¾ç½®Typora</p><img src="/dajiangdahe.github.io/2021/10/22/hexo%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/image-20210913131129705.png" class="" title="image-20210913131129705"><p>4.å°†ä¸‹é¢çš„index.jsä¸­çš„ä»£ç æ›¿æ¢node_modules\hexo-asset-imageä¸­çš„index.jsã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> log = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;hexo-log&#x27;</span>)(&#123; <span class="hljs-string">&#x27;debug&#x27;</span>: <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;slient&#x27;</span>: <span class="hljs-literal">false</span> &#125;);<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * mdæ–‡ä»¶è¿”å› true</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param <span class="hljs-type">&#123;*&#125;</span> </span>data </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ignore</span>(<span class="hljs-params">data</span>) </span>&#123;<br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å¥½å¥‡æ€ªï¼Œè¯•äº†ä¸€ä¸‹, mdè¿”å›true, ä½†å´éœ€è¦å¿½ç•¥ å–å!</span><br>    <span class="hljs-keyword">var</span> source = data.source;<br>    <span class="hljs-keyword">var</span> ext = source.substring(source.lastIndexOf(<span class="hljs-string">&#x27;.&#x27;</span>)).toLowerCase();<br>    <span class="hljs-keyword">return</span> [<span class="hljs-string">&#x27;md&#x27;</span>,].indexOf(ext) &gt; -<span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action</span>(<span class="hljs-params">data</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> reverseSource = data.source.split(<span class="hljs-string">&quot;&quot;</span>).reverse().join(<span class="hljs-string">&quot;&quot;</span>);<br>    <span class="hljs-keyword">var</span> fileName = reverseSource.substring(<span class="hljs-number">3</span>, reverseSource.indexOf(<span class="hljs-string">&quot;/&quot;</span>)).split(<span class="hljs-string">&quot;&quot;</span>).reverse().join(<span class="hljs-string">&quot;&quot;</span>);<br><br>    <span class="hljs-comment">// ![example](postname/example.jpg)  --&gt;  &#123;% asset_img example.jpg example %&#125;</span><br>    <span class="hljs-keyword">var</span> regExp = <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">&quot;!\\[(.*?)\\]\\(&quot;</span> + fileName + <span class="hljs-string">&#x27;/(.+?)\\)&#x27;</span>, <span class="hljs-string">&quot;g&quot;</span>);<br>    <span class="hljs-comment">// hexo g</span><br>    data.content = data.content.replace(regExp, <span class="hljs-string">&quot;&#123;% asset_img $2 $1 %&#125;&quot;</span>,<span class="hljs-string">&quot;g&quot;</span>);<br><br>    <span class="hljs-comment">// log.info(`hexo-asset-img: filename: $&#123;fileName&#125;, title: $&#123;data.title.trim()&#125;`);</span><br>    <br>    <span class="hljs-keyword">return</span> data;<br>&#125;<br><br>hexo.extend.filter.register(<span class="hljs-string">&#x27;before_post_render&#x27;</span>,<span class="hljs-function">(<span class="hljs-params">data</span>)=&gt;</span>&#123;<br>    <span class="hljs-keyword">if</span>(!ignore(data))&#123;<br>        action(data)<br>    &#125;<br>&#125;, <span class="hljs-number">0</span>);<br><br></code></pre></td></tr></table></figure><p>5.æµ‹è¯•</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo clean</span><br><span class="hljs-attribute">hexo g</span><br><span class="hljs-attribute">hexo s</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>blog</category>
      
    </categories>
    
    
    <tags>
      
      <tag>blog</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HashMapä¸ºä»€ä¹ˆé»˜è®¤æ‰©å®¹å› å­æ˜¯0.75ï¼Ÿ</title>
    <link href="/dajiangdahe/2021/10/22/HashMap%E4%B8%BA%E4%BB%80%E4%B9%88%E9%BB%98%E8%AE%A4%E6%89%A9%E5%AE%B9%E5%9B%A0%E5%AD%90%E6%98%AF0.75%EF%BC%9F/"/>
    <url>/dajiangdahe/2021/10/22/HashMap%E4%B8%BA%E4%BB%80%E4%B9%88%E9%BB%98%E8%AE%A4%E6%89%A9%E5%AE%B9%E5%9B%A0%E5%AD%90%E6%98%AF0.75%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[<h1>ä»æ³Šæ¾åˆ†å¸ƒè°ˆèµ·HashMap</h1><p><strong>ã€äºŒé¡¹åˆ†å¸ƒã€‘</strong></p><p>äºŒé¡¹åˆ†å¸ƒå°±æ˜¯é‡å¤næ¬¡ç‹¬ç«‹çš„ä¼¯åŠªåˆ©è¯•éªŒã€‚åœ¨æ¯æ¬¡è¯•éªŒä¸­åªæœ‰ä¸¤ç§å¯èƒ½çš„ç»“æœï¼Œè€Œä¸”ä¸¤ç§ç»“æœå‘ç”Ÿä¸å¦äº’ç›¸å¯¹ç«‹ï¼Œå¹¶ä¸”ç›¸äº’ç‹¬ç«‹ï¼Œä¸å…¶å®ƒå„æ¬¡è¯•éªŒç»“æœæ— å…³ï¼Œäº‹ä»¶å‘ç”Ÿä¸å¦çš„æ¦‚ç‡påœ¨æ¯ä¸€æ¬¡ç‹¬ç«‹è¯•éªŒä¸­éƒ½ä¿æŒä¸å˜ï¼Œåˆ™è¿™ä¸€ç³»åˆ—è¯•éªŒæ€»ç§°ä¸ºné‡ä¼¯åŠªåˆ©å®éªŒï¼Œå½“è¯•éªŒæ¬¡æ•°ä¸º1æ—¶ï¼ŒäºŒé¡¹åˆ†å¸ƒæœä»0-1åˆ†å¸ƒã€‚</p><p>ä¸¤ä¸ªé‡ç‚¹ï¼š</p><ul><li>æ¯æ¬¡è¯•éªŒç‹¬ç«‹ï¼šç¬¬næ¬¡è¯•éªŒä¸å—n-1æ¬¡è¯•éªŒçš„å½±å“ï¼Œä¹Ÿä¸å½±å“n+1æ¬¡è¯•éªŒï¼›</li><li>ç»“æœæœ‰ä¸”åªæœ‰ä¸¤ä¸ªï¼Œå¹¶ä¸”äº’ç›¸å¯¹ç«‹ï¼šè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ï¼ŒæˆåŠŸçš„æ¦‚ç‡+å¤±è´¥çš„æ¦‚ç‡=1ï¼›</li></ul><p>è‡³äºäºŒé¡¹åˆ†å¸ƒå›¾çš„ç»˜åˆ¶ï¼Œä¹Ÿå°±æ˜¯åšnæ¬¡è¯•éªŒï¼ŒæœŸæœ›æˆåŠŸkæ¬¡çš„æ¦‚ç‡åˆ†å¸ƒã€‚æ ¹æ®äºŒé¡¹åˆ†å¸ƒå‡½æ•°ï¼Œä½ åªéœ€è¦çŸ¥é“è¯•éªŒæ€»æ¬¡æ•°nã€æœŸæœ›æˆåŠŸçš„æ¬¡æ•°kï¼Œä»¥åŠæ¯æ¬¡è¯•éªŒæˆåŠŸçš„æ¦‚ç‡pï¼Œå³å¯å¾ˆå¿«çš„æ±‚å‡ºæˆåŠŸkæ¬¡çš„æ¦‚ç‡ã€‚</p><p>ã€<strong>æ³Šæ¾åˆ†å¸ƒ</strong>ã€‘</p><p>æ³Šæ¾åˆ†å¸ƒï¼š æ˜¯ç¦»æ•£éšæœºåˆ†å¸ƒçš„ä¸€ç§ï¼Œé€šå¸¸è¢«ä½¿ç”¨åœ¨ä¼°ç®—åœ¨ ä¸€æ®µç‰¹å®šæ—¶é—´/ç©ºé—´å†…å‘ç”ŸæˆåŠŸäº‹ä»¶çš„æ•°é‡çš„æ¦‚ç‡ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/HashMap%E4%B8%BA%E4%BB%80%E4%B9%88%E9%BB%98%E8%AE%A4%E6%89%A9%E5%AE%B9%E5%9B%A0%E5%AD%90%E6%98%AF0.75%EF%BC%9F/v2-7adb1965b4f92d6121d77687907583e1_720w.jpg" class="" title="img"><p>ã€<strong>HashMapä¸æ³Šæ¾åˆ†å¸ƒçš„å…³ç³»</strong>ã€‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs text">* Ideally, under random hashCodes, the frequency of<br>     * nodes in bins follows a Poisson distribution<br>     * (http://en.wikipedia.org/wiki/Poisson_distribution) with a<br>     * parameter of about 0.5 on average for the default resizing<br>     * threshold of 0.75, although with a large variance because of<br>     * resizing granularity.<br>     *<br>     * ç¿»è¯‘ï¼š<br>     *     å°½ç®¡å› ä¸ºè°ƒæ•´ç²’åº¦è€Œäº§ç”Ÿè¾ƒå¤§çš„æ–¹å·®ï¼Œä½†æ˜¯ç†æƒ³çš„æƒ…å†µï¼Œåœ¨éšæœºhashCodesä¸‹ï¼Œæ¡¶ä¸­èŠ‚ç‚¹çš„é¢‘ç‡éµå¾ªæ³Šæ¾åˆ†å¸ƒã€‚<br>     *     é»˜è®¤è°ƒæ•´é˜ˆå€¼ä¸º0.75çš„æ¡ä»¶ä¸‹ï¼Œæ³Šæ¾åˆ†å¸ƒä¸­çš„æ¦‚ç‡å‚æ•°Î»=0.5ã€‚<br>     * è§£é‡Šï¼š<br>     *     kè¡¨ç¤ºæ•°é‡ï¼Œè¿™é‡ŒæŒ‡æ¡¶ä¸­èŠ‚ç‚¹çš„ä¸ªæ•°ã€‚<br>     *     Î»è¡¨ç¤ºäº‹ä»¶çš„é¢‘ç‡ã€‚è¿™é‡ŒÎ»=0.5ï¼Œä»£è¡¨ç†æƒ³æƒ…å†µä¸‹ï¼Œå¹³å‡100ä¸ªæ¡¶ï¼Œ50ä¸ªæ•°æ®ï¼Œåˆ™1ä¸ªæ¡¶æœ‰æ•°æ®çš„æ¦‚ç‡æ˜¯0.5ã€‚<br>     *     å¿½ç•¥æ–¹å·®ï¼ŒæŠŠÎ»ä»£å…¥ã€‚åˆ™æ±‚ä¸€ä¸ªæ¡¶ä¸­å‡ºç°kä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡ï¼Œå…¬å¼ä¸ºï¼š<br>     <br>     <br>    private static String poisson(int k) &#123;<br>        //æ³Šæ¾åˆ†å¸ƒ Java<br>        double value = Math.exp(-0.5) * Math.pow(0.5, k) / IntMath.factorial(k);<br>        //æ ¼å¼åŒ–å‚æ•°ï¼Œä¿ç•™10ä½å°æ•°ã€‚<br>        return new BigDecimal(value+&quot;&quot;).setScale(10, ROUND_HALF_UP).toPlainString();<br>    &#125;<br></code></pre></td></tr></table></figure><p>ã€<strong>æ¯ä¸ªæ¡¶ä¸­å‡ºç°1ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡</strong>ã€‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs text">public static void main(String[] args) &#123;<br>        System.out.println(&quot;1ä¸ªæ¡¶ä¸­å‡ºç°1ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:&quot; + poisson(1));<br>        System.out.println(&quot;1ä¸ªæ¡¶ä¸­å‡ºç°2ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:&quot; +poisson(2));<br>        System.out.println(&quot;1ä¸ªæ¡¶ä¸­å‡ºç°3ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:&quot; +poisson(3));<br>        System.out.println(&quot;1ä¸ªæ¡¶ä¸­å‡ºç°4ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:&quot; +poisson(4));<br>        System.out.println(&quot;1ä¸ªæ¡¶ä¸­å‡ºç°5ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:&quot; +poisson(5));<br>        System.out.println(&quot;1ä¸ªæ¡¶ä¸­å‡ºç°6ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:&quot; +poisson(6));<br>        System.out.println(&quot;1ä¸ªæ¡¶ä¸­å‡ºç°7ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:&quot; +poisson(7));<br>        System.out.println(&quot;1ä¸ªæ¡¶ä¸­å‡ºç°8ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:&quot; +poisson(8));//äº¿åˆ†ä¹‹å…­<br>        System.out.println(&quot;1ä¸ªæ¡¶ä¸­å‡ºç°9ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:&quot; +poisson(9));<br>    &#125;<br><br>Console:<br>    1ä¸ªæ¡¶ä¸­å‡ºç°1ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:0.3032653299<br>    1ä¸ªæ¡¶ä¸­å‡ºç°2ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:0.0758163325<br>    1ä¸ªæ¡¶ä¸­å‡ºç°3ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:0.0126360554<br>    1ä¸ªæ¡¶ä¸­å‡ºç°4ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:0.0015795069<br>    1ä¸ªæ¡¶ä¸­å‡ºç°5ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:0.0001579507<br>    1ä¸ªæ¡¶ä¸­å‡ºç°6ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:0.0000131626<br>    1ä¸ªæ¡¶ä¸­å‡ºç°7ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:0.0000009402<br>    1ä¸ªæ¡¶ä¸­å‡ºç°8ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:0.0000000588//äº¿åˆ†ä¹‹å…­<br>    1ä¸ªæ¡¶ä¸­å‡ºç°9ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡:0.0000000033<br></code></pre></td></tr></table></figure><p>è¿™ä¸€æ®µä¹ƒè‡³HashMapå¼€å¤´çš„ä¸€å¤§æ®µæ³¨é‡Šéƒ½æ²¡æœ‰è§£é‡Šload factoryé»˜è®¤å€¼æ˜¯0.75çš„åŸå› ï¼Œè€Œæ˜¯è¯´load factorçš„å€¼ä¼šå½±å“æ³Šæ¾åˆ†å¸ƒPMFå‡½æ•°å…¬å¼ä¸­çš„å‚æ•°Î»çš„å€¼ï¼Œä¾‹å¦‚load factor=0.75fæ—¶Î»=0.5ã€‚æŒ‰ç…§æ³Šæ¾åˆ†å¸ƒå…¬å¼æ¥çœ‹ï¼ŒæœŸæœ›æ”¾å…¥binä¸­æ•°æ®çš„æ•°é‡k=8ï¼Œeæ˜¯ä¸€ä¸ªæ— ç†å¸¸æ•°ï¼ŒÎ»çš„å€¼å—load factorçš„å€¼çš„å½±å“ï¼ˆæ³Šæ¾åˆ†å¸ƒæ˜¯ç”¨æ¥ä¼°ç®—åœ¨ ä¸€æ®µç‰¹å®šæ—¶é—´æˆ–ç©ºé—´å†…å‘ç”ŸæˆåŠŸäº‹ä»¶çš„æ•°é‡çš„æ¦‚ç‡ï¼Œå³åœ¨é•¿åº¦ä¸ºlengthçš„æ•°ç»„ä¸­hashåœ°æ”¾å…¥0.75*lengthæ•°é‡çš„æ•°æ®ï¼Œæ•°ç»„ä¸­æŸä¸€ä¸ªä¸‹æ ‡æ”¾å…¥kä¸ªæ•°æ®çš„æ¦‚ç‡ï¼‰ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/HashMap%E4%B8%BA%E4%BB%80%E4%B9%88%E9%BB%98%E8%AE%A4%E6%89%A9%E5%AE%B9%E5%9B%A0%E5%AD%90%E6%98%AF0.75%EF%BC%9F/20181013121844583" class="" title="img"><p>java8åŠä»¥ä¸Šç‰ˆæœ¬çš„HashMapä¸­è¿™æ®µæ³¨é‡Šçš„è§£é‡Šï¼š</p><ul><li>è¿™ä¸€æ®µæ³¨é‡Šçš„å†…å®¹å’Œç›®çš„éƒ½æ˜¯ä¸ºäº†è§£é‡Šåœ¨java8 HashMapä¸­å¼•å…¥Tree Binï¼ˆä¹Ÿå°±æ˜¯æ”¾å…¥æ•°æ®çš„æ¯ä¸ªæ•°ç»„binä»é“¾è¡¨nodeè½¬æ¢ä¸ºred-black tree nodeï¼‰çš„åŸå› </li><li>åŸæ³¨é‡Šå¦‚ä¸Šå›¾åˆ’çº¿éƒ¨åˆ†ï¼šBecause TreeNodes are about twice the size of regular nodes, we use them only when bins contain enough nodes to warrant use(see TREEIFY_THRESHOLD).</li><li><strong>TreeNode</strong>è™½ç„¶æ”¹å–„äº†é“¾è¡¨å¢åˆ æ”¹æŸ¥çš„æ€§èƒ½ï¼Œ<strong>ä½†æ˜¯å…¶èŠ‚ç‚¹å¤§å°æ˜¯é“¾è¡¨èŠ‚ç‚¹çš„ä¸¤å€</strong></li><li>è™½ç„¶å¼•å…¥TreeNodeä½†æ˜¯ä¸ä¼šè½»æ˜“è½¬å˜ä¸ºTreeNodeï¼ˆå¦‚æœå­˜åœ¨å¤§é‡è½¬æ¢é‚£ä¹ˆèµ„æºä»£ä»·æ¯”è¾ƒå¤§ï¼‰ï¼Œ<strong>æ ¹æ®æ³Šæ¾åˆ†å¸ƒæ¥çœ‹è½¬å˜æ˜¯å°æ¦‚ç‡äº‹ä»¶ï¼Œæ€§ä»·æ¯”æ˜¯å€¼å¾—çš„</strong></li><li>æ³Šæ¾åˆ†å¸ƒæ˜¯äºŒé¡¹åˆ†å¸ƒçš„æé™å½¢å¼ï¼Œä¸¤ä¸ªé‡ç‚¹ï¼š<strong>äº‹ä»¶ç‹¬ç«‹</strong>ã€<strong>æœ‰ä¸”åªæœ‰ä¸¤ä¸ªç›¸äº’å¯¹ç«‹çš„ç»“æœ</strong></li><li>æ³Šæ¾åˆ†å¸ƒæ˜¯æŒ‡ä¸€æ®µæ—¶é—´æˆ–ç©ºé—´ä¸­å‘ç”ŸæˆåŠŸäº‹ä»¶çš„æ•°é‡çš„æ¦‚ç‡</li><li>å¯¹HashMap table[]ä¸­ä»»æ„ä¸€ä¸ªbinæ¥è¯´ï¼Œå­˜å…¥ä¸€ä¸ªæ•°æ®ï¼Œè¦ä¹ˆæ”¾å…¥è¦ä¹ˆä¸æ”¾å…¥ï¼Œè¿™ä¸ªåŠ¨ä½œæ»¡è¶³äºŒé¡¹åˆ†å¸ƒçš„ä¸¤ä¸ªé‡ç‚¹æ¦‚å¿µ</li><li>å¯¹äºHashMap.table[].lengthçš„ç©ºé—´æ¥è¯´ï¼Œæ”¾å…¥0.75<em>lengthä¸ªæ•°æ®ï¼ŒæŸä¸€ä¸ªbinä¸­æ”¾å…¥èŠ‚ç‚¹æ•°é‡çš„æ¦‚ç‡æƒ…å†µå¦‚ä¸Šå›¾æ³¨é‡Šä¸­ç»™å‡ºçš„æ•°æ®ï¼ˆè¡¨ç¤ºæ•°ç»„æŸä¸€ä¸ªä¸‹æ ‡å­˜æ”¾æ•°æ®æ•°é‡ä¸º0~8æ—¶çš„æ¦‚ç‡æƒ…å†µï¼‰</em><ul><li><strong>ä¸¾ä¸ªä¾‹å­è¯´æ˜</strong>ï¼ŒHashMapé»˜è®¤çš„table[].length=16ï¼Œåœ¨é•¿åº¦ä¸º16çš„HashMapä¸­æ”¾å…¥12ï¼ˆ0.75*lengthï¼‰ä¸ªæ•°æ®ï¼ŒæŸä¸€ä¸ªbinä¸­å­˜æ”¾äº†8ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡æ˜¯0.00000006</li><li><strong>æ‰©å®¹ä¸€æ¬¡</strong>ï¼Œ16*2=32ï¼Œåœ¨é•¿åº¦ä¸º32çš„HashMapä¸­æ”¾å…¥24ä¸ªæ•°æ®ï¼ŒæŸä¸€ä¸ªbinä¸­å­˜æ”¾äº†8ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡æ˜¯0.00000006</li><li><strong>å†æ‰©å®¹ä¸€æ¬¡</strong>ï¼Œ32*2=64ï¼Œåœ¨é•¿åº¦ä¸º64çš„HashMapä¸­æ”¾å…¥48ä¸ªæ•°æ®ï¼ŒæŸä¸€ä¸ªbinä¸­å­˜æ”¾äº†8ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡æ˜¯0.00000006</li><li><strong>æ‰€ä»¥ï¼Œå½“æŸä¸€ä¸ªbinçš„èŠ‚ç‚¹å¤§äºç­‰äº8ä¸ªçš„æ—¶å€™ï¼Œå°±å¯ä»¥ä»é“¾è¡¨nodeè½¬æ¢ä¸ºtreenodeï¼Œå…¶æ€§ä»·æ¯”æ˜¯å€¼å¾—çš„ã€‚</strong></li></ul></li></ul><p><strong>ã€load factor=0.75fçš„çœŸæ­£åŸå› ã€‘</strong></p><p>load factory=0.75çš„çœŸæ­£åŸå› ï¼Œåœ¨java7ã€8ç­‰ä¸­å‡æœ‰æ³¨é‡Šï¼ˆè¿™æ®µæ³¨é‡Šåœ¨public class HashMapç±»å®šä¹‰ä¹‹å‰ï¼Œé™„æ³¨çš„æ³¨é‡Šå³æœ¬æ–‡æ‰€è®¨è®ºçš„æ³¨é‡Šæ˜¯åœ¨HashMapç±»å®šä¹‰ä¹‹åï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè´Ÿè½½å› å­å¤ªå°äº†æµªè´¹ç©ºé—´å¹¶ä¸”ä¼šå‘ç”Ÿæ›´å¤šæ¬¡æ•°çš„resizeï¼Œå¤ªå¤§äº†å“ˆå¸Œå†²çªå¢åŠ ä¼šå¯¼è‡´æ€§èƒ½ä¸å¥½ï¼Œæ‰€ä»¥0.75åªæ˜¯ä¸€ä¸ªæŠ˜ä¸­çš„é€‰æ‹©ï¼Œå’Œæ³Šæ¾åˆ†å¸ƒæ²¡æœ‰ä»€ä¹ˆå…³ç³»ã€‚</p><img src="/dajiangdahe.github.io/2021/10/22/HashMap%E4%B8%BA%E4%BB%80%E4%B9%88%E9%BB%98%E8%AE%A4%E6%89%A9%E5%AE%B9%E5%9B%A0%E5%AD%90%E6%98%AF0.75%EF%BC%9F/20181013121921758" class="" title="img">]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HashMap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>EasyExcelæ’ä»¶åœ¨webä¸‹çš„ä½¿ç”¨</title>
    <link href="/dajiangdahe/2021/10/22/EasyExcel%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/dajiangdahe/2021/10/22/EasyExcel%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1>1.EasyExcelæ’ä»¶</h1><p>EasyExcelæ˜¯ä¸€ä¸ªåŸºäºJavaçš„ç®€å•ã€çœå†…å­˜çš„è¯»å†™Excelçš„å¼€æºé¡¹ç›®ã€‚åœ¨å°½å¯èƒ½èŠ‚çº¦å†…å­˜çš„æƒ…å†µä¸‹æ”¯æŒè¯»å†™ç™¾Mçš„Excelã€‚</p><h1>2.EasyExcel webè¯»</h1><h2 id="1-ä¾èµ–">1.ä¾èµ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>           &lt;groupId&gt;com.alibaba&lt;/groupId&gt;<br>           &lt;artifactId&gt;easyexcel&lt;/artifactId&gt;<br>           &lt;version&gt;<span class="hljs-number">2.1</span><span class="hljs-number">.6</span>&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="2-å¯¹åº”çš„execlè¡¨æ ¼">2.å¯¹åº”çš„execlè¡¨æ ¼</h2><img src="/dajiangdahe.github.io/2021/10/22/EasyExcel%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211007105045718.png" class="" title="image-20211007105045718">Ian<h2 id="3-åœ¨beanå±‚å»ºç«‹å¯¹åº”çš„voç±»">3.åœ¨beanå±‚å»ºç«‹å¯¹åº”çš„voç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TraindataVo</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> Integer userId;<br><br>    <span class="hljs-keyword">private</span> String type;<br><br>    <span class="hljs-keyword">private</span> Date timeStamp;<br><br>    <span class="hljs-keyword">private</span> Double firstSub;<br><br>    <span class="hljs-keyword">private</span> Double secondSub;<br><br>    <span class="hljs-keyword">private</span> Double thirdSub;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡å¯¹åº”çš„voç±»æ¥åŒ¹é…å¯¹åº”çš„excelè¿›è¡Œexcelçš„è¯»å–.</p><h2 id="4-controllerå±‚">4.controllerå±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/importExcel&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;æ–‡ä»¶ä¸Šä¼ &quot;)</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> Result <span class="hljs-title">importExcel</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> MultipartFile file)</span> </span>&#123;<br>       traindataService.importExcel(file);<br>       <span class="hljs-keyword">return</span> Result.ok();<br>   &#125;<br></code></pre></td></tr></table></figure><h2 id="5-serviceå±‚">5.serviceå±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å¯¼å…¥æ–‡ä»¶</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">importExcel</span><span class="hljs-params">(MultipartFile file)</span></span>; <br><br><span class="hljs-comment">//æ’å…¥æ•°æ®åˆ°æ•°æ®åº“</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(Traindata results)</span></span>;<br></code></pre></td></tr></table></figure><h2 id="6-serviceImplå±‚">6.serviceImplå±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * å¯¼å…¥excel</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> file æ–‡ä»¶</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">importExcel</span><span class="hljs-params">(MultipartFile file)</span> </span>&#123;<br>       <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span>==file)&#123;<br>           <span class="hljs-keyword">return</span>;<br>       &#125;<br>       InputStream in = <span class="hljs-keyword">null</span>;<br>       <span class="hljs-keyword">try</span> &#123;<br>           in = <span class="hljs-keyword">new</span> BufferedInputStream(file.getInputStream());<br>           <span class="hljs-comment">//å®ä¾‹åŒ–å®ç°äº†AnalysisEventListeneræ¥å£çš„ç±»</span><br>           <span class="hljs-comment">//æ‰“å°ä¿¡æ¯</span><br>           LOGGER.info(in.toString());<br>           EasyExcel.read(in, TraindataVo.class, <span class="hljs-keyword">new</span> ExcelListener(traindataService)).sheet().doRead();<br>       &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>           e.printStackTrace();<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ’å…¥</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> traindata traindata</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(Traindata traindata)</span> </span>&#123;<br>        baseMapper.insert(traindata);<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="7-ExcelListenerå·¥å…·ç±»">7.ExcelListenerå·¥å…·ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> edu.bjut.visualization.utils.listeners;<br><br><span class="hljs-keyword">import</span> com.alibaba.excel.context.AnalysisContext;<br><span class="hljs-keyword">import</span> com.alibaba.excel.event.AnalysisEventListener;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> edu.bjut.visualization.bean.Traindata;<br><span class="hljs-keyword">import</span> edu.bjut.visualization.bean.vo.TraindataVo;<br><span class="hljs-keyword">import</span> edu.bjut.visualization.service.ITraindataService;<br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">// æœ‰ä¸ªå¾ˆé‡è¦çš„ç‚¹ ExcelListener ä¸èƒ½è¢«springç®¡ç†ï¼Œè¦æ¯æ¬¡è¯»å–exceléƒ½è¦new,ç„¶åé‡Œé¢ç”¨åˆ°springå¯ä»¥æ„é€ æ–¹æ³•ä¼ è¿›å»</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExcelListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AnalysisEventListener</span>&lt;<span class="hljs-title">TraindataVo</span>&gt; </span>&#123;<br>    <span class="hljs-comment">//æ—¥å¿—ä½¿ç”¨</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ExcelListener.class);<br>    <span class="hljs-comment">//ç¼“å­˜çš„æ•°æ®åˆ—è¡¨</span><br>    <span class="hljs-keyword">private</span> List&lt;TraindataVo&gt; datas = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>    <span class="hljs-comment">//æ¯éš”5æ¡å­˜å‚¨æ•°æ®åº“ï¼Œå®é™…ä½¿ç”¨ä¸­å¯ä»¥3000æ¡ï¼Œç„¶åæ¸…ç†list ï¼Œæ–¹ä¾¿å†…å­˜å›æ”¶</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> BATCH_COUNT = <span class="hljs-number">3000</span>;<br>    <span class="hljs-keyword">private</span> ITraindataService traindataService;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ExcelListener</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-comment">//å¦‚æœä½¿ç”¨äº†spring,åˆ™éœ€è¦ä½¿ç”¨æ­¤æ„é€ å™¨,æ¯æ¬¡åˆ›å»ºListenerçš„æ—¶å€™éœ€è¦æŠŠspringç®¡ç†çš„ç±»ä¼ è¿›æ¥</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ExcelListener</span><span class="hljs-params">(ITraindataService traindataService)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.traindataService = traindataService;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è°ƒç”¨</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data    æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> context ä¸Šä¸‹æ–‡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">invoke</span><span class="hljs-params">(TraindataVo data, AnalysisContext context)</span> </span>&#123;<br>        LOGGER.info(<span class="hljs-string">&quot;è§£æåˆ°ä¸€æ¡æ•°æ®:&#123;&#125;&quot;</span>, JSON.toJSONString(data));<br>        <span class="hljs-comment">//æ•°æ®å­˜å‚¨åˆ°datasï¼Œä¾›æ‰¹é‡å¤„ç†ï¼Œæˆ–åç»­è‡ªå·±ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚</span><br>        datas.add(data);<br>        <span class="hljs-comment">//è¾¾åˆ°BATCH_COUNTäº†ï¼Œéœ€è¦å»å­˜å‚¨ä¸€æ¬¡æ•°æ®åº“ï¼Œé˜²æ­¢æ•°æ®å‡ ä¸‡æ¡æ•°æ®åœ¨å†…å­˜ï¼Œå®¹æ˜“OOM</span><br>        <span class="hljs-keyword">if</span>(datas.size() &gt;= BATCH_COUNT)&#123;<br>            saveData();<br>            <span class="hljs-comment">// å­˜å‚¨å®Œæˆæ¸…ç†datas</span><br>            datas.clear();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¿å­˜æ•°æ®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveData</span><span class="hljs-params">()</span> </span>&#123;<br><br>        <span class="hljs-comment">//å¦‚æœæ˜¯å¤§æ‰¹é‡çš„æ•°æ®,å°½é‡åˆ«å¤šæ¬¡è°ƒç”¨insertä¸€æ¬¡æ¬¡æ’å…¥,å¯ä»¥åœ¨mapperå±‚å†™ä¸€ä¸ªæ‰¹é‡æ’å…¥</span><br>        <span class="hljs-keyword">for</span>(TraindataVo results : datas)&#123;<br>            Traindata traindata = <span class="hljs-keyword">new</span> Traindata();<br>            traindata.setUserId(results.getUserId());<br>            traindata.setTimeStamp(<span class="hljs-keyword">new</span> java.sql.Timestamp(results.getTimeStamp().getTime()));<br>            traindata.setFirstSub(results.getFirstSub());<br>            traindata.setSecondSub(results.getSecondSub());<br>            traindata.setType(results.getType());<br>            traindata.setThirdSub(results.getThirdSub());<br>            LOGGER.info(<span class="hljs-string">&quot;traindataæ•°æ®ï¼Œå¼€å§‹å­˜å‚¨æ•°æ®åº“ï¼&quot;</span>,  JSON.toJSONString(traindata));<br>            <span class="hljs-keyword">this</span>.traindataService.insert(traindata);<br>        &#125;<br>        LOGGER.info(<span class="hljs-string">&quot;å­˜å‚¨æ•°æ®åº“æˆåŠŸï¼&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//æ‰€æœ‰æ•°æ®è§£æå®Œæˆäº† éƒ½ä¼šæ¥è°ƒç”¨</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doAfterAllAnalysed</span><span class="hljs-params">(AnalysisContext context)</span> </span>&#123;<br>        <span class="hljs-comment">//è¿™é‡Œä¹Ÿè¦ä¿å­˜æ•°æ®,ç¡®ä¿æœ€åé—ç•™çš„æ•°æ®ä¹Ÿå­˜å‚¨åˆ°æ•°æ®åº“</span><br>        saveData();<br>        LOGGER.info(<span class="hljs-string">&quot;æ‰€æœ‰æ•°æ®è§£æå®Œæˆï¼&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1>3.æ€»ç»“</h1><p>easyexcelæ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•æ–¹ä¾¿ä½¿ç”¨çš„æ’ä»¶,å¯¹äºwebè¯»å’Œwebå†™åŸºæœ¬ä¸Šéƒ½åªéœ€è¦åœ¨ç›‘å¬ç±»åšä¸€äº›é…ç½®å³å¯.</p><p>å®˜æ–¹æ–‡æ¡£åœ°å€https://www.yuque.com/easyexcel/doc/read</p>]]></content>
    
    
    <categories>
      
      <category>æ’ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>EasyExcel</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
